(this.webpackJsonpmito=this.webpackJsonpmito||[]).push([[0],[,,,,,function(e,t,n){"use strict";var a=n(2);function r(e,t){return Math.random()*(t-e)+e}function i(e,t){return Math.floor(r(e,t+1))}function o(e){return e[i(0,e.length-1)]}function s(e,t,n){return e+(t-e)*n}function l(e,t,n){e.x=e.x*(1-n)+t.x*n,e.y=e.y*(1-n)+t.y*n}function c(e,t,n,a,r){return s(a,r,(e-t)/(n-t))}function u(e,t,n){return e<t?t:e>n?n:e}function h(e){return e[Math.floor(Math.random()*e.length)]}function d(e){var t=Math.floor(e),n=e-t;return t+(Math.random()<n?1:0)}function m(e,t){return(e%t+t)%t}function f(e){return m(e,1)}function v(e,t){return Math.round(e/t)*t}function p(e){return new a.Vector2(e.x,e.y)}n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"j",(function(){return h})),n.d(t,"h",(function(){return d})),n.d(t,"k",(function(){return f})),n.d(t,"i",(function(){return v})),n.d(t,"l",(function(){return p})),n.d(t,"f",(function(){return r})),n.d(t,"g",(function(){return i})),n.d(t,"e",(function(){return o}))},,,,,,function(e,t,n){"use strict";var a=n(29),r=n(91),i=n(78),o=n(77),s=n(4),l=n(3),c=n(8),u=n(6),h=n(45),d=n(7),m=n(37),f=function(e){function t(e,n,a,r){var i;return Object(s.a)(this,t),(i=Object(c.a)(this,Object(u.a)(t).call(this,e,n))).secondsPerWater=a,i.waterRemaining=r,i.displayName="Fountain",i.isObstacle=!0,i.cooldown=0,i}return Object(d.a)(t,e),Object(l.a)(t,[{key:"shouldStep",value:function(e){return e>.1}},{key:"step",value:function(e){if(Object(h.a)(Object(u.a)(t.prototype),"step",this).call(this,e),this.cooldown>0&&(this.cooldown-=e),this.inventory.space()>1&&this.cooldown<=0&&this.waterRemaining>0)if(this.inventory.add(1,0),this.waterRemaining-=1,this.waterRemaining>0)this.cooldown=this.secondsPerWater;else{var n=new m.c(this.pos.clone(),this.world);this.inventory.give(n.inventory,this.inventory.water,this.inventory.sugar),this.world.maybeRemoveCellAt(this.pos),this.world.setTileAt(this.pos,n)}}}]),t}(m.c),v=n(98),p=n(48),y=n(50);n.d(t,"e",(function(){return y.b})),n.d(t,"a",(function(){return i.a})),n.d(t,"c",(function(){return o.a})),n.d(t,"d",(function(){return f})),n.d(t,"g",(function(){return v.a})),n.d(t,"h",(function(){return m.d})),n.d(t,"i",(function(){return p.a})),n.d(t,"b",(function(){return a.a})),n.d(t,"f",(function(){return r.a}))},,function(e,t,n){"use strict";n.d(t,"e",(function(){return a})),n.d(t,"g",(function(){return r})),n.d(t,"i",(function(){return i})),n.d(t,"h",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"o",(function(){return l})),n.d(t,"n",(function(){return c})),n.d(t,"m",(function(){return u})),n.d(t,"l",(function(){return h})),n.d(t,"d",(function(){return d})),n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return f})),n.d(t,"p",(function(){return v})),n.d(t,"c",(function(){return p})),n.d(t,"k",(function(){return y})),n.d(t,"j",(function(){return g}));var a=4.2,r=100,i=25,o=25,s=30,l=2160,c=l/4,u=c/3,h=u/3,d=.9,m=1,f=.13,v=6,p=40,y=.15,g=0},function(e,t,n){"use strict";var a=n(19),r=n(4),i=n(3),o=["Pentzia incana","Alnus","Alnus glutinosa","Ilex verticillata","Alnus glutinosa","Ilex verticillata","Alnus incana","Alnus incana","Ilex verticillata","Alnus incana","Alnus rhombifolia","Ilex verticillata","Prunus dulcis","Ambrosia trifida","Apocynum cannabinum","Brugmansia suaveolens","Malus domestica","Rhanterium epapposum","Cornus florida","Cornus florida","Fraxinus","Acer negundo","Fraxinus nigra","Fraxinus quadrangulata","Fraxinus americana","Fraxinus excelsior","Fraxinus pennsylvanica","Acer negundo","Fraxinus pennsylvanica","Fraxinus pennsylvanica","Fraxinus pennsylvanica","Fraxinus americana","Acer negundo","Fraxinus pennsylvanica","Azolla","Azolla caroliniana","Adansonia","Fabaceae","Phaseolus","Ilex decidua","Veratrum viride","Solanum dulcamara","Daucus carota","Daucus carota","Strelitzia reginae","Betula","Betula lenta","Betula nigra","Betula papyrifera","Betula papyrifera","Betula lenta","Betula pendula","Betula pendula","Betula alleghaniensis","Betula lenta","Betula papyrifera","Betula nigra","Betula nigra","Betula lenta","Betula papyrifera","Betula lenta","Betula lenta","Betula nigra","Betula pendula","Betula papyrifera","Betula pendula","Betula alleghaniensis","Barbarea vulgaris","Cardamine bulbosa","Cardamine hirsuta","Cardamine hirsuta","Solanum dulcamara","Solanum dulcamara","Ambrosia","Ambrosia artemisiifolia","Artemisia trifida","Helenium amarum","Rubus","Rubus pensilvanicus","Rubus occidentalis","Rubus hispidus","Rubus pensilvanicus","Rubus hispidus","Rubus occidentalis","Rudbeckia hirta","Rudbeckia fulgida","Viburnum prunifolium","Rudbeckia hirta","Ambrosia artemisiifolia","Hyacinthoides non-scripta","Allium caeruleum","Maclura pomifera","Buxus","Cornus florida","Acer negundo","Buxus","Cornus florida","Cornus florida","Solanum carolinense","Encelia farinosa","Plantago major","Rudbeckia hirta","Rudbeckia hirta","Rudbeckia triloba","Ambrosia trifida","Ajuga reptans","Asclepias syriaca","Asclepias tuberosa","Brassica oleracea","Symplocarpus foetidus","Symplocarpus foetidus","Symplocarpus foetidus","Lysichiton","Symplocarpus foetidus","Platanus racemosa","Asclepias tuberosa","Phytolacca americana","Daucus carota","Daucus carota","Ambrosia artemisiifolia","Plantago major","Lyonothamnus floribundus","Polygala calcarea","Sinapis arvensis","Prunus","Prunus serotina","Prunus serotina","Prunus serotina","Prunus serotina","Prunus avium","Prunus serotina","Prunus serotina","Asclepias tuberosa","Dendranthema grandiflora","vi","Chrysanthemum morifolium","Cinnamomum verum","Phytolacca americana","Coffea","Corydalis flavula","Symplocarpus foetidus","Aquilegia vulgaris","Sonchus oleraceus","Rudbeckia fulgida","Rudbeckia laciniata","Rudbeckia fulgida","Rudbeckia laciniata","Rudbeckia fulgida","Rudbeckia laciniata","Rudbeckia triloba","Rudbeckia triloba","Cornus amomum","Cornus amomum","Cornus florida","Cornus florida","Corydalis","Corydalis chelidoniifolia","Corydalis aurea","Corydalis flavula","Corydalis sempervirens","Corydalis sempervirens","Corydalis lutea","Corydalis flavula","Gossypium","Rorippa sylvestris","Barbarea verna","Barbarea verna","Barbarea verna","Barbarea verna","Cardamine bulbosa","Cardamine hirsuta","Barbarea verna","Cardamine hirsuta","Barbarea verna","Cardamine bulbosa","Barbarea verna","Cardamine concatenata","Daucus carota","Cardamine concatenata","Rudbeckia hirta","Bellis perennis","Lamium","Lamium amplexicaule","Lamium purpureum","Lamium maculatum","Veratrum viride","Clematis virginiana","Clematis virginiana","Daucus carota","Rubus hispidus","Rubus hispidus","Sonchus arvensis","Cornus","Cornus florida","Cornus florida","Cornus florida","Cornus kousa","Cornus kousa","Moringa oleifera","Cornus nuttallii","Cornus amomum","Cornus amomum","Veratrum viride","Solanum nigrum","Durio zibethinus","Durio testudinarius","Durio grandiflorus","Durio kutejensis","Durio dulcis","Ilex glabra","Cattleya schroederae","Veratrum viride","Sambucus","Lupinus elegans","Dillenia indica","Rudbeckia hirta","Eucalyptus","Vaccinium ovatum","Encalypta","Amphipappus","Achillea ptarmica","Azolla caroliniana","Solanum dulcamara","Solanum dulcamara","Solanum dulcamara","Foeniculum vulgare","Nephrolepis exaltata","Polystichum acrostichoides","Polypodium scouleri","Nephrolepis obliterata","Azolla caroliniana","Polystichum","Azolla caroliniana","Polystichum munitum","Ilex verticillata","Tanacetum parthenium","Myosotis arvensis","Ficus","Ficus carica","Linum usitatissimum","Phormium tenax","Phormium colensoi","Asclepias tuberosa","Digitalis purpurea","Corydalis flavula","Ilex glabra","Phytolacca americana","Allium moly","Allium canadense","Alliaria petiolata","Alliaria petiolata","Veronica chamaedrys","Hesperis matronalis","Hesperis matronalis","Hesperis matronalis","Hesperis matronalis","Hesperis matronalis","Tanacetum vulgare","Laburnum","Rudbeckia laciniata","Rudbeckia hirta","Achillea millefolium","Achillea ptarmica","Vitis","Solanum opacum","Rubus hispidus","Rubus hispidus","Sonchus arvensis","Curcuma domestica","Corydalis sempervirens","Corydalis flavula","Ambrosia artemisiifolia","Artemisia trifida","Plantago major","Maclura pomifera","Helleborus","Veratrum viride","Veratrum viride","Veratrum nigrum","Veratrum album","Veratrum album","Veratrum viride","Veratrum viride","Veratrum album","Veratrum viride","Cannabis","Cannabis sativa","Apocynum cannabinum","Plantago major","Barbarea vulgaris","Ambrosia artemisiifolia","Ilex","Ilex decidua","Ilex verticillata","Ilex aquifolium","Ilex glabra","Ilex decidua","Ilex decidua","Ilex verticillata","Lunaria annua","Ambrosia trifida","Solanum nigrum","Vaccinium","Vaccinium ovatum","Vaccinium parvifolium","Sempervivum tectorum","Apocynum cannabinum","Cannabis indica","Asclepias incarnata","Castilleja","Castilleja mutis","Asclepias tuberosa","Asclepias tuberosa","Ilex glabra","Phytolacca americana","Acacia estrophiolata","Coincya monensis","Veratrum viride","Hedera","Alliaria petiolata","Alliaria petiolata","Jasminum officinale","Ludisia discolor","Juncus kraussii","Adenanthos obovatus","Amelanchier canadensis","Rorippa sylvestris","Ptisana salicina","Cornus amomum","Veronica bullii","Reynoutria japonica","Cornus kousa","Pueraria montana","Pomaderris kumeraho","Daucus carota","Asparagus setaceus","Alchemilla mollis","Cardamine pratensis","Plantago major","Phoenicophorium","Magnolia splendens","Lavandula","Allium","Lilium catesbaei","Agapanthus praecox","Allium moly","Hesperis matronalis","Helianthella","Erigeron cavernensis","Clematis virginiana","Acer","Acer negundo","Acer nigrum","Acer saccharinum","Acer negundo","Acer negundo","Acer pensylvanicum","Acer negundo","Acer saccharinum","Acer saccharinum","Acer saccharinum","Acer saccharinum","Acer pensylvanicum","Acer saccharum","Acer barbatum","Acer leucoderme","Acer saccharinum","Acer saccharinum","Acer saccharinum","Prosopis","Prosopis glandulosa","Prosopis pubescens","Achillea millefolium","Asclepias","Sonchus oleraceus","Asclepias amplexicaulis","Asclepias syriaca","Asclepias verticillata","Asclepias tuberosa","Asclepias incarnata","Asclepias incarnata","Asclepias verticillata","Asclepias tuberosa","Sonchus oleraceus","Acer pensylvanicum","Solanum nigrum","Solanum opacum","Azolla caroliniana","Hesperis matronalis","Betula lenta","Morus","Morus rubra","Morus alba","Epacris longiflora","Asplenium flabellifolium","Urtica dioica","Solanum carolinense","Solanum carolinense","Solanum carolinense","Hylocereus","Phytolacca americana","Solanum americanum","Solanum dulcamara","Solanum nigrum","Solanum americanum","Solanum dulcamara","Solanum nigrum","Solanum nigrum","Solanum dulcamara","Solanum dulcamara","Solanum dulcamara","Trillium cernuum","Botrychium boreale","Achillea millefolium","Quercus","Quercus douglasii","Quercus macrocarpa","Quercus rubra","Quercus velutina","Quercus velutina","Quercus robur","Quercus canariensis","Quercus macrocarpa","Quercus rubra","Quercus robur","Quercus palustris","Quercus rubra","Quercus coccinea","Quercus coccinea","Quercus macrocarpa","Quercus petraea","Quercus coccinea","Quercus rubra","Quercus velutina","Quercus palustris","Quercus bicolor","Quercus palustris","Quercus bicolor","Quercus alba","Quercus velutina","Allium","Allium giganteum","Allium cernuum","Allium canadense","Allium canadense","Maclura pomifera","Maclura pomifera","Asclepias tuberosa","Maclura pomifera","Salix","Cornus","Cornus amomum","Pastinaca sativa","Daucus carota","Achillea ptarmica","Achillea ptarmica","Achillea ptarmica","Alliaria petiolata","Cardamine concatenata","Euphorbia peplus","Phytolacca americana","Platanus","Plantago major","Plantago major","Plantago major","Plantago major","Plantago major","Plantago major","Asclepias tuberosa","Phytolacca americana","Toxicodendron radicans","Solanum dulcamara","Solanum dulcamara","Phytolacca americana","Veratrum viride","Phytolacca americana","Phytolacca americana","Symplocarpus foetidus","Symplocarpus foetidus","Veratrum viride","Alliaria petiolata","Populus","Papaveraceae","Ilex decidua","Primula vulgaris","Daucus carota","Anthriscus sylvestris","Quercus velutina","Solanum carolinense","Ambrosia","Ambrosia artemisiifolia","Ambrosia trifida","Ambrosia trifida","Senecio","Senecio jacobaea","Senecio erucifolius","Senecio aquaticus","Senecio squalidus","Senecio cineraria","Daucus carota","Rubus","Rubus occidentalis","Rubus occidentalis","Cornus amomum","Cercis","Cercis siliquastrum","Phytolacca americana","Phytolacca americana","Apocynum cannabinum","Plantago major","Oryza sativa","Oryza glaberrima","Plantago major","Hesperis matronalis","Hesperis matronalis","Barbarea vulgaris","Barbarea vulgaris","Barbarea vulgaris","Rosa","Rosa multiflora","Rosa virginiana","Rosa virginiana","Rosa multiflora","Rosa virginiana","Rosa multiflora","Rosa virginiana","Achillea millefolium","Amelanchier alnifolia","Alliaria petiolata","Solanum dulcamara","Phytolacca americana","Rubus occidentalis","Corydalis aurea","Barbarea verna","Amelanchier","Amelanchier arborea","Amelanchier arborea","Amelanchier canadensis","Amelanchier canadensis","Amelanchier canadensis","Oncosiphon suffruticosum","Asclepias syriaca","Asclepias incarnata","Asclepias syriaca","Symplocarpus foetidus","Solanum dulcamara","Galanthus","Oxalis","Veronica arvensis","Veronica arvensis","Nardostachys jatamansi","Betula papyrifera","Cornus amomum","Ambrosia artemisiifolia","Allium cristophii","Ambrosia artemisiifolia","Arbutus unedo","Asclepias tuberosa","Asclepias syriaca","Achillea ptarmica","Achillea ptarmica","Amelanchier canadensis","Achillea millefolium","Viburnum prunifolium","Asclepias tuberosa","Asclepias syriaca","Ipomoea batatas","Ipomoea batatas","Sonchus oleraceus","Platanus","Platanus racemosa","Platanus occidentalis","Heritiera fomes","Excoecaria agallocha","Tanacetum vulgare","Achillea ptarmica","Ambrosia artemisiifolia","Camellia sinensis","Ilex glabra","Rubus occidentalis","Rudbeckia laciniata","Achillea millefolium","Achillea millefolium","Ambrosia artemisiifolia","Sonchus oleraceus","Cirsium arvense","Cirsium arvense","Cirsium arvense","Sonchus arvensis","Cirsium arvense","Cirsium arvense","Sonchus arvensis","Cirsium arvense","Cirsium arvense","Sonchus oleraceus","Sonchus oleraceus","Carduus nutans","Cirsium arvense","Cirsium arvense","Sonchus asper","Cirsium arvense","Sonchus asper","Sonchus asper","Sonchus arvensis","Sonchus arvensis","Cirsium arvense","Thymus","Thymus vulgaris","Veratrum viride","Nicotiana","Cardamine concatenata","Cardamine concatenata","Cardamine concatenata","Impatiens capensis","Impatiens pallida","Mimosa pudica","Cardamine hirsuta","Clematis virginiana","Solanum carolinense","Nicotiana glauca","Trillium","Asclepias tuberosa","Ocimum santalum","Hedyscepe canterburyana","Cyperus alternifolius","Vanilla","Koelreuteria paniculata","Mucuna pruriens","Viburnum","Viburnum prunifolium","Viburnum rhytidophyllum","Viola","Saintpaulia","Hesperis matronalis","Hesperis matronalis","Erythronium dens-canis","Solanum dulcamara","Scorzonera hispanica","Clematis virginiana","Clematis virginiana","Dracunculus vulgaris","Acacia","Acacia ammobia","Plantago major","Plantago major","Asclepias tuberosa","Apocynum cannabinum","Asclepias syriaca","Lambertia","Lambertia echinata","Lambertia ericifolia","Lambertia fairallii","Lambertia formosa","Lambertia formosa","Lambertia ilicifolia","Lambertia inermis","Lambertia multiflora","Lambertia orbifolia","Lambertia rariflora","Clematis virginiana","Salix","Salix exigua","Salix gooddingii","Cornus amomum","Cornus amomum","Asclepias tuberosa","Rubus phoenicolasius","Ilex verticillata","Ilex verticillata","Ilex glabra","Ilex verticillata","Barbarea vulgaris","Barbarea verna","Clematis virginiana","Argyreia nervosa","Ambrosia artemisiifolia","Corydalis sempervirens","Barbarea vulgaris","Achillea","Achillea millefolium","Achillea filipendulina","Achillea ptarmica","Achillea tomentosa","Rorippa sylvestris","Cladrastis lutea","Maclura pomifera","Echinacea paradoxa","Dioscorea","Camellia yunnanensis","Brachystegia spiciformis","Curcuma zedoaria"],s=n(5),l=n(13),c=n(60);n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return h})),n.d(t,"c",(function(){return d}));var u=function(){function e(t,n,a,i){Object(r.a)(this,e),this.blueprint=t,this.initialStateFn=n,this.stepFn=a,this.shouldStepFn=i}return Object(i.a)(e,[{key:"level",value:function(e){return new c.a(this,e)}}],[{key:"make",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m,l="function"===typeof n?n:function(){return Object(a.a)({},n)},c=new e(t,l,r,i),u=c.blueprint.name,d=h.has(u);if(d){var f=u+" "+Object(s.j)(o);console.warn("A gene named",u,"already exists! Renaming this one to",f),c.blueprint.name=f}return h.set(c.blueprint.name,c),c}}]),e}(),h=new Map,d={cantFreeze:!1,isReproductive:!1,isObstacle:!1,inventoryCapacity:0,costSugar:1,costWater:1,diffusionWater:0,diffusionSugar:0,timeToBuild:l.a,isDirectional:!1},m=function(e){return!0}},,function(e,t,n){"use strict";n(87);var a=n(113);n.d(t,"a",(function(){return a.GeneAttractsWater}));n(88);var r=n(114);n.d(t,"b",(function(){return r.GeneEnergyTransfer}));var i=n(115);n.d(t,"c",(function(){return i.GeneInventory}));var o=n(116);n.d(t,"d",(function(){return o.GeneLiving}));var s=n(117);n.d(t,"e",(function(){return s.GeneMetabolism}));var l=n(51);n.d(t,"f",(function(){return l.GenePhotosynthesis}));var c=n(118);n.d(t,"g",(function(){return c.GeneSoilAbsorption}));n(119)},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(162),r=n.n(a),i=n(163),o=n.n(i),s=n(1),l=s.memo((function(e){var t=e.name;return s.createElement("img",{alt:"",src:"sugar"===t?r.a:o.a,className:"resource-icon"})}))},function(e,t,n){"use strict";n.d(t,"r",(function(){return r})),n.d(t,"h",(function(){return i})),n.d(t,"o",(function(){return Z})),n.d(t,"p",(function(){return q})),n.d(t,"j",(function(){return J})),n.d(t,"m",(function(){return _})),n.d(t,"n",(function(){return $})),n.d(t,"t",(function(){return ee})),n.d(t,"k",(function(){return te})),n.d(t,"b",(function(){return ne})),n.d(t,"c",(function(){return ae})),n.d(t,"d",(function(){return re})),n.d(t,"q",(function(){return ie})),n.d(t,"f",(function(){return oe})),n.d(t,"g",(function(){return se})),n.d(t,"a",(function(){return ue})),n.d(t,"s",(function(){return he})),n.d(t,"i",(function(){return de})),n.d(t,"l",(function(){return me})),n.d(t,"e",(function(){return pe}));var a,r,i,o=n(164),s=n.n(o),l=n(165),c=n.n(l),u=n(166),h=n.n(u),d=n(167),m=n.n(d),f=n(168),v=n.n(f),p=n(169),y=n.n(p),g=n(170),b=n.n(g),w=n(171),A=n.n(w),O=n(172),k=n.n(O),E=n(173),j=n.n(E),x=n(174),C=n.n(x),S=n(175),P=n.n(S),M=n(176),T=n.n(M),R=n(177),N=n.n(R),F=n(178),D=n.n(F),B=n(179),I=n.n(B),L=n(180),V=n.n(L),z=n(181),W=n.n(z),G=n(182),H=n.n(G),U=n(183),Y=n.n(U),K=n(38),Q=n(2),X=n(102),Z=new K.Howl({src:V.a,autoplay:!1,loop:!0,volume:1}),q=(new K.Howl({src:D.a,autoplay:!1,loop:!0,volume:.3}),new K.Howl({src:N.a,autoplay:!1,loop:!0,volume:.15})),J=new K.Howl({src:[b.a],autoplay:!0,loop:!0,volume:0}),_=new K.Howl({src:[j.a],autoplay:!0,loop:!0,volume:0}),$=new K.Howl({src:C.a,volume:.5}),ee=new K.Howl({src:Y.a,volume:.2}),te=new K.Howl({src:A.a,volume:.3}),ne=new K.Howl({src:[c.a],volume:.1}),ae=new K.Howl({src:[h.a],volume:.5}),re=new K.Howl({src:[m.a],volume:.5}),ie=new K.Howl({src:[W.a]}),oe=new K.Howl({src:[k.a],volume:1}),se=new K.Howl({src:[v.a]}),le=new Q.AudioLoader;function ce(e){return new Promise((function(t,n){le.load(e,(function(e){t(e)}),(function(e){}),(function(e){Object(X.a)("An error happened"),n(e)}))}))}var ue=ce(s.a),he=ce(H.a),de=ce(y.a);function me(e){var t=0;function n(){3===++t&&(a.audio.currentTime=0,r.audio.currentTime=0,i.audio.currentTime=0,a.gain.connect(e.gain),r.gain.connect(e.gain),i.gain.connect(e.gain))}(a=ve(e,P.a)).audio.oncanplaythrough=n,a.gain.gain.value=.5,(r=ve(e,I.a)).audio.oncanplaythrough=n,r.gain.gain.value=0,(i=ve(e,T.a)).audio.oncanplaythrough=n,i.gain.gain.value=0}function fe(e){var t=e.substr(e.length-3),n=document.createElement("source");return n.src=e,n.type="audio/".concat(t),n}function ve(e){var t=document.createElement("audio");t.autoplay=!0,t.loop=!0;for(var n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];for(var i=0,o=a;i<o.length;i++){var s=o[i];t.appendChild(fe(s))}var l=e.createMediaElementSource(t),c=e.createGain();return l.connect(c),{audio:t,gain:c}}function pe(e,t){var n=e.pos.distanceToSquared(t.pos);return Math.min(1,1/(1+n/25))}},,,function(e,t,n){"use strict";var a=n(42),r=n(1),i=n.n(r);t.a=function(e){return i.a.createElement("span",{className:"gn"},i.a.createElement(a.a,e))}},function(e,t,n){"use strict";n.d(t,"d",(function(){return S})),n.d(t,"a",(function(){return M})),n.d(t,"b",(function(){return T})),n.d(t,"c",(function(){return R}));var a,r,i,o,s,l,c,u,h,d,m,f,v,p,y=n(27),g=n(4),b=n(3),w=n(28),A=(n(71),n(5)),O=n(10),k=n(2),E=n(33),j=n(100),x=n(60),C={"give water":"instant","give sugar":"instant","give water and sugar":"continuous","give water take sugar":"continuous","give sugar take water":"instant","take water":"continuous","take sugar":"continuous","take water and sugar":"continuous"};function S(e){var t,n=e.resources,a=e.type,r="".concat(a," ").concat(n);return null!==(t=C[r])&&void 0!==t?t:"instant"}var P=Object(O.b)({"*":!0}),M=(a=Object(O.k)(Object(O.h)(E.a)),r=Object(O.k)(Object(O.h)(j.a)),i=Object(O.k)(Object(O.h)(P)),o=function(){function e(t,n,a,r,i){Object(g.a)(this,e),Object(y.a)(this,"name",s,this),Object(y.a)(this,"geneSlots",l,this),Object(y.a)(this,"chromosome",c,this),Object(y.a)(this,"material",u,this),Object(y.a)(this,"interaction",h,this),this.args=void 0,this.name=t,this.geneSlots=n,this.chromosome=a,this.material=r,this.interaction=i,(null===a||void 0===a?void 0:a.getStaticProperties().isDirectional)&&(this.args={direction:new k.Vector2(0,-1)})}return Object(b.a)(e,[{key:"rotateArgDirection",value:function(){var e,t=null===(e=this.args)||void 0===e?void 0:e.direction;null===t||void 0===t||t.rotateAround(new k.Vector2,-Math.PI/4).setLength(1).round()}},{key:"isReproducer",value:function(){return this.chromosome.genes.some((function(e){return e.getStaticProperties().isReproductive}))}},{key:"getChanceToBecomeCancerous",value:function(){var e=this.chromosome.geneSlotsNet();return e<0?Object(A.a)(225e-6*Math.pow(1.3,Math.abs(e)),0,1):0}}]),e}(),s=Object(w.a)(o.prototype,"name",[O.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=Object(w.a)(o.prototype,"geneSlots",[O.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=Object(w.a)(o.prototype,"chromosome",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=Object(w.a)(o.prototype,"material",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=Object(w.a)(o.prototype,"interaction",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o),T=(d=Object(O.k)(Object(O.f)(Object(O.h)(M))),m=Object(O.k)(Object(O.f)(Object(O.h)(x.a))),f=function e(t,n){Object(g.a)(this,e),Object(y.a)(this,"cellTypes",v,this),Object(y.a)(this,"unusedGenes",p,this),this.cellTypes=t,this.unusedGenes=n},v=Object(w.a)(f.prototype,"cellTypes",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=Object(w.a)(f.prototype,"unusedGenes",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f);function R(e){var t=e.resources,n=e.type;return"".concat(n," ").concat(t)}},,,function(e,t,n){"use strict";var a=n(4),r=n(3),i=new(function(){function e(){var t=this;Object(a.a)(this,e),this.tickerId=1,this.tickers={},this._time=0,this.tickerLoop=function(e){t._time=e;var n=[];for(var a in t.tickers){!0===(0,t.tickers[a])(e)&&n.push(Number(a))}for(var r=0,i=n;r<i.length;r++){var o=i[r];t.removeAnimation(o)}requestAnimationFrame(t.tickerLoop)}}return Object(r.a)(e,[{key:"addAnimation",value:function(e){var t=this.tickerId++;return this.tickers[t]=e,t}},{key:"removeAnimation",value:function(e){return delete this.tickers[e]}},{key:"start",value:function(){requestAnimationFrame(this.tickerLoop)}},{key:"now",get:function(){return this._time}}]),e}());i.start(),t.a=i},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var a=n(2),r={nw:new a.Vector2(-1,-1),w:new a.Vector2(-1,0),sw:new a.Vector2(-1,1),n:new a.Vector2(0,-1),s:new a.Vector2(0,1),ne:new a.Vector2(1,-1),e:new a.Vector2(1,0),se:new a.Vector2(1,1)},i=Object.keys(r).map((function(e){return r[e]}))},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var a=n(9),r=n(4),i=n(8),o=n(24),s=n(6),l=n(45),c=n(3),u=n(7),h=n(36),d=n(34),m=n(2),f=n(13),v=n(26),p=n(55),y=n(101),g=n(35),b=n(77),w=n(98),A=n(37),O=n(48),k=n(50),E=n(22),j=function(e){function t(e,n,a,l){var c;Object(r.a)(this,t),(c=Object(i.a)(this,Object(s.a)(t).call(this,e,n))).type=a,c.energy=1,c.darkness=0,c.nextTemperature=void 0,c.droopY=0,c.effects=[],c.chromosome=void 0,c.geneInstances=void 0,c.inventory=void 0,c.staticProperties=void 0,c.args={direction:new m.Vector2(0,-1)},c.isDead=!1,c.chromosome=a.chromosome,c.staticProperties=c.chromosome.getStaticProperties();var u=c.staticProperties.inventoryCapacity;return c.inventory=new h.a(u,Object(o.a)(c)),(null===l||void 0===l?void 0:l.direction)&&c.args.direction.copy(null===l||void 0===l?void 0:l.direction),c.temperatureFloat=48,c.nextTemperature=c.temperatureFloat,c.geneInstances=c.chromosome.newGeneInstances(Object(o.a)(c)),c}return Object(u.a)(t,e),Object(c.a)(t,[{key:"displayName",get:function(){return this.type.name},set:function(e){}},{key:"isObstacle",get:function(){return this.staticProperties.isObstacle}},{key:"isReproductive",get:function(){return this.staticProperties.isReproductive}},{key:"diffusionWater",get:function(){return this.staticProperties.diffusionWater}},{key:"diffusionSugar",get:function(){return this.staticProperties.diffusionSugar}},{key:"timeToBuild",get:function(){return this.staticProperties.timeToBuild}},{key:"darknessContrib",get:function(){return 0}}]),Object(c.a)(t,[{key:"canPullResources",value:function(e){return e instanceof t}},{key:"getMovespeedMultiplier",value:function(){return this.tempo}},{key:"addEffect",value:function(e){(e.constructor.stacks||null==this.findEffectOfType(e.constructor))&&(this.staticProperties.cantFreeze&&e instanceof k.b||(e.attachTo(this),this.effects.push(e)))}},{key:"findEffectOfType",value:function(e){return this.effects.find((function(t){return t.constructor===e}))}},{key:"interact",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.effects[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;if(Object(y.a)(s)){var l=s.interact(e);if(null!=l)return l}}}catch(f){n=!0,r=f}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}var c=this.type.interaction;if(null!=c){var u=function(){switch(c.resources){case"water":return[1,0];case"sugar":return[0,1];case"water and sugar":return[1,1];case"sugar take water":return[-1,1];case"water take sugar":return[1,-1]}}(),h=Object(a.a)(u,2),d=h[0],m=h[1];return{type:"give"===c.type?"drop":"pickup",water:d,sugar:m,target:this,continuous:"continuous"===Object(E.d)(c)}}}},{key:"die",value:function(){this.world.setTileAt(this.pos,new b.a(this.pos,this.world))}},{key:"shouldStep",value:function(e){return e>.1}},{key:"findGene",value:function(e){return this.geneInstances.find((function(t){return t.isType(e)}))}},{key:"step",value:function(e){d.a.debug&&this.validateDirection(),Object(l.a)(Object(s.a)(t.prototype),"step",this).call(this,e);var n=this.world.tileNeighbors(this.pos);if(this.stepDroop(n,e),this.droopY>.5&&(this.pos.y<this.world.height-1?(this.world.player.pos.equals(this.pos)&&(this.world.player.posFloat.y+=1),this.world.maybeRemoveCellAt(this.pos),this.pos.y+=1,this.droopY-=1,this.world.setTileAt(this.pos,this)):this.droopY=.5),this.energy<=0)this.die();else{e=this.tempo*e,Math.random()<this.type.getChanceToBecomeCancerous()*e&&this.addEffect(new k.a);var a=!0,r=!1,i=void 0;try{for(var o,c=this.effects[Symbol.iterator]();!(a=(o=c.next()).done);a=!0){o.value.step(e)}}catch(u){r=!0,i=u}finally{try{a||null==c.return||c.return()}finally{if(r)throw i}}this.geneInstances.forEach((function(t){return Object(p.c)(t,e)}))}}},{key:"stepTemperature",value:function(e){var t=this.world.tileNeighbors(this.pos),n=Array.from(t.values()).map((function(e){return e.temperatureFloat}));if(this.nextTemperature=Object(g.b)(this.temperatureFloat,n,e),this.temperatureFloat<=32){var a=(this.temperature===g.a.Cold?.03:.3)*e;Math.random()<a&&this.addEffect(new k.b)}else if(this.temperatureFloat>=64){var r=Math.min(this.inventory.water,1),i=r*(this.temperature===g.a.Hot?.003:.3);Math.random()<i*e&&(this.inventory.add(-r,0),this.world.logEvent({type:"evaporation",tile:this}))}}},{key:"stepDroop",value:function(e,n){var a=e.get(v.a.s),r=e.get(v.a.sw),i=e.get(v.a.se),o=e.get(v.a.w),s=e.get(v.a.e),l=e.get(v.a.n),c=e.get(v.a.nw),u=e.get(v.a.ne),h=f.b;this.droopY+=h,this.energy<.5&&(this.droopY+=h);for(var d=0,m=[a,r,i];d<m.length;d++){var p=m[d];if(p instanceof w.a||p instanceof A.d)return void(this.droopY=Math.min(this.droopY,0));if(p instanceof t)return void(this.droopY=Math.min(this.droopY,p.droopY))}var y=[c,l,u,o,s,this].filter((function(e){return e instanceof t}));this.droopY=y.reduce((function(e,t){return e+t.droopY}),0)/y.length}},{key:"stepDarkness",value:function(e){return 0}},{key:"validateDirection",value:function(){if(this.staticProperties.isDirectional){var e=this.args.direction;(x(e.x)||x(e.y))&&console.error("build transport with fractional dir "+e.x+", "+e.y),(e.manhattanLength()<1||e.manhattanLength()>3)&&console.error("bad dir length",e)}}},{key:"tempo",get:function(){return this.temperatureFloat<=0?.5:this.temperatureFloat<=32?2/3:this.temperatureFloat<=64?1:this.temperatureFloat<=96?1.25:1.5}}]),t}(O.a);function x(e){return e%1!==0}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=new Map;function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2?arguments[2]:void 0,r="".concat(n,",").concat(t);return a.has(r)||a.set(r,new Intl.NumberFormat(void 0,{maximumSignificantDigits:t,minimumSignificantDigits:n,useGrouping:!0})),a.get(r).format(e)}},,function(e,t,n){"use strict";n.r(t),n.d(t,"GeneFruit",(function(){return h})),n.d(t,"GeneSeed",(function(){return d})),n.d(t,"reproducerGetPercentMatured",(function(){return v}));var a=n(36),r=n(44),i=n(17),o=n(5),s=n(1),l=n.n(s),c=n(14),u=n(13),h=c.b.make({name:"Fruit",levelCosts:[10,15,20,25,30],levelProps:{mpEarned:[3,4,5,6,7],neededResources:500,secondsToMature:2*u.m},static:{isReproductive:!0,timeToBuild:-1},description:m},(function(e,t,n){return{isMature:!1,committedResources:new a.a(t.neededResources,n)}}),(function(e,t){f(e,t)})),d=c.b.make({name:"Seed",levelCosts:[6,8,10,12,14],levelProps:{mpEarned:[.5,.75,1,1.25,1.5],neededResources:200,secondsToMature:u.l/2},static:{isReproductive:!0,timeToBuild:-1},description:m},(function(e,t,n){return{isMature:!1,committedResources:new a.a(t.neededResources,n)}}),(function(e,t){f(e,t)}));function m(e){var t=e.mpEarned,n=e.neededResources,a=e.secondsToMature;return l.a.createElement(l.a.Fragment,null,l.a.createElement("p",null,"Reproducer."),l.a.createElement("p",null,"Consumes ",n/2,l.a.createElement(i.a,{name:"water"})," and ",n/2,l.a.createElement(i.a,{name:"sugar"})," on this Cell to reach Maturity."," "),l.a.createElement("p",null,"On Maturity,"," ",l.a.createElement("b",null,"achieve ",l.a.createElement("span",{className:"reproduction"},"Survival"))," ","and earn ",l.a.createElement(r.a,{amount:t}),"."),l.a.createElement("p",null,"With constant feeding, matures in ",a," seconds."))}function f(e,t){var n=t.cell,a=t.state,r=t.props,i=r.mpEarned,s=r.neededResources,l=r.secondsToMature,c=a.committedResources;if(!a.isMature){!function(e,t,n,a,r){var i=a/r,s=Object(o.a)(a/2-n.water,0,i*e),l=Object(o.a)(a/2-n.sugar,0,i*e),c=t.inventory.give(n,s,l),u=c.water,h=c.sugar;u+h>0&&t.world.logEvent({type:"grow-fruit",cell:t,resourcesUsed:u+h})}(e,n,c,s,l),function(e,t,n,a,r){var i=a/r,s=t.inventory.water>0&&n.water>=a/2,l=t.inventory.sugar>0&&n.sugar>=a/2,c=s?Object(o.a)(t.inventory.water,0,i*e):0,u=l?Object(o.a)(t.inventory.sugar,0,i*e):0;(c>0||u>0)&&t.redistributeInventoryToNeighbors(c,u)}(e,n,c,s,l);var u=1===v(t);u&&(a.isMature=u,a.timeMatured=n.world.time,t.earnMP(n,i))}}function v(e){var t=e.state.committedResources;return Object(o.a)((t.sugar+t.water)/(t.capacity-1),0,1)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a,r,i,o=n(9),s=n(19),l=n(27),c=n(4),u=n(3),h=n(28),d=(n(71),n(10)),m=n(16),f=n(14),v=n(60),p=(a=Object(d.k)(Object(d.f)(Object(d.h)(v.a))),r=function(){function e(){Object(c.a)(this,e),Object(l.a)(this,"genes",i,this);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];this.genes=n}return Object(u.a)(e,null,[{key:"basic",value:function(){return new e(m.d.level(2),m.c.level(2))}}]),Object(u.a)(e,[{key:"getStaticProperties",value:function(){var e=Object(s.a)({},f.c),t=!0,n=!1,a=void 0;try{for(var r,i=this.genes[Symbol.iterator]();!(t=(r=i.next()).done);t=!0)for(var l=r.value,c=0,u=Object.entries(l.getStaticProperties());c<u.length;c++){var h=Object(o.a)(u[c],2),d=h[0],m=h[1];"boolean"===typeof m?e[d]=m:"number"===typeof m&&(e[d]=e[d]+m)}}catch(v){n=!0,a=v}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}return e}},{key:"newGeneInstances",value:function(e){return this.genes.map((function(t){return t.newInstance(e)}))}},{key:"has",value:function(e){return null!=this.genes.find((function(t){return t.gene===e}))}},{key:"isEmpty",value:function(){return 0===this.genes.length}},{key:"geneSlotsUsed",value:function(){return this.genes.map((function(e){return e.getCost()})).filter((function(e){return e>=0})).reduce((function(e,t){return e+t}),0)}},{key:"geneSlotsAdded",value:function(){return-1*this.genes.map((function(e){return e.getCost()})).filter((function(e){return e<0})).reduce((function(e,t){return e+t}),0)}},{key:"geneSlotsNet",value:function(){return this.geneSlotsAdded()-this.geneSlotsUsed()}}]),e}(),i=Object(h.a)(r.prototype,"genes",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r)},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(19),r=n(108),i={hud:!0,showGodUI:!1,showFPS:!1,debugPerf:!1,debug:!1},o=Object(a.a)({},i),s=Object(r.parse)(window.location.search);if(null!=s.params){var l=JSON.parse(s.params);Object.assign(o,l)}!function(){for(var e={},t=0,n=Object.keys(i);t<n.length;t++){var s=n[t],l=o[s];l!==i[s]&&(e[s]=l)}if(Object.keys(e).length>0){var c=Object(r.stringify)(Object(a.a)({},Object(r.parse)(window.location.search),{params:JSON.stringify(e)}));window.location.search=c}}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o}));var a,r=n(5);function i(e){return e<=0?a.Freezing:e<=32?a.Cold:e<=64?a.Mild:e<=96?a.Hot:a.Scorching}function o(e,t,n){var a=e,i=!0,o=!1,s=void 0;try{for(var l,c=t[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){a+=l.value}}catch(u){o=!0,s=u}finally{try{i||null==c.return||c.return()}finally{if(o)throw s}}return a/=t.length+1,Object(r.b)(e,a,Math.min(6*n,1))}!function(e){e.Scorching="Scorching",e.Hot="Hot",e.Mild="Mild",e.Cold="Cold",e.Freezing="Freezing"}(a||(a={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(4),r=n(3),i=n(89);function o(e){return Math.round(1e12*e)/1e12}var s=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(a.a)(this,e),this.capacity=t,this.carrier=n,this.water=r,this.sugar=i,this.events=void 0,this.validate()}return Object(r.a)(e,[{key:"isEmpty",value:function(){return 0===this.water&&0===this.sugar}},{key:"give",value:function(e,t,n){if(e===this)throw new Error("shouldn't give to self");if(0===t&&0===n)return{water:0,sugar:0};var a=t>0?Math.min(t,this.water):-Math.min(-t,e.water),r=n>0?Math.min(n,this.sugar):-Math.min(-n,e.sugar),i=o(a+r),s=e.space();return i>s&&(a=Math.floor(a/i*s),r=Math.floor(r/i*s)),0===a&&0===r||(this.change(-a,-r),e.change(a,r),this.events&&this.events.emit("give",e,a,r),e.events&&e.events.emit("get",this,a,r)),{water:a,sugar:r}}},{key:"on",value:function(e,t){this.events=this.events||new i.EventEmitter,this.events.on(e,t)}},{key:"off",value:function(e,t){this.events=this.events||new i.EventEmitter,this.events.off(e,t)}},{key:"set",value:function(e,t){this.water=0,this.sugar=0,this.add(e,t)}},{key:"add",value:function(e,t){var n=o(e+t),a=this.space();n>a&&(e=e/n*a,t=t/n*a),this.change(e,t),this.events&&this.events.emit("add",e,t)}},{key:"change",value:function(e,t){var n=o(this.water+e),a=o(this.sugar+t);this.validate(n,a),this.water=n,this.sugar=a,this.water<0&&(this.water=0),this.sugar<0&&(this.sugar=0),this.water+this.sugar>this.capacity&&(this.water>this.sugar?this.water=this.capacity-this.sugar:this.sugar=this.capacity-this.water)}},{key:"space",value:function(){return o(this.capacity-this.water-this.sugar)}},{key:"isMaxed",value:function(){return this.space()<1}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.water,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sugar,n=this.capacity;e<0&&console.warn("water < 0: ".concat(e)),t<0&&console.warn("sugar < 0: ".concat(t)),e+t>n&&console.warn("bad inventory: ".concat(e," water + ").concat(t," > ").concat(n," max"))}}]),e}()},function(e,t,n){"use strict";n.d(t,"d",(function(){return f})),n.d(t,"b",(function(){return v})),n.d(t,"c",(function(){return p})),n.d(t,"a",(function(){return y}));var a=n(24),r=n(4),i=n(3),o=n(8),s=n(6),l=n(45),c=n(7),u=n(36),h=n(48),d=n(5),m=n(78),f=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(n=Object(o.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(i)))).depth=1e3,n.isObstacle=!1,n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"canPullResources",value:function(e){return e instanceof t||e instanceof m.a}},{key:"interact",value:function(){return{type:"pickup",water:.1,sugar:.1,target:this,continuous:!0}}},{key:"shouldStep",value:function(e){return e>.2}},{key:"step",value:function(e){Object(l.a)(Object(s.a)(t.prototype),"step",this).call(this,e),this.stepEvaporation(e)}},{key:"stepEvaporation",value:function(e){var t=this.world.environment.secondsToEvaporate,n=this.inventory.water,a=n/t*Object(d.a)(Object(d.d)(this.depth,1,8,1,0),0,1);if(Math.random()<a*e){var r=Math.min(n,1);this.inventory.add(-r,0),this.world.logEvent({type:"evaporation",tile:this}),this.world.numEvaporatedSoil+=r}}},{key:"diffuseWater",value:function(e,n,a){if(!(this.pos.y<e.pos.y)&&!(e instanceof t&&e.inventory.water<=e.saturation))return Object(l.a)(Object(s.a)(t.prototype),"diffuseWater",this).call(this,e,n,a)}},{key:"stepGravity",value:function(e){var t=this.inventory.water-this.saturation;if(t>0){var n=this.fallAmount*e,a=this.world.tileAt(this.pos.x,this.pos.y+1);if(n>0&&null!=a&&a.canPullResources(this)){var r=Math.min(Object(d.h)(n),t);this.inventory.give(a.inventory,r,0)}}}},{key:"depthDiffusionFactor",get:function(){return 1+(this.depth-1)/10}}]),t}(h.a),v=function(e){function t(){var e,n;Object(r.a)(this,t);for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).displayName="Sand",n.inventory=new u.a(20,Object(a.a)(n)),n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"diffusionWater",get:function(){return 1/(3*this.depthDiffusionFactor)}},{key:"saturation",get:function(){return 0}},{key:"fallAmount",get:function(){return 1.5/this.depthDiffusionFactor}}]),t}(f),p=function(e){function t(){var e,n;Object(r.a)(this,t);for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).displayName="Silt",n.inventory=new u.a(10,Object(a.a)(n)),n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"diffusionWater",get:function(){return 1/(12*this.depthDiffusionFactor)}},{key:"saturation",get:function(){return 2}},{key:"fallAmount",get:function(){return.2/this.depthDiffusionFactor}}]),t}(f),y=function(e){function t(){var e,n;Object(r.a)(this,t);for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).displayName="Clay",n.inventory=new u.a(10,Object(a.a)(n)),n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"diffusionWater",get:function(){return 1/(100*this.depthDiffusionFactor)}},{key:"saturation",get:function(){return 5}},{key:"fallAmount",get:function(){return.05/this.depthDiffusionFactor}}]),t}(f)},,,,,function(e,t,n){"use strict";var a=n(9),r=n(1),i=n.n(r),o=n(25),s=n(30);t.a=function(e){var t=e.value,n=e.speed,r=void 0===n?.5:n,l=e.sigFigs,c=void 0===l?3:l,u=i.a.useState(t),h=Object(a.a)(u,2),d=h[0],m=h[1];return i.a.useEffect((function(){function e(){m((function(e){return Math.abs(e-t)<.005?(o.a.removeAnimation(n),t):e*(1-r)+t*r}))}e();var n=o.a.addAnimation(e);return function(){o.a.removeAnimation(n)}}),[t,r]),i.a.createElement(i.a.Fragment,null,Object(s.a)(d,c))}},,function(e,t,n){"use strict";var a=n(39),r=n(12),i=n.n(r),o=n(107),s=n(1),l=n.n(s),c=n(61),u=n(42);n(267);t.a=function(e){var t=e.amount,n=e.total,r=Object(a.a)(e,["amount","total"]),s=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",null,"Mutation Points (MP) provide new Genes, and are earned by building reproducer cells like Seeds or Fruit."),l.a.createElement("div",null,"MP refreshes every epoch."));return l.a.createElement(o.a,{placement:"top",overlay:s},l.a.createElement("span",Object.assign({},r,{className:i()("mp",r.className)}),l.a.createElement(u.a,{speed:.5,sigFigs:5,value:t}),null!=n?l.a.createElement(l.a.Fragment,null,"/",n):null,l.a.createElement(c.a,{className:"mp-icon"})))}},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(9),r=n(4),i=n(3),o=n(54),s=n(5),l=n(35),c=function(){function e(t,n){if(Object(r.a)(this,e),this.world=n,this.displayName="Tile",this.darkness=1/0,this.temperatureFloat=void 0,this.dtSinceLastStepped=0,this.inventory=void 0,this.timeMade=void 0,this.pos=void 0,this.pos=t.clone(),null==n)throw new Error("null world!");this.timeMade=n.time,this.temperatureFloat=this.world.weather.getCurrentTemperature()}return Object(i.a)(e,[{key:"temperature",get:function(){return Object(l.c)(this.temperatureFloat)}},{key:"diffusionWater",get:function(){return this.constructor.diffusionWater}},{key:"diffusionSugar",get:function(){return this.constructor.diffusionSugar}},{key:"fallAmount",get:function(){return this.constructor.fallAmount}},{key:"darknessContrib",get:function(){return Math.max(.2)}},{key:"age",get:function(){return this.world.time-this.timeMade}}]),Object(i.a)(e,[{key:"canPullResources",value:function(e){return this instanceof e.constructor||e instanceof this.constructor}},{key:"lightAmount",value:function(){return Math.sqrt(Object(s.a)(1-this.darkness,0,1))}},{key:"redistributeInventoryToNeighbors",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inventory.water,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.inventory.sugar;if(t=Object(s.a)(t,0,this.inventory.water),n=Object(s.a)(n,0,this.inventory.sugar),t>0||n>0){for(var a=this.world.tileNeighbors(this.pos),r=Array.from(a.values()).filter((function(t){return t.canPullResources(e)})),i=0;(t>0||n>0)&&r.length>0&&i<100;){Object(o.a)(r);for(var l=0;l<r.length;l++){var c=r[l],u=this.inventory.give(c.inventory,Object(s.a)(t,0,1),Object(s.a)(n,0,1)),h=u.water,d=u.sugar;if(t-=h,n-=d,c.inventory.isMaxed()&&r.splice(l,1),0===t&&0===n)break}i++}i>=100&&console.error("redistributeInventoryToNeighbors passed guard limit")}}},{key:"step",value:function(e){var t=this.world.tileNeighbors(this.pos);this.stepDarkness(t),this.stepDiffusion(t,e),this.stepTemperature(e),this.stepGravity(e)}},{key:"stepTemperature",value:function(e){this.temperatureFloat=this.world.weather.getCurrentTemperature()}},{key:"stepDarkness",value:function(e){var t=this.darkness,n=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=Object(a.a)(o.value,2)[1],c=l.darkness+l.darknessContrib;t=Math.min(t,c)}}catch(u){r=!0,i=u}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}this.darkness=t}},{key:"stepDiffusion",value:function(e,t){var n=!0,a=!1,r=void 0;try{for(var i,o=e.values()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;this.canPullResources(s)&&(null!=this.diffusionWater&&s.inventory.water>this.inventory.water&&this.diffuseWater(s,t),null!=this.diffusionSugar&&s.inventory.sugar>this.inventory.sugar&&this.diffuseSugar(s,t))}}catch(l){a=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}}},{key:"diffuseWater",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.diffusionWater,a=e.inventory.water-this.inventory.water,r=this.inventory.water>0||e.inventory.water>1;if(a>0&&r){var i=Math.min(a*n*t,a/2);e.inventory.give(this.inventory,i,0)}}},{key:"diffuseSugar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.diffusionSugar,a=e.inventory.sugar-this.inventory.sugar;if(a>1){var r=Math.min(a*n*t,a/2);e.inventory.give(this.inventory,0,r)}}},{key:"stepGravity",value:function(e){var t=this.fallAmount*e,n=this.world.tileAt(this.pos.x,this.pos.y+1);t>0&&null!=n&&n.canPullResources(this)&&this.inventory.give(n.inventory,Object(s.h)(t),0)}},{key:"toString",value:function(){return this.displayName+"("+this.pos.x+","+this.pos.y+")"}}]),e}();c.fallAmount=0},,function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return v}));var a=n(9),r=n(8),i=n(6),o=n(7),s=n(4),l=n(3),c=n(13),u=n(55),h=n(35),d=n(29),m=function(){function e(){Object(s.a)(this,e),this.timeMade=void 0,this.cell=void 0}return Object(l.a)(e,[{key:"attachTo",value:function(e){this.cell=e,this.timeMade=this.cell.world.time,this.onAttached()}},{key:"onAttached",value:function(){}},{key:"remove",value:function(){var e=this.cell.effects.indexOf(this);this.cell.effects.splice(e,1)}},{key:"age",get:function(){return this.cell.world.time-this.timeMade}}]),e}(),f=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(n=Object(r.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(o)))).secondsToDie=c.l,n.percentFrozen=.25,n.chunkCooldown=0,n}return Object(o.a)(t,e),Object(l.a)(t,[{key:"interact",value:function(e){return{type:"thaw",target:this}}},{key:"thaw",value:function(e){this.chunkCooldown<=0&&(this.chunkCooldown+=.5,this.percentFrozen-=15/this.secondsToDie*.5,this.percentFrozen<.02&&(this.percentFrozen=0),this.cell.world.logEvent({type:"thaw",where:this.cell})),this.onFrozenChanged()}},{key:"step",value:function(e){throw this.chunkCooldown>0&&(this.chunkCooldown-=e),this.cell.temperature===h.a.Cold?this.percentFrozen+=1/this.secondsToDie*e:this.cell.temperature===h.a.Freezing&&(this.percentFrozen+=10/this.secondsToDie*e),this.onFrozenChanged(),this.cell.energy-=e/this.secondsToDie,new u.a}},{key:"onAttached",value:function(){this.cell.energy-=.2}},{key:"onFrozenChanged",value:function(){this.percentFrozen>1?this.cell.die():this.percentFrozen<=0&&this.remove()}},{key:"timeUntilDeath",get:function(){return this.secondsToDie-this.age}}]),t}(m);f.displayName="Frozen",f.stacks=!1;var v=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(n=Object(r.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(o)))).secondsPerDuplication=12,n.timeToDuplicate=n.secondsPerDuplication,n}return Object(o.a)(t,e),Object(l.a)(t,[{key:"interact",value:function(e){return{type:"remove-cancer",target:this}}},{key:"removeCancer",value:function(e){this.timeToDuplicate+=4*e,this.timeToDuplicate>1.05*this.secondsPerDuplication&&this.remove()}},{key:"step",value:function(e){if(this.timeToDuplicate-=e,this.timeToDuplicate<0){var n=this.cell.world.tileNeighbors(this.cell.pos),r=!0,i=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=Object(a.a)(s.value,2)[1];if(c instanceof d.a&&!c.findEffectOfType(t)){c.addEffect(new t);break}if(c.world.player.canBuildAt(c)){var u=new d.a(c.pos,c.world,this.cell.type,this.cell.args);this.cell.energy/=2,u.energy=this.cell.energy,u.droopY=this.cell.droopY,c.world.setTileAt(u.pos,u);break}}}catch(h){i=!0,o=h}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}this.timeToDuplicate+=this.secondsPerDuplication}}}]),t}(m);v.displayName="Cancerous",v.stacks=!1},function(e,t,n){"use strict";n.r(t),n.d(t,"GenePhotosynthesis",(function(){return u}));var a=n(9),r=n(17),i=n(1),o=n.n(i),s=n(21),l=n(14),c=n(78),u=l.b.make({name:"Photosynthesis",levelCosts:[3,6,9,12,15],levelProps:{reactionChancePerSecond:[.0125,.025,.05,.1,.2]},description:function(e){var t=e.reactionChancePerSecond;return o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"Converts 2",o.a.createElement(r.a,{name:"water"})," into 1",o.a.createElement(r.a,{name:"sugar"}),"."),o.a.createElement("p",null,"Each neighboring Air provides a ",o.a.createElement(s.a,{value:100*t,sigFigs:3}),"% chance per second, scaled with sunlight."))}},{totalSugarProduced:0,averageConversionRate:0,averageChancePerSecond:0,sugarConverted:0,activeNeighbors:[]},(function(e,t){var n=t.cell,r=t.state,i=t.props.reactionChancePerSecond;r.averageConversionRate=0,r.averageChancePerSecond=0,r.sugarConverted=0,r.activeNeighbors=[];var o=n.world.tileNeighbors(n.pos),s=0,l=!0,u=!1,d=void 0;try{for(var m,f=o[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var v=Object(a.a)(m.value,2),p=v[0],y=v[1];y instanceof c.a&&(r.activeNeighbors.push(p),s+=1,h(e,y,n,i,r))}}catch(g){u=!0,d=g}finally{try{l||null==f.return||f.return()}finally{if(u)throw d}}s>0&&(r.averageConversionRate/=s)}));function h(e,t,n,a,r){var i=t.sunlight();r.averageConversionRate+=.5;var o=Math.min(n.inventory.water,2),s=a*i;o>0&&s>0&&n.world.logEvent({type:"collect-sunlight",leaf:n,air:t,numSunlight:s/.05*e*5});var l=s;if(r.averageChancePerSecond+=l,Math.random()<l*e&&o>0){var c=.5*o;n.inventory.add(-o,c),r.sugarConverted+=c,r.totalSugarProduced+=c,n.world.logEvent({type:"photosynthesis",cell:n,amount:c})}}},,function(e,t,n){"use strict";n.r(t),n.d(t,"GeneObstacle",(function(){return i}));var a=n(1),r=n.n(a),i=n(14).b.make({name:"Obstacle",levelCosts:[-4],levelProps:{},static:{isObstacle:!0},description:function(){return r.a.createElement(r.a.Fragment,null,"You may not walk on this Cell.")}},{},(function(){}))},function(e,t,n){"use strict";function a(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),t=e[a-=1],e[a]=e[n],e[n]=t;return e}n.d(t,"a",(function(){return a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return u}));var a=n(4),r=n(8),i=n(6),o=n(7),s=n(202),l=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(o.a)(t,e),t}(Object(s.a)(Error));function c(e){return"function"===typeof e.step}function u(e,t){var n=e.dtSinceLastStepped+t;if(e.shouldStep(n))try{e.step(n)}catch(a){if(!(a instanceof l))throw a}finally{e.dtSinceLastStepped=0}else e.dtSinceLastStepped=n}},,,,,function(e,t,n){"use strict";var a=n(27),r=n(4),i=n(3),o=n(28);n(71);function s(e,t){var n,a={};for(n in e){var r=e[n];a[n]=t(r,n)}return a}var l,c,u,h,d=n(5),m=n(10),f=n(14),v=n(99);n.d(t,"a",(function(){return p}));var p=(l=Object(m.k)(Object(m.c)((function(e){return e.blueprint.name}),(function(e){return f.a.get(e)}))),c=function(){function e(t,n){Object(r.a)(this,e),Object(a.a)(this,"gene",u,this),Object(a.a)(this,"level",h,this),this.gene=t,null!=n&&this.setLevel(n)}return Object(i.a)(e,[{key:"getStaticProperties",value:function(){var e=this;return s(this.gene.blueprint.static||{},(function(t){return Array.isArray(t)?t[e.level]:t}))}},{key:"getProps",value:function(){var e=this;return s(this.gene.blueprint.levelProps,(function(t){return"number"===typeof t?t:t[e.level]}))}},{key:"getCost",value:function(){return this.gene.blueprint.levelCosts[this.level]}},{key:"setLevel",value:function(e){this.level=Object(d.a)(e,0,this.gene.blueprint.levelCosts.length)}},{key:"newInstance",value:function(e){return new v.a(this.gene,this.getProps(),e)}}]),e}(),u=Object(o.a)(c.prototype,"gene",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=Object(o.a)(c.prototype,"level",[m.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c)},,function(e,t,n){"use strict";n.r(t),n.d(t,"GeneTransport",(function(){return c}));var a=n(17),r=n(5),i=n(1),o=n.n(i),s=n(21),l=n(29),c=n(14).b.make({name:"Transport",levelCosts:[2,3,4,5,6],levelProps:{secondsPerPush:[20,10,5,3,2]},description:function(e){var t=e.secondsPerPush;return o.a.createElement(o.a.Fragment,null,o.a.createElement("b",null,"Hold Shift to configure."),o.a.createElement("p",null,"Every ",o.a.createElement(s.a,{value:t,sigFigs:2})," seconds, give 1",o.a.createElement(a.a,{name:"water"}),"1",o.a.createElement(a.a,{name:"sugar"})," into the directed cell."),o.a.createElement("p",null,"Every ",o.a.createElement(s.a,{value:t,sigFigs:2})," seconds, take 1",o.a.createElement(a.a,{name:"water"}),"1",o.a.createElement(a.a,{name:"sugar"})," from behind."))},static:{isDirectional:!0}},(function(e,t){var n=t.secondsPerPush;return{didJustTransport:!1,cooldown:Object(r.f)(0,n)}}),(function(e,t){var n=t.cell,a=t.state,r=t.props.secondsPerPush;if(a.didJustTransport=!1,a.cooldown<=0){a.cooldown+=r;var i=n.world.tileAt(n.pos.x+n.args.direction.x,n.pos.y+n.args.direction.y);i instanceof l.a&&(a.didJustTransport=u(n,i,1,1));var o=n.world.tileAt(n.pos.x-n.args.direction.x,n.pos.y-n.args.direction.y);o instanceof l.a&&(a.didJustTransport=a.didJustTransport||u(o,n,1,1))}a.cooldown-=e}));function u(e,t,n,a){var r=e.inventory.give(t.inventory,n,a),i=r.water,o=r.sugar;return i>0||o>0}},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var a=n(4),r=n(3),i=function(){function e(t,n,r){Object(a.a)(this,e),this.x=t,this.y=n,this.z=r}return Object(r.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,n){return this.x*e+this.y*t+this.z*n}}]),e}(),o=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],s=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],l=.5*(Math.sqrt(3)-1),c=(3-Math.sqrt(3))/6,u=1/6,h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2147483647*Math.random();Object(a.a)(this,e),this.perm=new Array(512),this.gradP=new Array(512),this.octaveNum=6,this.octaveFalloff=.5,this.octaveMatrix2=[2*Math.cos(1),2*-Math.sin(1),2*Math.sin(1),2*Math.cos(1)],this.seed(t)}return Object(r.a)(e,[{key:"seed",value:function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?s[t]^255&e:s[t]^e>>8&255,this.perm[t]=this.perm[t+256]=n,this.gradP[t]=this.gradP[t+256]=o[n%12]}}}]),Object(r.a)(e,[{key:"simplex2",value:function(e,t){var n,a,r=(e+t)*l,i=Math.floor(e+r),o=Math.floor(t+r),s=(i+o)*c,u=e-i+s,h=t-o+s;u>h?(n=1,a=0):(n=0,a=1);var d=u-n+c,m=h-a+c,f=u-1+2*c,v=h-1+2*c;i&=255,o&=255;var p=this.gradP[i+this.perm[o]],y=this.gradP[i+n+this.perm[o+a]],g=this.gradP[i+1+this.perm[o+1]],b=.5-u*u-h*h,w=.5-d*d-m*m,A=.5-f*f-v*v;return 70*((b<0?0:(b*=b)*b*p.dot2(u,h))+(w<0?0:(w*=w)*w*y.dot2(d,m))+(A<0?0:(A*=A)*A*g.dot2(f,v)))}},{key:"octaveSimplex2",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.octaveNum,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveFalloff,r=0,i=e,o=t,s=1,l=0;l<n;l++){r+=this.simplex2(i,o)*s;var c=i*this.octaveMatrix2[0]+o*this.octaveMatrix2[1],u=i*this.octaveMatrix2[2]+o*this.octaveMatrix2[3];i=c,o=u,s*=a}return r}},{key:"simplex3",value:function(e,t,n){var a,r,i,o,s,l,c=(e+t+n)*(1/3),h=Math.floor(e+c),d=Math.floor(t+c),m=Math.floor(n+c),f=(h+d+m)*u,v=e-h+f,p=t-d+f,y=n-m+f;v>=p?p>=y?(a=1,r=0,i=0,o=1,s=1,l=0):v>=y?(a=1,r=0,i=0,o=1,s=0,l=1):(a=0,r=0,i=1,o=1,s=0,l=1):p<y?(a=0,r=0,i=1,o=0,s=1,l=1):v<y?(a=0,r=1,i=0,o=0,s=1,l=1):(a=0,r=1,i=0,o=1,s=1,l=0);var g=v-a+u,b=p-r+u,w=y-i+u,A=v-o+2*u,O=p-s+2*u,k=y-l+2*u,E=v-1+.5,j=p-1+.5,x=y-1+.5;h&=255,d&=255,m&=255;var C=this.gradP,S=this.perm,P=C[h+S[d+S[m]]],M=C[h+a+S[d+r+S[m+i]]],T=C[h+o+S[d+s+S[m+l]]],R=C[h+1+S[d+1+S[m+1]]],N=.6-v*v-p*p-y*y,F=.6-g*g-b*b-w*w,D=.6-A*A-O*O-k*k,B=.6-E*E-j*j-x*x;return 32*((N<0?0:(N*=N)*N*P.dot3(v,p,y))+(F<0?0:(F*=F)*F*M.dot3(g,b,w))+(D<0?0:(D*=D)*D*T.dot3(A,O,k))+(B<0?0:(B*=B)*B*R.dot3(E,j,x)))}},{key:"octaveSimplex3",value:function(e,t,n){for(var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveNum,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.octaveFalloff,i=0,o=e,s=t,l=n,c=1,u=0;u<a;u++)i+=this.simplex3(o,s,l)*c,o*=2,s*=2,l*=2,c*=r;return i}},{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,n){return(1-n)*e+n*t}},{key:"perlin2",value:function(e,t){var n=Math.floor(e),a=Math.floor(t);e-=n,t-=a,n&=255,a&=255;var r=this.gradP,i=this.perm,o=r[n+i[a]].dot2(e,t),s=r[n+i[a+1]].dot2(e,t-1),l=r[n+1+i[a]].dot2(e-1,t),c=r[n+1+i[a+1]].dot2(e-1,t-1),u=this.fade(e);return this.lerp(this.lerp(o,l,u),this.lerp(s,c,u),this.fade(t))}},{key:"perlin3",value:function(e,t,n){var a=this.gradP,r=this.perm,i=Math.floor(e),o=Math.floor(t),s=Math.floor(n);e-=i,t-=o,n-=s;var l=a[(i&=255)+r[(o&=255)+r[s&=255]]].dot3(e,t,n),c=a[i+r[o+r[s+1]]].dot3(e,t,n-1),u=a[i+r[o+1+r[s]]].dot3(e,t-1,n),h=a[i+r[o+1+r[s+1]]].dot3(e,t-1,n-1),d=a[i+1+r[o+r[s]]].dot3(e-1,t,n),m=a[i+1+r[o+r[s+1]]].dot3(e-1,t,n-1),f=a[i+1+r[o+1+r[s]]].dot3(e-1,t-1,n),v=a[i+1+r[o+1+r[s+1]]].dot3(e-1,t-1,n-1),p=this.fade(e),y=this.fade(t),g=this.fade(n);return this.lerp(this.lerp(this.lerp(l,d,p),this.lerp(c,m,p),g),this.lerp(this.lerp(u,f,p),this.lerp(h,v,p),g),y)}}]),e}()},,,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(4),r=n(3),i=n(8),o=n(6),s=n(24),l=n(7),c=n(36),u=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,l=new Array(r),u=0;u<r;u++)l[u]=arguments[u];return(n=Object(i.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(l)))).displayName="Dead Cell",n.isObstacle=!1,n.inventory=new c.a(0,Object(s.a)(n)),n}return Object(l.a)(t,e),Object(r.a)(t,[{key:"shouldStep",value:function(e){return e>.3}}]),t}(n(48).a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(4),r=n(3),i=n(8),o=n(6),s=n(24),l=n(7),c=n(69),u=n(5),h=n(36),d=function(e){function t(e,n){var r;return Object(a.a)(this,t),(r=Object(i.a)(this,Object(o.a)(t).call(this,e,n))).pos=e,r.displayName="Air",r.sunlightCached=1,r._co2=void 0,r.inventory=new h.a(6,Object(s.a)(r)),r.isObstacle=!1,r.darkness=0,r._co2=r.computeCo2(),r}return Object(l.a)(t,e),Object(r.a)(t,[{key:"interact",value:function(){return{type:"pickup",water:.1,sugar:.1,target:this,continuous:!0}}},{key:"shouldStep",value:function(e){return e>.06667}},{key:"computeCo2",value:function(){var e=Object(u.d)(this.pos.y,this.world.height/2,0,this.world.environment.floorCo2,1.15),t=Math.max(1,Object(u.d)(this.pos.y,this.world.height/2,0,4,9)),n=null==this.world?0:this.world.time,a=.25*m.perlin3(94.231+(this.pos.x-this.world.width/2)/t,2312+this.pos.y/8,n/1e3+93.1);return Math.max(Math.min(e+a,1),Math.min(.4,.75*this.world.environment.floorCo2))}},{key:"lightAmount",value:function(){return this.sunlight()}},{key:"step",value:function(e){this.stepGravity(e),this.world.tileAt(this.pos.x,this.pos.y+1)instanceof t||this.stepDiffusionCheap(e),this.stepEvaporation(e),this.stepTemperature(e),this._co2=this.computeCo2()}},{key:"stepDiffusionCheap",value:function(e){var t=this.world.tileAt(this.pos.x-1,this.pos.y),n=this.world.tileAt(this.pos.x+1,this.pos.y);Math.random()<.5?(this.tryDiffuse(t,e),this.tryDiffuse(n,e)):(this.tryDiffuse(n,e),this.tryDiffuse(t,e))}},{key:"tryDiffuse",value:function(e,t){null!=e&&e.canPullResources(this)&&e.inventory.water<this.inventory.water&&e.diffuseWater(this,t)}},{key:"stepEvaporation",value:function(e){Math.random()<this.world.environment.airEvaporation*this.inventory.water*e&&(this.world.numEvaporatedAir+=1,this.inventory.add(-1,0),this.world.logEvent({type:"evaporation",tile:this}))}},{key:"co2",value:function(){return this._co2}},{key:"sunlight",value:function(){return this.sunlightCached}}]),t}(n(48).a);d.fallAmount=30,d.diffusionWater=1.5;var m=new c.a},,function(e,t,n){"use strict";n.r(t),n.d(t,"GenePipes",(function(){return s}));var a=n(26),r=n(17),i=n(1),o=n.n(i),s=n(14).b.make({name:"Pipes",levelCosts:[1,2,3,5,8],levelProps:{diffusionRate:[.025,.05,.1,.2,.4]},description:function(e){var t=e.diffusionRate;return o.a.createElement(o.a.Fragment,null,o.a.createElement("b",null,"Hold Shift to configure."),o.a.createElement("p",null,"Continuously equalize ",o.a.createElement(r.a,{name:"water"}),o.a.createElement(r.a,{name:"sugar"})," between nearby cells. Get ",o.a.createElement("b",null,100*t,"%")," closer every second."))}},(function(){return{connections:{n:!1,e:!1,s:!1,w:!1}}}),(function(e,t){var n,r=t.cell,i=t.props.diffusionRate,o=t.state.connections;for(n in o)if(o[n]){var s=a.a[n],l=r.world.cellAt(r.pos.x+s.x,r.pos.y+s.y);l&&(r.diffuseWater(l,e,i),l.diffuseWater(r,e,i),r.diffuseSugar(l,e,i),l.diffuseSugar(r,e,i))}}))},,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"GeneAttractsSugar",(function(){return l}));var a=n(9),r=n(1),i=n.n(r),o=n(21),s=n(29),l=n(14).b.make({name:"Attracts Sugar",levelCosts:[1,2,3,4,5],levelProps:{secondsPerPull:[20,10,5,3,2]},description:function(e){var t=e.secondsPerPull;return i.a.createElement(i.a.Fragment,null,"Every ",i.a.createElement(o.a,{value:t,sigFigs:2})," seconds, take 1 sugar from any neighboring Cell.")}},{cooldown:0},(function(e,t){var n=t.cell,r=t.state,i=t.props.secondsPerPull,o=n.world.tileNeighbors(n.pos);if(r.cooldown<=0){var l=!0,c=!1,u=void 0;try{for(var h,d=o[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var m=Object(a.a)(h.value,2)[1];if(m instanceof s.a)if(m.inventory.give(n.inventory,0,1).water>0)break}}catch(f){c=!0,u=f}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}r.cooldown+=i}r.cooldown-=e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneCannotFreeze",(function(){return a}));var a=n(14).b.make({name:"Cannot Freeze",levelCosts:[7],levelProps:{},static:{cantFreeze:!0},description:function(){return null}},{},(function(){}))},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var a=n(4),r=n(3),i=n(8),o=n(6),s=n(45),l=n(7),c=n(18),u=n(5),h=n(16),d=n(53),m=n(29),f=n(33),v=n(22),p=new f.a(h.d.level(2),d.GeneObstacle.level(0)),y=function(e){function t(e,n,r,s){var l;return Object(a.a)(this,t),(l=Object(i.a)(this,Object(o.a)(t).call(this,e,n,g))).completedCell=r,l.start=s,l.percentMatured=0,l.timeToMaturity=void 0,l.silent=void 0,l.timeToMaturity=r.type.chromosome.getStaticProperties().timeToBuild,l}return Object(l.a)(t,e),Object(r.a)(t,[{key:"step",value:function(e){if(Object(s.a)(Object(o.a)(t.prototype),"step",this).call(this,e),this.percentMatured+=this.tempo*e/this.timeToMaturity,this.completedCell.pos.copy(this.pos),this.percentMatured>=1){this.world.maybeRemoveCellAt(this.pos),this.completedCell.energy=this.energy;var n=!0,a=!1,r=void 0;try{for(var i,l=this.effects[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var h=i.value;this.completedCell.addEffect(h)}}catch(m){a=!0,r=m}finally{try{n||null==l.return||l.return()}finally{if(a)throw r}}if(this.world.setTileAt(this.pos,this.completedCell),!this.silent){var d=c.c.play();c.c.rate(d,Object(u.f)(.5,1))}}}}]),t}(m.a),g=new v.a("Growing Cell",0,p)},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(4),r=n(3),i=n(8),o=n(6),s=n(24),l=n(7),c=n(36),u=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,l=new Array(r),u=0;u<r;u++)l[u]=arguments[u];return(n=Object(i.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(l)))).displayName="Rock",n.isObstacle=!0,n.inventory=new c.a(0,Object(s.a)(n)),n}return Object(l.a)(t,e),Object(r.a)(t,[{key:"shouldStep",value:function(e){return e>.3}},{key:"darknessContrib",get:function(){return 1}}]),t}(n(48).a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(4),r=n(3),i=function(){function e(t,n,r){Object(a.a)(this,e),this.gene=t,this.props=n,this.cell=r,this.dtSinceLastStepped=0,this.state=void 0,this.state=t.initialStateFn(t,n,r)}return Object(r.a)(e,[{key:"blueprint",get:function(){return this.gene.blueprint}}]),Object(r.a)(e,[{key:"isType",value:function(e){return this.gene===e}},{key:"shouldStep",value:function(e){return this.gene.shouldStepFn(e,this)}},{key:"step",value:function(e){var t=this.gene.stepFn(e,this);void 0!==t&&(this.state=t)}},{key:"earnMP",value:function(e,t){e.world.earnMP(e,t)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(10),r=n(2),i=Object(a.b)({color:Object(a.h)(r.Color),texturePosition:Object(a.h)(r.Vector2)})},function(e,t,n){"use strict";function a(e){return"function"===typeof e.interact}n.d(t,"a",(function(){return a}))},function(e,t,n){"use strict";function a(e){}n.d(t,"a",(function(){return a}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneDiffuseWater",(function(){return s}));var a=n(17),r=n(1),i=n.n(r),o=n(21),s=n(14).b.make({name:"Diffuse Water",levelCosts:[0],static:{diffusionWater:[.08]},levelProps:{},description:function(e,t){var n=t.diffusionWater;return i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Continuously recieve ",i.a.createElement(a.a,{name:"water"})," from neighboring Cells with more."),i.a.createElement("p",null,"On average, get 1",i.a.createElement(a.a,{name:"water"})," every ",i.a.createElement(o.a,{value:1/n,sigFigs:3})," seconds."))}},{},(function(){}))},,,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"GeneAttractsWater",(function(){return l}));var a=n(9),r=n(1),i=n.n(r),o=n(21),s=n(29),l=n(14).b.make({name:"Attracts Water",levelCosts:[1,2,3,4,5],levelProps:{secondsPerPull:[20,10,5,3,2]},description:function(e){var t=e.secondsPerPull;return i.a.createElement(i.a.Fragment,null,"Every ",i.a.createElement(o.a,{value:t,sigFigs:2})," seconds, take 1 Water from any neighboring Cell.")}},{cooldown:0},(function(e,t){var n=t.cell,r=t.state,i=t.props.secondsPerPull,o=n.world.tileNeighbors(n.pos);if(r.cooldown<=0){var l=!0,c=!1,u=void 0;try{for(var h,d=o[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var m=Object(a.a)(h.value,2)[1];if(m instanceof s.a)if(m.inventory.give(n.inventory,1,0).water>0)break}}catch(f){c=!0,u=f}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}r.cooldown+=i}r.cooldown-=e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneEnergyTransfer",(function(){return l}));var a=n(9),r=n(1),i=n.n(r),o=n(21),s=n(29),l=n(14).b.make({name:"Energy Transfer",levelCosts:[1,3,4,5,7],levelProps:{differenceThreshold:[.08,.04,.02,.01,.005]},description:function(e){var t=e.differenceThreshold;return i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Give energy to neighboring Cells until they're within ",i.a.createElement(o.a,{value:100*t,sigFigs:3}),"% energy difference of this Cell."),i.a.createElement("p",null,"Gives up to ",100*c,"% energy per second."))}},{},(function(e,t){var n=t.cell,r=t.props.differenceThreshold,i=n.world.tileNeighbors(n.pos),o=!0,l=!1,c=void 0;try{for(var h,d=i[Symbol.iterator]();!(o=(h=d.next()).done);o=!0){var m=Object(a.a)(h.value,2)[1];!(m.pos.manhattanDistanceTo(n.pos)>1)&&m instanceof s.a&&u(e,n,m,r)}}catch(f){l=!0,c=f}finally{try{o||null==d.return||d.return()}finally{if(l)throw c}}})),c=.25;function u(e,t,n,a){var r=t.energy-n.energy;if(r>a){var i=Math.min(r-a,c*e);t.energy-=i,n.energy+=i,t.world.logEvent({type:"cell-transfer-energy",from:t,to:n,amount:i})}}},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneInventory",(function(){return o}));var a=n(1),r=n.n(a),i=n(21),o=n(14).b.make({name:"Inventory",levelCosts:[1,2,3,4,5],levelProps:{},static:{inventoryCapacity:[2,3,5,8,11]},description:function(e,t){var n=t.inventoryCapacity;return r.a.createElement(r.a.Fragment,null,"Capacity ",r.a.createElement(i.a,{value:n}),".")}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneLiving",(function(){return o}));var a=n(1),r=n.n(a),i=n(21),o=n(14).b.make({name:"Living",levelCosts:[-6,-8,-10,-12,-15],levelProps:{secondsPerUpkeep:[720,600,480,240,120]},description:function(e){var t=e.secondsPerUpkeep;return r.a.createElement(r.a.Fragment,null,"Burns 100% energy every ",r.a.createElement(i.a,{value:t})," seconds.")}},{},(function(e,t){var n=t.cell,a=t.props.secondsPerUpkeep;n.energy-=1/a*e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneMetabolism",(function(){return s}));var a=n(17),r=n(1),i=n.n(r),o=n(21),s=n(14).b.make({name:"Metabolism",levelCosts:[0,1,3,6,10],levelProps:{energyPerSugar:[.25,.5,1,1.5,2]},description:function(e){var t=e.energyPerSugar;return i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Convert 1",i.a.createElement(a.a,{name:"sugar"})," into ",i.a.createElement(o.a,{value:100*t,sigFigs:3}),"% energy."),i.a.createElement("p",null,"Starts below 95% energy. Restores ",100*l,"% energy per second."))}},{},(function(e,t){var n=t.cell,a=t.props.energyPerSugar,r=function(e,t){var n=1-e.energy;if(n<.05)return 0;return Math.min(n,l*t)}(n,e);r>0&&(r-=function(e,t,n){var a=Math.min(t/n,e.inventory.sugar);if(a>0){e.inventory.add(0,-a);var r=a*n;return e.energy+=r,r>0&&e.world.logEvent({type:"cell-eat",who:e}),r}return 0}(n,r,a))})),l=.25},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneSoilAbsorption",(function(){return c}));var a=n(9),r=n(11),i=n(17),o=n(1),s=n.n(o),l=n(21),c=n(14).b.make({name:"Soil Absorption",levelCosts:[4,6,8,10,12],levelProps:{secondsPerAbsorb:[20,10,5,3,2]},description:function(e){var t=e.secondsPerAbsorb;return s.a.createElement(s.a.Fragment,null,"Absorb 1",s.a.createElement(i.a,{name:"water"})," every ",s.a.createElement(l.a,{value:t})," seconds from neighboring Soil.")}},{cooldown:0,totalSucked:0,activeNeighbors:[]},(function(e,t){var n=t.cell,i=t.state,o=t.props.secondsPerAbsorb;i.cooldown<=0&&(i.activeNeighbors=[],i.totalSucked+=function(e,t){var n=t.world.tileNeighbors(t.pos),i=!1,o=0,s=!0,l=!1,c=void 0;try{for(var u,h=n[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=Object(a.a)(u.value,2),m=d[0],f=d[1];if(f instanceof r.h&&(e.push(m),!i)){var v=f.inventory.give(t.inventory,1,0).water;o+=v,v>0&&(i=!0)}}}catch(p){l=!0,c=p}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return o}(i.activeNeighbors,n),i.cooldown+=o),i.cooldown-=e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneVascular",(function(){return r}));var a=n(29),r=n(14).b.make({name:"Vascular",levelCosts:[1,2,3,5,8],levelProps:{diffusionRate:[.01,.05,.1,.2,.4]},description:function(e){var t=e.diffusionRate;return"Diffuses water to other Vascular cells with rate ".concat(t,".")}},{},(function(e,t){var n=t.cell,i=t.props.diffusionRate,o=Array.from(n.world.tileNeighbors(n.pos).values()).filter((function(e){return e instanceof a.a&&e.chromosome.has(r)})),s=!0,l=!1,c=void 0;try{for(var u,h=o[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value;n.diffuseWater(d,e,i)}}catch(m){l=!0,c=m}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}}))},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"GeneScaffolding",(function(){return s}));var a=n(1),r=n.n(a),i=n(14),o=n(21),s=i.b.make({name:"Scaffolding",levelCosts:[-2,-3,-4,-5,-10],levelProps:{},static:{timeToBuild:[3,4,5,6,11]},description:function(e,t){var n=t.timeToBuild;return r.a.createElement(r.a.Fragment,null,"This cell takes ",r.a.createElement(o.a,{value:n})," seconds longer to grow.")}},{},(function(){}))},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},,function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wwdEQIkKFbu2wAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA0UlEQVRYw2NgGAUjHTCSovjYTIb/xKizSifeXKZBGQK4fGppwEeUoccvfCI6ZAZXCMB8TqxPSQWwkEEOicERAkT7XL4Glf+wheKQGPAQYCFJNZk+HtTlAAtFcY1D3cePqOUAPz/fUAsBYuMahzp8Ph7aJSEpcTtkSkK85QDMxzCfEutjdH1Dtz1AbK1IyMfY4n7whMCzW/txSj7Y7/ifGi0ifG3EwR0CDAwMDFJqjvRrFX/+8GpgywFeATGq+WzI1AVMuIKdXtHBhCvYCUUHtQAAj7ZTZKkXht4AAAAASUVORK5CYII="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wwdECsv+gDCjwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAR0lEQVRYw2P8//8/w0ACJoYBBqMOYEEXkBY9TNNE8fS1LeNoFIw6YNQBow4YdcCoA0YdMOqAUQeMOmDUAYPKAYyjfcMR7wAAvzUKOwLggbEAAAAASUVORK5CYII="},function(e,t,n){e.exports=n.p+"static/media/Blop-Mark_DiAngelo-79054334.627c0e8b.mp3"},function(e,t,n){e.exports=n.p+"static/media/build.0e2001c4.mp3"},function(e,t,n){e.exports=n.p+"static/media/build_complete.9af6ac71.mp3"},function(e,t,n){e.exports=n.p+"static/media/deconstruct.e5356177.mp3"},function(e,t,n){e.exports=n.p+"static/media/drop_water.7ab1e6f0.mp3"},function(e,t,n){e.exports=n.p+"static/media/eating.e78fa644.mp3"},function(e,t,n){e.exports=n.p+"static/media/footsteps.636605b0.wav"},function(e,t,n){e.exports=n.p+"static/media/fruit-popOpen.5991698f.mp3"},function(e,t,n){e.exports=n.p+"static/media/impactSoft_medium_003.b8698323.mp3"},function(e,t,n){e.exports=n.p+"static/media/interact.848e9d20.mp3"},function(e,t,n){e.exports=n.p+"static/media/intro-bounce.6e8ea313.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-base.28ee2cbb.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-drums.1c82b4f4.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-overworld.62281b29.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-start.473c2a0e.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-strings.9f30639c.mp3"},function(e,t,n){e.exports=n.p+"static/media/mitodeath.207c4872.mp3"},function(e,t,n){e.exports=n.p+"static/media/sticky.6d27b20f.mp3"},function(e,t,n){e.exports=n.p+"static/media/suckwater.b0fe81fa.wav"},function(e,t,n){e.exports=n.p+"static/media/whoosh.fde62e78.mp3"},,,,,,,function(e,t,n){e.exports=n.p+"static/media/fruit.e136487f.png"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAACC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KD0UqkwAAAM1JREFUKBVjYBgowIjL4v50+/8wucKZB7GqwxCEadJSkYfpZbh25yGYjW4IimaQRpimSbL8cM15jz+C2SBDkA1ggqtAYiBrBAmj82FK4TbDbF2qowSWe/vxLUwNgzC/MJgdfeUe2Asw27HajKwRpAudDzMVq2aYJCGaepr5JSH+hfkRZjOMD5OHicMDDCSAHmgwRSAaPbBAYhjOBpmehQhokBowH91WkDiKzSABWAqztHUEccHg+OH9YBoWRVBhTM0wCZghID66JpgaimgAWfxCZhIsrg0AAAAASUVORK5CYII="},,,function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAFJklEQVRIS62We2xTVRzHv+e2ty0bfa223VMjMEjWTXyuBmOIsCiYIGCMRpYoiSYIGjSOmGE0gCSogcnDR0biwIQoCmqmLg4msP2xBLYYQmCj4GOKjLmue/Tlut3b3mPOvbT3di2tiTt/9fZ3ft/+fp/z7e9cgv+wpt4nFD7A9Bkl+bbn3SDshqriA/hDyJmTX7B7JSVn25XCZkOQ6YjdKyla2sEfzl0d25u1Qi0zzyflFJJKrv+VQZKLaYaguBs0le4DFteUQppWFS9wfujIzS1ZEKQEaa+5k9RGHhG7V1CcPZFiVrOoBPuqpuTn1/qNuPDQ3dCdU+PskJK5GS2roiqzo2230R19elnw7YUC6p8cJ2L34xQtP8pMtWJZGXZ13kFPBubKAkvMUTQOJABJpfBBtQFdgQI5XmcLYfmjg2nYMhhuPeaha0qikKZFtEcd+PqPsTSGa+c58ExFFJFoHB3RIuxceym7IO2x9BFvuJoJPuscg5MXcWCoGK3XxnG4JiZXtP6CCUxwc+kwAiKPowEH3n26nyRzszC0fH8maFl1KmiFw12IZYnr6IuK2HVZYbi1UkCN3Yjjo0WwOubgvrgfdfbQD6Q2/ETSGWnl0nPmhq5J+56OUbMcX2oN45fYNJqv8fLzhnIB1UWFOBUoTDFcZgltIQ9GmjIEaY/lC+INr2MtP1UcAp+I45uwC8cHRrFrnmKbRp9Bbnl9RRDBSYq2sENmmMxNa5n2WPzEG3YzwRfcAbh5EbsGS9F6fQKt90zKgqt7FYZvlg/BL/Jo8TuTDOXcTIY9ls9PBy3rToessDsLsFS6AV9UwHs+heEbCwR47Ca0jtlhsZvwgOTHcluYdVafnWGPZVtX1La9Y0xhyHx2ZVLAx38qgi9XCPAUFSLp0+XWEBPcTrzhHdkYniLecJ1sG/cECiHiSKgEx34fxUcLFdtsumSUW95YMYbxGPBt2Il31sgM5dyZDIeJN1zMBF90j8AlMyzDsZ9HcGKFiFW9JllUYXgDIyKPT/2uJEM5NwtDc/OZkHUD86G1yISH8TcuRwQ0XVVaZqvlfg5t43bMtRpRiwDqbMGDxBt5KTvDXuuezoi14aebDB+zhXA1No39A4oPN98u4AYpQTyujDPGeJkt0kRqQ1syGfZaL5La0F2s5eddo7Dp4zg4UY6vfgvgiEexTf15xTY6HYd6xwi+DLmxY/VFQm/mZrTMvmCCz7lGYdfHsX+oGMfPj0Bv06VaZoKvlg7LMbbYfzkVzHYFnO4op4yh2WbEEoxgU7+UNm2a79XjZNCKArMBkxEhtyDtMTdX91o2SII6/xoqRTT9qjB8/U4Be/8ygiY0t0TD0C3Hl3z0VftKqTSl3iGckcN3ixWGzDqE50BFNX6lcTh3y/MbnZTXMItHJOjNXApTYlKCrkB9ziuYrULtrZe3Qs+HZTQtwcCBCmpLMwWInoDGVYaEI6CaO4dU7S+jUiyRaokzcZjJMFeFGT8wv9FFeZvKJIPZPxJ0hWpcilFwc9RzYI7gDOrz7FfoOVCWZhNi5EA1rx7EQEA1viQ8ARVVhtARQOPL2a9wwVsuqp+r9RmFrkBlkohR6LTMpik4oxpn1bKqU9Nm1k+5ijHU2saogzStsZGBg5TLlzqS9t+efYaV29w0jdEUBWe6tc+oCBBl+MiLxgGi3hCY/Qq105Z9rm6uoJqXYuUtXGO7mfv7Nl7PPb6q9mbOw5zTZmueebhoZzHVMpnJiCYAol4xuJJP8P9W+C+xZd+qpRkU/AAAAABJRU5ErkJggg=="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5AIZCCQGAEitagAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAQOElEQVR4Xu3db4wkx1nH8V/Nrv9gn3MOjnBAJF5jFNlnFOOzkbAt5LETQIl4mxfI+FVeREQiUcw7hHRrwRsQEQhIJAshJAKKBEIoErENOcfrF3fOC3JH/txGEF+0jhHGCXZufZco8WWneNFdMz01XdPdM93TNVPfj3Senenq2V1r63meqq6uMerZv/zBh2xVmy7986O/V9WkU7993VFVk07df//9pqoNNtegqgGAzUUA2HAXL17UxYsXq5ohUQQAIGHbVQ3QL5e977jjjoqW09x5J0+elCQdHh7Oa45EUQEACYu+Avi/770pSXrH299W0bIbdx8/Jkm6cHilomU3XAY/d+7c1OuhisAf75P5MQ8VAJCw6CuAppm/7Yqhr8zvuAzuKgHHVQR+JRCqGIAyVABAwqKvAJpqK/PHxh/L+5neVQKM+dEEFQCQsI2rAFLhZ3p/9p/r/6iDCgBI2NpWAG6234lt7N/1+oFQxnfI/KiDCgBI2NpWALFrK/P7md7N9vtXAcj4WAQVAJCwta0AYhvzt82/m8/xV/iF1gP4Fr2rEJuNCgBIWPQVQNtr+xfV9ay+L3QdPzT2r7oHgHUBKEMFACQs+gqg78zvrCrzO6FMXfW6XwmQ+TEPFQCQsOgrAEyr2uvPrwTI/JiHCgBI2MZVALFcNehK3cxedRyQqACApG1cBbCpmR/oAhUAkLCNqwA2HWN7tIkKAEjY9v/81/O2qlGX/uEfP1fVpNQHfvUBSdIzX3hxqePvfOXx0uOr8tazV6uaAJ2hAgASZupWAJcvfWfq+U03/1SgZTPXXp/N2r/+vy9VtGyXqwxeedezkqTrb+xnOuShz70lSbr5OlPRshsP/tV/9vONEQUqACBhK0t7roJoq3Joy7KZ/9afvWnq+Wv/fTnQstyymf+OX59e93DxX6d3SwbmoQIAElY7/S2buZc9f1VuuvlaSdLlS29Nvf7D7/9YUnsVQ6hSOHYsO37lyvTxSz/KpmqWrRiuuWdLknT1K0cVLZECKgAgYcF0FuuYvWt+5ndCmT+UyV3F4Ljzq+YI/MzvhDJ/aMzvKgbHnU/mRxEVAJCwYAXQNPN3tU4gVqG5glVhLI82UAEACVtuSjthVZl/2asFVaoy/7JXC5AGKgAgYa2lqUXH/H/3mc9Imtydtyru+/3tK6dLj/uz+E7Xmd3xZ/EdMjvaRAUAJGyczvxZfGfRzF7Xbz2e3Y/f192AunN+u6b8FYPuaoFTNXewLH/FoFtZ6ITWGSBNVABAwpYe0DZdMdi0/bpZ1RxBCHMEaIIKAEjY0umqaSZv2r4voUxedTefb9ExfyiTh+4WDKnbDmmiAgASNk5z65KZ++Zn/tBdf7629hMI7RPghCqHtvYTwGahAgAS1jgd1b3rb1Nm+9vK3Iue31bmXvZ8bCYqACBhM2mprcy97PmxqMrcVceX3TegKnNXHXe7BrNbMMpQAQAJm0lfVZm76vi6WzZj+5q+T9sZu633wWaiAgASttjUdAdueefPVzWZ4vYRcHcTNj0ulX9qcNOM3TYyNlaJCgBIWKOLw+87eaLWJwk/d26/9vt++Mz5Wu/Zlb9+6N7aPyuwaRpWAPQVYJPMnQMoZnyjkf7tU++WMZMgYM88LWONtC/JTBL5o+aEHRTy+ol77tJf/M0/ET2AyNSfBLQDSVayk35sBpKO8p5ujY6M1ZaRBl5Rb3ot8jfPn37k4dL/o5946gWCLBqZCQCP3HfCDvJO/oVPvXtywBjJWI1GRoOzn5ckWUlmS9KJ7NjWfvba6ZP7U+/51csHunDyTitt6blzF9b2j/TsU6oVyh78CGMlrIeZAFDM3sVyX1Ke/UeT48qfFlJ8ONsPNKIUWIif8R/4lUfK22k6QFERoMo4AGSZX3r207drWyONrGRt9vdkzj4zPsFYE5wLHN0lDUxeGVgj+4aVeU1677Ef6PS9WVXwfpvNKzS5UrCIu48fkyRdOLxS0TLMz/gP/OLbQk2nnH3qzanzqAgQq3EAcJl/yx7JyshIMnYgDaxs8e833P9lTFYkmCwCTFUDI/pAYy7z+xn/07eUNtdHvXauIqASQMjMEMCY/MqgtbIvfl4aGJl6Q9+si7s5QUnm7ddI77gqXZEG3673Hs6yGXzR86RJ5q+b8Q8Ps9V7x49n7f3zXEVAJYDYjAPAKJ+9tyMjY7Ykm22EYUbNOq5jJGnrav7ESLL5i/SBpg5f/ZYk6e9/4efmtnOVwWNf/9bcdoCz/ch92Zj8kx+/VQMZ2f2zstZooC2Zu385CwT7/171PvVY6ZPveVmS9Lu601obDgbLZPBF+Znfz+wh/vFQRUAlgNhsu7H/ve/5CUmSPfM9ZVnaSjf/UvDERd1zo+vYA/kXGZDxx/7+mP/1w9dnzpGkW45nDV2l8NGfzh6ZC0BIcCHQyBgNLr2R9CqeUGYPHa96HYhNMAAYa6ULX8pn80Kt0CU39tctWSYPZX7HHXeVwPh8IGBbkn6cT9276/7WWg1cp0+g89ed9V82szMXgNhsZ/8ZSGeeHv81MjYH0lD/ZqBILLs+oJbbfn/6+ct/2Khd3bkCoG8DKc/4D/6G9NAHZWsv+wGw7rYlaTQaSeZIkpE1VhrFOwzoNPM7oYzvC7Qj42NdbEvSlhnInnlGRtLA5kEA0XGz+1XrAIC6sgpAhcl+Y5maDqk7NwCsiW13W67bxuv04/uyo+Wv/lkZ6btW5rvK1hLkGwq9//wJSZPbgT8sphx8bsWeWxH4WP76n7/rePAcaVIZfOyVQ0nS/kvZsmtWACJkfBVga5TdymtHkrUtzwEYG/WCInc93l2fD64HWDLjv/gf2dUBrv8jFuMA4O7LMWqh819QtpuQP5dArl+Ky+yhSsAdB+oaBwBjBjrKt/saGcnYmvsAjJTtF1pIatl5o0mHd0OA0eo2BllkvYBfCfiqVgo6LtP7yPyIzTgAnP7y143ktuwykqxOPza9uWepgWT2pan0Xvgz/+qVG/TEN3fGz59f401BV82fC3A+pttK27sxv8PYH1XWbiVgXU0yvy+UqUOVgY9Mj3UxEwCKm3V+4tad8R+8NSP92aPfnp7Iezkf5483Asw88c3pDNX1BqCbzs/kfC4A2jK3AvjKazeOvzYDyZotSUeT176fDRX8yb7zV27Q1vhTx2olzbVAZsemmRsABsXOO5K+9toNKn4ugN6UJvcNT2y5HYXQCTI92jI3APil+xNq/9OBAfSHTwcGEmas2waoJ2bm88eac79DG+8FpKRhBRAfa+2pqjYAykUbAKy1p2ymbgffrWoAYNrGLgTaZNbaYf7lUNKef9wYM/MaUCbqOYDCz7ZrjHlyXptNH//nnX5Y0cy3RzDAPLEHgFPKS/tQOzdECAUIv22ddrGx1u6WvLyT/zsoOVZ8jSCAoKgDgDQJAlXtqtSpJmJU6Pw7+b+6DjQJBAQBlIo+ACzL//26/n5t8jL/0Du8Z60dSTO/k5H0cP54kP8jAKDURk8CFq8grFPHl4Kdv/ia5o2eJD2iScUwtNYyOYgZUVwGtNklv7qX+5paeviwaoHOvzfTMOwFzbYf2snVA0BSBEMAZVltt/h8ncboXSgEgGHh5V01N8z/HeT/ZIzZDTVGenqvAPLOvqvJH7h7TFIhS+8UXt6daViPC+474xeoAlAQxRyAy/j9FyNRGOaPO/njbmmrel5QNhk4VPiSIRIWRQBwKP07zc47ygLAUM3mE7DBeh8CYMowf9zJH58vb9bIniYdfkfqPNBgjURVAXQldIWhjYrDWvshZR3rj1u82rCTP74wr9EShqIKgBIIALawnLjEQgEgdOXEWmsXDQIdZ+VhVQOkaeMDgDHmybYnF4udPK8Abpf0R4t2fim7g6/jICBxKRCe3tcBLNNpNo311v1ba583xiw7DNjNHw9EAIAnuknAjlcFxm6v+KTl2Hgg0fkxLZohQMlYfaHx+YZZNgLs5o8Hc9ogYb0HgLIhSKrDgsI8wIGyYcAwP7RXesJ8w8LXBxLZH7OiGgKYXFW7uuzEOg4pDvLHoRabxR/mj3veIzDWewAwBVVtF7DrHtcoCOzljwdaPAg87L9guBUYJdbmKoBdcDsvb25hLe40tNP7/+1o+sagPffFaDS6OhgMrnGn5Y/D/NEU2rIhCEqtRQBwP2OobVVwKAaBOt8vBhVBoK49ibE/wqIPAMWfr6xtoXOvRXZvwgsCzs5Mw2kH3nOyP4J6vwpQV1Wg2EQmuyoglczo10XnxzxRVwCFn21udq8aImwKW3OpMJ0etdme1fnZ5rXJ253Km67LTD8Qhd4vA9awW9UAwIJK0/IKVf18dVmyP9BYozFznQ7b1Tj8fSdPVH7vkOfO7XfyMwHrrtZVgDod3ym27SoYAGjH3ADQpOOXcecvGgiKWf/XbvvhvKYVsvehEgCmlQaAZTu+b9lAAKAbM1cB2u78RXXe2+Sq2rVhVd8HiNVUBVCngy7L2vkbZ1prrSv9i2X/7/zJX4ZO0Utffjp4TJL0WXd8MqRgOABEsA6gryxsjBmsIuABMRtXAKvsDGVVQNmE37ysL5Vn/mc+O/vaB37zg9kXU8fuOpKoBJC23iuAPBhsVbUD0L6BtNrs73jf8yeDDQF0ptZCoC61PuFXomxYAEDqdSKsz+8NIIIKoMwiWb6Or70R5a8L9Kb3SUAA/SEAAAmLsiZ2k3bj6/cV7apQ+gPlqACAhEWdGosZvqoa8JVl/VcvT1774vlv3Cfp0kwjICFRB4AuWWvPVbUBNh1DACBh28aY3j4bwBhj6u711/aEnzHmemvtMtsMAWsv5QpgVNUA2HT10uWac5N/Xzz/jdslXSfpdUlX550DpGBbykrxVQ8D+tgIxFp7UHzex+8NxCTlIQCQvPEQYJXZsK3sP2/Cz7vmf9xa+6bfZlW/LxCrVCoAxvtAiakUuooqwM/+kz352vkQkMKE389IulbSZUk/mncOkKqZGrrLINBW6V+HtfbV4vMufy9gXZUOol1HbavDrLLjA6ivVsdcNBAs2vHrrg4swzbfQH21FgI1qQgW7fQAVq9RZyUAAJulVmet0/HLEAyAuM3toH7Hf9I8GWo6dsqemnmNQADEqbRjFjt+nU4f4gcDAgEQl5kO2Vbn97lgQBAA4jHVGV3nb7PjFxEEgLikci8AgBLjTNx19neoAoB4TFUAXXd+AHEZSItf519GH98TwLSVzwFQZQDxMKsa+/uYCwD6t/IKAEA8CABAwggAQMIIAEDCCABAwggAQMIIAEDCCABAwqY2+1zVYiAWAQFxoAIAErbyAFC2ZyCAfgykSSm+ys5J+Q/0b+UVAIB4jAPAKjPyKr8XgLCZCqDLYUCX7w2gObYFBxJW+cEgTtNgwCcEAfHjo8GAhNXqmItu4EnHB+LWqIPWCQR0egAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgLT8P1IQPjb/xbbMAAAAAElFTkSuQmCC"},,,,,,,,,,function(e,t,n){e.exports=n(333)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,function(e,t,n){var a={"./GeneAttractsSugar.tsx":87,"./GeneAttractsWater.tsx":113,"./GeneCannotFreeze.tsx":88,"./GeneCostly.tsx":330,"./GeneDiffuseSugar.tsx":331,"./GeneDiffuseWater.tsx":103,"./GeneEnergyTransfer.tsx":114,"./GeneInventory.tsx":115,"./GeneLiving.tsx":116,"./GeneMetabolism.tsx":117,"./GeneObstacle.tsx":53,"./GenePhotosynthesis.tsx":51,"./GenePipes.tsx":80,"./GenePushWater.tsx":332,"./GeneReproducer.tsx":32,"./GeneScaffolding.tsx":138,"./GeneSoilAbsorption.tsx":118,"./GeneTransport.tsx":62,"./GeneVascular.tsx":119};function r(e){var t=i(e);return n(t)}function i(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=i,e.exports=r,r.id=329},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneCostly",(function(){return o}));var a=n(17),r=n(1),i=n.n(r),o=n(14).b.make({name:"Costly",levelCosts:[-3,-4,-5,-6,-8],levelProps:{},static:{costSugar:[2,3,4,5,8],costWater:[2,3,4,5,8]},description:function(e,t){var n=t.costSugar,r=t.costWater;return i.a.createElement(i.a.Fragment,null,"This cell costs ",r,i.a.createElement(a.a,{name:"water"}),n,i.a.createElement(a.a,{name:"sugar"})," more to grow.")}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneDiffuseSugar",(function(){return o}));var a=n(1),r=n.n(a),i=n(21),o=n(14).b.make({name:"Diffuse Sugar",levelCosts:[0,1,2,3,5],static:{diffusionSugar:[.01,.02,.04,.08,.16]},levelProps:{},description:function(e,t){var n=t.diffusionSugar;return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Give sugar to neighboring Cells with less."),r.a.createElement("p",null,"On average, give 1 sugar every ",r.a.createElement(i.a,{value:1/n,sigFigs:3})," seconds."))}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GenePushWater",(function(){return l}));var a=n(9),r=n(1),i=n.n(r),o=n(21),s=n(29),l=n(14).b.make({name:"Push Water",levelCosts:[1,2,3,4,5],levelProps:{secondsPerPull:[20,10,5,3,2]},description:function(e){var t=e.secondsPerPull;return i.a.createElement(i.a.Fragment,null,"Every ",i.a.createElement(o.a,{value:t,sigFigs:2})," seconds, push 1 water from this Cell to each neighboring Cell.")}},{cooldown:0},(function(e,t){var n=t.cell,r=t.state,i=t.props.secondsPerPull,o=n.world.tileNeighbors(n.pos);if(r.cooldown<=0){var l=!0,c=!1,u=void 0;try{for(var h,d=o[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var m=Object(a.a)(h.value,2)[1];m instanceof s.a&&n.inventory.give(m.inventory,1,0)}}catch(f){c=!0,u=f}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}r.cooldown+=i}r.cooldown-=e}))},function(e,t,n){"use strict";n.r(t);n(206);var a=n(1),r=n.n(a),i=n(41),o=n.n(i),s=(n(211),n(106)),l=n(63),c=n(11),u=n(2),h=n(33),d=n(22),m=n(16),f=n(87),v=n(88),p=n(53),y=n(51),g=n(32),b=n(62),w=new d.a("Tissue",0,new h.a(m.d.level(2),m.c.level(3),m.e.level(2),m.b.level(1)),{texturePosition:new u.Vector2(1,1),color:new u.Color(3190309)},{type:"take",resources:"water and sugar"}),A=new d.a("Leaf",0,new h.a(m.d.level(2),m.c.level(3),p.GeneObstacle.level(0),y.GenePhotosynthesis.level(1),m.a.level(3)),{color:new u.Color("white"),texturePosition:new u.Vector2(2,1)},{type:"give",resources:"water take sugar"}),O=new d.a("Root",0,new h.a(m.d.level(2),m.c.level(4),p.GeneObstacle.level(0),m.g.level(2)),{color:new u.Color("white"),texturePosition:new u.Vector2(3,1)},{type:"take",resources:"water and sugar"}),k=new d.a("Transport",0,new h.a(m.d.level(3),m.c.level(3),b.GeneTransport.level(2),m.b.level(2)),{texturePosition:new u.Vector2(1,1),color:new u.Color(3190309)},{type:"take",resources:"water and sugar"}),E=new d.a("Fruit",0,new h.a(m.d.level(2),m.c.level(0),p.GeneObstacle.level(0),v.GeneCannotFreeze.level(0),g.GeneFruit.level(0),f.GeneAttractsSugar.level(1),m.a.level(1)),{texturePosition:new u.Vector2(0,2)},{type:"give",resources:"water and sugar"}),j=new d.b([w,A,O,k,E]),x=n(55),C=n(4),S=n(3);function P(e){return new Promise((function(t){setTimeout(t,e)}))}var M=n(89),T=n(34),R=n(13),N=n(36),F=function(){function e(t,n){Object(C.a)(this,e),this.posFloat=t,this.world=n,this.inventory=new N.a(R.g,this,R.i,R.h),this.action=void 0,this.events=new M.EventEmitter,this.baseSpeed=void 0,this.dtSinceLastStepped=0,this.baseSpeed=R.e}return Object(S.a)(e,[{key:"speed",get:function(){var e=this.currentTile();return this.baseSpeed*(e instanceof c.b?e.getMovespeedMultiplier():1)}},{key:"pos",get:function(){return this.posFloat.clone().round()}}]),Object(S.a)(e,[{key:"shouldStep",value:function(){return!0}},{key:"setAction",value:function(e){if(null!=this.action){if("long"===this.action.type)return;this.action={type:"multiple",actions:[this.action,e]}}else"build"===e.type&&e.cellType.chromosome.getStaticProperties().isReproductive?this.action={type:"long",duration:4.5,effect:e,elapsed:0}:this.action=e}},{key:"getAction",value:function(){return this.action}},{key:"droopY",value:function(){var e=this.world.tileAt(this.pos.x,this.pos.y);return e instanceof c.b?e.droopY:0}},{key:"droopPosFloat",value:function(){var e=this.droopY();if(0!==e){var t=this.posFloat.clone();return t.y+=e,t}return this.posFloat}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"findNearestWalkableCell",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,r=this.world.bfsIterator(this.pos,this.world.width*this.world.height)[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var i=a.value;if(this.isWalkable(i))return i}}catch(o){t=!0,n=o}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"step",value:function(e){if(!this.isWalkable(this.currentTile())){var t=this.findNearestWalkableCell();null!=t&&(this.world.logEvent({type:"oof",from:this.posFloat,to:t}),this.posFloat.copy(t.pos))}if(null!=this.action){var n=this.attemptAction(this.action,e);"long"===this.action.type?!0===n&&(this.action=void 0):this.action=void 0}}},{key:"attemptAction",value:function(e,t){var n=this._attemptAction(e,t);return T.a.showGodUI&&console.log(e),!0===n?this.events.emit("action",e):this.events.emit("action-fail",e,!1===n?void 0:n),n}},{key:"_attemptAction",value:function(e,t){switch(e.type){case"move":return this.attemptMove(e,t);case"build":return this.attemptBuild(e,t);case"deconstruct":return this.attemptDeconstruct(e,t);case"drop":return this.attemptDrop(e,t);case"pickup":return this.attemptPickup(e,t);case"multiple":return this.attemptMultiple(e,t);case"long":return this.attemptLong(e,t);case"thaw":return this.attemptThaw(e,t);case"remove-cancer":return this.attemptRemoveCancer(e,t)}}},{key:"isWalkable",value:function(e){var t=e instanceof u.Vector2?this.world.tileAt(Math.round(e.x),Math.round(e.y)):e;return t instanceof c.b&&!t.isObstacle&&(!(t instanceof c.b)||null==t.findEffectOfType(c.e))}},{key:"canBuildAt",value:function(e){return null!=e&&(!(e instanceof c.b)&&!e.isObstacle)}},{key:"isTakingLongAction",value:function(){return null!=this.action&&"long"===this.action.type}},{key:"attemptMove",value:function(e,t){var n=this.posFloat.clone().add(e.dir.clone().setLength(this.speed*t));return!!this.isWalkable(n)&&(this.posFloat.copy(n),!0)}},{key:"attemptStill",value:function(e){return!0}},{key:"attemptBuild",value:function(e,t){if(!this.canBuildAt(this.world.tileAt(e.position)))return!1;if(null!=this.world.cellAt(e.position.x,e.position.y))return!1;var n=e.cellType.chromosome.getStaticProperties(),a=n.costSugar,r=n.costWater,i=this.inventory.water<r,o=this.inventory.sugar<a;if(i&&o)return"Need water and sugar!";if(i&&!o)return"Need water!";if(o&&!i)return"Need sugar!";this.inventory.add(-r,-a);var s,l=new c.b(e.position,this.world,e.cellType,e.args);return null!=l&&((s=e.cellType.chromosome.getStaticProperties().timeToBuild?new c.f(e.position,this.world,l,this.currentTile().pos):l).droopY=this.droopY(),this.world.setTileAt(e.position,s),!0)}},{key:"attemptDeconstruct",value:function(e,t){if(!e.position.equals(this.pos)||e.force){var n=this.world.maybeRemoveCellAt(e.position);if(null!=n){if(n instanceof c.f){var a=n.completedCell.type.chromosome.getStaticProperties(),r=a.costSugar,i=a.costWater;this.inventory.add(i,r)}return n.inventory.give(this.inventory,n.inventory.water,n.inventory.sugar),!0}}return!1}},{key:"attemptDrop",value:function(e,t){var n=e.target,a=e.water,r=e.sugar;e.continuous&&(a*=R.f*t,r*=R.f*t);var i=this.inventory.give(n.inventory,a,r),o=i.water,s=i.sugar;return o>0||s>0}},{key:"attemptPickup",value:function(e,t){var n=e.target.inventory,a=e.water,r=e.sugar;e.continuous&&(a*=R.f*t,r*=R.f*t);var i=n.give(this.inventory,a,r),o=i.water,s=i.sugar;return o>0||s>0}},{key:"attemptMultiple",value:function(e,t){var n=!0,a=!0,r=!1,i=void 0;try{for(var o,s=e.actions[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;n=!0===this.attemptAction(l,t)&&n}}catch(c){r=!0,i=c}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return n}},{key:"attemptLong",value:function(e,t){return 0===e.elapsed&&this.events.emit("start-long-action",e),e.elapsed+=t,e.elapsed>e.duration&&this.attemptAction(e.effect,t)}},{key:"attemptThaw",value:function(e,t){return e.target.thaw(t),!0}},{key:"attemptRemoveCancer",value:function(e,t){return e.target.removeCancer(t),!0}}]),e}(),D=function(){function e(t,n,a){Object(C.a)(this,e),this.posFloat=t,this.world=n,this.player=a,this.inventory=new N.a(0,this),this.dtSinceLastStepped=0,this.poppedOut=!1}return Object(S.a)(e,[{key:"shouldStep",value:function(){return!0}},{key:"step",value:function(e){var t=this.pos;if(this.world.tileAt(t.x,t.y+1)instanceof c.a){var n=Math.min(20*e,1);this.posFloat.y+=n}this.player.posFloat.copy(this.posFloat),this.poppedOut&&this.world.removePlayerSeed()}},{key:"popOut",value:function(){var e=this,t=this.pos,n=new c.b(t,this.world,this.world.genome.cellTypes[0]),a=new c.f(t,this.world,n,t);a.silent=!0,this.world.setTileAt(t,a),Array.from(this.world.bfsIterator(t,30,(function(e){return!e.isObstacle&&e.pos.distanceTo(t)<2.5}),(function(e){return e.pos.distanceTo(t)}))).forEach((function(t,n){P(300).then((function(){var n=new c.b(t.pos,e.world,e.world.genome.cellTypes[0]);e.world.setTileAt(t.pos,n)}))})),this.poppedOut=!0}},{key:"pos",get:function(){return this.posFloat.clone().round()}}]),e}();function B(e){var t=Math.floor(e/R.o),n=e%R.o;return{year:t,season:Math.floor(n/R.n),percent:n%R.n/R.n,month:Math.floor(n%R.n/R.m)+1,day:Math.floor(n%R.m/R.l)+1}}var I=["Spring","Summer","Fall","Winter"];function L(e){return"".concat(e.year>0?"Year ".concat(e.year,", "):"").concat(I[e.season],", Month ").concat(e.month)}var V=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];Object(C.a)(this,e),this.dt=t,this.frame=n,this.deleted=a,this.added=r,this.events={"cell-eat":[],"cell-transfer-energy":[],evaporation:[],photosynthesis:[],thaw:[],"collect-sunlight":[],"grow-fruit":[],oof:[]}}return Object(S.a)(e,[{key:"logEvent",value:function(e){this.events[e.type].push(e)}}]),e}(),z=n(15),W=n(23),G=n.n(W),H=n(9),U=n(19);function Y(e,t){return new Array(e).fill(void 0).map((function(e,n){return"function"===typeof t?t(n):void 0===t?n:t}))}function K(e,t,n){return Y(e,(function(e){return Y(t,(function(t){return n(e,t)}))}))}var Q=n(37),X=n(5),Z=function(e,t){var n=t.generatorContext,a=n.noiseSoil,r=n.noiseWater,i=e.x,o=e.y,s=a.octaveSimplex2(i/10,o/10),l=new(s<-.37?Q.b:s<.37?Q.c:s<1?Q.a:c.g)(e,t),u=Object(X.a)(20*(r.simplex2(i/5,o/5)+.2>.4?s:0),1,20);return l.inventory.add(u,0),l},q={Level0:function(e,t){var n=t.generatorContext,a=n.noiseHeight,r=n.noiseWater,i=n.noiseRock,o=e.x,s=e.y,l=t.height/2-4*(a.perlin2(0,o/5)+1)/2-16*a.perlin2(10,o/20+10);if(s>l){var u=Object(X.d)(s-t.height/2,0,t.height/2,-.8,.3);if(i.simplex2(o/5,s/5)<u)return new c.g(e,t);var h=Math.pow(Object(X.d)(s-t.height/2,0,t.height/2,.5,1),2),d=r.simplex2(.2*o,.2*s)+.2;if(d>.8&&s-l>5)return new c.d(e,t,3,Object(X.d)(s,t.height/2,t.height,100,300)+Object(X.g)(-10,10));if(h*d>1){var m=Math.min(h*d,1);return new c.d(e,t,Math.round(3/m),Object(X.d)(s,t.height/2,t.height,100,300)+Object(X.g)(-10,10))}var f=new Q.c(e,t),v=Math.round(Object(X.a)(10*(d>.4?h:0)*3,1,10));return f.inventory.set(v,0),f}},Temperate:function(e,t){var n=t.generatorContext,a=n.noiseHeight,r=n.noiseWater,i=n.noiseRock,o=e.x,s=e.y,l=t.height/2-4*(a.perlin2(0,o/5)+1)/2-16*a.perlin2(10,o/20+10);if(s>l){var u=Object(X.d)(s-t.height/2,0,t.height/2,-.7,.3);if(i.simplex2(o/5,s/5)<u)return new c.g(e,t);var h=Math.pow(Object(X.d)(s-t.height/2,0,t.height/2,.5,1),2),d=r.simplex2(.2*o,.2*s)+.2;if(d>1&&s-l>5)return new c.d(e,t,3,Object(X.d)(s,t.height/2,t.height,100,300));if(h*d>1){var m=Math.min(h*d,1);return new c.d(e,t,Math.round(3/m),Object(X.d)(s,t.height/2,t.height,100,300))}var f=Z(e,t),v=Math.round(Object(X.a)(10*(d>.4?h:0),1,10));return f.inventory.set(v,0),f}},Desert:function(e,t){var n=t.generatorContext,a=n.noiseHeight,r=n.noiseRock,i=e.x,o=e.y,s=t.height/2-2*(a.perlin2(0,i/20)+1)/2-3*a.perlin2(10,i/100+10),l=Object(X.d)(o,t.height/2,t.height,-.8,-.4),u=r.simplex2(i/4,o/4)<l;if(o>s){if(u)return new c.g(e,t);var h=Z(e,t),d=Math.floor(Math.max(0,Object(X.d)(o,.75*t.height,t.height,1,9)));return h.inventory.set(d,0),h}},Rocky:function(e,t){var n=t.generatorContext,a=n.noiseHeight,r=n.noiseRock,i=e.x,o=e.y,s=.55*t.height-4*(a.perlin2(0,i/5)+1)/2-16*a.perlin2(10,i/20+10)-Object(X.d)(i,0,t.width,10,-10),l=o-6*(a.perlin2(0,i/25)+1)/2-20*a.perlin2(10,i/150+10)<.5*t.height?-1:-.15;if(r.simplex2(i/10,o/10)<l)return new c.g(e,t);if(o>s){var u=new Q.c(e,t);return u.inventory.add(2,0),u}},Reservoires:function(e,t){var n=t.generatorContext.noiseHeight,a=e.x,r=e.y,i=t.height/2-4*(n.perlin2(0,a/5)+1)/2-16*n.perlin2(10,a/20+10),o=Math.pow(Math.sin(a/4+r/30),2)+Math.pow(Math.cos(r/4),2)>1.2,s=Math.pow(Math.sin(a/4+(r+2)/30),2)+Math.pow(Math.cos((r+2)/4),2)>1.2;return o&&!s&&r+1>i?new c.g(e,t):r>i?Z(e,t):void 0},SkySoil:function(e,t){var n=t.generatorContext.noiseHeight,a=e.x,r=e.y,i=Math.pow(Math.sin(a/2.5+r/12),2)+Math.pow(Math.cos(r/2.5),2)+n.perlin2(a/4,r/26);if(i>1.2&&r>80-20*i){var o=new Q.c(e,t);return o.inventory.add(Math.floor(5*(i-1.1)),0),o}if(r>t.height/2*1.2-4*(n.perlin2(0,a/5)+1)/2-16*n.perlin2(10,a/20+10))return Z(e,t)}},J=n(102),_=n(54),$=n(26),ee=n(69);function te(e,t){var n=!0,a=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;e|=e<<7+Math.pow(s.charCodeAt(0),2)}}catch(l){a=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return e}function ne(e){return{seed:e,noiseHeight:new ee.a(te(e,"height")),noiseRock:new ee.a(te(e,"rock")),noiseWater:new ee.a(te(e,"water")),noiseSoil:new ee.a(te(e,"soil"))}}var ae=function(){function e(t){Object(C.a)(this,e),this.world=t}return Object(S.a)(e,[{key:"getCurrentTemperature",value:function(){var e=this.world.season.season;return this.world.environment.temperaturePerSeason[e]}},{key:"step",value:function(e){this.updateTemperatures(),this.computeSunlight(),this.stepWeather(e)}},{key:"stepWeather",value:function(e){var t=this.world;if((t.time+t.environment.climate.timeBetweenRainfall-6)%t.environment.climate.timeBetweenRainfall<t.environment.climate.rainDuration)for(var n=t.environment.climate.waterPerSecond*e;n>0;){var a=Math.min(n,1),r=Object(X.g)(0,t.width-1),i=t.tileAt(r,0);if(i instanceof c.a){var o=Object(X.h)(a);i.inventory.add(o,0),t.numRainWater+=o}n-=1}}},{key:"computeSunlight",value:function(){for(var e=this.sunAngle,t=Math.sin(e-Math.PI/2),n=this.sunAmount,a=0;a<=this.world.height;a++)for(var r=0;r<this.world.width;r++){var i=this.world.environmentTileAt(r,a);if(i instanceof c.a){var o=0;if(0===a)o=1;else{var s=this.world.tileAt(r,a-1),l=this.world.tileAt(r+1,a-1),u=this.world.tileAt(r-1,a-1),h=s instanceof c.a?s.sunlightCached/n:null==s?1:0,d=l instanceof c.a?l.sunlightCached/n:null==l?1:0,m=u instanceof c.a?u.sunlightCached/n:null==u?1:0;o=(o=t>0?d*t+h*(1-t):m*-t+h*(1- -t))*(1-R.j)+(h+d+m)/3*R.j}o=R.k+o*(1-R.k),o*=n,i.sunlightCached=o}}}},{key:"updateTemperatures",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,r=this.world.allCells()[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var i=a.value;i.temperatureFloat=i.nextTemperature}}catch(o){t=!0,n=o}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:"sunAngle",get:function(){var e=this.world.time/R.l%1;return e<R.d?e/R.d*Math.PI:Math.PI*(1+(e-R.d)/(1-R.d))}},{key:"sunAmount",get:function(){return Math.atan(12*Math.sin(this.sunAngle))/(Math.PI/2)*.5+.5}}]),e}(),re={width:50,height:100},ie=function(){function e(t,n,a){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(C.a)(this,e),this.environment=t,this.time=0,this.frame=0,this.width=void 0,this.height=void 0,this.player=void 0,this.playerSeed=void 0,this.gridEnvironment=void 0,this.gridCells=void 0,this.neighborCache=void 0,this.mpEarners=new Map,this.species=void 0,this.generatorContext=void 0,this.weather=void 0,this.genome=void 0,this.cachedEntities=void 0,this.stepStats=new V(0,this.frame),this.numRainWater=0,this.numEvaporatedAir=0,this.numEvaporatedSoil=0;var o=Object(U.a)({},re,{},i);this.width=o.width,this.height=o.height,this.generatorContext=ne(n),this.species=a,this.genome=a.genome,this.weather=new ae(this);var s="string"===typeof t.fill?q[t.fill]:t.fill;this.gridEnvironment=K(this.width,this.height,(function(e,t){var n=new u.Vector2(e,t);return s(n,r)||new c.a(n,r)})),this.gridCells=K(this.width,this.height,(function(){return null})),this.neighborCache=K(this.width,this.height,(function(e,t){return r.computeTileNeighbors(e,t)})),this.fillCachedEntities(),this.computeSoilDepths();var l=new u.Vector2(Math.floor(this.width/2),Math.floor(this.height/2)),h=this.gridEnvironment[l.x].find((function(e){return!(e instanceof c.a)}));null!=h&&(l.y=h.isObstacle?h.pos.y-1:h.pos.y),this.player=new F(l,this),this.playerSeed=new D(l,this,this.player),this.fillCachedEntities(),K(this.width,this.height,(function(e,t){var n=r.gridEnvironment[e][t];n&&n.step(0);var a=r.gridCells[e][t];a&&a.step(0)})),this.weather.step(0)}return Object(S.a)(e,[{key:"season",get:function(){return B(this.time)}}]),Object(S.a)(e,[{key:"removePlayerSeed",value:function(){this.stepStats.deleted.push(this.playerSeed),delete this.playerSeed}},{key:"tileAt",value:function(e,t){var n;if(e instanceof u.Vector2?(n=e.x,t=e.y):(n=e,t=t),!this.isValidPosition(n,t))return null;var a=this.gridCells[n][t];return null!=a?a:this.gridEnvironment[n][t]}},{key:"cellAt",value:function(e,t){return e instanceof u.Vector2&&(t=e.y,e=e.x),this.isValidPosition(e,t)?this.gridCells[e][t]:null}},{key:"environmentTileAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridEnvironment[e][t]:null}},{key:"setTileAt",value:function(e,t){var n=e.x,a=e.y;if(!this.isValidPosition(n,a))throw new Error("invalid position ".concat(n,", ").concat(a," "));t instanceof c.b&&t.isReproductive&&this.mpEarners.set(t,0);var r=this.tileAt(n,a);r.redistributeInventoryToNeighbors(),0===r.inventory.water&&0===r.inventory.sugar||(console.warn("lost",r.inventory,"resources to building"),r.inventory.add(-r.inventory.water,-r.inventory.sugar));var i=this.gridCells[n][a];if(null!=i&&this.stepStats.deleted.push(i),t instanceof c.b)this.gridCells[n][a]=t;else{this.gridCells[n][a]=null;var o=this.gridEnvironment[n][a];null!=o&&this.stepStats.deleted.push(o),this.gridEnvironment[n][a]=t}this.stepStats.added.push(t),this.handleTileUpdated(e)}},{key:"maybeRemoveCellAt",value:function(e){var t=this.cellAt(e.x,e.y);return t&&(t.redistributeInventoryToNeighbors(),this.gridCells[e.x][e.y]=null,this.stepStats.deleted.push(t),t.isDead=!0),this.handleTileUpdated(e),t}},{key:"isValidPosition",value:function(e,t){return!(e>=this.width||e<0||t>=this.height||t<0)}},{key:"tileNeighbors",value:function(e){return this.neighborCache[e.x][e.y]}},{key:"computeTileNeighbors",value:function(e,t){var n=this,a=new Map;return oe[this.frame%oe.length].forEach((function(r){var i=e+r.x,o=t+r.y,s=n.tileAt(i,o);null!=s&&a.set(r,s)})),a}},{key:"entities",value:function(){if(null==this.cachedEntities)throw new Error("accessed entities before filling");return this.cachedEntities}},{key:"handleTileUpdated",value:function(e){this.neighborCache[e.x][e.y]=this.computeTileNeighbors(e.x,e.y);var t=!0,n=!1,a=void 0;try{for(var r,i=$.b[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value,s=e.x+o.x,l=e.y+o.y;this.isValidPosition(s,l)&&(this.neighborCache[s][l]=this.computeTileNeighbors(s,l))}}catch(c){n=!0,a=c}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}this.fillCachedEntities()}},{key:"fillCachedEntities",value:function(){var e=[],t=0,n=0;for(t=0;t<this.width;t++)for(n=(t+this.frame)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));for(t=0;t<this.width;t++)for(n=(t+this.frame+1)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));this.frame%4<2&&e.reverse(),this.playerSeed?e.push(this.playerSeed):e.push(this.player),this.cachedEntities=e}},{key:"step",value:function(e){var t=this.entities();return this.stepStats=new V(e,this.frame),t.forEach((function(t){Object(x.b)(t)&&Object(x.c)(t,e)})),this.weather.step(e),this.frame++,this.time+=e,this.fillCachedEntities(),this.stepStats}},{key:"logEvent",value:function(e){this.stepStats.logEvent(e)}},{key:"getLastStepStats",value:function(){return this.stepStats}},{key:"computeSoilDepths",value:function(){var e=Array.from(this.allEnvironmentTiles()).filter((function(e){return e instanceof c.a})).map((function(e){return e.pos})),t=!0,n=!1,a=void 0;try{for(var r,i=this.bfsIterator(e,this.width*this.height)[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;if(o instanceof c.h){var s=o.depth,l=!0,u=!1,h=void 0;try{for(var d,m=this.tileNeighbors(o.pos)[Symbol.iterator]();!(l=(d=m.next()).done);l=!0){var f=Object(H.a)(d.value,2)[1];f instanceof c.a?s=0:f instanceof c.h&&(s=Math.min(s,f.depth))}}catch(v){u=!0,h=v}finally{try{l||null==m.return||m.return()}finally{if(u)throw h}}o.depth=s+1}}}catch(v){n=!0,a=v}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}}},{key:"earnMP",value:function(e,t){this.mpEarners.set(e,t)}},{key:"checkResources",value:function(){var e=0,t=0,n=0;this.entities().forEach((function(a){e+=a.inventory.sugar,t+=a.inventory.water,a instanceof c.b&&(n+=a.energy)})),Object(J.a)("sugar",e,"water",t,"energy",n)}},{key:"allCells",value:function(){var e=this.gridCells,t=this.width,n=this.height;return Object(z.a)({},Symbol.iterator,G.a.mark((function a(){var r,i,o;return G.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:r=0;case 1:if(!(r<t)){a.next=14;break}i=0;case 3:if(!(i<n)){a.next=11;break}if(null==(o=e[r][i])){a.next=8;break}return a.next=8,o;case 8:i++,a.next=3;break;case 11:r++,a.next=1;break;case 14:case"end":return a.stop()}}),a)})))}},{key:"allEnvironmentTiles",value:function(){var e=this;return Object(z.a)({},Symbol.iterator,G.a.mark((function t(){var n,a,r,i,o,s,l,c,u,h,d,m;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,a=!1,r=void 0,t.prev=3,i=e.gridEnvironment[Symbol.iterator]();case 5:if(n=(o=i.next()).done){t.next=36;break}s=o.value,l=!0,c=!1,u=void 0,t.prev=10,h=s[Symbol.iterator]();case 12:if(l=(d=h.next()).done){t.next=19;break}return m=d.value,t.next=16,m;case 16:l=!0,t.next=12;break;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(10),c=!0,u=t.t0;case 25:t.prev=25,t.prev=26,l||null==h.return||h.return();case 28:if(t.prev=28,!c){t.next=31;break}throw u;case 31:return t.finish(28);case 32:return t.finish(25);case 33:n=!0,t.next=5;break;case 36:t.next=42;break;case 38:t.prev=38,t.t1=t.catch(3),a=!0,r=t.t1;case 42:t.prev=42,t.prev=43,n||null==i.return||i.return();case 45:if(t.prev=45,!a){t.next=48;break}throw r;case 48:return t.finish(45);case 49:return t.finish(42);case 50:case"end":return t.stop()}}),t,null,[[3,38,42,50],[10,21,25,33],[26,,28,32],[43,,45,49]])})))}},{key:"allTiles",value:function(){var e=this.width,t=this.height,n=this;return Object(z.a)({},Symbol.iterator,G.a.mark((function a(){var r,i,o;return G.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:r=0;case 1:if(!(r<e)){a.next=14;break}i=0;case 3:if(!(i<t)){a.next=11;break}if(null==(o=n.tileAt(r,i))){a.next=8;break}return a.next=8,o;case 8:i++,a.next=3;break;case 11:r++,a.next=1;break;case 14:case"end":return a.stop()}}),a)})))}},{key:"bfsIterator",value:function(e,t,n,a){var r=this,i=this,o=(Array.isArray(e)?e:[e]).map((function(e){return r.tileAt(e)})),s=new Set;return Object(z.a)({},Symbol.iterator,G.a.mark((function e(){var r,l,c,u,h,d,m,f,v,p;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o.length>0&&s.size<t)){e.next=30;break}if(null!=(r=o.shift())){e.next=4;break}return e.abrupt("return");case 4:return s.add(r),e.next=7,r;case 7:for(l=i.tileNeighbors(r.pos),c=!0,u=!1,h=void 0,e.prev=11,d=l[Symbol.iterator]();!(c=(m=d.next()).done);c=!0)f=Object(H.a)(m.value,2),v=f[0],p=f[1],1!==v.manhattanLength()||null!=n&&!n(p)||-1!==o.indexOf(p)||s.has(p)||o.push(p);e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),u=!0,h=e.t0;case 19:e.prev=19,e.prev=20,c||null==d.return||d.return();case 22:if(e.prev=22,!u){e.next=25;break}throw h;case 25:return e.finish(22);case 26:return e.finish(19);case 27:a&&o.sort((function(e,t){return a(e)-a(t)})),e.next=0;break;case 30:case"end":return e.stop()}}),e,null,[[11,15,19,27],[20,,22,26]])})))}}]),e}(),oe=[Object(_.a)($.b.slice()),Object(_.a)($.b.slice()),Object(_.a)($.b.slice()),Object(_.a)($.b.slice()),Object(_.a)($.b.slice())],se=n(40),le=n(10),ce=n(138),ue=new d.a("Tissue",0,new h.a(m.d.level(2),m.c.level(3),m.e.level(2),m.b.level(1)),{texturePosition:new u.Vector2(1,1),color:new u.Color(3190309)},{type:"give",resources:"sugar"}),he=new d.a("Leaf",0,new h.a(m.d.level(2),p.GeneObstacle.level(0),m.c.level(3),y.GenePhotosynthesis.level(1)),{color:new u.Color("white"),texturePosition:new u.Vector2(2,1)},{type:"give",resources:"water take sugar"}),de=new d.a("Root",0,new h.a(m.d.level(2),ce.GeneScaffolding.level(1),m.c.level(4),m.g.level(2)),{color:new u.Color("white"),texturePosition:new u.Vector2(3,1)},{type:"take",resources:"water and sugar"}),me=new d.a("Seed",0,new h.a(m.d.level(2),p.GeneObstacle.level(0),m.c.level(3),g.GeneSeed.level(2)),{texturePosition:new u.Vector2(1,4)},{type:"give",resources:"water and sugar"}),fe=new d.b([ue,he,de,me]),ve=n(56),pe=n.n(ve),ye=(n(77),n(29)),ge=n(50),be=n(14),we=(n(99),n(91),n(100),n(60)),Ae=Object(le.b)({genome:Object(le.h)(d.b),id:Object(le.e)(),name:Object(le.i)(),freeMutationPoints:Object(le.i)(),totalMutationPoints:Object(le.i)(),geneOptions:Object(le.f)(Object(le.h)(we.a))});function Oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"plantum originus";return{id:pe()(),genome:fe,name:e,freeMutationPoints:0,descendants:[],geneOptions:[]}}function ke(e){var t=[];t.push(e);var n=!0,a=!1,r=void 0;try{for(var i,o=e.descendants[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;t.push.apply(t,Object(se.a)(ke(s)))}}catch(l){a=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return t}Ae.props.descendants=Object(le.f)(Object(le.h)(Ae)),Ae.props.parent=Object(le.j)(Ae);var Ee=function(){function e(t){Object(C.a)(this,e),this.visitors=t,this.trials=[]}return Object(S.a)(e,[{key:"recordDataFor",value:function(e){var t=function(e,t){for(var n={},a=0,r=Object.entries(t);a<r.length;a++){var i=Object(H.a)(r[a],2),o=i[0],s=(0,i[1])(e,e[0].world);n[o]=s}return n}(e,this.visitors);this.trials.push(t)}},{key:"visitorNames",value:function(){return Object.keys(this.visitors)}}]),e}(),je=function(){function e(t){Object(C.a)(this,e),this.experiments=t}return Object(S.a)(e,[{key:"recordDataFor",value:function(e){var t=!0,n=!1,a=void 0;try{for(var r,i=this.experiments[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){r.value.recordDataFor(e)}}catch(o){n=!0,a=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}}}]),e}(),xe={airEvaporation:0,climate:{rainDuration:0,timeBetweenRainfall:1/0,waterPerSecond:0},fill:function(e,t){},secondsToEvaporate:1/0,floorCo2:1,temperaturePerSeason:[50,50,50,50]};function Ce(e,t){var n=new ie(xe,0,Oe(),{width:e,height:t}),a=j.cellTypes[0],r=!0,i=!1,o=void 0;try{for(var s,l=n.allEnvironmentTiles()[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value.pos;n.setTileAt(u,new c.b(u,n,a))}}catch(h){i=!0,o=h}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return n.cellAt(0,0).inventory.set(100,0),n}function Se(){var e=Ce(20,1),t=Ce(20,2),n={time:function(e){return e[0].world.time}},a=!0,r=!1,i=void 0;try{for(var o,s=function(){var a=o.value.pos,r=e.cellAt(a),i=t.cellAt(a);n[a.x]=function(){var e=r.inventory.water;return i.inventory.water-e}},l=e.allCells()[Symbol.iterator]();!(a=(o=l.next()).done);a=!0)s()}catch(u){r=!0,i=u}finally{try{a||null==l.return||l.return()}finally{if(r)throw i}}var c=new Ee(n);console.time("run simulation");do{e.time%1<.1&&c.recordDataFor(Array.from(e.allCells())),e.step(.1),t.step(.1)}while(e.time<=10);return console.timeEnd("run simulation"),c}var Pe=function(){return r.a.useEffect((function(){var e=document.createElement("script");e.src="https://cdn.plot.ly/plotly-latest.min.js",e.addEventListener("load",(function(){!function(e,t){var n=[];for(var a in e.trials){var r=e.trials[a],i=[],o=[],s=!0,l=!1,c=void 0;try{for(var u,h=e.visitorNames()[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value;i.push(d);var m=r[d];o.push(m)}}catch(p){l=!0,c=p}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}var f={x:i,y:o,name:"t=".concat(Number(a)/10),type:"bar"};n.push(f)}var v=document.createElement("div");document.getElementById(t).appendChild(v),window.Plotly.newPlot(v,n,{barmode:"stack"})}(Se(),"water-over-time")})),e.addEventListener("error",(function(){var e=function(){var e=Ce(20,1),t={time:function(e){return e[0].world.time}},n=!0,a=!1,r=void 0;try{for(var i,o=function(){var n=i.value.pos,a=e.cellAt(n);t[n.x]=function(){return a.inventory.water}},s=e.allCells()[Symbol.iterator]();!(n=(i=s.next()).done);n=!0)o()}catch(c){a=!0,r=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}var l=new Ee(t);console.time("run simulation");do{e.time%1<.1&&l.recordDataFor(Array.from(e.allCells())),e.step(.1)}while(e.time<=10);return console.timeEnd("run simulation"),l}();console.table(e.trials);var t=Se();console.table(t.trials)})),document.body.appendChild(e)}),[]),r.a.createElement("div",null,r.a.createElement("h1",null,"Test Diffusion"),r.a.createElement("div",{id:"water-over-time"},r.a.createElement("h2",null,"width 20 world, water from t=0 to t=1 ")))};var Me={airEvaporation:.2,climate:{timeBetweenRainfall:40,rainDuration:3,waterPerSecond:200},secondsToEvaporate:166,floorCo2:.85,temperaturePerSeason:[51,56,52,43],fill:"Level0"},Te={airEvaporation:.3,climate:{timeBetweenRainfall:40,rainDuration:2,waterPerSecond:100},secondsToEvaporate:166,floorCo2:.5,temperaturePerSeason:[53,75,43,25],fill:"Temperate"},Re={airEvaporation:.3,climate:{timeBetweenRainfall:30,rainDuration:8,waterPerSecond:20},secondsToEvaporate:166,floorCo2:.5,temperaturePerSeason:[53,75,43,25],fill:"Reservoires"},Ne={airEvaporation:.3,climate:{timeBetweenRainfall:83.333,rainDuration:4,waterPerSecond:90},secondsToEvaporate:33,floorCo2:1,temperaturePerSeason:[40,62,36,15],fill:"Rocky"},Fe={airEvaporation:.3,climate:{timeBetweenRainfall:83.333,rainDuration:4,waterPerSecond:90},secondsToEvaporate:33,floorCo2:1,temperaturePerSeason:[27,62,36,15],fill:"SkySoil"},De={airEvaporation:.3,climate:{rainDuration:7.3333,timeBetweenRainfall:110,waterPerSecond:240},secondsToEvaporate:16,floorCo2:.95,temperaturePerSeason:[69,84,98,24],fill:"Desert"},Be=n(190),Ie=n.n(Be),Le=n(12),Ve=n.n(Le),ze=n(44),We=n(18),Ge=n(39),He=n(191),Ue=n.n(He);n(271);var Ye=function(e){var t=e.size,n=e.className,a=Object(Ge.a)(e,["size","className"]);return r.a.createElement("img",Object.assign({className:Ve()("character",t,n),alt:"",src:Ue.a},a))};n(272);function Ke(){return a.createElement("div",{className:"glow"},a.createElement("span",null))}n(273);function Qe(e){var t=e.fruit,n=e.mpEarned,r=Object(X.d)(Object(g.reproducerGetPercentMatured)(t),0,1,.2,1),i=a.useMemo((function(){return{transform:"scale(".concat(r,")")}}),[r]);return a.createElement("div",{className:"fruit-info"},a.createElement("div",{className:"fruit-visual"},t.state.isMature?a.createElement(Ke,null):null,a.createElement("img",{alt:"",src:Ie.a,style:i})),null!=t.state.timeMatured?a.createElement(a.Fragment,null,a.createElement("span",{className:"matured-info success"},"+",a.createElement(ze.a,{amount:n})),"\xa0at ",L(B(t.state.timeMatured)),", Mutation Points earned: 1"):a.createElement("span",{className:"matured-info in-progress"},(100*Object(g.reproducerGetPercentMatured)(t)).toFixed(0),"% maturity"),", started at ",L(B(t.cell.timeMade)),".")}function Xe(e){var t=e.cell,n=e.mpEarned,r=t.findGene(g.GeneFruit);return null!=r?a.createElement(Qe,{fruit:r,mpEarned:n}):a.createElement("div",null,t.toString()," +",a.createElement(ze.a,{amount:n}))}function Ze(e){var t=e.mpEarners,n=e.className;return t.size>0?a.createElement("div",{className:Ve()("mp-earner-list",n)},a.createElement("h5",null,"Reproductive Cells"),a.createElement("div",null,Array.from(t.entries()).map((function(e){var t=Object(H.a)(e,2),n=t[0],r=t[1];return a.createElement(Xe,{cell:n,mpEarned:r})})))):null}function qe(e){var t=e.vignettes;return t?a.createElement("div",{className:"vignettes"},t.map((function(e,t){return a.createElement("img",{key:t,src:e.toDataURL(),alt:""})}))):null}function Je(e){var t=e.results,n=Array.from(t.mpEarners.entries()).filter((function(e){var t=Object(H.a)(e,2);t[0];return t[1]>0})).length<3?"survived":"thrived";return a.createElement(a.Fragment,null,a.createElement("div",{className:"character-container"},a.createElement(Ye,{size:"large",className:"dance"})),a.createElement("h1",null,"You ",n,"!"),a.createElement("h2",null,t.mutationPointsPerEpoch," Mutation Points earned."),a.createElement(qe,{vignettes:t.vignettes}),a.createElement(Ze,{mpEarners:t.mpEarners}))}function _e(e){var t=e.results;return a.useEffect((function(){return We.o.play(),function(){We.o.stop()}}),[]),a.createElement(a.Fragment,null,a.createElement("div",{className:"character-container"},a.createElement(Ye,{className:"sad",size:"large"})),a.createElement("h1",null,a.createElement("i",null,t.world.species.name)," couldn't survive!"),a.createElement("div",null,"You survived until ",L(t.world.season),"!"),a.createElement(qe,{vignettes:t.vignettes}),a.createElement(Ze,{mpEarners:t.mpEarners,className:"dark"}))}var $e=a.memo((function(e){var t=e.onDone,n=e.results;return a.createElement("div",{className:"game-results-screen ".concat(n.status)},a.createElement("div",{className:"game-results-content"},"won"===n.status?a.createElement(Je,{onDone:t,results:n}):a.createElement(_e,{onDone:t,results:n}),a.createElement("button",{className:"done-button",onClick:t},"Continue \u2192")))}));function et(e,t,n){var a=j.cellTypes[4],r=new c.b(new u.Vector2(0,0),e,a),i=r.findGene(g.GeneFruit);return i.state.committedResources.add(i.props.neededResources*t/2,i.props.neededResources*t/2),i.state.timeMatured=n,i.state.isMature=1===t,r}function tt(){var e=new ie(Te,0,Oe()),t=et(e,1,250),n=et(e,.4),a=et(e,1,900),i={status:"won",mpEarners:new Map([[t,3],[n,0],[a,3]]),mutationPointsPerEpoch:6,world:e};return r.a.createElement($e,{results:i,onDone:function(){}})}function nt(){var e=new ie(Te,0,Oe());e.time=4*R.l;var t=et(e,.4);e.time=9*R.l;var n=et(e,.3);e.time=19*R.l;var a=et(e,.01459),i={mpEarners:new Map([[t,0],[n,0],[a,0]]),status:"lost",mutationPointsPerEpoch:0,world:e};return r.a.createElement($e,{results:i,onDone:function(){}})}var at=n(8),rt=n(6),it=n(7),ot=r.a.createContext({x:window.innerWidth/2,y:window.innerHeight/2});var st=function(){return Object(a.useContext)(ot)},lt=n(103),ct=n(80);function ut(e){var t=e.genome.cellTypes.some((function(e){return e.chromosome.has(b.GeneTransport)})),n=e.genome.cellTypes.some((function(e){return e.chromosome.has(ct.GenePipes)})),a=e.genome.cellTypes.some((function(e){return e.chromosome.has(lt.GeneDiffuseWater)}));return t||n||a?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=Array.from(be.a.values());Object(_.a)(t);var n=t.slice(0,e).map((function(e){return e.level(Object(X.g)(0,e.blueprint.levelCosts.length-1))}));return n}(3):[b.GeneTransport.level(2),ct.GenePipes.level(2),lt.GeneDiffuseWater.level(0)]}var ht=r.a.createContext(null);function dt(){return Object(a.useContext)(ht)}function mt(e,t){if(null==t)return console.error("can't reduce null action!",e,t),e;switch(t.type){case"AAUpdateSpecies":return Object(U.a)({},e);case"AAStartPopulationAttempt":return function(e,t){var n=t.populationAttempt,a=n.targetHex,r=n.sourceHex;if(!a.info.visible)return e;if(null!=r&&null==r.info.flora)return console.error("sourceHex isn't null but the flora is null"),e;return Object(U.a)({},e,{activePopulationAttempt:t.populationAttempt})}(e,t);case"AAPopulationAttemptSuccess":return ft(e,t);case"AANextEpoch":return function(e,t){var n=!0,a=!1,r=void 0;try{for(var i,o=ke(e.rootSpecies)[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;s.freeMutationPoints=e.overWorld.getMaxGenePool(s)}}catch(l){a=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return Object(U.a)({},e,{epoch:e.epoch+1})}(e);case"AAGetGameResult":return function(e,t){"won"===t.result.status&&(e=ft(e,{type:"AAPopulationAttemptSuccess",attempt:e.activePopulationAttempt,results:t.result}));return Object(U.a)({},e,{activeGameResult:t.result})}(e,t);case"AAGameResultDone":return function(e,t){return Object(U.a)({},e,{activePopulationAttempt:void 0,activeGameResult:void 0})}(e);case"AATransitionStart":return function(e,t){return Object(U.a)({},e,{transition:t.transition})}(e,t);case"AATransitionEnd":return e}}function ft(e,t){var n=t.attempt,a=void 0===n?e.activePopulationAttempt:n,r=t.results,i=a.targetHex,o=a.settlingSpecies;null==e.overWorld.getStartHex().info.flora&&gtag("event","Beat first playthrough",{label:"mp earned",value:r.mutationPointsPerEpoch});var s=void 0;null!=i.info.flora&&(s=i.info.flora.species),i.info.flora={species:o,mutationPointsPerEpoch:r.mutationPointsPerEpoch},o.geneOptions=ut(o),s&&(s.freeMutationPoints=Math.min(s.freeMutationPoints,e.overWorld.getMaxGenePool(s)));var l=!0,c=!1,u=void 0;try{for(var h,d=e.overWorld.hexNeighbors(i)[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var m=h.value;m&&(m.info.visible=!0)}}catch(f){c=!0,u=f}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}return Object(U.a)({},e)}var vt,pt,yt,gt,bt,wt,At,Ot,kt,Et,jt,xt,Ct,St,Pt,Mt,Tt,Rt=n(27),Nt=n(28),Ft=(n(71),Object(le.b)({climate:Object(le.h)(Object(le.b)({"*":!0})),"*":!0})),Dt=Object(le.b)({seed:Object(le.i)(),height:Object(le.i)(),temperature:Object(le.i)(),rainfall:Object(le.i)(),soilType:Object(le.i)(),wind:Object(le.i)(),visible:Object(le.i)(),environment:Object(le.h)(Ft),flora:Object(le.h)(Object(le.b)({species:Object(le.j)(Ae),mutationPointsPerEpoch:Object(le.i)(),actionPoints:Object(le.i)()}))}),Bt=Math.sqrt(3)/2,It=(vt=Object(le.k)(Object(le.e)()),pt=Object(le.k)(Object(le.h)(Dt)),yt=function(){function e(t,n){Object(C.a)(this,e),Object(Rt.a)(this,"uuid",gt,this),Object(Rt.a)(this,"info",bt,this),Object(Rt.a)(this,"i",wt,this),Object(Rt.a)(this,"j",At,this),this.i=t,this.j=n}return Object(S.a)(e,[{key:"cartesian",get:function(){var e=this.i,t=this.j;return{x:1.5*e,y:2*Bt*t+Bt*e}}},{key:"isHabitable",get:function(){return-1!==this.info.height}},{key:"k",get:function(){return-(this.i+this.j)}},{key:"magnitude",get:function(){return Math.abs(this.i)+Math.abs(this.j)+Math.abs(this.k)}}]),e}(),gt=Object(Nt.a)(yt.prototype,"uuid",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pe()()}}),bt=Object(Nt.a)(yt.prototype,"info",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{seed:Math.random()*Number.MAX_SAFE_INTEGER,height:0,rainfall:"medium",soilType:"average",temperature:"temperate",visible:!1}}}),wt=Object(Nt.a)(yt.prototype,"i",[le.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At=Object(Nt.a)(yt.prototype,"j",[le.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yt),Lt=n(139),Vt=n.n(Lt),zt=(kt=Object(le.k)(Object(le.g)(Object(le.h)(It))),Ot=Symbol.iterator,Et=function(){function e(){Object(C.a)(this,e),Object(Rt.a)(this,"tiles",jt,this)}return Object(S.a)(e,[{key:"hash",value:function(e,t){return"".concat(e,",").concat(t)}},{key:"get",value:function(e,t){return this.tiles[this.hash(e,t)]}},{key:"set",value:function(e,t,n){this.tiles[this.hash(e,t)]=n}},{key:Ot,value:G.a.mark((function e(){var t;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=G.a.keys(this.tiles);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.tiles[t];case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))}]),e}(),jt=Object(Nt.a)(Et.prototype,"tiles",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),Et),Wt=(Ct=Object(le.k)(Object(le.h)(zt)),St=Object(le.k)(Object(le.j)(It)),xt=Symbol.iterator,Pt=function(){function e(t,n){Object(C.a)(this,e),Object(Rt.a)(this,"storage",Mt,this),Object(Rt.a)(this,"startTile",Tt,this),this.storage=t,this.startTile=n,this.startTile&&(this.startTile.info.visible=!0)}return Object(S.a)(e,[{key:"hexNeighbors",value:function(e){var t=e.i,n=e.j,a=[];return a[0]=this.storage.get(t+1,n),a[1]=this.storage.get(t,n+1),a[2]=this.storage.get(t-1,n+1),a[3]=this.storage.get(t-1,n),a[4]=this.storage.get(t,n-1),a[5]=this.storage.get(t+1,n-1),a}},{key:"possibleMigrationSources",value:function(e){var t=this.hexNeighbors(e).filter((function(e){return null!=(null===e||void 0===e?void 0:e.info.flora)}));return null==e.info.flora?t:t.filter((function(t){return null!=t&&t.info.flora.species!==e.info.flora.species}))}},{key:"possibleMigrationTargets",value:function(e){return null==e.info.flora?(console.error("can't migrate from a null flora source"),[]):this.hexNeighbors(e).filter((function(t){return null!=t&&(null==t.info.flora||t.info.flora.species!==e.info.flora.species)}))}},{key:"getStartHex",value:function(){return this.startTile}},{key:"hexAt",value:function(e,t){return this.storage.get(e,t)}},{key:xt,value:G.a.mark((function e(){var t,n,a,r,i,o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,a=void 0,e.prev=3,r=this.storage[Symbol.iterator]();case 5:if(t=(i=r.next()).done){e.next=12;break}return o=i.value,e.next=9,o;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,a=e.t0;case 18:e.prev=18,e.prev=19,t||null==r.return||r.return();case 21:if(e.prev=21,!n){e.next=24;break}throw a;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))},{key:"getMaxGenePool",value:function(e){return this.getHexesPopulatedBy(e).reduce((function(e,t){return e+t.info.flora.mutationPointsPerEpoch}),0)}},{key:"getHexesPopulatedBy",value:function(e){var t=[],n=!0,a=!1,r=void 0;try{for(var i,o=this.storage[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,l=s.info.flora;l&&l.species===e&&t.push(s)}}catch(c){a=!0,r=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return t}}],[{key:"randomHeight",value:function(e,t){var n=e.cartesian,a=n.x,r=n.y,i=0;return i+=6*(t.noise3D(a/24,r/24,0)-.2),i+=6*t.noise3D(a/24,r/24,1.453),i+=1.5*t.noise3D(a/6,r/6,1.453),i+=1,(i-=.025*Math.abs(r*r))<0&&i>=-1&&(i=0),i=Math.round(Math.max(Math.min(i,6),-1))}},{key:"populateLevelInfo",value:function(t,n){t.info.height=e.randomHeight(t,n)}},{key:"generateFilledHex",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=new zt,a=new Vt.a,r=-t;r<=t;r++)for(var i=-t;i<=t;i++){var o=-(r+i);if(!(Math.abs(o)>t)){var s=new It(r,i);e.populateLevelInfo(s,a),n.set(r,i,s)}}var l=e.getDefaultStartTile(n);return new e(n,l)}},{key:"generateRectangle",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,a=new zt,r=new Vt.a,i=Math.max(t/2,n/2),o=-i;o<=i;o++)for(var s=-i;s<=i;s++){var l=-(o+s);if(!(Math.abs(l)>i)){var c=new It(o,s),u=c.cartesian,h=u.x,d=u.y;h<-t/2||h>t/2||d<-n/2||d>n/2||(e.populateLevelInfo(c,r),a.set(o,s,c))}}var m=e.getDefaultStartTile(a);return new e(a,m)}},{key:"getDefaultStartTile",value:function(e){if(null!=e)return Array.from(e).filter((function(e){return 0===e.info.height})).sort((function(e,t){return e.magnitude-t.magnitude}))[0]}}]),e}(),Mt=Object(Nt.a)(Pt.prototype,"storage",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tt=Object(Nt.a)(Pt.prototype,"startTile",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt),Gt=(Object(le.b)({sourceHex:Object(le.j)(It),targetHex:Object(le.j)(It),settlingSpecies:Object(le.j)(Ae)}),Object(le.b)({overWorld:Object(le.h)(Wt),rootSpecies:Object(le.h)(Ae),epoch:!0})),Ht=n(67),Ut=n(110),Yt=n.n(Ut);function Kt(e){var t=Object(le.l)(Gt,e);console.log("saved json",t);var n=JSON.stringify(t);return Yt.a.setItem("gameData",n)}function Qt(){return(Qt=Object(Ht.a)(G.a.mark((function e(){var t,n,a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Yt.a.getItem("gameData");case 2:return t=e.sent,n=JSON.parse(t),a=Object(le.d)(Gt,n),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Xt={AAGameResultDone:!0,AAGetGameResult:!0,AAUpdateSpecies:!0,AANextEpoch:!0,AAPopulationAttemptSuccess:!0,AAStartPopulationAttempt:!0};n(274);function Zt(e){return r.a.createElement("button",Object.assign({},e,{className:Ve()("button",e.className,e.color||"purple")}),e.children)}n(275);var qt=n(192);n(276);var Jt=function(e){var t=st(),n=Object(qt.a)(),a=Object(H.a)(n,2),i=a[0],o=a[1],s=e.displayBlock,l=void 0!==s&&s,c=e.children,u=e.className,h=e.zScale,d=void 0===h?5:h,m=Object(Ge.a)(e,["displayBlock","children","className","zScale"]),f=window.innerWidth*d,v=r.a.useMemo((function(){if(null!=o){var e=o.left+o.width/2,n=o.top+o.height/2,a=t.x-e,r=t.y-n,i=Math.atan(2*a/f),s=Math.atan(-2*r/f);return{transform:"perspective(525px) rotateX(".concat(s,"rad) rotateY(").concat(i,"rad)")}}return{}}),[t.x,t.y,o,f]);return r.a.createElement("div",Object.assign({ref:i,className:Ve()("look-at-mouse",u,{"display-block":l})},m),r.a.createElement("div",{className:"look-at-mouse-transform",style:v},c))};n(277);var _t=function e(t){var n=t.species,i=t.onMutate,o=n.descendants.length>0?r.a.createElement("div",{className:"descendants-container"},n.descendants.map((function(t,n){return r.a.createElement(e,{key:n,species:t,onMutate:i})}))):null,s=Object(a.useCallback)((function(){i(n)}),[i,n]);return r.a.createElement("div",{className:"species-node"},o,r.a.createElement(Jt,{zScale:5,onClick:s},r.a.createElement("div",{className:"species-info"},r.a.createElement("div",{className:"species-info-name"},n.name),r.a.createElement("div",{className:"species-info-animation"},r.a.createElement(Ye,{size:"small"})),r.a.createElement(ze.a,{amount:n.freeMutationPoints}))))};var $t=function(e){var t=e.onMutate,n=dt(),a=Object(H.a)(n,1)[0].rootSpecies;return r.a.createElement("div",{className:"phylogenetic-tree"},r.a.createElement("div",{className:"title"},"Phylogenetic Tree"),r.a.createElement("div",{className:"tree-nodes"},r.a.createElement(_t,{species:a,onMutate:t})))},en=n(61),tn=n(193),nn=n.n(tn),an=n(42),rn=n(107);n(285);function on(e){var t=e.onNextEpoch,n=(e.onFocusHex,dt()),i=Object(H.a)(n,1)[0],o=i.epoch,s=i.overWorld,l=i.rootSpecies,c=Object(a.useState)(!1),u=Object(H.a)(c,2),h=u[0],d=u[1],m=r.a.useCallback((function(){d(!0),setTimeout((function(){return d(!1)}),5e3),t()}),[t]),f=[],v=ke(l),p=!0,y=!1,g=void 0;try{for(var b,w=v[Symbol.iterator]();!(p=(b=w.next()).done);p=!0){var A=b.value,O=s.getMaxGenePool(A);f.push(r.a.createElement("div",{key:A.id},r.a.createElement("span",{className:"species-name"},A.name)," +",r.a.createElement(ze.a,{amount:O})))}}catch(E){y=!0,g=E}finally{try{p||null==w.return||w.return()}finally{if(y)throw g}}var k=r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,"Refill mutation points on all species and re-roll mutations."),r.a.createElement("div",null,"Each species will get MP equal to their total production across all hexes they are habiting."));return r.a.createElement("div",{className:Ve()("epoch-display",{"ready-to-advance":!1,transitioning:h})},r.a.createElement("h1",{className:"number"},"Epoch ",r.a.createElement(an.a,{sigFigs:6,value:o,speed:.08})),r.a.createElement("div",{className:"production-overview"},f),r.a.createElement(rn.a,{placement:"left",trigger:"hover",overlay:k},r.a.createElement("button",{className:"button-next-epoch",onClick:m,disabled:h},r.a.createElement(en.d,{className:"icon"}))))}var sn=n(90),ln=n(24),cn=n(25);function un(e){var t=e.width,n=void 0===t?1:t,a=e.height,r=void 0===a?1:a,i=e.radius,o=void 0===i?.1:i,s=e.max,l=void 0===s?1e3:s,c=e.initialSample,h=void 0===c?void 0:c,d=e.rng,m=void 0===d?Math.random:d,f=o*o,v=3*f,p=o*Math.SQRT1_2,y=Math.ceil(n/p),g=Math.ceil(r/p),b=new Array(y*g),w=[],A=0,O=0;function k(e,t){var n=e/p|0,a=t/p|0,r=Math.max(n-2,0),i=Math.max(a-2,0),o=Math.min(n+3,y),s=Math.min(a+3,g);for(a=i;a<s;++a){var l=a*y;for(n=r;n<o;++n){var c;if(c=b[l+n]){var u=c[0]-e,h=c[1]-t;if(u*u+h*h<f)return!1}}}return!0}function E(e,t){var n=[e,t];return w.push(n),b[y*(t/p|0)+(e/p|0)]=n,O++,A++,n}m=m||Math.random;for(var j=function(){if(!O)return null!=h?E(h[0],h[1]):E(m()*n,m()*r);for(;A;){for(var e=m()*A|0,t=w[e],a=0;a<30;++a){var i=2*Math.PI*m(),o=Math.sqrt(m()*v+f),s=t[0]+o*Math.cos(i),l=t[1]+o*Math.sin(i);if(s>=0&&s<n&&l>=0&&l<r&&k(s,l))return E(s,l)}w[e]=w[--A],w.length=A}},x=[],C=0;C<l;C++){var S=j();if(null==S)break;x.push(new u.Vector2(S[0],S[1]))}return x}var hn=Math.sqrt(3)/2;function dn(e,t,n){var a=t.scale,r=t.dX,i=t.dY,o=e.width/2+r,s=e.height/2+i,l=n.nativeEvent,c=(l.offsetX-o)/a/1.5,u=((l.offsetY-s)/a-hn*c)/(2*hn);return function(e,t,n){var a=Math.round(e),r=Math.round(t),i=Math.round(n),o=Math.abs(a-e),s=Math.abs(r-t),l=Math.abs(i-n);o>s&&o>l?a=-r-i:s>l?r=-a-i:i=-a-r;return{i:a,j:r,k:i}}(c,u,-(c+u))}function mn(e,t){var n=t.dX,a=t.dY,r=t.scale,i=e.cartesian,o=i.x,s=i.y;return[window.innerWidth/2+n+o*r,window.innerHeight/2+a+s*r]}function fn(e,t){var n=e.cartesian,a=n.x,r=n.y,i=window.innerWidth/2-a*t,o=window.innerHeight/2-r*t;return[i-window.innerWidth/2,o-window.innerHeight/2]}!function(){var e=[new u.Vector2(-1,0),new u.Vector2(.5,hn),new u.Vector2(.5,-hn)]}();var vn=function(){var e=1*hn;return function(t,n){var a=Math.abs(t),r=Math.abs(n);return!(a>1||r>e)&&1*e-e*a-.5*r>=0}}();n(286);var pn=function(e){var t=e.className,n=e.children,i=e.shrunkElements,o=Object(a.useState)(!1),s=Object(H.a)(o,2),l=s[0],c=s[1];return r.a.createElement("div",{className:Ve()(t,"expand")},r.a.createElement("div",{className:"expand-button",onClick:function(){c(!l)}},i,r.a.createElement("div",{className:"expand-caret"},l?"\u25bc":"\u25b6")),l?r.a.createElement("div",null,n):null)};n(287);var yn=function(e){e.playSpecies;var t=e.tile,n=e.onClickPlay,a=t.info,i=a.height,o=a.flora,s=-1===i?null:r.a.createElement("div",{className:"play-selector"},r.a.createElement(Zt,{color:"green",className:"play-button",onClick:n},"Play Level")),l=null!=o?r.a.createElement("div",null,r.a.createElement("h1",null,"Inhabited by ",r.a.createElement("i",null,o.species.name)),r.a.createElement("p",null,r.a.createElement(ze.a,{amount:o.mutationPointsPerEpoch})," per epoch")):t.isHabitable?r.a.createElement("h1",null,"Uninhabited"):r.a.createElement("h1",null,"Uninhabitable (Deep Water)"),c=Object(U.a)({},t.info);delete c.flora;var u=t.isHabitable?r.a.createElement(pn,{shrunkElements:r.a.createElement("div",{className:"details"},"Details")},r.a.createElement("pre",{style:{fontSize:"12px"}},JSON.stringify(c,null,4))):null;return r.a.createElement("div",{className:"hex-info-container"},l,u,s)},gn=n(194),bn=n.n(gn),wn=n(338),An=n(343),On=new Image;On.src=bn.a;var kn=Object(An.a)().domain([-1,0,1,5,6]).range(["rgb(0, 60, 255)","lightblue","yellow","orange"]),En=function(){function e(t,n){Object(C.a)(this,e),this.tile=t,this.context=n,this.vignettePositions=void 0,this.isHovered=!1}return Object(S.a)(e,[{key:"setIsHovered",value:function(){this.isHovered=!0}},{key:"draw",value:function(e,t){var n=t.scale,a=mn(this.tile,t),r=Object(H.a)(a,2),i=r[0],o=r[1];e.lineWidth=1*n/48,this.isShadowed?e.globalAlpha=.2:e.globalAlpha=1,this.tile.info.visible,e.fillStyle=kn(this.tile.info.height),e.strokeStyle="rgb(112, 112, 112)",jn(e,i,o,n),this.isHovered||this.drawNumericHeight(e,n,i,o),null!=this.tile.info.flora&&this.drawVignettes(e,this.tile.info.flora.species,i,o,n),this.isHovered&&(e.strokeStyle="rgb(112, 112, 112)",e.lineWidth=1*n/48,function(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.beginPath(),e.moveTo(t+a,n),e.arc(t,n,a,0,2*Math.PI),r&&e.fill();e.stroke()}(e,i,o,n/48*12,!1),this.tile.info.visible&&this.drawNumericHeight(e,n,i,o)),this.isHovered=!1}},{key:"drawActivePulse",value:function(e,t,n,a){for(var r=0;r<10;r++)this.drawPulse(r/10,e,t,n,a)}},{key:"drawPulse",value:function(t,n,a,r,i){var o=Object(X.d)(e.easePulse(Object(X.a)(Object(X.d)(Object(X.k)(cn.a.now/6e3+t),0,1,-1,2),-1/0,1)),0,1,0,20);n.lineWidth=o*a/48;var s=100/(o*o*o);n.strokeStyle="rgba(255, 255, 255, ".concat(s,")"),jn(n,r,i,a+n.lineWidth/2,!1)}},{key:"drawNumericHeight",value:function(e,t,n,a){this.tile.info.height>=0&&(e.font="".concat(12*t/48,"px serif"),e.textAlign="center",e.textBaseline="middle",e.fillStyle="#666",e.fillText(this.tile.info.height+"",n,a,t))}},{key:"drawVignettes",value:function(e,t,n,a,r){if(null==this.vignettePositions){var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=2,a=hn*n,r=un({width:n,height:a,radius:e,initialSample:[n/2,a/2],max:1e4}),i=r.map((function(e){return e.x-=n/2,e.y-=a/2,e})).filter((function(e){return vn(e.x,e.y)}));return t&&i.shift(),i}(.3,!0);this.vignettePositions=[];var o=this.vignettePositions;Object(Ht.a)(G.a.mark((function e(){var t,n,a,r,s,l;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,a=void 0,e.prev=3,r=i[Symbol.iterator]();case 5:if(t=(s=r.next()).done){e.next=13;break}return l=s.value,o.push(l),e.next=10,P(300);case 10:t=!0,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),n=!0,a=e.t0;case 19:e.prev=19,e.prev=20,t||null==r.return||r.return();case 22:if(e.prev=22,!n){e.next=25;break}throw a;case 25:return e.finish(22);case 26:return e.finish(19);case 27:case"end":return e.stop()}}),e,null,[[3,15,19,27],[20,,22,26]])})))()}var s=r/48/2,l=!0,c=!1,u=void 0;try{for(var h,d=this.vignettePositions[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var m=h.value;e.drawImage(On,n+m.x*r-On.width/2*s,a+m.y*r-On.height*s,On.width*s,On.height*s)}}catch(f){c=!0,u=f}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}}},{key:"zIndex",get:function(){var e=this.tile.cartesian.y;return null!=this.tile.info.flora&&(e+=1e3),e}},{key:"isShadowed",get:function(){return null!=this.context.highlightedHex?this.context.highlightedHex!==this.tile:null!=this.context.populationAttempt&&(this.context.populationAttempt.sourceHex!==this.tile&&this.context.populationAttempt.targetHex!==this.tile)}}]),e}();function jn(e,t,n,a){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.beginPath(),e.moveTo(t+a,n);for(var i=1;i<6;i++){var o=i/6*Math.PI*2;e.lineTo(t+Math.cos(o)*a,n+Math.sin(o)*a)}e.closePath(),r&&e.fill(),e.stroke()}En.easePulse=wn.a;n(288),n(289);var xn=function(e){var t=e.tile,n=e.camera,a=e.children,i=mn(t,n),o=Object(H.a)(i,2),s=o[0],l=o[1],c={left:s+.3*n.scale,top:l};return r.a.createElement("div",{className:"overworld-popover",style:c},r.a.createElement("div",{className:"overworld-popover-positioner"},a))},Cn=function(e){function t(e,n){var a;Object(C.a)(this,t),(a=Object(at.a)(this,Object(rt.a)(t).call(this,e,n))).context=void 0,a.hexTileSprites=new Map,a.canvas=null,a.rafId=void 0,a.handleCanvasRef=function(e){a.canvas=e,null!=e&&(cn.a.addAnimation((function(){return null!=a.canvas&&a.setState({frame:a.state.frame+1}),null==a.canvas})),a.handleResize())},a.handleCanvasClick=function(e){if(null!=a.state.populationAttempt||null!=a.state.highlightedHex)a.setState({populationAttempt:void 0,highlightedHex:void 0});else{var t=dn(a.canvas,a.state.cameraState,e),n=Object(H.a)(a.context,1)[0].overWorld,r=n.hexAt(t.i,t.j);if(null!=r&&r.info.visible)if(null==r.info.flora){var i=r,o=n.possibleMigrationSources(r)[0];if(null!=o){var s={targetHex:i,sourceHex:o,settlingSpecies:o.info.flora.species};a.setState({populationAttempt:s,highlightedHex:void 0})}}else{var l=r;a.setState({highlightedHex:l,populationAttempt:void 0})}}},a.handleCanvasMouseLeave=function(){a.setState({hoveredHex:void 0})},a.handleCanvasMouseMove=function(e){var t=dn(a.canvas,a.state.cameraState,e),n=a.context[0].overWorld.hexAt(t.i,t.j);a.setState({hoveredHex:n})},a.handleClickPlay=function(){var e=Object(H.a)(a.context,2)[1],t=a.getAppAction();t&&e({type:"AATransitionStart",transition:t})},a.handleKeyDown=function(e){if(!e.repeat){var t=Object(U.a)({},a.state.pressedKeys,Object(z.a)({},e.code,!0));a.setState({pressedKeys:t})}},a.handleKeyUp=function(e){var t=Object(U.a)({},a.state.pressedKeys);delete t[e.code],a.setState({pressedKeys:t})},a.handleWheel=function(e){var t=-(e.deltaX+e.deltaY)/125/10,n=Math.pow(2,t),r=a.state.cameraState.scale*n;a.setState({cameraState:Object(U.a)({},a.state.cameraState,{scale:r})})},a.handleResize=function(){null!=a.canvas&&(a.canvas.width=window.innerWidth,a.canvas.height=window.innerHeight,a.updateCanvas())},a.updateCamera=function(){var e=Object(H.a)(a.context,1)[0].transition;if(null!=e&&"AAStartPopulationAttempt"===e.type){var t=e.populationAttempt.targetHex,n=a.state.cameraState,r=n.scale,i=n.dX,o=n.dY,s=1.02*r,l=fn(t,r),c=Object(H.a)(l,2),h=c[0],d=c[1];a.setState({cameraState:{dX:Object(X.b)(i,h,.2),dY:Object(X.b)(o,d,.2),scale:s}})}var m=new u.Vector2;for(var f in a.state.pressedKeys)"KeyW"===f||"ArrowUp"===f?m.y+=20:"KeyS"===f||"ArrowDown"===f?m.y-=20:"KeyA"===f||"ArrowLeft"===f?m.x+=20:"KeyD"!==f&&"ArrowRight"!==f||(m.x-=20);if(m.setLength(20),0!==m.x||0!==m.y){var v=a.state.cameraState;a.setState({cameraState:Object(U.a)({},v,{dX:v.dX+m.x,dY:v.dY+m.y})})}};var r=Object(H.a)(n,1)[0].overWorld,i=fn(r.getStartHex(),96),o=Object(H.a)(i,2),s=o[0],l=o[1];a.state={cameraState:{scale:96,dX:s,dY:l},pressedKeys:{},frame:0};var c=!0,h=!1,d=void 0;try{for(var m,f=r[Symbol.iterator]();!(c=(m=f.next()).done);c=!0){var v=m.value,p=new En(v,Object(ln.a)(a));a.hexTileSprites.set(v,p)}}catch(y){h=!0,d=y}finally{try{c||null==f.return||f.return()}finally{if(h)throw d}}return a}return Object(it.a)(t,e),Object(S.a)(t,[{key:"populationAttempt",get:function(){return this.state.populationAttempt}},{key:"highlightedHex",get:function(){return this.state.highlightedHex}}]),Object(S.a)(t,[{key:"getAppAction",value:function(){if(null!=this.state.populationAttempt)return{type:"AAStartPopulationAttempt",populationAttempt:this.state.populationAttempt};if(null!=this.state.highlightedHex){var e=this.state.highlightedHex;return{type:"AAStartPopulationAttempt",populationAttempt:{sourceHex:e,targetHex:e,settlingSpecies:e.info.flora.species}}}}},{key:"updateCanvas",value:function(){if(null!=this.canvas){var e=this.canvas.getContext("2d");this.drawMap(e),this.drawMigrationArrows(e),this.drawPopulationAttempt(e)}}},{key:"drawMap",value:function(e){var t=this.state,n=t.hoveredHex,a=t.cameraState;e.clearRect(0,0,e.canvas.width,e.canvas.height),null!=n&&this.hexTileSprites.get(n).setIsHovered();var r=Array.from(this.hexTileSprites.values());r.sort((function(e,t){return e.zIndex-t.zIndex}));for(var i=0,o=r;i<o.length;i++){o[i].draw(e,a)}}},{key:"drawMigrationArrows",value:function(e){var t=this.state,n=t.hoveredHex,a=t.populationAttempt;null!=n&&null==a&&(null==n.info.flora?this.drawPossibleMigrationIntoArrows(e,n):this.drawPossibleMigrationOutOfArrows(e,n))}},{key:"drawPopulationAttempt",value:function(e){var t=this.state.populationAttempt;null!=t&&this.drawMigrationArrow(e,t.sourceHex,t.targetHex)}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),window.addEventListener("resize",this.handleResize),this.rafId=cn.a.addAnimation(this.updateCamera)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("resize",this.handleResize),cn.a.removeAnimation(this.rafId)}},{key:"componentDidUpdate",value:function(e){e.focusedHex!==this.props.focusedHex&&null!=this.props.focusedHex&&this.focusHex(this.props.focusedHex),this.updateCanvas()}},{key:"focusHex",value:function(e){var t=this,n=0;cn.a.addAnimation((function(a){0===n&&(n=a);var r=a-n,i=fn(e,t.state.cameraState.scale),o=Object(H.a)(i,2),s=o[0],l=o[1],c=.5*t.state.cameraState.dX+.5*s,u=.5*t.state.cameraState.dY+.5*l;return t.setState({cameraState:Object(U.a)({},t.state.cameraState,{dX:c,dY:u})}),r>1e3||Math.abs(s-c)<.01&&Math.abs(l-u)<.01}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"overworld-map-container"},r.a.createElement("canvas",{tabIndex:-1,ref:this.handleCanvasRef,onClick:this.handleCanvasClick,onMouseLeave:this.handleCanvasMouseLeave,onMouseMove:this.handleCanvasMouseMove,onWheel:this.handleWheel}),this.maybeRenderPopover())}},{key:"drawPossibleMigrationIntoArrows",value:function(e,t){var n=Object(H.a)(this.context,1)[0].overWorld,a=!0,r=!1,i=void 0;try{for(var o,s=n.possibleMigrationSources(t)[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;this.drawMigrationArrow(e,l,t)}}catch(c){r=!0,i=c}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"drawPossibleMigrationOutOfArrows",value:function(e,t){var n=Object(H.a)(this.context,1)[0].overWorld,a=!0,r=!1,i=void 0;try{for(var o,s=n.possibleMigrationTargets(t)[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;this.drawMigrationArrow(e,t,l)}}catch(c){r=!0,i=c}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"drawMigrationArrow",value:function(e,t,n){var a=this,r=null!=a.highlightedHex||null!=a.populationAttempt&&(t!==a.populationAttempt.sourceHex||n!==a.populationAttempt.targetHex);e.globalAlpha=r?.2:1;var i=this.state.cameraState.scale;e.shadowBlur=3*i/48,e.shadowOffsetX=4*i/48,e.shadowOffsetY=4*i/48,e.shadowColor="black",e.strokeStyle="white",e.lineWidth=3*i/48,e.lineCap="round",e.lineJoin="round";var o=Object(sn.a)(u.Vector2,Object(se.a)(mn(n,this.state.cameraState))),s=Object(sn.a)(u.Vector2,Object(se.a)(mn(t,this.state.cameraState))),l=s.clone().lerp(o,.2),c=o.clone().lerp(s,.2);!function(e,t,n,a,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10;e.beginPath();var o=a-t,s=r-n,l=Math.atan2(s,o);e.moveTo(t,n),e.lineTo(a,r),e.lineTo(a-i*Math.cos(l-Math.PI/6),r-i*Math.sin(l-Math.PI/6)),e.moveTo(a,r),e.lineTo(a-i*Math.cos(l+Math.PI/6),r-i*Math.sin(l+Math.PI/6)),e.stroke()}(e,l.x,l.y,c.x,c.y,10*i/48),e.shadowColor="transparent"}},{key:"maybeRenderPopover",value:function(){var e=this.state,t=e.cameraState,n=e.populationAttempt,a=e.highlightedHex;return null!=n?r.a.createElement(xn,{camera:t,tile:n.targetHex},r.a.createElement(yn,{playSpecies:n.settlingSpecies,tile:n.targetHex,onClickPlay:this.handleClickPlay})):null!=a?r.a.createElement(xn,{camera:t,tile:a},r.a.createElement(yn,{playSpecies:a.info.flora.species,tile:a,onClickPlay:this.handleClickPlay})):void 0}}]),t}(r.a.PureComponent);Cn.contextType=ht;n(290);var Sn=n(68),Pn=n(197),Mn=n(81),Tn=function(e){var t=e.genome,n=dt(),a=Object(H.a)(n,2)[1],i=r.a.useCallback((function(){var e=new d.a("Cell "+(t.cellTypes.length+1),0,new h.a,{texturePosition:new u.Vector2(1,1),color:new u.Color(Math.random(),Math.random(),Math.random())},{type:"give",resources:"water and sugar"});t.cellTypes.push(e),a({type:"AAUpdateSpecies"})}),[a,t.cellTypes]);return r.a.createElement("div",{className:"add-cell-card"},r.a.createElement("div",{className:"add-cell",onClick:i},"Add Cell"),r.a.createElement("button",{onClick:i},r.a.createElement(Mn.a,null)))},Rn=n(30),Nn=n(104),Fn=n(195),Dn=n.n(Fn);function Bn(e){var t;return function(){return void 0===t&&(t=e()),t}}var In=!1,Ln=Bn((function(){return(new u.TextureLoader).load(Dn.a,(function(e){e.magFilter=u.NearestFilter,e.flipY=!0,e.wrapS=e.wrapT=u.ClampToEdgeWrapping,Ln().dispatchEvent({type:"update"}),In=!0}))})),Vn={};function zn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"transparent";e=Math.floor(e),t=Math.floor(t);var a="".concat(e,",").concat(t);if(null==Vn[a]){var r=function(){var a=Ln().image,r=i.getContext("2d");r.fillStyle=n,r.fillRect(0,0,32,32),r.drawImage(a,32*e,32*t,32,32,0,0,32,32),o.needsUpdate=!0},i=document.createElement("canvas");i.width=32,i.height=32;var o=new u.Texture(i);o.magFilter=u.NearestFilter,o.flipY=!0,o.wrapS=u.RepeatWrapping,o.wrapT=u.RepeatWrapping,In?r():Ln().addEventListener("update",(function(){r()})),Vn[a]=o}return Vn[a]}var Wn={KeyS:"KeyW",KeyW:"KeyS",KeyA:"KeyD",KeyD:"KeyA"},Gn=new function e(){var t=this;Object(C.a)(this,e),this.keyMap=new Set,this.handleBlur=function(){t.keyMap.clear()},this.handleKeyDown=function(e){var n=e.code;if(t.keyMap.add(n),e.code in Wn&&t.keyMap.delete(Wn[n]),"KeyH"===n&&(T.a.hud=!T.a.hud),"Period"===n&&(T.a.showFPS=!T.a.showFPS),"Slash"===n&&(T.a.showGodUI=!T.a.showGodUI),!("KeyI"===n&&e.shiftKey&&e.ctrlKey||"KeyI"===n&&e.altKey&&e.metaKey))return e.preventDefault(),!1},this.handleKeyUp=function(e){t.keyMap.delete(e.code)},window.addEventListener("blur",this.handleBlur),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)},Hn=(n(291),n(17)),Un=function(e){var t=e.children,n=e.className,a=Object(Ge.a)(e,["children","className"]);return r.a.createElement("div",Object.assign({className:Ve()("action-bar-item",n)},a),t)},Yn=function(e){var t=e.children,n=e.cellType,a=e.spritesheetLoaded,i=Object(Ge.a)(e,["children","cellType","spritesheetLoaded"]),o=n.material,s=n.chromosome.getStaticProperties(),l=s.costSugar,c=s.costWater,u=s.timeToBuild,h=r.a.createElement("div",{className:"cost-to-build-info"},c,r.a.createElement(Hn.a,{name:"water"}),l,r.a.createElement(Hn.a,{name:"sugar"})),d=u>1?r.a.createElement("div",{className:"time-to-build-info"},u," sec"):null,m=o.color&&o.color.getStyle()||"transparent",f=zn(o.texturePosition.x,o.texturePosition.y,m),v=r.a.useMemo((function(){var e=f.image,t=function(){if(null!=e){if(e instanceof HTMLCanvasElement&&a)return e.toDataURL();if(e instanceof Image)return e.src;throw new Error("image is"+e)}return""}();return{backgroundImage:"url(".concat(t,"), linear-gradient(").concat(m,", ").concat(m,")")}}),[m,a,f.image]),p=Gn.keyMap.has("ShiftLeft")?r.a.createElement("div",{className:"costs"},d,h):null;return r.a.createElement(Un,Object.assign({},i,{className:Ve()("icon-cell",{reproducer:n.isReproducer()}),style:v}),t,p)},Kn=r.a.memo((function(e){var t=e.interaction,n=e.setInteraction,a=r.a.useCallback((function(e){var t=e.target.value;n(null==t?void 0:Xn[Number(t)])}),[n]),i=null==t?void 0:Xn.findIndex((function(e){return t.resources===e.resources&&t.type===e.type})),o=r.a.createElement("select",{className:"interaction-select",onChange:a,value:i},r.a.createElement("option",{value:void 0},"do nothing"),Xn.map((function(e,t){return r.a.createElement("option",{key:t,value:t},Object(d.c)(e))})));return r.a.createElement("div",{className:"interaction-select-container"},"Left-click to ",o,".")})),Qn=["water","sugar","water and sugar"],Xn=["give","take"].flatMap((function(e){return Qn.map((function(t){return{type:e,resources:t}}))}));Xn.push({type:"give",resources:"water take sugar"},{type:"give",resources:"sugar take water"});n(292);var Zn=r.a.createContext(null);n(293);function qn(e){var t=e.cost,n=e.className,a=Object(Ge.a)(e,["cost","className"]);return r.a.createElement("span",Object.assign({},a,{className:Ve()("gene-cost",n,{negative:t<0})}),t<0?"+":null,r.a.createElement(an.a,{value:Math.abs(t),speed:.5}))}n(294);var Jn=n(196),_n=n.n(Jn),$n=(n(309),function(e){var t=e.children,n=Object(a.useState)(!1),i=Object(H.a)(n,2),o=i[0],s=i[1],l=Object(a.useCallback)((function(){s((function(e){return!e}))}),[]),c=Object(a.useCallback)((function(){s(!1)}),[]),u=r.a.createElement("div",{className:"more-options"},t,r.a.createElement("button",{onClick:c},"Back"));return r.a.createElement(_n.a,{isOpen:o,preferPlace:"right",enterExitTransitionDurationMs:100,body:u,onOuterAction:c},r.a.createElement(Mn.c,{className:"more-options-icon",onClick:l}))}),ea=function(e){var t=e.cellType,n=e.gene,a=e.editable,i=void 0!==a&&a,o=e.draggable,s=void 0===o?i:o,l=r.a.useContext(Zn),c=Object(H.a)(l,2),u=c[0],h=c[1],d=n.gene,m=r.a.useCallback((function(e){e.dataTransfer.setData("mito/gene","data"),h((function(e){return Object(U.a)({},e,{dragged:{cellType:t,gene:n}})}))}),[t,n,h]),f=n.getCost();return r.a.createElement("div",{className:Ve()("gene",u.view,d.blueprint.name.replace(" ",""),{draggable:s}),draggable:s,onDragStart:m},r.a.createElement("div",{className:"gene-header"},r.a.createElement(qn,{cost:f}),r.a.createElement("h4",null,d.blueprint.name," ",n.gene.blueprint.levelCosts.length>1?n.level+1:""),i?r.a.createElement(ta,{cellType:t,gene:n}):null),r.a.createElement("div",{className:"description"},d.blueprint.description(n.getProps(),n.getStaticProperties())))},ta=function(e){var t=e.cellType,n=e.gene,i=dt(),o=Object(H.a)(i,2)[1],s=Object(a.useCallback)((function(){var e=t.chromosome.genes.indexOf(n);t.chromosome.genes.splice(e,1),o({type:"AAUpdateSpecies"})}),[t.chromosome.genes,o,n]);return r.a.createElement($n,null,r.a.createElement("button",{onClick:s,className:"delete"},r.a.createElement(Nn.a,null),"Delete"))},na=function(e){var t=e.genome,n=e.cellType,a=e.editable,i=void 0!==a&&a,o=n.chromosome,s=n.name,l=r.a.useContext(Zn),c=Object(H.a)(l,2),u=c[0],h=c[1],d=r.a.useCallback((function(e){if(e.preventDefault(),null!=u.dragged){var t=u.dragged,a=t.gene,r=t.cellType;r.chromosome.genes=r.chromosome.genes.filter((function(e){return e!==a})),n.chromosome.genes.push(a),h((function(e){return Object(U.a)({},e,{dragged:void 0})}))}}),[n.chromosome.genes,u.dragged,h]),m=r.a.useCallback((function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),f=r.a.useCallback((function(e){n.interaction=e}),[n.interaction]),v=n.isReproducer(),p=n.getChanceToBecomeCancerous(),y=p>0?r.a.createElement("div",{className:"chance-to-cancer"},"Cell may become cancerous: ",Object(Rn.a)(100*p*R.l,3),"% per day."):null,g=o.geneSlotsNet()<0;return r.a.createElement("div",{className:Ve()("cell-type",{reproducer:v})},r.a.createElement("div",{className:"cell-header"},r.a.createElement(Yn,{cellType:n,spritesheetLoaded:In}),r.a.createElement("div",{className:"cell-name"},r.a.createElement("h2",null,s),r.a.createElement(Kn,{key:n.name,interaction:n.interaction,setInteraction:f})),i?r.a.createElement(aa,{cellType:n,genome:t}):null),r.a.createElement("div",{className:"gene-slots"},"Gene Slots:"," ",r.a.createElement("span",{className:Ve()("slots-used",{"is-over":g})},r.a.createElement(an.a,{value:Math.abs(o.geneSlotsNet())})," ",g?"over":"under",".")),y,r.a.createElement("div",{className:"chromosome",onDragOver:m,onDrop:d},o.genes.map((function(e,t){return r.a.createElement(ea,{key:"".concat(t,",").concat(e.gene.blueprint.name,",").concat(e.level),cellType:n,gene:e,editable:i})}))))},aa=function(e){var t=e.cellType,n=e.genome,i=dt(),o=Object(H.a)(i,2)[1],s=Object(a.useCallback)((function(){var e=n.cellTypes.indexOf(t);n.cellTypes.splice(e,1),o({type:"AAUpdateSpecies"})}),[t,o,n.cellTypes]),l=t.chromosome.isEmpty();return r.a.createElement($n,null,r.a.createElement("button",{onClick:s,className:"delete",disabled:!l},r.a.createElement(Nn.a,null),l?"Delete":"Delete (Remove all genes first)"))},ra=(n(310),function(e){var t=e.genome,n=e.editable,r=void 0!==n&&n,i=a.useState({view:"expanded"}),o=Object(H.a)(i,2),s=o[0],l=o[1],c=a.useCallback((function(){l((function(e){return Object(U.a)({},e,{view:"small"})}))}),[l]),u=a.useCallback((function(){l((function(e){return Object(U.a)({},e,{view:"expanded"})}))}),[l]);return a.createElement(Zn.Provider,{value:i},a.createElement("div",{className:Ve()("genome-viewer",{dragging:null!=s.dragged})},a.createElement("div",{className:"view-switcher"},a.createElement(Pn.a,{onClick:c,className:Ve()("",{active:"small"===s.view})}),a.createElement(Sn.a,{onClick:u,className:Ve()("",{active:"expanded"===s.view})})),a.createElement("div",{className:"cell-types"},t.cellTypes.map((function(e){return a.createElement(na,{key:e.name,cellType:e,editable:r,genome:t})})),r?a.createElement(Tn,{genome:t}):null)))}),ia=(n(311),function(e){var t=e.species;return r.a.createElement("div",{className:"species-viewer"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"species-name"},t.name)),t.freeMutationPoints>0?r.a.createElement(oa,{species:t}):null,r.a.createElement(ra,{genome:t.genome,editable:!0}))}),oa=function(e){var t=e.species,n=t.freeMutationPoints,i=t.geneOptions.map((function(e,t){return r.a.createElement(Jt,{zScale:8,displayBlock:!0},r.a.createElement(ea,{key:t,gene:e,cellType:void 0,draggable:!0}))})),o=r.a.useState({view:"expanded"}),s=Object(H.a)(o,2),l=s[0],c=s[1],u=dt(),h=Object(H.a)(u,2)[1];return Object(a.useEffect)((function(){l.dragged&&(t.genome.cellTypes[0].chromosome.genes.push(l.dragged.gene),t.freeMutationPoints-=1,t.freeMutationPoints>0&&(t.geneOptions=ut(t)),c(Object(U.a)({},l,{dragged:void 0})),h({type:"AAUpdateSpecies",species:t}))}),[h,c,t,t.freeMutationPoints,t.geneOptions,t.genome.cellTypes,l,l.dragged]),r.a.createElement(Zn.Provider,{value:o},r.a.createElement("div",{className:"mutation-chooser"},r.a.createElement("h1",null,r.a.createElement(ze.a,{amount:n})," mutations available"),r.a.createElement("div",{className:"gene-options"},i)))},sa=r.a.memo((function(e){var t=e.onNextEpoch;Object(a.useEffect)((function(){return We.p.play(),function(){We.p.stop()}}),[]);var n=Object(a.useState)(!1),i=Object(H.a)(n,2),o=i[0],s=i[1];Object(a.useEffect)((function(){function e(e){"Tab"===e.code&&(s((function(e){return!e})),e.preventDefault())}return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[]);var l=Object(a.useState)(),c=Object(H.a)(l,2),u=c[0],h=c[1],d=Object(a.useCallback)((function(e){h(e)}),[]),m=dt(),f=Object(H.a)(m,1)[0].rootSpecies;var v=Object(a.useCallback)((function(){h(void 0)}),[]);var p=Object(a.useState)(void 0),y=Object(H.a)(p,2),g=y[0],b=y[1],w=Object(a.useCallback)((function(e){b(e)}),[]),A=dt(),O=Object(H.a)(A,1)[0],k=r.a.useCallback((function(){t(),P(4500).then((function(){var e=ke(f).filter((function(e){return e.freeMutationPoints>0}));h(e[0])}))}),[t,f]);return r.a.createElement("div",{className:"overworld-screen"},r.a.createElement(Cn,{focusedHex:g}),function(){var e=ke(f).map((function(e){return e.freeMutationPoints})).reduce((function(e,t){return e+t})),t=e>0?r.a.createElement("div",{className:"unused-points"},e):null;return r.a.createElement("div",{className:Ve()("panel-left",{open:o})},o?r.a.createElement($t,{onMutate:d}):null,r.a.createElement("button",{className:"panel-left-handle",onClick:function(){return s((function(e){return!e}))}},r.a.createElement(en.c,{className:"icon"}),t))}(),r.a.createElement(nn.a,{ariaHideApp:!1,isOpen:null!=u,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,onRequestClose:v,className:"species-viewer-modal"},null!=u?r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"close",onClick:v},"\u2716"),r.a.createElement(ia,{species:u})):null),r.a.createElement(on,{onNextEpoch:k,onFocusHex:w}),r.a.createElement("div",{style:{position:"absolute",right:"10px",top:"10px"}},r.a.createElement(Zt,{onClick:function(){return Kt(O)}},"Save")),r.a.createElement("div",{style:{position:"absolute",right:"10px",top:"60px"}},r.a.createElement(Zt,{onClick:function(){return window.confirm("Are you sure you want to reset your whole game?")?Yt.a.removeItem("gameData").then((function(){window.location.reload()})):Promise.reject()}},"Reset Game")))})),la=n(344),ca=n(105);function ua(e){return function(t,n){return"AATransitionEnd"===n.type?function(t,n){var a=t.transition,r=Object(Ge.a)(t,["transition"]);return e(r,a)}(t):e(t,n)}}function ha(e){var t=e.children,n=e.appState,a=r.a.useMemo((function(){return ua((e=mt,function(t,n){var a=e(t,n);return Xt.hasOwnProperty(n.type)&&(console.log("saved from",n),Kt(a)),a}));var e}),[]),i=r.a.useReducer(a,n),o=Object(H.a)(i,2),s=o[0],l=o[1],c=r.a.useMemo((function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,n=function(n){e(n),"AATransitionStart"===n.type&&P(t).then((function(){e({type:"AATransitionEnd"})}))};return n}(l)}),[]),u=r.a.useMemo((function(){return[s,c]}),[s,c]);return r.a.createElement(ht.Provider,{value:u},t)}var da=function(e){var t=e.children,n=e.loadingComponent,i=void 0===n?null:n,o=r.a.useState(null),s=Object(H.a)(o,2),l=s[0],c=s[1];return Object(a.useEffect)((function(){(function(){return Qt.apply(this,arguments)})().then((function(e){c(e),console.log("loading",e)})).catch((function(){var e=function(){var e=Wt.generateRectangle(100,50),t=Oe("plantum originus"),n=e.getStartHex();return{overWorld:e,rootSpecies:t,activePopulationAttempt:{settlingSpecies:t,targetHex:n},epoch:0}}();console.log("couldn't load appState from localForage; resetting game",e),c(e)}))}),[]),null==l?i:r.a.createElement(ha,{appState:l},t)};n(312);var ma=n(38),fa=n(340),va=function e(t){var n=this;Object(C.a)(this,e),this.position=new u.Vector2,this.isPressed=!1,this.button=-1,this.handleMouseDown=function(e){n.isPressed=!0,n.button=e.button,n.handleMouseMove(e)},this.handleMouseMove=function(e){n.position.x=e.clientX,n.position.y=e.clientY},this.handleMouseUp=function(e){n.isPressed=!1,n.button=-1,n.handleMouseMove(e)},t.addEventListener("mousedown",this.handleMouseDown),t.addEventListener("mousemove",this.handleMouseMove),t.addEventListener("mouseup",this.handleMouseUp)},pa={click:!0,contextmenu:!0,dblclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,touchstart:!0,touchmove:!0,touchend:!0,keyup:!0,keydown:!0,keypress:!0,wheel:!0},ya=function(){function e(t,n){Object(C.a)(this,e),this.renderer=t,this.audioContext=n,this.elements=void 0,this.events=void 0,this.timeElapsed=0,this.frameCount=0}return Object(S.a)(e,[{key:"aspectRatio",get:function(){return this.renderer.domElement.height/this.renderer.domElement.width}},{key:"resolution",get:function(){return new u.Vector2(this.renderer.domElement.width,this.renderer.domElement.height)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),e}();ya.id=void 0;var ga=n(198),ba=n.n(ga),wa=function e(t,n,a){Object(C.a)(this,e),this.target=t,this.scene=n,this.mito=a},Aa=n(83),Oa=function(e){return e[0]};function ka(){var e=Object(Aa.a)(["\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\nvarying float vRotation;\nvarying float vAlpha;\n\n#ifdef USE_MAP\n  uniform mat3 uvTransform;\n  uniform sampler2D map;\n#endif\n\nvec2 rotateAround ( in vec2 v, in vec2 center, in float angle ) {\n\n  float c = cos( angle );\n  float s = sin( angle );\n\n  float x = v.x - center.x;\n  float y = v.y - center.y;\n\n  vec2 r = vec2(x * c - y * s + center.x, x * s + y * c + center.y);\n\n  return r;\n}\n\nvoid main() {\n  gl_FragColor = vec4( color, 1. );\n\n  #ifdef USE_MAP\n    vec2 uv = gl_PointCoord;\n\n    // flip vRotation to account for flipped y viewport\n    uv = clamp(rotateAround(uv, vec2(0.5), -vRotation), vec2(0.), vec2(1.));\n    vec4 mapTexel = texture2D( map, uv );\n    gl_FragColor *= mapTexelToLinear( mapTexel );\n  #endif\n  gl_FragColor.a *= opacity * vAlpha;\n}\n"]);return ka=function(){return e},e}function Ea(){var e=Object(Aa.a)(["\nattribute float size;\nattribute float rotation;\nattribute float alpha;\nuniform float sizeGlobal;\n\nvarying float vAlpha;\nvarying float vRotation;\n\nvoid main() {\n  vRotation = rotation;\n  vAlpha = alpha;\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n  gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n  gl_Position = projectionMatrix * mvPosition;\n}\n"]);return Ea=function(){return e},e}var ja=function(e){function t(e,n){var a;return Object(C.a)(this,t),(a=Object(at.a)(this,Object(rt.a)(t).call(this))).params=n,a.geometry=void 0,a.material=void 0,a.index=0,a.geometry=t.newGeometry(e),a.material=new xa(n),a.frustumCulled=!1,a}return Object(it.a)(t,e),Object(S.a)(t,null,[{key:"newGeometry",value:function(e){var t=new u.BufferGeometry,n=new Float32Array(3*e),a=new Float32Array(e),r=new Float32Array(e),i=new Float32Array(e);return t.setAttribute("position",new u.BufferAttribute(n,3).setUsage(u.DynamicDrawUsage)),t.setAttribute("rotation",new u.BufferAttribute(a,1).setUsage(u.DynamicDrawUsage)),t.setAttribute("size",new u.BufferAttribute(r,1).setUsage(u.DynamicDrawUsage)),t.setAttribute("alpha",new u.BufferAttribute(i,1).setUsage(u.DynamicDrawUsage)),t}}]),Object(S.a)(t,[{key:"startFrame",value:function(){this.index=0}},{key:"commit",value:function(e,t,n,a,r,i){this.geometry.attributes.position.setXYZ(this.index,e,t,n),this.geometry.attributes.size.setX(this.index,a),this.geometry.attributes.alpha.setX(this.index,r),null!=i&&this.geometry.attributes.rotation.setX(this.index,i),this.index++}},{key:"endFrame",value:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.attributes.rotation.needsUpdate=!0,this.geometry.attributes.alpha.needsUpdate=!0,this.geometry.setDrawRange(0,this.index)}}]),t}(u.Points),xa=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(at.a)(this,Object(rt.a)(t).call(this,{uniforms:{opacity:{value:e.opacity},sizeGlobal:{value:e.size},color:{value:e.color},map:{value:e.map}},vertexShader:Ca,fragmentShader:Sa,depthTest:!1,transparent:!0}))).params=e,n.map=void 0,n.map=e.map,n}return Object(it.a)(t,e),t}(u.ShaderMaterial),Ca=Oa(Ea()),Sa=Oa(ka()),Pa=function(e){function t(e,n){var a;return Object(C.a)(this,t),(a=Object(at.a)(this,Object(rt.a)(t).call(this,1e4,n))).lifeFn=e,a.state=new Set,a}return Object(it.a)(t,e),Object(S.a)(t,[{key:"fire",value:function(e){this.state.add(e)}},{key:"update",value:function(e){var t=[],n=!0,a=!1,r=void 0;try{for(var i,o=this.state[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;s.time+=e,!1===this.lifeFn(s,e)&&t.push(s)}}catch(h){a=!0,r=h}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}for(var l=0,c=t;l<c.length;l++){var u=c[l];this.state.delete(u)}}},{key:"commitAll",value:function(){this.startFrame();var e=!0,t=!1,n=void 0;try{for(var a,r=this.state[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var i=a.value;this.commit(i.x,i.y,i.z,i.size,i.alpha,i.r)}}catch(o){t=!0,n=o}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}this.endFrame()}}]),t}(ja),Ma=n(45),Ta=function(e){function t(e,n){var a;return Object(C.a)(this,t),(a=Object(at.a)(this,Object(rt.a)(t).call(this,[],n.scene,n.mito))).eventName=e,a.worldRenderer=n,a}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){this.target=this.worldRenderer.target.getLastStepStats().events[this.eventName]}}]),t}(wa),Ra=function(e){function t(e,n,a){var r;return Object(C.a)(this,t),(r=Object(at.a)(this,Object(rt.a)(t).call(this,e,n))).eventName=e,r.worldRenderer=n,r.ffPoints=a,r.scene.add(r.ffPoints),r}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){Object(Ma.a)(Object(rt.a)(t.prototype),"update",this).call(this),this.ffPoints.update(1/30);var e=!0,n=!1,a=void 0;try{for(var r,i=this.target[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.handle(o)}}catch(s){n=!0,a=s}finally{try{e||null==i.return||i.return()}finally{if(n)throw a}}this.ffPoints.commitAll()}},{key:"destroy",value:function(){this.scene.remove(this.ffPoints)}}]),t}(Ta),Na=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(at.a)(this,Object(rt.a)(t).call(this,"cell-eat",e,t.makePoints()))).audio=function(){var e=new u.Audio(n.mito.audioListener);return e.loop=!0,e.setVolume(0),We.i.then((function(t){e.setBuffer(t),e.play(),e.setDetune(600)})),e}(),n}return Object(it.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new Pa((function(e){if(e.time>.6)return!1;var t=e.time/.6;e.size=4*(t-t*t)}),{color:new u.Color("yellow"),opacity:.8,size:200,map:zn(1,3,"transparent")})}}]),Object(S.a)(t,[{key:"handle",value:function(e){var t=e.who,n=.04*Object(We.e)(t,this.mito.world.player);n>this.audio.gain.gain.value&&(this.audio.gain.gain.setValueAtTime(n,0),this.audio.gain.gain.cancelScheduledValues(this.audio.context.currentTime+1),this.audio.gain.gain.setTargetAtTime(0,this.audio.context.currentTime+1,.1));var a=this.worldRenderer.renderers.get(t),r=a&&a.inventoryRenderer.getActiveSugar(),i=r&&r.x||0,o=r&&r.y||0;this.ffPoints.fire({x:t.pos.x+i,y:t.pos.y+o,z:1,size:1,alpha:1,info:e,time:0})}}]),t}(Ra),Fa=function(e){function t(e){return Object(C.a)(this,t),Object(at.a)(this,Object(rt.a)(t).call(this,"cell-transfer-energy",e,t.makePoints()))}return Object(it.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new Pa((function(e){if(e.time>.5)return!1;var t=e.time/.5,n=4*(t-t*t),a=e.info,r=a.from,i=a.to,o=r.pos.clone().lerp(i.pos,Object(X.d)(t,0,1,.45,.55)),s=o.x,l=o.y;e.x=s,e.y=l,e.size=n}),{color:new u.Color("yellow"),opacity:.8,size:350,map:zn(2,3,"transparent")})}}]),Object(S.a)(t,[{key:"handle",value:function(e){var t=e.from,n=e.to,a=Math.atan2(n.pos.y-t.pos.y,n.pos.x-t.pos.x);this.ffPoints.fire({x:e.from.pos.x,y:e.from.pos.y,r:a,z:1,size:.1,alpha:1,info:e,time:0})}}]),t}(Ra);function Da(e){return function(t){return e(1-t)}}function Ba(e){return 4*(e-e*e)}var Ia=Da((function(e){return Object(X.a)(6.75*(e*e-e*e*e),0,1)})),La=function(e){function t(e){var n;Object(C.a)(this,t),(n=Object(at.a)(this,Object(rt.a)(t).call(this,"collect-sunlight",e))).ffPoints=void 0;return n.ffPoints=new Pa((function(e){if(e.time>.5)return!1;var t=Object(X.a)(e.time/.5,0,1);e.alpha=Ia(t),e.size=Ia(t)}),{color:new u.Color("white"),opacity:.8,size:35,map:zn(0,4)}),n.scene.add(n.ffPoints),n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"handle",value:function(e){for(var t=e.numSunlight,n=e.leaf,a=e.point;t>0;){if(t<1&&t<Math.random())return;var r=null==a?n.pos.x+.05*(Math.random()-.5):a.x+Object(X.f)(-.1,.1),i=null==a?n.pos.y+.05*(Math.random()-.5):a.y+Object(X.f)(-.1,.1),o=this.worldRenderer.renderers.get(n);if(o){var s=Object(X.e)(o.inventoryRenderer.waters);r+=s.x,i+=s.y}this.ffPoints.fire({x:r,y:i,z:10,size:0,alpha:0,info:0,time:0}),t--}}},{key:"update",value:function(){Object(Ma.a)(Object(rt.a)(t.prototype),"update",this).call(this),this.ffPoints.update(1/30);var e=!0,n=!1,a=void 0;try{for(var r,i=this.target[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.handle(o)}}catch(s){n=!0,a=s}finally{try{e||null==i.return||i.return()}finally{if(n)throw a}}this.ffPoints.commitAll()}},{key:"destroy",value:function(){this.scene.remove(this.ffPoints)}}]),t}(Ta),Va=1,za=45,Wa=.003,Ga=function(e){function t(e,n,a){var r;return Object(C.a)(this,t),(r=Object(at.a)(this,Object(rt.a)(t).call(this,e,n,a))).animationOffset=0,r.waters=[],r.sugars=[],r.activeSugar=void 0,r.stableWater=void 0,r.handleGetResources=function(e){r.updateSugarAndWaterParticles(e)},r.handleGiveResources=function(){r.updateSugarAndWaterParticles()},r.handleAddResources=function(e,t){r.updateSugarAndWaterParticles()},e.on("get",r.handleGetResources),e.on("give",r.handleGiveResources),e.on("add",r.handleAddResources),r.updateSugarAndWaterParticles(),r}return Object(it.a)(t,e),Object(S.a)(t,null,[{key:"startFrame",value:function(){t.WaterParticles().startFrame(),t.SugarParticles().startFrame()}},{key:"endFrame",value:function(){t.WaterParticles().endFrame(),t.SugarParticles().endFrame()}}]),Object(S.a)(t,[{key:"verifyArrayLengths",value:function(){if(this.waters.length!==Math.ceil(this.target.water*Va))throw new Error("water array lengths mismatch: "+this.waters.length+" should be "+Math.ceil(this.target.water));if(this.sugars.length!==Math.ceil(this.target.sugar))throw new Error("sugar array lengths mismatch: "+this.sugars.length+" should be "+Math.ceil(this.target.sugar))}},{key:"updateSugarAndWaterParticles",value:function(e){this.updateParticlesArray(this.waters,this.target.water*Va,e),this.updateParticlesArray(this.sugars,this.target.sugar,e),this.verifyArrayLengths()}},{key:"updateParticlesArray",value:function(e,t,n){for(var a=Math.ceil(t);e.length<a;){var r=null!=n?n.carrier.pos.clone().sub(this.target.carrier.pos):new u.Vector2(.01*(Math.random()-.5),.01*(Math.random()-.5));r.x+=.1*(Math.random()-.5),r.y+=.1*(Math.random()-.5),e.push(r)}if(e.length>a&&e.splice(a),e.length!==a)throw new Error("array lengths mismatch: "+e.length+" should be "+a);return e}},{key:"commitParticles",value:function(e,t,n){for(var a=Math.floor(t),r=0;r<a;r++){var i=n[r];e.commit(i.x+this.target.carrier.pos.x,i.y+this.target.carrier.pos.y,10,1,1)}var o=t-a;if(o>0){var s=n[n.length-1];e.commit(s.x+this.target.carrier.pos.x,s.y+this.target.carrier.pos.y,10,Object(X.d)(Math.sqrt(o),0,1,.2,1),1)}}},{key:"simulateResourcePositions",value:function(){for(var e=this.waters.length,t=e+this.sugars.length,n=0;n<t;n++){var a=n<e?this.waters[n]:this.sugars[n-e],r=0,i=0,o=cn.a.now/3e3+this.animationOffset;r+=.02*Math.cos(o);var s=.1+.1*a.length();r+=-a.x*s,i+=-a.y*s;var l=this.mito.world.player;if(l.pos.equals(this.target.carrier.pos)){var c=l.posFloat.x-l.pos.x,u=l.posFloat.y-l.pos.y,h=a.x-c,d=a.y-u,m=h*h+d*d,f=Math.max(Math.min(Object(X.d)(m,0,1,3,-5),3),0);r+=h*f*.2,i+=d*f*.2}for(var v=0;v<t;v++){var p=v<e?this.waters[v]:this.sugars[v-e];if(a===p)break;var y=a.x-p.x,g=a.y-p.y,b=y*y+g*g;if(b>0){var w=v<e?v===this.waters.length-1:v-e===this.sugars.length-1,A=Wa/b;if(w)A*=v<e?this.target.water%1:this.target.sugar%1;r+=y*A,i+=g*A}}a.x+=r,a.y+=i}}},{key:"update",value:function(){this.simulateResourcePositions(),this.commitParticles(t.WaterParticles(),this.target.water*Va,this.waters),this.commitParticles(t.SugarParticles(),this.target.sugar,this.sugars),this.activeSugar=this.sugars[this.sugars.length-1],this.stableWater=this.waters[0]}},{key:"destroy",value:function(){this.target.off("get",this.handleGetResources),this.target.off("give",this.handleGiveResources),this.target.off("add",this.handleAddResources)}},{key:"getActiveSugar",value:function(){return this.activeSugar}},{key:"getStableWater",value:function(){return this.stableWater}}]),t}(wa);Ga.WaterParticles=Bn((function(){return new ja(1e4,{color:new u.Color("rgb(9, 12, 255)"),size:za,opacity:.75})})),Ga.SugarParticles=Bn((function(){return new ja(1e4,{color:new u.Color("yellow"),size:85,opacity:.9,map:zn(2,2,"transparent")})}));var Ha=function(e){function t(e){return Object(C.a)(this,t),Object(at.a)(this,Object(rt.a)(t).call(this,"evaporation",e,t.makePoints()))}return Object(it.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new Pa((function(e){if(e.time>1.5)return!1;var t=e.time/1.5,n=1+t,a=1-t;e.x+=.01*Math.sin(12*t),e.y-=.01,e.alpha=a,e.size=n}),Object(U.a)({},Ga.WaterParticles().params))}}]),Object(S.a)(t,[{key:"handle",value:function(e){if(!(e.tile.darkness>=1)){var t=this.worldRenderer.renderers.get(e.tile),n=t&&t.inventoryRenderer.getStableWater(),a=n&&n.x||0,r=n&&n.y||0;this.ffPoints.fire({x:e.tile.pos.x+a,y:e.tile.pos.y+r,z:1,size:1,alpha:1,info:e,time:0})}}}]),t}(Ra),Ua=n(339),Ya=function(e){function t(e){return Object(C.a)(this,t),Object(at.a)(this,Object(rt.a)(t).call(this,"grow-fruit",e,t.makePoints()))}return Object(it.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new Pa((function(e){if(e.time>2.5)return!1;var t=e.time/2.5,n=e.info,a=n.cell,r=n.resourcesUsed,i=n.a0,o=Object(X.d)(Object(Ua.a)(t),0,1,1.2,.5),s=Object(X.d)(function(e){return(e=Object(X.a)(e,0,1))*e*(3-2*e)}(t),0,1,0,1.5*Math.PI)+i,l=Math.sqrt(Ba(t))*r;e.x=a.pos.x+Math.cos(s)*o,e.y=a.pos.y+Math.sin(s)*o,e.size=l,e.r=s}),{size:80,opacity:.8,color:new u.Color("purple"),map:zn(0,4)})}}]),Object(S.a)(t,[{key:"handle",value:function(e){for(var t=e.cell,n=0;n<4;n++)this.ffPoints.fire({x:t.pos.x,y:t.pos.y,z:1,alpha:1,info:Object(U.a)({},e,{a0:Math.random()*Math.PI*2}),size:0,time:0})}}]),t}(Ra),Ka=function(e){function t(e){return Object(C.a)(this,t),Object(at.a)(this,Object(rt.a)(t).call(this,"photosynthesis",e,t.makePoints()))}return Object(it.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new Pa((function(e){if(e.time>.5)return!1;var t=e.time/.5;e.alpha=Math.pow(Ba(t),.25),e.size=Math.pow(1-t,1)/2*2*e.info.amount,e.r=t*e.time}),{color:new u.Color("yellow"),opacity:.95,size:200,map:zn(3,3)})}}]),Object(S.a)(t,[{key:"handle",value:function(e){var t=this.worldRenderer.renderers.get(e.cell),n=t&&t.inventoryRenderer.getStableWater(),a=n&&n.x||0,r=n&&n.y||0;this.ffPoints.fire({x:e.cell.pos.x+a,y:e.cell.pos.y+r,z:1,size:1,alpha:1,info:e,time:0})}}]),t}(Ra),Qa=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(r)))).renderers=[],n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e;for(e=0;e<this.target.effects.length;e++){var t=this.target.effects[e],n=this.renderers[e];null==n?this.renderers[e]=Xa(t,this.scene,this.mito):t!==n.target&&(n.destroy(),this.renderers[e]=Xa(t,this.scene,this.mito))}for(;e<this.renderers.length;e++){this.renderers[e].destroy()}var a=!0,r=!1,i=void 0;try{for(var o,s=this.renderers[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){o.value.update()}}catch(l){r=!0,i=l}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"destroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,r=this.renderers[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){a.value.destroy()}}catch(i){t=!0,n=i}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}}]),t}(wa);function Xa(e,t,n){if(e instanceof c.e)return new qa(e,t,n);if(e instanceof ge.a)return new Ja(e,t,n);throw new Error("effect renderer not defined for"+e)}var Za=new u.Color("lightblue"),qa=function(e){function t(e,n,a){var r;return Object(C.a)(this,t),(r=Object(at.a)(this,Object(rt.a)(t).call(this,e,n,a))).mesh=void 0,r.mesh=t.newMesh(),n.add(r.mesh),r.mesh.scale.set(.01,.01,1),r}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target.percentFrozen,t=Math.pow(e,.5);this.mesh.scale.x=Object(X.b)(this.mesh.scale.x,t,.2),this.mesh.scale.y=Object(X.b)(this.mesh.scale.y,t,.2);var n=this.target.cell,a=n.pos;this.mesh.position.set(a.x,a.y+n.droopY,2)}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(wa);qa.newMesh=function(){var e=new u.PlaneBufferGeometry(1,1),t=new u.MeshBasicMaterial({map:zn(1,2),side:u.DoubleSide,color:Za,transparent:!0,opacity:.5}),n=new u.Mesh(e,t);return function(){return n.clone()}}();var Ja=function(e){function t(e,n,a){var r;return Object(C.a)(this,t),(r=Object(at.a)(this,Object(rt.a)(t).call(this,e,n,a))).mesh=void 0,r.lastTimeToDuplicate=void 0,r.mesh=t.newMesh(),n.add(r.mesh),r.mesh.scale.set(.01,.01,1),r.lastTimeToDuplicate=r.target.timeToDuplicate,r}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target,t=e.timeToDuplicate,n=e.secondsPerDuplication,a=Object(X.a)(Math.pow(1-t/n,.5),.05,1);this.mesh.scale.x=Object(X.b)(this.mesh.scale.x,a,.2),this.mesh.scale.y=Object(X.b)(this.mesh.scale.y,a,.2);var r=this.target.cell,i=r.pos;t>this.lastTimeToDuplicate&&((i=i.clone()).x+=Object(X.f)(-.1,.1),i.y+=Object(X.f)(-.1,.1)),this.mesh.position.set(i.x,i.y+r.droopY,2),this.lastTimeToDuplicate=t}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(wa);Ja.newMesh=function(){var e=new u.RingBufferGeometry(.1,.5,20,20),t=new u.MeshBasicMaterial({map:zn(0,1),side:u.DoubleSide,color:new u.Color(16711935),transparent:!0,opacity:.5}),n=new u.Mesh(e,t);return function(){return n.clone()}}();var _a=function(e){function t(e){return Object(C.a)(this,t),Object(at.a)(this,Object(rt.a)(t).call(this,"thaw",e,t.makePoints()))}return Object(it.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new Pa((function(e,t){if(e.time>.6)return!1;var n=e.time/.6,a=e.info,r=a.dx,i=a.dy;e.x+=r*t,e.y+=i*t,e.alpha=n<.75?1:Object(fa.c)(Object(X.d)(n,.75,1,1,0))}),{size:40,opacity:.5,color:Za})}}]),Object(S.a)(t,[{key:"handle",value:function(e){for(var t=e.where,n=0;n<4;n++){var a=Math.random()*Math.PI*2,r=1*Math.cos(a),i=1*Math.sin(a);this.ffPoints.fire({x:t.pos.x,y:t.pos.y,z:1,alpha:1,info:{dx:r,dy:i},size:Object(X.d)(Math.random(),0,1,.5,1.5),time:0,r:a})}}}]),t}(Ra),$a=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(at.a)(this,Object(rt.a)(t).call(this,e,e.scene,e.mito))).singleEventRenderers={"cell-eat":new Na(n.target),"cell-transfer-energy":new Fa(n.target),evaporation:new Ha(n.target),photosynthesis:new Ka(n.target),thaw:new _a(n.target),"collect-sunlight":new La(n.target),"grow-fruit":new Ya(n.target)},n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e,t=this.target.target.getLastStepStats().events;for(e in t){var n=this.singleEventRenderers[e];null!=n&&n.update()}}},{key:"destroy",value:function(){for(var e=0,t=Object.values(this.singleEventRenderers);e<t.length;e++){var n=t[e];null!=n&&n.destroy()}}}]),t}(wa),er=function(){var e=new u.CircleBufferGeometry(.07,20),t=new u.MeshBasicMaterial({color:6207360,side:u.DoubleSide});return new u.Mesh(e,t)}(),tr=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.Vector2(0,0),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(C.a)(this,e),this.pos=t,this.vel=n,this.scale=a},nr=function(e){function t(e){var n,a,r;Object(C.a)(this,t),(r=Object(at.a)(this,Object(rt.a)(t).call(this))).nodes=[],r.meshes=[],r.line=void 0,r.pullForceScalar=10,r.towardsTargetForce=5,r.dragForceScalar=-3,r.goTowardsTargetForce=function(){var e=new u.Vector2;return function(t,n,a,r){return e.copy(n).multiplyScalar(a).sub(t.pos),e.multiplyScalar(r)}}(),r.dragForce=function(){var e=new u.Vector2;return function(t,n){return e.copy(t.vel).multiplyScalar(n),e}}(),r.pullForce=function(){var e=new u.Vector2;return function(t,n,a){return e.copy(t.pos).sub(n.pos),e.multiplyScalar(-a)}}(),r.nodes=Y(e).map((function(t){return new tr(new u.Vector2(t/e,0))})),r.meshes=r.nodes.map((function(e){var t=er.clone();return t.position.set(e.pos.x,e.pos.y,t.position.z),t})),(n=r).add.apply(n,Object(se.a)(r.meshes));var i=new u.Geometry;return(a=i.vertices).push.apply(a,Object(se.a)(r.meshes.map((function(e){return e.position})))),r.line=new u.Line(i,new u.LineBasicMaterial({color:6207360})),r.add(r.line),r}return Object(it.a)(t,e),Object(S.a)(t,[{key:"handleInteracted",value:function(){this.nodes[this.nodes.length-1].scale=2.1}},{key:"update",value:function(e,t){var n=this,a=this.nodes[this.nodes.length-1];Object(X.c)(a.pos,t,.5);for(var r=new u.Vector2,i=1;i<this.nodes.length-1;i++){r.set(0,0);var o=this.nodes[i],s=this.nodes[i-1],l=this.nodes[i+1];r.add(this.pullForce(o,s,this.pullForceScalar)),r.add(this.pullForce(o,l,this.pullForceScalar)),r.add(this.goTowardsTargetForce(o,t,i/(this.nodes.length-1),this.towardsTargetForce)),r.add(this.dragForce(o,this.dragForceScalar)),o.scale=Object(X.b)(o.scale,l.scale,.5),o.vel.add(r.multiplyScalar(e))}this.nodes.forEach((function(t,a){t.pos.x+=t.vel.x*e,t.pos.y+=t.vel.y*e;var r=n.meshes[a];r.position.set(t.pos.x,t.pos.y,r.position.z),r.scale.set(t.scale,t.scale,1)})),a.scale=Object(X.b)(a.scale,1,.5),this.line.geometry.verticesNeedUpdate=!0}}]),t}(u.Object3D),ar=function(){function e(){Object(C.a)(this,e),this.animation=void 0,this.timeStarted=void 0,this.timeLastUpdated=void 0}return Object(S.a)(e,[{key:"set",value:function(e){this.animation=e,this.timeLastUpdated=this.timeStarted=cn.a.now/1e3}},{key:"update",value:function(){if(null!=this.animation&&null!=this.timeStarted&&null!=this.timeLastUpdated){var e=cn.a.now/1e3,t=e-this.timeStarted,n=e-this.timeLastUpdated,a=this.animation(t,n);this.timeLastUpdated=e,a&&(this.animation=void 0,this.timeStarted=void 0,this.timeLastUpdated=void 0)}}}]),e}();function rr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=0,r=0;return function(e,n){return(0,t[a])(e-r,n)&&(a++,r=e),a>=t.length}}function ir(e,t){var n=!1;return function(a,r){var i=e(a,r);return n||(n=t(a,r)),i}}function or(e){return function(t){return t>e}}var sr=function(e){function t(e,n,a){var r;return Object(C.a)(this,t),(r=Object(at.a)(this,Object(rt.a)(t).call(this,e,n,a))).mesh=void 0,r.neuronMesh=new nr(8),r.animation=new ar,r.handleStartLongAction=function(e){"build"===e.effect.type&&r.animation.set(r.buildReproducerAnimation(e))},r.handleAction=function(e){if("pickup"===e.type||"drop"===e.type){if(r.neuronMesh.handleInteracted(),We.m.fade(1,0,200),We.m.rate(Object(X.f)(.8,1.5)),"drop"===e.type&&(e.sugar>0&&We.f.play(),e.water>0)){var t=We.g.play();We.g.fade(.2,0,400,t)}}else if("build"===e.type){var n=We.b.play();We.b.rate(Object(X.f)(.5,1),n)}else if("deconstruct"===e.type){var a=We.d.play();We.d.rate(Object(X.f)(.9,1.1),a)}else"move"===e.type&&(We.j.fade(.1,0,50),We.j.rate(Object(X.f)(.8,1.5)))},r.prevHighlightedTile=void 0,r.mesh=lr(),r.mesh.name="Player Mesh",Object(X.c)(r.mesh.position,r.target.pos,1),r.mesh.position.z=2,r.mesh.add(r.neuronMesh),P(300).then((function(){r.scene.add(r.mesh)})),r.target.on("start-long-action",r.handleStartLongAction),r.target.on("action",r.handleAction),r}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e,t,n=this.target.droopPosFloat().clone();this.target.world.getLastStepStats().events.oof[0]&&this.mito.addFloatingText(n,"oof"),this.mesh.position.set(n.x,n.y,2);var a=Gn.keyMap.has("ShiftLeft"),r=null!==(e=null===(t=this.mito.controls)||void 0===t?void 0:t.wouldLeftClickInteract())&&void 0!==e&&e&&!a,i=this.mito.getHighlightedTile(),o=r?i.pos.clone().sub(n):cr;if(this.prevHighlightedTile!==i){var s=We.q.play();We.q.rate(Object(X.f)(.9,1.1),s),We.q.volume(Object(X.f)(.8,1),s)}this.neuronMesh.update(r?1/60*10:1/60*5,o),this.prevHighlightedTile=i,this.animation.update()}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}},{key:"buildReproducerAnimation",value:function(e){var t=this,n=or(.5),a=0,r=this.animSendCopy(e.effect.position),i=or(.5);return ir(rr(n,(function(e,n){var r=e/1.5,i=Object(X.a)(r,0,1),o=9*Math.sqrt(i),s=.15*Math.pow(i,1.5);return a+=n*Math.PI*2*o,t.mesh.position.x+=Math.sin(a)*s,r>1}),ir(r,(function(e){var n=e/.25,a=Object(X.d)(Object(X.a)(4*(n-n*n),0,1),0,1,1,1.5);return t.mesh.scale.set(a,a,1),e>n})),i),(function(){return t.mito.suggestCamera({center:t.target.posFloat,zoom:3}),!1}))}},{key:"animSendCopy",value:function(e){var t=this,n=lr();n.scale.x=1*this.mesh.scale.x,n.scale.y=1*this.mesh.scale.y,n.position.z=this.mesh.position.z-.01,this.scene.add(n);return rr((function(e){var a=e/.5,r=.5*Object(fa.b)(a);return t.mesh.position.x-=r,Object(X.c)(n.position,t.target.droopPosFloat(),1),n.position.x+=r,a>1}),ir(or(.5),(function(e){return t.mesh.position.x-=.5,!1})),ir((function(a,r){var i=a/1.2;return Object(X.c)(n.position,e,.1),Object(X.c)(n.scale,{x:.2*t.mesh.scale.x,y:.2*t.mesh.scale.y},.1),i>1}),(function(e){var n=e/.5,a=.5*Object(fa.b)(1-n);return t.mesh.position.x-=a,n>1})),(function(e){var a=e/.5;Object(X.c)(n.scale,{x:.2*t.mesh.scale.x,y:.2*t.mesh.scale.y},1),Object(X.c)(n.scale,{x:0,y:0},Object(fa.b)(a));var r=a>1;return r&&t.scene.remove(n),r}))}}]),t}(wa);function lr(){var e=new u.Mesh(new u.PlaneBufferGeometry(.75,.75),new u.MeshBasicMaterial({transparent:!0,map:zn(3,2,"transparent"),color:new u.Color("white"),side:u.DoubleSide}));return e.renderOrder=9,e}var cr=new u.Vector2,ur=n(341),hr=n(342),dr=function(e){function t(e,n,a){var r;Object(C.a)(this,t),(r=Object(at.a)(this,Object(rt.a)(t).call(this,e,n,a))).mesh=void 0,r.animation=new ar;var i=e.world.genome.cellTypes.find((function(e){return e.chromosome.getStaticProperties().isReproductive})).material;return r.mesh=function(e){var t,n=new u.Mesh(new u.PlaneBufferGeometry(1,1),new u.MeshBasicMaterial({transparent:!0,map:zn(e.texturePosition.x,e.texturePosition.y),color:null!==(t=e.color)&&void 0!==t?t:new u.Color("white"),side:u.DoubleSide}));return n.renderOrder=9,n}(i),r.mesh.name="Player Seed Mesh",r.mito.scenePlayerSeed.add(r.mesh),r.animation.set(rr(r.fallInAnimation(),or(2),r.wiggleAnimationForever())),r}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target.posFloat.clone();this.mesh.rotation.set(0,0,0),this.mesh.position.set(e.x,e.y,11),this.animation.update()}},{key:"destroy",value:function(){var e=this;this.animation.set(rr(this.popOutAnimation(),(function(){return e.scene.remove(e.mesh),!0}))),cn.a.addAnimation((function(t){if(e.animation.update(),null==e.animation.animation)return!0}))}},{key:"popOutAnimation",value:function(){var e=this;return rr(ir((function(t){var n=t/.5;return e.mesh.scale.setScalar(Object(X.b)(1,6.5,Object(ur.a)(n))),n>1}),(function(){return We.k.play(),!0})),(function(t){return e.mesh.scale.setScalar(6.5),t>1}),(function(t){var n=t/.5;return e.mesh.material.opacity=Object(X.b)(1,0,n),n>1}))}},{key:"fallInAnimation",value:function(){var e=this;return rr(ir(or(1),(function(t){return e.mesh.position.y-=12,!1})),ir((function(t){var n=t/2;return e.mesh.position.y-=Object(X.b)(12,0,Object(hr.a)(n)),n>1}),(function(){return We.n.play(),!0})))}},{key:"wiggleAnimationForever",value:function(){var e=this;return function(t){var n=t%3;if(n<1){var a=n/1,r=Math.sin(Object(X.d)(Math.sin(a*Math.PI*4),-1,1,-Math.PI/6,Math.PI/6))*Ba(a);e.mesh.position.y-=Math.abs(1*r)}return!1}}}]),t}(wa);var mr=function(){},fr=n(35),vr=function(e){function t(e,n){var a;return Object(C.a)(this,t),(a=Object(at.a)(this,Object(rt.a)(t).call(this,e,n.scene,n.mito))).tileRenderer=n,a.init(),a}return Object(it.a)(t,e),Object(S.a)(t,[{key:"init",value:function(){}}]),t}(wa),pr=function(){var e=new u.BufferGeometry;return e.setAttribute("position",new u.Float32BufferAttribute([0,0,0,0,1,0],3)),e}();function yr(e,t,n,a){var r=new u.Line(pr,new u.LineBasicMaterial({color:a}));if(r.position.copy(t),e.y>.99999)r.quaternion.set(0,0,0,1);else if(e.y<-.99999)r.quaternion.set(1,0,0,0);else{var i=new u.Vector3(e.z,0,-e.x).normalize(),o=Math.acos(e.y);r.quaternion.setFromAxisAngle(i,o)}return r.scale.set(1,Math.max(0,n),1),r.position.z=.1,r.updateMatrix(),r.matrixAutoUpdate=!1,r}var gr=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(r)))).audio=function(){var e=new u.Audio(n.mito.audioListener);return We.a.then((function(t){return e.setBuffer(t)})),e}(),n.lastAudioValueTracker=0,n.neighborLines=new u.Object3D,n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target.state.totalSugarProduced;if(e>this.lastAudioValueTracker){var t=this.target.state.sugarConverted*this.target.state.sugarConverted,n=Object(We.e)(this.target.cell,this.mito.world.player)*t;this.audio.setVolume(n),this.audio.play(),this.tileRenderer.animation.set(this.tileRenderer.growPulseAnimation())}this.lastAudioValueTracker=e,null!=this.neighborLines.parent&&this.scene.remove(this.neighborLines)}},{key:"hover",value:function(){var e=this;this.scene.add(this.neighborLines),this.neighborLines.position.set(this.tileRenderer.target.pos.x,this.tileRenderer.target.pos.y,1);var t,n=this.target.state.activeNeighbors;n.length!==this.neighborLines.children.length&&((t=this.neighborLines).remove.apply(t,Object(se.a)(this.neighborLines.children)),n.forEach((function(t){var n=t.length()-.25,a=yr(new u.Vector3(t.x,t.y,0).normalize(),new u.Vector3,n,br);e.neighborLines.add(a)})))}},{key:"destroy",value:function(){this.scene.remove(this.neighborLines),null!=this.audio&&this.audio.disconnect()}}]),t}(vr),br=16763150,wr=(n(313),new u.BoxBufferGeometry(.2,.1)),Ar=new Map;var Or,kr=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(i)))).meshes={},n.argsEditor=void 0,n.positionFn=function(){return n.target.cell},n.renderFn=function(){return r.a.createElement(Er,{gene:n.target})},n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e,t=this.target.state.connections;for(e in this.target.state.connections)t[e]&&null==this.meshes[e]?this.addMesh(e):t[e]||null==this.meshes[e]||this.removeMesh(e);this.tileRenderer.worldRenderer.renderResources&&this.updateArgsEditor()}},{key:"addMesh",value:function(e){var t=this.meshes[e]=new u.Mesh(wr,function(e){if(!Ar.has(e)){var t,n,a=null!==(t=null===(n=e.material.color)||void 0===n?void 0:n.getHex())&&void 0!==t?t:16777215;Ar.set(e,new u.MeshBasicMaterial({color:a,side:u.DoubleSide}))}return Ar.get(e)}(this.target.cell.type)),n=$.a[e];t.position.x=this.target.cell.pos.x+.4*n.x,t.position.y=this.target.cell.pos.y+.4*n.y,t.position.z=2,t.rotation.z=n.angle(),this.scene.add(t)}},{key:"removeMesh",value:function(e){var t=this.meshes[e];delete this.meshes[e],this.scene.remove(t)}},{key:"updateArgsEditor",value:function(){var e=Gn.keyMap.has("ShiftLeft")&&this.mito.getTileAtScreen(this.mito.mouse.position.x,this.mito.mouse.position.y)===this.target.cell;e&&null==this.argsEditor?this.argsEditor=this.mito.addWorldDOMElement(this.positionFn,this.renderFn):e||null==this.argsEditor||(this.mito.removeWorldDOMElement(this.argsEditor),this.argsEditor=void 0)}},{key:"hover",value:function(){}},{key:"destroy",value:function(){this.argsEditor&&this.mito.removeWorldDOMElement(this.argsEditor)}}]),t}(vr),Er=function(e){var t=e.gene.state.connections,n=Object(a.useCallback)((function(){t.n=!t.n}),[t.n]),i=Object(a.useCallback)((function(){t.s=!t.s}),[t.s]),o=Object(a.useCallback)((function(){t.e=!t.e}),[t.e]),s=Object(a.useCallback)((function(){t.w=!t.w}),[t.w]),l=Object(a.useCallback)((function(){var e;for(e in t)t[e]=!1}),[t]);return r.a.createElement("div",{className:"pipes-editor"},r.a.createElement("div",{className:"zone-n",onClick:n}),r.a.createElement("div",{className:"zone-w",onClick:s}),r.a.createElement("div",{className:"zone-center",onClick:l},r.a.createElement(Mn.b,null)),r.a.createElement("div",{className:"zone-e",onClick:o}),r.a.createElement("div",{className:"zone-s",onClick:i}))},jr=(n(314),function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(i)))).percentMatureElement=n.tileRenderer.worldRenderer.renderResources?n.mito.addWorldDOMElement((function(){return n.target.cell}),(function(){var e=Object(g.reproducerGetPercentMatured)(n.target);return r.a.createElement("div",{className:"reproducer-percent-mature"},Object(Rn.a)(100*e,2),"%")})):null,n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"hover",value:function(){}},{key:"update",value:function(){this.updateScale()}},{key:"updateScale",value:function(){var e=Object(X.d)(Object(g.reproducerGetPercentMatured)(this.target),0,1,.2,1);this.tileRenderer.scale.set(e,e,1)}},{key:"destroy",value:function(){this.percentMatureElement&&this.mito.removeWorldDOMElement(this.percentMatureElement)}}]),t}(vr)),xr=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(r)))).audio=function(){var e=new u.Audio(n.mito.audioListener);return We.s.then((function(t){return e.setBuffer(t)})),e}(),n.lastAudioValueTracker=0,n.neighborLines=new u.Object3D,n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target.state.totalSucked;if(e!==this.lastAudioValueTracker){var t=1*Object(We.e)(this.target.cell,this.mito.world.player);this.audio.setVolume(t),null!=this.audio.source&&this.audio.stop(),this.audio.play(),this.tileRenderer.animation.set(this.tileRenderer.growPulseAnimation())}this.lastAudioValueTracker=e,null!=this.neighborLines.parent&&this.scene.remove(this.neighborLines)}},{key:"hover",value:function(){var e=this;this.scene.add(this.neighborLines),this.neighborLines.position.set(this.tileRenderer.target.pos.x,this.tileRenderer.target.pos.y,1);var t,n=this.target.state.activeNeighbors;n.length!==this.neighborLines.children.length&&((t=this.neighborLines).remove.apply(t,Object(se.a)(this.neighborLines.children)),n.forEach((function(t){var n=t.length()-.25,a=yr(new u.Vector3(t.x,t.y,0).normalize(),new u.Vector3,n,Cr);e.neighborLines.add(a)})))}},{key:"destroy",value:function(){this.scene.remove(this.neighborLines),this.audio.disconnect()}}]),t}(vr),Cr=new u.Color("rgb(9, 12, 255)").getHex(),Sr=(n(315),function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(i)))).arrow=void 0,n.origin=void 0,n.lastDir=new u.Vector2(0,0),n.argsEditor=void 0,n.positionFn=function(){return n.target.cell},n.renderFn=function(){return r.a.createElement(Pr,{gene:n.target})},n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){this.updateArrow(),this.updateArrowPosition(),this.tileRenderer.worldRenderer.renderResources&&this.updateArgsEditor(),this.target.state.didJustTransport&&this.tileRenderer.animation.set(this.arrowMoveAnimation())}},{key:"updateArgsEditor",value:function(){var e=Gn.keyMap.has("ShiftLeft")&&this.mito.getTileAtScreen(this.mito.mouse.position.x,this.mito.mouse.position.y)===this.target.cell;e&&null==this.argsEditor?this.argsEditor=this.mito.addWorldDOMElement(this.positionFn,this.renderFn):e||null==this.argsEditor||(this.mito.removeWorldDOMElement(this.argsEditor),this.argsEditor=void 0)}},{key:"updateArrow",value:function(){var e=this.target.cell.args.direction;if(!e.equals(this.lastDir)){null!=this.arrow&&this.arrow.parent.remove(this.arrow);var t=e.clone().normalize();this.origin=t.clone().multiplyScalar(-.375),this.arrow=new u.ArrowHelper(new u.Vector3(t.x,t.y,0),new u.Vector3(this.origin.x,this.origin.y,2),.75,16777215,.1,.1),this.scene.add(this.arrow),this.lastDir.copy(e),this.tileRenderer.animation.set(this.arrowSetAnimation())}}},{key:"updateArrowPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.origin,t=e.x,n=e.y;this.arrow.position.set(this.target.cell.pos.x+t,this.target.cell.pos.y+this.target.cell.droopY+n,2)}},{key:"arrowMoveAnimation",value:function(){var e=this,t=this.origin.length(),n=this.origin.clone().setLength(1.1*t),a=this.origin.clone().setLength(.5*t);return function(t){var r=t/.25;return e.updateArrowPosition(n.clone().lerp(a,Object(wn.b)(r))),r>=1}}},{key:"arrowSetAnimation",value:function(){var e=this;return function(t){var n=t/.2,a=.1*Object(Ua.c)(1-n);return e.updateArrowPosition({x:Object(X.f)(-a,a),y:Object(X.f)(-a,a)}),n>=1}}},{key:"hover",value:function(){}},{key:"destroy",value:function(){this.scene.remove(this.arrow),this.argsEditor&&this.mito.removeWorldDOMElement(this.argsEditor)}}]),t}(vr)),Pr=function(e){var t=e.gene,n=Object(a.useCallback)((function(){var e,n;null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.set(0,-1)}),[t.cell.args]),i=Object(a.useCallback)((function(){var e,n;null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.set(0,1)}),[t.cell.args]),o=Object(a.useCallback)((function(){var e,n;null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.set(1,0)}),[t.cell.args]),s=Object(a.useCallback)((function(){var e,n;null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.set(-1,0)}),[t.cell.args]),l=function(){var e,t=Object(a.useState)([]),n=Object(H.a)(t,2),r=n[0],i=n[1],o=Object(a.useCallback)((function(e){var t=e.movementX,n=e.movementY,a=new u.Vector2(t,n);i((function(e){return[a].concat(Object(se.a)(e))}))}),[]),s=r.reduce((function(e,t){return e.add(t)}),new u.Vector2);if(s.lengthSq()>144){var l=s.angle(),c=Object(X.i)(l,Math.PI/2);e=new u.Vector2(Math.round(Math.cos(c)),Math.round(Math.sin(c)))}return[e,o]}(),c=Object(H.a)(l,2),h=c[0],d=c[1];Object(a.useEffect)((function(){var e,n;h&&(null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.copy(h))}),[t.cell.args,h]);var m=Object(a.useCallback)((function(e){0!==e.buttons&&(console.log(t.cell.toString(),e.movementX,e.movementY),d(e))}),[d,t.cell]);return r.a.createElement("div",{className:"directional-push-editor",onMouseMove:m},r.a.createElement("div",{className:"zone-n",onClick:n}),r.a.createElement("div",{className:"zone-w",onClick:s}),r.a.createElement("div",{className:"zone-center"}),r.a.createElement("div",{className:"zone-e",onClick:o}),r.a.createElement("div",{className:"zone-s",onClick:i}))};var Mr=function(e){function t(e,n,a,r,i){var o,s;return Object(C.a)(this,t),(o=Object(at.a)(this,Object(rt.a)(t).call(this,e,n,a))).inventoryRenderer=void 0,o.originalColor=void 0,o.cellEffectsRenderer=void 0,o.geneRenderer=void 0,o.animation=new ar,o.scale=new u.Vector3(1,1,1),o.color=new u.Color,o.instance=void 0,o.worldRenderer=void 0,o.temperatureColor=t.TEMPERATURE_COLORS[fr.a.Mild],o.currentLerp=0,o.worldRenderer=i,o.instance=r.getBatchInstance(e),o.target instanceof c.f&&o.scale.set(.01,.01,1),o.originalColor=(o.materialInfo.color||Nr).clone(),o.inventoryRenderer=new Ga(o.target.inventory,o.scene,o.mito),o.inventoryRenderer.animationOffset=(o.target.pos.x+o.target.pos.y)/2,o.target instanceof c.b&&(0===o.target.timeToBuild&&o.scale.set(.01,.01,1),o.cellEffectsRenderer=new Qa(o.target,o.scene,o.mito),o.geneRenderer=(s=o.target.geneInstances.map((function(e){return o.createGeneRendererFor(e)})).filter((function(e){return null!=e})),new Proxy({},{get:function(e,t){var n=s[0];return null!=n&&"function"===typeof n[t]?function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var r=!0,i=!1,o=void 0;try{for(var l,c=s[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value,h=u[t];"function"===typeof h&&h.apply(u,n)}}catch(d){i=!0,o=d}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}}:mr}}))),o.target.darkness<1&&o.commit(),o}return Object(it.a)(t,e),Object(S.a)(t,[{key:"materialInfo",get:function(){return function e(t){return t instanceof c.f?e(t.completedCell):t instanceof c.b?t.type.material:Tr.get(t.constructor)}(this.target)}}]),Object(S.a)(t,[{key:"createGeneRendererFor",value:function(e){return e.isType(m.g)?new xr(e,this):e.isType(y.GenePhotosynthesis)?new gr(e,this):e.isType(b.GeneTransport)?new Sr(e,this):e.isType(g.GeneFruit)||e.isType(g.GeneSeed)?new jr(e,this):e.isType(ct.GenePipes)?new kr(e,this):void 0}},{key:"commit",value:function(){if(this.target instanceof c.f){var e=this.target,t=e.start,n=e.pos,a=t.clone().lerp(n,.5),r=n,i=this.scale.x;Object(X.c)(a,r,i),this.instance.commitCenter(a.x,a.y,1)}else if(this.target instanceof c.b)this.instance.commitCenter(this.target.pos.x,this.target.pos.y+this.target.droopY,1);else{var o=this.target instanceof c.a?-10:0;this.instance.commitCenter(this.target.pos.x,this.target.pos.y,o)}this.instance.commitTexturePosition(this.materialInfo.texturePosition),this.instance.commitColor(this.color),this.instance.commitScale(this.scale)}},{key:"update",value:function(){this.target.darkness<1&&(this.updateScale(),this.updateColor(),this.updateInventory(),this.maybeUpdateCellEffectsRenderer(),this.geneRenderer&&this.geneRenderer.update(),this.animation.update(),this.commit())}},{key:"maybeUpdateCellEffectsRenderer",value:function(){null!=this.cellEffectsRenderer&&this.cellEffectsRenderer.update()}},{key:"updateInventory",value:function(){null!=this.inventoryRenderer&&this.inventoryRenderer.update()}},{key:"updateScale",value:function(){if(this.target instanceof c.f){var e=Object(X.d)(this.target.percentMatured,0,1,.1,1);Object(X.c)(this.scale,{x:e,y:e},.5)}else this.target instanceof c.b&&this.target.isReproductive||Object(X.c)(this.scale,t.ONE,.1)}},{key:"updateColor",value:function(){var e=this.target.lightAmount();if(this.target instanceof c.a){var t=Math.max(0,Object(X.d)(this.target.co2(),1/6,1.001,0,Rr.length-1)),n=Math.floor(t),a=Rr[n];if(this.originalColor=a.clone(),n!==Rr.length-1){var r=t-n,i=Rr[n+1];this.originalColor.lerp(i,r)}}if(this.color.copy(this.originalColor),this.target instanceof c.b&&this.target.energy<.5){var o=Object(X.d)(this.target.energy,0,.5,1,0);this.color.lerp(Fr,o)}this.lerpColorTemperature(this.color),this.color.lerp(Fr,Object(X.d)(e,0,1,.8,0))}},{key:"lerpColorTemperature",value:function(e){var n=this.target.temperature,a=t.TEMPERATURE_COLORS[n];a!==this.temperatureColor&&(this.currentLerp=0);var r=n===fr.a.Mild?0:.25;this.temperatureColor=a,this.currentLerp=Object(X.b)(this.currentLerp,r,.1),e.lerp(this.temperatureColor,this.currentLerp)}},{key:"updateHover",value:function(){var e,t;null===(e=this.geneRenderer)||void 0===e||null===(t=e.hover)||void 0===t||t.call(e)}},{key:"growPulseAnimation",value:function(){var e=this,t=Da(Ua.b);return function(n){var a=Object(X.a)(n/.5*(e.target.tempo||1),0,1),r=Object(X.d)(t(a),0,1,1,1.3);return e.scale.setScalar(r),a>=1}}},{key:"hasActiveNeighbors",value:function(e){return Array.isArray(e.activeNeighbors)}},{key:"destroy",value:function(){this.instance.destroy(),null!=this.inventoryRenderer&&this.inventoryRenderer.destroy(),null!=this.cellEffectsRenderer&&this.cellEffectsRenderer.destroy(),this.geneRenderer&&this.geneRenderer.destroy()}}]),t}(wa);Mr.TEMPERATURE_COLORS=(Or={},Object(z.a)(Or,fr.a.Scorching,new u.Color("orange")),Object(z.a)(Or,fr.a.Hot,new u.Color("orange").lerp(new u.Color("white"),.5)),Object(z.a)(Or,fr.a.Mild,new u.Color("white")),Object(z.a)(Or,fr.a.Cold,new u.Color("lightblue").lerp(new u.Color("white"),.5)),Object(z.a)(Or,fr.a.Freezing,new u.Color("lightblue")),Or),Mr.ONE=Object.freeze(new u.Vector2(1,1));var Tr=function(){var e=new Map;e.set(c.a,{texturePosition:new u.Vector2(0,3),color:new u.Color("white")});var t=new u.Color("rgb(112, 89, 44)");return e.set(Q.b,{texturePosition:new u.Vector2(1,0),color:new u.Color("rgb(223, 220, 231)").multiplyScalar(1/1.2)}),e.set(Q.c,{texturePosition:new u.Vector2(1,0),color:t}),e.set(Q.a,{texturePosition:new u.Vector2(1,0),color:t.clone().multiplyScalar(1/1.5)}),e.set(c.d,{color:new u.Color("white"),texturePosition:new u.Vector2(2,0)}),e.set(c.g,{texturePosition:new u.Vector2(3,0),color:new u.Color("rgb(63, 77, 84)")}),e.set(c.c,{texturePosition:new u.Vector2(0,1),color:new u.Color("rgb(128, 128, 128)")}),e}();var Rr=[new u.Color("hsl(67, 31%, 25%)"),new u.Color("hsl(180, 31%, 76%)"),new u.Color("hsl(213, 63%, 58%)")],Nr=new u.Color(1,1,1),Fr=new u.Color(0,0,0);function Dr(){var e=Object(Aa.a)(["\n// for the fragment shader, the main goal is to set gl_FragColor. Its inputs are\n//   'varying' variables from the vertex shader, interpolated along the triangle\n//   'uniform' variables\nprecision mediump float;\n\n// these should match the corresponding section in the vertexShader exactly\nvarying vec3 vTileCenter;\nvarying vec3 vColor;\nvarying vec2 vUv;\nvarying vec2 vTexturePosition;\nvarying float vAlpha;\n\nconst vec2 spritesheetSize = vec2(256., 256.);\nuniform sampler2D spriteSheet;\n\nfloat myRound(float x) {\n  return sign(x) * floor(abs(x) + 0.5);\n}\n\nfloat random(float x) {\n  return fract(sin(x * .43));\n}\n\n// uv - [0,1]x[0,1] - our local sprite (16x16) UV coords\n// texturePosition - the grid x/y where our sprite lives in our texture. NOTE:\n// for texturePosition, top-left is 0, 0 (Y is image coordinates)\n// textureSize - the pixel width/height of the full spritesheet\n// returns: a UV coordinate for this sprite, relative to the full spritesheet\nvec2 getCorrectUv(vec2 uv, vec2 texturePosition, vec2 textureSize) {\n  vec2 spriteSheetPxStart = texturePosition * vec2(32.);\n  spriteSheetPxStart.y = textureSize.y - spriteSheetPxStart.y - 32.;\n  vec2 spriteSheetUv = spriteSheetPxStart + uv * vec2(32.);\n  vec2 minUv = spriteSheetPxStart + vec2(1.);\n  vec2 maxUv = spriteSheetPxStart + vec2(32. - 1.);\n  return clamp(spriteSheetUv / textureSize, minUv / textureSize, maxUv / textureSize);\n}\n\nvoid main() {\n  vec2 correctUv = getCorrectUv(vUv, vTexturePosition, spritesheetSize);\n  vec4 textureColor = texture2D(spriteSheet, correctUv);\n  gl_FragColor = vec4(textureColor.rgb * vColor, textureColor.a * vAlpha);\n}\n"]);return Dr=function(){return e},e}function Br(){var e=Object(Aa.a)(["\nprecision mediump float;\n\n// the vertex shader's main goals are:\n// 1. set gl_Position to a clip-coordinate\n// 2. pass varyings along to fragment shader.\n// you can accept two types of inputs:\n//   'attribute' variables, which change per vertex\n//   'uniform' variables, which are constant for a given draw context.\n// WebGL thankfully hooks up a bunch of attributes and uniforms, see https://threejs.org/docs/index.html#api/en/renderers/webgl/WebGLProgram\n// see also my explorations: https://codesandbox.io/s/reactthreejstemplate-lwvhu\n\n\n// Comes from WebGLProgram\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n// Comes from threejs Geometry\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\n// attributes we provide\n// these are constant per instance\nattribute vec3 instancedTileCenter;\nattribute vec3 instancedTileScale;\nattribute vec3 instancedTileColor;\nattribute vec2 instancedTexturePosition;\nattribute float instancedAlpha;\n\n// things we pass onto fragment\nvarying vec3 vTileCenter;\nvarying vec3 vColor;\nvarying vec2 vUv;\nvarying vec2 vTexturePosition;\nvarying float vAlpha;\n\n// based on https://github.com/mrdoob/three.js/blob/master/examples/webgl_buffergeometry_instancing_billboards.html\nvoid main() {\n  vTileCenter = instancedTileCenter;\n  vColor = instancedTileColor;\n  vUv = uv;\n  vTexturePosition = instancedTexturePosition;\n  vAlpha = instancedAlpha;\n\n  vec4 mvPosition = modelViewMatrix * vec4(instancedTileCenter, 1.);\n  mvPosition.xyz += position * instancedTileScale;\n  // mvPosition.xyz += position;\n  gl_Position = projectionMatrix * mvPosition;\n}\n"]);return Br=function(){return e},e}var Ir=Oa(Br()),Lr=Oa(Dr()),Vr=new u.RawShaderMaterial({uniforms:{spriteSheet:{value:Ln()}},transparent:!0,vertexShader:Ir,fragmentShader:Lr,side:u.DoubleSide}),zr=function(){function e(t){Object(C.a)(this,e),this.world=t,this.geometry=void 0,this.maxTiles=this.world.height*this.world.width*2,this.centers=new u.InstancedBufferAttribute(new Float32Array(3*this.maxTiles),3,!1,1),this.colors=new u.InstancedBufferAttribute(new Float32Array(3*this.maxTiles),3,!1,1),this.scales=new u.InstancedBufferAttribute(new Float32Array(3*this.maxTiles),3,!1,1),this.texturePositions=new u.InstancedBufferAttribute(new Float32Array(2*this.maxTiles),2,!1,1),this.alphas=new u.InstancedBufferAttribute(new Float32Array(this.maxTiles).fill(1),1,!1,1),this.mesh=void 0,this.instances=new Map,this.geometry=e.newGeometry(),this.mesh=new u.Mesh(this.geometry,Vr),this.mesh.name="TileBatcher Mesh",this.mesh.frustumCulled=!1,this.mesh.matrixAutoUpdate=!1,this.mesh.updateMatrixWorld(),this.centers.setUsage(u.DynamicDrawUsage),this.colors.setUsage(u.DynamicDrawUsage),this.scales.setUsage(u.DynamicDrawUsage),this.texturePositions.setUsage(u.DynamicDrawUsage),this.alphas.setUsage(u.DynamicDrawUsage),this.geometry.setAttribute("instancedTileCenter",this.centers),this.geometry.setAttribute("instancedTileColor",this.colors),this.geometry.setAttribute("instancedTileScale",this.scales),this.geometry.setAttribute("instancedTexturePosition",this.texturePositions),this.geometry.setAttribute("instancedAlpha",this.alphas)}return Object(S.a)(e,null,[{key:"newGeometry",value:function(){var e=new u.PlaneBufferGeometry(1,1),t=new u.InstancedBufferGeometry;return t.index=e.index,t.attributes=e.attributes,t}}]),Object(S.a)(e,[{key:"getBatchInstance",value:function(e){var t=e.pos,n=(e instanceof c.b?1:0)*this.maxTiles/2+(t.y*this.world.width+t.x);Number.isInteger(n)||console.error("index "+n+" is not integer!");var a=String(n);this.instances.has(a)||this.instances.set(a,new Hr(this,n));var r=this.instances.get(a);return r.checkout(e),r}},{key:"endFrame",value:function(){this.centers.needsUpdate=!0,this.colors.needsUpdate=!0,this.scales.needsUpdate=!0,this.texturePositions.needsUpdate=!0,this.alphas.needsUpdate=!0}}]),e}(),Wr=new u.Color(0,0,0),Gr=new u.Vector3(0,0,0),Hr=function(){function e(t,n){Object(C.a)(this,e),this.batcher=void 0,this.index=void 0,this.owner=void 0,this.batcher=t,this.index=n}return Object(S.a)(e,[{key:"checkout",value:function(t){null!=this.owner&&console.warn("Checking out instance that's already in use!",this.index,t),this.owner=t,e.numInUse++}},{key:"commitColor",value:function(e){this.owner||console.error("freed tileBatcher still in use!"),this.batcher.colors.setXYZ(this.index,e.r,e.g,e.b)}},{key:"commitCenter",value:function(e,t,n){this.owner||console.error("freed tileBatcher still in use!"),this.batcher.centers.setXYZ(this.index,e,t,n)}},{key:"commitScale",value:function(e){this.owner||console.error("freed tileBatcher still in use!"),this.batcher.scales.setXYZ(this.index,e.x,e.y,e.z)}},{key:"commitTexturePosition",value:function(e){this.batcher.texturePositions.setXY(this.index,e.x,e.y)}},{key:"commitAlpha",value:function(e){this.batcher.alphas.setX(this.index,e)}},{key:"destroy",value:function(){this.commitColor(Wr),this.commitScale(Gr),this.owner=void 0,e.numInUse--}}]),e}();Hr.numInUse=0;var Ur=zr,Yr=function(e){function t(e,n,a){var r,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Object(C.a)(this,t),(r=Object(at.a)(this,Object(rt.a)(t).call(this,e,n,a))).renderResources=i,r.renderers=new Map,r.tileBatcher=void 0,r.eventLogRenderer=void 0,r.deleteDeadEntityRenderers=Object(ca.a)((function(e){return e}),(function(e){var t=e.deleted,n=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,c=r.renderers.get(l);null!=c?(c.destroy(),r.renderers.delete(l)):console.warn("Couldn't find renderer for ".concat(l,"!"))}}catch(u){a=!0,i=u}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}})),r.tileBatcher=new Ur(r.target),n.add(r.tileBatcher.mesh),i&&(n.add(Ga.WaterParticles()),n.add(Ga.SugarParticles()),r.eventLogRenderer=new $a(Object(ln.a)(r))),r}return Object(it.a)(t,e),Object(S.a)(t,[{key:"getOrCreateRenderer",value:function(e){var t=this.renderers.get(e);if(null!=t)return t;var n=this.createRendererFor(e);return n?(this.renderers.set(e,n),n):void 0}},{key:"createRendererFor",value:function(e){return e instanceof F?new sr(e,this.scene,this.mito):e instanceof D?new dr(e,this.scene,this.mito):e instanceof c.i?new Mr(e,this.scene,this.mito,this.tileBatcher,this):(console.error("Couldn't find renderer for",e),null)}},{key:"update",value:function(){var e=this;this.deleteDeadEntityRenderers(this.target.getLastStepStats()),this.eventLogRenderer&&this.eventLogRenderer.update(),Ga.startFrame(),this.target.entities().forEach((function(t){var n=e.getOrCreateRenderer(t);null===n||void 0===n||n.update()})),Ga.endFrame(),this.tileBatcher.endFrame()}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}}]),t}(wa),Kr=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.l;Object(C.a)(this,e),this.mito=t,this.pxPerTile=n,this.captureInterval=a,this.lastCaptureTime=0}return Object(S.a)(e,[{key:"isTimeForNewCapture",value:function(){return this.mito.world.time-this.lastCaptureTime>this.captureInterval}},{key:"capture",value:function(){var t=e.renderTarget,n=e.rtBuffer,a=e.rtCanvas;this.lastCaptureTime=this.mito.world.time;var r=Array.from(this.mito.world.allCells()),i=this.getBounds(r),o=Object(H.a)(i,2),s=o[0],l=o[1],c=new u.Scene,h=new Yr(this.mito.world,c,this.mito,!1),d=r.map((function(e){var t=h.createRendererFor(e);return null===t||void 0===t||t.update(),t}));h.tileBatcher.endFrame();var m=this.cameraEncompassingBounds([s,l]),f=this.mito.renderer;f.setRenderTarget(t),f.clear(!0,!0,!0),f.render(c,m),f.setRenderTarget(null),f.readRenderTargetPixels(t,0,0,t.width,t.height,n);for(var v=a.getContext("2d"),p=v.createImageData(a.width,a.height),y=p.data,g=0;g<n.length;g++)y[g]=n[g];v.putImageData(p,0,0);var b=l.x-s.x,w=l.y-s.y,A=Math.max(b,w),O=Object(X.d)(b,0,A,0,1024),k=Object(X.d)(w,0,A,0,1024),E=new u.Vector2(512-O/2,512-k/2),j=document.createElement("canvas");return j.width=Math.ceil(b*this.pxPerTile),j.height=Math.ceil(w*this.pxPerTile),j.getContext("2d").drawImage(a,E.x,E.y,O,k,0,0,j.width,j.height),(new Image).src=j.toDataURL(),d.forEach((function(e){null===e||void 0===e||e.destroy()})),j}},{key:"getBounds",value:function(e){var t=new u.Vector2,n=new u.Vector2;null!=e[0]&&(t.copy(e[0].pos),n.copy(e[0].pos));var a=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;t.min(l.pos),n.max(l.pos)}}catch(c){r=!0,i=c}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return t.subScalar(.5),n.addScalar(.5),[t,n]}},{key:"cameraEncompassingBounds",value:function(e){var t=Object(H.a)(e,2),n=t[0],a=t[1],r=n.clone().lerp(a,.5),i=a.x-n.x,o=a.y-n.y,s=Math.max(i,o);return new u.OrthographicCamera(r.x-s/2,r.x+s/2,r.y+s/2,r.y-s/2,-100,100)}}]),e}();Kr.renderTarget=new u.WebGLRenderTarget(1024,1024),Kr.rtBuffer=new Uint8Array(Kr.renderTarget.width*Kr.renderTarget.height*4),Kr.rtCanvas=function(){var e=document.createElement("canvas");return e.width=Kr.renderTarget.width,e.height=Kr.renderTarget.height,e}();var Qr=Kr,Xr=n(199),Zr=n(52);function qr(e){var t=e.world,n=e.vignettes,a=Array.from(t.mpEarners.entries()).filter((function(e){var t=Object(H.a)(e,2);t[0];return t[1]>0})),r=a.length>0;return{mpEarners:t.mpEarners,mutationPointsPerEpoch:a.map((function(e){return Object(H.a)(e,2)[1]})).reduce((function(e,t){return e+t}),0),status:r?"won":"lost",vignettes:n,world:t}}var Jr={},_r={},$r={KeyW:{type:"move",dir:$.a.n},KeyA:{type:"move",dir:$.a.w},KeyS:{type:"move",dir:$.a.s},KeyD:{type:"move",dir:$.a.e}},ei=(Object.keys($r).map((function(e){return $r[e]})),function(){function e(t){var n=this;Object(C.a)(this,e),this.mito=t,this.handleMouseDown=function(e){if(e.target===n.mito.canvas){if(null!=n.mito.inspectedCell)return void(n.mito.inspectedCell=void 0);0===e.button?n.leftClick():2===e.button&&n.rightClick()}},this.handleKeyDown=function(e){var t=n.mito,a=e.code;if(!e.repeat){if(t.maybeToggleInstructions(a))return;_r[a]?t.world.player.setAction(_r[a]):null!=t.inspectedCell&&"Escape"===a&&(t.inspectedCell=void 0)}t.toolBar.keyDown(e)},window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("mousedown",this.handleMouseDown)}return Object(S.a)(e,[{key:"destroy",value:function(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("mousedown",this.handleMouseDown)}},{key:"animate",value:function(e){var t=this.mito;if(!t.instructionsOpen){var n=this.keysToMovement(Gn.keyMap);n&&t.world.player.setAction(n);var a=!0,r=!1,i=void 0;try{for(var o,s=Gn.keyMap[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;Jr[l]&&t.world.player.setAction(Jr[l])}}catch(c){r=!0,i=c}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}switch(this.mito.mouse.button){case 0:this.leftClickHold()}}}},{key:"keysToMovement",value:function(e){var t=new u.Vector2,n=!0,a=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;$r[s]&&t.add($r[s].dir)}}catch(l){a=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}return 0===t.x&&0===t.y?null:{type:"move",dir:t}}},{key:"leftClick",value:function(){var e=this.mito,t=e.getHighlightedTile();if(null!=t){var n=e.toolBar.leftClick(t);null==n||this.isActionContinuous(n)||e.world.player.setAction(n)}}},{key:"rightClick",value:function(){var e=this.mito.getHighlightedTile();null!=e&&e instanceof ye.a&&(Gn.keyMap.delete("KeyW"),Gn.keyMap.delete("KeyS"),Gn.keyMap.delete("KeyA"),Gn.keyMap.delete("KeyD"),this.mito.inspectedCell=e)}},{key:"leftClickHold",value:function(){var e=this.mito,t=e.getHighlightedTile();if(null!=t){var n=e.toolBar.leftClick(t);this.isActionContinuous(n)&&e.world.player.setAction(n)}}},{key:"wouldLeftClickInteract",value:function(){var e,t=this.mito,n=t.getHighlightedTile(),a=n&&(null===(e=t.toolBar.leftClick(n))||void 0===e?void 0:e.type);return"pickup"===a||"drop"===a}},{key:"isActionContinuous",value:function(e){if(null!=e){if("pickup"===e.type||"drop"===e.type)return!!e.continuous;if("remove-cancer"===e.type||"thaw"===e.type)return!0}return!1}}]),e}()),ti=function(){function e(t){var n=this;Object(C.a)(this,e),this.mito=t,this.handleKeyDown=function(e){"Space"===e.code&&n.popOut()},window.addEventListener("keydown",this.handleKeyDown)}return Object(S.a)(e,[{key:"destroy",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"animate",value:function(e){0===this.mito.mouse.button&&this.handleLeftClick()}},{key:"popOut",value:function(){this.mito.world.playerSeed&&this.mito.world.time>3&&(this.mito.world.playerSeed.popOut(),this.mito.controls=new ei(this.mito))}},{key:"handleLeftClick",value:function(){var e=this.mito.getHighlightPosition().round();this.mito.world.playerSeed.pos.distanceTo(e)<.5&&this.popOut()}},{key:"wouldLeftClickInteract",value:function(){return!1}}]),e}(),ni=n(101),ai=function(){function e(t){for(var n in Object(C.a)(this,e),this.mito=t,this.tools={KeyQ:ri},this.currentKey="KeyQ",t.world.genome.cellTypes){var a=t.world.genome.cellTypes[n],r=e.DIGIT_KEYS[n];this.tools[r]=ii(a)}}return Object(S.a)(e,[{key:"isInteract",value:function(){return this.currentTool===ri}},{key:"leftClick",value:function(e){return this.currentTool.leftClick(e)}},{key:"rightClick",value:function(e){return this.currentTool.rightClick(e)}},{key:"setKey",value:function(e){if(e in this.tools){var t,n;if(e===this.currentKey)null===(t=(n=this.currentTool).nextConfiguration)||void 0===t||t.call(n);this.currentKey=e}}},{key:"keyDown",value:function(e){"Escape"===e.code&&"KeyQ"!==this.currentKey?this.setKey("KeyQ"):this.shouldCapture(e)&&this.setKey(e.code)}},{key:"shouldCapture",value:function(e){return!e.repeat&&e.code in this.tools}},{key:"currentTool",get:function(){return this.tools[this.currentKey]}}]),e}();ai.DIGIT_KEYS=["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8"];var ri={name:"Interact",type:"interact",leftClick:function(e){return Object(ni.a)(e)?e.interact(null):void 0},rightClick:function(e){return{type:"deconstruct",position:e.pos}}};function ii(e){return{name:e.name,type:"build",cellType:e,leftClick:function(t){var n;return e.args&&(n=Object(U.a)({},e.args)),{type:"build",cellType:e,position:t.pos.clone(),args:n}},rightClick:function(e){},nextConfiguration:function(){e.rotateArgDirection()}}}var oi=function(){function e(t,n,a){Object(C.a)(this,e),this.mito=t,this.positionFn=n,this.renderFn=a,this.uuid=pe()()}return Object(S.a)(e,[{key:"render",value:function(){var e,t=this.positionFn();if(null==t)return null;if(t instanceof u.Vector2){var n=t,a=this.mito.worldToScreen(n);e={left:a.x,top:a.y}}else{var i=t,o=i.pos.clone().addScalar(-.5),s=i.pos.clone().addScalar(.5),l=this.mito.worldToScreen(o),c=this.mito.worldToScreen(s),h=l.x,d=l.y;e={left:h,top:d,width:c.x-h,height:c.y-d}}return r.a.createElement("div",{key:this.uuid,style:e},this.renderFn())}}]),e}(),si=function(e){var t,n=e.className,i=e.children,o=e.mito,s=e.positionFn,l=Object(a.useRef)(pe()()),c=s();if(null==c)return null;if(c instanceof u.Vector2){var h=c,d=o.worldToScreen(h);t={left:d.x,top:d.y}}else{var m=c,f=m.pos.clone().addScalar(-.5),v=m.pos.clone().addScalar(.5),p=o.worldToScreen(f),y=o.worldToScreen(v),g=p.x,b=p.y;t={left:g,top:b,width:y.x-g,height:y.y-b}}return r.a.createElement("div",{key:l.current,style:t,className:Ve()("world-dom-component",n)},i)},li=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(r)))).rafid=void 0,n.animate=function(e){n.props.a(e/1e3)},n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.rafid=cn.a.addAnimation(this.animate)}},{key:"componentWillUnmount",value:function(){this.rafid&&cn.a.removeAnimation(this.rafid)}}]),t}(r.a.Component),ci=function(e){function t(){return Object(C.a)(this,t),Object(at.a)(this,Object(rt.a)(t).apply(this,arguments))}return Object(it.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.props.parent.add(this.props.object)}},{key:"componentWillUnmount",value:function(){this.props.parent.remove(this.props.object)}}]),t}(a.PureComponent),ui=Bn((function(){var e=new u.PlaneBufferGeometry(1,1),t=new u.EdgesGeometry(e,1),n=new u.LineBasicMaterial({color:16777215,transparent:!0,opacity:.75}),a=new u.LineSegments(t,n);return a.position.z=10,a})),hi=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(r)))).object=ui().clone(),n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this;return this.object.position.x=this.props.x,this.object.position.y=this.props.y,a.createElement(a.Fragment,null,a.createElement(li,{a:function(t){return e.object.scale.setScalar(.04*Math.sin(3.7*t)+.94)}}),a.createElement(ci,{object:this.object,parent:this.props.scene}))}}]),t}(a.PureComponent),di=function(){var e=new u.PlaneBufferGeometry(1,1),t=new u.MeshBasicMaterial({side:u.DoubleSide,color:16777215,transparent:!0,opacity:.5}),n=new u.Mesh(e,t);return n.name="Build Blueprint",n.position.z=1,n}(),mi=function(e){var t=e.x,n=e.y,r=e.cellType,i=e.scene,o=a.useMemo((function(){return di.clone()}),[]);return a.useEffect((function(){o.position.x=t,o.position.y=n}),[o.position.x,o.position.y,t,n]),a.useEffect((function(){var e=r.material,t=e.color,n=e.texturePosition,a=zn(n.x,n.y),i=o.material;i.map=a,i.color.set(t||new u.Color(1,1,1)),i.needsUpdate=!0}),[r,o.material]),a.createElement(ci,{object:o,parent:i})},fi=Bn((function(){var e=new u.CircleBufferGeometry(.1,20),t=new u.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.75,side:u.DoubleSide}),n=new u.Mesh(e,t);return n.position.z=10,n})),vi=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(r)))).object=fi().clone(),n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return this.object.position.x=this.props.x,this.object.position.y=this.props.y,a.createElement(a.Fragment,null,a.createElement(ci,{object:this.object,parent:this.props.scene}))}}]),t}(a.PureComponent),pi=(n(316),function(e){function t(){return Object(C.a)(this,t),Object(at.a)(this,Object(rt.a)(t).apply(this,arguments))}return Object(it.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props.mito.world.player.isTakingLongAction(),t=Gn.keyMap.has("ShiftLeft");if(e||t)return null;var n=this.props.mito.highlightedTile,r=this.props.mito.getHighlightPosition();return a.createElement(a.Fragment,null,a.createElement(vi,{x:r.x,y:r.y,scene:this.scene}),this.maybeRenderBuildBlueprint(n),this.maybeRenderTileHighlight(n))}},{key:"maybeRenderTileHighlight",value:function(e){var t;if(null!=e){var n=null===(t=this.props.mito.toolBar.leftClick(e))||void 0===t?void 0:t.type;return"pickup"===n||"drop"===n?a.createElement(hi,{x:e.pos.x,y:e.pos.y,scene:this.props.mito.scene}):null}}},{key:"maybeRenderBuildBlueprint",value:function(e){if(null!=e){var t=this.props.mito,n=t.toolBar.leftClick(e);if(null!=n&&"build"===n.type){var r=t.world.player.canBuildAt(e);return a.createElement(a.Fragment,null,a.createElement(si,{className:Ve()("build-drop-shadow",{valid:r}),mito:t,positionFn:function(){return e}}),a.createElement(mi,{x:e.pos.x,y:e.pos.y,cellType:n.cellType,scene:this.props.mito.scene}))}}}},{key:"scene",get:function(){return this.props.mito.scene}}]),t}(a.Component));function yi(e){var t=e.hotkey,n=e.className,r=e.onClick,i=Object(Ge.a)(e,["hotkey","className","onClick"]);return a.createElement("div",Object.assign({className:Ve()("mito-hud-button",n),onClick:function(e){r&&r(e),function(e){e.preventDefault(),document.getElementsByTagName("canvas")[0].focus()}(e)}},i),a.createElement("span",{className:"mito-hud-button-hotkey"},t))}n(317);var gi=a.memo((function(e){var t=e.water,n=e.sugar,r=e.capacity,i=e.className,o=e.colored,s=void 0===o||o,l=e.format,c=e.capacityBasedWidth;if(0===r)return null;var u=n/r,h=1-(t+n)/r,d={width:"".concat(100*(t/r),"%")},m={width:"".concat(100*u,"%")},f={width:"".concat(100*h,"%")},v="text"===l?a.createElement(a.Fragment,null,a.createElement("span",{className:"text water"},a.createElement(an.a,{speed:.5,value:t})," water"),"\xa0",a.createElement("span",{className:"text sugar"},a.createElement(an.a,{speed:.5,value:n})," sugar")):a.createElement(a.Fragment,null,t>0?a.createElement("span",{className:"text water"},n>0?a.createElement(Hn.a,{name:"water"}):null," ",a.createElement(an.a,{speed:.5,value:t})):null,n>0?a.createElement("span",{className:"text sugar"},a.createElement(Hn.a,{name:"sugar"})," ",a.createElement(an.a,{speed:.5,value:n})):null),p={width:c?10*r:void 0};return a.createElement("div",{className:Ve()("inventory-bar-container",i)},a.createElement("div",{className:"inventory-bar",style:p},a.createElement("div",{style:d,className:"bar-water"}),a.createElement("div",{style:m,className:"bar-sugar"}),a.createElement("div",{style:f,className:"bar-empty"}),c?a.createElement("div",{className:"markers"}):null),a.createElement("div",{className:Ve()("inventory-text",{colored:s})},v))})),bi={Freezing:"darkblue",Cold:"lightblue",Mild:"lightgray",Hot:"orange",Scorching:"red"},wi=function(e){for(var t=e.tile,n=[],r=0;r<96;r+=32/3){var i=(r+(r+32/3))/2,o=Object(X.d)(i,0,96,-210,30),s=a.createElement("div",{key:o,className:"temperature-scale",style:{transform:"rotate(".concat(o,"deg)"),borderRight:"".concat(7.5,"px solid ").concat(bi[Object(fr.c)(i)])}});n.push(s)}var l=Object(X.d)(t.temperatureFloat,0,96,-210,30);return a.createElement("div",{className:"info-tile-temperature"},a.createElement("div",{style:{width:30,height:30}},n,a.createElement("div",{className:"temperature-pointer",style:{transform:"rotate(".concat(l,"deg)")}}),a.createElement("div",{className:"temperature-label"},"\xb0F")))};n(318);function Ai(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return"".concat(Math.max(0,e).toFixed(t),"s")}var Oi=function(e){function t(){return Object(C.a)(this,t),Object(at.a)(this,Object(rt.a)(t).apply(this,arguments))}return Object(it.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props.tile;return e?a.createElement("div",{className:"tile-details"},this.tileInfo(e),this.cellInfo(e),this.growingCellInfo(e),this.airInfo(e),this.soilInfo(e),this.fountainInfo(e),this.interactInfo(e)):null}},{key:"interactInfo",value:function(e){if(e instanceof c.b){var t=null!=e.type.interaction?a.createElement("div",{className:"interact-info first"},"Left click - ",Object(d.c)(e.type.interaction),"."):null;return a.createElement("div",{className:"interact-infos"},t,a.createElement("div",{className:"interact-info"},"Right click - more options."))}}},{key:"cellInfo",value:function(e){if(e instanceof c.b){var t=e.findGene(m.d),n=null===t||void 0===t?void 0:t.props.secondsPerUpkeep,r=null!=n?e.energy*n:null,i=null!=r?a.createElement("div",{className:"info-energy"},"\ud83d\udc9a\xa0",Object(Rn.a)(100*e.energy,2),"% Energy (",Math.floor(r)," seconds remaining)"):null;return a.createElement(a.Fragment,null,i,200*e.droopY>1?a.createElement("div",{className:"info-cell"},(200*e.droopY).toFixed(0),"% droop"):null,this.cellEffects(e),this.geneInfos(e))}}},{key:"geneInfos",value:function(e){var t=this;return a.createElement(a.Fragment,null,e.geneInstances.map((function(e,n){return e.isType(m.g)?a.createElement(a.Fragment,{key:n},t.soilAbsorptionInfo(e.state)):e.isType(y.GenePhotosynthesis)?a.createElement(a.Fragment,{key:n},t.photosynthesisInfo(e.state)):e.isType(g.GeneFruit)||e.isType(g.GeneSeed)?a.createElement(a.Fragment,{key:n},t.reproducerInfo(e)):null})))}},{key:"soilAbsorptionInfo",value:function(e){return a.createElement("div",{className:"info-root"},a.createElement("div",null,"Absorbs in ",Ai(e.cooldown),"."),a.createElement("div",null,e.totalSucked.toFixed(1)," total water absorbed so far."))}},{key:"photosynthesisInfo",value:function(e){return a.createElement("div",{className:"info-leaf"},a.createElement("div",null,(100*e.averageChancePerSecond).toFixed(1),"% chance to photosynthesize per second."),a.createElement("div",null,(1/e.averageConversionRate).toFixed(2)," water per sugar."),a.createElement("div",null,e.totalSugarProduced.toFixed(2)," total sugar produced so far."))}},{key:"reproducerInfo",value:function(e){var t=e.state,n=e.props;return a.createElement("div",null,a.createElement("div",null,Object(Rn.a)(t.committedResources.water,3),"/",n.neededResources/2," water consumed."),a.createElement("div",null,Object(Rn.a)(t.committedResources.sugar,3),"/",n.neededResources/2," sugar consumed."))}},{key:"airInfo",value:function(e){if(e instanceof c.a)return a.createElement("div",{className:"info-air"},a.createElement("div",null,"\u2600\ufe0f ",Object(Rn.a)(100*e.sunlight(),2),"%"),a.createElement("div",null,a.createElement(en.b,null)," ",Object(Rn.a)(100*(1-e.co2()),2),"%"))}},{key:"soilInfo",value:function(e){if(e instanceof c.h)return a.createElement("div",{className:"info-soil"},a.createElement("div",null,"Depth ",e.depth,"."))}},{key:"fountainInfo",value:function(e){if(e instanceof c.d)return a.createElement("div",{className:"info-fountain"},a.createElement("div",null,Ai(e.cooldown)," until next water."),a.createElement("div",null,e.waterRemaining," water left."))}},{key:"tileInfo",value:function(e){return a.createElement("div",{className:"info-tile"},a.createElement("div",{className:"info-tile-row"},a.createElement("div",{className:"info-tile-name"},e.displayName),a.createElement(wi,{tile:e}),a.createElement(gi,{water:e.inventory.water,sugar:e.inventory.sugar,capacity:e.inventory.capacity,format:"icons",colored:!1,capacityBasedWidth:!0})))}},{key:"cellEffects",value:function(e){var t=e.effects;if(t.length>0){var n=t.map((function(e){var t=e.constructor.displayName;return e instanceof c.e?"".concat((100*e.percentFrozen).toFixed(0),"% ").concat(t):t})).join(", ");return a.createElement("div",{className:"info-cell"},n)}return null}},{key:"growingCellInfo",value:function(e){if(e instanceof c.f)return a.createElement("div",{className:"info-growing-cell"},Object(Rn.a)(100*e.percentMatured,2),"% mature")}}]),t}(a.Component),ki=(n(319),function(e){var t=e.cell,n=e.player,a=e.onDone;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"cell-inspector left"},r.a.createElement("div",{className:"buttons"},r.a.createElement("div",{className:"resources"},r.a.createElement("div",{className:"resource-row"},r.a.createElement("button",{disabled:0===n.inventory.water,onClickCapture:function(e){n.inventory.give(t.inventory,t.inventory.space(),0),e.preventDefault(),e.stopPropagation(),a()}},"Give\xa0",r.a.createElement(Hn.a,{name:"water"})),r.a.createElement("button",{disabled:0===t.inventory.water,onClickCapture:function(e){t.inventory.give(n.inventory,t.inventory.water,0),e.preventDefault(),e.stopPropagation(),a()}},"Take\xa0",r.a.createElement(Hn.a,{name:"water"}))),r.a.createElement("div",{className:"resource-row"},r.a.createElement("button",{disabled:0===n.inventory.sugar,onClickCapture:function(e){n.inventory.give(t.inventory,0,t.inventory.space()),e.preventDefault(),e.stopPropagation(),a()}},"Give\xa0",r.a.createElement(Hn.a,{name:"sugar"})),r.a.createElement("button",{disabled:0===t.inventory.sugar,onClickCapture:function(e){t.inventory.give(n.inventory,0,t.inventory.sugar),e.preventDefault(),e.stopPropagation(),a()}},"Take\xa0",r.a.createElement(Hn.a,{name:"sugar"})))))),r.a.createElement("div",{className:"cell-inspector right"},r.a.createElement("button",{className:"deconstruct",onClick:function(){return n.setAction({type:"deconstruct",position:t.pos})}},"Deconstruct")))});n(320),n(321);function Ei(e){var t=e.time,n=e.season;return a.createElement("div",{className:"seasons-tracker"},a.createElement("div",{className:"season-display"},n.year>0?a.createElement(a.Fragment,null,"Year ",n.year+1,", "):null,I[n.season],a.createElement("br",null),"Month ",n.month,a.createElement("br",null),"Day ",n.day),a.createElement("div",{className:"time"},new Date(1e3*t).toISOString().substr(14,5)))}n(322);var ji=function(e){var t=e.bar,n=Object.keys(t.tools);return a.createElement("div",{className:"tool-bar"},a.createElement("div",{className:"tool-bar-items"},n.map((function(e){return a.createElement(xi,{key:e,bar:t,code:e,selected:t.currentKey===e,tool:t.tools[e]})}))))},xi=function(e){var t=e.bar,n=e.code,r=e.selected,i=e.tool,o=a.useCallback((function(){t.setKey(n)}),[t,n]),s="interact"===i.type?a.createElement(Un,{onClick:o,className:"interact-tool-icon"},i.name):a.createElement(Ci,{onClick:o,tool:i,spritesheetLoaded:In}),l=n.charAt(n.length-1);return a.createElement("div",{className:Ve()("tool-bar-item",{selected:r})},s,a.createElement(yi,{className:"mito-hud-build-item",hotkey:l,onClick:o}))},Ci=function(e){var t=e.onClick,n=e.spritesheetLoaded,r=[],i=e.tool.cellType;return i.args&&i.args.direction&&r.push(a.createElement(Si,{key:r.length,dir:i.args.direction})),a.createElement(Yn,{onClick:t,cellType:i,spritesheetLoaded:n},i.name,r)},Si=function(e){var t=e.dir;return a.createElement("div",{className:"transport-dir-arrow",style:{transform:"rotate(".concat(t.angle(),"rad)")}})},Pi=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(r)))).state={traitsPanelOpen:!0,genomeViewerOpen:!1},n.handleKeyDown=function(e){"Tab"===e.code&&n.setState({genomeViewerOpen:!n.state.genomeViewerOpen})},n.positionFn=function(){var e;return null!==(e=n.mito.inspectedCell)&&void 0!==e?e:null},n.handleCellInspectorDone=function(){n.mito.inspectedCell=void 0},n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"isTutorialFinished",value:function(){return null==this.mito.tutorialRef||this.mito.tutorialRef.isFinished()}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this.inventory.isMaxed(),t=a.createElement("div",{className:"mito-inventory-maxed".concat(e?" is-maxed":"")},"maxed"),n=null==this.world.playerSeed;return a.createElement(a.Fragment,null,a.createElement("div",{className:Ve()("hud-top-center",{hidden:!n})},a.createElement(Ei,{time:this.world.time,season:this.world.season})),this.maybeRenderGenomeViewer(),this.maybeRenderCollectButton(),this.maybeRenderWinShine(),this.maybeRenderGerminateButton(),this.maybeRenderInvalidAction(),a.createElement("div",{className:Ve()("hud-bottom-right",{hidden:!n})},a.createElement(Oi,{tile:this.mito.getHighlightedTile()}),a.createElement("div",{className:"player-inventory-container"},t,a.createElement(gi,{water:this.inventory.water,sugar:this.inventory.sugar,capacity:this.inventory.capacity,format:"icons",className:"player-inventory-bar"})),a.createElement(ji,{bar:this.mito.toolBar})),this.maybeRenderCellInspector())}},{key:"maybeRenderCellInspector",value:function(){var e=this.mito.inspectedCell;if(null!=e)return a.createElement(si,{mito:this.mito,positionFn:this.positionFn},a.createElement(ki,{cell:e,player:this.player,onDone:this.handleCellInspectorDone}))}},{key:"maybeRenderInvalidAction",value:function(){var e=this.mito.invalidAction;if(null!=e)return a.createElement(Mi,{invalidAction:e})}},{key:"maybeRenderGerminateButton",value:function(){var e=this,t=function(){var t=e.mito.controls;t instanceof ti&&t.popOut()};if(null!=this.world.playerSeed)return a.createElement("div",{className:"hud-germinate",onClick:t},a.createElement("p",null,"Germinate"),a.createElement(yi,{hotkey:"Space",onClick:t}))}},{key:"maybeRenderCollectButton",value:function(){var e=this,t=qr(this.mito);if("won"===t.status)return a.createElement("div",{className:"hud-right-of-time"},a.createElement(Zt,{color:"purple",onClick:function(){return e.mito.onWinLoss(t)}},"Win (+ ",t.mutationPointsPerEpoch," MP per epoch)"))}},{key:"maybeRenderWinShine",value:function(){if("won"===qr(this.mito).status)return a.createElement("div",{className:"win-shine"})}},{key:"maybeRenderGenomeViewer",value:function(){if(this.state.genomeViewerOpen)return a.createElement("div",{className:"hud-top"},a.createElement(ra,{genome:this.mito.world.genome}))}},{key:"mito",get:function(){return this.props.mito}},{key:"world",get:function(){return this.mito.world}},{key:"player",get:function(){return this.world.player}},{key:"inventory",get:function(){return this.player.inventory}}]),t}(a.Component),Mi=a.memo((function(e){var t=e.invalidAction,n=pe()();return a.createElement("div",{className:"hud-below-center"},a.createElement("div",{className:"invalid-action",key:n},t.message))})),Ti=Object(a.memo)((function(e){var t=e.world,n=e.time,i=Object(a.useRef)(0),o=Object(a.useRef)(0),s=n-i.current,l=0,c=0,u=0,h=0,d=0,f=0,v=!0,p=!1,y=void 0;try{for(var g,b=t.allCells()[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value;l+=w.inventory.water,c+=w.inventory.sugar,u+=w.energy,h++;var A=w.findGene(m.g);A&&(d+=A.state.totalSucked);var O=w.findGene(m.f);O&&(f+=O.state.totalSugarProduced)}}catch(S){p=!0,y=S}finally{try{v||null==b.return||b.return()}finally{if(p)throw y}}var k=(o.current-u)/s,E=k*R.n,j=u/k,x=d/t.time*R.n,C=f/t.time*R.n;return o.current=u,i.current=n,r.a.createElement("div",{className:"plant-stats",style:{margin:"10px 0",textAlign:"left"}},r.a.createElement("div",null,Object(Rn.a)(l,3)," ",r.a.createElement(Hn.a,{name:"water"}),",",Object(Rn.a)(c,3)," ",r.a.createElement(Hn.a,{name:"sugar"})),r.a.createElement("div",null,"Water per season: ",Object(Rn.a)(x,3)),r.a.createElement("div",null,"Sugar per season: ",Object(Rn.a)(C,3)),r.a.createElement("div",null,"Total energy: ",Object(Rn.a)(u,4)),r.a.createElement("div",null,"Average energy: ",Object(Rn.a)(u/h*100,2),"%"),r.a.createElement("div",null,"Sugar use per season: ",Object(Rn.a)(E,3)),r.a.createElement("div",null,"Time until starvation: ",Object(Rn.a)(j,3)," seconds."))})),Ri=function(e){var t=e.mito,n=a.useCallback((function(){t.onWinLoss({mpEarners:t.world.mpEarners,world:t.world,status:"won",mutationPointsPerEpoch:2,vignettes:t.vignettes})}),[t]),r=a.useCallback((function(){t.onWinLoss({mpEarners:t.world.mpEarners,world:t.world,status:"lost",mutationPointsPerEpoch:0,vignettes:t.vignettes})}),[t]),i=a.useCallback((function(){t.world.player.inventory.add(5,0)}),[t.world.player.inventory]),o=a.useCallback((function(){t.world.player.inventory.add(0,5)}),[t.world.player.inventory]);return a.createElement("div",{style:{position:"absolute",bottom:0,left:0,background:"white"}},a.createElement("div",{style:{display:"flex"}},a.createElement(Zt,{color:"green",onClick:n},"Win"),a.createElement(Zt,{color:"green",onClick:r},"Lose")),a.createElement("div",{style:{display:"flex"}},a.createElement(Zt,{onClick:i},"+5 ",a.createElement(Hn.a,{name:"water"})),a.createElement(Zt,{onClick:o},"+5 ",a.createElement(Hn.a,{name:"sugar"}))),a.createElement(Ti,{world:t.world,time:Math.floor(t.world.time)}),a.createElement("div",null,a.createElement("div",null,"Rainwater: ",t.world.numRainWater),a.createElement("div",null,"Evaporated Air: ",t.world.numEvaporatedAir),a.createElement("div",null,"Evaporated Soil: ",t.world.numEvaporatedSoil)),a.createElement("div",{style:{background:"white"}},Array.from(Gn.keyMap.values()).join(", ")))},Ni=function(e){function t(){return Object(C.a)(this,t),Object(at.a)(this,Object(rt.a)(t).apply(this,arguments))}return Object(it.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",{className:"mito-instructions"},a.createElement("div",{className:"mito-instructions-container"},a.createElement("div",{className:"esc",onClick:function(){return e.props.play()}},"Back (Esc)"),a.createElement("h1",null,"Mito"),a.createElement("div",{className:"play-button",onClick:function(){return e.props.play()}},"Play"),a.createElement("p",null,a.createElement("ol",null,a.createElement("li",null,"Build Tissue to expand your reach (press t and walk into empty space)."),a.createElement("li",null,"Build Roots (press r) underground to suck up adjacent water."),a.createElement("li",null,"Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar."),a.createElement("li",null,a.createElement("b",null,"Win the game by building and loading the Fruit with 1000 sugar.")),a.createElement("li",null,"Click around to see the different properties of each tile."),a.createElement("li",null,"Build leaves early."),a.createElement("li",null,"Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air."),a.createElement("li",null,"Explore underground for water reservoires and Fountains."),a.createElement("li",null,"Build transports (capital T) to carry water back up the plant."),a.createElement("li",null,"You can scroll out infinitely far."))),a.createElement("h3",null,"You"),a.createElement("p",null,"You can carry max ",R.g," resources, and you automatically suck in any resources you're standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil below and air above."),a.createElement("h3",null,"Soil and Underground"),a.createElement("p",null,"Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a permanent source of water. Soil is split up into Sand, Silt, and Clay. Water flows through sand easily, silt normally, and clay slowly. Fountains emit one water per 3 seconds."),a.createElement("h3",null,"Air and Aboveground"),a.createElement("p",null,"Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun, which gently sways left to right."),a.createElement("h3",null,"Water"),a.createElement("p",null,"Water is one of the main two resources. Water slowly diffuses from high to low densities, and is pulled down by gravity. Obtain water in the ground through Roots. Leaves require water to photosynthesize. You require water to build."),a.createElement("h3",null,"Sugar"),a.createElement("p",null,"Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by putting water next to leaves. Cells require sugar to survive. You require sugar to build."),a.createElement("h3",null,"Building"),a.createElement("p",null,'Build Tissue, Leaves, Roots, and The Fruit by toggling "build mode" on and walking into Air or Soil. Build Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they\'re not properly supported underneath them.'),a.createElement("h3",null,"Cells"),a.createElement("p",null,"All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their neighbors."),a.createElement("h3",null,"Tissue"),a.createElement("p",null,"Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to"," ",R.p," resources."),a.createElement("h3",null,"Roots"),a.createElement("p",null,"Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is called a Pairing."),a.createElement("h3",null,"Leaves"),a.createElement("p",null,"When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction Air/Tissue with water. In perfect co2 and Water availability, Leaves produce 1 sugar every"," ",R.c.toFixed(2)," seconds per pair. Leaf efficiency is heavily influenced by co2 and sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize. Leaves higher up produce sugar faster."),a.createElement("h3",null,"Transport"),a.createElement("p",null,"Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you. Transport hungers at double speed."),a.createElement("h3",null,"The Fruit"),a.createElement("p",null,"You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to 1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity."),this.renderCredit()))}},{key:"renderCredit",value:function(){return a.createElement(a.Fragment,null,a.createElement("h2",null,"Attribution"),a.createElement("p",null,"Tiles:"," ",a.createElement("a",{href:"http://kenney.nl/assets?s=roguelike",target:"_blank",rel:"noopener noreferrer"},"Kenney.nl Roguelike Assets")),a.createElement("p",null,"Pop sound when leaves convert:"," ",a.createElement("a",{href:"http://soundbible.com/2067-Blop.html",target:"_blank",rel:"noopener noreferrer"},"Blop by Mark DiAngelo")," ","(",a.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/us/"},"CC BY 3.0 US"),")"),a.createElement("p",null,"Perlin noise:"," ",a.createElement("a",{href:"https://github.com/josephg/noisejs",target:"_blank",rel:"noopener noreferrer"},"josephg/noisejs")),a.createElement("p",null,"Part of 7drl 2018:"," ",a.createElement("a",{href:"http://7drl.org/",target:"_blank",rel:"noopener noreferrer"},"http://7drl.org/")),a.createElement("p",null,"Fruit icon:"," ",a.createElement("a",{href:"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm"},"Designed by Freepik")))}}]),t}(a.PureComponent);n(323);var Fi=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(at.a)(this,Object(rt.a)(t).call(this,"f"))).time=e,n.uv=new Zr.h,n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"generate",value:function(e,n){var a=e.include(t.ovalOutFn);return e.format(a+"( "+this.uv.build(e,"v2")+", "+this.time.build(e,"f")+" )",this.getType(e),n)}}]),t}(Zr.g);Fi.ovalOutFn=new Zr.b("\nfloat ovalOut(vec2 vUv, float time) {\n    return clamp((time - length(vUv - vec2(0.5))) * 15., 0.0, 1.0);\n}".trim());var Di=function(e){function t(e,n,a,r){var i,o;Object(C.a)(this,t),(i=Object(at.a)(this,Object(rt.a)(t).call(this,e,n))).onWinLoss=r,i.world=void 0,i.toolBar=void 0,i.scene=(o=new u.Scene,function(e){e.background=new u.Color("black")}(o),o),i.scenePlayerSeed=new u.Scene,i.camera=new u.OrthographicCamera(0,0,0,0,-100,100),i.tutorialRef=null,i.mouse=new va(i.canvas),i.instructionsOpen=!1,i.audioListener=new u.AudioListener,i.highlightedTile=void 0,i._inspectedCell=void 0,i.worldRenderer=void 0,i.vignetteCapturer=new Qr(Object(ln.a)(i)),i.vignettes=[],i.hackCamera=void 0,i.orbitControls=void 0,i.suggestedCamera=void 0,i.userZoom=void 0,i._controls=void 0,i.nodeFrame=new Zr.d(0),i.nodePost=void 0,i.ovalOutTime=void 0,i.stats=new ba.a,i.events={wheel:function(e){var t=-(e.deltaX+e.deltaY)/125/20,n=i.userZoom,a=Math.pow(2,t),r=Object(X.a)(n*a,1,3);i.userZoom=r}},i.handlePlayerActionFail=function(e,t){null==t?"pickup"===e.type&&i.world.player.inventory.isMaxed()?i.showInvalidAction({message:"Inventory full!"}):"drop"===e.type&&e.target&&e.target.inventory.isMaxed()&&i.showInvalidAction({message:"".concat(e.target.displayName," inventory full!")}):i.showInvalidAction({message:t})},i.handleBeforeUnload=function(){return!0},i.handleContextMenu=function(e){return e.preventDefault(),!1},i.PLAYER_TETHER_DISTANCE=.9,i.worldDomElements=new Set,i.invalidAction=void 0,i.renderer.autoClear=!1,i.nodePost=new Zr.e(e),i.ovalOutTime=new Zr.a(0);var s=new Zr.c(new Zr.f,new Fi(i.ovalOutTime),i.ovalOutTime,Zr.c.MIN);i.nodePost.output=s;var l=a.targetHex.info;return i.world=new ie(function(e){switch(e.height){case 0:return Me;case 1:return Te;case 2:return Re;case 3:return Ne;case 4:return Fe;case 5:default:return De}}(l),l.seed,a.settlingSpecies),i.world.player.on("action-fail",i.handlePlayerActionFail),i.camera.position.z=10,i.camera.lookAt(0,0,0),i.camera.position.x=i.world.player.pos.x,i.camera.position.y=i.world.player.pos.y,i.camera.zoom=i.userZoom=1.5,i.camera.add(i.audioListener),null!=i.hackCamera&&(i.orbitControls=new Xr.a(i.hackCamera,i.canvas),i.scene.add(new u.AxesHelper(25))),i.worldRenderer=new Yr(i.world,i.scene,Object(ln.a)(i)),Object(We.l)(i.audioContext),i.updateAmbientAudio(),i.attachWindowEvents(),i.toolBar=new ai(Object(ln.a)(i)),i.controls=new ti(Object(ln.a)(i)),i}return Object(it.a)(t,e),Object(S.a)(t,[{key:"inspectedCell",get:function(){return this._inspectedCell},set:function(e){T.a.showGodUI&&console.trace("set inspectedCell to",e),this._inspectedCell=e}},{key:"controls",get:function(){return this._controls},set:function(e){null!=this._controls&&this._controls.destroy(),this._controls=e}}]),Object(S.a)(t,[{key:"attachWindowEvents",value:function(){window.onbeforeunload=this.handleBeforeUnload,window.addEventListener("contextmenu",this.handleContextMenu),window.mito=this,window.THREE=u}},{key:"destroy",value:function(){window.removeEventListener("contextmenu",this.handleContextMenu),this.controls=void 0,window.onbeforeunload=null}},{key:"render",value:function(){var e=this;if(!T.a.hud)return null;var t=[],n=!0,r=!1,i=void 0;try{for(var o,s=this.worldDomElements[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;t.push(l.render())}}catch(u){r=!0,i=u}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}var c=null==this.world.playerSeed;return a.createElement(a.Fragment,null,a.createElement(Pi,{mito:this}),c?a.createElement(pi,{mito:this}):null,a.createElement("div",{className:"world-dom-components"},t),T.a.showGodUI?a.createElement(Ri,{mito:this}):null,T.a.showFPS?a.createElement(Ii,{mito:this}):null,this.instructionsOpen?a.createElement(Ni,{play:function(){return e.instructionsOpen=!1}}):null)}},{key:"updateAmbientAudio",value:function(){var e=this.world.player.pos.y,t=Object(X.d)(e,this.world.height/2,this.world.height,0,.5),n=Object(X.d)(e,this.world.height/2,0,0,.5);We.h.gain.gain.value=Math.max(0,t),We.r.gain.gain.value=Math.max(0,n)}},{key:"maybeToggleInstructions",value:function(e){return"F1"===e?(this.instructionsOpen=!this.instructionsOpen,!0):this.instructionsOpen&&"Escape"===e?(this.instructionsOpen=!1,!0):void 0}},{key:"worldStep",value:function(e){if(!this.instructionsOpen){this.world.step(e),this.tutorialRef&&this.tutorialRef.setState({time:this.world.time});var t=function(e){var t=e.world,n=null!=t.playerSeed,a=!0,r=!1,i=void 0;try{for(var o,s=t.allCells()[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){o.value;n=!0;break}}catch(l){r=!0,i=l}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}return!n?qr(e):null}(this);null!=t&&this.onWinLoss(t),this.updateAmbientAudio()}}},{key:"getCameraNormCoordinates",value:function(e,t){return new u.Vector2(e/this.canvas.width*2-1,-t/this.canvas.height*2+1)}},{key:"getPlayerInfluenceVector",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.position.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.position.y,n=this.getWorldCoordinates(e,t),a=new u.Vector2(n.x,n.y).sub(this.world.player.posFloat);return a.clampLength(0,this.PLAYER_TETHER_DISTANCE),a}},{key:"getWorldCoordinates",value:function(e,t){var n=this.getCameraNormCoordinates(e,t);return Object(X.l)(new u.Vector3(n.x,n.y,0).unproject(this.camera))}},{key:"getTileAtScreen",value:function(e,t){var n=this.getWorldCoordinates(e,t);n.round();var a=this.world.tileAt(n.x,n.y);if(null!=a&&a.lightAmount()>0)return a}},{key:"getHighlightPosition",value:function(){if(this.inspectedCell)return this.inspectedCell.pos;var e=this.getPlayerInfluenceVector(),t=this.world.player.posFloat,n=t.x,a=t.y;return e.x+=n,e.y+=a,e}},{key:"getHighlightedTile",value:function(){var e=this.getHighlightPosition();e.round();var t=this.world.tileAt(e.x,e.y);if(null!=t&&t.lightAmount()>0)return t}},{key:"worldToScreen",value:function(e){var t=new u.Vector3(e.x,e.y,0);return t.project(this.camera),t.x=Math.round((.5+t.x/2)*this.canvas.width),t.y=Math.round((.5-t.y/2)*this.canvas.height),t}},{key:"addWorldDOMElement",value:function(e,t){var n=new oi(this,e,t);return this.worldDomElements.add(n),n}},{key:"removeWorldDOMElement",value:function(e){this.worldDomElements.delete(e)}},{key:"addFloatingText",value:function(){var e=Object(Ht.a)(G.a.mark((function e(t,n){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.addWorldDOMElement((function(){return t}),(function(){return a.createElement("div",{className:"floating-text"},n)})),e.next=3,P(1e3);case 3:this.removeWorldDOMElement(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"showInvalidAction",value:function(){var e=Object(Ht.a)(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.invalidAction=t,e.next=3,P(3e3);case 3:this.invalidAction===t&&(this.invalidAction=void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"animate",value:function(e){var t;this.stats.end(),this.stats.begin(),null===(t=this.controls)||void 0===t||t.animate(e);var n=this.inspectedCell;null!=n&&((n.isDead||n.findEffectOfType(ge.a)||n.findEffectOfType(ge.b))&&(this.inspectedCell=void 0),null!=this.world.player.getAction()&&(this.inspectedCell=void 0));var a,r=Math.min(e/1e3,1/3);if(this.worldStep(r),this.worldRenderer.update(),this.highlightedTile=this.getHighlightedTile(),null!=this.highlightedTile&&this.worldRenderer.getOrCreateRenderer(this.highlightedTile).updateHover(),this.vignetteCapturer.isTimeForNewCapture()){var i=this.vignetteCapturer.capture();this.vignettes.push(i)}if(this.updateCamera(this.suggestedCamera||this.defaultCameraState()),this.suggestedCamera=void 0,null!=this.hackCamera)this.renderer.render(this.scene,this.hackCamera);else{this.world.time-r<3.5&&this.world.time>3.5&&We.t.play(),this.ovalOutTime.value=Object(fa.a)(Object(X.a)((this.world.time-3.5)/1.5,0,1)),this.nodeFrame.update(e/1e3),this.renderer.clear(),this.nodePost.render(this.scene,this.camera,this.nodeFrame),this.renderer.clearDepth(),this.renderer.render(this.scenePlayerSeed,this.camera)}T.a.debugPerf&&this.frameCount%100===0&&(!function(e){var t=0,n=0;e.scene.traverse((function(e){e.matrixAutoUpdate?t++:n++})),console.log("matrixAutoUpdate: yes",t,", no",n);var a=new Map;e.scene.traverse((function(e){var t=a.get(e.name||e.constructor.name)||[];a.set(e.name||e.constructor.name,t),t.push(e)})),console.log(a)}(this),a=this.renderer,console.log("Geometries in memory: ".concat(a.info.memory.geometries,"\nTextures in memory: ").concat(a.info.memory.textures,"\nNumber of Programs: ").concat(a.info.programs.length,"\n# Render Calls: ").concat(a.info.render.calls,"\n# Render Lines: ").concat(a.info.render.lines,"\n# Render Points: ").concat(a.info.render.points,"\n# Render Tris: ").concat(a.info.render.triangles,"\n")))}},{key:"defaultCameraState",value:function(){if(null==this.world.playerSeed){var e=this.getCameraNormCoordinates(this.mouse.position.x,this.mouse.position.y),t=this.world.player.droopPosFloat().clone();return t.x+=e.x/2,t.y-=e.y/2,{center:t,zoom:this.userZoom}}return{center:this.world.playerSeed.pos,zoom:this.userZoom}}},{key:"updateCamera",value:function(e){var t=e.center,n=e.zoom;Object(X.c)(this.camera.position,t,.2),Math.abs(this.camera.zoom-n)>.001&&(this.camera.zoom=Object(X.b)(this.camera.zoom,e.zoom,.1),this.camera.updateProjectionMatrix())}},{key:"suggestCamera",value:function(e){this.suggestedCamera=e}},{key:"resize",value:function(e,t){var n=t/e;this.camera.left=-12/n,this.camera.right=12/n,this.camera.top=-12,this.camera.bottom=12,this.camera.updateProjectionMatrix(),this.nodePost.setSize(e,t)}}]),t}(ya);Di.id="mito";var Bi=Di,Ii=function(e){var t=e.mito;return a.useEffect((function(){return document.body.appendChild(t.stats.dom),function(){document.body.removeChild(t.stats.dom)}}),[t.stats.dom]),null},Li=(n(324),function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(at.a)(this,Object(rt.a)(t).call(this,e))).frameId=void 0,n.lastTimestamp=0,n.stop=!1,n.handleVolumeButtonClick=function(){var e=!n.state.volumeEnabled;n.setState({volumeEnabled:e}),window.localStorage.setItem("sketch-volumeEnabled",JSON.stringify(e))},n.loop=function(e){var t=e-n.lastTimestamp;n.lastTimestamp=e,n.props.sketch.frameCount++,n.props.sketch.timeElapsed=e,n.syncAudioContext();try{n.props.sketch.animate(t)}catch(a){console.error(a)}n.stop?cn.a.removeAnimation(n.frameId):n.setState({frameCount:n.props.sketch.frameCount})},n.handleWindowResize=function(){var e=n.props.sketch.renderer;n.updateRendererCanvasToMatchParent(e),null!=n.props.sketch.resize&&n.props.sketch.resize(e.domElement.width,e.domElement.height)},n.handleVisibilityChange=function(){n.syncAudioContext()},n.state={frameCount:e.sketch.frameCount,volumeEnabled:JSON.parse(window.localStorage.getItem("sketch-volumeEnabled")||"true")},n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"shouldPlayAudio",value:function(){return this.state.volumeEnabled&&"visible"===document.visibilityState&&document.hasFocus()}},{key:"syncAudioContext",value:function(){var e=this.props.sketch.audioContext;null!=e&&(this.shouldPlayAudio()&&"suspended"===e.state?e.resume():this.shouldPlayAudio()||"running"!==e.state||e.suspend())}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleWindowResize),document.addEventListener("visibilitychange",this.handleVisibilityChange),this.handleWindowResize();var t=this.props.sketch.renderer.domElement;t.tabIndex=1,Object.keys(pa).forEach((function(n){if(null!=e.props.sketch.events){var a=e.props.sketch.events[n];null!=a&&(e.props.eventsOnBody?document.body.addEventListener(n,a):t.addEventListener(n,a))}})),this.frameId=cn.a.addAnimation(this.loop)}},{key:"render",value:function(){var e=[];return null!=this.props.sketch.render&&e.push(this.props.sketch.render()),null!=this.props.sketch.elements&&e.push.apply(e,Object(se.a)(this.props.sketch.elements)),a.createElement("div",{className:"sketch-elements"},e.map((function(e,t){return a.isValidElement(e)?a.cloneElement(e,{key:t}):e})),this.renderVolumeButton())}},{key:"renderVolumeButton",value:function(){if(T.a.hud){var e=this.state.volumeEnabled;return a.createElement("button",{className:"user-volume",onClick:this.handleVolumeButtonClick},e?a.createElement(Sn.d,null):a.createElement(Sn.c,null))}}},{key:"componentWillUnmount",value:function(){var e=this;this.stop=!0,this.props.sketch.destroy&&this.props.sketch.destroy(),null!=this.frameId&&cn.a.removeAnimation(this.frameId),this.props.sketch.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize),document.removeEventListener("visibilitychange",this.handleVisibilityChange);var t=this.props.sketch.canvas;Object.keys(pa).forEach((function(n){if(null!=e.props.sketch.events){var a=e.props.sketch.events[n];null!=a&&(e.props.eventsOnBody?document.body.removeEventListener(n,a):t.removeEventListener(n,a))}}))}},{key:"updateRendererCanvasToMatchParent",value:function(e){var t=e.domElement.parentElement;null!=t&&e.setSize(t.clientWidth,t.clientHeight)}}]),t}(a.PureComponent)),Vi=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(r)))).state={status:{type:"loading"}},n.audioContext=void 0,n.userVolume=void 0,n.handleContainerRef=function(e){var t;if(null!=e)try{var a=n.audioContext=ma.Howler.ctx;u.AudioContext.setContext(a),n.userVolume=a.createGain(),n.userVolume.gain.setValueAtTime(.8,0),n.userVolume.connect(ma.Howler.masterGain),(a.gain=a.createGain()).connect(n.userVolume);var r=new u.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0,antialias:!0});r.debug.checkShaderErrors=!0,e.appendChild(r.domElement);var i=n.props.otherArgs||[],o=Object(H.a)(i,2),s=o[0],l=o[1],c=new Bi(r,n.audioContext,s,l);n.setState({status:{type:"success",sketch:c}})}catch(h){n.setState({status:{type:"error",error:h}}),console.error(h)}else"success"===n.state.status.type&&n.state.status.sketch.canvas.remove(),null===(t=n.userVolume)||void 0===t||t.disconnect(),n.setState({status:{type:"loading"}})},n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.otherArgs,e.eventsOnBody,e.errorElement,Object(Ge.a)(e,["otherArgs","eventsOnBody","errorElement"])),n=Ve()("sketch-component",this.state.status.type);return a.createElement("div",Object.assign({},t,{className:n,ref:this.handleContainerRef}),this.renderSketchOrStatus())}},{key:"renderSketchOrStatus",value:function(){var e=this.state.status;return"success"===e.type?a.createElement(Li,{sketch:e.sketch,eventsOnBody:this.props.eventsOnBody}):"error"===e.type?this.props.errorElement||this.renderDefaultErrorElement(e.error.message):"loading"===e.type?null:void 0}},{key:"renderDefaultErrorElement",value:function(e){return a.createElement("p",{className:"sketch-error"},"Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.",a.createElement("pre",null,e))}}]),t}(a.PureComponent),zi=(n(325),function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(at.a)(this,(e=Object(rt.a)(t)).call.apply(e,[this].concat(r)))).handleDivRef=function(e){null!=e||n.exitFullscreen()},n}return Object(it.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return a.createElement("div",{className:"full-page-sketch",ref:this.handleDivRef},a.createElement(Vi,{otherArgs:this.props.otherArgs}))}},{key:"exitFullscreen",value:function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}}]),t}(a.PureComponent)),Wi=(n(326),r.a.memo((function(e){var t=e.onStart;return Object(a.useEffect)((function(){var e=function(e){"Enter"!==e.code&&"Space"!==e.code||t()};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[t]),r.a.createElement("div",{className:"start-screen"},r.a.createElement("h1",null,"Mito",r.a.createElement(Ye,{size:"small",className:"mito-i"})),r.a.createElement("div",{className:"bottom-area"},r.a.createElement(Zt,{color:"green",onClick:t},"Start Game"),r.a.createElement("a",{className:"discord",rel:"noopener noreferrer",target:"_blank",href:"http://discord.gg/N8wWwPX"},r.a.createElement(Sn.b,null))),r.a.createElement("div",{className:"game-version"},"v0.8.0-dev"))}))),Gi=function(e){function t(e,n){var a;return Object(C.a)(this,t),(a=Object(at.a)(this,Object(rt.a)(t).call(this,e,n))).context=void 0,a.handleMousePosition=function(e){a.setState({mousePosition:{x:e.clientX,y:e.clientY}})},a.handleNextEpoch=function(){(0,Object(H.a)(a.context,2)[1])({type:"AANextEpoch"})},a.handleWinLoss=function(e){(0,Object(H.a)(a.context,2)[1])({type:"AATransitionStart",transition:{type:"AAGetGameResult",result:e}})},a.handleResultsDone=function(){(0,Object(H.a)(a.context,2)[1])({type:"AATransitionStart",transition:{type:"AAGameResultDone"}})},a.handleCloseStartScreen=function(){return a.setState({showStartScreen:!1})},a.otherArgsSelector=Object(ca.a)((function(e){return e.activePopulationAttempt}),(function(e){return[e,a.handleWinLoss]})),a.state={mousePosition:{x:window.innerWidth/2,y:window.innerHeight/2},showStartScreen:!0},a}return Object(it.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("mousemove",this.handleMousePosition)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.handleMousePosition)}},{key:"render",value:function(){var e=Object(H.a)(this.context,1)[0];return r.a.createElement(ot.Provider,{value:this.state.mousePosition},r.a.createElement("div",{className:"App"},r.a.createElement(Hi,{show:this.state.showStartScreen},r.a.createElement(Wi,{onStart:this.handleCloseStartScreen})),r.a.createElement(Hi,{show:null==e.activePopulationAttempt&&!this.state.showStartScreen},r.a.createElement(sa,{onNextEpoch:this.handleNextEpoch})),r.a.createElement(Hi,{show:null!=e.activePopulationAttempt&&null==e.activeGameResult},r.a.createElement(zi,{otherArgs:this.otherArgsSelector(e)})),r.a.createElement(Hi,{show:null!=e.activeGameResult},e.activeGameResult?r.a.createElement($e,{results:e.activeGameResult,onDone:this.handleResultsDone}):r.a.createElement("div",null))))}}]),t}(r.a.PureComponent);Gi.contextType=ht;var Hi=Object(a.memo)((function(e){var t=e.show,n=e.children,a=dt(),i=Object(H.a)(a,1)[0];return r.a.createElement(la.a,{in:t&&null==i.transition,timeout:2e3,mountOnEnter:!0,unmountOnExit:!0,classNames:"fade-to-black"},n)})),Ui=function(){return r.a.createElement(da,{loadingComponent:r.a.createElement("div",null,"Loading...")},r.a.createElement(Gi,null))};n(160);function Yi(e,t){console.log("running");for(var n=new je([new Ee({countAir:function(e){return e.filter((function(e){return e.constructor===c.a})).length}}),new Ee({countSoil:function(e){return e.filter((function(e){return e.constructor===c.h})).length}}),new Ee({countRock:function(e){return e.filter((function(e){return e.constructor===c.g})).length}}),new Ee({countFountain:function(e){return e.filter((function(e){return e.constructor===c.d})).length}}),new Ee({playerY:function(e,t){return t.player.pos.y}}),new Ee({startAdjacentWaters:function(e,t){var n=function(e,t){var n,a=new Set,r=!0,i=!1,o=void 0;try{for(var s,l=e.entities()[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value;if(u instanceof c.i&&(n=u,e.player.isWalkable(n))){var h=!0,d=!1,m=void 0;try{for(var f,v=e.tileNeighbors(u.pos)[Symbol.iterator]();!(h=(f=v.next()).done);h=!0){var p=Object(H.a)(f.value,2)[1];e.player.canBuildAt(p)&&(null==t?a.add(p):t(p)&&a.add(p))}}catch(y){d=!0,m=y}finally{try{h||null==v.return||v.return()}finally{if(d)throw m}}}}}catch(y){i=!0,o=y}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return a}(t,(function(e){return e instanceof c.h})),a=0,r=!0,i=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){a+=s.value.inventory.water}}catch(u){i=!0,o=u}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return a}}),new Ee({countWaters:function(e){return e.reduce((function(e,t){return e+t.inventory.water}),0)}})]),a=0;a<20;a++){console.time("trial "+a);var r=new ie(e,a,Oe());n.recordDataFor(Array.from(r.allEnvironmentTiles())),console.timeEnd("trial "+a)}!function(e,t){var n=[],a=e.map((function(e){return e.visitorNames().join("")}));for(var r in a){for(var i=a[r],o=[],s=[],l=0;l<e[0].trials.length;l++){o.push(l);var c=e[r].trials[l][i];s.push(c)}var u={x:o,y:s,name:i,type:"bar"};n.push(u)}var h=document.createElement("div");document.getElementById(t).appendChild(h),window.Plotly.newPlot(h,n,{barmode:"stack"})}(n.experiments.slice(0,4),t);var i=!0,o=!1,s=void 0;try{for(var l,u=n.experiments[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){Ki(l.value,t)}}catch(h){o=!0,s=h}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}}function Ki(e,t){var n=[],a={},r=!0,i=!1,o=void 0;try{for(var s,l=function(){var t=s.value;u={x:e.trials.map((function(e){return e[t]})),type:"histogram",name:t},n.push(u),a.title={text:t}},c=e.visitorNames()[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u;l()}}catch(d){i=!0,o=d}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}var h=document.createElement("div");document.getElementById(t).appendChild(h),h.style.height="240px",h.style.width="320px",h.style.display="inline-block",window.Plotly.newPlot(h,n,a)}var Qi=function(){return r.a.useEffect((function(){var e=document.createElement("script");e.src="https://cdn.plot.ly/plotly-latest.min.js",e.addEventListener("load",(function(){Yi(Te,"temperate"),Yi(Ne,"rocky"),Yi(De,"desert")})),document.body.appendChild(e)}),[]),r.a.createElement("div",null,r.a.createElement("h1",null,"Experiments"),r.a.createElement("div",{id:"temperate"},r.a.createElement("h2",null,"Temperate")),r.a.createElement("div",{id:"rocky"},r.a.createElement("h2",null,"Rocky")),r.a.createElement("div",{id:"desert"},r.a.createElement("h2",null,"Desert")))},Xi=function(){return r.a.createElement("div",null,r.a.createElement("h1",null,"Unknown page"),r.a.createElement(s.b,{to:"/"},"Back to main screen"))};Object(le.a)(u.Color,{r:Object(le.i)(),g:Object(le.i)(),b:Object(le.i)()}),Object(le.a)(u.Vector2,{x:Object(le.i)(),y:Object(le.i)()});var Zi;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));(Zi=n(329)).keys().forEach(Zi),o.a.render(r.a.createElement(s.a,null,r.a.createElement((function(){return r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/test-lose"},r.a.createElement(nt,null)),r.a.createElement(l.a,{path:"/test-win"},r.a.createElement(tt,null)),r.a.createElement(l.a,{path:"/test-stats"},r.a.createElement(Qi,null)),r.a.createElement(l.a,{path:"/test-diffusion"},r.a.createElement(Pe,null)),r.a.createElement(l.a,{exact:!0,path:"/"},r.a.createElement(Ui,null)),r.a.createElement(l.a,{path:"*",component:Xi}))}),null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[205,1,2]]]);
//# sourceMappingURL=main.61ccd4dc.chunk.js.map