{"version":3,"sources":["math/random.ts","math/index.ts","core/tile/fountain.ts","core/tile/rock.ts","core/tile/index.ts","game/audio.ts","core/cell/gene.ts","core/constants.ts","std/genes/index.ts","core/temperature.ts","game/params.ts","game/ui/common/ResourceIcon.tsx","common/formatters.ts","core/directions.ts","core/cell/index.ts","std/genes/RI.tsx","std/genes/GN.tsx","core/cell/genome.ts","std/ticker.ts","core/inventory.ts","core/tile/soil.ts","core/cell/chromosome.ts","core/cell/cell.ts","game/ui/common/DynamicNumber.tsx","core/tile/tile.ts","std/genes/GeneReproducer.tsx","game/ui/common/MP.tsx","core/cell/cellEffect.ts","math/shuffle.ts","common/perlin.ts","core/entity.ts","std/genes/GeneObstacle.tsx","core/tile/air.ts","common/mapRecord.ts","core/cell/realizedGene.ts","core/cell/GeneUnknown.tsx","common/devlog.ts","std/genes/GenePipes.tsx","std/genes/GeneTransport.tsx","core/tile/deadCell.ts","std/geneUtil.ts","std/genes/GeneAttractsSugar.tsx","std/genes/GeneCannotFreeze.tsx","std/genes/GeneDiffuseWater.tsx","std/genes/GenePhotosynthesis.tsx","core/cell/growingCell.ts","core/cell/geneInstance.ts","core/cell/cellProperties.ts","core/cell/materialInfo.ts","core/interactable.ts","core/tile/BarrenLand.ts","std/genes/GeneAiryExpansion.tsx","std/genes/GeneAttractsWater.tsx","std/genes/GeneBark.tsx","std/genes/GeneCostly.tsx","std/genes/GeneDiffuseSugar.tsx","std/genes/GeneHydrostasis.tsx","std/genes/GeneInventory.tsx","std/genes/GeneLiving.tsx","std/genes/GeneNetworkEffect.tsx","std/genes/GeneNutrientExtraction.tsx","std/genes/GeneOsmosis.tsx","std/genes/GenePushWater.tsx","std/genes/GeneScaffolding.tsx","std/genes/GeneSoilAbsorption.tsx","std/genes/GeneVascular.tsx","assets/audio/Blop-Mark_DiAngelo-79054334.mp3","assets/audio/build.mp3","assets/audio/build_complete.mp3","assets/audio/deconstruct.mp3","assets/audio/drop_water.mp3","assets/audio/eating.mp3","assets/audio/footsteps.wav","assets/audio/fruit-popOpen.mp3","assets/audio/impactSoft_medium_003.mp3","assets/audio/interact.mp3","assets/audio/intro-bounce.mp3","assets/audio/mito-base.mp3","assets/audio/mito-drums.mp3","assets/audio/mito-overworld.mp3","assets/audio/mito-start.mp3","assets/audio/mito-strings.mp3","assets/audio/mitodeath.mp3","assets/audio/sticky.mp3","assets/audio/suckwater.wav","assets/audio/switch23.wav","assets/audio/switch25.wav","assets/audio/whoosh.mp3","assets/images/sugar.png","assets/images/water.png","assets/images/fruit.png","assets/images/character.png","assets/images/grasshopper.png","assets/images/test-vignette.png","assets/images/spritesheet.png","assets/images/snow.png","assets/audio/switch26.wav","assets/audio/rollover6.wav","std/genes sync /Gene.*/.tsx?$","std/genes/GeneAdhesion.tsx","std/genes/GeneFastMetabolism.tsx","std/genes/GeneFluidMembrane.tsx","std/genes/GeneProliferation.tsx","std/genes/GeneSlowMetabolism.tsx","std/genomes/standardGenome.ts","core/player/player.ts","common/promise.ts","core/player/playerSeed.ts","core/season.ts","core/world/stepStats.ts","core/insect.ts","math/arrays.ts","core/tileGenerator.ts","std/tileGenerators.ts","math/poissonDisc.ts","core/world/generatorContext.ts","core/world/weather.ts","core/world/world.ts","std/genomes/tutorialGenome.ts","core/species.ts","tests/experiment.ts","tests/TestDiffusion.tsx","std/environments.ts","game/ui/common/Character.tsx","game/ui/common/Glow.tsx","game/screens/GameResultsScreen.tsx","tests/TestWinScreen.tsx","tests/TestLoseScreen.tsx","tests/WFCTest.tsx","game/ui/SpeciesViewer/generateGeneOptions.tsx","game/app/reducer.ts","common/capitalize.ts","common/randomName.ts","core/environment.ts","core/overworld/levelInfo.ts","core/overworld/hexTile.ts","core/overworld/hexStore.ts","core/overworld/overWorld.ts","game/app/state.ts","game/app/saveLoad.ts","game/ui/common/Button.tsx","game/ui/overworld/SpeciesNode.tsx","game/ui/overworld/PhylogeneticTree.tsx","game/ui/overworld/EpochUI.tsx","game/input/keyboard.ts","game/ui/overworld/hexMath.ts","game/ui/ingame/TemperatureGauge.tsx","game/ui/overworld/map/HexInfo.tsx","game/ui/overworld/map/hexTileSprite.ts","game/ui/overworld/map/OverWorldPopover.tsx","game/ui/overworld/map/OverWorldMap.tsx","game/ui/SpeciesViewer/AddCellCard.tsx","common/lazy.ts","game/spritesheet.ts","game/ui/common/IconCell.tsx","game/ui/SpeciesViewer/CellInteractionSelector.tsx","game/ui/SpeciesViewer/droppableId.ts","game/ui/SpeciesViewer/MoreOptionsPopover.tsx","game/ui/SpeciesViewer/GeneCost.tsx","game/ui/SpeciesViewer/RealizedGeneViewer.tsx","game/ui/SpeciesViewer/viewerState.ts","game/ui/SpeciesViewer/CellTypeViewer.tsx","game/ui/SpeciesViewer/GenomeViewer.tsx","game/ui/SpeciesViewer/speciesViewerDragEnd.ts","game/ui/SpeciesViewer/SpeciesViewer.tsx","game/ui/SpeciesViewer/index.ts","game/screens/OverWorldScreen.tsx","game/app/AppStateProvider.tsx","game/input/mouse.ts","game/screens/sketch/sketch.ts","game/renderers/Renderer.tsx","game/renderers/glsl.ts","game/renderers/committablePoints.ts","game/renderers/fireAndForgetPoints.ts","game/renderers/events/eventRenderer.ts","game/renderers/events/eventRendererFFPoints.ts","game/renderers/events/eventCellEatRenderer.ts","game/renderers/events/eventCellTransferEnergyRenderer.ts","math/easing.ts","game/renderers/events/eventCollectSunlightRenderer.ts","common/configure.ts","game/renderers/InventoryRenderer.tsx","game/renderers/events/eventEvaporationRenderer.ts","game/renderers/events/eventGrowFruitRenderer.ts","game/renderers/events/eventPhotosynthesisRenderer.ts","game/renderers/tile/CellEffectsRenderer.tsx","game/renderers/events/eventThawIceRenderer.ts","game/renderers/events/eventLogRenderer.ts","game/renderers/tile/Animation.tsx","game/renderers/InsectRenderer.tsx","game/ui/ingame/InventoryBar.tsx","game/renderers/neuronMesh.ts","game/renderers/PlayerRenderer.tsx","game/renderers/PlayerSeedRenderer.tsx","game/renderers/SnowRenderer.tsx","common/arrayProxy.ts","game/renderers/tile/GeneRenderer.tsx","game/renderers/tile/makeLine.ts","game/renderers/tile/GenePhotosynthesisRenderer.tsx","game/renderers/tile/tileBatcher.ts","game/renderers/tile/GenePipesRenderer.tsx","game/renderers/tile/GeneReproducerRenderer.tsx","game/renderers/tile/GeneSoilAbsorptionRenderer.tsx","game/renderers/tile/GeneTransportRenderer.tsx","game/renderers/tile/InstancedTileRenderer.tsx","game/renderers/WorldRenderer.tsx","std/vignette.ts","game/gameResult.ts","game/input/keymap.ts","game/input/ControlScheme.tsx","game/input/toolBar.ts","game/mito/WorldDOMElement.tsx","game/renderers/r3/Animate.tsx","game/renderers/r3/sceneObject.tsx","game/renderers/r3/buildBlueprint.tsx","game/renderers/r3/PointHighlight.tsx","game/renderers/r3/tileHighlight.tsx","std/worldUtils.ts","game/ui/ingame/Hover.tsx","game/ui/ingame/HotkeyButton.tsx","game/ui/ingame/TileDetails.tsx","game/ui/ingame/hud/CellInspector.tsx","game/ui/ingame/hud/GameMenu.tsx","common/useHotkey.tsx","game/ui/ingame/hud/ToolBarUI.tsx","game/ui/ingame/hud/InteractToolSwitcher.tsx","game/ui/ingame/hud/InvalidActionMessage.tsx","game/ui/ingame/hud/PausedTileDetailsPopover.tsx","game/ui/ingame/hud/SeasonsTracker.tsx","game/ui/ingame/hud/Tutorial.tsx","game/ui/ingame/hud/HUD.tsx","game/ui/ingame/PlantStats.tsx","game/ui/ingame/Debug.tsx","game/mito/ovalNode.ts","game/mito/mito.tsx","game/mito/logRenderInfo.tsx","game/mito/perfDebugThreeObjects.ts","game/screens/sketch/SketchComponent.tsx","game/screens/MitoScreen.tsx","game/screens/StartScreen.tsx","game/screens/App.tsx","tests/TestLevel.tsx","tests/TestOverworld.tsx","tests/TestStats.tsx","Routes.tsx","addThreeJsModelSchemas.ts","serviceWorker.ts","index.tsx"],"names":["randFloat","min","max","Math","random","randInt","inclusiveMin","inclusiveMax","floor","randElement","arr","length","lerp","a","b","x","lerpLinear","speed","clamp","sign","lerp2","v","t","l","y","map","xStart","xStop","yStart","yStop","randRound","ix","fx","mod","m","sawTooth","logistic","k","exp","roundToNearest","to","round","toVector2","Vector2","Fountain","pos","world","secondsPerWater","waterRemaining","displayName","isObstacle","cooldown","dt","this","inventory","space","add","silt","Silt","clone","give","water","sugar","maybeRemoveCellAt","setTileAt","Rock","isStructuralSupport","Inventory","Tile","mito","strings","drums","clickGeneric","Howl","src","clickGenericSrc","volume","playSmallRand","howl","id","play","rate","genePickUp","genePickUpSrc","geneDrop","require","moveBumped","mitoDeath","mitoDeathMp3","autoplay","loop","mitoOverworld","mitoStartScreenMp3","mitoOverworldMp3","footsteps","footstepsSrc","interactSound","interactSoundSrc","introBounce","introBounceSrc","whoosh","whooshSrc","fruitPoof","fruitPoofSrc","build","buildSoundSrc","buildComplete","buildCompleteSrc","deconstruct","deconstructSoundSrc","sticky","stickySoundSrc","dropSugar","impactSoftMedium003Src","dropWater","dropWaterSrc","loader","THREE","loadAudioPromise","Promise","resolve","reject","load","audioBuffer","xhr","err","devlog","blopBuffer","blopSrc","suckWaterBuffer","suckWaterSrc","eatBuffer","eatingSoundSrc","hookUpAudio","ctx","numDone","oneMoreLoaded","audio","currentTime","gain","connect","makeUnitFromAudioAsset","mitoBaseSrc","oncanplaythrough","value","mitoStringsSrc","mitoDrumsSrc","sourceElement","type","substr","source","document","createElement","srcs","appendChild","createMediaElementSource","createGain","distScalar","player","dist","distanceToSquared","Gene","blueprint","initialStateFn","stepFn","shouldStepFn","level","RealizedGene","levelCosts","initialState","step","shouldStep","alwaysStep","neverStep","gene","stepNoOP","isHidden","name","exists","AllGenesByName","has","console","error","set","Map","PLAYER_BASE_SPEED","PLAYER_MAX_RESOURCES","PLAYER_STARTING_WATER","PLAYER_STARTING_SUGAR","PLAYER_INTERACT_EXCHANGE_SPEED","PLAYER_INTERACT_EXCHANGE_NONCELL_SPEED","TIME_PER_YEAR","TIME_PER_SEASON","TIME_PER_MONTH","TIME_PER_DAY","CELL_BUILD_TIME","CELL_DROOP","SUNLIGHT_REINTRODUCTION","SUNLIGHT_DIFFUSION","Temperature","PARAMS_DEFAULT","hud","showGodUI","showFPS","debugPerf","debugLevel","forceNight","debug","process","params","search","parse","window","location","urlHashParams","JSON","Object","assign","nonDefaultParams","keys","key","stringified","stringify","updateParamsHash","ResourceIcon","React","s","alt","sugarSrc","waterSrc","className","cache","nf","n","maximumSignificantDigits","minimumSignificantDigits","Intl","NumberFormat","undefined","useGrouping","get","format","DIRECTIONS","nw","w","sw","ne","e","se","oppositeDir","dir","DIRECTION_VALUES","o","RI","props","GN","CellInteractionSchema","createSimpleSchema","CellType","serializable","object","Chromosome","MaterialInfoSchema","geneSlots","chromosome","material","interaction","args","computeStaticProperties","isDirectional","direction","rotateAround","PI","setLength","genes","some","getStaticProperties","isReproductive","duplicateGenesPairs","toPairs","groupBy","rg","filter","Set","flatMap","geneSlotsNet","pow","abs","Genome","list","cellTypes","unusedGenes","cell","describeCellInteraction","resources","Ticker","tickerId","tickers","_time","tickerLoop","time","toDelete","f","push","Number","removeAnimation","requestAnimationFrame","fn","start","fpref","capacity","carrier","events","other","amountWater","amountSugar","Error","spaceNeeded","spaceAvailable","change","emit","EventEmitter","on","off","newWater","newSugar","warn","Soil","depth","rechargeWaterCooldown","giver","Air","is","target","continuous","stepEvaporation","stepGiveWater","secondsToEvaporate","environment","evaporationChance","waterToEvaporate","logEvent","tile","numEvaporatedSoil","saturation","numRechargedWater","diffusionRate","freeWater","fallAmount","lowerNeighbor","tileAt","canPullResources","waterToGive","_dt","temperature","Mild","weather","getCurrentTemperature","Sand","depthDiffusionFactor","Clay","properties","defaultCellProperties","g","entries","timeToBuild","newInstance","find","r","getCost","c","reduce","geneSlotsAdded","geneSlotsUsed","Cell","energy","darkness","closestCellAirDistance","droopY","effects","geneInstances","staticProperties","isDead","_isCell","inventoryCapacity","copy","computeDynamicProperties","newGeneInstances","stepTemperature","diffusionWater","diffusionSugar","temperatureTempo","moveSpeed","tempo","energyUpkeep","getDynamicProperties","effect","constructor","stacks","findEffectOfType","cantFreeze","FreezeEffect","attachTo","isInteractable","action","interact","DeadCell","isType","validateDirection","stepDroop","stepCancer","stepCellEffects","stepGeneInstances","stepEnergyUpkeep","die","forEach","getChanceToBecomeCancerous","addEffect","CancerEffect","tileNeighbors","array","neighbor","Freezing","chanceToFreeze","Scorching","waterToLose","chanceEvaporate","below","belowLeft","belowRight","left","right","above","aboveLeft","aboveRight","droopAmount","springNeighborCells","sum","stepDroopPositionUpdate","height","equals","posFloat","difference","isBreakingSurfaceTension","diffusionAmount","isFractional","manhattanLength","TEMPO_FROM_TEMPERATURE","Cold","Hot","DynamicNumber","sigFigs","useState","setV","useEffect","tickOnce","addAnimation","Infinity","dtSinceLastStepped","timeMade","sqrt","neighbors","giveCandidates","guard","shuffle","i","waterGiven","sugarGiven","isMaxed","splice","stepDiffusion","stepGravity","minDarkness","darknessFromNeighbor","darknessContrib","minDistance","neighborDistance","cellAirDistanceContrib","diffuseWater","diffuseSugar","GeneFruit","make","levelProps","mpEarned","neededEnergy","static","description","reproducerDescription","isMature","energyRecieved","instance","reproducerStep","GeneSeed","amount","state","seed","energyLeftToTake","energyToTake","from","resourcesUsed","commitEnergy","isNowMature","reproducerGetPercentMatured","timeMatured","earnMP","energyToGive","MP","total","classNames","CellEffect","onAttached","index","indexOf","secondsToDie","percentFrozen","chunkCooldown","where","onFrozenChanged","StopStep","remove","age","secondsPerDuplication","timeToDuplicate","canBuildAt","newCell","temporaryValue","randomIndex","currentIndex","Grad","z","grad3","p","F2","G2","G3","Noise","perm","Array","gradP","octaveNum","octaveFalloff","octaveMatrix2","cos","sin","xin","yin","i1","j1","j","x0","y0","x1","y1","x2","y2","gi0","gi1","gi2","t0","t1","t2","dot2","scalar","simplex2","newX","newY","zin","k1","i2","j2","k2","z0","z1","z2","x3","y3","z3","gi3","t3","dot3","simplex3","X","Y","n00","n01","n10","n11","u","fade","Z","n000","n001","n010","n011","n100","n101","n110","n111","isSteppable","obj","sDt","GeneObstacle","sunlightCached","_co2","_isAir","computeCo2","base","floorCo2","scaleX","offset","noiseCo2","perlin3","width","sunlight","tileBelow","stepDiffusionCheap","tryDiffuse","airEvaporation","numEvaporatedAir","mapRecord","out","val","custom","regexMatch","match","makeGeneUnknown","identifier","setLevel","isArray","dynamic","newLevel","numLevels","GeneInstance","getProps","uuid","message","GenePipes","connections","directionName","cellAt","GeneTransport","secondsPerPush","didJustTransport","forwardTile","backwardTile","waterToTransport","sugarToTransport","takeFromOneNeighborCell","waterTaken","sugarTaken","takeFromEveryNeighborCell","GeneAttractsSugar","secondsPerPull","GeneCannotFreeze","GeneDiffuseWater","GenePhotosynthesis","reactionChancePerSecond","totalSugarProduced","averageConversionRate","averageChancePerSecond","sugarConverted","activeNeighbors","numAir","maybePhotosynthesize","air","co2","waterToConvert","ambientChancePerSecond","leaf","numSunlight","chancePerSecond","sugarMade","oxygenContribution","chromosomeGrowingCell","GeneLiving","GrowingCell","completedCell","cellTypeGrowingCell","percentGrown","timeToGrow","silent","maybeNewState","costSugar","costWater","color","Color","texturePosition","BarrenLand","GeneAiryExpansion","GROWTH_RATE","GeneAttractsWater","GeneBark","timeBeforeGrowth","tried","manhattanDistanceTo","deadCell","GeneCostly","_","GeneDiffuseSugar","GeneHydrostasis","PERCENT_FASTER","GeneInventory","maxEnergyToEat","hunger","getMaxEnergyToEat","energyPerSugar","sugarToEat","gotEnergy","who","stepEatSugar","ENERGY_PER_SUGAR","maybeGiveEnergy","differenceThreshold","GeneNetworkEffect","numCells","GeneNutrientExtraction","energyPerSecond","hasMonthPassed","soil","barrenSoil","GeneOsmosis","isOsmosising","GenePushWater","GeneScaffolding","GeneSoilAbsorption","secondsPerAbsorb","totalSucked","absorbWater","GeneVascular","vascularNeighbors","module","exports","webpackContext","req","webpackContextResolve","__webpack_require__","code","GeneAdhesion","nonCellNeighbors","GeneFastMetabolism","GeneFluidMembrane","GeneProliferation","GeneSlowMetabolism","cellTypeTissue","cellTypeLeaf","cellTypeRoot","cellTypeTransport","cellTypeFruit","standardGenome","Player","baseSpeed","currentTile","actions","cellType","duration","elapsed","startPos","isValidPosition","bfsIterator","isWalkable","event","cb","isNearPlant","nearestWalkableCell","findNearestWalkableCell","attemptAction","stepEdgePull","walkableNeighbors","sortBy","closest","EDGE_PULL_VELOCITY","dX","dY","result","_attemptAction","log","attemptMove","attemptBuild","attemptDeconstruct","attemptDrop","attemptPickup","attemptMultiple","attemptLong","attemptThaw","attemptRemoveCancer","nextPos","existingTile","position","existingCell","needWater","needSugar","canBuild","matureCell","waterToDrop","sugarToDrop","inv","multiple","allSuccess","thaw","removeCancer","sleep","millis","setTimeout","PlayerSeed","poppedOut","velY","removePlayerSeed","genome","then","once","distanceTo","seasonFromTime","year","timeInYear","season","percent","month","day","SEASON_NAMES","seasonDisplay","StepStats","frame","deleted","added","evaporation","photosynthesis","oof","Insect","minVector","maxVector","findNextAction","minBy","setAction","sub","normalize","force","maxBy","isAtEdge","removeInsect","arrayRange","fill","gridRange","layers","gens","gensReversed","reverse","generator","predicate","not","original","gen","modify","addWater","generatorInfo","heightScalar","waterValue","withoutWater","addDeepWater","inSoil","soilLevel","inSoilFlat","soilLevelFlat","inRockLevel","midLevel","bottomLevel","wavelength","generatorContext","rockLevel","noiseRock","pastSoilDepth","betweenSoilDepth","nearDeepWaterMaxima","nearWaterMaxima","atMaxima","dirName","atWaterMaxima","rock","clay","sand","fountain","emitWaterScalar","smallFountain","mixedSoilRockSmall","noiseSoil","octaveSimplex2","mixedSoilRockMed","transformFn","newPosFn","newPos","transform","matrix","applyMatrix3","translate","Matrix3","translateY","rotate","theta","number","num","mixFn","moundShape","wide","tall","dy","Level0","large0","Temperate","Desert","onlyIn","Rocky","skewPos","rockThreshold","inBigRock","roundedCheckerboard","threshold","and","generators","Reservoires","erode","alsoWith","transformer","SkySoil","noiseHeight","perlin2","Mound","InverseMound","nearLarge0Maxima","mid0","inPillar","stratified","layerHeight","layerIndex","Pillars","withTwoWater","RockMaze","countRock","alsoWithNNeighborRock","inOverhang","CliffSide","TileGenerators","MountainSide","edgeThickness","centersByDistance","poissonMed","nearest","secondNearest","distNearest","voroniEdgeMed","Random","noiseMix","mixValue","poissonDisc","radius","initialSample","rng","radius2","R","cellSize","SQRT1_2","gridWidth","ceil","gridHeight","grid","queue","queueSize","sampleSize","far","i0","j0","dx","sample","sampler","samples","modulateSeed","letter","charCodeAt","createGeneratorContext","noiseWater","noiseLarge0","noiseMid0","poissonSmall","makePoissonPoints","distance","seedrandom","toString","SUNLIGHT_TEMPERATURE_SCALAR","Weather","temperaturePerSeason","getBaseTemperature","sunAngle","computeSunlight","stepWeather","climate","timeBetweenRainfall","rainDuration","numWater","waterPerSecond","dropletSize","numRainWater","directionalBias","sunAmount","environmentTileAt","tileUp","tileRight","tileLeft","upSunlight","rightSunlight","leftSunlight","daylightPerSeason","timeOfDay","percentDaylight","temperatureScalar","atan","optionsDefault","World","species","optionsPartial","insects","playerSeed","gridEnvironment","gridCells","neighborCache","mpEarners","generatorInfoCache","cachedEntities","stepStats","lastStepStats","options","tileGenerator","computeTileNeighbors","fillCachedEntities","computeSoilDepths","firstNonAir","computeDarkness","updateClosestCellDistance","tileEnvironment","tileCell","computeGeneratorInfo","xOrVec2","oldTile","redistributeInventoryToNeighbors","oldCell","oldEnvironmentTile","handleTileUpdated","insect","px","py","mapping","NeighborMap","DIRECTION_VALUES_RAND","newEntities","tileUnderneath","entities","entity","stepInsects","insectsPerDay","InsectToaster","clear","show","airPositions","allEnvironmentTiles","minNeighborDepth","stepDarkness","allTiles","startCell","stepClosestCellDistance","totalSugar","totalWater","totalEnergy","Symbol","iterator","self","row","return","limit","heuristic","frontier","processed","size","shift","sort","slice","Toaster","create","canEscapeKeyClear","maxToasts","_array","values","cellTypeSeed","tutorialGenome","SpeciesSchema","primitive","freeMutationPoints","totalMutationPoints","geneOptions","newBaseSpecies","descendants","lineage","parent","reference","Experiment","visitors","trials","tiles","trial","results","visitor","visit","ExperimentSuite","experiments","recordDataFor","allSoilEnvironment","testWorld","runTwoWideCompare","world1","world2","cell1","cell2","c1w","allCells","experiment","timeEnd","TestDiffusion","script","addEventListener","divId","data","trialIndex","visitorNames","trace","div","getElementById","Plotly","newPlot","barmode","plotStackedBar","e1","runOneWideAbsolute","table","e2","body","environmentFromLevelInfo","info","MountainTop","Character","otherProps","characterSrc","Glow","FruitResult","fruit","scale","style","fruitSrc","toFixed","ReproductiveCellResult","findGene","MPEarnerList","VignetteList","vignettes","setIndex","stepSize","onChange","showTrackFill","labelRenderer","toDataURL","GameWonScreen","winDescription","mutationPointsPerEpoch","GameLostScreen","stop","GameResultsScreen","onDone","attempt","primaryButtonText","sourceHex","status","onClick","mockFruit","neededResources","TestWinScreen","f1","f2","f3","mockResults","TestLoseScreen","charMap","0","1","2","3","gridToReact","grid-x","grid-y","String","initialSrcGrid","trim","split","char","NUM_IDS","IDS_LIST","entropy","weights","isNaN","isZero","every","collapseGridPoint","uncollapsedGrid","point","relationModel","scaleFromNeighbors","normalizeWeights","RangeError","weightIndex","chosenIdx","selected","lastGoodIdx","weightedSample","collapse","multiplyWeights","normalizeOrUniformWeights","newRelationWeights","WFCTest","srcGrid","setSrcGrid","setId","output","useMemo","outWidth","outHeight","gridFlat","flat","maybeCountNeighbor","countWeight","relations","newRelationModel","globalAppearanceWeights","tryCollapseGrid","updateNeighborWeights","relationWeights","neighborWeights","newWeights","delete","xStr","yStr","pickNextPoint","wfc","outputReact","upId","useCallback","handleSrcClick","currentTarget","attributes","getNamedItem","produce","outputSrcReact","padding","fontSize","margin","generateGeneOptions","isFirstChoice","allGenes","allProviderGenes","allConsumerGenes","AppReducerContext","createContext","useAppReducer","useContext","reducer","rootSpecies","handleUpdateSpecies","populationAttempt","targetHex","visible","flora","activePopulationAttempt","handleStartPopulationAttempt","handlePopulationAttemptSuccess","draft","overWorld","getMaxGenePool","epoch","handleNextEpoch","activeGameResult","handleGetGameResult","handleGameResultDone","transition","handleTransitionStart","settlingSpecies","hexAt","gtag","label","oldSpecies","hexNeighbors","capitalize","toLocaleUpperCase","CHARS_LOWER","CHARS_UPPER","toUpperCase","character","letters","pool","casing","alpha","numeric","symbols","charAt","syllable","chr","text","consonants","LANDSCAPES","randomName","syllables","substring","word","replace","EnvironmentSchema","LevelInfoSchema","rainfall","soilType","wind","actionPoints","C","HexTile","_displayName","MAX_SAFE_INTEGER","HexStore","hash","hex","OverWorld","storage","startTile","oxygenLevel","populatedActiveNeighbors","getHexesPopulatedBy","hexes","noise","cartesian","noise3D","magnitude","heightFn","maxDist","SimplexNoise","populateLevelInfo","genHeightContinent","getDefaultStartTile","genHeightPlanet","getContinentConnectedHexes","store","includes","AppStateSchema","save","appState","json","serialize","stringToSave","localforage","setItem","getItem","string","deserialize","ACTIONS_TO_SAVE_ON","AAGameResultDone","AAGetGameResult","AAUpdateSpecies","AANextEpoch","AAPopulationAttemptSuccess","AAStartPopulationAttempt","Button","children","SpeciesNode","onMutate","handleClick","PhylogeneticTree","EpochUI","onNextEpoch","onFocusHex","transitioning","setTransitioning","speciesProductionEls","allSpecies","pointsPerEpoch","epochButtonTooltipContent","content","disabled","OPPOSITE_KEYS","KeyS","KeyW","KeyA","KeyD","Keyboard","keyMap","handleBlur","handleKeyDown","isTargetAnInput","HTMLInputElement","isOpeningDevtoolsOnChrome","shiftKey","ctrlKey","altKey","metaKey","preventDefault","handleKeyUp","Y_SQUISH_FACTOR","getClickedHexCoords","canvas","camera","cX","cY","nativeEvent","offsetX","offsetY","rx","ry","rz","x_diff","y_diff","z_diff","roundCubeCoordinates","pixelPosition","innerWidth","innerHeight","getCameraPositionCenteredOn","vectors","isPointInHexagon","HALF_HEIGHT","q2x","q2y","tooltipMap","TemperatureGauge","showMild","tooltipContent","toLowerCase","EnvironmentInfo","rainAmount","intensity","rainfallDescription","colSpan","locustsSrc","HexInfo","onClickPlay","playButtonElement","floraInfo","habitableInfo","isHabitable","testVignette","Image","testVignetteUrl","COLOR_SCALE_HEIGHT","scaleLinear","domain","range","HexTileSprite","context","vignettePositions","isHovered","lineWidth","isShadowed","globalAlpha","fillStyle","strokeStyle","drawHex","drawNumericHeight","drawVignettes","beginPath","moveTo","arc","stroke","drawCircle","drawPulse","tOffset","thickness","easePulse","now","font","textAlign","textBaseline","fillText","positions","dropFirst","normSamples","generateNaturalRandomHexagonPoints","sizeScale","drawImage","highlightedHex","angle","lineTo","closePath","easeExpIn","OverWorldPopover","container","top","OverWorldMap","hexTileSprites","rafId","handleCanvasRef","ref","handleResize","handleCanvasClick","setState","coords","cameraState","clicked","possibleMigrationSources","handleCanvasMouseLeave","hoveredHex","handleCanvasMouseMove","handleClickPlay","dispatch","appAction","getAppAction","handleWheel","delta","deltaX","deltaY","updateCanvas","updateCamera","nextScale","targetDX","targetDY","getStartHex","sprite","getContext","drawMap","drawMigrationArrows","drawPopulationAttempt","clearRect","setIsHovered","sprites","zIndex","draw","drawPossibleMigrationIntoArrows","drawPossibleMigrationOutOfArrows","drawMigrationArrow","removeEventListener","prevProps","focusedHex","focusHex","tStart","targetX","targetY","tabIndex","onMouseLeave","onMouseMove","onWheel","maybeRenderPopover","possibleMigrationTargets","shadowBlur","shadowOffsetX","shadowOffsetY","shadowColor","lineCap","lineJoin","targetCenter","sourceCenter","arrowStart","arrowEnd","fromx","fromy","tox","toy","headlen","atan2","drawArrow","canPlay","PureComponent","contextType","AddCellCard","handleAddCell","newCellType","lazy","spritesheetLoaded","SPRITESHEET","spritesheetUrl","texture","magFilter","minFilter","flipY","wrapS","wrapT","dispatchEvent","textureFromSpritesheet","backgroundColor","drawSpriteToCanvas","image","fillRect","needsUpdate","ActionBarItem","IconCell","showCosts","getStyle","url","HTMLCanvasElement","backgroundImage","costsEl","reproducer","isReproducer","CellInteractionSelector","memo","setInteraction","handleSelect","indexOrUndefined","newInteraction","possibleInteractions","ensureValidatedInteraction","handleChangeContinuous","checked","selectValue","findIndex","interactionEl","defaultValue","continuousEl","resourceTypes","droppableIdToCell","droppableId","MoreOptionsPopover","isOpen","setIsOpen","handleMoreClicked","open","handleOuterAction","popoverContent","transitionDuration","popoverClassName","GeneCost","cost","negative","EnergyUpkeep","els","upkeep","RealizedGeneViewer","draggable","view","invalid","gd","energyUpkeepEl","geneLevelEl","repeat","draggableId","isDragDisabled","provided","snapshot","rubric","innerRef","draggableProps","dragHandleProps","provider","ViewerContext","editable","isDragging","CellTypeViewer","handleSetInteraction","handleNameChange","onInput","GeneSlots","chanceForCancer","cancerEl","isGeneSlotsOver","hoverOpenDelay","ChromosomeViewer","viewerState","empty","duplicateGenes","getDuplicateGenes","validationEl","droppableProps","dragging","placeholder","CellActionsPopover","deleteCellType","chromosomeEmpty","isEmpty","GenomeViewer","speciesViewerDragEnd","destination","sourceIndex","destinationIndex","shouldRepopulateGeneOptions","sourceCell","destinationCell","SpeciesViewer","speciesId","setIsDragging","setView","handleDragEnd","handleBeforeCapture","before","handleViewSmall","handleViewExpanded","onDragEnd","onBeforeCapture","Provider","active","MutationChooser","isDropDisabled","DeleteGeneDroppable","hovered","isDraggingOver","UnusedGeneArea","OverWorldScreen","leftPanelOpen","setLeftPanelOpen","viewedSpecies","setViewedSpecies","handleStartMutate","onMountEpoch","useRef","current","speciesReadyToMutate","handleSpeciesViewerClose","speciesViewerEl","onClose","setFocusedHex","handleFocusHex","computeOxygenLevel","unusedPoints","unusedPointsEl","maybeRenderPhylogeneticTreePanel","animate","intent","Intent","SUCCESS","stripes","confirm","removeItem","reload","handleTransitionEndMiddleware","stateWithoutTransition","handleTransitionEnd","AppStateProvider","reducerWithMiddleware","newState","hasOwnProperty","useReducer","dispatchRaw","newDispatch","autoTransitionEndDispatchMiddleware","reducerTuple","LocalForageStateProvider","loadingComponent","catch","newGameState","generateLargeContinent","startHex","newInitialAppState","Mouse","el","isPressed","button","handleMouseDown","handleMouseMove","clientX","clientY","handleMouseUp","UI_EVENTS","click","contextmenu","dblclick","mousedown","mouseup","mousemove","touchstart","touchmove","touchend","keyup","keydown","keypress","wheel","ISketch","renderer","audioContext","elements","timeElapsed","frameCount","domElement","Renderer","scene","glsl","CommittablePoints","geometry","newGeometry","ResourcePointsMaterial","frustumCulled","BufferGeometry","Float32Array","rotations","sizes","alphas","setAttribute","BufferAttribute","setUsage","DynamicDrawUsage","setXYZ","setX","rotation","setDrawRange","Points","uniforms","opacity","sizeGlobal","vertexShader","fragmentShader","depthTest","transparent","ShaderMaterial","FireAndForgetPoints","lifeFn","toRemove","startFrame","commit","endFrame","EventRenderer","eventName","worldRenderer","getLastStepStats","EventRendererFFPoints","ffPoints","update","handle","commitAll","EventCellEatRenderer","makePoints","Audio","audioListener","setVolume","buffer","setBuffer","setDetune","setValueAtTime","cancelScheduledValues","setTargetAtTime","tileRenderer","renderers","activeSugar","inventoryRenderer","getActiveSugar","fire","EventCellTransferEnergyRenderer","reversed","polyUpDown","polyEarlyUpDown","EventCollectSunlightRenderer","renderOrder","itr","randWaterPosition","waters","configure","callback","graphics","WATER_POINTS_PARAMS","SUGAR_POINTS_PARAMS","InventoryPoints","sugars","InventoryRenderer","particlePoints","animationOffset","handleGetResources","updateSugarAndWaterParticles","handleGiveResources","handleAddResources","simulationT","updateParticlesArray","verifyArrayLengths","particles","resource","wantedParticles","getCarrierPos","resourceArray","numFullSizedParticles","fract","numWaters","numResources","basePushAngle","basePushForceX","vx","vy","goTowardsCenterStrength","playerX","playerY","mag2","avoidPlayerStrength","otherResource","lengthSq","fraction","strength","isProbablyVisible","simulateResourcePositions","commitParticles","screenPos","worldToScreen","EventEvaporationRenderer","stableWater","getStableWater","EventGrowFruitRenderer","a0","easeCubicIn","smoothstep","EventPhotosynthesisRenderer","CellEffectsRenderer","createEffectRenderer","destroy","FreezeEffectRenderer","CancerEffectRenderer","FREEZE_BLUE","mesh","newMesh","PlaneBufferGeometry","MeshBasicMaterial","side","DoubleSide","Mesh","lastTimeToDuplicate","RingBufferGeometry","EventThawIceRenderer","easeSinOut","EventLogRenderer","singleEventRenderers","AnimationController","animation","timeStarted","timeLastUpdated","ended","chain","animations","numEnded","lastStarted","currAnimation","also","firstAnim","secondAnim","secondEnded","firstEnded","animPause","InsectRenderer","inventoryPoints","InventoryBar","colored","showBar","capacityBasedWidth","sugarPercent","emptyPercent","waterStyles","sugarStyles","emptyStyles","textElements","barStyles","baseMesh","CircleBufferGeometry","Node","vel","NeuronMesh","numNodes","nodes","meshes","line","pullForceScalar","towardsTargetForce","dragForceScalar","goTowardsTargetForce","node","multiplyScalar","dragForce","drag","pullForce","lineGeo","Geometry","vertices","Line","LineBasicMaterial","mat","getHex","meshMaterial","last","prev","next","verticesNeedUpdate","Object3D","PlayerRenderer","neuronMesh","resourceText","handleResourceChange","positionFn","renderFn","element","addWorldDOMElement","timeoutId","removeWorldDOMElement","clearTimeout","handleStartLongAction","buildReproducerAnimation","handleAction","handleInteracted","playing","handlePlayerActionFail","invalidAction","showInvalidAction","prevHighlightedTile","droopPosFloat","addFloatingText","isUsingShift","isInteract","controls","wouldLeftClickInteract","highlight","highlightedTile","neuronMeshTarget","ZERO","setColor","toolBar","interactTool","isTakeAll","actionLong","animWaitForCameraZoomIn","animSendCopy","animWaitEnd","tNorm","shakeFrequency","shakeAmplitude","suggestCamera","center","zoom","easeSinInOut","PlayerSeedRenderer","scenePlayerSeed","fallInAnimation","wiggleAnimationForever","popOutAnimation","setScalar","easeQuadOut","easeBounceOut","tBounded","zRot","SnowRenderer","snowMesh","snowMap","enabledOpacity","snowMaterial","TextureLoader","snowUrl","NearestFilter","RepeatWrapping","targetOpacity","PlaneGeometry","NO_OP","GeneRenderer","init","lineGeometry","Float32BufferAttribute","makeLine","origin","quaternion","axis","Vector3","radians","acos","setFromAxisAngle","updateMatrix","matrixAutoUpdate","GenePhotosynthesisRenderer","renderResources","lastAudioValueTracker","neighborLines","newAudioValueTracker","baseVolume","growPulseAnimation","lines","disconnect","TileBatcher","prop","referenceGeometry","InstancedBufferGeometry","newTileBatcherGeometry","maxTiles","centers","attr","colors","scales","texturePositions","instances","RawShaderMaterial","spriteSheet","updateMatrixWorld","InstancedBufferAttribute","dim","isInteger","BatchInstance","checkout","BLACK","batcher","owner","numInUse","setXY","commitColor","commitScale","PIPE_DIR_GEOMETRY","BoxBufferGeometry","PIPE_CENTER_GEOMETRY","materialMap","getPipeMaterial","lastEventStateType","GenePipesRenderer","zeroMesh","argsEditor","addMesh","removeMesh","updateArgsEditor","shouldShowArgsEditor","getTileAtScreen","setPipe","neighborPipes","setAllPipes","isAnyOn","buttons","PipesEditor","setDirN","setDirS","setDirE","setDirW","mouseMoveDirN","mouseMoveDirS","mouseMoveDirE","mouseMoveDirW","shouldClickTurnOff","toggleAllDirections","mouseMoveAllDirections","onMouseDown","GeneReproducerRenderer","percentMatureElement","matured","updateScale","GeneSoilAbsorptionRenderer","GeneTransportRenderer","arrow","lastDir","updateArrow","updateArrowPosition","arrowMoveAnimation","arrowDir","ArrowHelper","arrowSetAnimation","len","easeExpOut","vibrationAmount","easeCubicOut","TransportEditor","wantedDirection","latestMovements","setLatestMovements","addEvent","movementX","movementY","movement","totalMovement","nearestAngle90","useWantedDirection","InstancedTileRenderer","batchMesh","originalColor","cellEffectsRenderer","geneRenderer","temperatureColor","TEMPERATURE_COLORS","currentLerp","getBatchInstance","materialInfo","WHITE","createGeneRendererFor","Proxy","v0","method","apply","getLightAmount","commitBlack","getMaterialInfo","materialInfoMapping","lightAmount","inst","t1Pos","commitCenter","commitTexturePosition","updateColor","updateInventory","maybeUpdateCellEffectsRenderer","ONE","co2Color","getCo2Color","modifyColorFromTemperature","amountBlack","input","tColor","targetLerp","hover","ease","easeCubic","freeze","materials","siltColor","CO2_COLORSCALE","WorldRenderer","tileBatcher","eventLogRenderer","snow","deleteDeadEntityRenderers","createSelector","stats","deletedEntities","created","createRendererFor","getOrCreateRenderer","VignetteCapturer","pxPerTile","captureInterval","lastCaptureTime","renderTarget","rtBuffer","rtCanvas","picturesqueCells","getBounds","minBounds","maxBounds","Scene","picturesqueRenderers","cameraEncompassingBounds","setRenderTarget","render","readRenderTargetPixels","imageData","createImageData","imageBuffer","putImageData","boundsWidth","boundsHeight","maxDimension","roiWidth","roiHeight","roiTopLeft","dest","subScalar","addScalar","largerDim","OrthographicCamera","WebGLRenderTarget","Uint8Array","getDecidedGameResult","matureEarners","shouldWin","oxygenPerSecond","ACTION_CONTINUOUS_KEYMAP","ACTION_INSTANT_KEYMAP","MOVEMENT_KEYS","PlayerControlScheme","isPaused","pausedInspectedTile","inspectedCell","leftClick","rightClick","keyDown","moveAction","keysToMovement","mouse","leftClickHold","PlayerSeedControlScheme","popOut","handleLeftClick","highlightedPosition","clickedPos","ToolBar","tools","KeyQ","TOOL_INTERACT","currentKey","validCellTypes","digitKey","DIGIT_KEYS","makeToolToBuildCellType","currentTool","onActivate","onReActivate","setKey","shouldCapture","showInteractToolSwitcher","WorldDOMElement","posOrTile","worldTopLeft","worldBottomRight","pixelTopLeft","pixelBottomRight","WorldDOMComponent","Animate","rafid","Component","SceneObject","BUILD_BLUEPRINT","BuildBlueprint","POINT_HIGHLIGHT","PointHighlight","TILE_HIGHLIGHT","edgesGeometry","lineSegments","TileHighlight","findBuildCandidateTiles","candidates","Hover","isTakingLongAction","maybeRenderBuildBlueprint","maybeRenderTileHighlight","maybeRenderTutorialBuildHighlights","leftClickType","isBuildValid","valid","isFirstPlaythrough","buildCandidateHighlights","candidate","HotkeyButton","hotkey","restProps","getElementsByTagName","focus","ensureCanvasFocus","formatSeconds","seconds","fractionDigits","TileDetails","tileInfo","cellInfo","growingCellInfo","airInfo","soilInfo","fountainInfo","interactInfo","leftClickEl","secondsPerUpkeep","secondsRemaining","secondsRemainingEl","energyEl","cellEffects","geneInfos","soilAbsorptionInfo","photosynthesisInfo","reproducerInfo","osmosisInfo","descriptors","join","CellInspector","onMouseUpCapture","stopPropagation","GameMenu","handleOverlayClose","handleGameMenuToggleClick","toggleMenu","handleAbandonPlant","onWinLoss","menuPanel","canEscapeKeyClose","canOutsideClickClose","backdropClassName","defaultSelectedTabId","title","panel","Attribution","href","rel","ToolBarUI","bar","tool","ToolBarItem","itemIcon","InteractToolItem","ToolBuildIcon","argsChildren","TransportDirArrow","InteractToolSwitcher","InvalidActionMessage","PausedTileDetailsPopover","usePortal","autoFocus","minimal","SeasonsTracker","Tutorial","isViewerOpen","activeIndex","setActiveIndex","handleDone","tutorialSteps","Step","isFirst","useCountActionTarget","count","setCount","useCountActions","setPercentDone","setSugarMade","TutorialStepContainer","percentDoneRaw","percentDone","isDone","first","done","HUD","handleCellInspectorDone","timeTooltipContent","handlePauseClick","isMaxedEl","showPlayerHUD","renderTime","maybeRenderSpeciesViewer","maybeRenderWinButton","maybeRenderWinShine","maybeRenderGerminateButton","maybeRenderPausedUI","maybeRenderInvalidAction","maybeRenderTutorial","maybeRenderInteractToolSwitcher","hidden","maybeRenderCellInspector","Date","toISOString","formatTime","popOutFn","mouseInstructions","popover","PlantStats","lastTime","lastTotalEnergy","numSugar","totalWaterAbsorbed","soilAbsorb","energyUsePerSecond","sugarUsePerSeason","timeUntilStarvation","averageWaterPerSeason","averageSugarPerSeason","Debug","doWin","doLose","plusWater","plusSugar","bottom","background","display","OvalNode","uv","UVNode","builder","include","ovalOutFn","getType","TempNode","FunctionNode","Mito","oldAdd","addedStack","stack","addedOn","performance","_inspectedCell","vignetteCapturer","hackCamera","orbitControls","suggestedCamera","userZoom","_controls","nodeFrame","Nodes","nodePost","ovalOutTime","Stats","statsStep","showPanel","statsRenderer","newZoom","handleBeforeUnload","handleContextMenu","PLAYER_TETHER_DISTANCE","worldDomElements","autoClear","minNode","MIN","lookAt","OrbitControls","updateAmbientAudio","attachWindowEvents","onbeforeunload","worldDomElementComponents","yPos","drumVolume","stringsVolume","begin","end","gameResult","anyCellsAlive","maybeGetGameResult","cursorWorld","getWorldCoordinates","clampLength","cursorCameraNorm","getCameraNormCoordinates","unproject","getPlayerInfluenceVector","computeHighlightedPosition","screen","project","worldDomElement","millisDelta","getAction","worldStep","defaultCameraState","computeHighlightedTile","updateHover","isTimeForNewCapture","capture","easeSinIn","clearDepth","yes","no","traverse","perfDebugThreeObjects","memory","geometries","textures","programs","calls","points","triangles","mouseNorm","cameraTarget","targetState","updateProjectionMatrix","h","aspect","setSize","WindowFPS","dom","removeChild","marginTop","SketchSuccessComponent","frameId","lastTimestamp","handleVolumeButtonClick","volumeEnabled","localStorage","timestamp","millisElapsed","sketch","syncAudioContext","handleWindowResize","updateRendererCanvasToMatchParent","resize","handleVisibilityChange","visibilityState","hasFocus","shouldPlayAudio","resume","suspend","eventsOnBody","sketchElementsWithKey","idx","renderVolumeButton","dispose","parentElement","clientWidth","clientHeight","SketchComponent","userVolume","handleContainerRef","Howler","setContext","masterGain","preserveDrawingBuffer","antialias","checkShaderErrors","containerProps","errorElement","classnames","renderSketchOrStatus","renderDefaultErrorElement","MitoScreen","handleDivRef","exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","StartScreen","onStart","listenForEnter","AppComponent","handleWinLoss","handleResultsDone","handleCloseStartScreen","showStartScreen","appContent","AppError","AppScreen","appStateJson","errorRef","errorReport","select","execCommand","readOnly","CSSTransition","in","timeout","mountOnEnter","unmountOnExit","App","newHexWithSeed","TestLevel","setAttempt","nextSeed","TestOverworld","runTests","suite","countAir","countSoil","countFountain","startAdjacentWaters","adjacentTiles","countWaters","names","plotHistogram","layout","TestStats","Page404","createModelSchema","Boolean","hostname","ReactDOM","path","exact","component","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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AAIA,EAAK,GAAI,EAAG,GAChB,IAAIA,GAAM,GAAI,EAAG,GACjB,IAAIA,EAAK,EAAG,EAAG,GACf,IAAIA,GAAM,EAAG,EAAG,GAChB,IAAIA,EAAK,EAAG,GAAI,GAChB,IAAIA,GAAM,EAAG,GAAI,GACjB,IAAIA,EAAK,EAAG,EAAG,GACf,IAAIA,EAAK,GAAI,EAAG,GAChB,IAAIA,EAAK,EAAG,GAAI,GAChB,IAAIA,EAAK,GAAI,GAAI,IAGbG,EAAI,CACR,IACA,IACA,IACA,GACA,GACA,GACA,IACA,GACA,IACA,GACA,GACA,GACA,IACA,IACA,EACA,IACA,IACA,GACA,IACA,GACA,GACA,IACA,EACA,GACA,GACA,IACA,GACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,GACA,EACA,GACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,EACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GAC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","file":"static/js/main.095546c6.chunk.js","sourcesContent":["import * as THREE from \"three\";\r\n\r\n/**\r\n * Return a Vector2 that's uniformly randomly chosen from the perimeter\r\n * of the rectangle given by min and max.\r\n */\r\nexport function randomRectPerimeter(min: THREE.Vector2, max: THREE.Vector2): THREE.Vector2 {\r\n  const width = max.x - min.x;\r\n  const height = max.y - min.y;\r\n  let x: number;\r\n  let y: number;\r\n  if (Math.random() * (width + height) < width) {\r\n    // we've chosen the top or bottom line\r\n    x = randFloat(min.x, max.x);\r\n    y = Math.random() < 0.5 ? min.y : max.y;\r\n  } else {\r\n    // we've chosen the left or right line\r\n    x = Math.random() < 0.5 ? min.x : max.x;\r\n    y = randFloat(min.y, max.y);\r\n  }\r\n  return new THREE.Vector2(x, y);\r\n}\r\n\r\nexport function randFloat(min: number, max: number) {\r\n  return Math.random() * (max - min) + min;\r\n}\r\n\r\nexport function randInt(inclusiveMin: number, inclusiveMax: number) {\r\n  return Math.floor(randFloat(inclusiveMin, inclusiveMax + 1));\r\n}\r\n\r\nexport function randElement<T>(arr: T[]) {\r\n  return arr[randInt(0, arr.length - 1)];\r\n}\r\n","import { Vector2 } from \"three\";\r\n\r\nexport * from \"./random\";\r\n\r\nexport function lerp(a: number, b: number, x: number) {\r\n  return a + (b - a) * x;\r\n}\r\n\r\n/**\r\n * Go from a to b at a max speed of *speed*.\r\n */\r\nexport function lerpLinear(a: number, b: number, speed: number) {\r\n  // we have to clamp to account for FP math errors\r\n  return clamp(a + Math.sign(b - a) * speed, Math.min(a, b), Math.max(a, b));\r\n}\r\n\r\nexport function lerp2(v: { x: number; y: number }, t: { x: number; y: number }, l: number) {\r\n  v.x = v.x * (1 - l) + t.x * l;\r\n  v.y = v.y * (1 - l) + t.y * l;\r\n}\r\n\r\nexport function map(x: number, xStart: number, xStop: number, yStart: number, yStop: number) {\r\n  return lerp(yStart, yStop, (x - xStart) / (xStop - xStart));\r\n}\r\n\r\nexport function clamp(x: number, min: number, max: number) {\r\n  return x < min ? min : x > max ? max : x;\r\n}\r\n\r\nexport function sampleArray<T>(a: T[]) {\r\n  return a[Math.floor(Math.random() * a.length)];\r\n}\r\n\r\nexport function triangleWaveApprox(t: number) {\r\n  return (8 / (Math.PI * Math.PI)) * (Math.sin(t) - (1 / 9) * Math.sin(3 * t) + (1 / 25) * Math.sin(5 * t));\r\n}\r\n\r\n/**\r\n * Get a random integer between floor(x) and ceil(x) such that, over many iterations,\r\n * randRound(x) gives an average of x.\r\n */\r\nexport function randRound(x: number) {\r\n  const ix = Math.floor(x);\r\n  const fx = x - ix;\r\n  return ix + (Math.random() < fx ? 1 : 0);\r\n}\r\n\r\n// mod account for negatives\r\nexport function mod(t: number, m: number) {\r\n  return ((t % m) + m) % m;\r\n}\r\n\r\n// perfect triangle wave that goes from [0, 1, 0] in x = [0, 1, 2]\r\nexport function mirroredRepeat(x: number) {\r\n  return (1 - (Math.abs(mod(x * 2, 4) - 2) - 1)) / 2;\r\n}\r\n\r\n// goes [0, 1] every integer\r\nexport function sawTooth(x: number) {\r\n  return mod(x, 1);\r\n}\r\n\r\nexport function logistic(x: number, k = 1) {\r\n  if (x < -6) {\r\n    return 0;\r\n  } else if (x > 6) {\r\n    return 1;\r\n  }\r\n  return 1 / (1 + Math.exp(-x * k));\r\n}\r\n\r\nexport function roundToNearest(x: number, to: number) {\r\n  return Math.round(x / to) * to;\r\n}\r\n\r\nexport function toVector2(v: { x: number; y: number }) {\r\n  return new Vector2(v.x, v.y);\r\n}\r\n","import { Vector2 } from \"three\";\r\nimport { World } from \"../world/world\";\r\nimport { Silt } from \"./soil\";\r\nexport class Fountain extends Silt {\r\n  displayName = \"Fountain\";\r\n\r\n  isObstacle = true;\r\n\r\n  public cooldown = 0;\r\n\r\n  constructor(pos: Vector2, world: World, public secondsPerWater: number, public waterRemaining: number) {\r\n    super(pos, world);\r\n  }\r\n\r\n  shouldStep(dt: number) {\r\n    return dt > 0.1;\r\n  }\r\n\r\n  step(dt: number) {\r\n    super.step(dt);\r\n    if (this.cooldown > 0) {\r\n      this.cooldown -= dt;\r\n    }\r\n    if (this.inventory.space() > 1 && this.cooldown <= 0 && this.waterRemaining > 0) {\r\n      // just constantly give yourself water\r\n      this.inventory.add(1, 0);\r\n      this.waterRemaining -= 1;\r\n      if (this.waterRemaining > 0) {\r\n        this.cooldown = this.secondsPerWater;\r\n      } else {\r\n        const silt = new Silt(this.pos.clone(), this.world);\r\n        this.inventory.give(silt.inventory, this.inventory.water, this.inventory.sugar);\r\n\r\n        // replace self with a silt\r\n        this.world.maybeRemoveCellAt(this.pos);\r\n        this.world.setTileAt(this.pos, silt);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Inventory } from \"../inventory\";\r\nimport { Tile } from \"./tile\";\r\nexport class Rock extends Tile {\r\n  displayName = \"Rock\";\r\n\r\n  isObstacle = true;\r\n\r\n  isStructuralSupport = true;\r\n\r\n  inventory = new Inventory(0, this);\r\n\r\n  get darknessContrib() {\r\n    return 1;\r\n  }\r\n\r\n  get cellAirDistanceContrib() {\r\n    return 1000;\r\n  }\r\n\r\n  shouldStep(dt: number) {\r\n    return dt > 0.3;\r\n  }\r\n}\r\n","import { Cell } from \"../cell/cell\";\r\nimport { GrowingCell } from \"../cell/growingCell\";\r\nimport { Air } from \"./air\";\r\nimport { DeadCell } from \"./deadCell\";\r\nimport { Fountain } from \"./fountain\";\r\nimport { Rock } from \"./rock\";\r\nimport { Soil } from \"./soil\";\r\nimport { Tile } from \"./tile\";\r\n\r\nexport { CellEffect, FreezeEffect } from \"../cell/cellEffect\";\r\nexport { Air, DeadCell, Fountain, Rock, Soil, Tile, Cell, GrowingCell };\r\n","import blopSrc from \"assets/audio/Blop-Mark_DiAngelo-79054334.mp3\";\r\nimport buildSoundSrc from \"assets/audio/build.mp3\";\r\nimport buildCompleteSrc from \"assets/audio/build_complete.mp3\";\r\nimport deconstructSoundSrc from \"assets/audio/deconstruct.mp3\";\r\nimport dropWaterSrc from \"assets/audio/drop_water.mp3\";\r\nimport eatingSoundSrc from \"assets/audio/eating.mp3\";\r\nimport footstepsSrc from \"assets/audio/footsteps.wav\";\r\nimport fruitPoofSrc from \"assets/audio/fruit-popOpen.mp3\";\r\nimport impactSoftMedium003Src from \"assets/audio/impactSoft_medium_003.mp3\";\r\nimport interactSoundSrc from \"assets/audio/interact.mp3\";\r\nimport introBounceSrc from \"assets/audio/intro-bounce.mp3\";\r\nimport mitoBaseSrc from \"assets/audio/mito-base.mp3\";\r\nimport mitoDrumsSrc from \"assets/audio/mito-drums.mp3\";\r\nimport mitoOverworldMp3 from \"assets/audio/mito-overworld.mp3\";\r\nimport mitoStartScreenMp3 from \"assets/audio/mito-start.mp3\";\r\nimport mitoStringsSrc from \"assets/audio/mito-strings.mp3\";\r\nimport mitoDeathMp3 from \"assets/audio/mitodeath.mp3\";\r\nimport stickySoundSrc from \"assets/audio/sticky.mp3\";\r\nimport suckWaterSrc from \"assets/audio/suckwater.wav\";\r\nimport clickGenericSrc from \"assets/audio/switch23.wav\";\r\nimport genePickUpSrc from \"assets/audio/switch25.wav\";\r\nimport whooshSrc from \"assets/audio/whoosh.mp3\";\r\nimport { SketchAudioContext } from \"game/screens/sketch/sketch\";\r\nimport { Howl } from \"howler\";\r\nimport { randFloat } from \"math\";\r\nimport * as THREE from \"three\";\r\nimport devlog from \"../common/devlog\";\r\nimport { Player } from \"../core\";\r\nimport { Tile } from \"../core/tile\";\r\n\r\nexport let mito: AudioUnit;\r\nexport let strings: AudioUnit;\r\nexport let drums: AudioUnit;\r\n\r\nexport const clickGeneric = new Howl({\r\n  src: [clickGenericSrc],\r\n  volume: 0.2,\r\n});\r\n\r\nexport function playSmallRand(howl: Howl) {\r\n  const id = howl.play();\r\n  howl.rate(randFloat(0.9, 1.1), id);\r\n}\r\n\r\nexport const genePickUp = new Howl({\r\n  src: [genePickUpSrc],\r\n});\r\n\r\nexport const geneDrop = new Howl({\r\n  src: [require(\"assets/audio/switch26.wav\")],\r\n});\r\n\r\nexport const moveBumped = new Howl({\r\n  src: [require(\"assets/audio/rollover6.wav\")],\r\n});\r\n\r\nexport const mitoDeath = new Howl({\r\n  src: mitoDeathMp3,\r\n  autoplay: false,\r\n  loop: true,\r\n  volume: 1,\r\n});\r\n\r\nexport const mitoStartScreen = new Howl({\r\n  src: mitoStartScreenMp3,\r\n  autoplay: false,\r\n  loop: true,\r\n  volume: 0.3,\r\n});\r\n\r\nexport const mitoOverworld = new Howl({\r\n  src: mitoOverworldMp3,\r\n  autoplay: false,\r\n  loop: true,\r\n  volume: 0.15,\r\n});\r\n\r\nexport const footsteps = new Howl({\r\n  src: [footstepsSrc],\r\n  autoplay: true,\r\n  loop: true,\r\n  volume: 0,\r\n});\r\n\r\nexport const interactSound = new Howl({\r\n  src: [interactSoundSrc],\r\n  autoplay: true,\r\n  loop: true,\r\n  volume: 0,\r\n});\r\n\r\nexport const introBounce = new Howl({\r\n  src: introBounceSrc,\r\n  volume: 0.5,\r\n});\r\n\r\nexport const whoosh = new Howl({\r\n  src: whooshSrc,\r\n  volume: 0.2,\r\n});\r\n\r\nexport const fruitPoof = new Howl({\r\n  src: fruitPoofSrc,\r\n  volume: 0.3,\r\n});\r\n\r\nexport const build = new Howl({\r\n  src: [buildSoundSrc],\r\n  volume: 0.1,\r\n});\r\n\r\nexport const buildComplete = new Howl({\r\n  src: [buildCompleteSrc],\r\n  volume: 0.5,\r\n});\r\n\r\nexport const deconstruct = new Howl({\r\n  src: [deconstructSoundSrc],\r\n  volume: 0.5,\r\n});\r\n\r\nexport const sticky = new Howl({\r\n  src: [stickySoundSrc],\r\n});\r\n\r\nexport const dropSugar = new Howl({\r\n  src: [impactSoftMedium003Src],\r\n  volume: 0.5,\r\n});\r\n\r\nexport const dropWater = new Howl({\r\n  src: [dropWaterSrc],\r\n});\r\n\r\nconst loader = new THREE.AudioLoader();\r\nfunction loadAudioPromise(src: string) {\r\n  return new Promise<AudioBuffer>((resolve, reject) => {\r\n    loader.load(\r\n      src,\r\n      (audioBuffer) => {\r\n        resolve(audioBuffer);\r\n      },\r\n      (xhr: ProgressEvent) => {\r\n        // devlog((xhr.loaded / xhr.total * 100) + '% loaded');\r\n      },\r\n      (err: any) => {\r\n        devlog(\"An error happened\");\r\n        reject(err);\r\n      }\r\n    );\r\n  });\r\n}\r\nexport const blopBuffer = loadAudioPromise(blopSrc);\r\nexport const suckWaterBuffer = loadAudioPromise(suckWaterSrc);\r\nexport const eatBuffer = loadAudioPromise(eatingSoundSrc);\r\n\r\nexport function hookUpAudio(ctx: SketchAudioContext) {\r\n  let numDone = 0;\r\n  function oneMoreLoaded() {\r\n    numDone++;\r\n    if (numDone === 3) {\r\n      mito.audio.currentTime = 0;\r\n      strings.audio.currentTime = 0;\r\n      drums.audio.currentTime = 0;\r\n      mito.gain.connect(ctx.gain);\r\n      strings.gain.connect(ctx.gain);\r\n      drums.gain.connect(ctx.gain);\r\n    }\r\n  }\r\n  mito = makeUnitFromAudioAsset(ctx, mitoBaseSrc);\r\n  mito.audio.oncanplaythrough = oneMoreLoaded;\r\n  mito.gain.gain.value = 0.25;\r\n\r\n  strings = makeUnitFromAudioAsset(ctx, mitoStringsSrc);\r\n  strings.audio.oncanplaythrough = oneMoreLoaded;\r\n  strings.gain.gain.value = 0.0;\r\n\r\n  drums = makeUnitFromAudioAsset(ctx, mitoDrumsSrc);\r\n  drums.audio.oncanplaythrough = oneMoreLoaded;\r\n  drums.gain.gain.value = 0.0;\r\n}\r\n\r\nfunction sourceElement(src: string) {\r\n  const type = src.substr(src.length - 3);\r\n  const source = document.createElement(\"source\");\r\n  source.src = src;\r\n  source.type = `audio/${type}`;\r\n  return source;\r\n}\r\n\r\nfunction makeUnitFromAudioAsset(ctx: SketchAudioContext, ...srcs: string[]): AudioUnit {\r\n  const audio = document.createElement(\"audio\");\r\n  audio.autoplay = true;\r\n  audio.loop = true;\r\n  for (const src of srcs) {\r\n    audio.appendChild(sourceElement(src));\r\n  }\r\n  // audio.appendChild(sourceElement(assetName, \"mp3\"));\r\n  // audio.appendChild(sourceElement(assetName, \"wav\"));\r\n  const source = ctx.createMediaElementSource(audio);\r\n  const gain = ctx.createGain();\r\n  source.connect(gain);\r\n  return { audio, gain };\r\n}\r\n\r\ninterface AudioUnit {\r\n  gain: GainNode;\r\n  audio: HTMLAudioElement;\r\n}\r\n\r\nexport function distScalar(source: Tile, player: Player) {\r\n  const dist = source.pos.distanceToSquared(player.pos);\r\n  const scalar = Math.min(1, 1 / (1 + dist / 25));\r\n  return scalar;\r\n}\r\n","import { Cell } from \"./cell\";\r\nimport { CellProperties } from \"./cellProperties\";\r\nimport { GeneInstance } from \"./geneInstance\";\r\nimport { RealizedGene } from \"./realizedGene\";\r\n\r\nexport class Gene<S = any, K extends string = any> {\r\n  private constructor(\r\n    public readonly blueprint: GeneBlueprint<K>,\r\n    public readonly initialStateFn: GeneInitialStateFn<S, K>,\r\n    public readonly stepFn: GeneStepFn<S, K>,\r\n    public readonly shouldStepFn: GeneShouldStepFn<S, K>\r\n  ) {}\r\n\r\n  get numLevels() {\r\n    return this.blueprint.levelCosts.length;\r\n  }\r\n\r\n  level(level: number): RealizedGene<Gene<S, K>> {\r\n    return new RealizedGene(this, level);\r\n  }\r\n\r\n  static make<S = any, K extends string = string>(\r\n    blueprint: GeneBlueprint<K>,\r\n    initialState?: GeneInitialStateFn<S, K> | S,\r\n    step?: GeneStepFn<S, K>,\r\n    shouldStep: GeneShouldStepFn<S, K> = step != null ? alwaysStep : neverStep\r\n  ) {\r\n    const initialStateFn =\r\n      typeof initialState === \"function\"\r\n        ? (initialState as GeneInitialStateFn<S, K>)\r\n        : () => ({ ...(initialState ?? ({} as S)) });\r\n    const gene = new Gene<S, K>(blueprint, initialStateFn, step ?? (stepNoOP as GeneStepFn<S, K>), shouldStep);\r\n    if (!blueprint.isHidden) {\r\n      const { name } = gene.blueprint;\r\n      const exists = AllGenesByName.has(name);\r\n      if (exists) {\r\n        console.error(\"A gene named\", name, \"already exists!\");\r\n      }\r\n      AllGenesByName.set(gene.blueprint.name, (gene as unknown) as Gene);\r\n    }\r\n    return gene;\r\n  }\r\n}\r\n\r\nexport const AllGenesByName: Map<string, Gene> = new Map();\r\n\r\nexport type RealizedProps<K extends string> = Record<K, number>;\r\n\r\nexport type PropBlueprint<K extends string> = Record<K, number | number[]>;\r\n\r\nexport interface GeneBlueprint<K extends string> {\r\n  name: string;\r\n  isHidden?: boolean;\r\n  description: (props: RealizedProps<K>, sProps: Partial<CellProperties>) => React.ReactNode;\r\n  levelCosts: number[];\r\n  levelProps: PropBlueprint<K>;\r\n  static?: CellPropertiesBlueprint;\r\n  /**\r\n   * Dynamic properties get computed at the start of each cell's step.\r\n   */\r\n  dynamic?(cell: Cell, properties: CellProperties): CellProperties;\r\n  requirements?: Gene[];\r\n}\r\n\r\nexport type CellPropertiesBlueprint = {\r\n  [K in keyof CellProperties]?: CellProperties[K] | Array<CellProperties[K]>;\r\n};\r\n\r\n// export type GeneInitialStateFn<S, K extends string> = (instance: GeneInstance<Gene<S, K>>) => S;\r\nexport type GeneInitialStateFn<S, K extends string> = (gene: Gene<S, K>, props: RealizedProps<K>, cell: Cell) => S;\r\n\r\nexport type GeneStepFn<S, K extends string> = (dt: number, instance: GeneInstance<Gene<S, K>>) => S | void;\r\n\r\nexport type GeneShouldStepFn<S, K extends string> = (dt: number, instance: GeneInstance<Gene<S, K>>) => boolean;\r\n\r\nconst stepNoOP: GeneStepFn<any, any> = () => {};\r\n\r\nexport const alwaysStep: GeneShouldStepFn<any, any> = (dt) => {\r\n  return true;\r\n};\r\n\r\nexport const neverStep: GeneShouldStepFn<any, any> = (dt) => {\r\n  return true;\r\n};\r\n","/**\r\n * In Mito, our standard units of measurement are:\r\n *\r\n * Distance - tiles.\r\n * Time - seconds.\r\n */\r\n\r\n/**\r\n * How many tiles per second the Player moves.\r\n */\r\nexport const PLAYER_BASE_SPEED = 4.2;\r\nexport const PLAYER_MAX_RESOURCES = 100;\r\nexport const PLAYER_STARTING_WATER = 25;\r\nexport const PLAYER_STARTING_SUGAR = 25;\r\n\r\nexport const PLAYER_INTERACT_EXCHANGE_SPEED = 30;\r\n\r\n/**\r\n * 3 resources per second.\r\n */\r\nexport const PLAYER_INTERACT_EXCHANGE_NONCELL_SPEED = 3;\r\n/**\r\n * How fast the Player moves from standing on Transport.\r\n */\r\nexport const PLAYER_MOVED_BY_TRANSPORT_SPEED = 0.3;\r\n\r\n/**\r\n * Number of realtime seconds in a game year.\r\n */\r\nexport const TIME_PER_YEAR = 60 * 36; // 60 seconds * 36 minutes = 1800 seconds\r\nexport const TIME_PER_SEASON = TIME_PER_YEAR / 4; // 480 seconds per season (9 minutes)\r\nexport const TIME_PER_MONTH = TIME_PER_SEASON / 3; // 180 seconds per month (3 minutes)\r\nexport const TIME_PER_DAY = TIME_PER_MONTH / 3; // 60 seconds per day (1 minute)\r\n\r\n/**\r\n * How many seconds by default it takes to build a Cell.\r\n */\r\nexport const CELL_BUILD_TIME = 0;\r\n\r\n/**\r\n * How many tiles per frame a cell will freefall in the Air. Unscaled\r\n * by time.\r\n */\r\nexport const CELL_DROOP = 0.027;\r\n\r\n/**\r\n * In a two Cell system with one Water, this water will diffuse, on average, after this many seconds.\r\n * Divide this by 8 to get an idea of how \"fast\" a single water will move on a fully filled out Tissue plane.\r\n */\r\nexport const CELL_DIFFUSION_WATER_TIME = 16.6667;\r\n\r\n/**\r\n * See CELL_DIFFUSION_WATER_TIME explanation.\r\n */\r\nexport const CELL_DIFFUSION_SUGAR_TIME = 16.6667;\r\n\r\n/**\r\n * Max inventory capacity of Tissue, Transports, and Roots.\r\n */\r\nexport const TISSUE_INVENTORY_CAPACITY = 6;\r\n\r\n/**\r\n * On average, for each Air tile adjacent to each Leaf, water will be converted to sugar after this many seconds.\r\n */\r\nexport const LEAF_REACTION_TIME = 40;\r\n\r\nexport const SUNLIGHT_REINTRODUCTION = 0.15;\r\n\r\nexport const SUNLIGHT_DIFFUSION = 0.0;\r\n","export * from \"./GeneAiryExpansion\";\r\nexport * from \"./GeneAttractsSugar\";\r\nexport * from \"./GeneAttractsWater\";\r\nexport * from \"./GeneBark\";\r\nexport * from \"./GeneCannotFreeze\";\r\nexport * from \"./GeneCostly\";\r\nexport * from \"./GeneDiffuseSugar\";\r\nexport * from \"./GeneDiffuseWater\";\r\nexport * from \"./GeneHydrostasis\";\r\nexport * from \"./GeneInventory\";\r\nexport * from \"./GeneLiving\";\r\nexport * from \"./GeneNetworkEffect\";\r\nexport * from \"./GeneNutrientExtraction\";\r\nexport * from \"./GeneObstacle\";\r\nexport * from \"./GeneOsmosis\";\r\nexport * from \"./GenePhotosynthesis\";\r\nexport * from \"./GenePipes\";\r\nexport * from \"./GenePushWater\";\r\nexport * from \"./GeneReproducer\";\r\nexport * from \"./GeneScaffolding\";\r\nexport * from \"./GeneSoilAbsorption\";\r\nexport * from \"./GeneTransport\";\r\nexport * from \"./GeneVascular\";\r\n","export enum Temperature {\r\n  Scorching = 4,\r\n  Hot = 3,\r\n  Mild = 2,\r\n  Cold = 1,\r\n  Freezing = 0,\r\n}\r\n","import { parse, stringify } from \"query-string\";\r\n\r\nconst PARAMS_DEFAULT = {\r\n  hud: true,\r\n  showGodUI: false,\r\n  showFPS: false,\r\n  debugPerf: false,\r\n  debugLevel: false,\r\n  forceNight: false,\r\n  debug: process.env.NODE_ENV === \"development\",\r\n};\r\n\r\ntype Params = typeof PARAMS_DEFAULT;\r\n\r\nexport const params = { ...PARAMS_DEFAULT };\r\n\r\nconst search = parse(window.location.search);\r\nif (search.params != null) {\r\n  const urlHashParams: object = JSON.parse(search.params as string);\r\n  Object.assign(params, urlHashParams);\r\n}\r\n\r\nexport function updateParamsHash() {\r\n  const nonDefaultParams: Partial<Params> = {};\r\n  const keys = Object.keys(PARAMS_DEFAULT) as Array<keyof Params>;\r\n  for (const key of keys) {\r\n    const k = params[key];\r\n    if (k !== PARAMS_DEFAULT[key]) {\r\n      nonDefaultParams[key] = k as any;\r\n    }\r\n  }\r\n  if (Object.keys(nonDefaultParams).length > 0) {\r\n    const stringified = stringify({\r\n      ...parse(window.location.search),\r\n      params: JSON.stringify(nonDefaultParams),\r\n    });\r\n    window.location.search = stringified;\r\n  } else {\r\n  }\r\n}\r\nupdateParamsHash();\r\n","import sugarSrc from \"assets/images/sugar.png\";\r\nimport waterSrc from \"assets/images/water.png\";\r\nimport * as React from \"react\";\r\nexport interface ResourceIconProps {\r\n  name?: \"water\" | \"sugar\" | \"w\" | \"s\";\r\n  w?: boolean;\r\n  s?: boolean;\r\n}\r\n\r\nexport const ResourceIcon: React.FC<ResourceIconProps> = React.memo(({ name, s }) => (\r\n  <img alt=\"\" src={s || name === \"sugar\" || name === \"s\" ? sugarSrc : waterSrc} className=\"resource-icon\" />\r\n));\r\n","const cache: Map<string, Intl.NumberFormat> = new Map();\r\nexport function nf(n: number, maximumSignificantDigits: number = 3, minimumSignificantDigits?: number) {\r\n  const key = `${minimumSignificantDigits},${maximumSignificantDigits}`;\r\n  if (!cache.has(key)) {\r\n    cache.set(\r\n      key,\r\n      new Intl.NumberFormat(undefined, {\r\n        maximumSignificantDigits,\r\n        minimumSignificantDigits,\r\n        useGrouping: true,\r\n      })\r\n    );\r\n  }\r\n  return cache.get(key)!.format(n);\r\n}\r\n","import { Vector2 } from \"three\";\r\n\r\nexport const DIRECTIONS = {\r\n  nw: new Vector2(-1, -1),\r\n  w: new Vector2(-1, 0),\r\n  sw: new Vector2(-1, +1),\r\n  n: new Vector2(0, -1),\r\n  // new Vector2( 0,  0),\r\n  s: new Vector2(0, +1),\r\n  ne: new Vector2(+1, -1),\r\n  e: new Vector2(+1, 0),\r\n  se: new Vector2(+1, +1),\r\n};\r\n\r\nexport type Directions = keyof typeof DIRECTIONS;\r\n\r\nexport function oppositeDir(dir: Directions): Directions {\r\n  switch (dir) {\r\n    case \"nw\":\r\n      return \"se\";\r\n    case \"w\":\r\n      return \"e\";\r\n    case \"sw\":\r\n      return \"ne\";\r\n    case \"n\":\r\n      return \"s\";\r\n    case \"s\":\r\n      return \"n\";\r\n    case \"ne\":\r\n      return \"sw\";\r\n    case \"e\":\r\n      return \"w\";\r\n    case \"se\":\r\n      return \"nw\";\r\n  }\r\n}\r\n\r\nexport const DIRECTION_NAMES = Object.keys(DIRECTIONS) as Directions[];\r\nexport const DIRECTION_VALUES: Vector2[] = DIRECTION_NAMES.map((o) => DIRECTIONS[o]);\r\n","export * from \"../tile/deadCell\";\r\nexport * from \"./cell\";\r\nexport * from \"./cellEffect\";\r\nexport * from \"./cellProperties\";\r\nexport * from \"./chromosome\";\r\nexport * from \"./gene\";\r\nexport * from \"./geneInstance\";\r\nexport * from \"./genome\";\r\nexport * from \"./growingCell\";\r\nexport * from \"./materialInfo\";\r\nexport * from \"./realizedGene\";\r\n","import { ResourceIcon, ResourceIconProps } from \"game/ui/common/ResourceIcon\";\r\nimport React from \"react\";\r\n\r\nconst RI: React.FC<ResourceIconProps> = (props) => {\r\n  return (\r\n    <span className=\"ri\">\r\n      <ResourceIcon {...props} />\r\n    </span>\r\n  );\r\n};\r\n\r\nexport default RI;\r\n","import DynamicNumber, { DynamicNumberProps } from \"game/ui/common/DynamicNumber\";\r\nimport React from \"react\";\r\n\r\nconst GN: React.FC<DynamicNumberProps> = (props) => {\r\n  return (\r\n    <span className=\"gn\">\r\n      <DynamicNumber {...props} />\r\n    </span>\r\n  );\r\n};\r\n\r\nexport default GN;\r\n","import { groupBy, toPairs } from \"lodash\";\r\nimport { clamp } from \"math\";\r\nimport { createSimpleSchema, list, object, serializable } from \"serializr\";\r\nimport { Vector2 } from \"three\";\r\nimport { CellArgs } from \"./cell\";\r\nimport Chromosome from \"./chromosome\";\r\nimport { MaterialInfo, MaterialInfoSchema } from \"./materialInfo\";\r\nimport { RealizedGene } from \"./realizedGene\";\r\n\r\nexport interface CellInteraction {\r\n  type: \"give\" | \"take\";\r\n  resources: \"water\" | \"sugar\" | \"water and sugar\" | \"water take sugar\" | \"sugar take water\";\r\n  continuous?: boolean;\r\n}\r\n\r\nconst CellInteractionSchema = createSimpleSchema({\r\n  \"*\": true,\r\n});\r\n\r\nexport class CellType {\r\n  @serializable\r\n  public name: string;\r\n\r\n  @serializable\r\n  public geneSlots: number;\r\n\r\n  @serializable(object(Chromosome))\r\n  public chromosome: Chromosome;\r\n\r\n  @serializable(object(MaterialInfoSchema))\r\n  public material: MaterialInfo;\r\n\r\n  @serializable(object(CellInteractionSchema))\r\n  public interaction?: CellInteraction;\r\n\r\n  public args?: CellArgs;\r\n\r\n  // all params optional because serializr might call this with 0 args\r\n  constructor(\r\n    name?: string,\r\n    geneSlots?: number,\r\n    chromosome?: Chromosome,\r\n    material?: MaterialInfo,\r\n    interaction?: CellInteraction\r\n  ) {\r\n    this.name = name!;\r\n    this.geneSlots = geneSlots!;\r\n    this.chromosome = chromosome!;\r\n    this.material = material!;\r\n    this.interaction = interaction;\r\n    if (chromosome?.computeStaticProperties().isDirectional) {\r\n      this.args = {\r\n        direction: new Vector2(0, -1),\r\n      };\r\n    }\r\n  }\r\n\r\n  rotateArgDirection() {\r\n    const direction = this.args?.direction;\r\n    direction\r\n      ?.rotateAround(new Vector2(), -Math.PI / 4)\r\n      .setLength(1)\r\n      .round();\r\n  }\r\n\r\n  isReproducer() {\r\n    return this.chromosome.genes.some((gene) => gene.getStaticProperties().isReproductive);\r\n  }\r\n\r\n  /**\r\n   * Get all duplicate genes that are on this genome.\r\n   */\r\n  getDuplicateGenes() {\r\n    const genesByType = toPairs(groupBy(this.chromosome.genes, (rg) => rg.gene.blueprint.name));\r\n    const duplicateGenesPairs = genesByType.filter(([, genes]) => genes.length > 1);\r\n    const duplicateGenesSet = new Set(duplicateGenesPairs.flatMap(([, genes]) => genes));\r\n    return duplicateGenesSet;\r\n  }\r\n\r\n  getChanceToBecomeCancerous() {\r\n    const geneSlotsNet = this.chromosome.geneSlotsNet();\r\n    if (geneSlotsNet < 0) {\r\n      // 1.5^x * 0.0125\r\n      // 0.188%, 0.281%, 0.422%, 0.633%, 0.949%, 1.43%, 2.14%, 3.2%, 4.81%, 7.21%\r\n      return clamp(Math.pow(1.3, Math.abs(geneSlotsNet)) * 0.00125, 0, 1);\r\n    } else {\r\n      return 0;\r\n    }\r\n  }\r\n}\r\n\r\nexport default class Genome {\r\n  @serializable(list(object(CellType)))\r\n  public cellTypes: CellType[];\r\n\r\n  @serializable(list(object(RealizedGene)))\r\n  public unusedGenes: RealizedGene[];\r\n\r\n  constructor(cellTypes?: CellType[], unusedGenes?: RealizedGene[]) {\r\n    this.cellTypes = cellTypes!;\r\n    this.unusedGenes = unusedGenes ?? [];\r\n  }\r\n\r\n  /**\r\n   * All genes on this genome - genes on cells, and unused as well.\r\n   */\r\n  public getAllGenes(): RealizedGene[] {\r\n    return [...this.cellTypes.flatMap((cell) => cell.chromosome.genes), ...this.unusedGenes];\r\n  }\r\n}\r\n\r\nexport function describeCellInteraction({ resources, type }: CellInteraction) {\r\n  return `${type} ${resources}`;\r\n}\r\n","export type TickerCallback = (time: number) => boolean | void;\r\nclass TickerClass {\r\n  private tickerId = 1;\r\n\r\n  private tickers: Record<number, TickerCallback> = {};\r\n\r\n  private _time = 0;\r\n\r\n  get now() {\r\n    return this._time;\r\n  }\r\n\r\n  tickerLoop = (time: number) => {\r\n    this._time = time;\r\n    const toDelete: number[] = [];\r\n    for (const id in this.tickers) {\r\n      const f = this.tickers[id];\r\n      const shouldDelete = f(time);\r\n      if (shouldDelete === true) {\r\n        toDelete.push(Number(id));\r\n      }\r\n    }\r\n    for (const id of toDelete) {\r\n      this.removeAnimation(id);\r\n    }\r\n    requestAnimationFrame(this.tickerLoop);\r\n  };\r\n\r\n  /**\r\n   * Return true to kill the ticker.\r\n   */\r\n  public addAnimation(fn: TickerCallback) {\r\n    const id = this.tickerId++;\r\n    this.tickers[id] = fn;\r\n    return id;\r\n  }\r\n\r\n  public removeAnimation(id: number) {\r\n    return delete this.tickers[id];\r\n  }\r\n\r\n  public start() {\r\n    requestAnimationFrame(this.tickerLoop);\r\n  }\r\n}\r\n\r\nconst Ticker = new TickerClass();\r\nTicker.start();\r\n\r\nexport default Ticker;\r\n","import { EventEmitter } from \"events\";\r\nimport { Vector2 } from \"three\";\r\n\r\n// floating point rounding error fix\r\n// without: 0.8 - 0.1 = 0.7000000000000001\r\n// with: fpref(0.8 - 0.1) = 0.7\r\nfunction fpref(x: number) {\r\n  return Math.round(x * 1e12) / 1e12;\r\n}\r\n\r\ninterface HasPosition {\r\n  pos: Vector2;\r\n}\r\n\r\nexport class Inventory {\r\n  constructor(\r\n    public capacity: number,\r\n    public carrier: HasPosition,\r\n    public water: number = 0,\r\n    public sugar: number = 0\r\n  ) {\r\n    if (process.env.NODE_ENV === \"development\") {\r\n      this.validate();\r\n    }\r\n  }\r\n\r\n  public isEmpty() {\r\n    return this.water === 0 && this.sugar === 0;\r\n  }\r\n\r\n  has(water: number, sugar: number) {\r\n    return this.water >= water && this.sugar >= sugar;\r\n  }\r\n\r\n  public give(other: Inventory, amountWater: number, amountSugar: number) {\r\n    if (other === this) {\r\n      throw new Error(\"shouldn't give to self\");\r\n    }\r\n    if (amountWater === 0 && amountSugar === 0) {\r\n      return { water: 0, sugar: 0 };\r\n    }\r\n    // to check:\r\n    // 1) we have enough water and sugar\r\n    //      if we don't, cap water and sugar to the amount available\r\n    // 2) other has enough space\r\n    //      if it doesn't, scale down to the amount that is available\r\n    // 3) if negative, check how much you can take from other\r\n    let water = amountWater > 0 ? Math.min(amountWater, this.water) : -Math.min(-amountWater, other.water);\r\n    let sugar = amountSugar > 0 ? Math.min(amountSugar, this.sugar) : -Math.min(-amountSugar, other.sugar);\r\n\r\n    const spaceNeeded = fpref(water + sugar);\r\n    const spaceAvailable = other.space();\r\n    if (spaceNeeded > spaceAvailable) {\r\n      // scale down the amount to give\r\n      // give less than capacity\r\n      water = Math.floor((water / spaceNeeded) * spaceAvailable);\r\n      sugar = Math.floor((sugar / spaceNeeded) * spaceAvailable);\r\n    }\r\n    if (water !== 0 || sugar !== 0) {\r\n      this.change(-water, -sugar);\r\n      other.change(water, sugar);\r\n      if (this.events) {\r\n        this.events.emit(\"give\", other, water, sugar);\r\n      }\r\n      if (other.events) {\r\n        other.events.emit(\"get\", this, water, sugar);\r\n      }\r\n    }\r\n    return { water, sugar };\r\n  }\r\n\r\n  private events?: EventEmitter;\r\n\r\n  public on(name: \"give\" | \"get\" | \"add\" | \"change\", fn: (...args: any[]) => void) {\r\n    this.events = this.events || new EventEmitter();\r\n    this.events.on(name, fn);\r\n  }\r\n\r\n  public off(name: \"give\" | \"get\" | \"add\" | \"change\", fn: (...args: any[]) => any) {\r\n    this.events = this.events || new EventEmitter();\r\n    this.events.off(name, fn);\r\n  }\r\n\r\n  /**\r\n   * Set resources to an exact value; usually used in tile generation.\r\n   */\r\n  public set(water: number, sugar: number) {\r\n    this.water = 0;\r\n    this.sugar = 0;\r\n    this.add(water, sugar);\r\n  }\r\n\r\n  public add(water: number, sugar: number) {\r\n    const spaceNeeded = fpref(water + sugar);\r\n    const spaceAvailable = this.space();\r\n    if (spaceNeeded > spaceAvailable) {\r\n      // scale down the amount to give\r\n      water = (water / spaceNeeded) * spaceAvailable;\r\n      sugar = (sugar / spaceNeeded) * spaceAvailable;\r\n    }\r\n    this.change(water, sugar);\r\n    if (this.events) {\r\n      this.events.emit(\"add\", water, sugar);\r\n    }\r\n  }\r\n\r\n  private change(water: number, sugar: number) {\r\n    const newWater = fpref(this.water + water);\r\n    const newSugar = fpref(this.sugar + sugar);\r\n    if (process.env.NODE_ENV === \"development\") {\r\n      this.validate();\r\n    }\r\n    this.water = newWater;\r\n    this.sugar = newSugar;\r\n\r\n    // fixup if needed\r\n    if (this.water < 0) {\r\n      this.water = 0;\r\n    }\r\n    if (this.sugar < 0) {\r\n      this.sugar = 0;\r\n    }\r\n    if (this.water + this.sugar > this.capacity) {\r\n      if (this.water > this.sugar) {\r\n        this.water = this.capacity - this.sugar;\r\n      } else {\r\n        this.sugar = this.capacity - this.water;\r\n      }\r\n    }\r\n\r\n    if (this.events) {\r\n      this.events.emit(\"change\", water, sugar);\r\n    }\r\n  }\r\n\r\n  public space() {\r\n    const { capacity, water, sugar } = this;\r\n    return fpref(capacity - water - sugar);\r\n  }\r\n\r\n  public isMaxed() {\r\n    return this.space() < 1;\r\n  }\r\n\r\n  validate(water: number = this.water, sugar: number = this.sugar) {\r\n    const { capacity } = this;\r\n    if (water < 0) {\r\n      console.warn(`water < 0: ${water}`);\r\n      // throw new Error(`water < 0: ${water}`);\r\n    }\r\n    if (sugar < 0) {\r\n      console.warn(`sugar < 0: ${sugar}`);\r\n      // throw new Error(`sugar < 0: ${sugar}`);\r\n    }\r\n    if (water + sugar > capacity) {\r\n      console.warn(`bad inventory: ${water} water + ${sugar} > ${capacity} max`);\r\n      // throw new Error(`bad inventory: ${water} water + ${sugar} > ${capacity} max`);\r\n    }\r\n  }\r\n}\r\n","import { TIME_PER_DAY } from \"core/constants\";\r\nimport { Interactable } from \"core/interactable\";\r\nimport { Inventory } from \"core/inventory\";\r\nimport { Action } from \"core/player/action\";\r\nimport { Temperature } from \"core/temperature\";\r\nimport { Tile } from \"core/tile/tile\";\r\nimport { clamp, map, randFloat, randRound } from \"math/index\";\r\nimport { Air } from \"./air\";\r\nexport abstract class Soil extends Tile implements Interactable {\r\n  /**\r\n   * Soil will aggressively hold onto water below saturation;\r\n   * after saturation, water is easily moved by forces diffusion or gravity.\r\n   */\r\n  abstract get saturation(): number;\r\n\r\n  /**\r\n   * How far away is this soil from the nearest Air?\r\n   */\r\n  public depth = 1000;\r\n\r\n  isObstacle = false;\r\n\r\n  isStructuralSupport = true;\r\n\r\n  private rechargeWaterCooldown = randFloat(0, TIME_PER_DAY);\r\n\r\n  get depthDiffusionFactor() {\r\n    // make water move slower in deeper soil. Every depth 10, slow down gravity and fallAmount by this much\r\n    return 1 + (this.depth - 1) / 10;\r\n    // return 1;\r\n  }\r\n\r\n  /**\r\n   * All soils can pull from each other. Also can pull from Air.\r\n   */\r\n  canPullResources(giver: Tile) {\r\n    return giver instanceof Soil || Air.is(giver);\r\n  }\r\n\r\n  interact(): Action | undefined {\r\n    return {\r\n      type: \"pickup\",\r\n      water: 1,\r\n      sugar: 1,\r\n      target: this,\r\n      continuous: true,\r\n    };\r\n  }\r\n\r\n  shouldStep(dt: number) {\r\n    // test this out\r\n    return dt > 0.2;\r\n  }\r\n\r\n  step(dt: number) {\r\n    super.step(dt);\r\n    this.stepEvaporation(dt);\r\n    this.stepGiveWater(dt);\r\n  }\r\n\r\n  stepEvaporation(dt: number) {\r\n    const { secondsToEvaporate } = this.world.environment;\r\n    const water = this.inventory.water;\r\n    const evaporationChance = (water / secondsToEvaporate) * clamp(map(this.depth, 1, 8, 1, 0), 0, 1);\r\n    if (Math.random() < evaporationChance * dt) {\r\n      const waterToEvaporate = Math.min(water, 1);\r\n      this.inventory.add(-waterToEvaporate, 0);\r\n      this.world.logEvent({ type: \"evaporation\", tile: this });\r\n      this.world.numEvaporatedSoil += waterToEvaporate;\r\n    }\r\n  }\r\n\r\n  stepGiveWater(dt: number) {\r\n    this.rechargeWaterCooldown -= dt;\r\n    if (this.rechargeWaterCooldown <= 0) {\r\n      if (this.inventory.water < this.saturation) {\r\n        this.inventory.add(1, 0);\r\n        this.world.numRechargedWater += 1;\r\n      }\r\n      this.rechargeWaterCooldown += TIME_PER_DAY;\r\n    }\r\n  }\r\n\r\n  diffuseWater(tile: Tile, dt: number, diffusionRate?: number) {\r\n    if (this.pos.y < tile.pos.y) {\r\n      // test: don't diffuse upwards\r\n      return;\r\n    }\r\n    if (tile instanceof Soil && tile.inventory.water <= tile.saturation) {\r\n      return;\r\n    }\r\n    return super.diffuseWater(tile, dt, diffusionRate);\r\n  }\r\n\r\n  stepGravity(dt: number) {\r\n    const freeWater = this.inventory.water - this.saturation;\r\n    if (freeWater > 0) {\r\n      const fallAmount = this.fallAmount * dt;\r\n      const lowerNeighbor = this.world.tileAt(this.pos.x, this.pos.y + 1);\r\n      if (fallAmount > 0 && lowerNeighbor != null && lowerNeighbor.canPullResources(this)) {\r\n        const waterToGive = Math.min(randRound(fallAmount), freeWater);\r\n        this.inventory.give(lowerNeighbor.inventory, waterToGive, 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  stepTemperature(_dt: number) {\r\n    if (this.depth > 4) {\r\n      this.temperature = Temperature.Mild;\r\n    } else {\r\n      this.temperature = this.world.weather.getCurrentTemperature();\r\n    }\r\n  }\r\n}\r\n\r\nexport class Sand extends Soil {\r\n  displayName = \"Sand\";\r\n\r\n  get diffusionWater() {\r\n    return 1 / (3 * this.depthDiffusionFactor);\r\n  }\r\n\r\n  get saturation() {\r\n    return 0;\r\n  }\r\n\r\n  get fallAmount() {\r\n    return 2.0 / this.depthDiffusionFactor;\r\n  }\r\n\r\n  public inventory = new Inventory(20, this);\r\n}\r\n\r\nexport class Silt extends Soil {\r\n  displayName = \"Silt\";\r\n\r\n  get diffusionWater() {\r\n    return 1 / (12 * this.depthDiffusionFactor);\r\n  }\r\n\r\n  get saturation() {\r\n    return 2;\r\n  }\r\n\r\n  get fallAmount() {\r\n    return 0.3 / this.depthDiffusionFactor;\r\n  }\r\n\r\n  public inventory = new Inventory(10, this);\r\n}\r\n\r\nexport class Clay extends Soil {\r\n  displayName = \"Clay\";\r\n\r\n  get diffusionWater() {\r\n    return 1 / (100 * this.depthDiffusionFactor);\r\n  }\r\n\r\n  get saturation() {\r\n    return 5;\r\n  }\r\n\r\n  get fallAmount() {\r\n    return 0.075 / this.depthDiffusionFactor;\r\n  }\r\n\r\n  public inventory = new Inventory(10, this);\r\n}\r\n","import { list, object, serializable } from \"serializr\";\r\nimport { Cell } from \"../tile\";\r\nimport { defaultCellProperties } from \"./cellProperties\";\r\nimport { Gene } from \"./gene\";\r\nimport { RealizedGene } from \"./realizedGene\";\r\n\r\nexport default class Chromosome {\r\n  @serializable(list(object(RealizedGene)))\r\n  public genes: RealizedGene[];\r\n\r\n  constructor(...genes: RealizedGene[]) {\r\n    this.genes = genes;\r\n  }\r\n\r\n  /**\r\n   * Values overwrite each other by default; numbers add together.\r\n   */\r\n  public computeStaticProperties() {\r\n    const properties = defaultCellProperties();\r\n    for (const g of this.genes) {\r\n      // TODO beware of clobbering\r\n      for (const [k, v] of Object.entries(g.getStaticProperties())) {\r\n        if (k === \"tempo\") {\r\n          properties[k] *= v as number;\r\n        } else if (typeof v === \"number\") {\r\n          properties[k] = (properties[k] as number) + v;\r\n        } else if (v != null) {\r\n          properties[k] = v;\r\n        }\r\n      }\r\n    }\r\n    properties.timeToBuild = Math.max(properties.timeToBuild, 0);\r\n    return properties;\r\n  }\r\n\r\n  newGeneInstances(cell: Cell) {\r\n    return this.genes.map((g) => g.newInstance(cell));\r\n  }\r\n\r\n  has(gene: Gene): boolean {\r\n    return this.genes.find((r) => r.gene === gene) != null;\r\n  }\r\n\r\n  isEmpty() {\r\n    return this.genes.length === 0;\r\n  }\r\n\r\n  geneSlotsUsed() {\r\n    return this.genes\r\n      .map((g) => g.getCost())\r\n      .filter((c) => c >= 0)\r\n      .reduce((a, b) => a + b, 0);\r\n  }\r\n\r\n  geneSlotsAdded() {\r\n    return (\r\n      this.genes\r\n        .map((g) => g.getCost())\r\n        .filter((c) => c < 0)\r\n        .reduce((a, b) => a + b, 0) * -1\r\n    );\r\n  }\r\n\r\n  geneSlotsNet(): number {\r\n    return this.geneSlotsAdded() - this.geneSlotsUsed();\r\n  }\r\n}\r\n","import { Player } from \"core\";\r\nimport { Inventory } from \"core/inventory\";\r\nimport { Action } from \"core/player/action\";\r\nimport { Temperature } from \"core/temperature\";\r\nimport { params } from \"game/params\";\r\nimport { Vector2 } from \"three\";\r\nimport { CELL_DROOP } from \"../constants\";\r\nimport { DIRECTIONS } from \"../directions\";\r\nimport { step } from \"../entity\";\r\nimport { Interactable, isInteractable } from \"../interactable\";\r\nimport { DeadCell } from \"../tile/deadCell\";\r\nimport { Tile } from \"../tile/tile\";\r\nimport { World } from \"../world/world\";\r\nimport { CancerEffect, CellEffect, CellEffectConstructor, FreezeEffect } from \"./cellEffect\";\r\nimport { CellProperties } from \"./cellProperties\";\r\nimport Chromosome from \"./chromosome\";\r\nimport { Gene } from \"./gene\";\r\nimport { GeneInstance } from \"./geneInstance\";\r\nimport { CellType } from \"./genome\";\r\n\r\nexport interface CellArgs {\r\n  direction?: Vector2;\r\n}\r\n\r\nexport class Cell extends Tile implements Interactable {\r\n  get displayName() {\r\n    return this.type.name;\r\n  }\r\n\r\n  set displayName(n: string) {}\r\n\r\n  public energy = 1;\r\n\r\n  public darkness = 0;\r\n\r\n  public closestCellAirDistance = 0;\r\n\r\n  // offset [-0.5, 0.5] means you're still \"inside\" this cell, going out of it will break you\r\n  // public offset = new Vector2();\r\n  public droopY = 0;\r\n\r\n  public effects: CellEffect[] = [];\r\n\r\n  public chromosome: Chromosome;\r\n\r\n  public geneInstances: GeneInstance<Gene<any, string>>[];\r\n\r\n  public inventory: Inventory;\r\n\r\n  public readonly staticProperties: CellProperties;\r\n\r\n  /**\r\n   * Should compute at the start of every step.\r\n   */\r\n  private properties: CellProperties;\r\n\r\n  get isObstacle() {\r\n    return this.properties.isObstacle;\r\n  }\r\n\r\n  get isReproductive() {\r\n    return this.properties.isReproductive;\r\n  }\r\n\r\n  get diffusionWater() {\r\n    return this.properties.diffusionWater;\r\n  }\r\n\r\n  get diffusionSugar() {\r\n    return this.properties.diffusionSugar;\r\n  }\r\n\r\n  get moveSpeed() {\r\n    return this.temperatureTempo * this.properties.moveSpeed;\r\n  }\r\n\r\n  get timeToBuild() {\r\n    return this.properties.timeToBuild;\r\n  }\r\n\r\n  get tempo() {\r\n    return this.properties.tempo * this.temperatureTempo;\r\n  }\r\n\r\n  get energyUpkeep() {\r\n    return this.properties.energyUpkeep;\r\n  }\r\n\r\n  get darknessContrib() {\r\n    return 0;\r\n  }\r\n\r\n  get cellAirDistanceContrib() {\r\n    return 0;\r\n  }\r\n\r\n  public args: CellArgs = {\r\n    direction: new Vector2(0, -1),\r\n  };\r\n\r\n  constructor(pos: Vector2, world: World, public type: CellType, args?: CellArgs) {\r\n    super(pos, world);\r\n    this.chromosome = type.chromosome;\r\n    this.staticProperties = this.chromosome.computeStaticProperties();\r\n    const { inventoryCapacity } = this.staticProperties;\r\n    this.inventory = new Inventory(inventoryCapacity, this);\r\n    if (args?.direction) {\r\n      this.args.direction!.copy(args?.direction);\r\n    }\r\n\r\n    // careful - ordering matters here (e.g. this.inventory shouldn't be null)\r\n    this.properties = this.computeDynamicProperties();\r\n\r\n    this.geneInstances = this.chromosome.newGeneInstances(this);\r\n\r\n    this.stepTemperature(0);\r\n  }\r\n\r\n  /**\r\n   * Temperature speed multiplier.\r\n   */\r\n  protected get temperatureTempo() {\r\n    return TEMPO_FROM_TEMPERATURE[this.temperature];\r\n  }\r\n\r\n  /**\r\n   * Be careful, this can be expensive! This is cached by dynamicProperties.\r\n   */\r\n  private computeDynamicProperties() {\r\n    let properties = { ...this.staticProperties };\r\n    for (const g of this.chromosome.genes) {\r\n      properties = g.getDynamicProperties(this, properties) ?? properties;\r\n    }\r\n    return properties;\r\n  }\r\n\r\n  /**\r\n   * All cells can pull from each other.\r\n   */\r\n  canPullResources(giver: Tile) {\r\n    return Cell.is(giver);\r\n  }\r\n\r\n  addEffect(effect: CellEffect) {\r\n    const stacks = (effect.constructor as CellEffectConstructor).stacks;\r\n    if (!stacks) {\r\n      // exit early if we found another one and we don't stack\r\n      if (this.findEffectOfType(effect.constructor as CellEffectConstructor) != null) {\r\n        return;\r\n      }\r\n    }\r\n    if (this.properties.cantFreeze && effect instanceof FreezeEffect) {\r\n      return;\r\n    }\r\n    effect.attachTo(this);\r\n    this.effects.push(effect);\r\n  }\r\n\r\n  findEffectOfType(type: CellEffectConstructor) {\r\n    return this.effects.find((e) => e.constructor === type);\r\n  }\r\n\r\n  interact(source: Player) {\r\n    for (const e of this.effects) {\r\n      if (isInteractable(e)) {\r\n        const action = e.interact(source);\r\n        if (action != null) {\r\n          return action;\r\n        }\r\n      }\r\n    }\r\n    // Cell interaction\r\n    const { interaction } = this.type;\r\n    if (interaction != null) {\r\n      const [water, sugar] = (() => {\r\n        switch (interaction.resources) {\r\n          case \"water\":\r\n            return [1, 0];\r\n          case \"sugar\":\r\n            return [0, 1];\r\n          case \"water and sugar\":\r\n            return [1, 1];\r\n          case \"sugar take water\":\r\n            return [-1, 1];\r\n          case \"water take sugar\":\r\n            return [1, -1];\r\n          default:\r\n            return [0, 0];\r\n        }\r\n      })();\r\n      const action: Action = {\r\n        type: interaction.type === \"give\" ? \"drop\" : \"pickup\",\r\n        water,\r\n        sugar,\r\n        target: this,\r\n        continuous: interaction.continuous,\r\n      };\r\n      return action;\r\n    }\r\n  }\r\n\r\n  public isDead = false;\r\n\r\n  die() {\r\n    this.world.setTileAt(this.pos, new DeadCell(this.pos, this.world));\r\n  }\r\n\r\n  shouldStep(dt: number) {\r\n    return dt > 0.1;\r\n  }\r\n\r\n  findGene<G extends Gene>(gene: G): GeneInstance<G> | undefined {\r\n    return this.geneInstances.find((g) => g.isType(gene)) as GeneInstance<G>;\r\n  }\r\n\r\n  step(dt: number) {\r\n    if (params.debug) {\r\n      this.validateDirection();\r\n    }\r\n    this.properties = this.computeDynamicProperties();\r\n\r\n    // diffusion, darkness, gravity\r\n    super.step(dt);\r\n    this.stepDroop(dt);\r\n\r\n    // cell effects and genes scale according to tempo\r\n    dt = this.tempo * dt;\r\n    this.stepCancer(dt);\r\n    this.stepCellEffects(dt);\r\n    this.stepGeneInstances(dt);\r\n    this.stepEnergyUpkeep(dt);\r\n  }\r\n\r\n  private stepEnergyUpkeep(dt: number) {\r\n    this.energy -= this.energyUpkeep * dt;\r\n    if (this.energy <= 0) {\r\n      this.die();\r\n    }\r\n  }\r\n\r\n  private stepGeneInstances(dt: number) {\r\n    this.geneInstances.forEach((g) => step(g, dt));\r\n  }\r\n\r\n  private stepCellEffects(dt: number) {\r\n    // step all cell effects (e.g.freezing)\r\n    for (const effect of this.effects) {\r\n      effect.step(dt);\r\n    }\r\n  }\r\n\r\n  private stepCancer(dt: number) {\r\n    if (Math.random() < this.type.getChanceToBecomeCancerous() * dt) {\r\n      this.addEffect(new CancerEffect());\r\n    }\r\n  }\r\n\r\n  stepTemperature(dt: number) {\r\n    this.temperature = Temperature.Mild;\r\n    for (const neighbor of this.world.tileNeighbors(this.pos).array) {\r\n      if (!Cell.is(neighbor) && neighbor.temperature !== Temperature.Mild) {\r\n        this.temperature = neighbor.temperature;\r\n        break;\r\n      }\r\n    }\r\n    if (this.temperature === Temperature.Freezing) {\r\n      const chanceToFreeze = 0.01667 * dt; // on average, this cell freezes every day\r\n      if (Math.random() < chanceToFreeze) {\r\n        this.addEffect(new FreezeEffect());\r\n      }\r\n    } else if (this.temperature === Temperature.Scorching) {\r\n      const waterToLose = Math.min(this.inventory.water, 1);\r\n      const chanceEvaporate = waterToLose * 0.01667; // no average, lose 1 water per day\r\n      if (Math.random() < chanceEvaporate * dt) {\r\n        this.inventory.add(-waterToLose, 0);\r\n        this.world.logEvent({\r\n          type: \"evaporation\",\r\n          tile: this,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  stepDroop(dt: number) {\r\n    const tileNeighbors = this.world.tileNeighbors(this.pos);\r\n    const below = tileNeighbors.get(DIRECTIONS.s)!;\r\n    const belowLeft = tileNeighbors.get(DIRECTIONS.sw)!;\r\n    const belowRight = tileNeighbors.get(DIRECTIONS.se)!;\r\n    const left = tileNeighbors.get(DIRECTIONS.w)!;\r\n    const right = tileNeighbors.get(DIRECTIONS.e)!;\r\n    const above = tileNeighbors.get(DIRECTIONS.n)!;\r\n    const aboveLeft = tileNeighbors.get(DIRECTIONS.nw)!;\r\n    const aboveRight = tileNeighbors.get(DIRECTIONS.ne)!;\r\n    const droopAmount = CELL_DROOP;\r\n    this.droopY += droopAmount;\r\n    for (const tile of [below, belowLeft, belowRight]) {\r\n      if (tile.isStructuralSupport) {\r\n        this.droopY = Math.min(this.droopY, 0);\r\n        return;\r\n      } else if (Cell.is(tile)) {\r\n        this.droopY = Math.min(this.droopY, tile.droopY);\r\n        return;\r\n      }\r\n    }\r\n    const springNeighborCells = [aboveLeft, above, aboveRight, left, right, this].filter((n) => Cell.is(n)) as Cell[];\r\n    // TODO tighten springs scaled by dt\r\n    this.droopY = springNeighborCells.reduce((sum, n) => sum + n.droopY, 0) / springNeighborCells.length;\r\n\r\n    this.stepDroopPositionUpdate();\r\n  }\r\n\r\n  private stepDroopPositionUpdate() {\r\n    if (this.droopY > 0.5) {\r\n      if (this.pos.y < this.world.height - 1) {\r\n        // make the player ride the train!\r\n        if (this.world.player.pos.equals(this.pos)) {\r\n          this.world.player.posFloat.y += 1;\r\n        }\r\n        this.world.maybeRemoveCellAt(this.pos, false);\r\n        this.pos.y += 1;\r\n        this.droopY -= 1;\r\n        this.world.setTileAt(this.pos, this);\r\n      } else {\r\n        this.droopY = 0.5;\r\n      }\r\n    }\r\n  }\r\n\r\n  diffuseWater(giver: Tile, dt: number, diffusionRate = this.diffusionWater) {\r\n    // Diffusion equation by finite difference: the purpose of this equation is to eventually\r\n    // equalize the amount of water between me and giver. The two questions are how long\r\n    // does it take, and what function does it follow to get there? These are generally\r\n    // defined by the diffusionWater variable.\r\n    const difference = giver.inventory.water - this.inventory.water;\r\n    const isBreakingSurfaceTension = this.inventory.water > 0 || giver.inventory.water > 0.2;\r\n\r\n    if (difference > 0.01 && isBreakingSurfaceTension) {\r\n      // At high dt's this isn't accurate, but at these low numbers we can assume near linearity.\r\n      const diffusionAmount = Math.min(difference * diffusionRate * dt, difference / 2);\r\n      giver.inventory.give(this.inventory, diffusionAmount, 0);\r\n    }\r\n  }\r\n\r\n  stepDarkness() {\r\n    this.darkness = 0;\r\n  }\r\n\r\n  stepClosestCellDistance() {\r\n    this.closestCellAirDistance = 0;\r\n  }\r\n\r\n  public validateDirection() {\r\n    const isDirectional = this.properties.isDirectional;\r\n    if (isDirectional) {\r\n      const dir = this.args.direction!;\r\n      if (isFractional(dir.x) || isFractional(dir.y)) {\r\n        debugger;\r\n        console.error(\"build transport with fractional dir \" + dir.x + \", \" + dir.y);\r\n      }\r\n      if (dir.manhattanLength() < 1 || dir.manhattanLength() > 3) {\r\n        debugger;\r\n        console.error(\"bad dir length\", dir);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _isCell = true;\r\n\r\n  static is(t: any): t is Cell {\r\n    return t != null && t._isCell === true;\r\n  }\r\n}\r\n\r\nfunction isFractional(x: number) {\r\n  return x % 1 !== 0;\r\n}\r\n\r\nconst TEMPO_FROM_TEMPERATURE = {\r\n  [Temperature.Freezing]: 1 / 2,\r\n  [Temperature.Cold]: 2 / 3,\r\n  [Temperature.Mild]: 1,\r\n  [Temperature.Hot]: 1.25,\r\n  [Temperature.Scorching]: 1.5,\r\n};\r\n","import React from \"react\";\r\nimport Ticker from \"std/ticker\";\r\nimport { nf } from \"../../../common/formatters\";\r\n\r\nexport interface DynamicNumberProps {\r\n  value: number;\r\n  speed?: number;\r\n  sigFigs?: number;\r\n}\r\n\r\nfunction DynamicNumber({ value, speed = 0.5, sigFigs = 3 }: DynamicNumberProps) {\r\n  const [v, setV] = React.useState(value);\r\n\r\n  React.useEffect(() => {\r\n    function tickOnce() {\r\n      setV((v) => {\r\n        if (Math.abs(v - value) < 5e-3) {\r\n          Ticker.removeAnimation(id);\r\n          return value;\r\n        } else {\r\n          return v * (1 - speed) + value * speed;\r\n        }\r\n      });\r\n    }\r\n    tickOnce();\r\n\r\n    const id = Ticker.addAnimation(tickOnce);\r\n    return () => {\r\n      Ticker.removeAnimation(id);\r\n    };\r\n  }, [value, speed]);\r\n\r\n  return <>{nf(v, sigFigs)}</>;\r\n}\r\n\r\nexport default DynamicNumber;\r\n","import shuffle from \"math/shuffle\";\r\nimport { Vector2 } from \"three\";\r\nimport { clamp, randRound } from \"../../math/index\";\r\nimport { Steppable } from \"../entity\";\r\nimport { Inventory } from \"../inventory\";\r\nimport { Temperature } from \"../temperature\";\r\nimport { World } from \"../world/world\";\r\n\r\nexport abstract class Tile implements Steppable {\r\n  displayName = \"Tile\";\r\n\r\n  static fallAmount = 0;\r\n\r\n  public abstract get isObstacle(): boolean;\r\n\r\n  public darkness = Infinity;\r\n\r\n  public temperature: Temperature;\r\n\r\n  public isStructuralSupport = false;\r\n\r\n  public dtSinceLastStepped = 0;\r\n\r\n  public abstract inventory: Inventory;\r\n\r\n  public closestCellAirDistance: number = 1000;\r\n\r\n  // public lightIntersection?: Intersection;\r\n\r\n  get diffusionWater(): number {\r\n    return (this.constructor as any).diffusionWater;\r\n  }\r\n\r\n  get diffusionSugar(): number {\r\n    return (this.constructor as any).diffusionSugar;\r\n  }\r\n\r\n  get fallAmount(): number {\r\n    return (this.constructor as any).fallAmount;\r\n  }\r\n\r\n  get darknessContrib(): number {\r\n    const contrib = Math.max(\r\n      0.2\r\n      // map(this.pos.y, this.world.height / 2, this.world.height, params.soilDarknessBase, 1)\r\n    );\r\n    return contrib;\r\n  }\r\n\r\n  get cellAirDistanceContrib() {\r\n    return 1000;\r\n  }\r\n\r\n  public readonly timeMade: number;\r\n\r\n  public pos: Vector2;\r\n\r\n  public get age() {\r\n    return this.world.time - this.timeMade;\r\n  }\r\n\r\n  public constructor(pos: Vector2, public readonly world: World) {\r\n    this.pos = pos.clone();\r\n    if (world == null) {\r\n      throw new Error(\"null world!\");\r\n    }\r\n    this.timeMade = world.time;\r\n    this.temperature = this.world.weather.getCurrentTemperature();\r\n  }\r\n\r\n  abstract shouldStep(dt: number): boolean;\r\n\r\n  /**\r\n   * Can this Tile accept resources from the giver? Use this to define\r\n   * boundaries like \"Cells can give to each other but not to Soil\".\r\n   *\r\n   * By default, allow ancestor/child relationships to exchange resources\r\n   * with each other (e.g. Soil and Fountain).\r\n   */\r\n  canPullResources(giver: Tile): boolean {\r\n    const hasAncestry = this instanceof giver.constructor || giver instanceof this.constructor;\r\n    return hasAncestry;\r\n  }\r\n\r\n  /**\r\n   * 0 = full darkness\r\n   * 1 = full light\r\n   */\r\n  public lightAmount() {\r\n    return Math.sqrt(clamp(1 - this.darkness, 0, 1));\r\n  }\r\n\r\n  /**\r\n   * Redistribute this tile's inventory to nearby tiles if possible, usually\r\n   * in preparation for removing this tile.\r\n   */\r\n  public redistributeInventoryToNeighbors(water: number = this.inventory.water, sugar: number = this.inventory.sugar) {\r\n    water = clamp(water, 0, this.inventory.water);\r\n    sugar = clamp(sugar, 0, this.inventory.sugar);\r\n    if (water > 0 || sugar > 0) {\r\n      // push resources to nearby tiles\r\n      const neighbors = this.world.tileNeighbors(this.pos);\r\n      const giveCandidates = neighbors.array.filter((n) => n.canPullResources(this));\r\n      let guard = 0;\r\n      while ((water > 0 || sugar > 0) && giveCandidates.length > 0 && guard < 20) {\r\n        shuffle(giveCandidates);\r\n        for (let i = 0; i < giveCandidates.length; i++) {\r\n          const neighbor = giveCandidates[i];\r\n          // give (up to 1) to this neighbor\r\n          const { water: waterGiven, sugar: sugarGiven } = this.inventory.give(\r\n            neighbor.inventory,\r\n            clamp(water, 0, 1),\r\n            clamp(sugar, 0, 1)\r\n          );\r\n          water -= waterGiven;\r\n          sugar -= sugarGiven;\r\n          if (neighbor.inventory.isMaxed()) {\r\n            // delete this neighbor from candidates to give\r\n            giveCandidates.splice(i, 1);\r\n          }\r\n          if (water === 0 && sugar === 0) {\r\n            // we're all done\r\n            break;\r\n          }\r\n        }\r\n        guard++;\r\n      }\r\n      if (guard >= 100) {\r\n        console.error(\"redistributeInventoryToNeighbors passed guard limit\");\r\n      }\r\n    }\r\n  }\r\n\r\n  // test tiles diffusing water around on same-type tiles\r\n  public step(dt: number) {\r\n    this.stepDiffusion(dt);\r\n    this.stepTemperature(dt);\r\n    this.stepGravity(dt);\r\n  }\r\n\r\n  stepTemperature(_dt: number) {\r\n    this.temperature = this.world.weather.getCurrentTemperature();\r\n  }\r\n\r\n  /**\r\n   * Called by World.\r\n   */\r\n  stepDarkness() {\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    let minDarkness = this.darkness;\r\n    for (const t of neighbors.array) {\r\n      const darknessFromNeighbor = t.darkness + t.darknessContrib;\r\n      minDarkness = Math.min(minDarkness, darknessFromNeighbor);\r\n    }\r\n    this.darkness = minDarkness;\r\n  }\r\n\r\n  stepClosestCellDistance() {\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    let minDistance = this.closestCellAirDistance;\r\n    for (const [v, t] of neighbors) {\r\n      const neighborDistance = t.closestCellAirDistance + this.cellAirDistanceContrib * v.length();\r\n      minDistance = Math.min(minDistance, neighborDistance);\r\n    }\r\n    this.closestCellAirDistance = minDistance;\r\n  }\r\n\r\n  stepDiffusion(dt: number) {\r\n    for (const tile of this.world.tileNeighbors(this.pos).array) {\r\n      if (!this.canPullResources(tile)) {\r\n        continue;\r\n      }\r\n      // take water from neighbors that have more water than you\r\n      if (this.diffusionWater != null) {\r\n        if (tile.inventory.water > this.inventory.water) {\r\n          this.diffuseWater(tile, dt);\r\n        }\r\n      }\r\n      if (this.diffusionSugar != null) {\r\n        if (tile.inventory.sugar > this.inventory.sugar) {\r\n          this.diffuseSugar(tile, dt);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This cell gets water. Take water from the giver.\r\n   */\r\n  diffuseWater(giver: Tile, dt: number, diffusionRate = this.diffusionWater) {\r\n    // Diffusion equation by finite difference: the purpose of this equation is to eventually\r\n    // equalize the amount of water between me and giver. The two questions are how long\r\n    // does it take, and what function does it follow to get there? These are generally\r\n    // defined by the diffusionWater variable.\r\n    const difference = giver.inventory.water - this.inventory.water;\r\n\r\n    // Make it harder for water to break into a dry tile. Emulates surface tension at the\r\n    // wet/dry border.\r\n    const isBreakingSurfaceTension = this.inventory.water > 0 || giver.inventory.water > 1;\r\n\r\n    if (difference > 0.01 && isBreakingSurfaceTension) {\r\n      // At high dt's this isn't accurate, but at these low numbers we can assume near linearity.\r\n      const diffusionAmount = Math.min(difference * diffusionRate * dt, difference / 2);\r\n      giver.inventory.give(this.inventory, diffusionAmount, 0);\r\n    }\r\n  }\r\n\r\n  diffuseSugar(giver: Tile, dt: number, diffusionRate = this.diffusionSugar) {\r\n    const difference = giver.inventory.sugar - this.inventory.sugar;\r\n    // if (difference > 0.1) {\r\n    const diffusionAmount = Math.min(difference * diffusionRate * dt, difference / 2);\r\n    if (randRound(diffusionAmount) > 0) {\r\n      giver.inventory.give(this.inventory, 0, difference / 2);\r\n    }\r\n    // }\r\n  }\r\n\r\n  /**\r\n   * Give to your lower neighbor.\r\n   */\r\n  stepGravity(dt: number) {\r\n    const fallAmount = this.fallAmount * dt;\r\n    const lowerNeighbor = this.world.tileAt(this.pos.x, this.pos.y + 1);\r\n    if (fallAmount > 0 && lowerNeighbor != null && lowerNeighbor.canPullResources(this)) {\r\n      this.inventory.give(lowerNeighbor.inventory, randRound(fallAmount), 0);\r\n    }\r\n  }\r\n\r\n  toString() {\r\n    return this.displayName + \"(\" + this.pos.x + \",\" + this.pos.y + \")\";\r\n  }\r\n}\r\n","import { nf } from \"common/formatters\";\r\nimport MP from \"game/ui/common/MP\";\r\nimport { clamp } from \"math\";\r\nimport React from \"react\";\r\nimport { Cell } from \"../../core/cell/cell\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport { GeneInstance } from \"../../core/cell/geneInstance\";\r\n\r\nexport interface ReproducerState {\r\n  timeMatured?: number;\r\n  isMature: boolean;\r\n  energyRecieved: number;\r\n}\r\n\r\nexport const GeneFruit = Gene.make<ReproducerState>(\r\n  {\r\n    name: \"Fruit\",\r\n    levelCosts: [10, 15, 20, 25, 30],\r\n    levelProps: {\r\n      mpEarned: [3, 4, 5, 6, 7],\r\n      neededEnergy: 500,\r\n    },\r\n    static: {\r\n      isReproductive: true,\r\n      // TODO fix this to be a \"set to 0\"\r\n      timeToBuild: -1,\r\n    },\r\n    description: reproducerDescription,\r\n  },\r\n  () => ({\r\n    isMature: false,\r\n    energyRecieved: 0,\r\n  }),\r\n  (dt, instance) => {\r\n    reproducerStep(dt, instance);\r\n  }\r\n);\r\n\r\nexport type GeneFruit = typeof GeneFruit;\r\n\r\nexport const GeneSeed = Gene.make<ReproducerState>(\r\n  {\r\n    name: \"Seed\",\r\n    levelCosts: [3, 4, 5, 6, 8],\r\n    levelProps: {\r\n      mpEarned: [1, 1.25, 1.5, 1.75, 2],\r\n      neededEnergy: 250,\r\n    },\r\n    static: {\r\n      isReproductive: true,\r\n      timeToBuild: -1,\r\n    },\r\n    description: reproducerDescription,\r\n  },\r\n  () => ({\r\n    isMature: false,\r\n    energyRecieved: 0,\r\n  }),\r\n  (dt, instance) => {\r\n    reproducerStep(dt, instance);\r\n  }\r\n);\r\n\r\nexport type GeneSeed = typeof GeneSeed;\r\n\r\nconst ENERGY_TRANSFER_PER_SECOND = 0.25;\r\nconst NEIGHBOR_ENERGY_THRESHOLD = 0.5;\r\n\r\nfunction reproducerDescription({ mpEarned, neededEnergy }: Record<string, number>) {\r\n  return (\r\n    <>\r\n      <p>Absorbs {neededEnergy} energy from neighbors to mature.</p>\r\n      <p>\r\n        Each neighboring Cell contributes 1 energy every <b>{nf(1 / ENERGY_TRANSFER_PER_SECOND, 1)}</b> seconds.\r\n      </p>\r\n      <p>\r\n        On maturation,{\" \"}\r\n        <b>\r\n          achieve <span className=\"reproduction\">Survival</span>\r\n        </b>{\" \"}\r\n        and earn <MP amount={mpEarned} />.\r\n      </p>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction reproducerStep(dt: number, instance: GeneInstance<Gene<ReproducerState, string>>) {\r\n  const {\r\n    cell,\r\n    state,\r\n    props: { mpEarned, neededEnergy },\r\n  } = instance;\r\n  const { isMature } = state;\r\n  if (!isMature) {\r\n    commitEnergy(dt, cell, state, neededEnergy);\r\n    const isNowMature = reproducerGetPercentMatured(instance) >= 1;\r\n    if (isNowMature) {\r\n      state.isMature = isNowMature;\r\n      state.timeMatured = cell.world.time;\r\n      instance.earnMP(cell, mpEarned);\r\n    }\r\n    // give energy to the cell itself if it's going to die\r\n    if (cell.energy < 0.5) {\r\n      const energyToGive = clamp(clamp(0.5 - cell.energy, 0, ENERGY_TRANSFER_PER_SECOND * dt), 0, state.energyRecieved);\r\n      state.energyRecieved -= energyToGive;\r\n      cell.energy += energyToGive;\r\n    }\r\n  }\r\n}\r\n\r\nfunction commitEnergy(dt: number, seed: Cell, state: ReproducerState, neededEnergy: number) {\r\n  let energyLeftToTake = neededEnergy - state.energyRecieved;\r\n  let energyRecieved = 0;\r\n  const tileNeighbors = seed.world.tileNeighbors(seed.pos);\r\n  for (const neighbor of tileNeighbors.array) {\r\n    if (!Cell.is(neighbor)) continue;\r\n\r\n    if (neighbor.energy > NEIGHBOR_ENERGY_THRESHOLD && energyLeftToTake > 0 && !neighbor.isReproductive) {\r\n      const energyToTake = clamp(neighbor.energy, 0, ENERGY_TRANSFER_PER_SECOND * dt);\r\n      state.energyRecieved += energyToTake;\r\n      neighbor.energy -= energyToTake;\r\n\r\n      energyLeftToTake -= energyToTake;\r\n      energyRecieved += energyToTake;\r\n\r\n      seed.world.logEvent({ type: \"cell-transfer-energy\", from: neighbor, to: seed, amount: energyToTake });\r\n    }\r\n  }\r\n\r\n  if (energyRecieved > 0) {\r\n    seed.world.logEvent({\r\n      type: \"grow-fruit\",\r\n      cell: seed,\r\n      resourcesUsed: energyRecieved * 20,\r\n    });\r\n  }\r\n}\r\n\r\nexport function reproducerGetPercentMatured(g: GeneInstance<Gene<ReproducerState, any>>) {\r\n  const { energyRecieved } = g.state;\r\n  const neededEnergy = g.props.neededEnergy;\r\n  return energyRecieved / (neededEnergy - 1e-12);\r\n}\r\n","import classNames from \"classnames\";\r\nimport React from \"react\";\r\nimport { GiDna1 } from \"react-icons/gi\";\r\nimport DynamicNumber from \"./DynamicNumber\";\r\nimport \"./MP.scss\";\r\n\r\nexport type MPProps = JSX.IntrinsicElements[\"div\"] & {\r\n  amount: number;\r\n  total?: number;\r\n};\r\n\r\nfunction MP({ amount, total, ...props }: MPProps) {\r\n  return (\r\n    <span {...props} className={classNames(\"mp\", props.className)}>\r\n      <DynamicNumber speed={0.5} sigFigs={5} value={amount} />\r\n      {total != null ? <>/{total}</> : null}\r\n      <GiDna1 className=\"mp-icon\" />\r\n    </span>\r\n  );\r\n}\r\n\r\nexport default MP;\r\n","import { Player } from \"core\";\r\nimport { ActionRemoveCancer, ActionThaw } from \"core/player/action\";\r\nimport { Constructor } from \"../../typings/constructor\";\r\nimport { TIME_PER_DAY } from \"../constants\";\r\nimport { StopStep } from \"../entity\";\r\nimport { Interactable } from \"../interactable\";\r\nimport { Temperature } from \"../temperature\";\r\nimport { Cell } from \"./cell\";\r\nexport abstract class CellEffect {\r\n  private timeMade!: number;\r\n\r\n  public cell!: Cell;\r\n\r\n  get age() {\r\n    return this.cell.world.time - this.timeMade;\r\n  }\r\n\r\n  attachTo(cell: Cell) {\r\n    this.cell = cell;\r\n    this.timeMade = this.cell.world.time;\r\n    this.onAttached();\r\n  }\r\n\r\n  onAttached() {}\r\n\r\n  /**\r\n   * Return whether to step the next behavior in the chain\r\n   */\r\n  abstract step(dt: number): void;\r\n\r\n  remove() {\r\n    const index = this.cell.effects.indexOf(this);\r\n    this.cell.effects.splice(index, 1);\r\n  }\r\n}\r\n\r\nexport interface CellEffectConstructor extends Constructor<CellEffect> {\r\n  displayName: string;\r\n  stacks?: boolean;\r\n}\r\nexport class FreezeEffect extends CellEffect implements Interactable {\r\n  static displayName = \"Frozen\";\r\n\r\n  static stacks = false;\r\n\r\n  public readonly secondsToDie = TIME_PER_DAY;\r\n\r\n  public percentFrozen = 0.25;\r\n\r\n  chunkCooldown = 0;\r\n\r\n  get timeUntilDeath() {\r\n    return this.secondsToDie - this.age;\r\n  }\r\n\r\n  interact(source: Player): ActionThaw {\r\n    return {\r\n      type: \"thaw\",\r\n      target: this,\r\n      continuous: true,\r\n    };\r\n  }\r\n\r\n  thaw(_dt: number) {\r\n    if (this.chunkCooldown <= 0) {\r\n      this.chunkCooldown += 0.5;\r\n      this.percentFrozen -= (15 / this.secondsToDie) * 0.5;\r\n      if (this.percentFrozen < 0.02) {\r\n        this.percentFrozen = 0;\r\n      }\r\n      this.cell.world.logEvent({\r\n        type: \"thaw\",\r\n        where: this.cell,\r\n      });\r\n    }\r\n    // this.percentFrozen -= (20 / this.secondsToDie) * dt;\r\n    this.onFrozenChanged();\r\n  }\r\n\r\n  step(dt: number) {\r\n    if (this.chunkCooldown > 0) {\r\n      this.chunkCooldown -= dt;\r\n    }\r\n    if (this.cell.temperature === Temperature.Cold) {\r\n      this.percentFrozen += (1 / this.secondsToDie) * dt;\r\n    } else if (this.cell.temperature === Temperature.Freezing) {\r\n      this.percentFrozen += (10 / this.secondsToDie) * dt;\r\n    } else {\r\n      // this.percentFrozen -= (10 / this.secondsToDie) * dt;\r\n    }\r\n    this.onFrozenChanged();\r\n    this.cell.energy -= dt / this.secondsToDie;\r\n    throw new StopStep();\r\n  }\r\n\r\n  onAttached() {\r\n    this.cell.energy -= 0.2;\r\n  }\r\n\r\n  onFrozenChanged() {\r\n    if (this.percentFrozen > 1) {\r\n      this.cell.die();\r\n    } else if (this.percentFrozen <= 0) {\r\n      this.remove();\r\n    }\r\n  }\r\n}\r\n\r\nexport class CancerEffect extends CellEffect implements Interactable {\r\n  static displayName = \"Cancerous\";\r\n\r\n  static stacks = false;\r\n\r\n  public secondsPerDuplication = 12;\r\n\r\n  public timeToDuplicate = this.secondsPerDuplication;\r\n\r\n  interact(source: Player): ActionRemoveCancer {\r\n    return {\r\n      type: \"remove-cancer\",\r\n      target: this,\r\n      continuous: true,\r\n    };\r\n  }\r\n\r\n  removeCancer(dt: number) {\r\n    this.timeToDuplicate += 4 * dt;\r\n    if (this.timeToDuplicate > this.secondsPerDuplication * 1.05) {\r\n      this.remove();\r\n    }\r\n  }\r\n\r\n  step(dt: number): void {\r\n    // eat 20% energy per day\r\n    this.cell.energy -= (1 / 300) * dt;\r\n    this.timeToDuplicate -= dt;\r\n    if (this.timeToDuplicate < 0) {\r\n      const world = this.cell.world;\r\n      const neighbors = world.tileNeighbors(this.cell.pos);\r\n\r\n      // spread to one neighbor:\r\n      // if that neighbor is a cell without cancer, add cancer to that neighbor\r\n      // if that neighbor is empty, duplicate this cell onto that neighbor\r\n      for (const tile of neighbors.array) {\r\n        if (Cell.is(tile) && !tile.findEffectOfType(CancerEffect)) {\r\n          tile.addEffect(new CancerEffect());\r\n          break;\r\n        } else if (tile.world.player.canBuildAt(tile)) {\r\n          // const cell = new Cell(tile.pos, world, this.cell.type, this.cell.args);\r\n\r\n          const newCell = new Cell(tile.pos, tile.world, this.cell.type, this.cell.args);\r\n          // half this cell's energy, and give it to the new cell\r\n          this.cell.energy /= 2;\r\n          newCell.energy = this.cell.energy;\r\n          newCell.droopY = this.cell.droopY;\r\n          tile.world.setTileAt(newCell.pos, newCell);\r\n          break;\r\n        }\r\n      }\r\n      this.timeToDuplicate += this.secondsPerDuplication;\r\n    }\r\n  }\r\n}\r\n","export default function shuffle<T>(array: T[]) {\r\n  let currentIndex = array.length,\r\n    temporaryValue,\r\n    randomIndex;\r\n  // While there remain elements to shuffle...\r\n  while (0 !== currentIndex) {\r\n    // Pick a remaining element...\r\n    randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex -= 1;\r\n    // And swap it with the current element.\r\n    temporaryValue = array[currentIndex];\r\n    array[currentIndex] = array[randomIndex];\r\n    array[randomIndex] = temporaryValue;\r\n  }\r\n  return array;\r\n}\r\n","// LICENSE: https://github.com/josephg/noisejs/blob/master/LICENSE\r\n\r\n// copy-pasted from https://raw.githubusercontent.com/josephg/noisejs/master/perlin.js\r\n// tslint:disable\r\n\r\n/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nclass Grad {\r\n  constructor(public x: number, public y: number, public z: number) {}\r\n\r\n  dot2(x: number, y: number) {\r\n    return this.x * x + this.y * y;\r\n  }\r\n\r\n  dot3(x: number, y: number, z: number) {\r\n    return this.x * x + this.y * y + this.z * z;\r\n  }\r\n}\r\n\r\nconst grad3 = [\r\n  new Grad(1, 1, 0),\r\n  new Grad(-1, 1, 0),\r\n  new Grad(1, -1, 0),\r\n  new Grad(-1, -1, 0),\r\n  new Grad(1, 0, 1),\r\n  new Grad(-1, 0, 1),\r\n  new Grad(1, 0, -1),\r\n  new Grad(-1, 0, -1),\r\n  new Grad(0, 1, 1),\r\n  new Grad(0, -1, 1),\r\n  new Grad(0, 1, -1),\r\n  new Grad(0, -1, -1),\r\n];\r\n\r\nconst p = [\r\n  151,\r\n  160,\r\n  137,\r\n  91,\r\n  90,\r\n  15,\r\n  131,\r\n  13,\r\n  201,\r\n  95,\r\n  96,\r\n  53,\r\n  194,\r\n  233,\r\n  7,\r\n  225,\r\n  140,\r\n  36,\r\n  103,\r\n  30,\r\n  69,\r\n  142,\r\n  8,\r\n  99,\r\n  37,\r\n  240,\r\n  21,\r\n  10,\r\n  23,\r\n  190,\r\n  6,\r\n  148,\r\n  247,\r\n  120,\r\n  234,\r\n  75,\r\n  0,\r\n  26,\r\n  197,\r\n  62,\r\n  94,\r\n  252,\r\n  219,\r\n  203,\r\n  117,\r\n  35,\r\n  11,\r\n  32,\r\n  57,\r\n  177,\r\n  33,\r\n  88,\r\n  237,\r\n  149,\r\n  56,\r\n  87,\r\n  174,\r\n  20,\r\n  125,\r\n  136,\r\n  171,\r\n  168,\r\n  68,\r\n  175,\r\n  74,\r\n  165,\r\n  71,\r\n  134,\r\n  139,\r\n  48,\r\n  27,\r\n  166,\r\n  77,\r\n  146,\r\n  158,\r\n  231,\r\n  83,\r\n  111,\r\n  229,\r\n  122,\r\n  60,\r\n  211,\r\n  133,\r\n  230,\r\n  220,\r\n  105,\r\n  92,\r\n  41,\r\n  55,\r\n  46,\r\n  245,\r\n  40,\r\n  244,\r\n  102,\r\n  143,\r\n  54,\r\n  65,\r\n  25,\r\n  63,\r\n  161,\r\n  1,\r\n  216,\r\n  80,\r\n  73,\r\n  209,\r\n  76,\r\n  132,\r\n  187,\r\n  208,\r\n  89,\r\n  18,\r\n  169,\r\n  200,\r\n  196,\r\n  135,\r\n  130,\r\n  116,\r\n  188,\r\n  159,\r\n  86,\r\n  164,\r\n  100,\r\n  109,\r\n  198,\r\n  173,\r\n  186,\r\n  3,\r\n  64,\r\n  52,\r\n  217,\r\n  226,\r\n  250,\r\n  124,\r\n  123,\r\n  5,\r\n  202,\r\n  38,\r\n  147,\r\n  118,\r\n  126,\r\n  255,\r\n  82,\r\n  85,\r\n  212,\r\n  207,\r\n  206,\r\n  59,\r\n  227,\r\n  47,\r\n  16,\r\n  58,\r\n  17,\r\n  182,\r\n  189,\r\n  28,\r\n  42,\r\n  223,\r\n  183,\r\n  170,\r\n  213,\r\n  119,\r\n  248,\r\n  152,\r\n  2,\r\n  44,\r\n  154,\r\n  163,\r\n  70,\r\n  221,\r\n  153,\r\n  101,\r\n  155,\r\n  167,\r\n  43,\r\n  172,\r\n  9,\r\n  129,\r\n  22,\r\n  39,\r\n  253,\r\n  19,\r\n  98,\r\n  108,\r\n  110,\r\n  79,\r\n  113,\r\n  224,\r\n  232,\r\n  178,\r\n  185,\r\n  112,\r\n  104,\r\n  218,\r\n  246,\r\n  97,\r\n  228,\r\n  251,\r\n  34,\r\n  242,\r\n  193,\r\n  238,\r\n  210,\r\n  144,\r\n  12,\r\n  191,\r\n  179,\r\n  162,\r\n  241,\r\n  81,\r\n  51,\r\n  145,\r\n  235,\r\n  249,\r\n  14,\r\n  239,\r\n  107,\r\n  49,\r\n  192,\r\n  214,\r\n  31,\r\n  181,\r\n  199,\r\n  106,\r\n  157,\r\n  184,\r\n  84,\r\n  204,\r\n  176,\r\n  115,\r\n  121,\r\n  50,\r\n  45,\r\n  127,\r\n  4,\r\n  150,\r\n  254,\r\n  138,\r\n  236,\r\n  205,\r\n  93,\r\n  222,\r\n  114,\r\n  67,\r\n  29,\r\n  24,\r\n  72,\r\n  243,\r\n  141,\r\n  128,\r\n  195,\r\n  78,\r\n  66,\r\n  215,\r\n  61,\r\n  156,\r\n  180,\r\n];\r\n\r\n/*\r\nfor(const i=0; i<256; i++) {\r\nperm[i] = perm[i + 256] = p[i];\r\ngradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nconst F2 = 0.5 * (Math.sqrt(3) - 1);\r\nconst G2 = (3 - Math.sqrt(3)) / 6;\r\n\r\nconst F3 = 1 / 3;\r\nconst G3 = 1 / 6;\r\n\r\nexport class Noise {\r\n  // To remove the need for index wrapping, double the permutation table length\r\n  public perm = new Array(512);\r\n\r\n  public gradP = new Array(512);\r\n\r\n  public octaveNum = 6;\r\n\r\n  public octaveFalloff = 0.5;\r\n\r\n  // rotate by 1 radians (~57 deg), scale by 2\r\n  public octaveMatrix2 = [Math.cos(1) * 2, -Math.sin(1) * 2, Math.sin(1) * 2, Math.cos(1) * 2];\r\n\r\n  // This isn't a very good seeding function, but it works ok. It supports 2^16\r\n  // different seed values. Write something better if you need more seeds.\r\n  public seed(seed: number) {\r\n    if (seed > 0 && seed < 1) {\r\n      // Scale the seed out\r\n      seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n      seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n      let v;\r\n      if (i & 1) {\r\n        v = p[i] ^ (seed & 255);\r\n      } else {\r\n        v = p[i] ^ ((seed >> 8) & 255);\r\n      }\r\n\r\n      this.perm[i] = this.perm[i + 256] = v;\r\n      this.gradP[i] = this.gradP[i + 256] = grad3[v % 12];\r\n    }\r\n  }\r\n\r\n  constructor(seed: number = Math.random() * 2147483647) {\r\n    this.seed(seed);\r\n  }\r\n\r\n  // 2D simplex noise; outputs a number from [-1, 1]\r\n  public simplex2(xin: number, yin: number) {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin + yin) * F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin + s);\r\n    let j = Math.floor(yin + s);\r\n    const t = (i + j) * G2;\r\n    let x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin - j + t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0 > y0) {\r\n      // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n      i1 = 1;\r\n      j1 = 0;\r\n    } else {\r\n      // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n      i1 = 0;\r\n      j1 = 1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    const y1 = y0 - j1 + G2;\r\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    const y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    const gi0 = this.gradP[i + this.perm[j]];\r\n    const gi1 = this.gradP[i + i1 + this.perm[j + j1]];\r\n    const gi2 = this.gradP[i + 1 + this.perm[j + 1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\r\n    if (t0 < 0) {\r\n      n0 = 0;\r\n    } else {\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * gi0.dot2(x0, y0); // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\r\n    if (t1 < 0) {\r\n      n1 = 0;\r\n    } else {\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\r\n    if (t2 < 0) {\r\n      n2 = 0;\r\n    } else {\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n  }\r\n\r\n  public octaveSimplex2(xin: number, yin: number, octaveNum = this.octaveNum, octaveFalloff = this.octaveFalloff) {\r\n    let sum = 0;\r\n    let x = xin;\r\n    let y = yin;\r\n    let scalar = 1;\r\n    for (let i = 0; i < octaveNum; i++) {\r\n      sum += this.simplex2(x, y) * scalar;\r\n      const newX = x * this.octaveMatrix2[0] + y * this.octaveMatrix2[1];\r\n      const newY = x * this.octaveMatrix2[2] + y * this.octaveMatrix2[3];\r\n      x = newX;\r\n      y = newY;\r\n      scalar *= octaveFalloff;\r\n    }\r\n    return sum;\r\n  }\r\n\r\n  // 3D simplex noise\r\n  public simplex3(xin: number, yin: number, zin: number) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin + yin + zin) * F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin + s);\r\n    let j = Math.floor(yin + s);\r\n    let k = Math.floor(zin + s);\r\n\r\n    const t = (i + j + k) * G3;\r\n    const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\r\n    const y0 = yin - j + t;\r\n    const z0 = zin - k + t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n      if (y0 >= z0) {\r\n        i1 = 1;\r\n        j1 = 0;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 1;\r\n        k2 = 0;\r\n      } else if (x0 >= z0) {\r\n        i1 = 1;\r\n        j1 = 0;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 0;\r\n        k2 = 1;\r\n      } else {\r\n        i1 = 0;\r\n        j1 = 0;\r\n        k1 = 1;\r\n        i2 = 1;\r\n        j2 = 0;\r\n        k2 = 1;\r\n      }\r\n    } else {\r\n      if (y0 < z0) {\r\n        i1 = 0;\r\n        j1 = 0;\r\n        k1 = 1;\r\n        i2 = 0;\r\n        j2 = 1;\r\n        k2 = 1;\r\n      } else if (x0 < z0) {\r\n        i1 = 0;\r\n        j1 = 1;\r\n        k1 = 0;\r\n        i2 = 0;\r\n        j2 = 1;\r\n        k2 = 1;\r\n      } else {\r\n        i1 = 0;\r\n        j1 = 1;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 1;\r\n        k2 = 0;\r\n      }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    const x1 = x0 - i1 + G3; // Offsets for second corner\r\n    const y1 = y0 - j1 + G3;\r\n    const z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    const { gradP, perm } = this;\r\n    let gi0 = gradP[i + perm[j + perm[k]]];\r\n    let gi1 = gradP[i + i1 + perm[j + j1 + perm[k + k1]]];\r\n    let gi2 = gradP[i + i2 + perm[j + j2 + perm[k + k2]]];\r\n    let gi3 = gradP[i + 1 + perm[j + 1 + perm[k + 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\r\n    if (t0 < 0) {\r\n      n0 = 0;\r\n    } else {\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * gi0.dot3(x0, y0, z0); // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\r\n    if (t1 < 0) {\r\n      n1 = 0;\r\n    } else {\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\r\n    if (t2 < 0) {\r\n      n2 = 0;\r\n    } else {\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\r\n    if (t3 < 0) {\r\n      n3 = 0;\r\n    } else {\r\n      t3 *= t3;\r\n      n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n  }\r\n\r\n  public octaveSimplex3(\r\n    xin: number,\r\n    yin: number,\r\n    zin: number,\r\n    octaveNum = this.octaveNum,\r\n    octaveFalloff = this.octaveFalloff\r\n  ) {\r\n    let sum = 0;\r\n    let x = xin;\r\n    let y = yin;\r\n    let z = zin;\r\n    let scalar = 1;\r\n    for (let i = 0; i < octaveNum; i++) {\r\n      sum += this.simplex3(x, y, z) * scalar;\r\n      x *= 2;\r\n      y *= 2;\r\n      z *= 2;\r\n      scalar *= octaveFalloff;\r\n    }\r\n    return sum;\r\n  }\r\n\r\n  // ##### Perlin noise stuff\r\n\r\n  public fade(t: number) {\r\n    return t * t * t * (t * (t * 6 - 15) + 10);\r\n  }\r\n\r\n  public lerp(a: number, b: number, t: number) {\r\n    return (1 - t) * a + t * b;\r\n  }\r\n\r\n  // 2D Perlin Noise\r\n  /**\r\n   * Output range [-0.5, 0.5]\r\n   */\r\n  public perlin2(x: number, y: number) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x),\r\n      Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X;\r\n    y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255;\r\n    Y = Y & 255;\r\n\r\n    const { gradP, perm } = this;\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X + perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X + perm[Y + 1]].dot2(x, y - 1);\r\n    let n10 = gradP[X + 1 + perm[Y]].dot2(x - 1, y);\r\n    let n11 = gradP[X + 1 + perm[Y + 1]].dot2(x - 1, y - 1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = this.fade(x);\r\n\r\n    // Interpolate the four results\r\n    return this.lerp(this.lerp(n00, n10, u), this.lerp(n01, n11, u), this.fade(y));\r\n  }\r\n\r\n  // 3D Perlin Noise\r\n  public perlin3(x: number, y: number, z: number) {\r\n    const { gradP, perm } = this;\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x),\r\n      Y = Math.floor(y),\r\n      Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X;\r\n    y = y - Y;\r\n    z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255;\r\n    Y = Y & 255;\r\n    Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X + perm[Y + perm[Z]]].dot3(x, y, z);\r\n    let n001 = gradP[X + perm[Y + perm[Z + 1]]].dot3(x, y, z - 1);\r\n    let n010 = gradP[X + perm[Y + 1 + perm[Z]]].dot3(x, y - 1, z);\r\n    let n011 = gradP[X + perm[Y + 1 + perm[Z + 1]]].dot3(x, y - 1, z - 1);\r\n    let n100 = gradP[X + 1 + perm[Y + perm[Z]]].dot3(x - 1, y, z);\r\n    let n101 = gradP[X + 1 + perm[Y + perm[Z + 1]]].dot3(x - 1, y, z - 1);\r\n    let n110 = gradP[X + 1 + perm[Y + 1 + perm[Z]]].dot3(x - 1, y - 1, z);\r\n    let n111 = gradP[X + 1 + perm[Y + 1 + perm[Z + 1]]].dot3(x - 1, y - 1, z - 1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = this.fade(x);\r\n    let v = this.fade(y);\r\n    let w = this.fade(z);\r\n\r\n    // Interpolate\r\n    return this.lerp(\r\n      this.lerp(this.lerp(n000, n100, u), this.lerp(n001, n101, u), w),\r\n      this.lerp(this.lerp(n010, n110, u), this.lerp(n011, n111, u), w),\r\n      v\r\n    );\r\n  }\r\n}\r\n\r\n(window as any).Noise = Noise;\r\n","import { Insect } from \"./insect\";\r\nimport { Player } from \"./player/player\";\r\nimport { PlayerSeed } from \"./player/playerSeed\";\r\nimport { Tile } from \"./tile\";\r\n\r\nexport type Entity = Tile | Player | PlayerSeed | Insect;\r\n\r\nexport interface Steppable {\r\n  dtSinceLastStepped: number;\r\n  shouldStep(dt: number): boolean;\r\n  step(dt: number): void;\r\n}\r\n\r\nexport class StopStep extends Error {}\r\n\r\nexport function isSteppable(obj: any): obj is Steppable {\r\n  return typeof obj.step === \"function\";\r\n}\r\n\r\nexport function step(s: Steppable, dt: number) {\r\n  const sDt = s.dtSinceLastStepped + dt;\r\n  if (s.shouldStep(sDt)) {\r\n    try {\r\n      s.step(sDt);\r\n    } catch (e) {\r\n      if (e instanceof StopStep) {\r\n        // no-op for exiting early\r\n      } else {\r\n        console.error(e);\r\n        // catch error but don't crash game\r\n      }\r\n    } finally {\r\n      s.dtSinceLastStepped = 0;\r\n    }\r\n  } else {\r\n    s.dtSinceLastStepped = sDt;\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nexport const GeneObstacle = Gene.make(\r\n  {\r\n    name: \"Obstacle\",\r\n    levelCosts: [-3],\r\n    levelProps: {},\r\n    static: {\r\n      isObstacle: true,\r\n    },\r\n    description: () => <>You may not walk on or build off of this Cell.</>,\r\n  },\r\n  {},\r\n  () => {}\r\n);\r\nexport type GeneObstacle = typeof GeneObstacle;\r\n","import { Interactable } from \"core/interactable\";\r\nimport { Action } from \"core/player/action\";\r\nimport { Vector2 } from \"three\";\r\nimport { Noise } from \"../../common/perlin\";\r\nimport { clamp, map } from \"../../math/index\";\r\nimport { Inventory } from \"../inventory\";\r\nimport { World } from \"../world/world\";\r\nimport { Tile } from \"./tile\";\r\n\r\nexport class Air extends Tile implements Interactable {\r\n  displayName = \"Air\";\r\n\r\n  static fallAmount = 30;\r\n\r\n  static diffusionWater = 1.5;\r\n\r\n  public sunlightCached: number = 1;\r\n\r\n  public _co2: number;\r\n\r\n  public inventory = new Inventory(20, this);\r\n\r\n  get cellAirDistanceContrib() {\r\n    return 1;\r\n  }\r\n\r\n  isObstacle = false;\r\n\r\n  public constructor(public pos: Vector2, world: World) {\r\n    super(pos, world);\r\n    this.darkness = 0;\r\n    this._co2 = this.computeCo2();\r\n  }\r\n\r\n  interact(): Action {\r\n    return {\r\n      type: \"pickup\",\r\n      water: 1,\r\n      sugar: 1,\r\n      target: this,\r\n      continuous: true,\r\n    };\r\n  }\r\n\r\n  // Careful - this affects gravity speed\r\n  shouldStep(dt: number) {\r\n    // if (!this.inventory.isEmpty()) {\r\n    return dt > 0.06667;\r\n    // } else {\r\n    //   return super.shouldStep(dt);\r\n    // }\r\n  }\r\n\r\n  private computeCo2() {\r\n    const base = map(this.pos.y, this.world.height / 2, 0, this.world.environment.floorCo2, 1.15);\r\n    const scaleX = Math.max(1, map(this.pos.y, this.world.height / 2, 0, 20, 45));\r\n    const time = this.world == null ? 0 : this.world.time;\r\n    const offset =\r\n      (noiseCo2.perlin3(\r\n        94.231 + (this.pos.x - this.world.width / 2) / scaleX,\r\n        2312 + this.pos.y / 6,\r\n        time / 50 + 93.1\r\n      ) -\r\n        0.5) *\r\n      0.125;\r\n    return clamp(base + offset, 0.25, 1);\r\n  }\r\n\r\n  public lightAmount() {\r\n    return this.sunlight();\r\n  }\r\n\r\n  step(dt: number) {\r\n    // we do NOT call super, to avoid stepping darkness and diffusion.\r\n\r\n    if (this.inventory.water > 0) {\r\n      this.stepGravity(dt);\r\n      const tileBelow = this.world.tileAt(this.pos.x, this.pos.y + 1);\r\n      if (!Air.is(tileBelow)) {\r\n        this.stepDiffusionCheap(dt);\r\n      }\r\n      this.stepEvaporation(dt);\r\n    }\r\n\r\n    this.stepTemperature(dt);\r\n    this._co2 = this.computeCo2();\r\n  }\r\n\r\n  stepDiffusionCheap(dt: number) {\r\n    // only take water from left and right\r\n    const left = this.world.tileAt(this.pos.x - 1, this.pos.y);\r\n    const right = this.world.tileAt(this.pos.x + 1, this.pos.y);\r\n    // randomize order to remove directional bias\r\n    if (Math.random() < 0.5) {\r\n      this.tryDiffuse(left, dt);\r\n      this.tryDiffuse(right, dt);\r\n    } else {\r\n      this.tryDiffuse(right, dt);\r\n      this.tryDiffuse(left, dt);\r\n    }\r\n  }\r\n\r\n  tryDiffuse(t: Tile | null, dt: number) {\r\n    if (t != null && t.canPullResources(this)) {\r\n      if (t.inventory.water < this.inventory.water) {\r\n        t.diffuseWater(this, dt);\r\n        // this.diffuseWater(t, dt);\r\n      }\r\n    }\r\n  }\r\n\r\n  stepEvaporation(dt: number) {\r\n    if (Math.random() < this.world.environment.airEvaporation * this.inventory.water * dt) {\r\n      this.world.numEvaporatedAir += 1;\r\n      this.inventory.add(-1, 0);\r\n      this.world.logEvent({ type: \"evaporation\", tile: this });\r\n    }\r\n  }\r\n\r\n  public co2() {\r\n    return this._co2;\r\n  }\r\n\r\n  public sunlight() {\r\n    return this.sunlightCached;\r\n  }\r\n\r\n  private _isAir = true;\r\n\r\n  static is(t: any): t is Air {\r\n    return t != null && t._isAir === true;\r\n  }\r\n}\r\n\r\nconst noiseCo2 = new Noise();\r\n","export default function mapRecord<O, R>(obj: O, fn: (val: O[keyof O], key: keyof O) => R): Record<keyof O, R> {\r\n  const out = {} as Record<keyof O, R>;\r\n  let key: keyof O;\r\n  for (key in obj) {\r\n    const val = obj[key];\r\n    out[key] = fn(val, key);\r\n  }\r\n  return out;\r\n}\r\n","import mapRecord from \"common/mapRecord\";\r\nimport { clamp } from \"math\";\r\nimport { custom, identifier, serializable } from \"serializr\";\r\nimport uuid from \"uuid\";\r\nimport { Cell } from \"../tile\";\r\nimport { CellProperties } from \"./cellProperties\";\r\nimport { AllGenesByName, Gene } from \"./gene\";\r\nimport { GeneInstance } from \"./geneInstance\";\r\nimport { makeGeneUnknown } from \"./GeneUnknown\";\r\n\r\nfunction serializeGeneIntoName(gene: Gene): string {\r\n  const unknownRegex = /^Unknown \\((.+)\\)$/;\r\n  const regexMatch = gene.blueprint.name.match(unknownRegex);\r\n  // account for Unknown (${name})\r\n  if (regexMatch != null) {\r\n    const originalName = regexMatch[1];\r\n    return originalName;\r\n  }\r\n  return gene.blueprint.name;\r\n}\r\n\r\nfunction deserializeGeneFromName(name: string): Gene {\r\n  const gene = AllGenesByName.get(name);\r\n  if (gene == null) {\r\n    console.error(\"Couldn't load gene\", name);\r\n    return makeGeneUnknown(name);\r\n  }\r\n  return gene;\r\n}\r\n\r\nexport class RealizedGene<G extends Gene = Gene> {\r\n  @serializable(custom(serializeGeneIntoName, deserializeGeneFromName))\r\n  public gene: G;\r\n\r\n  @serializable\r\n  public level!: number;\r\n\r\n  @serializable(identifier())\r\n  public readonly uuid = uuid();\r\n\r\n  public constructor(gene?: G, level?: number) {\r\n    this.gene = gene!;\r\n    if (level != null) {\r\n      this.setLevel(level);\r\n    }\r\n  }\r\n\r\n  getStaticProperties() {\r\n    const staticBlueprint = this.gene.blueprint.static || {};\r\n    return mapRecord(staticBlueprint, (arr) => (Array.isArray(arr) ? arr[this.level] : arr)) as Partial<CellProperties>;\r\n  }\r\n\r\n  getDynamicProperties(cell: Cell, properties: CellProperties) {\r\n    return this.gene.blueprint.dynamic?.(cell, properties);\r\n  }\r\n\r\n  public getProps() {\r\n    return mapRecord(this.gene.blueprint.levelProps, (val) => (typeof val === \"number\" ? val : val[this.level]));\r\n  }\r\n\r\n  public getCost() {\r\n    return this.gene.blueprint.levelCosts[this.level];\r\n  }\r\n\r\n  setLevel(newLevel: number): void {\r\n    this.level = clamp(newLevel, 0, this.gene.numLevels - 1);\r\n  }\r\n\r\n  public newInstance(cell: Cell): GeneInstance<G> {\r\n    return new GeneInstance(this.gene, this.getProps(), cell);\r\n  }\r\n\r\n  toString() {\r\n    return `RealizedGene(${this.gene.blueprint.name} ${this.level} [${this.uuid}])`;\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nexport function makeGeneUnknown(name: string) {\r\n  return Gene.make({\r\n    isHidden: true,\r\n    name: `Unknown (${name})`,\r\n    levelCosts: [0, 0, 0, 0, 0],\r\n    levelProps: {},\r\n    description: () => <>Oops, this Gene couldn't be loaded!</>,\r\n  });\r\n}\r\n","export default function devlog(message?: any, ...optionalParams: any[]) {\r\n  if (process.env.NODE_ENV === \"development\") {\r\n    console.log(message, ...optionalParams);\r\n  }\r\n}\r\n","import { DIRECTIONS, Directions } from \"core/directions\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport GN from \"./GN\";\r\nimport RI from \"./RI\";\r\n\r\nexport const GenePipes = Gene.make(\r\n  {\r\n    name: \"Pipes\",\r\n    levelCosts: [1, 1, 1, 2, 3],\r\n    levelProps: {\r\n      diffusionRate: [0.15, 0.175, 0.2, 0.25, 0.25],\r\n    },\r\n    static: {\r\n      energyUpkeep: 1 / 1500,\r\n    },\r\n    description: ({ diffusionRate }) => (\r\n      <>\r\n        <b>Hold Shift to configure.</b>\r\n        <p>\r\n          Continuously equalize <RI w /> <RI s /> between connected cells.\r\n        </p>\r\n        <p>\r\n          On average, every 1<RI w />1<RI s /> will get equalized after <GN value={1 / diffusionRate} sigFigs={3} />{\" \"}\r\n          seconds.\r\n        </p>\r\n      </>\r\n    ),\r\n  },\r\n  () => ({\r\n    connections: {\r\n      n: true,\r\n      e: true,\r\n      s: true,\r\n      w: true,\r\n    } as PipesConnections,\r\n  }),\r\n  (dt, { cell, props: { diffusionRate }, state: { connections } }) => {\r\n    let directionName: Directions;\r\n    for (directionName in connections) {\r\n      if (connections[directionName]) {\r\n        const direction = DIRECTIONS[directionName];\r\n        const neighbor = cell.world.cellAt(cell.pos.x + direction.x, cell.pos.y + direction.y);\r\n        if (neighbor) {\r\n          cell.diffuseWater(neighbor, dt, diffusionRate);\r\n          neighbor.diffuseWater(cell, dt, diffusionRate);\r\n          cell.diffuseSugar(neighbor, dt, diffusionRate);\r\n          neighbor.diffuseSugar(cell, dt, diffusionRate);\r\n        }\r\n      }\r\n    }\r\n  }\r\n);\r\nexport type GenePipes = typeof GenePipes;\r\n\r\nexport type PipesConnections = Partial<Record<Directions, boolean>>;\r\n","import { ResourceIcon } from \"game/ui/common/ResourceIcon\";\r\nimport { randFloat } from \"math\";\r\nimport React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { Cell } from \"../../core/cell/cell\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nexport const GeneTransport = Gene.make(\r\n  {\r\n    name: \"Transport\",\r\n    levelCosts: [1, 1, 1, 2, 3],\r\n    levelProps: {\r\n      secondsPerPush: [5, 4, 3, 2, 1],\r\n    },\r\n    description: ({ secondsPerPush }) => (\r\n      <>\r\n        <b>Hold Shift to configure.</b>\r\n        <p>\r\n          Every <GN value={secondsPerPush} sigFigs={2} /> seconds, move 1<ResourceIcon name=\"water\" />1\r\n          <ResourceIcon name=\"sugar\" /> into the directed cell from behind.\r\n        </p>\r\n      </>\r\n    ),\r\n    static: {\r\n      isDirectional: true,\r\n      energyUpkeep: 1 / 1500,\r\n    },\r\n  },\r\n  (gene, { secondsPerPush }) => ({\r\n    didJustTransport: false,\r\n    cooldown: randFloat(0, secondsPerPush),\r\n  }),\r\n  (dt, { cell, state, props: { secondsPerPush } }) => {\r\n    state.didJustTransport = false;\r\n    if (state.cooldown <= 0) {\r\n      state.cooldown += secondsPerPush;\r\n      const forwardTile = cell.world.tileAt(cell.pos.x + cell.args!.direction!.x, cell.pos.y + cell.args!.direction!.y);\r\n      if (Cell.is(forwardTile)) {\r\n        state.didJustTransport = push(cell, forwardTile, 1, 1);\r\n      }\r\n\r\n      const backwardTile = cell.world.tileAt(\r\n        cell.pos.x - cell.args!.direction!.x,\r\n        cell.pos.y - cell.args!.direction!.y\r\n      );\r\n      if (Cell.is(backwardTile)) {\r\n        state.didJustTransport = state.didJustTransport || push(backwardTile, cell, 1, 1);\r\n      }\r\n    }\r\n    state.cooldown -= dt;\r\n  }\r\n);\r\nexport type GeneTransport = typeof GeneTransport;\r\n\r\nfunction push(cell: Cell, target: Cell, waterToTransport: number, sugarToTransport: number) {\r\n  const { water, sugar } = cell.inventory.give(target.inventory, waterToTransport, sugarToTransport);\r\n  return water > 0 || sugar > 0;\r\n}\r\n","import { Inventory } from \"../inventory\";\r\nimport { Tile } from \"./tile\";\r\n\r\nexport class DeadCell extends Tile {\r\n  displayName = \"Dead Cell\";\r\n\r\n  isStructuralSupport = true;\r\n\r\n  isObstacle = false;\r\n\r\n  inventory = new Inventory(0, this);\r\n\r\n  shouldStep(dt: number) {\r\n    return dt > 0.3;\r\n  }\r\n}\r\n","import { Cell } from \"core/cell\";\r\n\r\n/**\r\n * Find a neighboring cell with resources, and try to take water and sugar from it.\r\n */\r\nexport function takeFromOneNeighborCell(cell: Cell, water: number, sugar: number) {\r\n  const neighbors = cell.world.tileNeighbors(cell.pos);\r\n  for (const tile of neighbors.array) {\r\n    if (Cell.is(tile)) {\r\n      const { water: waterTaken, sugar: sugarTaken } = tile.inventory.give(cell.inventory, water, sugar);\r\n      if (waterTaken > 0 || sugarTaken > 0) {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function takeFromEveryNeighborCell(cell: Cell, water: number, sugar: number) {\r\n  const neighbors = cell.world.tileNeighbors(cell.pos);\r\n  for (const tile of neighbors.array) {\r\n    if (Cell.is(tile)) {\r\n      // const { water: waterTaken, sugar: sugarTaken } = tile.inventory.give(cell.inventory, water, sugar);\r\n      tile.inventory.give(cell.inventory, water, sugar);\r\n    }\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { takeFromEveryNeighborCell } from \"std/geneUtil\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport RI from \"./RI\";\r\n\r\nexport const GeneAttractsSugar = Gene.make(\r\n  {\r\n    name: \"Attracts Sugar\",\r\n    levelCosts: [1, 1, 1, 1, 4],\r\n    levelProps: {\r\n      secondsPerPull: [20, 14, 9, 5, 1],\r\n    },\r\n    static: {\r\n      energyUpkeep: 1 / 1200,\r\n    },\r\n    description: ({ secondsPerPull }) => (\r\n      <>\r\n        Every <GN value={secondsPerPull} sigFigs={2} /> seconds, take 1<RI s /> from every neighboring Cell.\r\n      </>\r\n    ),\r\n  },\r\n  {\r\n    cooldown: 0,\r\n  },\r\n  (dt, { cell, state, props: { secondsPerPull } }) => {\r\n    if (state.cooldown <= 0) {\r\n      takeFromEveryNeighborCell(cell, 0, 1);\r\n      state.cooldown += secondsPerPull;\r\n    }\r\n    state.cooldown -= dt;\r\n  }\r\n);\r\nexport type GeneAttractsSugar = typeof GeneAttractsSugar;\r\n","import { Gene } from \"../../core/cell/gene\";\r\n\r\nexport const GeneCannotFreeze = Gene.make(\r\n  {\r\n    name: \"Cannot Freeze\",\r\n    levelCosts: [3],\r\n    levelProps: {},\r\n    static: {\r\n      cantFreeze: true,\r\n      energyUpkeep: 1 / 600,\r\n    },\r\n    description: () => null,\r\n  },\r\n  {},\r\n  () => {}\r\n);\r\n","import { ResourceIcon } from \"game/ui/common/ResourceIcon\";\r\nimport React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nexport const GeneDiffuseWater = Gene.make(\r\n  {\r\n    name: \"Diffuse Water\",\r\n    levelCosts: [0, 0, 0, 0, 1],\r\n    static: {\r\n      diffusionWater: [0.1, 0.12, 0.14, 0.16, 0.25],\r\n    },\r\n    levelProps: {},\r\n    description: (props, { diffusionWater }) => (\r\n      <>\r\n        <p>\r\n          Continuously recieve <ResourceIcon name=\"water\" /> from neighboring Cells with more.\r\n        </p>\r\n        <p>\r\n          On average, get 1<ResourceIcon name=\"water\" /> every <GN value={1 / diffusionWater!} sigFigs={3} /> seconds.\r\n        </p>\r\n      </>\r\n    ),\r\n  },\r\n  {},\r\n  () => {}\r\n);\r\nexport type GeneDiffuseWater = typeof GeneDiffuseWater;\r\n","import { ResourceIcon } from \"game/ui/common/ResourceIcon\";\r\nimport React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { Vector2 } from \"three\";\r\nimport { Cell } from \"../../core/cell/cell\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport { Air } from \"../../core/tile/air\";\r\n\r\nexport interface PhotosynthesisState {\r\n  totalSugarProduced: number;\r\n  averageConversionRate: number;\r\n  averageChancePerSecond: number;\r\n  sugarConverted: number;\r\n  activeNeighbors: Vector2[];\r\n}\r\n\r\nexport const GenePhotosynthesis = Gene.make<PhotosynthesisState>(\r\n  {\r\n    name: \"Photosynthesis\",\r\n    levelCosts: [4, 6, 8, 10, 12],\r\n    levelProps: {\r\n      reactionChancePerSecond: [0.05, 0.075, 0.1, 0.15, 0.2],\r\n    },\r\n    static: {\r\n      energyUpkeep: 1 / 800,\r\n    },\r\n    description: ({ reactionChancePerSecond }) => (\r\n      <>\r\n        <p>\r\n          Converts 2<ResourceIcon name=\"water\" /> into 1<ResourceIcon name=\"sugar\" />.\r\n        </p>\r\n        <p>Scaled by both sunlight and co2 of adjacent Air.</p>\r\n        <p>\r\n          In perfect sunlight and co2, each Air provides a <GN value={reactionChancePerSecond * 100} sigFigs={3} />%\r\n          chance per second.\r\n        </p>\r\n      </>\r\n    ),\r\n  },\r\n  {\r\n    totalSugarProduced: 0,\r\n    averageConversionRate: 0,\r\n    averageChancePerSecond: 0,\r\n    sugarConverted: 0,\r\n    activeNeighbors: [],\r\n  },\r\n  (dt, { cell, state, props: { reactionChancePerSecond } }) => {\r\n    state.averageConversionRate = 0;\r\n    state.averageChancePerSecond = 0;\r\n    state.sugarConverted = 0;\r\n    state.activeNeighbors = [];\r\n\r\n    const neighbors = cell.world.tileNeighbors(cell.pos);\r\n    let numAir = 0;\r\n    for (const [dir, tile] of neighbors) {\r\n      if (Air.is(tile)) {\r\n        state.activeNeighbors.push(dir);\r\n        numAir += 1;\r\n        maybePhotosynthesize(dt, tile, cell, reactionChancePerSecond, state);\r\n      }\r\n    }\r\n    if (numAir > 0) {\r\n      state.averageConversionRate /= numAir;\r\n      // this.averageSpeed /= numAir;\r\n    }\r\n  }\r\n);\r\nexport type GenePhotosynthesis = typeof GenePhotosynthesis;\r\n\r\nfunction maybePhotosynthesize(\r\n  dt: number,\r\n  air: Air,\r\n  cell: Cell,\r\n  reactionChancePerSecond: number,\r\n  state: PhotosynthesisState\r\n) {\r\n  const sunlight = air.sunlight();\r\n  const co2 = air.co2();\r\n\r\n  // gives much less sugar lower down\r\n  const conversionRate = 0.5; // air.co2();\r\n\r\n  state.averageConversionRate += conversionRate;\r\n  // in prime conditions:\r\n  //      our rate of conversion is speed * params.leafReactionRate\r\n  //      we get 1 sugar at 1/efficiencyRatio (> 1) water\r\n  // if we have less than 1/efficiencyRatio water\r\n  //      our rate of conversion scales down proportionally\r\n  //      on conversion, we use up all the available water and get the corresponding amount of sugar\r\n  const bestEfficiencyWater = 1 / conversionRate;\r\n  const waterToConvert = Math.min(cell.inventory.water, bestEfficiencyWater);\r\n\r\n  const ambientChancePerSecond = reactionChancePerSecond * sunlight * co2;\r\n  // this.sunlightCollected += chance * dt;\r\n  if (waterToConvert > 0 && ambientChancePerSecond > 0) {\r\n    cell.world.logEvent({\r\n      type: \"collect-sunlight\",\r\n      leaf: cell,\r\n      air,\r\n      // the renderer creates one dot per sunlight unit.\r\n      // 0.05 normalizes chancePerSecond (which is 0.075 for photosynthesis 3),\r\n      // * 5 means photosynthesis 3 gets 5 dots per second per air (this is the new player experience)\r\n      numSunlight: (ambientChancePerSecond / 0.05) * dt * 5,\r\n    });\r\n  }\r\n\r\n  // let intersectionChancePerSecond = 0;\r\n  // if (cell.world.occluderManager.getIntersection(cell) != null) {\r\n  //   intersectionChancePerSecond = reactionChancePerSecond * sunlight * 5;\r\n  //   const p = cell.lightIntersection.point;\r\n  //   cell.world.logEvent({\r\n  //     type: \"collect-sunlight\",\r\n  //     leaf: cell,\r\n  //     air,\r\n  //     // the renderer creates one dot per sunlight unit.\r\n  //     // 0.025 normalizes chancePerSecond (which is 0.025 for photosynthesis 3),\r\n  //     // * 20 means photosynthesis 3 gets 20 dots per second (this is the new player experience)\r\n  //     numSunlight: (intersectionChancePerSecond / 0.025) * dt * 20,\r\n  //     point: new Vector2(p.x, p.y),\r\n  //   });\r\n  // }\r\n  // let chancePerSecond = ambientChancePerSecond + intersectionChancePerSecond; // * (waterToConvert / bestEfficiencyWater);\r\n\r\n  const chancePerSecond = ambientChancePerSecond;\r\n\r\n  state.averageChancePerSecond += chancePerSecond;\r\n\r\n  if (Math.random() < chancePerSecond * dt && waterToConvert > 0) {\r\n    const sugarMade = waterToConvert * conversionRate;\r\n    cell.inventory.add(-waterToConvert, sugarMade);\r\n    state.sugarConverted += sugarMade;\r\n    state.totalSugarProduced += sugarMade;\r\n    cell.world.oxygenContribution += sugarMade;\r\n    cell.world.logEvent({\r\n      type: \"photosynthesis\",\r\n      cell,\r\n      sugarMade,\r\n    });\r\n  }\r\n}\r\n","import { buildComplete } from \"game/audio\";\r\nimport { randFloat } from \"math\";\r\nimport { Vector2 } from \"three\";\r\nimport { GeneLiving } from \"../../std/genes\";\r\nimport { GeneObstacle } from \"../../std/genes/GeneObstacle\";\r\nimport { World } from \"../world/world\";\r\nimport { Cell } from \"./cell\";\r\nimport Chromosome from \"./chromosome\";\r\nimport { CellType } from \"./genome\";\r\n\r\nconst chromosomeGrowingCell = new Chromosome(GeneLiving.level(2), GeneObstacle.level(0));\r\n\r\nexport class GrowingCell extends Cell {\r\n  public percentGrown = 0;\r\n\r\n  public timeToGrow: number;\r\n\r\n  silent?: boolean;\r\n\r\n  constructor(pos: Vector2, world: World, public completedCell: Cell, public start: Vector2) {\r\n    super(pos, world, cellTypeGrowingCell);\r\n    this.timeToGrow = Math.max(completedCell.timeToBuild, 0.00001);\r\n  }\r\n\r\n  step(dt: number) {\r\n    super.step(dt);\r\n    this.percentGrown += (this.tempo * dt) / this.timeToGrow;\r\n    this.completedCell.pos.copy(this.pos);\r\n    if (this.percentGrown >= 1) {\r\n      this.world.maybeRemoveCellAt(this.pos);\r\n      this.completedCell.energy = this.energy;\r\n      for (const effect of this.effects) {\r\n        this.completedCell.addEffect(effect);\r\n      }\r\n      this.world.setTileAt(this.pos, this.completedCell);\r\n      if (!this.silent) {\r\n        const id = buildComplete.play();\r\n        buildComplete.rate(id, randFloat(0.5, 1));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst cellTypeGrowingCell = new CellType(\"Growing Cell\", 0, chromosomeGrowingCell);\r\n","import { Steppable } from \"../entity\";\r\nimport { Cell } from \"../tile\";\r\nimport { Gene, RealizedProps } from \"./gene\";\r\n\r\ntype GeneState<G extends Gene> = G extends Gene<infer S, any> ? S : never;\r\n\r\ntype GenePropNames<G extends Gene> = G extends Gene<any, infer K> ? K : never;\r\n\r\nexport class GeneInstance<G extends Gene, S = GeneState<G>, K extends string = GenePropNames<G>> implements Steppable {\r\n  public dtSinceLastStepped = 0;\r\n\r\n  public state: S;\r\n\r\n  public get blueprint() {\r\n    return this.gene.blueprint;\r\n  }\r\n\r\n  constructor(public gene: G, public props: RealizedProps<K>, public cell: Cell) {\r\n    this.state = gene.initialStateFn(gene, props, cell);\r\n  }\r\n\r\n  public isType<S, K extends string>(gene: Gene<S, K>): this is GeneInstance<Gene<S, K>> {\r\n    return this.gene === gene;\r\n  }\r\n\r\n  shouldStep(dt: number): boolean {\r\n    return this.gene.shouldStepFn(dt, this);\r\n  }\r\n\r\n  step(dt: number) {\r\n    const maybeNewState = this.gene.stepFn(dt, this);\r\n    if (maybeNewState !== undefined) {\r\n      this.state = maybeNewState;\r\n    }\r\n  }\r\n\r\n  earnMP(cell: Cell, mpEarned: number) {\r\n    cell.world.earnMP(cell, mpEarned);\r\n  }\r\n}\r\n","import { CELL_BUILD_TIME } from \"core/constants\";\r\n\r\nexport type CellProperties = {\r\n  cantFreeze: boolean;\r\n  isReproductive: boolean;\r\n  isDirectional: boolean;\r\n  isObstacle: boolean;\r\n  inventoryCapacity: number;\r\n  /**\r\n   * Sugar cost to build.\r\n   */\r\n  costSugar: number;\r\n  /**\r\n   * Water cost to build.\r\n   */\r\n  costWater: number;\r\n  diffusionWater: number;\r\n  diffusionSugar: number;\r\n  /**\r\n   * How much faster you move.\r\n   */\r\n  moveSpeed: number;\r\n  /**\r\n   * Seconds it take to build.\r\n   */\r\n  timeToBuild: number;\r\n  /**\r\n   * How fast Genes and Effects happen on the cell.\r\n   *\r\n   * Tempo stacks multiplicatively.\r\n   */\r\n  tempo: number;\r\n  /**\r\n   * How much energy per second this cell burns.\r\n   */\r\n  energyUpkeep: number;\r\n  [k: string]: number | boolean;\r\n};\r\n\r\nexport function defaultCellProperties(): CellProperties {\r\n  return {\r\n    cantFreeze: false,\r\n    isReproductive: false,\r\n    isObstacle: false,\r\n    inventoryCapacity: 0,\r\n    costSugar: 1,\r\n    costWater: 1,\r\n    diffusionWater: 0,\r\n    diffusionSugar: 0,\r\n    moveSpeed: 1,\r\n    tempo: 1,\r\n    energyUpkeep: 0,\r\n    timeToBuild: CELL_BUILD_TIME,\r\n    isDirectional: false,\r\n  };\r\n}\r\n","import { createSimpleSchema, object } from \"serializr\";\r\nimport { Color, Vector2 } from \"three\";\r\n\r\nexport interface MaterialInfo {\r\n  /**\r\n   * If unspecified, means white but respect transparency\r\n   */\r\n  color?: Color;\r\n\r\n  texturePosition: Vector2;\r\n}\r\n\r\nexport const MaterialInfoSchema = createSimpleSchema({\r\n  color: object(Color),\r\n  texturePosition: object(Vector2),\r\n});\r\n","import { Action } from \"./player/action\";\r\nimport { Player } from \"./player/player\";\r\n\r\n/**\r\n * This thing can be interacted with by the player.\r\n */\r\nexport interface Interactable {\r\n  /**\r\n   * What action, if any, the player should take when\r\n   * interacted on by the player.\r\n   */\r\n  interact(source: Player): Action | undefined;\r\n}\r\n\r\nexport function isInteractable<T>(e: T): e is Interactable & T {\r\n  return typeof (e as any).interact === \"function\";\r\n}\r\n","import { Inventory } from \"core/inventory\";\r\nimport { Tile } from \"core/tile/tile\";\r\nexport class BarrenLand extends Tile {\r\n  displayName = \"Barren Land\";\r\n\r\n  public isObstacle = false;\r\n\r\n  public isStructuralSupport = true;\r\n\r\n  shouldStep(dt: number): boolean {\r\n    return dt > 0.2;\r\n  }\r\n\r\n  public inventory = new Inventory(1, this);\r\n}\r\n","import { Air } from \"core/tile\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nconst GROWTH_RATE = 2;\r\nconst NEIGHBORING_AIR_NEEDED = 5;\r\n\r\nexport const GeneAiryExpansion = Gene.make({\r\n  name: \"Airy Expansion\",\r\n  levelCosts: [1],\r\n  levelProps: {},\r\n  description: () => (\r\n    <>\r\n      Grow at <b>{GROWTH_RATE * 100}%</b> speed if there's <b>{NEIGHBORING_AIR_NEEDED}</b> or more neighboring Air\r\n      (diagonals included).\r\n    </>\r\n  ),\r\n  dynamic(cell, properties) {\r\n    // relies on the fact that cell is in the same position as the growing cell.\r\n    const neighbors = cell.world.tileNeighbors(cell.pos);\r\n    if (neighbors.array.filter(Air.is).length >= NEIGHBORING_AIR_NEEDED) {\r\n      properties.timeToBuild /= GROWTH_RATE;\r\n    }\r\n    return properties;\r\n  },\r\n});\r\nexport type GeneAiryExpansion = typeof GeneAiryExpansion;\r\n","import { randFloat } from \"math\";\r\nimport React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { takeFromEveryNeighborCell } from \"std/geneUtil\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport RI from \"./RI\";\r\n\r\nexport const GeneAttractsWater = Gene.make(\r\n  {\r\n    name: \"Attracts Water\",\r\n    levelCosts: [1, 1, 1, 1, 4],\r\n    levelProps: {\r\n      secondsPerPull: [20, 14, 9, 5, 1],\r\n    },\r\n    static: {\r\n      energyUpkeep: 1 / 1000,\r\n    },\r\n    description: ({ secondsPerPull }) => (\r\n      <>\r\n        Every <GN value={secondsPerPull} sigFigs={2} /> seconds, take 1<RI w /> from every neighboring Cell.\r\n      </>\r\n    ),\r\n  },\r\n  (gene, props) => ({\r\n    cooldown: randFloat(0, props.secondsPerPull),\r\n  }),\r\n  (dt, { cell, state, props: { secondsPerPull } }) => {\r\n    if (state.cooldown <= 0) {\r\n      takeFromEveryNeighborCell(cell, 1, 0);\r\n      state.cooldown += secondsPerPull;\r\n    }\r\n    state.cooldown -= dt;\r\n  }\r\n);\r\nexport type GeneAttractsWater = typeof GeneAttractsWater;\r\n","import { TIME_PER_DAY } from \"core/constants\";\r\nimport { Air, DeadCell } from \"core/tile\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport RI from \"./RI\";\r\n\r\nexport const GeneBark = Gene.make(\r\n  {\r\n    name: \"Bark\",\r\n    levelCosts: [0],\r\n    levelProps: {\r\n      timeBeforeGrowth: TIME_PER_DAY,\r\n    },\r\n    static: {\r\n      costSugar: 1,\r\n      costWater: 1,\r\n    },\r\n    description: ({ timeBeforeGrowth }) => (\r\n      <>\r\n        <p>\r\n          Cell costs 1<RI w />1<RI s /> more to grow.\r\n        </p>\r\n        <p>\r\n          <b>{timeBeforeGrowth} seconds</b> after growth, this cell emits a Dead Cell on each directly neighboring Air.\r\n        </p>\r\n      </>\r\n    ),\r\n  },\r\n  () => ({\r\n    tried: false,\r\n  }),\r\n  (dt, { cell, state, props }) => {\r\n    if (!state.tried && cell.age > props.timeBeforeGrowth) {\r\n      const neighbors = cell.world.tileNeighbors(cell.pos);\r\n      for (const tile of neighbors.array) {\r\n        if (tile.pos.manhattanDistanceTo(cell.pos) <= 1 && Air.is(tile)) {\r\n          const deadCell = new DeadCell(tile.pos, tile.world);\r\n          tile.world.setTileAt(deadCell.pos, deadCell);\r\n        }\r\n      }\r\n      state.tried = true;\r\n    }\r\n  }\r\n);\r\nexport type GeneBark = typeof GeneBark;\r\n","import { ResourceIcon } from \"game/ui/common/ResourceIcon\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nexport const GeneCostly = Gene.make(\r\n  {\r\n    name: \"Costly\",\r\n    levelCosts: [-3, -4, -5, -6, -10],\r\n    levelProps: {},\r\n    static: {\r\n      costSugar: [2, 3, 4, 5, 8],\r\n      costWater: [2, 3, 4, 5, 8],\r\n    },\r\n    description: (_, { costSugar, costWater }) => (\r\n      <>\r\n        This cell costs {costWater}\r\n        <ResourceIcon name=\"water\" />\r\n        {costSugar}\r\n        <ResourceIcon name=\"sugar\" /> more to grow.\r\n      </>\r\n    ),\r\n  },\r\n  {},\r\n  () => {}\r\n);\r\nexport type GeneCostly = typeof GeneCostly;\r\n","import React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport RI from \"./RI\";\r\n\r\nexport const GeneDiffuseSugar = Gene.make(\r\n  {\r\n    name: \"Diffuse Sugar\",\r\n    levelCosts: [0, 0, 0, 0, 1],\r\n    static: {\r\n      diffusionSugar: [0.1, 0.12, 0.14, 0.16, 0.25],\r\n    },\r\n    levelProps: {},\r\n    description: (props, { diffusionSugar }) => (\r\n      <>\r\n        <p>\r\n          Continuously recieve <RI s /> from neighboring Cells with more.\r\n        </p>\r\n        <p>\r\n          On average, get 1<RI s /> every <GN value={1 / diffusionSugar!} sigFigs={3} /> seconds.\r\n        </p>\r\n      </>\r\n    ),\r\n  },\r\n  {},\r\n  () => {}\r\n);\r\nexport type GeneDiffuseSugar = typeof GeneDiffuseSugar;\r\n","import { ResourceIcon } from \"game/ui/common/ResourceIcon\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nconst WATER_MIN = 2;\r\nconst WATER_MAX = 5;\r\nconst PERCENT_FASTER = 1;\r\n\r\nexport const GeneHydrostasis = Gene.make({\r\n  name: \"Hydrostasis\",\r\n  levelCosts: [1, 1, 1, 2, 3],\r\n  levelProps: {},\r\n  static: {\r\n    energyUpkeep: 1 / 1200,\r\n  },\r\n  description: () => (\r\n    <>\r\n      If this cell holds between {WATER_MIN} and {WATER_MAX} <ResourceIcon name=\"water\" />, it operates{\" \"}\r\n      <b>{PERCENT_FASTER * 100}%</b> faster.\r\n    </>\r\n  ),\r\n  dynamic(cell, properties) {\r\n    const { water } = cell.inventory;\r\n    if (water >= WATER_MIN && water <= WATER_MAX) {\r\n      properties.tempo *= 1 + PERCENT_FASTER;\r\n    }\r\n    return properties;\r\n  },\r\n});\r\nexport type GeneHydrostasis = typeof GeneHydrostasis;\r\n","import React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nexport const GeneInventory = Gene.make(\r\n  {\r\n    name: \"Inventory\",\r\n    levelCosts: [1, 1, 2, 2, 3],\r\n    levelProps: {},\r\n    static: {\r\n      inventoryCapacity: [2, 4, 7, 11, 15],\r\n    },\r\n    description: (_, { inventoryCapacity }) => (\r\n      <>\r\n        Resource Capacity +<GN value={inventoryCapacity!} />.\r\n      </>\r\n    ),\r\n  },\r\n  {},\r\n  () => {}\r\n);\r\nexport type GeneInventory = typeof GeneInventory;\r\n","import { Cell } from \"core/cell\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport RI from \"./RI\";\r\nexport const GeneLiving = Gene.make(\r\n  {\r\n    name: \"Living\",\r\n    levelCosts: [-3, -4, -5, -6, -7],\r\n    levelProps: {},\r\n    static: {\r\n      inventoryCapacity: 5,\r\n      energyUpkeep: 1 / 800,\r\n    },\r\n    description: () => (\r\n      <>\r\n        <p>\r\n          Eats 1<RI s /> for 100% energy.\r\n        </p>\r\n        <p>Shares energy with other cells.</p>\r\n        <p>\r\n          Allows cell to hold <RI w />\r\n          <RI s />. Resource Capacity +5.\r\n        </p>\r\n      </>\r\n    ),\r\n  },\r\n  {},\r\n  (dt, { cell }) => {\r\n    let maxEnergyToEat = getMaxEnergyToEat(cell, dt);\r\n    // eat from self\r\n    if (maxEnergyToEat > 0) {\r\n      // if this number goes up, we become less energy efficient\r\n      // if this number goes down, we are more energy efficient\r\n      maxEnergyToEat -= stepEatSugar(cell, maxEnergyToEat, ENERGY_PER_SUGAR);\r\n    }\r\n\r\n    // share energy\r\n    const tileNeighbors = cell.world.tileNeighbors(cell.pos);\r\n    for (const neighbor of tileNeighbors.array) {\r\n      if (Cell.is(neighbor)) {\r\n        maybeGiveEnergy(dt, cell, neighbor, 0.05);\r\n      }\r\n    }\r\n  }\r\n);\r\nexport type GeneLiving = typeof GeneLiving;\r\n\r\nconst ENERGY_PER_SUGAR = 1;\r\nconst EAT_ENERGY_PER_SECOND = 0.333;\r\n\r\nfunction getMaxEnergyToEat(cell: Cell, dt: number) {\r\n  const hunger = 1 - cell.energy;\r\n  if (hunger < 0.05) {\r\n    return 0;\r\n  }\r\n  return Math.min(hunger, EAT_ENERGY_PER_SECOND * dt);\r\n}\r\n\r\nfunction stepEatSugar(cell: Cell, maxEnergyToEat: number, energyPerSugar: number): number {\r\n  const sugarToEat = Math.min(maxEnergyToEat / energyPerSugar, cell.inventory.sugar);\r\n  // eat if we're hungry\r\n  if (sugarToEat > 0) {\r\n    cell.inventory.add(0, -sugarToEat);\r\n    const gotEnergy = sugarToEat * energyPerSugar;\r\n    cell.energy += gotEnergy;\r\n    if (gotEnergy > 0) {\r\n      cell.world.logEvent({ type: \"cell-eat\", who: cell });\r\n    }\r\n    return gotEnergy;\r\n  }\r\n  return 0;\r\n}\r\n\r\nconst ENERGY_GIVE_RATE = 0.25;\r\n\r\nfunction maybeGiveEnergy(dt: number, cell: Cell, neighbor: Cell, differenceThreshold: number) {\r\n  const difference = cell.energy - neighbor.energy;\r\n  if (difference > differenceThreshold) {\r\n    const energyToGive = Math.min(difference - differenceThreshold, ENERGY_GIVE_RATE * dt);\r\n    // safe method but lower upper bound on equalization rate\r\n    // energyTransfer = Math.floor((neighbor.energy - this.energy) / energeticNeighbors.length);\r\n\r\n    // this may be unstable w/o double buffering\r\n    cell.energy -= energyToGive;\r\n    neighbor.energy += energyToGive;\r\n    cell.world.logEvent({ type: \"cell-transfer-energy\", from: cell, to: neighbor, amount: energyToGive });\r\n  }\r\n}\r\n","import { Cell } from \"core/cell\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nconst NEIGHBORS_NEEDED = 6;\r\nconst PERCENT_FASTER = 1;\r\n\r\nexport const GeneNetworkEffect = Gene.make({\r\n  name: \"Network Effect\",\r\n  levelCosts: [2],\r\n  levelProps: {\r\n    energyUpkeep: 1 / 1200,\r\n  },\r\n  description: () => (\r\n    <>\r\n      If this cell has {NEIGHBORS_NEEDED} or more neighbors (diagonals included), it operates{\" \"}\r\n      <b>{PERCENT_FASTER * 100}%</b> faster.\r\n    </>\r\n  ),\r\n  dynamic(cell, properties) {\r\n    const neighbors = cell.world.tileNeighbors(cell.pos);\r\n    let numCells = 0;\r\n    for (const n of neighbors.array) {\r\n      if (Cell.is(n)) {\r\n        numCells++;\r\n      }\r\n    }\r\n\r\n    if (numCells >= NEIGHBORS_NEEDED) {\r\n      properties.tempo *= 1 + PERCENT_FASTER;\r\n    }\r\n    return properties;\r\n  },\r\n});\r\nexport type GeneNetworkEffect = typeof GeneNetworkEffect;\r\n","import { TIME_PER_DAY } from \"core/constants\";\r\nimport { Soil } from \"core/tile\";\r\nimport { BarrenLand } from \"core/tile/BarrenLand\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nexport const GeneNutrientExtraction = Gene.make(\r\n  {\r\n    name: \"Nutrient Extraction\",\r\n    levelCosts: [1, 1, 1, 1, 4],\r\n    levelProps: {\r\n      energyPerSecond: [0.02, 0.03, 0.04, 0.05, 0.1],\r\n    },\r\n    static: {\r\n      energyUpkeep: 1 / 1200,\r\n    },\r\n    description: ({ energyPerSecond }) => (\r\n      <>\r\n        <p>\r\n          While this cell has a neighboring Soil, it gets <b>{energyPerSecond * 100}%</b> energy per second.\r\n        </p>\r\n        <p>\r\n          Every <b>{TIME_PER_DAY}</b> seconds, turn one neighboring Soil into Barren Land.{\" \"}\r\n          <i>(Barren Land is not a Soil).</i>\r\n        </p>\r\n      </>\r\n    ),\r\n  },\r\n  {\r\n    hasMonthPassed: false,\r\n    cooldown: TIME_PER_DAY,\r\n    soil: null as Soil | null,\r\n  },\r\n  (dt, { cell, props, state }) => {\r\n    // something else has bumped the soil\r\n    if (state.soil != null && cell.world.tileAt(state.soil.pos) !== state.soil) {\r\n      state.soil = null;\r\n    }\r\n    if (state.soil == null) {\r\n      const neighbors = cell.world.tileNeighbors(cell.pos);\r\n      for (const tile of neighbors.array) {\r\n        if (tile instanceof Soil) {\r\n          state.soil = tile;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (state.soil != null) {\r\n      // cell.energy = clamp(cell.energy + props.energyPerSoilPerSecond * dt, 0, 1);\r\n      cell.energy += props.energyPerSecond * dt;\r\n      cell.world.logEvent({\r\n        type: \"cell-transfer-energy\",\r\n        amount: props.energyPerSecond * dt,\r\n        from: state.soil,\r\n        to: cell,\r\n      });\r\n      cell.world.logEvent({\r\n        type: \"cell-eat\",\r\n        who: state.soil,\r\n      });\r\n    }\r\n\r\n    if (state.cooldown <= 0 && state.soil != null) {\r\n      const barrenSoil = new BarrenLand(state.soil.pos, state.soil.world);\r\n      state.soil.world.setTileAt(barrenSoil.pos, barrenSoil);\r\n      state.soil = null;\r\n      state.cooldown += TIME_PER_DAY;\r\n    }\r\n    state.cooldown -= dt;\r\n  }\r\n);\r\nexport type GeneNutrientExtraction = typeof GeneNutrientExtraction;\r\n","import React from \"react\";\r\nimport { takeFromOneNeighborCell } from \"std/geneUtil\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport RI from \"./RI\";\r\n\r\nexport const GeneOsmosis = Gene.make(\r\n  {\r\n    name: \"Osmosis\",\r\n    levelCosts: [1],\r\n    levelProps: {\r\n      secondsPerPull: 1,\r\n    },\r\n    static: {},\r\n    description: ({ secondsPerPull }) => (\r\n      <>\r\n        While this cell has more <RI s /> than <RI w />, take 1<RI w /> every {secondsPerPull} seconds from a neighbor.\r\n      </>\r\n    ),\r\n  },\r\n  {\r\n    cooldown: 0,\r\n    isOsmosising: false,\r\n  },\r\n  (dt, { cell, state, props: { secondsPerPull } }) => {\r\n    state.isOsmosising = cell.inventory.sugar > cell.inventory.water;\r\n    if (state.cooldown <= 0) {\r\n      if (state.isOsmosising) {\r\n        takeFromOneNeighborCell(cell, 1, 0);\r\n      }\r\n      state.cooldown += secondsPerPull;\r\n    }\r\n    state.cooldown -= dt;\r\n  }\r\n);\r\nexport type GeneOsmosis = typeof GeneOsmosis;\r\n","import React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { Cell } from \"../../core/cell/cell\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nexport const GenePushWater = Gene.make(\r\n  {\r\n    name: \"Push Water\",\r\n    levelCosts: [1, 1, 1, 1, 1],\r\n    levelProps: {\r\n      secondsPerPush: [20, 12, 7, 3, 1],\r\n    },\r\n    description: ({ secondsPerPush }) => (\r\n      <>\r\n        Every <GN value={secondsPerPush} sigFigs={2} /> seconds, push 1 water from this Cell to each neighboring Cell.\r\n      </>\r\n    ),\r\n  },\r\n  {\r\n    cooldown: 0,\r\n  },\r\n  (dt, { cell, state, props: { secondsPerPush } }) => {\r\n    if (state.cooldown <= 0) {\r\n      const neighbors = cell.world.tileNeighbors(cell.pos);\r\n      for (const tile of neighbors.array) {\r\n        // push water to nearby sources\r\n        if (Cell.is(tile)) {\r\n          // tile.inventory.give(cell.inventory, randRound(LEAF_WATER_INTAKE_PER_SECOND * dt), 0);\r\n          cell.inventory.give(tile.inventory, 1, 0);\r\n          // if (water > 0) {\r\n          //   break;\r\n          // }\r\n        }\r\n      }\r\n      state.cooldown += secondsPerPush;\r\n    }\r\n    state.cooldown -= dt;\r\n  }\r\n);\r\nexport type GenePushWater = typeof GenePushWater;\r\n","import React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport GN from \"./GN\";\r\nexport const GeneScaffolding = Gene.make(\r\n  {\r\n    name: \"Scaffolding\",\r\n    levelCosts: [-3, -4, -5, -6, -10],\r\n    levelProps: {},\r\n    static: {\r\n      timeToBuild: [3, 4, 5, 6, 15],\r\n    },\r\n    description: (_, { timeToBuild }) => (\r\n      <>\r\n        This cell takes <GN value={timeToBuild!} /> seconds longer to grow.\r\n      </>\r\n    ),\r\n  },\r\n  {},\r\n  () => {}\r\n);\r\nexport type GeneScaffolding = typeof GeneScaffolding;\r\n","import { Cell } from \"core/cell\";\r\nimport { Soil } from \"core/tile\";\r\nimport { ResourceIcon } from \"game/ui/common/ResourceIcon\";\r\nimport React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { Vector2 } from \"three\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nexport interface SoilAbsorptionState {\r\n  cooldown: number;\r\n  totalSucked: number;\r\n  activeNeighbors: Vector2[];\r\n}\r\n\r\nexport const GeneSoilAbsorption = Gene.make<SoilAbsorptionState>(\r\n  {\r\n    name: \"Soil Absorption\",\r\n    levelCosts: [3, 5, 7, 9, 11],\r\n    levelProps: {\r\n      secondsPerAbsorb: [15, 12, 9.6, 7.68, 6.14],\r\n    },\r\n    static: {\r\n      energyUpkeep: 1 / 800,\r\n    },\r\n    description: ({ secondsPerAbsorb }) => (\r\n      <>\r\n        Absorb 1<ResourceIcon name=\"water\" /> every <GN value={secondsPerAbsorb} /> seconds from every neighboring Soil.\r\n      </>\r\n    ),\r\n  },\r\n  { cooldown: 0, totalSucked: 0, activeNeighbors: [] },\r\n  (dt, { cell, state, props: { secondsPerAbsorb } }) => {\r\n    if (state.cooldown <= 0) {\r\n      state.activeNeighbors = [];\r\n      state.totalSucked += absorbWater(state.activeNeighbors, cell);\r\n      state.cooldown += secondsPerAbsorb;\r\n    }\r\n    state.cooldown -= dt;\r\n  }\r\n);\r\nexport type GeneSoilAbsorption = typeof GeneSoilAbsorption;\r\n\r\nfunction absorbWater(activeNeighbors: Vector2[], cell: Cell) {\r\n  const neighbors = cell.world.tileNeighbors(cell.pos);\r\n  let totalSucked = 0;\r\n  for (const [dir, tile] of neighbors) {\r\n    if (tile instanceof Soil) {\r\n      activeNeighbors.push(dir);\r\n      const { water } = tile.inventory.give(cell.inventory, 1, 0);\r\n      totalSucked += water;\r\n    }\r\n  }\r\n  return totalSucked;\r\n}\r\n","import { Cell } from \"../../core/cell/cell\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n/**\r\n * Vascular cells will connect to other neighboring Vascular cells.\r\n * Water in a Vascular cell will do two things:\r\n * a) Adhesion - Water will be pulled into this Cell.\r\n * b) Cohesion - Water will move to be near other Water.\r\n */\r\nexport const GeneVascular = Gene.make(\r\n  {\r\n    name: \"Vascular\",\r\n    levelCosts: [1, 1, 2, 2, 3],\r\n    levelProps: {\r\n      diffusionRate: [0.1, 0.15, 0.2, 0.25, 0.35],\r\n    },\r\n    static: {\r\n      energyUpkeep: 1 / 1200,\r\n    },\r\n    description: ({ diffusionRate }) => `Diffuses water to other Vascular cells with rate ${diffusionRate}.`,\r\n  },\r\n  {},\r\n  (dt, { cell, props: { diffusionRate } }) => {\r\n    const neighbors = cell.world.tileNeighbors(cell.pos);\r\n    const vascularNeighbors = neighbors.array.filter((t) => Cell.is(t) && t.chromosome.has(GeneVascular));\r\n    for (const n of vascularNeighbors) {\r\n      cell.diffuseWater(n, dt, diffusionRate);\r\n    }\r\n  }\r\n);\r\nexport type GeneVascular = typeof GeneVascular;\r\n","module.exports = __webpack_public_path__ + \"static/media/Blop-Mark_DiAngelo-79054334.627c0e8b.mp3\";","module.exports = __webpack_public_path__ + \"static/media/build.0e2001c4.mp3\";","module.exports = __webpack_public_path__ + \"static/media/build_complete.9af6ac71.mp3\";","module.exports = __webpack_public_path__ + \"static/media/deconstruct.e5356177.mp3\";","module.exports = __webpack_public_path__ + \"static/media/drop_water.7ab1e6f0.mp3\";","module.exports = __webpack_public_path__ + \"static/media/eating.e78fa644.mp3\";","module.exports = __webpack_public_path__ + \"static/media/footsteps.636605b0.wav\";","module.exports = __webpack_public_path__ + \"static/media/fruit-popOpen.5991698f.mp3\";","module.exports = __webpack_public_path__ + \"static/media/impactSoft_medium_003.b8698323.mp3\";","module.exports = __webpack_public_path__ + \"static/media/interact.848e9d20.mp3\";","module.exports = __webpack_public_path__ + \"static/media/intro-bounce.6e8ea313.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-base.28ee2cbb.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-drums.1c82b4f4.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-overworld.62281b29.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-start.473c2a0e.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-strings.9f30639c.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mitodeath.207c4872.mp3\";","module.exports = __webpack_public_path__ + \"static/media/sticky.6d27b20f.mp3\";","module.exports = __webpack_public_path__ + \"static/media/suckwater.b0fe81fa.wav\";","module.exports = __webpack_public_path__ + \"static/media/switch23.23bfba73.wav\";","module.exports = __webpack_public_path__ + \"static/media/switch25.f76e435c.wav\";","module.exports = __webpack_public_path__ + \"static/media/whoosh.fde62e78.mp3\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wwdEQIkKFbu2wAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA0UlEQVRYw2NgGAUjHTCSovjYTIb/xKizSifeXKZBGQK4fGppwEeUoccvfCI6ZAZXCMB8TqxPSQWwkEEOicERAkT7XL4Glf+wheKQGPAQYCFJNZk+HtTlAAtFcY1D3cePqOUAPz/fUAsBYuMahzp8Ph7aJSEpcTtkSkK85QDMxzCfEutjdH1Dtz1AbK1IyMfY4n7whMCzW/txSj7Y7/ifGi0ifG3EwR0CDAwMDFJqjvRrFX/+8GpgywFeATGq+WzI1AVMuIKdXtHBhCvYCUUHtQAAj7ZTZKkXht4AAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wwdECsv+gDCjwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAR0lEQVRYw2P8//8/w0ACJoYBBqMOYEEXkBY9TNNE8fS1LeNoFIw6YNQBow4YdcCoA0YdMOqAUQeMOmDUAYPKAYyjfcMR7wAAvzUKOwLggbEAAAAASUVORK5CYII=\"","module.exports = __webpack_public_path__ + \"static/media/fruit.e136487f.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAACC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KD0UqkwAAAM1JREFUKBVjYBgowIjL4v50+/8wucKZB7GqwxCEadJSkYfpZbh25yGYjW4IimaQRpimSbL8cM15jz+C2SBDkA1ggqtAYiBrBAmj82FK4TbDbF2qowSWe/vxLUwNgzC/MJgdfeUe2Asw27HajKwRpAudDzMVq2aYJCGaepr5JSH+hfkRZjOMD5OHicMDDCSAHmgwRSAaPbBAYhjOBpmehQhokBowH91WkDiKzSABWAqztHUEccHg+OH9YBoWRVBhTM0wCZghID66JpgaimgAWfxCZhIsrg0AAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5AQeFiQ4xQbzogAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAFCklEQVRYw8WWXWhbZRjHf+csSZs2zYlztbLqki1erCAkCitM0WSgRRBpWtiFSJveCM4VMqQTtpv0yoIrbANnL1T6MfBCcKe7GVoZ7QSnrEI6h9vY7JpQs62trmv63aR5vEhz2qzpGgdlD7xwyPPmff7P918REZ6mmLIfXV1dEovFAHC5XASDQTdwZ8sRiAihUEiAnONwOKSzs1NEhK08rKRAAGloNktDs1k81aoBZKtBICI4nU4BxFOtSn3QJB29xdLSZjFAjIyMyJYC6OzsXJeC9p4iqanbJoAEAgERkT1bBkBEGBkZEY/HYwDwVKvS3lO05TVhfASDQcNYfdAkJ3qK5NwVq7S0WeTtlUhsRU0oIsLAwIAcOHAAmx1OdBfjrlLXdUufnqL92BIOhwOv14vD4cDv91NbW4vL5VK6urrk0qVLRKPRgjswFAplAAQCATl//jwtbRZq6kzcj6exlSnY7ErOH9qPLdKnL697yOVy/S/Da0URERRFEQB90EppmULdvjmef0GhQ7fmXB6+kebqlWXcVSozCeHyxWV+WgG0/81dHPzgZV7cpRVk+JOPLjAam1qdhAClZRmPZ6fh/t/rR7S7Ss1Jz+tvmahvTMP8Pt6rfa0gw4mpRVo/vchobApN0zIAnE4nsViMsXiaikqVukYTFZVKQQ+6q1SKzTFgcwD37iVoqv+eP/8YR9M0BgYGUAH8fv9KoWXCeei4hfqgueA8LiT/4eHs9Q31i8kkv96+jn6tn4nEw+zuwev1KipAU1MTAHpPkuGb6ScqptmF+Dqjf43d5cerv/NN/wV+u3WDxWQK9z4bAENDQ6vb0O/3K6FQSE6fPk3r4UXae4qoqFQ3NTo9b2IsYeWlimnuTo5y+fbPqMoUVss4dmuK2EQp4wnrY98wrJw6dUrxeDyMxYVDdQv06SkAzn6RZHY6P2cos6Zw7pgBIJ1eZHf5Nap2RnHtmGN76RJWy/qWnYgusjbtyiOEZE9TU9Nwd3c3ADY7zCSgodlMQ7M5x/P4ZAmVz8wRnyxh786EoZtfyviUXFYZvPMsqeVtqx0wkeSrw7EsDXADd5R8jKi3t1eOHDlClqDY7HCipxj33vxpmZlT+HfOSnyyBLMqvOJ6wC+3yllIrnb54twy37XGGY8uARCJRFaL8FEJBAJKNBpVIpEIoVCImQQcbVxA70nm3BuLpznauMD7b8zz7dcwNQVe1wMi0e05xgGKSrbR8PkuXn1Xyzq5yog2O9lFtXZDProtAenoLZb6oEkAsZeb5J2Pn5Pmrt2y/+B2KSpVc+729/eLiKAW0mLZNn2ctLRZGL6R5lx3aiXfKX74cpyeo6No5SY+POM07obDYfx+v1JwBLI8oaZuW94IuKsU6btZIjZ7xrtQKCT9/f3i8/nWER2fzyd5+cBm4XdXKXL2YrG4q5S8KWhpsxg0zuFwSCQSERFhLRCfz2f8XhCALFWz2ZEOvdigaPkA2OyZGsje8Xq9BdG4DRWRSMR4vPWMRQ4dN+eEMl8RVlQqog9ajSitcMknA5Blyg3N5hxD4XB4HQCfz2fwSU+1Kvqg1aiHzSjchl2QHUKeapXW5sz4PHnypDFCZ6aFmTUjemhoyK1pGlevpOn4bImauswc2JQpbRaB7AkGg4Ynmqbl6LJerk1b9ui6Lk9cA7W1taJpWtb4nrU6n88nTqdTwuFwjgFd18Xj8eTVbciKn6aoPGX5D2F3mdViPbrMAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAFJklEQVRIS62We2xTVRzHv+e2ty0bfa223VMjMEjWTXyuBmOIsCiYIGCMRpYoiSYIGjSOmGE0gCSogcnDR0biwIQoCmqmLg4msP2xBLYYQmCj4GOKjLmue/Tlut3b3mPOvbT3di2tiTt/9fZ3ft/+fp/z7e9cgv+wpt4nFD7A9Bkl+bbn3SDshqriA/hDyJmTX7B7JSVn25XCZkOQ6YjdKyla2sEfzl0d25u1Qi0zzyflFJJKrv+VQZKLaYaguBs0le4DFteUQppWFS9wfujIzS1ZEKQEaa+5k9RGHhG7V1CcPZFiVrOoBPuqpuTn1/qNuPDQ3dCdU+PskJK5GS2roiqzo2230R19elnw7YUC6p8cJ2L34xQtP8pMtWJZGXZ13kFPBubKAkvMUTQOJABJpfBBtQFdgQI5XmcLYfmjg2nYMhhuPeaha0qikKZFtEcd+PqPsTSGa+c58ExFFJFoHB3RIuxceym7IO2x9BFvuJoJPuscg5MXcWCoGK3XxnG4JiZXtP6CCUxwc+kwAiKPowEH3n26nyRzszC0fH8maFl1KmiFw12IZYnr6IuK2HVZYbi1UkCN3Yjjo0WwOubgvrgfdfbQD6Q2/ETSGWnl0nPmhq5J+56OUbMcX2oN45fYNJqv8fLzhnIB1UWFOBUoTDFcZgltIQ9GmjIEaY/lC+INr2MtP1UcAp+I45uwC8cHRrFrnmKbRp9Bbnl9RRDBSYq2sENmmMxNa5n2WPzEG3YzwRfcAbh5EbsGS9F6fQKt90zKgqt7FYZvlg/BL/Jo8TuTDOXcTIY9ls9PBy3rToessDsLsFS6AV9UwHs+heEbCwR47Ca0jtlhsZvwgOTHcluYdVafnWGPZVtX1La9Y0xhyHx2ZVLAx38qgi9XCPAUFSLp0+XWEBPcTrzhHdkYniLecJ1sG/cECiHiSKgEx34fxUcLFdtsumSUW95YMYbxGPBt2Il31sgM5dyZDIeJN1zMBF90j8AlMyzDsZ9HcGKFiFW9JllUYXgDIyKPT/2uJEM5NwtDc/OZkHUD86G1yISH8TcuRwQ0XVVaZqvlfg5t43bMtRpRiwDqbMGDxBt5KTvDXuuezoi14aebDB+zhXA1No39A4oPN98u4AYpQTyujDPGeJkt0kRqQ1syGfZaL5La0F2s5eddo7Dp4zg4UY6vfgvgiEexTf15xTY6HYd6xwi+DLmxY/VFQm/mZrTMvmCCz7lGYdfHsX+oGMfPj0Bv06VaZoKvlg7LMbbYfzkVzHYFnO4op4yh2WbEEoxgU7+UNm2a79XjZNCKArMBkxEhtyDtMTdX91o2SII6/xoqRTT9qjB8/U4Be/8ygiY0t0TD0C3Hl3z0VftKqTSl3iGckcN3ixWGzDqE50BFNX6lcTh3y/MbnZTXMItHJOjNXApTYlKCrkB9ziuYrULtrZe3Qs+HZTQtwcCBCmpLMwWInoDGVYaEI6CaO4dU7S+jUiyRaokzcZjJMFeFGT8wv9FFeZvKJIPZPxJ0hWpcilFwc9RzYI7gDOrz7FfoOVCWZhNi5EA1rx7EQEA1viQ8ARVVhtARQOPL2a9wwVsuqp+r9RmFrkBlkohR6LTMpik4oxpn1bKqU9Nm1k+5ijHU2saogzStsZGBg5TLlzqS9t+efYaV29w0jdEUBWe6tc+oCBBl+MiLxgGi3hCY/Qq105Z9rm6uoJqXYuUtXGO7mfv7Nl7PPb6q9mbOw5zTZmueebhoZzHVMpnJiCYAol4xuJJP8P9W+C+xZd+qpRkU/AAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,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\"","module.exports = __webpack_public_path__ + \"static/media/snow.6c6ff636.png\";","module.exports = __webpack_public_path__ + \"static/media/switch26.69545541.wav\";","module.exports = __webpack_public_path__ + \"static/media/rollover6.a81b9fe6.wav\";","var map = {\n\t\"./GeneAdhesion.tsx\": 341,\n\t\"./GeneAiryExpansion.tsx\": 112,\n\t\"./GeneAttractsSugar.tsx\": 92,\n\t\"./GeneAttractsWater.tsx\": 113,\n\t\"./GeneBark.tsx\": 114,\n\t\"./GeneCannotFreeze.tsx\": 93,\n\t\"./GeneCostly.tsx\": 115,\n\t\"./GeneDiffuseSugar.tsx\": 116,\n\t\"./GeneDiffuseWater.tsx\": 94,\n\t\"./GeneFastMetabolism.tsx\": 342,\n\t\"./GeneFluidMembrane.tsx\": 343,\n\t\"./GeneHydrostasis.tsx\": 117,\n\t\"./GeneInventory.tsx\": 118,\n\t\"./GeneLiving.tsx\": 119,\n\t\"./GeneNetworkEffect.tsx\": 120,\n\t\"./GeneNutrientExtraction.tsx\": 121,\n\t\"./GeneObstacle.tsx\": 68,\n\t\"./GeneOsmosis.tsx\": 122,\n\t\"./GenePhotosynthesis.tsx\": 95,\n\t\"./GenePipes.tsx\": 80,\n\t\"./GeneProliferation.tsx\": 344,\n\t\"./GenePushWater.tsx\": 123,\n\t\"./GeneReproducer.tsx\": 53,\n\t\"./GeneScaffolding.tsx\": 124,\n\t\"./GeneSlowMetabolism.tsx\": 345,\n\t\"./GeneSoilAbsorption.tsx\": 125,\n\t\"./GeneTransport.tsx\": 81,\n\t\"./GeneVascular.tsx\": 126\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 340;","import { Cell } from \"core/cell\";\r\nimport React from \"react\";\r\nimport GN from \"std/genes/GN\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\nimport RI from \"./RI\";\r\n\r\nconst extraDiffusion = 0.1;\r\n\r\nexport const GeneAdhesion = Gene.make(\r\n  {\r\n    name: \"Adhesion\",\r\n    levelCosts: [1],\r\n    levelProps: {},\r\n    static: {\r\n      energyUpkeep: 1 / 1200,\r\n    },\r\n    dynamic(cell, properties) {\r\n      const neighbors = cell.world.tileNeighbors(cell.pos);\r\n      let nonCellNeighbors = 0;\r\n      for (const t of neighbors.array) {\r\n        if (!Cell.is(t)) {\r\n          nonCellNeighbors++;\r\n        }\r\n      }\r\n      if (nonCellNeighbors >= 3) {\r\n        properties.diffusionWater += extraDiffusion;\r\n      }\r\n      return properties;\r\n    },\r\n    description: () => (\r\n      <>\r\n        <p>\r\n          While this cell has 3 or more non-Cell neighbors, take <RI w /> from other Cells.\r\n        </p>\r\n        <p>\r\n          On average, get 1<RI w /> every <GN value={1 / extraDiffusion} sigFigs={3} /> seconds.\r\n        </p>\r\n      </>\r\n    ),\r\n  },\r\n  {},\r\n  () => {}\r\n);\r\n\r\nexport type GeneAdhesion = typeof GeneAdhesion;\r\n","import { nf } from \"common/formatters\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nexport const GeneFastMetabolism = Gene.make({\r\n  name: \"Fast Metabolism\",\r\n  levelCosts: [1, 1, 1, 1, 3],\r\n  levelProps: {\r\n    energyUpkeep: 1 / 1500,\r\n  },\r\n  static: {\r\n    // 1.1 ^ x\r\n    tempo: [1.1, 1.21, 1.331, 1.4641, 1.771561],\r\n  },\r\n  description: (_, { tempo }) => (\r\n    <>\r\n      Cell operates <b>{nf((tempo! - 1) * 100, 3)}%</b> faster. <i>(Energy upkeep is also increased)</i>.\r\n    </>\r\n  ),\r\n});\r\nexport type GeneFastMetabolism = typeof GeneFastMetabolism;\r\n","import React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nexport const GeneFluidMembrane = Gene.make({\r\n  name: \"Fluid Membrane\",\r\n  levelCosts: [1, 1, 1, 1, 3],\r\n  levelProps: {\r\n    energyUpkeep: 1 / 1200,\r\n  },\r\n  static: {\r\n    moveSpeed: [1.2, 1.3, 1.4, 1.5, 2],\r\n  },\r\n  description: (_, { moveSpeed }) => (\r\n    <>\r\n      Move <b>{(moveSpeed! - 1) * 100}%</b> faster over this Cell.\r\n    </>\r\n  ),\r\n});\r\nexport type GeneFluidMembrane = typeof GeneFluidMembrane;\r\n","import { Cell } from \"core/cell\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nconst GROWTH_RATE = 2;\r\nconst NEIGHBORING_CELLS_NEEDED = 4;\r\n\r\nexport const GeneProliferation = Gene.make({\r\n  name: \"Proliferation\",\r\n  levelCosts: [1],\r\n  levelProps: {},\r\n  description: () => (\r\n    <>\r\n      Grow at <b>{GROWTH_RATE * 100}%</b> speed if there's <b>{NEIGHBORING_CELLS_NEEDED}</b> or more neighboring Cells.\r\n    </>\r\n  ),\r\n  dynamic(cell, properties) {\r\n    // relies on the fact that cell is in the same position as the growing cell.\r\n    const neighbors = cell.world.tileNeighbors(cell.pos);\r\n    if (neighbors.array.filter((t) => Cell.is(t)).length >= NEIGHBORING_CELLS_NEEDED) {\r\n      properties.timeToBuild /= GROWTH_RATE;\r\n    }\r\n    return properties;\r\n  },\r\n});\r\nexport type GeneProliferation = typeof GeneProliferation;\r\n","import { nf } from \"common/formatters\";\r\nimport React from \"react\";\r\nimport { Gene } from \"../../core/cell/gene\";\r\n\r\nexport const GeneSlowMetabolism = Gene.make({\r\n  name: \"Slow Metabolism\",\r\n  levelCosts: [1, 1, 1, 1, 3],\r\n  levelProps: {\r\n    energyUpkeep: 1 / 1500,\r\n  },\r\n  static: {\r\n    // 1.1 ^ -x\r\n    tempo: [0.909, 0.826, 0.751, 0.683, 0.5644],\r\n  },\r\n  description: (_, { tempo }) => (\r\n    <>\r\n      Cell operates <b>{nf((1 - tempo!) * 100, 3)}%</b> slower. <i>(Energy upkeep is also decreased)</i>.\r\n    </>\r\n  ),\r\n});\r\nexport type GeneSlowMetabolism = typeof GeneSlowMetabolism;\r\n","import { Color, Vector2 } from \"three\";\r\nimport Chromosome from \"../../core/cell/chromosome\";\r\nimport Genome, { CellType } from \"../../core/cell/genome\";\r\nimport { GeneAttractsWater, GeneInventory, GeneLiving, GeneSoilAbsorption } from \"../genes\";\r\nimport { GeneAttractsSugar } from \"../genes/GeneAttractsSugar\";\r\nimport { GeneCannotFreeze } from \"../genes/GeneCannotFreeze\";\r\nimport { GeneObstacle } from \"../genes/GeneObstacle\";\r\nimport { GenePhotosynthesis } from \"../genes/GenePhotosynthesis\";\r\nimport { GeneFruit } from \"../genes/GeneReproducer\";\r\nimport { GeneTransport } from \"../genes/GeneTransport\";\r\n\r\nconst cellTypeTissue = new CellType(\r\n  \"Tissue\",\r\n  0,\r\n  new Chromosome(GeneLiving.level(2), GeneInventory.level(3)),\r\n  {\r\n    texturePosition: new Vector2(1, 1),\r\n    color: new Color(0x30ae25),\r\n  },\r\n  {\r\n    type: \"take\",\r\n    resources: \"water and sugar\",\r\n  }\r\n);\r\n\r\nconst cellTypeLeaf = new CellType(\r\n  \"Leaf\",\r\n  0,\r\n  new Chromosome(\r\n    GeneLiving.level(2),\r\n    GeneInventory.level(3),\r\n    GeneObstacle.level(0),\r\n    GenePhotosynthesis.level(1),\r\n    GeneAttractsWater.level(3)\r\n  ),\r\n  {\r\n    color: new Color(\"white\"),\r\n    texturePosition: new Vector2(2, 1),\r\n  },\r\n  {\r\n    type: \"give\",\r\n    resources: \"water take sugar\",\r\n  }\r\n);\r\n\r\nconst cellTypeRoot = new CellType(\r\n  \"Root\",\r\n  0,\r\n  new Chromosome(GeneLiving.level(2), GeneInventory.level(4), GeneObstacle.level(0), GeneSoilAbsorption.level(2)),\r\n  {\r\n    color: new Color(\"white\"),\r\n    texturePosition: new Vector2(3, 1),\r\n  },\r\n  {\r\n    type: \"take\",\r\n    resources: \"water and sugar\",\r\n  }\r\n);\r\n\r\nconst cellTypeTransport = new CellType(\r\n  \"Transport\",\r\n  0,\r\n  new Chromosome(GeneLiving.level(3), GeneInventory.level(3), GeneTransport.level(2)),\r\n  {\r\n    texturePosition: new Vector2(1, 1),\r\n    color: new Color(0x30ae25),\r\n  },\r\n  {\r\n    type: \"take\",\r\n    resources: \"water and sugar\",\r\n  }\r\n);\r\n\r\nconst cellTypeFruit = new CellType(\r\n  \"Fruit\",\r\n  0,\r\n  new Chromosome(\r\n    GeneLiving.level(2),\r\n    GeneInventory.level(0),\r\n    GeneObstacle.level(0),\r\n    GeneCannotFreeze.level(0),\r\n    GeneFruit.level(0),\r\n    GeneAttractsSugar.level(1),\r\n    GeneAttractsWater.level(1)\r\n  ),\r\n  {\r\n    texturePosition: new Vector2(0, 2),\r\n  },\r\n  {\r\n    type: \"give\",\r\n    resources: \"water and sugar\",\r\n  }\r\n);\r\n\r\nexport const standardGenome = new Genome([\r\n  cellTypeTissue,\r\n  cellTypeLeaf,\r\n  cellTypeRoot,\r\n  cellTypeTransport,\r\n  cellTypeFruit,\r\n]);\r\n","import { EventEmitter } from \"events\";\r\nimport { params } from \"game/params\";\r\nimport { sortBy } from \"lodash\";\r\nimport { Vector2 } from \"three\";\r\nimport {\r\n  PLAYER_BASE_SPEED,\r\n  PLAYER_INTERACT_EXCHANGE_NONCELL_SPEED,\r\n  PLAYER_INTERACT_EXCHANGE_SPEED,\r\n  PLAYER_MAX_RESOURCES,\r\n  PLAYER_STARTING_SUGAR,\r\n  PLAYER_STARTING_WATER,\r\n} from \"../constants\";\r\nimport { Steppable } from \"../entity\";\r\nimport { Inventory } from \"../inventory\";\r\nimport { Cell, FreezeEffect, GrowingCell, Tile } from \"../tile\";\r\nimport { World } from \"../world/world\";\r\nimport {\r\n  Action,\r\n  ActionBuild,\r\n  ActionDeconstruct,\r\n  ActionDrop,\r\n  ActionLong,\r\n  ActionMove,\r\n  ActionMultiple,\r\n  ActionPickup,\r\n  ActionRemoveCancer,\r\n  ActionThaw,\r\n} from \"./action\";\r\n\r\nexport class Player implements Steppable {\r\n  public inventory = new Inventory(PLAYER_MAX_RESOURCES, this, PLAYER_STARTING_WATER, PLAYER_STARTING_SUGAR);\r\n\r\n  private action?: Action;\r\n\r\n  private events = new EventEmitter();\r\n\r\n  public baseSpeed: number;\r\n\r\n  public dtSinceLastStepped = 0;\r\n\r\n  public get speed() {\r\n    const t = this.currentTile();\r\n    return this.baseSpeed * (Cell.is(t) ? t.moveSpeed : 1);\r\n  }\r\n\r\n  get pos() {\r\n    return this.posFloat.clone().round();\r\n  }\r\n\r\n  public constructor(public posFloat: Vector2, public world: World) {\r\n    this.baseSpeed = PLAYER_BASE_SPEED;\r\n  }\r\n\r\n  shouldStep() {\r\n    return true;\r\n  }\r\n\r\n  public setAction(action: Action) {\r\n    if (this.action != null) {\r\n      if (this.action.type === \"long\") {\r\n        // don't allow anything to happen during long actions.\r\n        return;\r\n      } else {\r\n        this.action = {\r\n          type: \"multiple\",\r\n          actions: [this.action, action],\r\n        };\r\n      }\r\n    } else {\r\n      if (action.type === \"build\" && action.cellType.chromosome.computeStaticProperties().isReproductive) {\r\n        this.action = {\r\n          type: \"long\",\r\n          duration: 4.5,\r\n          effect: action,\r\n          elapsed: 0,\r\n        };\r\n      } else {\r\n        this.action = action;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getAction() {\r\n    return this.action;\r\n  }\r\n\r\n  public droopY() {\r\n    const tile = this.world.tileAt(this.pos.x, this.pos.y);\r\n    if (Cell.is(tile)) {\r\n      return tile.droopY;\r\n    } else {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get this player's position taking into\r\n   * account the droop of the cell it's on.\r\n   */\r\n  public droopPosFloat() {\r\n    const droopY = this.droopY();\r\n    if (droopY !== 0) {\r\n      const t = this.posFloat.clone();\r\n      t.y += droopY;\r\n      return t;\r\n    }\r\n    return this.posFloat;\r\n  }\r\n\r\n  public currentTile() {\r\n    return this.world.tileAt(this.pos)!;\r\n  }\r\n\r\n  public findNearestWalkableCell() {\r\n    const startPos = this.world.isValidPosition(this.posFloat.x, this.posFloat.y)\r\n      ? this.pos\r\n      : new Vector2(this.world.width / 2, this.world.height / 2);\r\n    for (const tile of this.world.bfsIterator(startPos, this.world.width * this.world.height)) {\r\n      if (this.isWalkable(tile)) {\r\n        return tile;\r\n      }\r\n    }\r\n  }\r\n\r\n  public on(event: \"action\", cb: (action: Action) => void): void;\r\n\r\n  public on(event: \"action-fail\", cb: (action: Action, reason?: string) => void): void;\r\n\r\n  public on(event: \"start-long-action\", cb: (action: ActionLong) => void): void;\r\n\r\n  public on(event: string, cb: (...args: any[]) => void) {\r\n    this.events.on(event, cb);\r\n  }\r\n\r\n  public off(event: string, cb: (...args: any[]) => void) {\r\n    this.events.off(event, cb);\r\n  }\r\n\r\n  /**\r\n   * You're near the plant if one of your neighbors is a cell.\r\n   */\r\n  public isNearPlant() {\r\n    if (Cell.is(this.currentTile())) {\r\n      return true;\r\n    } else {\r\n      const neighbors = this.world.tileNeighbors(this.pos);\r\n      for (const n of neighbors.array) {\r\n        if (Cell.is(n)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public step(dt: number) {\r\n    if (!this.isNearPlant()) {\r\n      const nearestWalkableCell = this.findNearestWalkableCell();\r\n      if (nearestWalkableCell != null) {\r\n        this.world.logEvent({\r\n          type: \"oof\",\r\n          from: this.posFloat,\r\n          to: nearestWalkableCell,\r\n        });\r\n        this.posFloat.copy(nearestWalkableCell.pos);\r\n      }\r\n    }\r\n    if (this.action != null) {\r\n      this.attemptAction(this.action, dt);\r\n      if (this.action.type !== \"long\") {\r\n        this.action = undefined;\r\n      }\r\n    }\r\n    this.stepEdgePull();\r\n  }\r\n\r\n  /**\r\n   * While the player is off the plant, constantly pull them back. Creates an \"edge tether\" effect.\r\n   */\r\n  private stepEdgePull() {\r\n    if (!this.isWalkable(this.currentTile())) {\r\n      const neighbors = this.world.tileNeighbors(this.pos);\r\n      const walkableNeighbors = sortBy(\r\n        neighbors.array.filter(\r\n          (n) => this.isWalkable(n)\r\n          // && n.pos.manhattanDistanceTo(this.pos) === 1\r\n        ),\r\n        (n) => this.posFloat.distanceToSquared(n.pos)\r\n      ) as Cell[];\r\n      const [closest, secondClosest] = walkableNeighbors;\r\n\r\n      // always pull to closest\r\n      if (closest != null) {\r\n        EDGE_PULL_VELOCITY.set(0, 0);\r\n\r\n        // const forceClosest = 0.2;\r\n        // EDGE_PULL_VELOCITY.x += (closest.pos.x - this.posFloat.x) * forceClosest;\r\n        // EDGE_PULL_VELOCITY.y += (closest.pos.y - this.posFloat.y) * forceClosest;\r\n\r\n        let { x: newX, y: newY } = this.posFloat;\r\n        const dX = this.posFloat.x - closest.pos.x;\r\n        if (dX > 0.5) {\r\n          newX = closest.pos.x + 0.5;\r\n        } else if (dX < -0.5) {\r\n          newX = closest.pos.x - 0.5;\r\n        }\r\n        const dY = this.posFloat.y - closest.pos.y;\r\n        if (dY > 0.5) {\r\n          newY = closest.pos.y + 0.5;\r\n        } else if (dY < -0.5) {\r\n          newY = closest.pos.y - 0.5;\r\n        }\r\n        this.posFloat.set(newX, newY);\r\n\r\n        // // if the second closest is also touching the closest, pull to second closest as well.\r\n        // // effectively, this works on diagonals.\r\n        // if (secondClosest != null && closest.pos.distanceTo(secondClosest.pos) < 2) {\r\n        //   const forceSecondClosest = 0.1;\r\n        //   EDGE_PULL_VELOCITY.x += (secondClosest.pos.x - this.posFloat.x) * forceSecondClosest;\r\n        //   EDGE_PULL_VELOCITY.y += (secondClosest.pos.y - this.posFloat.y) * forceSecondClosest;\r\n        // }\r\n        // const edgeX = Math.floor(this.posFloat.x) + 0.5;\r\n        // const edgeY = Math.floor(this.posFloat.y) + 0.5;\r\n        // console.log(edgeY - this.posFloat.y);\r\n        // this.posFloat.add(EDGE_PULL_VELOCITY);\r\n      }\r\n    }\r\n  }\r\n\r\n  public attemptAction(action: Action, dt: number) {\r\n    const result = this._attemptAction(action, dt);\r\n    if (params.showGodUI) {\r\n      console.log(action);\r\n    }\r\n    if (result === true) {\r\n      this.events.emit(\"action\", action);\r\n    } else {\r\n      this.events.emit(\"action-fail\", action, result === false ? undefined : result);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  private _attemptAction(action: Action, dt: number): boolean | string {\r\n    switch (action.type) {\r\n      case \"move\":\r\n        return this.attemptMove(action, dt);\r\n      case \"build\":\r\n        return this.attemptBuild(action, dt);\r\n      case \"deconstruct\":\r\n        return this.attemptDeconstruct(action, dt);\r\n      case \"drop\":\r\n        return this.attemptDrop(action, dt);\r\n      case \"pickup\":\r\n        return this.attemptPickup(action, dt);\r\n      case \"multiple\":\r\n        return this.attemptMultiple(action, dt);\r\n      case \"long\":\r\n        return this.attemptLong(action, dt);\r\n      case \"thaw\":\r\n        return this.attemptThaw(action, dt);\r\n      case \"remove-cancer\":\r\n        return this.attemptRemoveCancer(action, dt);\r\n    }\r\n  }\r\n\r\n  public isWalkable(tile: Tile | null | undefined): tile is Cell {\r\n    if (tile == null) {\r\n      return false;\r\n    }\r\n    if (tile.isObstacle) {\r\n      return false;\r\n    }\r\n    if (Cell.is(tile)) {\r\n      return tile.findEffectOfType(FreezeEffect) == null;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public canBuildAt(tile: Tile | null): tile is Tile {\r\n    if (tile == null) {\r\n      return false;\r\n    }\r\n    if (Cell.is(tile)) {\r\n      return false;\r\n    }\r\n    if (tile.isObstacle) {\r\n      return false;\r\n    }\r\n\r\n    // you can build off any adjacent existing cell\r\n    const neighbors = this.world.tileNeighbors(tile.pos);\r\n    for (const n of neighbors.array) {\r\n      if (Cell.is(n) && !n.isObstacle) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  isTakingLongAction() {\r\n    return this.action != null && this.action.type === \"long\";\r\n  }\r\n\r\n  public attemptMove(action: ActionMove, dt: number) {\r\n    const nextPos = this.posFloat.clone().add(action.dir.clone().setLength(this.speed * dt));\r\n    const nextTile = this.world.tileAt(Math.round(nextPos.x), Math.round(nextPos.y));\r\n    if (nextTile != null) {\r\n      this.posFloat.copy(nextPos);\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptStill(_dt: number) {\r\n    // this.autopickup();\r\n    return true;\r\n  }\r\n\r\n  public canBuild(action: ActionBuild): true | string {\r\n    const existingTile = this.world.tileAt(action.position);\r\n    if (!this.canBuildAt(existingTile)) {\r\n      return `Can't build over ${existingTile!.displayName}!`;\r\n    }\r\n    const existingCell = this.world.cellAt(action.position.x, action.position.y);\r\n    if (existingCell != null) {\r\n      // don't allow building over\r\n      return `Deconstruct ${existingCell.displayName} first!`;\r\n    }\r\n\r\n    const { costSugar, costWater } = action.cellType.chromosome.computeStaticProperties();\r\n\r\n    const needWater = this.inventory.water < costWater;\r\n    const needSugar = this.inventory.sugar < costSugar;\r\n\r\n    if (needWater && needSugar) {\r\n      return \"Need water and sugar!\";\r\n    } else if (needWater && !needSugar) {\r\n      return \"Need water!\";\r\n    } else if (needSugar && !needWater) {\r\n      return \"Need sugar!\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public attemptBuild(action: ActionBuild, dt: number) {\r\n    const canBuild = this.canBuild(action);\r\n    if (canBuild !== true) {\r\n      return canBuild;\r\n    }\r\n\r\n    const { costSugar, costWater } = action.cellType.chromosome.computeStaticProperties();\r\n    this.inventory.add(-costWater, -costSugar);\r\n    const matureCell = new Cell(action.position, this.world, action.cellType, action.args);\r\n\r\n    let cell: Cell;\r\n    if (action.cellType.chromosome.computeStaticProperties().timeToBuild > 0) {\r\n      // special - drop a sugar when you grow, to cover for the sugar\r\n      // this.attemptDrop(\r\n      //   {\r\n      //     type: \"drop\",\r\n      //     sugar: 1 / dt,\r\n      //     water: 0,\r\n      //   },\r\n      //   dt\r\n      // );\r\n      cell = new GrowingCell(action.position, this.world, matureCell, this.currentTile().pos);\r\n      // this.inventory.give(cell.inventory, 0, 1);\r\n    } else {\r\n      cell = matureCell;\r\n    }\r\n    cell.droopY = this.droopY();\r\n    this.world.setTileAt(action.position, cell);\r\n    return true;\r\n  }\r\n\r\n  public attemptDeconstruct(action: ActionDeconstruct, _dt: number): boolean {\r\n    const cell = this.world.maybeRemoveCellAt(action.position);\r\n    if (cell != null) {\r\n      if (cell instanceof GrowingCell) {\r\n        // refund the resources back\r\n        const { costSugar, costWater } = cell.completedCell.type.chromosome.computeStaticProperties();\r\n        this.inventory.add(costWater, costSugar);\r\n      } else {\r\n        // refund half the cost\r\n        const { costSugar, costWater } = cell.type.chromosome.computeStaticProperties();\r\n        this.inventory.add(costWater / 2, costSugar / 2);\r\n      }\r\n\r\n      // maybeRemoveCellAt has already tried redistributing inventory to neighbors,\r\n      // but if it couldn't do that, as a last ditch, give resources directly to\r\n      // the player\r\n      cell.inventory.give(this.inventory, cell.inventory.water, cell.inventory.sugar);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public attemptDrop(action: ActionDrop, dt: number) {\r\n    // drop as much as you can onto the current tile\r\n    const target = action.target;\r\n    let { water: waterToDrop, sugar: sugarToDrop } = action;\r\n    if (action.continuous) {\r\n      waterToDrop *= PLAYER_INTERACT_EXCHANGE_SPEED * dt;\r\n      sugarToDrop *= PLAYER_INTERACT_EXCHANGE_SPEED * dt;\r\n    }\r\n\r\n    const { water, sugar } = this.inventory.give(target.inventory, waterToDrop, sugarToDrop);\r\n    return water > 0 || sugar > 0;\r\n  }\r\n\r\n  public attemptPickup(action: ActionPickup, dt: number) {\r\n    const target = action.target;\r\n    const inv = target.inventory;\r\n\r\n    let { water: waterToDrop, sugar: sugarToDrop } = action;\r\n    if (action.continuous) {\r\n      if (Cell.is(target)) {\r\n        waterToDrop *= PLAYER_INTERACT_EXCHANGE_SPEED * dt;\r\n        sugarToDrop *= PLAYER_INTERACT_EXCHANGE_SPEED * dt;\r\n      } else {\r\n        waterToDrop *= PLAYER_INTERACT_EXCHANGE_NONCELL_SPEED * dt;\r\n        sugarToDrop *= PLAYER_INTERACT_EXCHANGE_NONCELL_SPEED * dt;\r\n      }\r\n    }\r\n    const { water, sugar } = inv.give(this.inventory, waterToDrop, sugarToDrop);\r\n    return water > 0 || sugar > 0;\r\n  }\r\n\r\n  public attemptMultiple(multiple: ActionMultiple, dt: number) {\r\n    let allSuccess = true;\r\n    for (const action of multiple.actions) {\r\n      allSuccess = this.attemptAction(action, dt) === true && allSuccess;\r\n    }\r\n    return allSuccess;\r\n  }\r\n\r\n  /**\r\n   * long actions are reponsible for unsetting themselves.\r\n   */\r\n  public attemptLong(action: ActionLong, dt: number) {\r\n    if (action.elapsed === 0) {\r\n      // verify builds\r\n      if (action.effect.type === \"build\") {\r\n        const canBuild = this.canBuild(action.effect);\r\n        if (canBuild !== true) {\r\n          this.action = undefined;\r\n          return canBuild;\r\n        }\r\n      }\r\n      this.events.emit(\"start-long-action\", action);\r\n    }\r\n    action.elapsed += dt;\r\n    if (action.elapsed > action.duration) {\r\n      this.action = undefined;\r\n      const result = this.attemptAction(action.effect, dt);\r\n      return result;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptThaw(action: ActionThaw, dt: number) {\r\n    const { target } = action;\r\n    target.thaw(dt);\r\n    return true;\r\n  }\r\n\r\n  public attemptRemoveCancer(action: ActionRemoveCancer, dt: number) {\r\n    const { target } = action;\r\n    target.removeCancer(dt);\r\n    return true;\r\n  }\r\n}\r\n\r\nconst EDGE_PULL_VELOCITY = new Vector2();\r\n","export function sleep(millis: number) {\r\n  return new Promise((r) => {\r\n    setTimeout(r, millis);\r\n  });\r\n}\r\n","import { sleep } from \"common/promise\";\r\nimport { Vector2 } from \"three\";\r\nimport { Steppable } from \"../entity\";\r\nimport { Inventory } from \"../inventory\";\r\nimport { Air, Cell } from \"../tile\";\r\nimport { World } from \"../world/world\";\r\nimport { Player } from \"./player\";\r\nexport class PlayerSeed implements Steppable {\r\n  public readonly inventory = new Inventory(0, this);\r\n\r\n  public dtSinceLastStepped = 0;\r\n\r\n  private poppedOut = false;\r\n\r\n  public constructor(public posFloat: Vector2, public world: World, public player: Player) {}\r\n\r\n  shouldStep(): boolean {\r\n    return true;\r\n  }\r\n\r\n  get pos() {\r\n    return this.posFloat.clone().round();\r\n  }\r\n\r\n  step(dt: number): void {\r\n    const pos = this.pos;\r\n    const tileBelow = this.world.tileAt(pos.x, pos.y + 1);\r\n    if (Air.is(tileBelow)) {\r\n      // can keep going\r\n      const velY = Math.min(20 * dt, 1);\r\n      this.posFloat.y += velY;\r\n    } else {\r\n    }\r\n    this.player.posFloat.copy(this.posFloat);\r\n    if (this.poppedOut) {\r\n      this.world.removePlayerSeed();\r\n    }\r\n  }\r\n\r\n  popOut() {\r\n    const start = this.pos;\r\n    const c = new Cell(start, this.world, this.world.genome.cellTypes[0]);\r\n    this.world.setTileAt(start, c);\r\n    sleep(500).then(() => {\r\n      this.world.events.once(\"step\", () => {\r\n        Array.from(\r\n          this.world.bfsIterator(\r\n            start,\r\n            30,\r\n            (t) => !t.isObstacle && t.pos.distanceTo(start) < 2.5,\r\n            (t) => t.pos.distanceTo(start)\r\n          )\r\n        ).forEach((tile, i) => {\r\n          if (!Cell.is(tile)) {\r\n            const cell = new Cell(tile.pos, this.world, this.world.genome.cellTypes[0]);\r\n            // const growingCell = new GrowingCell(tile.pos, this.world, cell, start);\r\n            this.world.setTileAt(tile.pos, cell);\r\n          }\r\n        });\r\n      });\r\n    });\r\n    this.poppedOut = true;\r\n  }\r\n}\r\n","import { TIME_PER_DAY, TIME_PER_MONTH, TIME_PER_SEASON, TIME_PER_YEAR } from \"./constants\";\r\nexport interface Season {\r\n  year: number;\r\n  season: 0 | 1 | 2 | 3;\r\n  /**\r\n   * month 1, 2, or 3 in the season.\r\n   */\r\n  month: number;\r\n  /**\r\n   * Percent done with the season total.\r\n   */\r\n  percent: number;\r\n  day: number;\r\n}\r\n\r\nexport function seasonFromTime(time: number): Season {\r\n  const year = Math.floor(time / TIME_PER_YEAR);\r\n  const timeInYear = time % TIME_PER_YEAR;\r\n  const season = Math.floor(timeInYear / TIME_PER_SEASON) as Season[\"season\"];\r\n  const percent = (timeInYear % TIME_PER_SEASON) / TIME_PER_SEASON;\r\n  const month = Math.floor((timeInYear % TIME_PER_SEASON) / TIME_PER_MONTH) + 1;\r\n  const day = Math.floor((timeInYear % TIME_PER_MONTH) / TIME_PER_DAY) + 1;\r\n  return {\r\n    year,\r\n    season,\r\n    percent,\r\n    month,\r\n    day,\r\n  };\r\n}\r\n\r\nexport const SEASON_NAMES = [\"Spring\", \"Summer\", \"Fall\", \"Winter\"];\r\n\r\nexport function seasonDisplay(s: Season) {\r\n  return `${s.year > 0 ? `Year ${s.year}, ` : \"\"}${SEASON_NAMES[s.season]}, Month ${s.month}`;\r\n}\r\n","import { Entity } from \"../entity\";\r\nimport { EventPhotosynthesis, TileEvent, TileEventType } from \"../tile/tileEvent\";\r\n\r\nexport class StepStats {\r\n  public events: TileEventLog = {\r\n    \"cell-eat\": [],\r\n    \"cell-transfer-energy\": [],\r\n    evaporation: [],\r\n    photosynthesis: [],\r\n    thaw: [],\r\n    \"collect-sunlight\": [],\r\n    \"grow-fruit\": [],\r\n    oof: [],\r\n  };\r\n\r\n  /**\r\n   * All the changes between `frame` to `frame+1`.\r\n   */\r\n  constructor(public frame: number, public deleted: Entity[] = [], public added: Entity[] = []) {}\r\n\r\n  logEvent(event: TileEvent) {\r\n    this.events[event.type].push(event);\r\n  }\r\n}\r\n\r\nexport type TileEventLog = {\r\n  [K in TileEventType]: TileEvent[];\r\n} & {\r\n  photosynthesis: EventPhotosynthesis[];\r\n};\r\n","import { EventEmitter } from \"events\";\r\nimport { params } from \"game/params\";\r\nimport { maxBy, minBy } from \"lodash\";\r\nimport { Vector2 } from \"three\";\r\nimport { Cell, GrowingCell } from \"./cell\";\r\nimport { PLAYER_INTERACT_EXCHANGE_SPEED } from \"./constants\";\r\nimport { Steppable } from \"./entity\";\r\nimport { Inventory } from \"./inventory\";\r\nimport {\r\n  Action,\r\n  ActionBuild,\r\n  ActionDeconstruct,\r\n  ActionDrop,\r\n  ActionLong,\r\n  ActionMove,\r\n  ActionMultiple,\r\n  ActionPickup,\r\n  ActionRemoveCancer,\r\n  ActionThaw,\r\n} from \"./player/action\";\r\nimport { Air, Tile } from \"./tile\";\r\nimport { World } from \"./world/world\";\r\nexport class Insect implements Steppable {\r\n  private events = new EventEmitter();\r\n\r\n  public inventory = new Inventory(10, this);\r\n\r\n  private action?: Action;\r\n\r\n  public dtSinceLastStepped = 0;\r\n\r\n  public speed: number = 3.2;\r\n\r\n  get pos() {\r\n    return this.posFloat.clone().round();\r\n  }\r\n\r\n  constructor(public posFloat: Vector2, public world: World) {\r\n    posFloat.clamp(world.minVector, world.maxVector);\r\n  }\r\n\r\n  shouldStep() {\r\n    return true;\r\n  }\r\n\r\n  public setAction(action: Action) {\r\n    if (this.action != null) {\r\n      if (this.action.type === \"long\") {\r\n        // don't allow anything to happen during long actions.\r\n        return;\r\n      } else {\r\n        this.action = {\r\n          type: \"multiple\",\r\n          actions: [this.action, action],\r\n        };\r\n      }\r\n    } else {\r\n      if (action.type === \"build\" && action.cellType.chromosome.computeStaticProperties().isReproductive) {\r\n        this.action = {\r\n          type: \"long\",\r\n          duration: 4.5,\r\n          effect: action,\r\n          elapsed: 0,\r\n        };\r\n      } else {\r\n        this.action = action;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getAction() {\r\n    return this.action;\r\n  }\r\n\r\n  public currentTile() {\r\n    return this.world.tileAt(this.pos)!;\r\n  }\r\n\r\n  public findNearestWalkableCell() {\r\n    for (const tile of this.world.bfsIterator(this.pos, this.world.width * this.world.height)) {\r\n      if (this.isWalkable(tile)) {\r\n        return tile;\r\n      }\r\n    }\r\n  }\r\n\r\n  public on(event: \"action\", cb: (action: Action) => void): void;\r\n\r\n  public on(event: \"action-fail\", cb: (action: Action, reason?: string) => void): void;\r\n\r\n  public on(event: \"start-long-action\", cb: (action: ActionLong) => void): void;\r\n\r\n  public on(event: string, cb: (...args: any[]) => void) {\r\n    this.events.on(event, cb);\r\n  }\r\n\r\n  public off(event: string, cb: (...args: any[]) => void) {\r\n    this.events.off(event, cb);\r\n  }\r\n\r\n  public step(dt: number) {\r\n    // this.maybeMoveWithTransports(dt);\r\n    // if (!this.isWalkable(this.currentTile())) {\r\n    //   const nearestWalkableCell = this.findNearestWalkableCell();\r\n    //   if (nearestWalkableCell != null) {\r\n    //     this.world.logEvent({\r\n    //       type: \"oof\",\r\n    //       from: this.posFloat,\r\n    //       to: nearestWalkableCell,\r\n    //     });\r\n    //     this.posFloat.copy(nearestWalkableCell.pos);\r\n    //   }\r\n    // }\r\n    if (this.action == null) {\r\n      this.findNextAction();\r\n    }\r\n    if (this.action != null) {\r\n      this.attemptAction(this.action, dt);\r\n      if (this.action.type !== \"long\") {\r\n        this.action = undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  public findNextAction() {\r\n    // if we don't have food, find a Cell and eat it\r\n    // const thisDist = this.currentTile().closestCellDistance;\r\n    const neighbors = this.world\r\n      .tileNeighbors(this.pos)\r\n      .array.filter((t) => t.pos.manhattanDistanceTo(this.pos) < 2 && (Air.is(t) || Cell.is(t)));\r\n    if (this.inventory.sugar < 1) {\r\n      const target = minBy(neighbors, (tile) => tile.closestCellAirDistance);\r\n      if (Air.is(target)) {\r\n        this.setAction({\r\n          type: \"move\",\r\n          dir: target.pos\r\n            .clone()\r\n            .sub(this.posFloat)\r\n            .normalize(),\r\n        });\r\n      } else if (Cell.is(target)) {\r\n        this.setAction({\r\n          type: \"deconstruct\",\r\n          position: target.pos,\r\n          force: true,\r\n        });\r\n        // this.setAction({\r\n        //   type: \"long\",\r\n        //   duration: 3,\r\n        //   effect: {\r\n        //     type: \"deconstruct\",\r\n        //     position: target.pos,\r\n        //     force: true,\r\n        //   },\r\n        //   elapsed: 0,\r\n        // });\r\n      }\r\n    } else {\r\n      // insect is full; run away\r\n      const target = maxBy(neighbors, (tile) => tile.closestCellAirDistance);\r\n      if (this.world.isAtEdge(this.pos)) {\r\n        this.world.removeInsect(this);\r\n      }\r\n      if (target != null) {\r\n        this.setAction({\r\n          type: \"move\",\r\n          dir: target.pos\r\n            .clone()\r\n            .sub(this.posFloat)\r\n            .normalize(),\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  public attemptAction(action: Action, dt: number) {\r\n    const result = this._attemptAction(action, dt);\r\n    if (params.showGodUI) {\r\n      console.log(action);\r\n    }\r\n    if (result === true) {\r\n      this.events.emit(\"action\", action);\r\n    } else {\r\n      this.events.emit(\"action-fail\", action, result === false ? undefined : result);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  private _attemptAction(action: Action, dt: number): boolean | string {\r\n    switch (action.type) {\r\n      case \"move\":\r\n        return this.attemptMove(action, dt);\r\n      case \"build\":\r\n        return this.attemptBuild(action, dt);\r\n      case \"deconstruct\":\r\n        return this.attemptDeconstruct(action, dt);\r\n      case \"drop\":\r\n        return this.attemptDrop(action, dt);\r\n      case \"pickup\":\r\n        return this.attemptPickup(action, dt);\r\n      case \"multiple\":\r\n        return this.attemptMultiple(action, dt);\r\n      case \"long\":\r\n        return this.attemptLong(action, dt);\r\n      case \"thaw\":\r\n        return this.attemptThaw(action, dt);\r\n      case \"remove-cancer\":\r\n        return this.attemptRemoveCancer(action, dt);\r\n    }\r\n  }\r\n\r\n  public isWalkable(pos: Tile): pos is Air;\r\n\r\n  public isWalkable(pos: Vector2): boolean;\r\n\r\n  public isWalkable(pos: Tile | Vector2) {\r\n    const tile = pos instanceof Vector2 ? this.world.tileAt(Math.round(pos.x), Math.round(pos.y)) : pos;\r\n    if (!Air.is(tile) || tile.isObstacle) {\r\n      // can't move!\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public canBuildAt(tile: Tile | null): tile is Tile {\r\n    if (tile == null) {\r\n      return false;\r\n    } else if (Cell.is(tile)) {\r\n      return false;\r\n    } else {\r\n      return !tile.isObstacle;\r\n    }\r\n  }\r\n\r\n  isTakingLongAction() {\r\n    return this.action != null && this.action.type === \"long\";\r\n  }\r\n\r\n  public attemptMove(action: ActionMove, dt: number) {\r\n    const nextPos = this.posFloat.clone().add(action.dir.clone().setLength(this.speed * dt));\r\n    if (this.isWalkable(nextPos)) {\r\n      // const t = this.currentTile();\r\n      // if (Cell.is(t)) {\r\n      //   if (t.temperature < 40) {\r\n      //     t.nextTemperature += 0.2;\r\n      //   }\r\n      //   else if (t.temperature > 60) {\r\n      //     t.nextTemperature -= 0.2;\r\n      //   }\r\n      // }\r\n      // do the move\r\n      this.posFloat.copy(nextPos);\r\n      // this._pos = this.posFloat.clone().round();\r\n      // this.autopickup();\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptStill(_dt: number) {\r\n    // this.autopickup();\r\n    return true;\r\n  }\r\n\r\n  public canBuild(action: ActionBuild): true | string {\r\n    const existingTile = this.world.tileAt(action.position);\r\n    if (!this.canBuildAt(existingTile)) {\r\n      return `Can't build over ${existingTile!.displayName}!`;\r\n    }\r\n    const existingCell = this.world.cellAt(action.position.x, action.position.y);\r\n    if (existingCell != null) {\r\n      // don't allow building over\r\n      return `Deconstruct ${existingCell.displayName} first!`;\r\n    }\r\n\r\n    const { costSugar, costWater } = action.cellType.chromosome.computeStaticProperties();\r\n\r\n    const needWater = this.inventory.water < costWater;\r\n    const needSugar = this.inventory.sugar < costSugar;\r\n\r\n    if (needWater && needSugar) {\r\n      return \"Need water and sugar!\";\r\n    } else if (needWater && !needSugar) {\r\n      return \"Need water!\";\r\n    } else if (needSugar && !needWater) {\r\n      return \"Need sugar!\";\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public attemptBuild(action: ActionBuild, dt: number) {\r\n    const canBuild = this.canBuild(action);\r\n    if (canBuild !== true) {\r\n      return canBuild;\r\n    }\r\n\r\n    const { costSugar, costWater } = action.cellType.chromosome.computeStaticProperties();\r\n    this.inventory.add(-costWater, -costSugar);\r\n    const matureCell = new Cell(action.position, this.world, action.cellType, action.args);\r\n\r\n    let cell: Cell;\r\n    if (action.cellType.chromosome.computeStaticProperties().timeToBuild > 0) {\r\n      // special - drop a sugar when you grow, to cover for the sugar\r\n      // this.attemptDrop(\r\n      //   {\r\n      //     type: \"drop\",\r\n      //     sugar: 1 / dt,\r\n      //     water: 0,\r\n      //   },\r\n      //   dt\r\n      // );\r\n      cell = new GrowingCell(action.position, this.world, matureCell, this.currentTile().pos);\r\n      // this.inventory.give(cell.inventory, 0, 1);\r\n    } else {\r\n      cell = matureCell;\r\n    }\r\n    this.world.setTileAt(action.position, cell);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * For insects, this is actually a \"destroy\" where it gets your resources\r\n   * and\r\n   */\r\n  public attemptDeconstruct(action: ActionDeconstruct, _dt: number): boolean {\r\n    const cell = this.world.cellAt(action.position);\r\n    if (cell != null) {\r\n      cell.inventory.give(this.inventory, cell.inventory.water, cell.inventory.sugar);\r\n      const { costSugar, costWater } = cell.type.chromosome.computeStaticProperties();\r\n      this.inventory.add(costWater, costSugar);\r\n      this.world.maybeRemoveCellAt(cell.pos);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public attemptDrop(action: ActionDrop, dt: number) {\r\n    // drop as much as you can onto the current tile\r\n    const target = action.target;\r\n    let { water: waterToDrop, sugar: sugarToDrop } = action;\r\n    if (action.continuous) {\r\n      waterToDrop *= PLAYER_INTERACT_EXCHANGE_SPEED * dt;\r\n      sugarToDrop *= PLAYER_INTERACT_EXCHANGE_SPEED * dt;\r\n    }\r\n\r\n    const { water, sugar } = this.inventory.give(target.inventory, waterToDrop, sugarToDrop);\r\n    return water > 0 || sugar > 0;\r\n  }\r\n\r\n  public attemptPickup(action: ActionPickup, dt: number) {\r\n    const target = action.target;\r\n    const inv = target.inventory;\r\n\r\n    let { water: waterToDrop, sugar: sugarToDrop } = action;\r\n    if (action.continuous) {\r\n      waterToDrop *= PLAYER_INTERACT_EXCHANGE_SPEED * dt;\r\n      sugarToDrop *= PLAYER_INTERACT_EXCHANGE_SPEED * dt;\r\n    }\r\n    const { water, sugar } = inv.give(this.inventory, waterToDrop, sugarToDrop);\r\n    return water > 0 || sugar > 0;\r\n  }\r\n\r\n  public attemptMultiple(multiple: ActionMultiple, dt: number) {\r\n    let allSuccess = true;\r\n    for (const action of multiple.actions) {\r\n      allSuccess = this.attemptAction(action, dt) === true && allSuccess;\r\n    }\r\n    return allSuccess;\r\n  }\r\n\r\n  /**\r\n   * long actions are reponsible for unsetting themselves.\r\n   */\r\n  public attemptLong(action: ActionLong, dt: number) {\r\n    if (action.elapsed === 0) {\r\n      // verify builds\r\n      if (action.effect.type === \"build\") {\r\n        const canBuild = this.canBuild(action.effect);\r\n        if (canBuild !== true) {\r\n          this.action = undefined;\r\n          return canBuild;\r\n        }\r\n      }\r\n      this.events.emit(\"start-long-action\", action);\r\n    }\r\n    action.elapsed += dt;\r\n    if (action.elapsed > action.duration) {\r\n      this.action = undefined;\r\n      const result = this.attemptAction(action.effect, dt);\r\n      return result;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptThaw(action: ActionThaw, dt: number) {\r\n    const { target } = action;\r\n    target.thaw(dt);\r\n    return true;\r\n  }\r\n\r\n  public attemptRemoveCancer(action: ActionRemoveCancer, dt: number) {\r\n    const { target } = action;\r\n    target.removeCancer(dt);\r\n    return true;\r\n  }\r\n}\r\n","export function arrayRange<T = number>(length: number, fill?: T | ((i: number) => T)): T[] {\r\n  return new Array(length).fill(undefined).map((_, i) => {\r\n    if (typeof fill === \"function\") {\r\n      return (fill as any)(i) as T;\r\n    } else if (fill === undefined) {\r\n      return i;\r\n    } else {\r\n      return fill;\r\n    }\r\n  }) as T[];\r\n}\r\n\r\nexport function gridRange<T>(width: number, height: number, fill: (x: number, y: number) => T) {\r\n  return arrayRange(width, (x) => arrayRange(height, (y) => fill(x, y)));\r\n}\r\n","import { World } from \"core\";\r\nimport { Fountain, Rock, Tile } from \"core/tile\";\r\nimport { clamp } from \"lodash\";\r\nimport { map, randInt } from \"math\";\r\nimport { Vector2 } from \"three\";\r\nimport { Constructor } from \"typings/constructor\";\r\nimport { DIRECTIONS, Directions } from \"./directions\";\r\nimport { Air } from \"./tile/air\";\r\nimport { Clay, Sand, Silt } from \"./tile/soil\";\r\n\r\nexport type TileGenerator = (pos: Vector2, world: World) => Tile | undefined;\r\n\r\nexport type TileCombiner = (...generators: TileGenerator[]) => TileGenerator;\r\n\r\nexport type TileScalar = (pos: Vector2, world: World) => number;\r\n\r\nexport function toScalar(number: number): TileScalar {\r\n  return (pos, world) => number;\r\n}\r\n\r\n/**\r\n * The later ones take precedence over earlier ones.\r\n */\r\nexport const layers: TileCombiner = (...gens: TileGenerator[]): TileGenerator => {\r\n  const gensReversed = gens.reverse();\r\n  return (pos, world) => {\r\n    for (const generator of gensReversed) {\r\n      const tile = generator(pos, world);\r\n      if (tile) {\r\n        return tile;\r\n      }\r\n    }\r\n  };\r\n};\r\n\r\nexport function fill(type: Constructor<Tile>): TileGenerator {\r\n  return (pos, world) => new type(pos, world);\r\n}\r\n\r\nexport function predicate(predicate: (pos: Vector2, world: World) => boolean): TileCombiner {\r\n  return (...generators: TileGenerator[]): TileGenerator => {\r\n    const gens = layers(...generators);\r\n    return (pos, world) => {\r\n      if (predicate(pos, world)) {\r\n        return gens(pos, world);\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\n/**\r\n * Take an existing tile combiner, and reverse it\r\n */\r\nexport function not(original: TileGenerator): TileCombiner {\r\n  return (...generators) => {\r\n    const gen = layers(...generators);\r\n\r\n    return (pos, world) => {\r\n      const t = original(pos, world);\r\n      if (t != null) {\r\n        return undefined;\r\n      } else {\r\n        return gen(pos, world);\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\nexport function modify(cb: (tile: Tile) => void): TileCombiner {\r\n  return (...generators) => {\r\n    const gen = layers(...generators);\r\n    return (pos, world) => {\r\n      const t = gen(pos, world);\r\n      if (t != null) {\r\n        cb(t);\r\n      }\r\n      return t;\r\n    };\r\n  };\r\n}\r\n\r\nexport const addWater = modify((tile: Tile) => {\r\n  const { heightScalar, waterValue } = tile.world.generatorInfo(tile.pos);\r\n  const water = clamp(\r\n    // create patches of dry and wet\r\n    (waterValue > 0.4 ? heightScalar : 0) *\r\n      // upscale the slope of waterValue - waterValue is a 5x5 simplex\r\n      // 1x1 simplex's max slope is around 0.707 (i think?); for 5x5\r\n      // that slope is reduced to .141. We (* 30) to increase the max slope\r\n      // to 4.24. So at its max, two adjacent Soils will start with\r\n      // ~4 water difference\r\n      30,\r\n    // at least have 1 water\r\n    1,\r\n    // clamp at 10\r\n    10\r\n  );\r\n  tile.inventory.set(water, 0);\r\n});\r\n\r\nexport const withoutWater = modify((tile) => {\r\n  tile.inventory.set(0, 0);\r\n});\r\n\r\nexport const addDeepWater = modify((s) => {\r\n  const { world } = s;\r\n  const { y } = s.pos;\r\n  // add a *lot* of water near the bottom quarter of the map\r\n  const water = clamp(map(y, world.height * 0.75, world.height, 1, 9), 1, 10);\r\n  s.inventory.set(water, 0);\r\n});\r\n\r\nexport const inSoil = predicate((pos, world) => {\r\n  const { soilLevel } = world.generatorInfo(pos);\r\n  const { y } = pos;\r\n  return y > soilLevel;\r\n});\r\n\r\nexport const inSoilFlat = predicate((pos, world) => {\r\n  const { soilLevelFlat } = world.generatorInfo(pos);\r\n  return pos.y > soilLevelFlat;\r\n});\r\n\r\nexport function betweenSoilFlatDepth(min: number, max: number) {\r\n  return predicate((pos, world) => {\r\n    const { soilLevelFlat } = world.generatorInfo(pos);\r\n    const { y } = pos;\r\n    return y - soilLevelFlat > min && y - soilLevelFlat < max;\r\n  });\r\n}\r\n\r\nexport function inRockLevel(midLevel = -0.8, bottomLevel = 0.3, wavelength = 5) {\r\n  return predicate((pos, world) => {\r\n    const { x, y } = pos;\r\n    const { generatorContext, height } = world;\r\n    const rockLevel = generatorContext.noiseRock.simplex2(x / wavelength, y / wavelength);\r\n    const rockBias = map(y - height / 2, 0, height / 2, midLevel, bottomLevel);\r\n    return rockBias - rockLevel > 0;\r\n  });\r\n}\r\n\r\nexport function pastSoilDepth(level: number) {\r\n  return predicate((pos, world) => {\r\n    const { soilLevel } = world.generatorInfo(pos);\r\n    const { y } = pos;\r\n    return y - soilLevel > level;\r\n  });\r\n}\r\n\r\nexport function betweenSoilDepth(min: number, max: number) {\r\n  return predicate((pos, world) => {\r\n    const { soilLevel } = world.generatorInfo(pos);\r\n    const { y } = pos;\r\n    return y - soilLevel > min && y - soilLevel < max;\r\n  });\r\n}\r\n\r\n/**\r\n * heightScalar * waterValue > 1\r\n */\r\nexport const nearDeepWaterMaxima = predicate((pos, world) => {\r\n  const { heightScalar, waterValue } = world.generatorInfo(pos);\r\n  return heightScalar * waterValue > 1;\r\n});\r\n\r\n/**\r\n * waterValue > 0.93\r\n */\r\nexport const nearWaterMaxima = predicate((pos, world) => {\r\n  const { waterValue } = world.generatorInfo(pos);\r\n  return waterValue > 0.93;\r\n});\r\n\r\nexport const atMaxima = (scalar: TileScalar) =>\r\n  predicate((pos, world) => {\r\n    const value = scalar(pos, world);\r\n    let dirName: Directions;\r\n    for (dirName in DIRECTIONS) {\r\n      const dir = DIRECTIONS[dirName];\r\n      const dValue = scalar(pos.clone().add(dir), world);\r\n      if (dValue > value) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  });\r\n\r\n// on average every 5x5 square will hit this once\r\nexport const atWaterMaxima = atMaxima((pos, world) => world.generatorInfo(pos).waterValue);\r\n\r\nexport const air = fill(Air);\r\nexport const rock = fill(Rock);\r\nexport const silt = addWater(fill(Silt));\r\nexport const clay = addWater(fill(Clay));\r\nexport const sand = addWater(fill(Sand));\r\n\r\nexport const fountain: TileGenerator = (pos, world) => {\r\n  const { heightScalar, waterValue } = world.generatorInfo(pos);\r\n  const emitWaterScalar = Math.min(heightScalar * waterValue, 1);\r\n  const { y } = pos;\r\n  return new Fountain(\r\n    pos,\r\n    world,\r\n    Math.round(3 / emitWaterScalar),\r\n    map(y, world.height / 2, world.height, 100, 300) + randInt(-10, 10)\r\n  );\r\n};\r\n\r\nexport const smallFountain: TileGenerator = (pos, world) => {\r\n  return new Fountain(pos, world, 3, 75 + randInt(-10, 10));\r\n};\r\n\r\nexport const largeFountain: TileGenerator = (pos, world) => {\r\n  return new Fountain(pos, world, 1, 500);\r\n};\r\n","import { World } from \"core\";\r\nimport { Directions, DIRECTIONS } from \"core/directions\";\r\nimport { sortBy } from \"lodash\";\r\nimport { Matrix3, Vector2 } from \"three\";\r\nimport { Rock, Tile } from \"../core/tile\";\r\nimport { Clay, Sand, Silt } from \"../core/tile/soil\";\r\nimport {\r\n  addDeepWater,\r\n  air,\r\n  atMaxima,\r\n  atWaterMaxima,\r\n  betweenSoilDepth,\r\n  clay,\r\n  fountain,\r\n  inRockLevel,\r\n  inSoil,\r\n  inSoilFlat,\r\n  largeFountain,\r\n  layers,\r\n  modify,\r\n  nearDeepWaterMaxima,\r\n  nearWaterMaxima,\r\n  not,\r\n  pastSoilDepth,\r\n  predicate,\r\n  rock,\r\n  sand,\r\n  silt,\r\n  smallFountain,\r\n  TileCombiner,\r\n  TileGenerator,\r\n  TileScalar,\r\n  toScalar,\r\n  withoutWater,\r\n} from \"../core/tileGenerator\";\r\nimport { clamp, logistic, map, mod } from \"../math\";\r\n\r\nconst mixedSoilRockSmall: TileGenerator = (pos, world) => {\r\n  const { noiseSoil } = world.generatorContext;\r\n  const { x, y } = pos;\r\n  const level = noiseSoil.octaveSimplex2(x / 10, y / 10);\r\n  const s = new (level < -0.37 ? Sand : level < 0.37 ? Silt : level < 1.2 ? Clay : Rock)(pos, world);\r\n  const water = clamp(level * 30, 1, 20);\r\n  s.inventory.add(water, 0);\r\n  return s;\r\n};\r\n\r\nconst mixedSoilRockMed: TileGenerator = (pos, world) => {\r\n  const { noiseSoil } = world.generatorContext;\r\n  const { x, y } = pos;\r\n  const level = noiseSoil.octaveSimplex2(x / 15 + 19.3291, y / 15 + 595.3, 3, 0.4);\r\n  const s = new (level < -0.5 ? Sand : level < 0.5 ? Silt : Clay)(pos, world);\r\n  const water = clamp(level * 30, 1, 20);\r\n  s.inventory.add(water, 0);\r\n  return s;\r\n};\r\n\r\nexport function skewX(amount: number): TileCombiner {\r\n  return (...generators: TileGenerator[]): TileGenerator => {\r\n    const gen = layers(...generators);\r\n    return (pos, world) => {\r\n      const newY = Math.round(pos.y + (world.width / 2 - pos.x) * amount);\r\n      const skewPos = new Vector2(pos.x, newY);\r\n      const tile = gen(skewPos, world);\r\n      if (tile) {\r\n        tile.pos = pos;\r\n        return tile;\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\nexport const transformFn = (newPosFn: (pos: Vector2, world: World) => Vector2): TileCombiner => {\r\n  return (...generators) => {\r\n    const gen = layers(...generators);\r\n    return (pos, world) => {\r\n      const newPos = newPosFn(pos.clone(), world);\r\n      const tile = gen(newPos, world);\r\n      if (tile) {\r\n        tile.pos = pos;\r\n        return tile;\r\n      }\r\n    };\r\n  };\r\n};\r\n\r\nexport function transform(matrix: Matrix3): TileCombiner {\r\n  return transformFn((pos, world) => pos.applyMatrix3(matrix));\r\n}\r\n\r\nexport function translate(x: number, y: number): TileCombiner {\r\n  return transform(new Matrix3().translate(x, y));\r\n}\r\n\r\nexport function translateX(x: number) {\r\n  return translate(x, 0);\r\n}\r\n\r\nexport function translateY(y: number) {\r\n  return translate(0, y);\r\n}\r\n\r\nexport function rotate(theta: number) {\r\n  return transform(new Matrix3().rotate(theta));\r\n}\r\n\r\nexport function scale(sx: number, sy: number) {\r\n  return transform(new Matrix3().scale(sx, sy));\r\n}\r\n\r\n/**\r\n * The center of the map gets translated up by `tall` tiles. This falls off\r\n * with a logistic curve of steepness `k` over `width` pixels.\r\n */\r\nexport const moundShape = (wide: number, tall: number, k = 1) =>\r\n  transformFn((pos, world) => {\r\n    const dy = tall * logistic(map(Math.abs(pos.x - world.width / 2), 0, wide, 6, -6), k);\r\n    pos.y += dy;\r\n    return pos;\r\n  });\r\n\r\nexport const inLarge0 = predicate((pos, world) => world.generatorInfo(pos).large0 > 0.5);\r\n\r\nexport const nearLarge0Maxima = (threshold: number = 0.93) =>\r\n  predicate((pos, world) => world.generatorInfo(pos).large0 > threshold);\r\n\r\nconst Level0: TileGenerator = layers(\r\n  air,\r\n  // skewX(0.75)\r\n  inSoil(\r\n    silt,\r\n    pastSoilDepth(8)(nearDeepWaterMaxima(fountain)),\r\n    betweenSoilDepth(5, 13)(nearWaterMaxima(smallFountain)),\r\n    inRockLevel(-0.8, 0.3)(rock)\r\n  )\r\n  // inPillar(mixedSoilRock)\r\n);\r\n\r\nconst Temperate: TileGenerator = layers(\r\n  air,\r\n  inSoil(\r\n    mixedSoilRockSmall,\r\n    pastSoilDepth(8)(nearDeepWaterMaxima(fountain)),\r\n    betweenSoilDepth(5, 13)(nearWaterMaxima(smallFountain)),\r\n    inRockLevel(-0.7, 0.3)(rock)\r\n  )\r\n);\r\n\r\nconst Desert: TileGenerator = layers(\r\n  air,\r\n  inSoilFlat(\r\n    addDeepWater(mixedSoilRockSmall),\r\n    // wavelength 4 creates much more single dot rocks.\r\n    // -0.4 at bottom creates more open space\r\n    inRockLevel(-0.8, -0.4, 4)(rock)\r\n  )\r\n);\r\n\r\n/**\r\n * Whether the a 10x10 simplex2 is > rockThreshold\r\n */\r\nconst inBigRock = (rockThreshold: TileScalar = (pos, world) => map(pos.y, 0, world.height, 1, 0)) =>\r\n  predicate((pos, world) => {\r\n    const { generatorContext } = world;\r\n    const { noiseRock } = generatorContext;\r\n    const { x, y } = pos;\r\n    const isRock = noiseRock.simplex2(x / 10, y / 10) > rockThreshold(pos, world);\r\n    return isRock;\r\n  });\r\n\r\n/**\r\n * Only when original is defined, then run the generators, or default to original.\r\n */\r\nconst onlyIn = (original: TileGenerator): TileCombiner => (...generators) => {\r\n  const gen = layers(...generators);\r\n  return (pos, world) => {\r\n    const tile = original(pos, world);\r\n    if (tile != null) {\r\n      return gen(pos, world) || tile;\r\n    }\r\n  };\r\n};\r\n\r\nconst Rocky: TileGenerator = layers(\r\n  air,\r\n  onlyIn(\r\n    // put soil level 5 y lower; creates more space for the rocks to live\r\n    skewX(0.4)(translateY(-5)(inSoil(silt)))\r\n  )(\r\n    // sprinkle fountains all around\r\n    atWaterMaxima(smallFountain)\r\n  ),\r\n  // rocks can go up to 5 tiles above the final soil level (plus more on edges where skewed)\r\n  inSoil(inBigRock()(rock))\r\n);\r\n\r\n/**\r\n * Creates an axis aligned, non-random checkerboard pattern. You can round the edges of the\r\n * checkboard by bumping the threshold between 1.0 and 2.0.\r\n *\r\n * At threshold 0 we basically fill the entire space.\r\n *\r\n * At threshold 1.0 we'll make perfect diamonds that touch each other (50% coverage).\r\n *\r\n * At threshold 2.0 we basically miss entirely, because of the sampling rate.\r\n */\r\nconst roundedCheckerboard = (wavelength: number, threshold: number = 1.2) =>\r\n  predicate((pos, world) => {\r\n    const { x, y } = pos;\r\n    // sin(x)**2 + cos(y)**2 ranges in [-0.3, 2.3], with intrinsic wavelength PI.\r\n    const c = Math.sin(Math.PI * (x / wavelength)) ** 2 + Math.cos(Math.PI * (y / wavelength)) ** 2;\r\n    return c > threshold;\r\n  });\r\n\r\n// only if all generators return a value, return the last one.\r\nconst and: TileCombiner = (...generators) => {\r\n  return (pos, world) => {\r\n    let tile: Tile | undefined;\r\n    for (const g of generators) {\r\n      tile = g(pos, world);\r\n      if (tile == null) {\r\n        return;\r\n      }\r\n    }\r\n    return tile;\r\n  };\r\n};\r\n\r\n//prettier-ignore\r\nconst Reservoires: TileGenerator = layers(\r\n  air,\r\n  inSoil(\r\n    mixedSoilRockMed,\r\n    pastSoilDepth(1)(\r\n      and(\r\n        rotate(-Math.PI * 0.05)(\r\n          roundedCheckerboard(12, 1.2)(rock)\r\n        ),\r\n        not(translateY(2)(\r\n          rotate(-Math.PI * 0.05)(\r\n            roundedCheckerboard(12, 1.2)(rock)\r\n          )\r\n        ))(rock),\r\n      ),\r\n    )\r\n  )\r\n);\r\n\r\nconst inSkySoil = (p: number) =>\r\n  predicate((pos, world) => {\r\n    const { noiseHeight } = world.generatorContext;\r\n    const { x, y } = pos;\r\n\r\n    // this is basically roundedCheckerboard with a slight rotation and a wavelength of 7.85\r\n    // and then either\r\n    // 1) the checkerboard is domain warped by perlin noise a bit, but the threshold decreases as a function of y\r\n    // 2) roundedCheckerboard should accept a threshold scalar\r\n    // 3) we build generic scalar comparator predicates - e.g.\r\n    //    gt(roundedCheckerboard(12), 1.2)()\r\n    //    gt(roundedCheckerboard(12), (pos, world) => 1.2 - noiseHeight)()\r\n    //\r\n    // we should try to avoid writing a generic expression tree; e.g. this would be horrible:\r\n    //    and(\r\n    //      gt(plus(roundedCheckerboard(12), heightPerlin2), 1.2),\r\n    //      gt(y, minus(80, mult(soilLevel, 20)))\r\n    // ranges in [-0.8, 2.8]\r\n    const soilLevel = Math.sin(x / p + y / 12) ** 2 + Math.cos(y / p) ** 2 + noiseHeight.perlin2(x / 4, y / 26);\r\n\r\n    return soilLevel > map(y, 0, world.height, 2.8, 0.2);\r\n  });\r\n\r\nconst erode = (generator: TileGenerator): TileGenerator => {\r\n  return (pos, world) => {\r\n    const tile = generator(pos, world);\r\n    if (tile == null) {\r\n      return;\r\n    }\r\n    let dirName: Directions;\r\n    for (dirName in DIRECTIONS) {\r\n      const dir = DIRECTIONS[dirName];\r\n      const testTile = generator(pos.clone().add(dir), world);\r\n      if (testTile == null) {\r\n        return;\r\n      }\r\n    }\r\n    return tile;\r\n  };\r\n};\r\n\r\nexport const atEdge = (original: TileGenerator): TileCombiner => {\r\n  return (...generators) => {\r\n    const gen = layers(...generators);\r\n    return and(original, not(erode(original))(gen));\r\n  };\r\n};\r\n\r\ntype TileTransformer = (g: TileGenerator) => TileCombiner;\r\n\r\nexport const alsoWith = (transformer: TileTransformer): TileTransformer => {\r\n  return (original) => (...generators) => {\r\n    const gen = layers(...generators);\r\n    return layers(original, transformer(original)(gen));\r\n  };\r\n};\r\n\r\nexport const alsoWithEdge = alsoWith(atEdge);\r\n\r\n//prettier-ignore\r\nconst SkySoil = layers(\r\n  air,\r\n  inSkySoil(2.5)(\r\n    silt,\r\n    inRockLevel(-0.8, -0.3)(rock),\r\n    nearWaterMaxima(smallFountain),\r\n  ),\r\n  // addEdge(\r\n  //   inSkySoil(2.5)(silt)\r\n  // )(\r\n  //   sand\r\n  // ),\r\n  // erode(\r\n  //   inSkySoil(2.5)(silt)\r\n  // )\r\n  // addEdge(\r\n  //   inSkySoil(2.5)(silt)\r\n  // )(\r\n  //   rock\r\n  // )\r\n);\r\n\r\n//prettier-ignore\r\nconst Mound = layers(\r\n  air,\r\n  // cool big mound shape thing\r\n  moundShape(10, 25, 1)(\r\n    translateY(-20)(\r\n      inSoil(\r\n        mixedSoilRockMed,\r\n        pastSoilDepth(1)(inRockLevel(-0.3, -0.1)(rock)),\r\n        nearWaterMaxima(smallFountain)\r\n      ),\r\n    )\r\n  )\r\n);\r\n\r\n//prettier-ignore\r\nconst InverseMound = layers(\r\n  air,\r\n  // cool big mound shape thing\r\n  onlyIn(\r\n    moundShape(25, -25, 0.7)(\r\n      inSoil(\r\n        addDeepWater(silt),\r\n        pastSoilDepth(1)(inRockLevel(-0.3, -0.1, 16)(sand)),\r\n        nearLarge0Maxima(0.85)(fountain),\r\n        pastSoilDepth(6)(atMaxima((pos, world) => world.generatorInfo(pos).mid0)(fountain))\r\n        // nearWaterMaxima(fountain)\r\n      ),\r\n    )\r\n  )(\r\n    inRockLevel(-0.6, -0.0, 4)(rock)\r\n  )\r\n);\r\n\r\n// never puts a pillar in the center of the map, so the player starts at the bottom\r\nexport const inPillar = predicate((pos, world) => {\r\n  const { soilLevel } = world.generatorInfo(pos);\r\n  const { x, y } = pos;\r\n  const inPillar = mod(x - world.width / 2 - 2, 5) < 2 && Math.abs(y - soilLevel) < 9;\r\n  return inPillar;\r\n});\r\n\r\nexport const stratified = (layerHeight: TileScalar): TileCombiner => (...generators) => {\r\n  return (pos, world) => {\r\n    const { soilLevel } = world.generatorInfo(pos);\r\n    const layerIndex = mod(Math.floor((pos.y - soilLevel) / layerHeight(pos, world)), generators.length);\r\n    return generators[layerIndex](pos, world);\r\n  };\r\n};\r\n\r\n//prettier-ignore\r\nconst Pillars = layers(\r\n  air,\r\n  inPillar(\r\n    withoutWater(clay),\r\n  ),\r\n  inSoil(\r\n    stratified(toScalar(4))(clay, silt, sand),\r\n    inRockLevel(-0.6, 0.5, 3)(rock)\r\n  )\r\n);\r\n\r\nexport const alsoWithNNeighborRock = (num: number) =>\r\n  alsoWith(\r\n    (generator: TileGenerator): TileCombiner => {\r\n      return (...generators) => {\r\n        const gen = layers(...generators);\r\n        return (pos, world) => {\r\n          let countRock = 0;\r\n          let dirName: Directions;\r\n          for (dirName in DIRECTIONS) {\r\n            const dir = DIRECTIONS[dirName];\r\n            const testTile = generator(pos.clone().add(dir), world);\r\n            if (testTile instanceof Rock) {\r\n              countRock++;\r\n            }\r\n          }\r\n          if (countRock >= num) {\r\n            return gen(pos, world);\r\n          }\r\n        };\r\n      };\r\n    }\r\n  );\r\n\r\nexport const withTwoWater = modify((tile) => tile.inventory.set(2, 0));\r\n//prettier-ignore\r\nconst RockMaze = layers(\r\n  air,\r\n  alsoWithNNeighborRock(7)(inSoil(\r\n    rock,\r\n    not(pastSoilDepth(3)(rock))(withTwoWater(silt)),\r\n    pastSoilDepth(3)(\r\n      inRockLevel(0.0, 0.0, 2)(withTwoWater(silt))\r\n    )\r\n  ))(largeFountain)\r\n);\r\n\r\nconst inOverhang = predicate((pos, world) => {\r\n  const { noiseHeight } = world.generatorContext;\r\n  const { x, y } = pos;\r\n  // [-1, 1]\r\n  const soilLevel = noiseHeight.simplex2(x / 15, y / 15);\r\n  return soilLevel > map(y, 0, world.height, 2.5, -2.5);\r\n});\r\n\r\nexport const mix = (mixFn: TileScalar): TileCombiner => {\r\n  return (...generators) => {\r\n    return (pos, world) => {\r\n      const mixValue = mixFn(pos, world);\r\n      const index = clamp(Math.floor(map(mixValue, 0, 1, 0, generators.length)), 0, generators.length - 1);\r\n      const gen = generators[index];\r\n      if (gen) {\r\n        return gen(pos, world);\r\n      }\r\n    };\r\n  };\r\n};\r\n\r\n//prettier-ignore\r\nexport const CliffSide = layers(\r\n  air,\r\n  // translateY(25)(caveSide),\r\n  // scale(1, -1)(translate(100, 105)(caveSide)),\r\n  // rotate(-Math.PI / 2)(caveSide)\r\n  rotate(-Math.PI * 0.5)(translateY(25)(\r\n    inOverhang(\r\n      stratified((pos, world) => 3 + world.generatorInfo(pos).mid0 * 0.2)(\r\n        silt,\r\n        clay,\r\n        layers(\r\n          clay,\r\n          inRockLevel(0, 0, 2)(rock)\r\n        )\r\n      )\r\n    )\r\n  ))\r\n);\r\n\r\nconst voroniEdgeMed = (edgeThickness = 1) =>\r\n  predicate((pos, world) => {\r\n    const centersByDistance = sortBy(world.generatorContext.poissonMed, (p) => p.distanceToSquared(pos));\r\n    const [nearest, secondNearest] = centersByDistance;\r\n    const distNearest = nearest.distanceTo(pos);\r\n    const distSecondNearest = secondNearest.distanceTo(pos);\r\n    const distDifference = distSecondNearest - distNearest;\r\n    return distDifference <= edgeThickness;\r\n    // function getNearestCenter(point: Vector2, centers: Vector2[]) {\r\n    //   return minBy(centers, (c) => c.distanceToSquared(point));\r\n    // }\r\n    // const cLeft = getNearestCenter(pos.clone().add(DIRECTIONS.w), world.generatorContext.poissonMed);\r\n    // const cRight = getNearestCenter(pos.clone().add(DIRECTIONS.e), world.generatorContext.poissonMed);\r\n  });\r\n\r\n//prettier-ignore\r\nexport const MountainSide = layers(\r\n  air,\r\n  onlyIn(\r\n    rotate(-Math.PI * 0.24)(translateY(0)(\r\n      inSoilFlat(rock)\r\n    ))\r\n  )(\r\n    voroniEdgeMed(3)(\r\n      withTwoWater(sand)\r\n    )\r\n  ),\r\n  // predicate((p, w) => w.generatorContext.poissonMed.find((v) => v.equals(p)) != null)(\r\n)\r\n\r\n//prettier-ignore\r\n// export const CliffSide = mix(\r\n//   (pos, world) => map(world.generatorContext.noiseMix.octaveSimplex2(pos.x / 5, pos.y / 5), -1.3, 1.3, 0, 1),\r\n//   // (pos, world) => {\r\n//   //   const {x, y} = pos;\r\n//   //   const wavelength = 5;\r\n//   //   const c = Math.sin(Math.PI * (x / wavelength)) ** 2 + Math.cos(Math.PI * (y / wavelength)) ** 2;\r\n//   //   return c / 2;\r\n//   // }\r\n// )(\r\n//   Mound,\r\n//   RockMaze,\r\n//   CliffSide2\r\n// );\r\n\r\nexport const Random = layers(\r\n  air,\r\n  withoutWater(\r\n    mix(\r\n      (pos, world) => map(world.generatorContext.noiseMix.octaveSimplex2(pos.x / 12 - 50, pos.y / 12 + 9), -1.3, 1.3, 0, 1),\r\n    )(\r\n      SkySoil,\r\n      Mound,\r\n      RockMaze,\r\n      Pillars,\r\n      CliffSide\r\n    )\r\n  )\r\n);\r\n\r\nexport const TileGenerators = {\r\n  Level0,\r\n  Temperate,\r\n  Reservoires,\r\n  Rocky,\r\n  SkySoil,\r\n  Desert,\r\n  Mound,\r\n  InverseMound,\r\n  Pillars,\r\n  RockMaze,\r\n  CliffSide,\r\n  MountainSide,\r\n  Random,\r\n};\r\n\r\nexport type TileGeneratorName = keyof typeof TileGenerators;\r\n","import { Vector2 } from \"three\";\r\n\r\n// https://github.com/beaugunderson/poisson-disc-sampler/blob/master/poisson-disc-sampler.js\r\nexport function poissonDisc({\r\n  width = 1,\r\n  height = 1,\r\n  radius = 0.1,\r\n  max = 1000,\r\n  initialSample = undefined as [number, number] | undefined,\r\n  rng = Math.random,\r\n}): Vector2[] {\r\n  // maximum number of samples before rejection\r\n  var k = 30;\r\n  var radius2 = radius * radius;\r\n  var R = 3 * radius2;\r\n  var cellSize = radius * Math.SQRT1_2;\r\n\r\n  var gridWidth = Math.ceil(width / cellSize);\r\n  var gridHeight = Math.ceil(height / cellSize);\r\n\r\n  var grid = new Array(gridWidth * gridHeight);\r\n\r\n  var queue: number[][] = [];\r\n  var queueSize = 0;\r\n\r\n  var sampleSize = 0;\r\n\r\n  rng = rng || Math.random;\r\n\r\n  function far(x: number, y: number) {\r\n    var i = (x / cellSize) | 0;\r\n    var j = (y / cellSize) | 0;\r\n\r\n    var i0 = Math.max(i - 2, 0);\r\n    var j0 = Math.max(j - 2, 0);\r\n    var i1 = Math.min(i + 3, gridWidth);\r\n    var j1 = Math.min(j + 3, gridHeight);\r\n\r\n    for (j = j0; j < j1; ++j) {\r\n      var o = j * gridWidth;\r\n\r\n      for (i = i0; i < i1; ++i) {\r\n        var s;\r\n\r\n        if ((s = grid[o + i])) {\r\n          var dx = s[0] - x,\r\n            dy = s[1] - y;\r\n\r\n          if (dx * dx + dy * dy < radius2) {\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  function sample(x: number, y: number) {\r\n    const s = [x, y];\r\n\r\n    queue.push(s);\r\n\r\n    grid[gridWidth * ((y / cellSize) | 0) + ((x / cellSize) | 0)] = s;\r\n\r\n    sampleSize++;\r\n    queueSize++;\r\n\r\n    return s;\r\n  }\r\n\r\n  const sampler = function() {\r\n    if (!sampleSize) {\r\n      if (initialSample != null) {\r\n        return sample(initialSample[0], initialSample[1]);\r\n      } else {\r\n        return sample(rng() * width, rng() * height);\r\n      }\r\n    }\r\n\r\n    // Pick a random existing sample and remove it from the queue.\r\n    while (queueSize) {\r\n      var i = (rng() * queueSize) | 0;\r\n      var s = queue[i];\r\n\r\n      // Make a new candidate between [radius, 2 * radius] from the existing\r\n      // sample.\r\n      for (var j = 0; j < k; ++j) {\r\n        var a = 2 * Math.PI * rng();\r\n        var r = Math.sqrt(rng() * R + radius2);\r\n        var x = s[0] + r * Math.cos(a);\r\n        var y = s[1] + r * Math.sin(a);\r\n\r\n        // Reject candidates that are outside the allowed extent,\r\n        // or closer than 2 * radius to any existing sample.\r\n        if (x >= 0 && x < width && y >= 0 && y < height && far(x, y)) {\r\n          return sample(x, y);\r\n        }\r\n      }\r\n\r\n      queue[i] = queue[--queueSize];\r\n      queue.length = queueSize;\r\n    }\r\n  };\r\n\r\n  const samples: Vector2[] = [];\r\n  for (let i = 0; i < max; i++) {\r\n    const sample = sampler();\r\n    // we can't get any more\r\n    if (sample == null) {\r\n      break;\r\n    }\r\n    samples.push(new Vector2(sample[0], sample[1]));\r\n  }\r\n  return samples;\r\n}\r\n","import { Noise } from \"common/perlin\";\r\nimport { poissonDisc } from \"math/poissonDisc\";\r\nimport seedrandom from \"seedrandom\";\r\nimport { Vector2 } from \"three\";\r\n\r\nexport interface GeneratorContext {\r\n  seed: number;\r\n  noiseHeight: Noise;\r\n  noiseRock: Noise;\r\n  noiseWater: Noise;\r\n  noiseSoil: Noise;\r\n  noiseLarge0: Noise;\r\n  noiseMid0: Noise;\r\n  noiseMix: Noise;\r\n  poissonSmall: Vector2[];\r\n  poissonMed: Vector2[];\r\n}\r\n\r\nexport interface GeneratorInfo {\r\n  soilLevel: number;\r\n  soilLevelFlat: number;\r\n\r\n  /**\r\n   * 20x20 simplex in [-1, 1]\r\n   */\r\n  large0: number;\r\n\r\n  /**\r\n   * 10x10 simplex in [-1, 1]\r\n   */\r\n  mid0: number;\r\n\r\n  /**\r\n   * (y/height)**2; useful for placing objects deep down.\r\n   */\r\n  heightScalar: number;\r\n  /**\r\n   * 5x5 simplex noise in [-0.85, 1.15]\r\n   */\r\n  waterValue: number;\r\n}\r\n\r\nfunction modulateSeed(seed: number, key: string) {\r\n  for (const letter of key) {\r\n    seed |= seed << (7 + letter.charCodeAt(0) ** 2);\r\n  }\r\n  return seed;\r\n}\r\n\r\nexport function createGeneratorContext(seed: number): GeneratorContext {\r\n  return {\r\n    seed,\r\n    noiseHeight: new Noise(modulateSeed(seed, \"height\")),\r\n    noiseRock: new Noise(modulateSeed(seed, \"rock\")),\r\n    noiseWater: new Noise(modulateSeed(seed, \"water\")),\r\n    noiseSoil: new Noise(modulateSeed(seed, \"soil\")),\r\n    noiseLarge0: new Noise(modulateSeed(seed, \"large0\")),\r\n    noiseMid0: new Noise(modulateSeed(seed, \"mid0\")),\r\n    noiseMix: new Noise(modulateSeed(seed, \"mix\")),\r\n    poissonSmall: makePoissonPoints(modulateSeed(seed, \"poissonSmall\"), 5),\r\n    poissonMed: makePoissonPoints(modulateSeed(seed, \"poissonMed\"), 10),\r\n  };\r\n}\r\n\r\n/**\r\n * Create an array of poisson-disc sampled points with distance d, within a 50x100 world\r\n */\r\nfunction makePoissonPoints(seed: number, distance: number): Vector2[] {\r\n  const random = seedrandom(seed.toString());\r\n  const samples = poissonDisc({\r\n    width: 50,\r\n    height: 100,\r\n    radius: distance,\r\n    rng: random,\r\n    max: 5000 / distance,\r\n  });\r\n  const minVector = new Vector2();\r\n  const maxVector = new Vector2(50 - 1, 100 - 1);\r\n  for (const s of samples) {\r\n    s.round();\r\n    s.clamp(minVector, maxVector);\r\n  }\r\n  return samples;\r\n}\r\n","import { Temperature } from \"core/temperature\";\r\nimport { params } from \"game/params\";\r\nimport { clamp, randInt } from \"math\";\r\nimport { SUNLIGHT_DIFFUSION, SUNLIGHT_REINTRODUCTION, TIME_PER_DAY } from \"../constants\";\r\nimport { Air } from \"../tile\";\r\nimport { World } from \"./world\";\r\n\r\nconst SUNLIGHT_TEMPERATURE_SCALAR = {\r\n  [Temperature.Freezing]: 0.5,\r\n  [Temperature.Cold]: 0.75,\r\n  [Temperature.Mild]: 1,\r\n  [Temperature.Hot]: 1.25,\r\n  [Temperature.Scorching]: 1.5,\r\n};\r\n/**\r\n * WeatherController is responsible for weather related properties, such as:\r\n *\r\n * Temperature of the environment\r\n * Sunlight amount and angle\r\n * Rainfall\r\n */\r\nexport class Weather {\r\n  constructor(public world: World) {}\r\n\r\n  /**\r\n   * The day is further split into a \"daytime\" and a \"nighttime\". Sunlight\r\n   * angles from -90 to +90 over the course of the day. This percentage says\r\n   * how much of a full day is filled with sun.\r\n   *\r\n   * Balance-wise, we keep it daytime often because daytime is more fun; nighttime\r\n   * is just a time-keeping convenience, and a way to reset the sun angle.\r\n   */\r\n  get percentDaylight() {\r\n    const { season } = this.world.season;\r\n    return this.world.environment.daylightPerSeason[season];\r\n  }\r\n\r\n  /**\r\n   * 0 to 2pi, where\r\n   * 0 to pi: daytime (time of day - 0 to PERCENT_DAYLIGHT)\r\n   * pi to 2pi: nighttime (PERCENT_DAYLIGHT to 1)\r\n   */\r\n  get sunAngle() {\r\n    if (params.forceNight) {\r\n      return (Math.PI * 3) / 2;\r\n    }\r\n    const timeOfDay = (this.world.time / TIME_PER_DAY) % 1;\r\n    const percentDaylight = this.percentDaylight;\r\n    if (timeOfDay < percentDaylight) {\r\n      return (timeOfDay / percentDaylight) * Math.PI;\r\n    } else {\r\n      return Math.PI * (1 + (timeOfDay - percentDaylight) / (1 - percentDaylight));\r\n    }\r\n  }\r\n\r\n  get sunAmount() {\r\n    const temperatureScalar = SUNLIGHT_TEMPERATURE_SCALAR[this.getBaseTemperature()];\r\n    const baseAmount = (Math.atan(Math.sin(this.sunAngle) * 12) / (Math.PI / 2)) * 0.5 + 0.5;\r\n    return baseAmount * temperatureScalar;\r\n  }\r\n\r\n  getBaseTemperature() {\r\n    const { season } = this.world.season;\r\n    return this.world.environment.temperaturePerSeason[season];\r\n  }\r\n\r\n  getCurrentTemperature() {\r\n    const temperature = this.getBaseTemperature();\r\n    // temperature gets one tick colder at night\r\n    if (this.sunAngle > Math.PI) {\r\n      return clamp(temperature - 1, Temperature.Freezing, Temperature.Scorching) as Temperature;\r\n    } else {\r\n      return temperature;\r\n    }\r\n  }\r\n\r\n  step(dt: number) {\r\n    this.computeSunlight();\r\n    this.stepWeather(dt);\r\n  }\r\n\r\n  public stepWeather(dt: number) {\r\n    const world = this.world;\r\n    // offset first rain event by a few seconds\r\n    const isRaining =\r\n      (world.time + world.environment.climate.timeBetweenRainfall - 6) % world.environment.climate.timeBetweenRainfall <\r\n      world.environment.climate.rainDuration;\r\n    if (isRaining) {\r\n      // add multiple random droplets\r\n      let numWater = world.environment.climate.waterPerSecond * dt;\r\n      let guard = 0;\r\n      while (numWater > 0 && guard++ < 100) {\r\n        const dropletSize = clamp(numWater, 0, 1);\r\n        const x = randInt(0, world.width - 1);\r\n        const t = world.tileAt(x, 0);\r\n        if (Air.is(t)) {\r\n          t.inventory.add(dropletSize, 0);\r\n          world.numRainWater += dropletSize;\r\n          numWater -= dropletSize;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public computeSunlight() {\r\n    // step downards from the top; neighbors don't affect the calculation so\r\n    // we don't have buffering problems\r\n    // TODO allow sunlight to go full 45-to-90 degrees\r\n    const sunAngle = this.sunAngle;\r\n    const directionalBias = Math.sin(sunAngle - Math.PI / 2);\r\n    const sunAmount = this.sunAmount;\r\n    for (let y = 0; y <= this.world.height; y++) {\r\n      for (let x = 0; x < this.world.width; x++) {\r\n        const t = this.world.environmentTileAt(x, y);\r\n        if (Air.is(t)) {\r\n          let sunlight = 0;\r\n          if (y === 0) {\r\n            sunlight = 1;\r\n          } else {\r\n            const tileUp = this.world.tileAt(x, y - 1);\r\n            const tileRight = this.world.tileAt(x + 1, y - 1);\r\n            const tileLeft = this.world.tileAt(x - 1, y - 1);\r\n            const upSunlight = Air.is(tileUp) ? tileUp.sunlightCached / sunAmount : tileUp == null ? 1 : 0;\r\n            const rightSunlight = Air.is(tileRight) ? tileRight.sunlightCached / sunAmount : tileRight == null ? 1 : 0;\r\n            const leftSunlight = Air.is(tileLeft) ? tileLeft.sunlightCached / sunAmount : tileLeft == null ? 1 : 0;\r\n            if (directionalBias > 0) {\r\n              // positive light travels to the right\r\n              sunlight = rightSunlight * directionalBias + upSunlight * (1 - directionalBias);\r\n            } else {\r\n              sunlight = leftSunlight * -directionalBias + upSunlight * (1 - -directionalBias);\r\n            }\r\n            sunlight =\r\n              sunlight * (1 - SUNLIGHT_DIFFUSION) +\r\n              ((upSunlight + rightSunlight + leftSunlight) / 3) * SUNLIGHT_DIFFUSION;\r\n          }\r\n          // have at least a bit\r\n          sunlight = SUNLIGHT_REINTRODUCTION + sunlight * (1 - SUNLIGHT_REINTRODUCTION);\r\n          sunlight *= sunAmount;\r\n          t.sunlightCached = sunlight;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Toaster } from \"@blueprintjs/core\";\r\nimport { TIME_PER_DAY } from \"core/constants\";\r\nimport { Environment } from \"core/environment\";\r\nimport { Insect } from \"core/insect\";\r\nimport { EventEmitter } from \"events\";\r\nimport { randFloat, roundToNearest } from \"math\";\r\nimport { gridRange } from \"math/arrays\";\r\nimport { TileGenerators } from \"std/tileGenerators\";\r\nimport { Vector2 } from \"three\";\r\nimport devlog from \"../../common/devlog\";\r\nimport shuffle from \"../../math/shuffle\";\r\nimport Genome from \"../cell/genome\";\r\nimport { DIRECTION_VALUES } from \"../directions\";\r\nimport { Entity, isSteppable, step } from \"../entity\";\r\nimport { Player } from \"../player/player\";\r\nimport { PlayerSeed } from \"../player/playerSeed\";\r\nimport { Season, seasonFromTime } from \"../season\";\r\nimport { Species } from \"../species\";\r\nimport { Air, Cell, Soil, Tile } from \"../tile\";\r\nimport { TileEvent } from \"../tile/tileEvent\";\r\nimport { createGeneratorContext, GeneratorContext, GeneratorInfo } from \"./generatorContext\";\r\nimport { StepStats } from \"./stepStats\";\r\nimport { Weather } from \"./weather\";\r\n\r\nexport interface WorldOptions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nconst optionsDefault: WorldOptions = {\r\n  width: 50,\r\n  height: 100,\r\n};\r\n\r\nexport class World {\r\n  get minVector() {\r\n    return new Vector2(0, 0);\r\n  }\r\n\r\n  get maxVector() {\r\n    return new Vector2(this.width - 1, this.height - 1);\r\n  }\r\n\r\n  isAtEdge(pos: Vector2) {\r\n    return pos.x === 0 || pos.x === this.width - 1 || pos.y === 0 || pos.y === this.height - 1;\r\n  }\r\n\r\n  public time: number = 0;\r\n\r\n  public frame: number = 0;\r\n\r\n  public readonly width: number;\r\n\r\n  public readonly height: number;\r\n\r\n  public readonly player: Player;\r\n\r\n  public insects: Insect[] = [];\r\n\r\n  public playerSeed?: PlayerSeed;\r\n\r\n  public events = new EventEmitter();\r\n\r\n  private readonly gridEnvironment: Tile[][];\r\n\r\n  private readonly gridCells: Array<Array<Cell | null>>;\r\n\r\n  private readonly neighborCache: Array<Array<NeighborMap>>;\r\n\r\n  public readonly mpEarners = new Map<Cell, number>();\r\n\r\n  public oxygenContribution: number = 0;\r\n\r\n  public readonly species: Species;\r\n\r\n  public readonly generatorContext: GeneratorContext;\r\n\r\n  public weather: Weather;\r\n\r\n  genome: Genome;\r\n\r\n  private generatorInfoCache = new Map<string, GeneratorInfo>();\r\n\r\n  public get oxygenPerSecond() {\r\n    return roundToNearest(this.oxygenContribution / this.time, 0.01);\r\n  }\r\n\r\n  public generatorInfo(pos: Vector2): GeneratorInfo {\r\n    const key = `${pos.x},${pos.y}`;\r\n    if (!this.generatorInfoCache.has(key)) {\r\n      this.generatorInfoCache.set(key, this.computeGeneratorInfo(pos));\r\n    }\r\n    return this.generatorInfoCache.get(key)!;\r\n  }\r\n\r\n  private computeGeneratorInfo(pos: Vector2): GeneratorInfo {\r\n    const { noiseHeight, noiseWater, noiseLarge0, noiseMid0 } = this.generatorContext;\r\n    const { x, y } = pos;\r\n    const { height } = this;\r\n\r\n    const soilLevel =\r\n      height / 2 -\r\n      // start soil a bit lower; provides higher chance for low co2 start\r\n      2 -\r\n      // period 20, +-8 - main soil line definition.\r\n      // mid-sized rolling hills. At the max this will approach 22.5deg.\r\n      16 * noiseHeight.perlin2(10, x / 20 + 10) -\r\n      // period 5, +- 1. small detail noise\r\n      2 * noiseHeight.perlin2(0, x / 5);\r\n\r\n    const soilLevelFlat =\r\n      height / 2 -\r\n      1 -\r\n      // period 100, +- 1.5 - really low frequency cut\r\n      3 * noiseHeight.perlin2(10, x / 100 + 10) -\r\n      // period 20, amplitude 1 - add some tiny dips here and there\r\n      noiseHeight.perlin2(0, x / 20);\r\n\r\n    const heightScalar = (y / height) ** 2;\r\n    const waterValue = noiseWater.simplex2(x / 5, y / 5) + 0.15;\r\n\r\n    const large0 = noiseLarge0.octaveSimplex2(x / 20, y / 20, 3, 0.5);\r\n    const mid0 = noiseMid0.simplex2(x / 10, y / 10);\r\n    return {\r\n      soilLevel,\r\n      soilLevelFlat,\r\n      heightScalar,\r\n      waterValue,\r\n      large0,\r\n      mid0,\r\n    };\r\n  }\r\n\r\n  get season(): Season {\r\n    return seasonFromTime(this.time);\r\n  }\r\n\r\n  constructor(\r\n    public environment: Environment,\r\n    seed: number,\r\n    species: Species,\r\n    optionsPartial: Partial<WorldOptions> = {}\r\n  ) {\r\n    const options = { ...optionsDefault, ...optionsPartial };\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.generatorContext = createGeneratorContext(seed);\r\n    this.species = species;\r\n    this.genome = species.genome;\r\n    this.weather = new Weather(this);\r\n\r\n    const tileGenerator = typeof environment.fill === \"string\" ? TileGenerators[environment.fill] : environment.fill;\r\n    this.gridEnvironment = gridRange(this.width, this.height, (x, y) => {\r\n      const pos = new Vector2(x, y);\r\n      return tileGenerator(pos, this) || new Air(pos, this);\r\n    });\r\n\r\n    this.gridCells = gridRange(this.width, this.height, () => null);\r\n    this.neighborCache = gridRange(this.width, this.height, (x, y) => this.computeTileNeighbors(x, y));\r\n    this.fillCachedEntities();\r\n\r\n    this.computeSoilDepths();\r\n\r\n    // always drop player on the Soil Air interface\r\n    const start = new Vector2(Math.floor(this.width / 2), Math.floor(this.height / 2));\r\n    const firstNonAir = this.gridEnvironment[start.x].find((t) => !Air.is(t) && t.pos.y > 25);\r\n    if (firstNonAir != null) {\r\n      // if we hit a rock, go onto the Air right above it\r\n      start.y = firstNonAir.isObstacle ? firstNonAir.pos.y - 1 : firstNonAir.pos.y;\r\n    }\r\n\r\n    this.player = new Player(start, this);\r\n    this.playerSeed = new PlayerSeed(start, this, this.player);\r\n\r\n    this.fillCachedEntities();\r\n    this.computeDarkness();\r\n    this.updateClosestCellDistance();\r\n\r\n    for (let x = 0; x < this.width; x++) {\r\n      for (let y = 0; y < this.height; y++) {\r\n        const tileEnvironment = this.gridEnvironment[x][y];\r\n        tileEnvironment && tileEnvironment.step(0);\r\n\r\n        const tileCell = this.gridCells[x][y];\r\n        tileCell && tileCell.step(0);\r\n      }\r\n    }\r\n    this.weather.step(0);\r\n  }\r\n\r\n  public on(event: \"step\", cb: (action: StepStats) => void): void;\r\n\r\n  public on(event: string, cb: (...args: any[]) => void) {\r\n    this.events.on(event, cb);\r\n  }\r\n\r\n  public off(event: string, cb: (...args: any[]) => void) {\r\n    this.events.off(event, cb);\r\n  }\r\n\r\n  public removePlayerSeed() {\r\n    this.stepStats.deleted.push(this.playerSeed!);\r\n    delete this.playerSeed;\r\n  }\r\n\r\n  public tileAt(v: Vector2): Tile | null;\r\n\r\n  public tileAt(x: number, y: number): Tile | null;\r\n\r\n  public tileAt(xOrVec2: number | Vector2, y?: number): Tile | null {\r\n    let x: number;\r\n    if (xOrVec2 instanceof Vector2) {\r\n      x = xOrVec2.x;\r\n      y = xOrVec2.y;\r\n    } else {\r\n      x = xOrVec2;\r\n      y = y!;\r\n    }\r\n\r\n    if (!this.isValidPosition(x, y)) {\r\n      return null;\r\n    }\r\n    const cell = this.gridCells[x][y];\r\n    if (cell != null) {\r\n      return cell;\r\n    } else {\r\n      return this.gridEnvironment[x][y];\r\n    }\r\n  }\r\n\r\n  public cellAt(v: Vector2): Cell | null;\r\n\r\n  public cellAt(x: number, y: number): Cell | null;\r\n\r\n  public cellAt(x: number | Vector2, y?: number): Cell | null {\r\n    if (x instanceof Vector2) {\r\n      y = x.y;\r\n      x = x.x;\r\n    }\r\n    if (this.isValidPosition(x, y!)) {\r\n      return this.gridCells[x][y!];\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  public environmentTileAt(x: number, y: number): Tile | null {\r\n    if (this.isValidPosition(x, y)) {\r\n      return this.gridEnvironment[x][y];\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Rules for replacement:\r\n  // if tile is environment, clear out the gridCell and set the gridEnvironment.\r\n  // if tile is cell, set gridCell, leave gridEnvironment alone.\r\n  public setTileAt(position: Vector2, tile: Tile) {\r\n    const { x, y } = position;\r\n    if (!this.isValidPosition(x, y)) {\r\n      throw new Error(`invalid position ${x}, ${y} `);\r\n    }\r\n    if (Cell.is(tile) && tile.isReproductive) {\r\n      this.mpEarners.set(tile, 0);\r\n    }\r\n    const oldTile = this.tileAt(x, y)!;\r\n    // if replacing a tile, try redistributing inventory to neighbors\r\n    oldTile.redistributeInventoryToNeighbors();\r\n    if (oldTile.inventory.water !== 0 || oldTile.inventory.sugar !== 0) {\r\n      console.warn(\"lost\", oldTile.inventory, \"resources to building\");\r\n      oldTile.inventory.add(-oldTile.inventory.water, -oldTile.inventory.sugar);\r\n    }\r\n\r\n    const oldCell = this.gridCells[x][y];\r\n    if (oldCell != null) {\r\n      this.stepStats.deleted.push(oldCell);\r\n    }\r\n\r\n    if (Cell.is(tile)) {\r\n      // set gridCell only\r\n      this.gridCells[x][y] = tile;\r\n    } else {\r\n      // hackhack - we should call .die() on gridCells[x][y] but we already have with the oldTile code above\r\n      this.gridCells[x][y] = null;\r\n\r\n      const oldEnvironmentTile = this.gridEnvironment[x][y];\r\n      if (oldEnvironmentTile != null) {\r\n        this.stepStats.deleted.push(oldEnvironmentTile);\r\n      }\r\n      this.gridEnvironment[x][y] = tile;\r\n    }\r\n    this.stepStats.added.push(tile);\r\n    this.handleTileUpdated(position);\r\n  }\r\n\r\n  public maybeRemoveCellAt(position: Vector2, die = true): Cell | null {\r\n    const cell = this.cellAt(position.x, position.y);\r\n    if (cell) {\r\n      cell.redistributeInventoryToNeighbors();\r\n      this.gridCells[position.x][position.y] = null;\r\n      this.stepStats.deleted.push(cell);\r\n      cell.isDead = die;\r\n    }\r\n    this.handleTileUpdated(position);\r\n    return cell;\r\n  }\r\n\r\n  removeInsect(insect: Insect) {\r\n    this.insects.splice(this.insects.indexOf(insect), 1);\r\n    this.stepStats.deleted.push(insect);\r\n    return true;\r\n  }\r\n\r\n  public isValidPosition(x: number, y: number) {\r\n    if (x >= this.width || x < 0 || y >= this.height || y < 0) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a map from direction offsets (DIRECTIONS.n, .nw, .ne, etc.) to Tile neighbors occupying that offset.\r\n   */\r\n  public tileNeighbors(pos: Vector2) {\r\n    return this.neighborCache[pos.x][pos.y];\r\n  }\r\n\r\n  private computeTileNeighbors(px: number, py: number) {\r\n    const mapping = new NeighborMap();\r\n    // randomize the neighbor array to reduce aliasing\r\n    const directions = DIRECTION_VALUES_RAND[this.frame % DIRECTION_VALUES_RAND.length];\r\n    directions.forEach((v) => {\r\n      const x = px + v.x;\r\n      const y = py + v.y;\r\n      const tile = this.tileAt(x, y);\r\n      if (tile != null) {\r\n        mapping.set(v, tile);\r\n      }\r\n    });\r\n    return mapping;\r\n  }\r\n  // only use for rendering\r\n  // private cachedRenderableEntities?: Entity[];\r\n  // public renderableEntities() {\r\n  //     if (this.cachedRenderableEntities == null) {\r\n  //         throw new Error(\"accessed renderable entities before filling\");\r\n  //     }\r\n  //     return this.cachedRenderableEntities;\r\n  // }\r\n\r\n  private cachedEntities?: Entity[];\r\n\r\n  public entities() {\r\n    if (this.cachedEntities == null) {\r\n      throw new Error(\"accessed entities before filling\");\r\n    }\r\n    return this.cachedEntities;\r\n  }\r\n\r\n  private handleTileUpdated(pos: Vector2) {\r\n    this.neighborCache[pos.x][pos.y] = this.computeTileNeighbors(pos.x, pos.y);\r\n    for (const dir of DIRECTION_VALUES) {\r\n      const x = pos.x + dir.x;\r\n      const y = pos.y + dir.y;\r\n      if (this.isValidPosition(x, y)) {\r\n        this.neighborCache[x][y] = this.computeTileNeighbors(x, y);\r\n      }\r\n    }\r\n    this.fillCachedEntities();\r\n  }\r\n\r\n  private fillCachedEntities() {\r\n    const newEntities: Entity[] = [];\r\n    // We have no lock-step buffer state, but entities can interact with  entities\r\n    // so you can get weird artifacts like \"water suddenly moves 20 squares\" based on the\r\n    // iteration order. Thankfully, generally they only interact with direct neighbors.\r\n    // So, we:\r\n    // 1. order entities in a checkerboard pattern\r\n    // 2. alternatingly reverse the entire array iteration order\r\n    let x = 0,\r\n      y = 0;\r\n    for (x = 0; x < this.width; x++) {\r\n      for (y = (x + this.frame) % 2; y < this.height; y += 2) {\r\n        // checkerboard one\r\n        const t = this.tileAt(x, y)!;\r\n        newEntities.push(t);\r\n        if (Cell.is(t)) {\r\n          const tileUnderneath = this.environmentTileAt(x, y)!;\r\n          if (Air.is(tileUnderneath)) {\r\n            newEntities.push(tileUnderneath);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    for (x = 0; x < this.width; x++) {\r\n      for (y = (x + this.frame + 1) % 2; y < this.height; y += 2) {\r\n        // checkerboard two\r\n        const t = this.tileAt(x, y)!;\r\n        newEntities.push(t);\r\n        if (Cell.is(t)) {\r\n          const tileUnderneath = this.environmentTileAt(x, y)!;\r\n          if (Air.is(tileUnderneath)) {\r\n            newEntities.push(tileUnderneath);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (this.frame % 4 < 2) {\r\n      newEntities.reverse();\r\n    }\r\n    // add player at the end - this is important since Player is currently the only thing\r\n    // that modifies tiles. You can get into situations where tiles that should be dead\r\n    // are still left-over in the entities cache.\r\n    if (this.playerSeed) {\r\n      newEntities.push(this.playerSeed);\r\n    } else {\r\n      newEntities.push(this.player);\r\n    }\r\n    newEntities.push(...this.insects);\r\n    this.cachedEntities = newEntities;\r\n  }\r\n\r\n  private stepStats: StepStats = new StepStats(this.frame);\r\n\r\n  private lastStepStats: StepStats = this.stepStats;\r\n\r\n  public step(dt: number): StepStats {\r\n    const entities = this.entities();\r\n    // dear god\r\n    for (let i = 0; i < entities.length; i++) {\r\n      const entity = entities[i];\r\n      if (isSteppable(entity)) {\r\n        step(entity, dt);\r\n      }\r\n    }\r\n    this.stepInsects(dt);\r\n    this.weather.step(dt);\r\n    if (this.stepStats.added.length > 0 || this.stepStats.deleted.length > 0) {\r\n      this.computeDarkness();\r\n      this.updateClosestCellDistance();\r\n    }\r\n    this.frame++;\r\n    this.time += dt;\r\n    this.fillCachedEntities();\r\n    this.events.emit(\"step\", this.stepStats);\r\n    this.lastStepStats = this.stepStats;\r\n    this.stepStats = new StepStats(this.frame);\r\n    return this.lastStepStats;\r\n    // this.checkResources();\r\n  }\r\n\r\n  stepInsects(dt: number) {\r\n    if (\r\n      this.playerSeed == null &&\r\n      this.insects.length < 1 &&\r\n      Math.random() < (this.environment.insectsPerDay / TIME_PER_DAY) * dt\r\n    ) {\r\n      InsectToaster.clear();\r\n      InsectToaster.show({\r\n        message: \"Insect approaching!\",\r\n      });\r\n      this.insects.push(new Insect(new Vector2(randFloat(0, this.width), 0), this));\r\n    }\r\n  }\r\n\r\n  logEvent(event: TileEvent) {\r\n    this.stepStats.logEvent(event);\r\n  }\r\n\r\n  public getLastStepStats() {\r\n    return this.lastStepStats;\r\n  }\r\n\r\n  numRainWater = 0;\r\n\r\n  numEvaporatedAir = 0;\r\n\r\n  numEvaporatedSoil = 0;\r\n\r\n  numRechargedWater = 0;\r\n\r\n  public computeSoilDepths() {\r\n    const airPositions = Array.from(this.allEnvironmentTiles())\r\n      .filter((t) => Air.is(t))\r\n      .map((t) => t.pos);\r\n\r\n    for (const tile of this.bfsIterator(airPositions, this.width * this.height)) {\r\n      if (tile instanceof Soil) {\r\n        let minNeighborDepth = tile.depth;\r\n        for (const [, neighbor] of this.tileNeighbors(tile.pos)) {\r\n          if (Air.is(neighbor)) {\r\n            minNeighborDepth = 0;\r\n          } else if (neighbor instanceof Soil) {\r\n            minNeighborDepth = Math.min(minNeighborDepth, neighbor.depth);\r\n          }\r\n        }\r\n        tile.depth = minNeighborDepth + 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  public computeDarkness() {\r\n    for (const tile of this.bfsIterator(this.player.pos, this.width * this.height)) {\r\n      tile.stepDarkness();\r\n    }\r\n  }\r\n\r\n  public updateClosestCellDistance() {\r\n    for (const tile of this.allTiles()) {\r\n      tile.closestCellAirDistance = 1000;\r\n    }\r\n    const startCell = this.player.findNearestWalkableCell();\r\n    for (const tile of this.bfsIterator(startCell?.pos ?? this.player.pos, this.width * this.height)) {\r\n      tile.stepClosestCellDistance();\r\n    }\r\n  }\r\n\r\n  earnMP(cell: Cell, mpEarned: number) {\r\n    this.mpEarners.set(cell, mpEarned);\r\n  }\r\n\r\n  public checkResources() {\r\n    let totalSugar = 0;\r\n    let totalWater = 0;\r\n    let totalEnergy = 0;\r\n    this.entities().forEach((e) => {\r\n      totalSugar += e.inventory.sugar;\r\n      totalWater += e.inventory.water;\r\n      if (Cell.is(e)) {\r\n        totalEnergy += e.energy;\r\n      }\r\n    });\r\n    devlog(\"sugar\", totalSugar, \"water\", totalWater, \"energy\", totalEnergy);\r\n  }\r\n\r\n  public allCells() {\r\n    const { gridCells, width, height } = this;\r\n    return {\r\n      *[Symbol.iterator]() {\r\n        for (let x = 0; x < width; x++) {\r\n          for (let y = 0; y < height; y++) {\r\n            const g = gridCells[x][y];\r\n            if (g != null) {\r\n              yield g;\r\n            }\r\n          }\r\n        }\r\n      },\r\n    };\r\n  }\r\n\r\n  public allEnvironmentTiles() {\r\n    const self = this;\r\n    return {\r\n      *[Symbol.iterator]() {\r\n        for (const row of self.gridEnvironment) {\r\n          for (const t of row) {\r\n            yield t;\r\n          }\r\n        }\r\n      },\r\n    };\r\n  }\r\n\r\n  allTiles() {\r\n    const { width, height } = this;\r\n    const self = this;\r\n    return {\r\n      *[Symbol.iterator]() {\r\n        for (let x = 0; x < width; x++) {\r\n          for (let y = 0; y < height; y++) {\r\n            const g = self.tileAt(x, y);\r\n            if (g != null) {\r\n              yield g;\r\n            }\r\n          }\r\n        }\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Breadth first search (floodfill) generator\r\n   */\r\n  public bfsIterator(\r\n    start: Vector2 | Vector2[],\r\n    limit: number,\r\n    filter?: (tile: Tile) => boolean,\r\n    heuristic?: (tile: Tile) => number\r\n  ) {\r\n    const self = this;\r\n    const frontier = (Array.isArray(start) ? start : [start]).map((v) => this.tileAt(v)!);\r\n    const processed = new Set<Tile>();\r\n    return {\r\n      *[Symbol.iterator]() {\r\n        while (frontier.length > 0 && processed.size < limit) {\r\n          const tile = frontier.shift();\r\n          if (tile == null) {\r\n            return;\r\n          }\r\n          processed.add(tile);\r\n          yield tile;\r\n          const neighbors = self.tileNeighbors(tile.pos);\r\n          for (const [offset, n] of neighbors) {\r\n            if (\r\n              offset.manhattanLength() === 1 &&\r\n              (filter == null || filter(n)) &&\r\n              frontier.indexOf(n) === -1 &&\r\n              !processed.has(n)\r\n            ) {\r\n              frontier.push(n);\r\n            }\r\n          }\r\n          if (heuristic) {\r\n            frontier.sort((a, b) => heuristic(a) - heuristic(b));\r\n          }\r\n        }\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nconst DIRECTION_VALUES_RAND = [\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n];\r\n\r\nconst InsectToaster = Toaster.create({\r\n  canEscapeKeyClear: false,\r\n  maxToasts: 1,\r\n  position: \"bottom\",\r\n});\r\n\r\nexport class NeighborMap extends Map<Vector2, Tile> {\r\n  private _array: Tile[] | undefined;\r\n\r\n  get array() {\r\n    if (this._array == null) {\r\n      this._array = Array.from(this.values());\r\n    }\r\n    return this._array as Tile[];\r\n  }\r\n}\r\n","import { Color, Vector2 } from \"three\";\r\nimport Chromosome from \"../../core/cell/chromosome\";\r\nimport Genome, { CellType } from \"../../core/cell/genome\";\r\nimport {\r\n  GeneInventory,\r\n  GeneLiving,\r\n  GeneObstacle,\r\n  GenePhotosynthesis,\r\n  GeneScaffolding,\r\n  GeneSeed,\r\n  GeneSoilAbsorption,\r\n} from \"../genes\";\r\n\r\nconst cellTypeTissue = new CellType(\r\n  \"Tissue\",\r\n  0,\r\n  new Chromosome(GeneLiving.level(0)),\r\n  {\r\n    texturePosition: new Vector2(1, 1),\r\n    color: new Color(0x30ae25),\r\n  },\r\n  {\r\n    type: \"give\",\r\n    resources: \"sugar\",\r\n    continuous: false,\r\n  }\r\n);\r\n\r\nconst cellTypeLeaf = new CellType(\r\n  \"Leaf\",\r\n  0,\r\n  new Chromosome(GeneLiving.level(0), GeneObstacle.level(0), GenePhotosynthesis.level(0)),\r\n  {\r\n    color: new Color(\"white\"),\r\n    texturePosition: new Vector2(2, 1),\r\n  },\r\n  {\r\n    type: \"give\",\r\n    resources: \"water take sugar\",\r\n    continuous: true,\r\n  }\r\n);\r\n\r\nconst cellTypeRoot = new CellType(\r\n  \"Root\",\r\n  0,\r\n  new Chromosome(GeneLiving.level(0), GeneScaffolding.level(0), GeneInventory.level(0), GeneSoilAbsorption.level(0)),\r\n  {\r\n    color: new Color(\"white\"),\r\n    texturePosition: new Vector2(3, 1),\r\n  },\r\n  {\r\n    type: \"take\",\r\n    resources: \"water and sugar\",\r\n    continuous: true,\r\n  }\r\n);\r\n\r\nconst cellTypeSeed = new CellType(\r\n  \"Seed\",\r\n  0,\r\n  new Chromosome(GeneLiving.level(0), GeneSeed.level(0)),\r\n  {\r\n    texturePosition: new Vector2(1, 4),\r\n  },\r\n  {\r\n    type: \"give\",\r\n    resources: \"sugar\",\r\n    continuous: true,\r\n  }\r\n);\r\n\r\nexport const tutorialGenome = new Genome([cellTypeTissue, cellTypeLeaf, cellTypeRoot, cellTypeSeed]);\r\n","import Genome from \"core/cell/genome\";\r\nimport { createSimpleSchema, identifier, list, object, primitive, reference } from \"serializr\";\r\nimport { tutorialGenome } from \"std/genomes/tutorialGenome\";\r\nimport uuid from \"uuid\";\r\nimport { RealizedGene } from \"./cell\";\r\n\r\nexport interface Species {\r\n  genome: Genome;\r\n  id: string;\r\n  name: string;\r\n  freeMutationPoints: number;\r\n  descendants: Species[];\r\n  parent?: Species;\r\n  geneOptions: RealizedGene[];\r\n}\r\n\r\nexport const SpeciesSchema = createSimpleSchema<Species>({\r\n  // TODO fill in\r\n  genome: object(Genome),\r\n  id: identifier(),\r\n  name: primitive(),\r\n  freeMutationPoints: primitive(),\r\n  totalMutationPoints: primitive(),\r\n  geneOptions: list(object(RealizedGene)),\r\n});\r\n// we can't self-reference SpeciesSchema in its instantiation; set it after\r\nSpeciesSchema.props.descendants = list(object(SpeciesSchema));\r\nSpeciesSchema.props.parent = reference(SpeciesSchema);\r\n\r\nexport function newBaseSpecies(name = \"plantum originus\"): Species {\r\n  return {\r\n    id: uuid(),\r\n    genome: tutorialGenome,\r\n    name,\r\n    freeMutationPoints: 0,\r\n    descendants: [],\r\n    geneOptions: [],\r\n  };\r\n}\r\n\r\nexport function lineage(species: Species): Species[] {\r\n  const arr = [];\r\n  arr.push(species);\r\n  for (const s of species.descendants) {\r\n    arr.push(...lineage(s));\r\n  }\r\n  return arr;\r\n}\r\n","import { World } from \"core\";\r\nimport { Tile } from \"core/tile\";\r\n\r\nexport type Visitor = (tiles: Tile[], world: World) => number;\r\n\r\nexport interface Visitors {\r\n  [name: string]: Visitor;\r\n}\r\n\r\nexport function visit(tiles: Tile[], visitors: Visitors): Trial {\r\n  const results: Trial = {};\r\n  for (const [name, visitor] of Object.entries(visitors)) {\r\n    const result = visitor(tiles, tiles[0].world);\r\n    results[name] = result;\r\n  }\r\n  return results;\r\n}\r\n\r\nexport interface Trial {\r\n  [key: string]: number;\r\n}\r\n\r\nexport class Experiment {\r\n  trials: Trial[] = [];\r\n\r\n  constructor(public visitors: Visitors) {}\r\n\r\n  recordDataFor(tiles: Tile[]) {\r\n    const trial = visit(tiles, this.visitors);\r\n    this.trials.push(trial);\r\n  }\r\n\r\n  visitorNames() {\r\n    return Object.keys(this.visitors);\r\n  }\r\n}\r\n\r\nexport class ExperimentSuite {\r\n  constructor(public experiments: Experiment[]) {}\r\n\r\n  recordDataFor(tiles: Tile[]) {\r\n    for (const e of this.experiments) {\r\n      e.recordDataFor(tiles);\r\n    }\r\n  }\r\n}\r\n","import { Environment } from \"core/environment\";\r\nimport { Cell } from \"core/tile\";\r\nimport { Layout, PlotData } from \"plotly.js\";\r\nimport React from \"react\";\r\nimport { standardGenome } from \"std/genomes/standardGenome\";\r\nimport { World } from \"../core\";\r\nimport { newBaseSpecies } from \"../core/species\";\r\nimport { Experiment, Visitors } from \"./experiment\";\r\n\r\nconst allSoilEnvironment: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0,\r\n  climate: { rainDuration: 0, timeBetweenRainfall: Infinity, waterPerSecond: 0 },\r\n  fill: (pos, world) => undefined,\r\n  secondsToEvaporate: Infinity,\r\n  floorCo2: 1,\r\n  temperaturePerSeason: [50, 50, 50, 50],\r\n  daylightPerSeason: [0.9, 0.9, 0.9, 0.9],\r\n};\r\n\r\nfunction testWorld(width: number, height: number) {\r\n  const world = new World(allSoilEnvironment, 0, newBaseSpecies(), {\r\n    width,\r\n    height,\r\n  });\r\n  const cellTypeTissue = standardGenome.cellTypes[0];\r\n  for (const t of world.allEnvironmentTiles()) {\r\n    const p = t.pos;\r\n    world.setTileAt(p, new Cell(p, world, cellTypeTissue));\r\n  }\r\n  world.cellAt(0, 0)!.inventory.set(100, 0);\r\n  return world;\r\n}\r\nfunction runOneWideAbsolute() {\r\n  const world1 = testWorld(20, 1);\r\n  const visitors: Visitors = {\r\n    time: (t) => t[0].world.time,\r\n  };\r\n  for (const c of world1.allCells()) {\r\n    const pos = c.pos;\r\n    const cell1 = world1.cellAt(pos)!;\r\n    visitors[pos.x] = () => {\r\n      const c1w = cell1.inventory.water;\r\n      return c1w;\r\n    };\r\n  }\r\n  const experiment = new Experiment(visitors);\r\n  console.time(\"run simulation\");\r\n  do {\r\n    if (world1.time % 1 < 0.1) {\r\n      experiment.recordDataFor(Array.from(world1.allCells()));\r\n    }\r\n    world1.step(0.1);\r\n  } while (world1.time <= 10);\r\n  console.timeEnd(\"run simulation\");\r\n  return experiment;\r\n}\r\n\r\nfunction runTwoWideCompare() {\r\n  const world1 = testWorld(20, 1);\r\n  const world2 = testWorld(20, 2);\r\n  const visitors: Visitors = {\r\n    time: (t) => t[0].world.time,\r\n  };\r\n  for (const c of world1.allCells()) {\r\n    const pos = c.pos;\r\n    const cell1 = world1.cellAt(pos)!;\r\n    const cell2 = world2.cellAt(pos)!;\r\n    visitors[pos.x] = () => {\r\n      const c1w = cell1.inventory.water;\r\n      const c2w = cell2.inventory.water;\r\n      // how much faster (or slower) a 2 wide channel goes compared to a one-wide\r\n      return c2w - c1w;\r\n    };\r\n  }\r\n  const experiment = new Experiment(visitors);\r\n  console.time(\"run simulation\");\r\n  do {\r\n    if (world1.time % 1 < 0.1) {\r\n      experiment.recordDataFor(Array.from(world1.allCells()));\r\n    }\r\n    world1.step(0.1);\r\n    world2.step(0.1);\r\n  } while (world1.time <= 10);\r\n  console.timeEnd(\"run simulation\");\r\n  return experiment;\r\n}\r\n\r\nfunction plotStackedBar(experiment: Experiment, divId: string) {\r\n  const data = [];\r\n  for (const trialIndex in experiment.trials) {\r\n    const trial = experiment.trials[trialIndex];\r\n    const x = [];\r\n    const y = [];\r\n    for (const name of experiment.visitorNames()) {\r\n      x.push(name);\r\n      const value = trial[name];\r\n      y.push(value);\r\n    }\r\n    const trace: Partial<PlotData> = {\r\n      x,\r\n      y,\r\n      name: `t=${Number(trialIndex) / 10}`,\r\n      type: \"bar\",\r\n    };\r\n    data.push(trace);\r\n  }\r\n  var layout: Partial<Layout> = { barmode: \"stack\" };\r\n\r\n  const div = document.createElement(\"div\");\r\n  const el = document.getElementById(divId)!;\r\n  el.appendChild(div);\r\n  window.Plotly.newPlot(div, data, layout);\r\n}\r\n\r\nfunction TestDiffusion() {\r\n  React.useEffect(() => {\r\n    var script = document.createElement(\"script\");\r\n    script.src = \"https://cdn.plot.ly/plotly-latest.min.js\";\r\n    script.addEventListener(\"load\", function() {\r\n      const e = runTwoWideCompare();\r\n      plotStackedBar(e, \"water-over-time\");\r\n    });\r\n    script.addEventListener(\"error\", () => {\r\n      const e1 = runOneWideAbsolute();\r\n      console.table(e1.trials);\r\n      const e2 = runTwoWideCompare();\r\n      console.table(e2.trials);\r\n    });\r\n\r\n    document.body.appendChild(script);\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <h1>Test Diffusion</h1>\r\n      <div id=\"water-over-time\">\r\n        <h2>width 20 world, water from t=0 to t=1 </h2>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TestDiffusion;\r\n","import { LevelInfo } from \"core/overworld/levelInfo\";\r\nimport { Environment } from \"../core/environment\";\r\n\r\nexport function environmentFromLevelInfo(info: LevelInfo) {\r\n  // const { rainfall, soilType, temperature } = levelInfo;\r\n\r\n  switch (info.height) {\r\n    case 0:\r\n      return Level0;\r\n    case 1:\r\n      return Temperate;\r\n    case 2:\r\n      return Reservoires;\r\n    case 3:\r\n      return Rocky;\r\n    case 4:\r\n      return SkySoil;\r\n    case 5:\r\n      return Desert;\r\n    case 6:\r\n      return Mound;\r\n    case 7:\r\n      return InverseMound;\r\n    case 8:\r\n      return Pillars;\r\n    case 9:\r\n      return RockMaze;\r\n    case 10:\r\n      return CliffSide;\r\n    case 11:\r\n      return MountainSide;\r\n    case 12:\r\n      return MountainTop;\r\n    default:\r\n      return Level0;\r\n  }\r\n  // return Reservoires;\r\n}\r\n\r\nexport const Level0: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.2,\r\n  climate: {\r\n    // 9 water/sec\r\n    timeBetweenRainfall: 70,\r\n    rainDuration: 3,\r\n    waterPerSecond: 210,\r\n  },\r\n  secondsToEvaporate: 166,\r\n  floorCo2: 0.5,\r\n  temperaturePerSeason: [2, 2, 2, 1],\r\n  daylightPerSeason: [0.85, 0.9, 0.8, 0.7],\r\n  fill: \"Level0\",\r\n};\r\n\r\nexport const Temperate: Environment = {\r\n  insectsPerDay: 1,\r\n  airEvaporation: 0.3,\r\n  climate: {\r\n    // 10.2 water/sec\r\n    timeBetweenRainfall: 65,\r\n    rainDuration: 3,\r\n    waterPerSecond: 220,\r\n  },\r\n  secondsToEvaporate: 166,\r\n  floorCo2: 0.5,\r\n  temperaturePerSeason: [2, 3, 2, 1],\r\n  daylightPerSeason: [0.85, 0.9, 0.8, 0.7],\r\n  fill: \"Temperate\",\r\n};\r\n\r\nexport const Reservoires: Environment = {\r\n  insectsPerDay: 1,\r\n  airEvaporation: 0.3,\r\n  climate: {\r\n    // 12 water/sec (!)\r\n    timeBetweenRainfall: 20,\r\n    rainDuration: 8,\r\n    waterPerSecond: 30,\r\n  },\r\n  secondsToEvaporate: 166,\r\n  floorCo2: 0.5,\r\n  temperaturePerSeason: [2, 3, 2, 1],\r\n  daylightPerSeason: [0.85, 0.9, 0.8, 0.7],\r\n  fill: \"Reservoires\",\r\n};\r\n\r\nexport const Rocky: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.03,\r\n  climate: {\r\n    // 12.96 water/sec, but much longer apart\r\n    timeBetweenRainfall: 83.333,\r\n    rainDuration: 6,\r\n    waterPerSecond: 180,\r\n  },\r\n  secondsToEvaporate: 166,\r\n  floorCo2: 0.8,\r\n  temperaturePerSeason: [2, 2, 1, 1],\r\n  daylightPerSeason: [0.85, 0.9, 0.8, 0.7],\r\n  fill: \"Rocky\",\r\n};\r\n\r\nexport const SkySoil: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.3,\r\n  climate: {\r\n    // 10.5 water/sec; often, but small rains\r\n    timeBetweenRainfall: 12,\r\n    rainDuration: 6,\r\n    waterPerSecond: 21,\r\n  },\r\n  secondsToEvaporate: 166,\r\n  floorCo2: 0.5,\r\n  // start cold\r\n  temperaturePerSeason: [1, 2, 2, 1],\r\n  daylightPerSeason: [0.8, 0.8, 0.7, 0.65],\r\n  fill: \"SkySoil\",\r\n};\r\n\r\nexport const Desert: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.3,\r\n  climate: {\r\n    // 12.66 water/sec, very far apart\r\n    timeBetweenRainfall: 110,\r\n    rainDuration: 6.3333,\r\n    waterPerSecond: 220,\r\n  },\r\n  // evaporates quickly!\r\n  secondsToEvaporate: 16,\r\n  // very good co2\r\n  floorCo2: 0.95,\r\n  temperaturePerSeason: [3, 3, 4, 2],\r\n  daylightPerSeason: [0.85, 0.95, 0.8, 0.7],\r\n  fill: \"Desert\",\r\n};\r\n\r\nexport const Mound: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.3,\r\n  climate: {\r\n    timeBetweenRainfall: 50,\r\n    rainDuration: 3,\r\n    waterPerSecond: 120,\r\n  },\r\n  secondsToEvaporate: 120,\r\n  floorCo2: 0.5,\r\n  temperaturePerSeason: [2, 2, 1, 0],\r\n  daylightPerSeason: [0.85, 0.9, 0.8, 0.7],\r\n  fill: \"Mound\",\r\n};\r\n\r\nexport const InverseMound: Environment = {\r\n  insectsPerDay: 2,\r\n  airEvaporation: 0.5,\r\n  climate: {\r\n    timeBetweenRainfall: 40,\r\n    rainDuration: 3,\r\n    waterPerSecond: 120,\r\n  },\r\n  secondsToEvaporate: 12,\r\n  floorCo2: 0.5,\r\n  temperaturePerSeason: [3, 4, 4, 2],\r\n  daylightPerSeason: [0.85, 0.9, 0.85, 0.5],\r\n  fill: \"InverseMound\",\r\n};\r\n\r\nexport const Pillars: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.02,\r\n  climate: {\r\n    // 17.778\r\n    timeBetweenRainfall: 90,\r\n    rainDuration: 8,\r\n    waterPerSecond: 200,\r\n  },\r\n  secondsToEvaporate: 300,\r\n  floorCo2: 0.8,\r\n  temperaturePerSeason: [1, 1, 1, 0],\r\n  daylightPerSeason: [0.7, 0.75, 0.65, 0.5],\r\n  fill: \"Pillars\",\r\n};\r\n\r\nexport const RockMaze: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.1,\r\n  climate: {\r\n    // 13.333\r\n    timeBetweenRainfall: 30,\r\n    rainDuration: 2,\r\n    waterPerSecond: 200,\r\n  },\r\n  secondsToEvaporate: 60,\r\n  floorCo2: 0.5,\r\n  temperaturePerSeason: [3, 4, 2, 0],\r\n  daylightPerSeason: [0.8, 0.95, 0.8, 0.7],\r\n  fill: \"RockMaze\",\r\n};\r\n\r\nexport const CliffSide: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.1,\r\n  climate: {\r\n    rainDuration: 4,\r\n    timeBetweenRainfall: 90,\r\n    waterPerSecond: 200,\r\n  },\r\n  secondsToEvaporate: 1000,\r\n  floorCo2: 2,\r\n  temperaturePerSeason: [1, 2, 1, 0],\r\n  daylightPerSeason: [0.85, 0.95, 0.85, 0.75],\r\n  fill: \"CliffSide\",\r\n};\r\n\r\nexport const MountainSide: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.02,\r\n  climate: {\r\n    rainDuration: 11,\r\n    timeBetweenRainfall: 130,\r\n    waterPerSecond: 250,\r\n  },\r\n  secondsToEvaporate: 120,\r\n  floorCo2: 0.5,\r\n  temperaturePerSeason: [2, 2, 1, 0],\r\n  daylightPerSeason: [0.8, 0.9, 0.75, 0.5],\r\n  fill: \"MountainSide\",\r\n};\r\n\r\nexport const MountainTop: Environment = {\r\n  insectsPerDay: 0,\r\n  airEvaporation: 0.02,\r\n  climate: {\r\n    rainDuration: 11,\r\n    timeBetweenRainfall: 130,\r\n    waterPerSecond: 250,\r\n  },\r\n  secondsToEvaporate: 120,\r\n  floorCo2: 0.5,\r\n  temperaturePerSeason: [1, 2, 1, 0],\r\n  daylightPerSeason: [0.5, 0.8, 0.7, 0.5],\r\n  fill: \"Random\",\r\n};\r\n","import characterSrc from \"assets/images/character.png\";\r\nimport classNames from \"classnames\";\r\nimport React from \"react\";\r\nimport \"./Character.scss\";\r\n\r\nfunction Character(props: JSX.IntrinsicElements[\"img\"] & { size?: \"xs\" | \"small\" | \"medium\" | \"large\" }) {\r\n  const { size, className, ...otherProps } = props;\r\n  return <img className={classNames(\"character\", size, className)} alt=\"\" src={characterSrc} {...otherProps} />;\r\n}\r\n\r\nexport default Character;\r\n","import * as React from \"react\";\r\nimport \"./Glow.scss\";\r\n\r\nexport function Glow() {\r\n  return (\r\n    <div className=\"glow\">\r\n      <span />\r\n    </div>\r\n  );\r\n}\r\n","import { Slider } from \"@blueprintjs/core\";\r\nimport fruitSrc from \"assets/images/fruit.png\";\r\nimport classNames from \"classnames\";\r\nimport { PopulationAttempt } from \"game/app\";\r\nimport MP from \"game/ui/common/MP\";\r\nimport { map } from \"math\";\r\nimport * as React from \"react\";\r\nimport { GeneInstance } from \"../../core/cell/geneInstance\";\r\nimport { seasonDisplay, seasonFromTime } from \"../../core/season\";\r\nimport { Cell } from \"../../core/tile\";\r\nimport { GeneFruit, reproducerGetPercentMatured } from \"../../std/genes/GeneReproducer\";\r\nimport { mitoDeath } from \"../audio\";\r\nimport { GameResult } from \"../gameResult\";\r\nimport Character from \"../ui/common/Character\";\r\nimport { Glow } from \"../ui/common/Glow\";\r\nimport \"./GameResultsScreen.scss\";\r\n\r\ninterface GameResultsScreenProps {\r\n  onDone: () => void;\r\n  results: GameResult;\r\n  attempt?: PopulationAttempt;\r\n}\r\n\r\nfunction FruitResult({ fruit, mpEarned }: { fruit: GeneInstance<GeneFruit>; mpEarned: number }) {\r\n  const scale = map(reproducerGetPercentMatured(fruit), 0, 1, 0.2, 1);\r\n  const style = React.useMemo(() => {\r\n    return {\r\n      transform: `scale(${scale})`,\r\n    };\r\n  }, [scale]);\r\n  return (\r\n    <div className=\"fruit-info\">\r\n      <div className=\"fruit-visual\">\r\n        {fruit.state.isMature ? <Glow /> : null}\r\n        <img alt=\"\" src={fruitSrc} style={style} />\r\n      </div>\r\n      {fruit.state.timeMatured != null ? (\r\n        <>\r\n          <span className=\"matured-info success\">\r\n            +<MP amount={mpEarned} />\r\n          </span>\r\n          &nbsp;at {seasonDisplay(seasonFromTime(fruit.state.timeMatured))}, Mutation Points earned: 1\r\n        </>\r\n      ) : (\r\n        <span className=\"matured-info in-progress\">\r\n          {(reproducerGetPercentMatured(fruit) * 100).toFixed(0)}% maturity\r\n        </span>\r\n      )}\r\n      , started at {seasonDisplay(seasonFromTime(fruit.cell.timeMade))}.\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ReproductiveCellResult({ cell, mpEarned }: { cell: Cell; mpEarned: number }) {\r\n  const fruit = cell.findGene(GeneFruit);\r\n  if (fruit != null) {\r\n    return <FruitResult fruit={fruit} mpEarned={mpEarned} />;\r\n  } else {\r\n    return (\r\n      <div>\r\n        {cell.toString()} +<MP amount={mpEarned} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nfunction MPEarnerList({ mpEarners, className }: { mpEarners: Map<Cell, number>; className?: string }) {\r\n  if (mpEarners.size > 0) {\r\n    return (\r\n      <div className={classNames(\"mp-earner-list\", className)}>\r\n        <h5>Reproductive Cells</h5>\r\n        <div>\r\n          {Array.from(mpEarners.entries()).map(([cell, mpEarned]) => (\r\n            <ReproductiveCellResult cell={cell} mpEarned={mpEarned} />\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction VignetteList({ vignettes }: { vignettes?: HTMLCanvasElement[] | undefined }) {\r\n  const [index, setIndex] = React.useState(0);\r\n  if (vignettes && vignettes.length > 0) {\r\n    return (\r\n      <div className=\"vignette-viewer\">\r\n        <Slider\r\n          className=\"slider\"\r\n          value={index}\r\n          min={0}\r\n          stepSize={1}\r\n          max={vignettes.length - 1}\r\n          onChange={setIndex}\r\n          showTrackFill={false}\r\n          labelRenderer={(val) => `Day ${val + 1}`}\r\n        />\r\n        <div className=\"current-vignette\">\r\n          <img src={vignettes[index].toDataURL()} alt=\"\" />\r\n        </div>\r\n      </div>\r\n    );\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction GameWonScreen({ results }: GameResultsScreenProps) {\r\n  const winDescription =\r\n    Array.from(results.mpEarners.entries()).filter(([c, mp]) => mp > 0).length < 3 ? \"survived\" : \"thrived\";\r\n  return (\r\n    <>\r\n      <div className=\"character-container\">\r\n        <Character size=\"large\" className=\"dance\" />\r\n      </div>\r\n      <h1>You {winDescription}!</h1>\r\n      <h2>\r\n        {results.mutationPointsPerEpoch} Mutation Points earned. {results.oxygenContribution} Oxygen per second.\r\n      </h2>\r\n      <VignetteList vignettes={results.vignettes} />\r\n      <MPEarnerList mpEarners={results.mpEarners} />\r\n    </>\r\n  );\r\n}\r\n\r\nfunction GameLostScreen({ results }: GameResultsScreenProps) {\r\n  React.useEffect(() => {\r\n    mitoDeath.play();\r\n    return () => {\r\n      mitoDeath.stop();\r\n    };\r\n  }, []);\r\n  return (\r\n    <>\r\n      <div className=\"character-container\">\r\n        <Character className=\"sad\" size=\"large\" />\r\n      </div>\r\n      <h1>\r\n        <i>{results.world.species.name}</i> couldn't survive!\r\n      </h1>\r\n      <div>You survived until {seasonDisplay(results.world.season)}!</div>\r\n      <VignetteList vignettes={results.vignettes} />\r\n      <MPEarnerList mpEarners={results.mpEarners} className=\"dark\" />\r\n    </>\r\n  );\r\n}\r\n\r\nconst GameResultsScreen: React.FC<GameResultsScreenProps> = React.memo((props) => {\r\n  const { onDone, results, attempt } = props;\r\n  const primaryButtonText =\r\n    attempt != null && attempt.sourceHex == null && results.status === \"lost\" ? \"Retry\" : \"Continue\";\r\n  return (\r\n    <div className={`game-results-screen ${results.status}`}>\r\n      <div className=\"game-results-content\">\r\n        {results.status === \"won\" ? <GameWonScreen {...props} /> : <GameLostScreen {...props} />}\r\n        <button className=\"done-button\" onClick={onDone}>\r\n          {primaryButtonText} →\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default GameResultsScreen;\r\n","import { GameResult } from \"game/gameResult\";\r\nimport React from \"react\";\r\nimport { Temperate } from \"std/environments\";\r\nimport { GeneFruit } from \"std/genes/GeneReproducer\";\r\nimport { standardGenome } from \"std/genomes/standardGenome\";\r\nimport { Vector2 } from \"three\";\r\nimport { World } from \"../core\";\r\nimport { newBaseSpecies } from \"../core/species\";\r\nimport { Cell } from \"../core/tile\";\r\nimport GameResultsScreen from \"../game/screens/GameResultsScreen\";\r\n\r\nexport function mockFruit(world: World, percent: number, timeMatured?: number) {\r\n  const cellTypeFruit = standardGenome.cellTypes[4];\r\n  const cell = new Cell(new Vector2(0, 0), world, cellTypeFruit);\r\n  const fruit = cell.findGene(GeneFruit)!;\r\n  fruit.state.energyRecieved = fruit.props.neededResources * percent;\r\n  fruit.state.timeMatured = timeMatured;\r\n  fruit.state.isMature = percent === 1;\r\n  return cell;\r\n}\r\n\r\nexport function TestWinScreen() {\r\n  const world = new World(Temperate, 0, newBaseSpecies());\r\n  const f1 = mockFruit(world, 1, 250);\r\n  const f2 = mockFruit(world, 0.4);\r\n  const f3 = mockFruit(world, 1, 900);\r\n  const mockResults: GameResult = {\r\n    status: \"won\",\r\n    mpEarners: new Map([\r\n      [f1, 3],\r\n      [f2, 0],\r\n      [f3, 3],\r\n    ]),\r\n    mutationPointsPerEpoch: 6,\r\n    oxygenContribution: 0,\r\n    world,\r\n  };\r\n  return <GameResultsScreen results={mockResults} onDone={() => {}} />;\r\n}\r\n","import { TIME_PER_DAY } from \"core/constants\";\r\nimport { GameResult } from \"game/gameResult\";\r\nimport React from \"react\";\r\nimport { Temperate } from \"std/environments\";\r\nimport { World } from \"../core\";\r\nimport { newBaseSpecies } from \"../core/species\";\r\nimport GameResultsScreen from \"../game/screens/GameResultsScreen\";\r\nimport { mockFruit } from \"./TestWinScreen\";\r\n\r\nexport function TestLoseScreen() {\r\n  const world = new World(Temperate, 0, newBaseSpecies());\r\n  world.time = TIME_PER_DAY * 4;\r\n  const f1 = mockFruit(world, 0.4);\r\n  world.time = TIME_PER_DAY * 9;\r\n  const f2 = mockFruit(world, 0.3);\r\n  world.time = TIME_PER_DAY * 19;\r\n  const f3 = mockFruit(world, 0.01459);\r\n  const mockResults: GameResult = {\r\n    mpEarners: new Map([\r\n      [f1, 0],\r\n      [f2, 0],\r\n      [f3, 0],\r\n    ]),\r\n    status: \"lost\",\r\n    mutationPointsPerEpoch: 0,\r\n    oxygenContribution: 0,\r\n    world,\r\n  };\r\n  return <GameResultsScreen results={mockResults} onDone={() => {}} />;\r\n}\r\n","/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport produce from \"immer\";\r\nimport { minBy } from \"lodash\";\r\nimport { randInt } from \"math\";\r\nimport { arrayRange, gridRange } from \"math/arrays\";\r\nimport React, { useCallback, useMemo, useState } from \"react\";\r\nimport \"./WFCTest.scss\";\r\n\r\ntype Id = number;\r\n\r\n/**\r\n * Each element should be an integer [0, N], one member of our tileset.\r\n *\r\n * e.g. 0 = water, 1 = land, 2 = mountain\r\n *\r\n * [[0, 2, 1],\r\n *  [0, 1, 2],\r\n *  [1, 2, 1]\r\n * ]\r\n */\r\ntype Grid = Id[][];\r\n\r\nfunction grid(width: number, height: number): Grid {\r\n  return gridRange(width, height, () => 0);\r\n}\r\n\r\ntype UncollapsedGrid = (RelationWeights | number)[][];\r\n\r\nconst charMap: Record<Id, string> = {\r\n  0: \"~\",\r\n  1: \"·\",\r\n  2: \"🌳\",\r\n  3: \"🏯\",\r\n};\r\nfunction gridToReact(g: Grid, onClick?: (event: React.MouseEvent) => void): JSX.Element {\r\n  return (\r\n    <div className=\"grid\">\r\n      {g.map((row, y) => (\r\n        <div className=\"row\">\r\n          {row.map((id, x) => (\r\n            <span grid-x={x} grid-y={y} className={\"tile\" + String(id)} onClick={onClick}>\r\n              {charMap[id]}\r\n            </span>\r\n          ))}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nconst initialSrcGrid = g(`\r\n000\r\n111\r\n121\r\n`);\r\n// const initialSrcGrid = g(`\r\n// 210000000\r\n// 211111110\r\n// 222222210\r\n// 211111110\r\n// 222211110\r\n// 223222210\r\n// 222222210\r\n// 211111110\r\n// 210000000\r\n// `);\r\n\r\nconst WFCTest = () => {\r\n  const [srcGrid, setSrcGrid] = useState(initialSrcGrid);\r\n  const [id, setId] = useState(0);\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  const output = useMemo(() => wfc(srcGrid, 25, 25), [srcGrid, id]);\r\n\r\n  const outputReact = useMemo(() => gridToReact(output), [output]);\r\n  const upId = useCallback(() => setId((id) => id + 1), []);\r\n\r\n  const handleSrcClick = useCallback((event: React.MouseEvent) => {\r\n    const x = Number(event.currentTarget.attributes.getNamedItem(\"grid-x\")!.value);\r\n    const y = Number(event.currentTarget.attributes.getNamedItem(\"grid-y\")!.value);\r\n    setSrcGrid((srcGrid) =>\r\n      produce(srcGrid, (srcGrid) => {\r\n        srcGrid[y][x] = (srcGrid[y][x] + 1) % NUM_IDS;\r\n      })\r\n    );\r\n  }, []);\r\n  const outputSrcReact = useMemo(() => gridToReact(srcGrid, handleSrcClick), [handleSrcClick, srcGrid]);\r\n\r\n  return (\r\n    <div className=\"wfc-container\">\r\n      <div className=\"source\">\r\n        <h2>Source</h2>\r\n        {outputSrcReact}\r\n      </div>\r\n      <div className=\"output\">\r\n        <button onClick={upId} style={{ padding: \"1em 0.5em\", fontSize: 20, margin: 20 }}>\r\n          New\r\n        </button>\r\n        {outputReact}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nfunction g(s: string) {\r\n  return s\r\n    .trim()\r\n    .split(\"\\n\")\r\n    .map((row) => row.split(\"\").map((char) => Number(char)));\r\n}\r\n\r\nlet NUM_IDS = 4;\r\nlet IDS_LIST = arrayRange(NUM_IDS);\r\n\r\nfunction wfc(grid: Grid, outWidth: number, outHeight: number): Grid {\r\n  const gridFlat = grid.flat();\r\n  // NUM_IDS = new Set(gridFlat).size;\r\n  // IDS_LIST = arrayRange(NUM_IDS);\r\n  // first, extract neighbor weights from input\r\n  const relationModel = newRelationModel(grid);\r\n  console.log(relationModel);\r\n\r\n  const globalAppearanceWeights: RelationWeights = newRelationWeights(NUM_IDS);\r\n  gridFlat.forEach((id) => (globalAppearanceWeights[id] = (globalAppearanceWeights[id] ?? 0) + 1));\r\n  normalizeWeights(globalAppearanceWeights);\r\n\r\n  function tryCollapseGrid(): Grid | undefined {\r\n    // start with a uncollapsed grid\r\n    const uncollapsedGrid: UncollapsedGrid = gridRange(outWidth, outHeight, () => globalAppearanceWeights.slice());\r\n\r\n    // pick a random point to start off\r\n    // when point is null, then we've successfully collapsed!\r\n    let point: Point | null = { x: randInt(0, outWidth - 1), y: randInt(0, outHeight - 1) };\r\n    // actually we want a minheap. Key is `${x},${y}` of a point. Value is that point's entropy.\r\n    const frontier: Map<string, number> = new Map();\r\n    let iter = 0;\r\n    do {\r\n      const id = collapseGridPoint(uncollapsedGrid, point, relationModel);\r\n      if (id == null) {\r\n        // we hit a degenerate case, fail the entire tryCollapseGrid attempt\r\n        return;\r\n      }\r\n      frontier.delete(`${point.x},${point.y}`);\r\n\r\n      // return true if weights updated, false if neighbor became degenerate\r\n      function updateNeighborWeights(x: number, y: number, relationWeights: RelationWeights) {\r\n        const neighborWeights = uncollapsedGrid[y]?.[x];\r\n        // ignore out of bounds or already collapsed\r\n        if (neighborWeights == null || typeof neighborWeights === \"number\") {\r\n          return;\r\n        }\r\n\r\n        // // to update: dot product the current uncollapsed state with the passed in relation weights\r\n        // const newWeights = dot(neighborWeights, relationWeights);\r\n\r\n        // to update: zero out incompatible neighbors\r\n        const newWeights = arrayRange(neighborWeights.length, (i) =>\r\n          relationWeights[i] === 0 ? 0 : neighborWeights[i]\r\n        );\r\n\r\n        // if we've hit a zero case on a neighbor, the entropy will be 0 and it will be caught in the next run anyways\r\n        if (!isZero(newWeights)) {\r\n          normalizeWeights(newWeights);\r\n        }\r\n\r\n        uncollapsedGrid[y][x] = newWeights;\r\n        // now, update the frontier. Be sure to normalize\r\n        frontier.set(`${x},${y}`, entropy(newWeights));\r\n      }\r\n\r\n      // update neighbors\r\n      updateNeighborWeights(point.x, point.y - 1, relationModel.get(id)!.n);\r\n      updateNeighborWeights(point.x, point.y + 1, relationModel.get(id)!.s);\r\n      updateNeighborWeights(point.x - 1, point.y, relationModel.get(id)!.w);\r\n      updateNeighborWeights(point.x + 1, point.y, relationModel.get(id)!.e);\r\n\r\n      function pickNextPoint(): Point | null {\r\n        if (frontier.size === 0) {\r\n          return null;\r\n        }\r\n        // find the minimal entropy point from the frontier\r\n        const [nextPointStr] = minBy(Array.from(frontier.entries()), ([point, entropy]) => entropy)!;\r\n        const [xStr, yStr] = nextPointStr.split(\",\");\r\n        return {\r\n          x: Number(xStr),\r\n          y: Number(yStr),\r\n        };\r\n      }\r\n      point = pickNextPoint();\r\n      iter++;\r\n    } while (point != null);\r\n    return uncollapsedGrid as Grid;\r\n  }\r\n\r\n  let attempt = 0;\r\n  let output: Grid | undefined;\r\n  for (; output == null; attempt++) {\r\n    output = tryCollapseGrid();\r\n  }\r\n\r\n  // now, collapse the grid of possibilities.\r\n  return output!;\r\n}\r\n\r\n/**\r\n * Entropy is a calcuation of how much \"randomness\" the tile has.\r\n *\r\n * A weight like [0.01, 0.99] has low entropy - it's very likely to be Tile 1.\r\n * A weight of [0.5, 0.5] would have higher entropy.\r\n * A weight of [0.3, 0.3, 0.4] would have even higher entropy, since there's even more possibilities.\r\n *\r\n * // so - more weights = higher entropy\r\n * // more difference between the weights = higher entropy\r\n *\r\n * but, something like [0.01, 0.01, 0.98] still has *low entropy*, even lower than [0.5, 0.5]\r\n *\r\n * first pass:\r\n * log(numWeights) * weightVariance ? maybe?\r\n *\r\n * Wikipedia defines it as:\r\n * -sum( weight[i] * log(weight[i]) )\r\n *\r\n * this article at https://robertheaton.com/2018/12/17/wavefunction-collapse-algorithm/ suggests:\r\n * log(sum(weight)) - (sum(weight * log(weight)) / sum(weight))\r\n *\r\n */\r\nfunction entropy(weights: RelationWeights): number {\r\n  let e = 0;\r\n  weights.forEach((w) => {\r\n    if (w !== 0) {\r\n      e += -(w * Math.log(w));\r\n    }\r\n  });\r\n  // we have to remove the 0 weights\r\n  if (isNaN(e)) {\r\n    throw new Error(\"NaN entropy\");\r\n  }\r\n  return e;\r\n}\r\n\r\nfunction multiplyWeights(a: RelationWeights, b: RelationWeights): RelationWeights {\r\n  if (a.length !== b.length) {\r\n    throw new Error(\"multiply length mismatch\");\r\n  }\r\n  return arrayRange(a.length, (i) => a[i] * b[i]);\r\n}\r\n\r\nfunction isZero(weights: RelationWeights) {\r\n  return weights.every((w) => w === 0);\r\n}\r\n\r\ntype Point = { x: number; y: number };\r\n\r\nfunction collapseGridPoint(\r\n  uncollapsedGrid: UncollapsedGrid,\r\n  point: Point,\r\n  relationModel: RelationModel\r\n): Id | undefined {\r\n  let weights = uncollapsedGrid[point.y][point.x];\r\n  if (typeof weights === \"number\") {\r\n    throw new Error(\"Collapsing an already collapsed point!\");\r\n  }\r\n  if (isZero(weights)) {\r\n    return;\r\n  }\r\n  weights = weights.slice();\r\n\r\n  function scaleFromNeighbors(weights: RelationWeights, x: number, y: number, dir: \"n\" | \"w\" | \"e\" | \"s\") {\r\n    // account for nearby grid points\r\n    const neighbor = uncollapsedGrid[y]?.[x];\r\n    if (neighbor == null) {\r\n      return;\r\n    }\r\n    if (typeof neighbor === \"number\") {\r\n      // it's collapsed; scale the weights by exactly the relation model\r\n      weights = multiplyWeights(weights, relationModel.get(neighbor)![dir]);\r\n    } else {\r\n      // do nothing for uncollapsed (for now)\r\n    }\r\n  }\r\n  scaleFromNeighbors(weights, point.x, point.y - 1, \"s\");\r\n  scaleFromNeighbors(weights, point.x, point.y + 1, \"n\");\r\n  scaleFromNeighbors(weights, point.x - 1, point.y, \"e\");\r\n  scaleFromNeighbors(weights, point.x + 1, point.y, \"w\");\r\n\r\n  normalizeWeights(weights);\r\n  const sample = collapse(weights);\r\n  uncollapsedGrid[point.y][point.x] = sample;\r\n  return sample;\r\n}\r\n\r\nfunction collapse(weights: RelationWeights) {\r\n  return weightedSample(IDS_LIST, weights);\r\n}\r\n\r\nfunction newRelationModel(grid: Grid) {\r\n  const relationModel: RelationModel = new Map();\r\n\r\n  function maybeCountNeighbor(x: number, y: number, array: RelationWeights) {\r\n    const id: number | undefined = grid[y]?.[x];\r\n    if (id != null) {\r\n      // count +1 to the weight for the neighbor\r\n      array[id] = (array[id] ?? 0) + 1;\r\n    }\r\n  }\r\n  function countWeight(x: number, y: number, id: Id) {\r\n    if (!relationModel.has(id)) {\r\n      relationModel.set(id, {\r\n        s: newRelationWeights(NUM_IDS),\r\n        e: newRelationWeights(NUM_IDS),\r\n        n: newRelationWeights(NUM_IDS),\r\n        w: newRelationWeights(NUM_IDS),\r\n      });\r\n    }\r\n    const relations = relationModel.get(id)!;\r\n\r\n    maybeCountNeighbor(x, y - 1, relations.n);\r\n    maybeCountNeighbor(x, y + 1, relations.s);\r\n    maybeCountNeighbor(x - 1, y, relations.w);\r\n    maybeCountNeighbor(x + 1, y, relations.e);\r\n  }\r\n  // iterate through input and build relation model\r\n  for (let y = 0; y < grid.length; y++) {\r\n    for (let x = 0; x < grid[y].length; x++) {\r\n      countWeight(x, y, grid[y][x]);\r\n    }\r\n  }\r\n\r\n  // normalize weights\r\n  // SPECIAL CASE - sometimes relations are all 0's (e.g. boundary tiles)\r\n  // in this case, use a uniform distribution\r\n  for (const [id, relations] of relationModel) {\r\n    normalizeOrUniformWeights(relations.n);\r\n    normalizeOrUniformWeights(relations.e);\r\n    normalizeOrUniformWeights(relations.s);\r\n    normalizeOrUniformWeights(relations.w);\r\n  }\r\n\r\n  return relationModel;\r\n}\r\n\r\nfunction normalizeOrUniformWeights(arr: RelationWeights) {\r\n  if (isZero(arr)) {\r\n    arr.fill(1 / arr.length);\r\n  } else {\r\n    normalizeWeights(arr);\r\n  }\r\n}\r\n\r\nfunction normalizeWeights(arr: RelationWeights) {\r\n  const sum = arr.reduce((a, b) => a + b, 0);\r\n  if (sum <= 0) {\r\n    throw new Error(\"normalizing a zero weight!\");\r\n  }\r\n  for (let i = 0; i < arr.length; i++) {\r\n    arr[i] = arr[i] / sum;\r\n  }\r\n}\r\n\r\n/**\r\n * Index is the tile type id, maps to the N/E/S/W relations for that id.\r\n */\r\ntype RelationModel = Map<Id, NeighborRelations>;\r\n\r\ninterface NeighborRelations {\r\n  n: RelationWeights;\r\n  s: RelationWeights;\r\n  e: RelationWeights;\r\n  w: RelationWeights;\r\n}\r\n\r\n/**\r\n * Index is the tile type id, value is the weight for that type.\r\n */\r\ntype RelationWeights = number[];\r\n\r\nfunction newRelationWeights(length: number) {\r\n  return new Array(length).fill(0);\r\n}\r\n\r\nexport default WFCTest;\r\n\r\nfunction weightedSample<T>(arr: T[], weights: number[]) {\r\n  if (arr.length !== weights.length) {\r\n    throw new RangeError(\"Chance: Length of array and weights must match\");\r\n  }\r\n\r\n  // scan weights array and sum valid entries\r\n  var sum = 0;\r\n  var val;\r\n  for (var weightIndex = 0; weightIndex < weights.length; ++weightIndex) {\r\n    val = weights[weightIndex];\r\n    if (isNaN(val)) {\r\n      val = 0;\r\n    }\r\n\r\n    if (val > 0) {\r\n      sum += val;\r\n    }\r\n  }\r\n\r\n  if (sum === 0) {\r\n    throw new RangeError(\"Chance: No valid entries in array weights\");\r\n  }\r\n\r\n  // select a value within range\r\n  var selected = Math.random() * sum;\r\n\r\n  // find array entry corresponding to selected value\r\n  var total = 0;\r\n  var lastGoodIdx = -1;\r\n  var chosenIdx!: number;\r\n  for (weightIndex = 0; weightIndex < weights.length; ++weightIndex) {\r\n    val = weights[weightIndex];\r\n    total += val;\r\n    if (val > 0) {\r\n      if (selected <= total) {\r\n        chosenIdx = weightIndex;\r\n        break;\r\n      }\r\n      lastGoodIdx = weightIndex;\r\n    }\r\n\r\n    // handle any possible rounding error comparison to ensure something is picked\r\n    if (weightIndex === weights.length - 1) {\r\n      chosenIdx = lastGoodIdx;\r\n    }\r\n  }\r\n\r\n  var chosen = arr[chosenIdx];\r\n\r\n  return chosen;\r\n}\r\n","import { RealizedGene } from \"core/cell\";\r\nimport { Species } from \"core/species\";\r\nimport { randInt } from \"math\";\r\nimport shuffle from \"math/shuffle\";\r\nimport { GeneDiffuseWater } from \"std/genes/GeneDiffuseWater\";\r\nimport { GenePipes } from \"std/genes/GenePipes\";\r\nimport { GeneTransport } from \"std/genes/GeneTransport\";\r\nimport { AllGenesByName } from \"../../../core/cell/gene\";\r\n\r\nexport function generateGeneOptions(species: Species, isFirstChoice: boolean): RealizedGene[] {\r\n  if (isFirstChoice) {\r\n    return [GeneTransport.level(0), GenePipes.level(0), GeneDiffuseWater.level(0)];\r\n  }\r\n\r\n  // disallow same gene to spawn in one drawing\r\n  const allGenes = Array.from(AllGenesByName.values());\r\n  shuffle(allGenes);\r\n  const allProviderGenes = allGenes.filter((gene) => gene.blueprint.levelCosts[0] < 0);\r\n  const allConsumerGenes = allGenes.filter((gene) => gene.blueprint.levelCosts[0] >= 0);\r\n  // const genes: RealizedGene[] = allGenes.slice(0, numGenes).map((g) => g.level(randInt(0, g.numLevels - 1)));\r\n  // return genes;\r\n  const genes = [\r\n    ...allConsumerGenes.slice(0, 2).map((g) => g.level(randInt(0, g.numLevels - 1))),\r\n    allProviderGenes[0].level(randInt(0, allProviderGenes[0].numLevels - 1)),\r\n  ];\r\n  return genes;\r\n}\r\n","import { HexTile } from \"core/overworld/hexTile\";\r\nimport { lineage, Species } from \"core/species\";\r\nimport { GameResult } from \"game/gameResult\";\r\nimport { generateGeneOptions } from \"game/ui/SpeciesViewer/generateGeneOptions\";\r\nimport produce from \"immer\";\r\nimport React, { useContext } from \"react\";\r\nimport { AppState, PopulationAttempt } from \"./state\";\r\n\r\ntype AppReducerContextType = [AppState, React.Dispatch<AppActions>];\r\n\r\nexport const AppReducerContext = React.createContext<AppReducerContextType>(null!);\r\n\r\nexport function useAppReducer() {\r\n  return useContext(AppReducerContext);\r\n}\r\n\r\nexport function reducer(state: AppState, action: AppActions): AppState {\r\n  if (action == null) {\r\n    console.error(\"can't reduce null action!\", state, action);\r\n    return state;\r\n  }\r\n  switch (action.type) {\r\n    // a dummy trigger on species mutate\r\n    case \"AAUpdateSpecies\":\r\n      return handleUpdateSpecies(state, action);\r\n    case \"AAStartPopulationAttempt\":\r\n      return handleStartPopulationAttempt(state, action);\r\n    case \"AAPopulationAttemptSuccess\":\r\n      return handlePopulationAttemptSuccess(state, action);\r\n    case \"AANextEpoch\":\r\n      return handleNextEpoch(state, action);\r\n    case \"AAGetGameResult\":\r\n      return handleGetGameResult(state, action);\r\n    case \"AAGameResultDone\":\r\n      return handleGameResultDone(state, action);\r\n    case \"AATransitionStart\":\r\n      return handleTransitionStart(state, action);\r\n    case \"AATransitionEnd\":\r\n      // no-op; this must be handled in the middleware\r\n      return state;\r\n    // return handleTransitionEnd(state, action);\r\n  }\r\n}\r\n\r\nexport type AppActions =\r\n  | AAUpdateSpecies\r\n  | AAStartPopulationAttempt\r\n  | AAPopulationAttemptSuccess\r\n  | AANextEpoch\r\n  | AAGetGameResult\r\n  | AAGameResultDone\r\n  | AATransitionStart\r\n  | AATransitionEnd;\r\n\r\nexport interface AAUpdateSpecies {\r\n  type: \"AAUpdateSpecies\";\r\n  species?: Species;\r\n}\r\n\r\nfunction handleUpdateSpecies(state: AppState, action: AAUpdateSpecies): AppState {\r\n  if (action.species) {\r\n    return {\r\n      ...state,\r\n      rootSpecies: action.species,\r\n    };\r\n    // return produce(state, (draft) => {\r\n    //   const newSpecies = action.species!;\r\n    //   findAndSetSpeciesRecursive(draft.rootSpecies, newSpecies);\r\n    // });\r\n  } else {\r\n    return { ...state };\r\n  }\r\n}\r\n\r\nexport interface AAStartPopulationAttempt {\r\n  type: \"AAStartPopulationAttempt\";\r\n  populationAttempt: PopulationAttempt;\r\n}\r\n\r\nfunction handleStartPopulationAttempt(state: AppState, action: AAStartPopulationAttempt): AppState {\r\n  const populationAttempt = action.populationAttempt;\r\n  const { targetHex, sourceHex } = populationAttempt;\r\n\r\n  if (!targetHex.info.visible) {\r\n    return state;\r\n  }\r\n  if (sourceHex != null) {\r\n    if (sourceHex.info.flora == null) {\r\n      console.error(\"sourceHex isn't null but the flora is null\");\r\n      return state;\r\n    }\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    activePopulationAttempt: action.populationAttempt,\r\n  };\r\n}\r\n\r\nexport interface AAFinishLevel {\r\n  type: \"AAFinishLevel\";\r\n  level: HexTile;\r\n  species: Species;\r\n  result: GameResult;\r\n}\r\n\r\nexport interface AAPopulationAttemptSuccess {\r\n  type: \"AAPopulationAttemptSuccess\";\r\n  attempt?: PopulationAttempt;\r\n  results: GameResult;\r\n}\r\n\r\nfunction handlePopulationAttemptSuccess(state: AppState, action: AAPopulationAttemptSuccess): AppState {\r\n  return produce(state, (draft: AppState) => {\r\n    const { attempt = draft.activePopulationAttempt!, results } = action;\r\n    const { settlingSpecies } = attempt;\r\n\r\n    // cannot access target hex directly since it points to the old state, must use the draft\r\n    const targetHex = draft.overWorld.hexAt(attempt.targetHex.i, attempt.targetHex.j)!;\r\n\r\n    const isFirstPlaythrough = attempt.sourceHex == null;\r\n    if (isFirstPlaythrough) {\r\n      gtag(\"event\", \"Beat first playthrough\", { label: \"mp earned\", value: results.mutationPointsPerEpoch });\r\n    }\r\n\r\n    // populate target hex\r\n    let oldSpecies: Species | undefined = undefined;\r\n    if (targetHex.info.flora != null) {\r\n      oldSpecies = targetHex.info.flora.species;\r\n    }\r\n    targetHex.info.flora = {\r\n      species: settlingSpecies,\r\n      mutationPointsPerEpoch: results.mutationPointsPerEpoch,\r\n      oxygenContribution: results.oxygenContribution,\r\n    };\r\n\r\n    if (oldSpecies) {\r\n      // update old species mutation point pool cache\r\n      oldSpecies.freeMutationPoints = Math.min(\r\n        oldSpecies.freeMutationPoints,\r\n        draft.overWorld.getMaxGenePool(oldSpecies)\r\n      );\r\n    }\r\n\r\n    // bump visibility\r\n    for (const n of draft.overWorld.hexNeighbors(targetHex)) {\r\n      n && (n.info.visible = true);\r\n    }\r\n  });\r\n}\r\n\r\nexport interface AANextEpoch {\r\n  type: \"AANextEpoch\";\r\n}\r\n\r\nfunction handleNextEpoch(state: AppState, action: AANextEpoch): AppState {\r\n  return produce(state, (draft) => {\r\n    // +1 epoch:\r\n    // reset all species pools to max\r\n    for (const species of lineage(draft.rootSpecies)) {\r\n      species.freeMutationPoints = draft.overWorld.getMaxGenePool(species);\r\n      if (species.freeMutationPoints > 0) {\r\n        // on the very first time you move an epoch, you get one chance to get transport/pipes/diffuse water\r\n        const isFirstChoice = draft.epoch === 0;\r\n        species.geneOptions = generateGeneOptions(species, isFirstChoice);\r\n      }\r\n    }\r\n    draft.epoch += 1;\r\n  });\r\n}\r\n\r\nexport interface AAGetGameResult {\r\n  type: \"AAGetGameResult\";\r\n  result: GameResult;\r\n}\r\n\r\nfunction handleGetGameResult(state: AppState, action: AAGetGameResult): AppState {\r\n  // if (state.activePopulationAttempt == null) {\r\n  //   throw new Error(\"activePopulationAttempt shouldn't be null during handleWinLoss\");\r\n  // }\r\n  if (action.result.status === \"won\") {\r\n    state = handlePopulationAttemptSuccess(state, {\r\n      type: \"AAPopulationAttemptSuccess\",\r\n      attempt: state.activePopulationAttempt,\r\n      results: action.result,\r\n    });\r\n  }\r\n  return {\r\n    ...state,\r\n    activeGameResult: action.result,\r\n  };\r\n}\r\n\r\nexport interface AAGameResultDone {\r\n  type: \"AAGameResultDone\";\r\n}\r\n\r\nfunction handleGameResultDone(state: AppState, action: AAGameResultDone): AppState {\r\n  const { activeGameResult } = state;\r\n  const activePopulationAttempt = state.activePopulationAttempt!;\r\n  // lost the tutorial level\r\n  if (activeGameResult?.status === \"lost\" && activePopulationAttempt.sourceHex == null) {\r\n    return {\r\n      ...state,\r\n      activeGameResult: undefined,\r\n      // shallow clone; re-creates the level\r\n      activePopulationAttempt: {\r\n        ...activePopulationAttempt,\r\n      },\r\n    };\r\n  }\r\n  return {\r\n    ...state,\r\n    activePopulationAttempt: undefined,\r\n    activeGameResult: undefined,\r\n  };\r\n}\r\n\r\nexport interface AATransitionStart {\r\n  type: \"AATransitionStart\";\r\n  transition: AppActions;\r\n}\r\n\r\nfunction handleTransitionStart(state: AppState, action: AATransitionStart): AppState {\r\n  return {\r\n    ...state,\r\n    transition: action.transition,\r\n  };\r\n}\r\n\r\nexport interface AATransitionEnd {\r\n  type: \"AATransitionEnd\";\r\n}\r\n","function capitalize(s: String) {\r\n  return s.substr(0, 1).toLocaleUpperCase() + s.substr(1);\r\n}\r\n\r\nexport default capitalize;\r\n","import { randElement, randInt } from \"math\";\r\nimport capitalize from \"./capitalize\";\r\n\r\n// taken from https://github.com/chancejs/chancejs/blob/63db6b8aab83513afa5a8269c8dcde6b300a9cf7/chance.js\r\n\r\nconst NUMBERS = \"0123456789\";\r\nconst CHARS_LOWER = \"abcdefghijklmnopqrstuvwxyz\";\r\nconst CHARS_UPPER = CHARS_LOWER.toUpperCase();\r\n\r\nfunction character(options: any) {\r\n  var symbols = \"!@#$%^&*()[]\",\r\n    letters,\r\n    pool;\r\n\r\n  if (options.casing === \"lower\") {\r\n    letters = CHARS_LOWER;\r\n  } else if (options.casing === \"upper\") {\r\n    letters = CHARS_UPPER;\r\n  } else {\r\n    letters = CHARS_LOWER + CHARS_UPPER;\r\n  }\r\n\r\n  if (options.pool) {\r\n    pool = options.pool;\r\n  } else {\r\n    pool = \"\";\r\n    if (options.alpha) {\r\n      pool += letters;\r\n    }\r\n    if (options.numeric) {\r\n      pool += NUMBERS;\r\n    }\r\n    if (options.symbols) {\r\n      pool += symbols;\r\n    }\r\n    if (!pool) {\r\n      pool = letters + NUMBERS + symbols;\r\n    }\r\n  }\r\n\r\n  return pool.charAt(randInt(0, pool.length - 1));\r\n}\r\n\r\nfunction syllable() {\r\n  let length = randInt(2, 3),\r\n    consonants = \"bcdfghjklmnprstvwz\", // consonants except hard to speak ones\r\n    vowels = \"aeiou\", // vowels\r\n    all = consonants + vowels, // all\r\n    text = \"\",\r\n    chr;\r\n\r\n  // I'm sure there's a more elegant way to do this, but this works\r\n  // decently well.\r\n  for (var i = 0; i < length; i++) {\r\n    if (i === 0) {\r\n      // First character can be anything\r\n      chr = character({ pool: all });\r\n    } else if (consonants.indexOf(chr) === -1) {\r\n      // Last character was a vowel, now we want a consonant\r\n      chr = character({ pool: consonants });\r\n    } else {\r\n      // Last character was a consonant, now we want a vowel\r\n      chr = character({ pool: vowels });\r\n    }\r\n\r\n    text += chr;\r\n  }\r\n\r\n  return text;\r\n}\r\n\r\nfunction word(options?: { syllables?: number; length?: number }) {\r\n  let syllables = options?.syllables || 2,\r\n    text = \"\";\r\n\r\n  if (options?.length) {\r\n    // Either bound word by length\r\n    do {\r\n      text += syllable();\r\n    } while (text.length < options.length);\r\n    text = text.substring(0, options.length);\r\n  } else {\r\n    // Or by number of syllables\r\n    for (var i = 0; i < syllables; i++) {\r\n      text += syllable();\r\n    }\r\n  }\r\n\r\n  return text;\r\n}\r\n\r\nconst LANDSCAPES = [\r\n  \"@ Steppes\",\r\n  \"@ Plains\",\r\n  \"@ Area\",\r\n  \"@ Basin\",\r\n  \"@ Bend\",\r\n  \"@ Beach\",\r\n  \"@ Cape\",\r\n  \"@ Flat\",\r\n  \"@ Ridge\",\r\n  \"@ Summit\",\r\n  \"Mount @\",\r\n  \"@'s Valley\",\r\n  \"@ Hills\",\r\n  \"@ Pinnacle\",\r\n  \"@ Heights\",\r\n];\r\nfunction addRandomLandscape(name: string) {\r\n  const template = randElement(LANDSCAPES);\r\n  return template.replace(\"@\", name);\r\n}\r\n\r\nexport function randomName() {\r\n  return addRandomLandscape(capitalize(word()));\r\n}\r\n","import { createSimpleSchema, object } from \"serializr\";\r\nimport { TileGeneratorName } from \"../std/tileGenerators\";\r\nimport { Temperature } from \"./temperature\";\r\nimport { TileGenerator } from \"./tileGenerator\";\r\n\r\nexport interface Environment {\r\n  airEvaporation: number;\r\n  climate: {\r\n    timeBetweenRainfall: number;\r\n    rainDuration: number;\r\n    waterPerSecond: number;\r\n  };\r\n  insectsPerDay: number;\r\n  secondsToEvaporate: number;\r\n  floorCo2: number;\r\n  temperaturePerSeason: Temperature[];\r\n  daylightPerSeason: number[];\r\n  fill: TileGeneratorName | TileGenerator;\r\n}\r\n\r\nexport const EnvironmentSchema = createSimpleSchema<Environment>({\r\n  climate: object(createSimpleSchema({ \"*\": true })),\r\n  \"*\": true,\r\n});\r\n","import { EnvironmentSchema } from \"core/environment\";\r\nimport { createSimpleSchema, object, primitive, reference } from \"serializr\";\r\nimport { Species, SpeciesSchema } from \"../species\";\r\n\r\nexport interface LevelInfo {\r\n  seed: number;\r\n  height: number; // [-1 to 6], integers only\r\n  temperature: \"cold\" | \"temperate\" | \"hot\";\r\n  rainfall: \"low\" | \"medium\" | \"high\";\r\n  soilType: \"barren\" | \"average\" | \"fertile\";\r\n  // wind: \"low\" | \"medium\" | \"high\";\r\n  visible: boolean;\r\n  flora?: {\r\n    species: Species;\r\n    mutationPointsPerEpoch: number;\r\n    oxygenContribution: number;\r\n  };\r\n}\r\n\r\nexport const LevelInfoSchema = createSimpleSchema<LevelInfo>({\r\n  // \"*\": true,\r\n  seed: primitive(),\r\n  height: primitive(),\r\n  temperature: primitive(),\r\n  rainfall: primitive(),\r\n  soilType: primitive(),\r\n  wind: primitive(),\r\n  visible: primitive(),\r\n  environment: object(EnvironmentSchema),\r\n\r\n  flora: object(\r\n    createSimpleSchema({\r\n      species: reference(SpeciesSchema),\r\n      mutationPointsPerEpoch: primitive(),\r\n      actionPoints: primitive(),\r\n      oxygenContribution: primitive(),\r\n    })\r\n  ),\r\n});\r\n","import { randomName } from \"common/randomName\";\r\nimport { identifier, object, serializable } from \"serializr\";\r\nimport uuid from \"uuid\";\r\nimport { LevelInfo, LevelInfoSchema } from \"./levelInfo\";\r\n\r\nconst C = Math.sqrt(3) / 2;\r\n\r\nexport class HexTile {\r\n  @serializable\r\n  private version = 1;\r\n\r\n  @serializable(identifier())\r\n  private uuid = uuid();\r\n\r\n  @serializable\r\n  private _displayName?: string;\r\n\r\n  public get displayName() {\r\n    // existing saves that don't have a displayName\r\n    // will get one\r\n    if (this._displayName == null) {\r\n      if (this.info.height < 0) {\r\n        this._displayName = \"Deep Water\";\r\n      } else {\r\n        this._displayName = randomName();\r\n      }\r\n    }\r\n    return this._displayName;\r\n  }\r\n\r\n  @serializable(object(LevelInfoSchema))\r\n  info: LevelInfo = {\r\n    seed: Math.random() * Number.MAX_SAFE_INTEGER,\r\n    height: -1,\r\n    rainfall: \"medium\",\r\n    soilType: \"average\",\r\n    temperature: \"temperate\",\r\n    // wind: \"low\",\r\n    visible: false,\r\n  };\r\n\r\n  @serializable\r\n  public i: number;\r\n\r\n  @serializable\r\n  public j: number;\r\n\r\n  // Handle 0 arg constructor from serializr\r\n  constructor(i?: number, j?: number) {\r\n    this.i = i!;\r\n    this.j = j!;\r\n  }\r\n\r\n  get cartesian() {\r\n    const { i, j } = this;\r\n    // simplified version:\r\n    // x = i - 0.5j - 0.5*-(i + j)\r\n    // x = i - 0.5j + 0.5i + 0.5j\r\n    // x = 1.5i\r\n    // y = Cj - C*-(i + j)\r\n    // y = Cj + Ci + Cj\r\n    // y = 2Cj + Ci\r\n    return {\r\n      x: 1.5 * i,\r\n      y: 2 * C * j + C * i,\r\n    };\r\n  }\r\n\r\n  get isHabitable() {\r\n    return this.info.height !== -1;\r\n  }\r\n\r\n  get k() {\r\n    return -(this.i + this.j);\r\n  }\r\n\r\n  get magnitude() {\r\n    return Math.abs(this.i) + Math.abs(this.j) + Math.abs(this.k);\r\n  }\r\n}\r\n","import { map, object, serializable } from \"serializr\";\r\nimport { HexTile } from \"./hexTile\";\r\n\r\nexport class HexStore {\r\n  @serializable(map(object(HexTile)))\r\n  tiles: { [k: string]: HexTile } = {};\r\n\r\n  private hash(i: number, j: number) {\r\n    return `${i},${j}`;\r\n  }\r\n\r\n  get(i: number, j: number): HexTile | undefined {\r\n    return this.tiles[this.hash(i, j)];\r\n  }\r\n\r\n  set(i: number, j: number, tile: HexTile) {\r\n    this.tiles[this.hash(i, j)] = tile;\r\n  }\r\n\r\n  /**\r\n   * store neighbors at angles [30, 90, 150, 210, 270, 330]\r\n   *\r\n   * 30: (1, 0, -1)\r\n   *\r\n   * 90: (0, 1, -1)\r\n   *\r\n   * 150: (-1, 1, 0)\r\n   *\r\n   * 210: (-1, 0, 1)\r\n   *\r\n   * 270: (0, -1, 1)\r\n   *\r\n   * 330: (1, -1, 0)\r\n   */\r\n  public hexNeighbors(hex: HexTile) {\r\n    const { i, j } = hex;\r\n    const neighbors: (HexTile | undefined)[] = [];\r\n    neighbors[0] = this.get(i + 1, j);\r\n    neighbors[1] = this.get(i, j + 1);\r\n    neighbors[2] = this.get(i - 1, j + 1);\r\n    neighbors[3] = this.get(i - 1, j);\r\n    neighbors[4] = this.get(i, j - 1);\r\n    neighbors[5] = this.get(i + 1, j - 1);\r\n    return neighbors;\r\n  }\r\n\r\n  *[Symbol.iterator]() {\r\n    for (const key in this.tiles) {\r\n      yield this.tiles[key];\r\n    }\r\n  }\r\n}\r\n","import { Species } from \"core/species\";\r\nimport { minBy } from \"lodash\";\r\nimport { clamp } from \"math\";\r\nimport { object, reference, serializable } from \"serializr\";\r\nimport SimplexNoise from \"simplex-noise\";\r\nimport { HexStore } from \"./hexStore\";\r\nimport { HexTile } from \"./hexTile\";\r\n\r\nexport class OverWorld {\r\n  @serializable(object(HexStore))\r\n  storage: HexStore;\r\n\r\n  @serializable(reference(HexTile))\r\n  startTile: HexTile;\r\n\r\n  constructor(storage?: HexStore, startTile?: HexTile) {\r\n    this.storage = storage!;\r\n    this.startTile = startTile!;\r\n\r\n    // ensure the start tile is visible\r\n    if (this.startTile) {\r\n      this.startTile.info.visible = true;\r\n    }\r\n  }\r\n\r\n  private static genHeightPlanet(tile: HexTile, noise: SimplexNoise) {\r\n    const { x, y } = tile.cartesian;\r\n    let height = 0;\r\n    height += (noise.noise3D(x / 24, y / 24, 0) - 0.2) * 6;\r\n    height += noise.noise3D(x / 24, y / 24, 1.453) * 6;\r\n    height += noise.noise3D(x / 6, y / 6, 1.453) * 1.5;\r\n    height += 1;\r\n    // info.height += 4 - Math.abs(tile.magnitude * tile.magnitude) * 0.02;\r\n    height -= Math.abs(y * y) * 0.025;\r\n    if (height < 0 && height >= -1) {\r\n      height = 0;\r\n    }\r\n    height = Math.round(Math.max(Math.min(height, 6), -1));\r\n    return height;\r\n  }\r\n\r\n  private static genHeightContinent(tile: HexTile, noise: SimplexNoise) {\r\n    let height = 12 - tile.magnitude / 2.5;\r\n    const { x, y } = tile.cartesian;\r\n    // const angle = Math.atan2(y, x);\r\n    // height += map(noise.noise2D(Math.cos(angle) * 0.5, Math.sin(angle) * 0.5), -1, 1, 5, -5);\r\n    // let height = 0;\r\n    height += noise.noise3D(x / 24, y / 24, 0) * 6;\r\n    height += noise.noise3D(x / 12, y / 12, 1.453) * 3;\r\n    height += noise.noise3D(x / 6, y / 6, 2.453) * 1.5;\r\n    // height += 1;\r\n    // // info.height += 4 - Math.abs(tile.magnitude * tile.magnitude) * 0.02;\r\n    // height -= Math.abs(y * y) * 0.025;\r\n    if (height < 0 && height >= -1) {\r\n      height = 0;\r\n    }\r\n    // height = Math.round(Math.max(Math.min(height, 6), -1));\r\n    // return height;\r\n    height = Math.round(clamp(height, -1, 12));\r\n    return height;\r\n  }\r\n\r\n  private static populateLevelInfo(\r\n    tile: HexTile,\r\n    noise: SimplexNoise,\r\n    heightFn: (tile: HexTile, noise: SimplexNoise) => number\r\n  ) {\r\n    const { info } = tile;\r\n    // info.height = OverWorld.genHeightContinents(tile, noise);\r\n    info.height = heightFn(tile, noise);\r\n  }\r\n\r\n  static generateLargeContinent(maxDist: number = 20): OverWorld {\r\n    const storage = new HexStore();\r\n    const noise = new SimplexNoise();\r\n    // the rule is: i + j + k = 0\r\n    // abs(i) <= maxDist\r\n    // abs(j) <= maxDist\r\n    // abs(k) <= maxDist\r\n    for (let i = -maxDist; i <= maxDist; i++) {\r\n      for (let j = -maxDist; j <= maxDist; j++) {\r\n        let k = -(i + j);\r\n        if (Math.abs(k) > maxDist) {\r\n          continue;\r\n        }\r\n        const tile = new HexTile(i, j);\r\n        OverWorld.populateLevelInfo(tile, noise, OverWorld.genHeightContinent);\r\n        storage.set(i, j, tile);\r\n      }\r\n    }\r\n    const startTile = OverWorld.getDefaultStartTile(storage);\r\n    return new OverWorld(storage, startTile);\r\n  }\r\n\r\n  static generatePlanet(width: number = 50, height: number = 25): OverWorld {\r\n    const storage = new HexStore();\r\n    const noise = new SimplexNoise();\r\n    // the rule is: i + j + k = 0\r\n    // abs(i) <= maxDist\r\n    // abs(j) <= maxDist\r\n    // abs(k) <= maxDist\r\n    const maxDist = Math.max(width / 2, height / 2);\r\n\r\n    for (let i = -maxDist; i <= maxDist; i++) {\r\n      for (let j = -maxDist; j <= maxDist; j++) {\r\n        let k = -(i + j);\r\n        if (Math.abs(k) > maxDist) {\r\n          continue;\r\n        }\r\n        const tile = new HexTile(i, j);\r\n        const { x, y } = tile.cartesian;\r\n        if (x < -width / 2 || x > width / 2 || y < -height / 2 || y > height / 2) {\r\n          continue;\r\n        }\r\n\r\n        OverWorld.populateLevelInfo(tile, noise, OverWorld.genHeightPlanet);\r\n        storage.set(i, j, tile);\r\n      }\r\n    }\r\n\r\n    const startTile = OverWorld.getDefaultStartTile(storage);\r\n    return new OverWorld(storage, startTile);\r\n  }\r\n\r\n  static getDefaultStartTile(storage?: HexStore) {\r\n    if (storage == null) {\r\n      return undefined;\r\n    }\r\n    // const tiles = Array.from(storage);\r\n    const tiles = Array.from(OverWorld.getContinentConnectedHexes(storage)).filter((t) => t.info.height === 0);\r\n    // start at the nearest height 0 tile\r\n    return minBy(tiles, (t) => t.magnitude)!;\r\n  }\r\n\r\n  private static getContinentConnectedHexes(store: HexStore) {\r\n    const filter = (hex: HexTile) => hex.info.height >= 0;\r\n    // start at 0,0, and go outwards from neighbors until you can't anymore\r\n    const frontier = [store.get(0, 0)!];\r\n    const processed = new Set<HexTile>();\r\n    while (frontier.length > 0) {\r\n      const hex = frontier.shift()!;\r\n      processed.add(hex);\r\n      for (const n of store.hexNeighbors(hex)) {\r\n        if (n != null && !frontier.includes(n) && !processed.has(n) && filter(n)) {\r\n          frontier.push(n);\r\n        }\r\n      }\r\n    }\r\n    return processed;\r\n  }\r\n\r\n  public computeOxygenLevel() {\r\n    let oxygenLevel = 0;\r\n    for (const tile of this) {\r\n      oxygenLevel += tile.info.flora?.oxygenContribution ?? 0;\r\n    }\r\n    return oxygenLevel / 100;\r\n  }\r\n\r\n  /**\r\n   * store neighbors at angles [30, 90, 150, 210, 270, 330]\r\n   *\r\n   * 30: (1, 0, -1)\r\n   *\r\n   * 90: (0, 1, -1)\r\n   *\r\n   * 150: (-1, 1, 0)\r\n   *\r\n   * 210: (-1, 0, 1)\r\n   *\r\n   * 270: (0, -1, 1)\r\n   *\r\n   * 330: (1, -1, 0)\r\n   */\r\n  public hexNeighbors(hex: HexTile) {\r\n    return this.storage.hexNeighbors(hex);\r\n  }\r\n\r\n  /**\r\n   * For a given target hex, find the source hexes that\r\n   * can migrate into it.\r\n   */\r\n  public possibleMigrationSources(target: HexTile) {\r\n    const populatedActiveNeighbors = this.hexNeighbors(target).filter((hex) => {\r\n      return hex?.info.flora != null;\r\n    }) as HexTile[];\r\n    if (target.info.flora == null) {\r\n      // if the target is unpopulated, allow any neighbor to migrate into it\r\n      return populatedActiveNeighbors;\r\n    } else {\r\n      // if the target is already populated, disallow \"migration\" from the same source species\r\n      return populatedActiveNeighbors.filter((s) => s != null && s.info.flora!.species !== target.info.flora!.species);\r\n    }\r\n  }\r\n\r\n  public possibleMigrationTargets(source: HexTile) {\r\n    if (source.info.flora == null) {\r\n      console.error(\"can't migrate from a null flora source\");\r\n      return [];\r\n    }\r\n    const unpopulatedNeighbors = this.hexNeighbors(source).filter((hex) => {\r\n      // find neighbors that are either:\r\n      //  unpopulated, or\r\n      //  populated but with a different species\r\n      return hex != null && (hex.info.flora == null || hex.info.flora.species !== source.info.flora!.species);\r\n    }) as HexTile[];\r\n    return unpopulatedNeighbors;\r\n  }\r\n\r\n  public getStartHex() {\r\n    return this.startTile;\r\n  }\r\n\r\n  public hexAt(i: number, j: number) {\r\n    return this.storage.get(i, j);\r\n  }\r\n\r\n  *[Symbol.iterator]() {\r\n    for (const tile of this.storage) {\r\n      yield tile;\r\n    }\r\n  }\r\n\r\n  getMaxGenePool(species: Species) {\r\n    return this.getHexesPopulatedBy(species).reduce(\r\n      (pool, tile) => (pool += tile.info.flora!.mutationPointsPerEpoch),\r\n      0\r\n    );\r\n  }\r\n\r\n  getHexesPopulatedBy(species: Species) {\r\n    const hexes: HexTile[] = [];\r\n    for (const tile of this.storage) {\r\n      const { flora } = tile.info;\r\n      if (flora && flora.species.id === species.id) {\r\n        hexes.push(tile);\r\n      }\r\n    }\r\n    return hexes;\r\n  }\r\n}\r\n","import { GameResult } from \"game/gameResult\";\r\nimport { createSimpleSchema, object, reference } from \"serializr\";\r\nimport { HexTile } from \"../../core/overworld/hexTile\";\r\nimport { OverWorld } from \"../../core/overworld/overWorld\";\r\nimport { Species, SpeciesSchema } from \"../../core/species\";\r\nimport { AppActions } from \"./reducer\";\r\n\r\n/**\r\n * For now, we mutate classes and manually call dummy placeholder\r\n * actions to get a state update.\r\n */\r\nexport interface AppState {\r\n  overWorld: OverWorld;\r\n  /**\r\n   * Determines whether we're in the game or in the overworld.\r\n   *\r\n   * Null activeLevel means we're in overworld.\r\n   * Non-null means we're in-game, or in the game results screen.\r\n   */\r\n  activePopulationAttempt?: PopulationAttempt;\r\n  /**\r\n   * Determines whether to show the game over screen. While non-null,\r\n   * we show a game result screen.\r\n   */\r\n  activeGameResult?: GameResult;\r\n  rootSpecies: Species;\r\n  // species: Record<string, Species>;\r\n  epoch: number;\r\n  transition?: AppActions;\r\n}\r\n\r\nexport interface PopulationAttempt {\r\n  sourceHex?: HexTile;\r\n  targetHex: HexTile;\r\n  settlingSpecies: Species;\r\n}\r\n\r\nexport const PopulationAttemptSchema = createSimpleSchema<PopulationAttempt>({\r\n  sourceHex: reference(HexTile),\r\n  targetHex: reference(HexTile),\r\n  settlingSpecies: reference(SpeciesSchema),\r\n});\r\n\r\nexport const AppStateSchema = createSimpleSchema<AppState>({\r\n  overWorld: object(OverWorld),\r\n  // no active population attempt\r\n  // activePopulationAttempt: object(PopulationAttemptSchema),\r\n  // no activeGameResult\r\n  rootSpecies: object(SpeciesSchema),\r\n  epoch: true,\r\n});\r\n","import localforage from \"localforage\";\r\nimport { deserialize, serialize } from \"serializr\";\r\nimport { AppActions } from \"./reducer\";\r\nimport { AppState, AppStateSchema } from \"./state\";\r\n\r\nconst GAME_DATA_KEY = \"gameData\";\r\n\r\nexport function save(appState: AppState) {\r\n  const json = serialize(AppStateSchema, appState);\r\n  console.log(\"saved json\", json);\r\n  const stringToSave = JSON.stringify(json);\r\n  return localforage.setItem(GAME_DATA_KEY, stringToSave);\r\n}\r\n\r\nexport async function load(): Promise<AppState> {\r\n  const string = await localforage.getItem<string>(GAME_DATA_KEY);\r\n  const json = JSON.parse(string);\r\n  const appState = deserialize(AppStateSchema, json);\r\n  return appState;\r\n}\r\n\r\nexport function resetGame() {\r\n  const confirm = window.confirm(\"Are you sure you want to reset your whole game?\");\r\n  if (confirm) {\r\n    return localforage.removeItem(GAME_DATA_KEY).then(() => {\r\n      window.location.reload();\r\n    });\r\n  } else {\r\n    return Promise.reject();\r\n  }\r\n}\r\n\r\nconst ACTIONS_TO_SAVE_ON: Partial<Record<AppActions[\"type\"], true>> = {\r\n  AAGameResultDone: true,\r\n  AAGetGameResult: true,\r\n  AAUpdateSpecies: true,\r\n  AANextEpoch: true,\r\n  AAPopulationAttemptSuccess: true,\r\n  AAStartPopulationAttempt: true,\r\n};\r\n\r\nexport function saveOnActionMiddleware(reducer: React.Reducer<AppState, AppActions>) {\r\n  return (state: AppState, action: AppActions) => {\r\n    const newState = reducer(state, action);\r\n    if (ACTIONS_TO_SAVE_ON.hasOwnProperty(action.type)) {\r\n      console.log(\"saved from\", action);\r\n      save(newState);\r\n    }\r\n    return newState;\r\n  };\r\n}\r\n","import React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport \"./Button.scss\";\r\n\r\nexport function Button(props: JSX.IntrinsicElements[\"button\"] & { color?: \"purple\" | \"green\" }) {\r\n  return (\r\n    <button {...props} className={classNames(\"button\", props.className, props.color || \"purple\")}>\r\n      {props.children}\r\n    </button>\r\n  );\r\n}\r\n","import React, { useCallback } from \"react\";\r\nimport { Species } from \"../../../core/species\";\r\nimport Character from \"../common/Character\";\r\nimport MP from \"../common/MP\";\r\nimport \"./SpeciesNode.scss\";\r\n\r\nexport interface SpeciesNodeProps {\r\n  species: Species;\r\n  onMutate: (m: Species) => void;\r\n}\r\n\r\nfunction SpeciesNode({ species, onMutate }: SpeciesNodeProps) {\r\n  const descendants =\r\n    species.descendants.length > 0 ? (\r\n      <div className=\"descendants-container\">\r\n        {species.descendants.map((s, i) => (\r\n          <SpeciesNode key={i} species={s} onMutate={onMutate} />\r\n        ))}\r\n      </div>\r\n    ) : null;\r\n  const handleClick = useCallback(() => {\r\n    onMutate(species);\r\n  }, [onMutate, species]);\r\n  return (\r\n    <div className=\"species-node\">\r\n      {descendants}\r\n      {/* <LookAtMouse zScale={5} onClick={handleClick}> */}\r\n      <div className=\"species-info\" onClick={handleClick}>\r\n        <div className=\"species-info-name\">{species.name}</div>\r\n        <div className=\"species-info-animation\">\r\n          <Character size=\"small\" />\r\n        </div>\r\n        <MP amount={species.freeMutationPoints} />\r\n      </div>\r\n      {/* </LookAtMouse> */}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SpeciesNode;\r\n","import { useAppReducer } from \"game/app\";\r\nimport React from \"react\";\r\nimport { Species } from \"../../../core/species\";\r\nimport \"./PhylogeneticTree.scss\";\r\nimport SpeciesNode from \"./SpeciesNode\";\r\n\r\ninterface PhylogeneticTreeProps {\r\n  onMutate: (s: Species) => void;\r\n}\r\n\r\nfunction PhylogeneticTree({ onMutate }: PhylogeneticTreeProps) {\r\n  const [{ rootSpecies }] = useAppReducer();\r\n  return (\r\n    <div className=\"phylogenetic-tree\">\r\n      <div className=\"title\">Phylogenetic Tree</div>\r\n      <div className=\"tree-nodes\">\r\n        <SpeciesNode species={rootSpecies} onMutate={onMutate} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default PhylogeneticTree;\r\n","import { Tooltip } from \"@blueprintjs/core\";\r\nimport classNames from \"classnames\";\r\nimport { lineage } from \"core/species\";\r\nimport { useAppReducer } from \"game/app\";\r\nimport DynamicNumber from \"game/ui/common/DynamicNumber\";\r\nimport React, { useState } from \"react\";\r\nimport { GiSandsOfTime } from \"react-icons/gi\";\r\nimport { HexTile } from \"../../../core/overworld/hexTile\";\r\nimport MP from \"../common/MP\";\r\nimport \"./EpochUI.scss\";\r\n\r\nexport function EpochUI({ onNextEpoch, onFocusHex }: EpochUIProps) {\r\n  const [{ epoch, overWorld, rootSpecies }] = useAppReducer();\r\n  const [transitioning, setTransitioning] = useState(false);\r\n  const handleNextEpoch = React.useCallback(() => {\r\n    setTransitioning(true);\r\n    setTimeout(() => setTransitioning(false), 5000);\r\n    onNextEpoch();\r\n  }, [onNextEpoch]);\r\n\r\n  const speciesProductionEls: JSX.Element[] = [];\r\n  const allSpecies = lineage(rootSpecies);\r\n  for (const species of allSpecies) {\r\n    // const hexes = overWorld.getHexesPopulatedBy(species);\r\n    const pointsPerEpoch = overWorld.getMaxGenePool(species);\r\n    speciesProductionEls.push(\r\n      <div key={species.id}>\r\n        <span className=\"species-name\">{species.name}</span>{\" \"}\r\n        <MP amount={species.freeMutationPoints} total={pointsPerEpoch} />\r\n        {/* over{\" \"} {hexes.length} hexes. */}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const epochButtonTooltipContent = <>Refill mutation points.</>;\r\n  return (\r\n    <div className={classNames(\"epoch-display\", { \"ready-to-advance\": false, transitioning })}>\r\n      <h1 className=\"number\">\r\n        Epoch <DynamicNumber sigFigs={6} value={epoch} speed={0.08} />\r\n      </h1>\r\n      <div className=\"production-overview\">{speciesProductionEls}</div>\r\n\r\n      <Tooltip position=\"left\" content={epochButtonTooltipContent}>\r\n        <button className=\"button-next-epoch\" onClick={handleNextEpoch} disabled={transitioning}>\r\n          <GiSandsOfTime className=\"icon\" />\r\n        </button>\r\n      </Tooltip>\r\n    </div>\r\n  );\r\n}\r\nexport interface EpochUIProps {\r\n  onNextEpoch: () => void;\r\n  onFocusHex: (hex: HexTile) => void;\r\n}\r\n","import { params } from \"game/params\";\r\n\r\n// when you press one, the other one gets removed from the keyMap\r\nconst OPPOSITE_KEYS: Record<string, string> = {\r\n  KeyS: \"KeyW\",\r\n  KeyW: \"KeyS\",\r\n  KeyA: \"KeyD\",\r\n  KeyD: \"KeyA\",\r\n};\r\n\r\n/**\r\n * Singleton that listens to key events on window.\r\n */\r\nexport const Keyboard = new (class Keyboard {\r\n  readonly keyMap = new Set<string>();\r\n\r\n  constructor() {\r\n    window.addEventListener(\"blur\", this.handleBlur);\r\n    window.addEventListener(\"keydown\", this.handleKeyDown);\r\n    window.addEventListener(\"keyup\", this.handleKeyUp);\r\n  }\r\n\r\n  private handleBlur = () => {\r\n    this.keyMap.clear();\r\n  };\r\n\r\n  private handleKeyDown = (event: KeyboardEvent) => {\r\n    const { code } = event;\r\n\r\n    const isTargetAnInput = event.target instanceof HTMLInputElement;\r\n    const isOpeningDevtoolsOnChrome =\r\n      (code === \"KeyI\" && event.shiftKey && event.ctrlKey) || (code === \"KeyI\" && event.altKey && event.metaKey);\r\n    if (isTargetAnInput || isOpeningDevtoolsOnChrome) {\r\n      return true;\r\n    }\r\n    this.keyMap.add(code);\r\n    if (code in OPPOSITE_KEYS) {\r\n      this.keyMap.delete(OPPOSITE_KEYS[code]);\r\n    }\r\n    if (code === \"KeyH\") {\r\n      params.hud = !params.hud;\r\n    }\r\n    if (code === \"KeyL\") {\r\n      params.debugLevel = !params.debugLevel;\r\n    }\r\n    if (code === \"KeyN\") {\r\n      params.forceNight = !params.forceNight;\r\n    }\r\n    if (code === \"Period\") {\r\n      params.showFPS = !params.showFPS;\r\n    }\r\n    if (code === \"Slash\") {\r\n      params.showGodUI = !params.showGodUI;\r\n    }\r\n\r\n    event.preventDefault();\r\n    return false;\r\n  };\r\n\r\n  private handleKeyUp = (event: KeyboardEvent) => {\r\n    this.keyMap.delete(event.code);\r\n  };\r\n})();\r\n\r\nexport default Keyboard;\r\n","import { poissonDisc } from \"math/poissonDisc\";\r\nimport { Vector2 } from \"three\";\r\nimport { HexTile } from \"../../../core/overworld/hexTile\";\r\nimport { CameraState } from \"./map/OverWorldMap\";\r\n\r\n/**\r\n * Tiled hexes are not square - they are rectangular, where\r\n * the pointy-to-pointy direction is length 1 and the edge-to-edge\r\n * direction is length sqrt(3) / 2. Since we have flat-topped\r\n * hexes, the Y gets the squish factor.\r\n */\r\nexport const Y_SQUISH_FACTOR = Math.sqrt(3) / 2;\r\n\r\nexport function getClickedHexCoords(canvas: HTMLCanvasElement, camera: CameraState, event: React.MouseEvent) {\r\n  const { scale, dX, dY } = camera;\r\n  const cX = canvas.width / 2 + dX;\r\n  const cY = canvas.height / 2 + dY;\r\n\r\n  const e = event.nativeEvent;\r\n  const pxX = e.offsetX;\r\n  const pxY = e.offsetY;\r\n  const x = (pxX - cX) / scale;\r\n  const y = (pxY - cY) / scale;\r\n  // we now have a fractional cartesian coordinates\r\n  // now we flip the equations:\r\n\r\n  // x = 1.5i\r\n  // i = x / 1.5\r\n\r\n  // y = 2Cj + Ci\r\n  // j = (y - Ci) / (2 * C)\r\n\r\n  const i = x / 1.5;\r\n  const j = (y - Y_SQUISH_FACTOR * i) / (2 * Y_SQUISH_FACTOR);\r\n  const k = -(i + j);\r\n\r\n  return roundCubeCoordinates(i, j, k);\r\n}\r\n\r\nexport function roundCubeCoordinates(i: number, j: number, k: number) {\r\n  var rx = Math.round(i);\r\n  var ry = Math.round(j);\r\n  var rz = Math.round(k);\r\n\r\n  var x_diff = Math.abs(rx - i);\r\n  var y_diff = Math.abs(ry - j);\r\n  var z_diff = Math.abs(rz - k);\r\n\r\n  if (x_diff > y_diff && x_diff > z_diff) {\r\n    rx = -ry - rz;\r\n  } else if (y_diff > z_diff) {\r\n    ry = -rx - rz;\r\n  } else {\r\n    rz = -rx - ry;\r\n  }\r\n  return { i: rx, j: ry, k: rz };\r\n}\r\n\r\nexport function pixelPosition(tile: HexTile, camera: CameraState) {\r\n  const { dX, dY, scale } = camera;\r\n  const { x, y } = tile.cartesian;\r\n\r\n  const cX = window.innerWidth / 2 + dX;\r\n  const cY = window.innerHeight / 2 + dY;\r\n  return [cX + x * scale, cY + y * scale];\r\n}\r\n\r\n/**\r\n * Get the camera state that would center the camera on hex with the given scale.\r\n */\r\nexport function getCameraPositionCenteredOn(hex: HexTile, scale: number) {\r\n  const { x, y } = hex.cartesian;\r\n  const cX = window.innerWidth / 2 - x * scale;\r\n  const cY = window.innerHeight / 2 - y * scale;\r\n\r\n  const dX = cX - window.innerWidth / 2;\r\n  const dY = cY - window.innerHeight / 2;\r\n\r\n  return [dX, dY];\r\n}\r\n\r\nexport const randomPointInHexagon = (() => {\r\n  const vectors = [new Vector2(-1, 0), new Vector2(0.5, Y_SQUISH_FACTOR), new Vector2(0.5, -Y_SQUISH_FACTOR)];\r\n\r\n  return (scale: number) => {\r\n    // adapted from https://stackoverflow.com/a/3241819\r\n    const vIndex = Math.floor(Math.random() * 3);\r\n    const [v1, v2] = [vectors[vIndex], vectors[(vIndex + 1) % 3]];\r\n    const [v1Scale, v2Scale] = [Math.random(), Math.random()];\r\n    const [x, y] = [v1Scale * v1.x + v2Scale * v2.x, v1Scale * v1.y + v2Scale * v2.y];\r\n    return new Vector2(x * scale, y * scale);\r\n  };\r\n})();\r\n\r\nexport const generateNaturalRandomHexagonPoints = (radius: number, dropFirst = false) => {\r\n  const width = 2;\r\n  const height = Y_SQUISH_FACTOR * width;\r\n  // const areaAvailable = width * height;\r\n  // const radius = areaAvailable / maxPoints * 0.5; // technically you could get pretty close with .8; but do 0.5 for some more leeway\r\n  const samples = poissonDisc({ width, height, radius, initialSample: [width / 2, height / 2], max: 10000 });\r\n  const normSamples = samples\r\n    .map((s) => {\r\n      s.x -= width / 2;\r\n      s.y -= height / 2;\r\n      return s;\r\n    })\r\n    .filter((s) => isPointInHexagon(s.x, s.y));\r\n  if (dropFirst) {\r\n    normSamples.shift();\r\n  }\r\n  return normSamples;\r\n};\r\n\r\n/**\r\n * Return true if the point is inside a radius 1 hexagon (width 2, height sqrt(3))\r\n */\r\nexport const isPointInHexagon = (() => {\r\n  const RADIUS = 1;\r\n  const HALF_HEIGHT = RADIUS * Y_SQUISH_FACTOR;\r\n  // based on http://www.playchilla.com/how-to-check-if-a-point-is-inside-a-hexagon\r\n  return (x: number, y: number) => {\r\n    // transform the test point locally and to quadrant 2\r\n    const q2x = Math.abs(x);\r\n    const q2y = Math.abs(y);\r\n    // bounding test (since q2 is in quadrant 2 only 2 tests are needed)\r\n    if (q2x > RADIUS || q2y > HALF_HEIGHT) {\r\n      return false;\r\n    }\r\n    // dot product can be reduced to this due to the hexagon symmetry\r\n    // return HALF_HEIGHT * RADIUS * q2x - RADIUS * q2y >= 0;\r\n    return RADIUS * HALF_HEIGHT - HALF_HEIGHT * q2x - 0.5 * q2y >= 0;\r\n  };\r\n})();\r\n","import { Tooltip } from \"@blueprintjs/core\";\r\nimport classNames from \"classnames\";\r\nimport { Temperature } from \"core/temperature\";\r\nimport * as React from \"react\";\r\nimport \"./TemperatureGauge.scss\";\r\n\r\nconst tooltipMap = {\r\n  [Temperature.Freezing]: <>Cells may freeze! Sunlight at 50%. Cells operate 50% slower. You walk 50% slower.</>,\r\n  [Temperature.Cold]: <>Sunlight at 75%. Cells operate 33% slower. You walk 33% slower.</>,\r\n  [Temperature.Mild]: <>No effect from temperature.</>,\r\n  [Temperature.Hot]: <>Sunlight at 125%. Cells operate 25% faster. You walk 25% faster.</>,\r\n  [Temperature.Scorching]: <>Cells evaporate water! Sunlight at 150%. Cells operate 50% faster. You walk 50% faster.</>,\r\n};\r\n\r\nconst TemperatureGauge: React.FC<{ temperature: Temperature; showMild?: boolean }> = ({\r\n  temperature,\r\n  showMild = false,\r\n}) => {\r\n  const name = Temperature[temperature];\r\n  if (!showMild && temperature === Temperature.Mild) {\r\n    return null;\r\n  } else {\r\n    const tooltipContent = tooltipMap[temperature];\r\n    return (\r\n      <Tooltip content={tooltipContent}>\r\n        <div className={classNames(\"temperature-gauge\", name.toLowerCase())}>{name}</div>\r\n      </Tooltip>\r\n    );\r\n  }\r\n};\r\n\r\nexport default TemperatureGauge;\r\n","import locustsSrc from \"assets/images/grasshopper.png\";\r\nimport { nf } from \"common/formatters\";\r\nimport { Environment } from \"core/environment\";\r\nimport { LevelInfo } from \"core/overworld/levelInfo\";\r\nimport TemperatureGauge from \"game/ui/ingame/TemperatureGauge\";\r\nimport React from \"react\";\r\nimport { environmentFromLevelInfo } from \"std/environments\";\r\nimport { HexTile } from \"../../../../core/overworld/hexTile\";\r\nimport { Button } from \"../../common/Button\";\r\nimport MP from \"../../common/MP\";\r\nimport \"./HexInfo.scss\";\r\n\r\ninterface HexInfo {\r\n  tile: HexTile;\r\n  onClickPlay?: () => void;\r\n}\r\n\r\nfunction HexInfo({ tile, onClickPlay }: HexInfo) {\r\n  const { height, flora } = tile.info;\r\n\r\n  const playButtonElement =\r\n    height === -1 || onClickPlay == null ? null : (\r\n      <div className=\"play-selector\">\r\n        <Button color=\"green\" className=\"play-button\" onClick={onClickPlay}>\r\n          Play Level\r\n        </Button>\r\n      </div>\r\n    );\r\n\r\n  const floraInfo =\r\n    flora != null ? (\r\n      <div className=\"inhabited\">\r\n        <p>\r\n          Inhabited by{\" \"}\r\n          <b>\r\n            <i>{flora.species.name}</i>\r\n          </b>\r\n        </p>\r\n        <p>\r\n          <MP amount={flora.mutationPointsPerEpoch} /> per epoch.\r\n        </p>\r\n        <p>{flora.oxygenContribution} oxygen per second.</p>\r\n      </div>\r\n    ) : null;\r\n\r\n  const habitableInfo = tile.isHabitable ? (\r\n    <EnvironmentInfo info={tile.info} environment={environmentFromLevelInfo(tile.info)} />\r\n  ) : (\r\n    <p style={{ color: \"red\" }}>Uninhabitable</p>\r\n  );\r\n\r\n  return (\r\n    <div className=\"hex-info-container\">\r\n      <div className=\"header\">{tile.displayName}</div>\r\n      <div className=\"body\">\r\n        {floraInfo}\r\n        {habitableInfo}\r\n      </div>\r\n      {playButtonElement}\r\n    </div>\r\n  );\r\n}\r\n\r\nconst EnvironmentInfo: React.FC<{ environment: Environment; info: LevelInfo }> = ({ environment, info }) => {\r\n  const { timeBetweenRainfall, rainDuration, waterPerSecond } = environment.climate;\r\n  const frequency = timeBetweenRainfall >= 90 ? \"infrequently\" : timeBetweenRainfall >= 45 ? \"regularly\" : \"often\";\r\n  const rainAmount = rainDuration * waterPerSecond;\r\n  const intensity = rainAmount < 450 ? \"drizzles\" : rainAmount < 750 ? \"rains\" : \"downpours\";\r\n  const rainfallDescription = `${frequency} ${intensity}`;\r\n  return (\r\n    <div className=\"environment-info\">\r\n      <div>\r\n        <table className=\"bp3-html-table bp3-html-table-condensed\">\r\n          <thead>\r\n            <tr>\r\n              <th />\r\n              <th>Spring</th>\r\n              <th>Summer</th>\r\n              <th>Fall</th>\r\n              <th>Winter</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr>\r\n              <td>\r\n                <b>Temperature</b>\r\n              </td>\r\n              {environment.temperaturePerSeason.map((t, i) => (\r\n                <td key={i}>\r\n                  <TemperatureGauge temperature={t} showMild />\r\n                </td>\r\n              ))}\r\n            </tr>\r\n            <tr>\r\n              <td>\r\n                <b>Length&nbsp;of&nbsp;Day</b>\r\n              </td>\r\n              {environment.daylightPerSeason.map((percent, i) => (\r\n                <td key={i}>{nf(percent * 100, 2)}%</td>\r\n              ))}\r\n            </tr>\r\n            <tr>\r\n              <td>\r\n                <b>Rainfall</b>\r\n              </td>\r\n              <td colSpan={4} className=\"rainfall\">\r\n                {rainfallDescription}\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      {environment.insectsPerDay > 0 ? (\r\n        <div className=\"insects\">\r\n          <img src={locustsSrc} alt=\"\" />\r\n          <b>Has Locusts</b>\r\n        </div>\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default HexInfo;\r\n","import testVignetteUrl from \"assets/images/test-vignette.png\";\r\nimport { sleep } from \"common/promise\";\r\nimport { HexTile } from \"core/overworld/hexTile\";\r\nimport { Species } from \"core/species\";\r\nimport { easeExpIn } from \"d3-ease\";\r\nimport { scaleLinear } from \"d3-scale\";\r\nimport { PopulationAttempt } from \"game/app\";\r\nimport { generateNaturalRandomHexagonPoints, pixelPosition } from \"game/ui/overworld/hexMath\";\r\nimport { clamp, map, sawTooth } from \"math\";\r\nimport Ticker from \"std/ticker\";\r\nimport { Vector2 } from \"three\";\r\nimport { CameraState } from \"./OverWorldMap\";\r\n\r\nconst testVignette = new Image();\r\ntestVignette.src = testVignetteUrl;\r\n\r\nconst COLOR_SCALE_HEIGHT = scaleLinear<string, string>()\r\n  .domain([-1, 0, 1, 5, 12])\r\n  .range([\"rgb(0, 60, 255)\", \"lightblue\", \"yellow\", \"orange\", \"red\"]);\r\n\r\nexport interface DrawingContext {\r\n  populationAttempt?: PopulationAttempt;\r\n  highlightedHex?: HexTile;\r\n}\r\n\r\nexport default class HexTileSprite {\r\n  private vignettePositions?: Vector2[];\r\n\r\n  private isHovered = false;\r\n\r\n  constructor(public tile: HexTile, public context: DrawingContext) {}\r\n\r\n  public get zIndex() {\r\n    let z = this.tile.cartesian.y;\r\n    if (this.tile.info.flora != null) {\r\n      z += 1000;\r\n    }\r\n    return z;\r\n  }\r\n\r\n  public get isShadowed() {\r\n    if (this.context.highlightedHex != null) {\r\n      return this.context.highlightedHex !== this.tile;\r\n    } else if (this.context.populationAttempt != null) {\r\n      return (\r\n        this.context.populationAttempt.sourceHex !== this.tile && this.context.populationAttempt.targetHex !== this.tile\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This resets every draw.\r\n   */\r\n  setIsHovered() {\r\n    this.isHovered = true;\r\n  }\r\n\r\n  draw(c: CanvasRenderingContext2D, camera: CameraState) {\r\n    const { scale } = camera;\r\n    const [px, py] = pixelPosition(this.tile, camera);\r\n\r\n    c.lineWidth = (1 * scale) / 48;\r\n\r\n    if (this.isShadowed) {\r\n      c.globalAlpha = 0.2;\r\n    } else {\r\n      c.globalAlpha = 1;\r\n    }\r\n    if (this.tile.info.visible || true) {\r\n      // base color\r\n      c.fillStyle = COLOR_SCALE_HEIGHT(this.tile.info.height);\r\n      c.strokeStyle = \"rgb(112, 112, 112)\";\r\n      drawHex(c, px, py, scale);\r\n\r\n      // 0-6 number (can be covered by vignettes)\r\n      if (!this.isHovered) {\r\n        this.drawNumericHeight(c, scale, px, py);\r\n      }\r\n\r\n      // \"active\" pulse\r\n      if (this.tile.info.flora != null) {\r\n        this.drawVignettes(c, this.tile.info.flora.species, px, py, scale);\r\n      }\r\n    } else {\r\n      c.strokeStyle = \"rgb(112, 112, 112)\";\r\n      drawHex(c, px, py, scale, false);\r\n    }\r\n\r\n    // hovered outline\r\n    if (this.isHovered) {\r\n      c.strokeStyle = \"rgb(112, 112, 112)\";\r\n      c.lineWidth = (1 * scale) / 48;\r\n      drawCircle(c, px, py, (scale / 48) * 12, false);\r\n      if (this.tile.info.visible) {\r\n        this.drawNumericHeight(c, scale, px, py);\r\n      }\r\n    }\r\n\r\n    this.isHovered = false;\r\n  }\r\n\r\n  private static easePulse = easeExpIn;\r\n\r\n  public drawActivePulse(c: CanvasRenderingContext2D, scale: number, px: number, py: number) {\r\n    for (let i = 0; i < 10; i++) {\r\n      this.drawPulse(i / 10, c, scale, px, py);\r\n    }\r\n  }\r\n\r\n  private drawPulse(tOffset: number, c: CanvasRenderingContext2D, scale: number, px: number, py: number) {\r\n    const thickness = map(\r\n      HexTileSprite.easePulse(clamp(map(sawTooth(Ticker.now / 6000 + tOffset), 0, 1, -1, 2), -Infinity, 1)),\r\n      0,\r\n      1,\r\n      0,\r\n      20\r\n    );\r\n    c.lineWidth = (thickness * scale) / 48;\r\n    const a = 100 / (thickness * thickness * thickness);\r\n    c.strokeStyle = `rgba(255, 255, 255, ${a})`;\r\n    drawHex(c, px, py, scale + c.lineWidth / 2, false);\r\n  }\r\n\r\n  private drawNumericHeight(c: CanvasRenderingContext2D, scale: number, px: number, py: number) {\r\n    if (this.tile.info.height >= 0) {\r\n      c.font = `${(12 * scale) / 48}px serif`;\r\n      c.textAlign = \"center\";\r\n      c.textBaseline = \"middle\";\r\n      // c.strokeStyle = this.tile.info.height < 7 ? \"#666\" : \"#fff\";\r\n      // c.strokeStyle = \"#111\";\r\n      // c.lineWidth = ((12 * scale) / 48) * 0.25;\r\n      // c.strokeText(this.tile.info.height + \"\", px, py, scale);\r\n      // c.fillStyle = \"white\";\r\n      c.fillStyle = this.tile.info.height < 7 ? \"#666\" : \"#fff\";\r\n      c.fillText(this.tile.info.height + \"\", px, py, scale);\r\n    }\r\n  }\r\n\r\n  drawVignettes(c: CanvasRenderingContext2D, species: Species, px: number, py: number, scale: number) {\r\n    if (this.vignettePositions == null) {\r\n      const positions = generateNaturalRandomHexagonPoints(0.3, true); //.sort((a, b) => a.y - b.y);\r\n      this.vignettePositions = [];\r\n      const vignettePositions = this.vignettePositions;\r\n      (async function() {\r\n        for (const p of positions) {\r\n          vignettePositions.push(p);\r\n          await sleep(300);\r\n        }\r\n      })();\r\n    }\r\n    const sizeScale = scale / 48 / 2;\r\n    for (const p of this.vignettePositions) {\r\n      c.drawImage(\r\n        testVignette,\r\n        px + p.x * scale - (testVignette.width / 2) * sizeScale,\r\n        py + p.y * scale - testVignette.height * sizeScale,\r\n        testVignette.width * sizeScale,\r\n        testVignette.height * sizeScale\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawHex(c: CanvasRenderingContext2D, x: number, y: number, r: number, fill = true) {\r\n  c.beginPath();\r\n  c.moveTo(x + r, y);\r\n  for (let i = 1; i < 6; i++) {\r\n    const angle = (i / 6) * Math.PI * 2;\r\n    c.lineTo(x + Math.cos(angle) * r, y + Math.sin(angle) * r);\r\n  }\r\n  c.closePath();\r\n  if (fill) {\r\n    c.fill();\r\n  }\r\n  c.stroke();\r\n}\r\n\r\nfunction drawCircle(c: CanvasRenderingContext2D, x: number, y: number, r: number, fill = true) {\r\n  c.beginPath();\r\n  c.moveTo(x + r, y);\r\n  c.arc(x, y, r, 0, Math.PI * 2);\r\n  // for (let i = 1; i < 6; i++) {\r\n  //   const angle = (i / 6) * Math.PI * 2;\r\n  //   c.lineTo(x + Math.cos(angle) * r, y + Math.sin(angle) * r);\r\n  // }\r\n  // c.closePath();\r\n  if (fill) {\r\n    c.fill();\r\n  }\r\n  c.stroke();\r\n}\r\n","import React from \"react\";\r\nimport { HexTile } from \"../../../../core/overworld/hexTile\";\r\nimport { pixelPosition } from \"../hexMath\";\r\nimport { CameraState } from \"./OverWorldMap\";\r\nimport \"./OverWorldPopover.scss\";\r\n\r\ninterface OverWorldPopoverProps {\r\n  camera: CameraState;\r\n  tile: HexTile;\r\n  children: React.ReactNode;\r\n}\r\n\r\nfunction OverWorldPopover({ tile, camera, children }: OverWorldPopoverProps) {\r\n  const [px, py] = pixelPosition(tile, camera);\r\n  // this element is put in the center\r\n  const container: React.CSSProperties = {\r\n    left: px + camera.scale * 0.3,\r\n    top: py,\r\n  };\r\n  return (\r\n    <div className=\"overworld-popover\" style={container}>\r\n      <div className=\"overworld-popover-positioner\">{children}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OverWorldPopover;\r\n","import { AppActions, AppReducerContext, PopulationAttempt } from \"game/app\";\r\nimport Keyboard from \"game/input/keyboard\";\r\nimport { lerp } from \"math\";\r\nimport React from \"react\";\r\nimport Ticker from \"std/ticker\";\r\nimport { Vector2 } from \"three\";\r\nimport { HexTile } from \"../../../../core/overworld/hexTile\";\r\nimport { getCameraPositionCenteredOn, getClickedHexCoords, pixelPosition } from \"../hexMath\";\r\nimport HexInfo from \"./HexInfo\";\r\nimport HexTileSprite, { DrawingContext } from \"./hexTileSprite\";\r\nimport \"./OverWorldMap.scss\";\r\nimport OverWorldPopover from \"./OverWorldPopover\";\r\n\r\ninterface OverWorldMapProps {\r\n  // TODO turn this into a trigger, or global state\r\n  focusedHex?: HexTile;\r\n}\r\n\r\nexport interface CameraState {\r\n  /**\r\n   * Multiply cartesian hex coord values by scale to get pixel coordinates.\r\n   * Each hex is drawn with radius `scale`.\r\n   */\r\n\r\n  scale: number;\r\n  /**\r\n   * dX and dY are pure pixel offsets.\r\n   */\r\n  dX: number;\r\n  dY: number;\r\n}\r\n\r\n// function zoomCenteredOn(state: CameraState);\r\n\r\ninterface OverWorldMapState {\r\n  cameraState: CameraState;\r\n  populationAttempt?: PopulationAttempt;\r\n  // TODO one of population attempt or highlighted hex can be\r\n  // non-null at a time\r\n  highlightedHex?: HexTile;\r\n  hoveredHex?: HexTile;\r\n  frame: number;\r\n}\r\n\r\nexport class OverWorldMap extends React.PureComponent<OverWorldMapProps, OverWorldMapState> implements DrawingContext {\r\n  static contextType = AppReducerContext;\r\n\r\n  context!: React.ContextType<typeof AppReducerContext>;\r\n\r\n  private hexTileSprites: Map<HexTile, HexTileSprite> = new Map();\r\n\r\n  private canvas: HTMLCanvasElement | null = null;\r\n\r\n  private rafId?: number;\r\n\r\n  get populationAttempt() {\r\n    return this.state.populationAttempt;\r\n  }\r\n\r\n  get highlightedHex() {\r\n    return this.state.highlightedHex;\r\n  }\r\n\r\n  constructor(props: OverWorldMapProps, context: any) {\r\n    super(props, context);\r\n    const scale = 96;\r\n    const [{ overWorld }] = context;\r\n    const [dX, dY] = getCameraPositionCenteredOn(overWorld.getStartHex(), scale);\r\n    this.state = {\r\n      cameraState: { scale, dX, dY },\r\n      // cameraState: { scale: 10, dX: 0, dY: 0 },\r\n      frame: 0,\r\n    };\r\n    for (const tile of overWorld) {\r\n      const sprite = new HexTileSprite(tile, this);\r\n      this.hexTileSprites.set(tile, sprite);\r\n    }\r\n  }\r\n\r\n  private handleCanvasRef = (ref: HTMLCanvasElement | null) => {\r\n    this.canvas = ref;\r\n    if (ref != null) {\r\n      // Ticker.addAnimation(() => {\r\n      //   if (this.canvas != null) {\r\n      //     this.setState({ frame: this.state.frame + 1 });\r\n      //   }\r\n      //   return this.canvas == null;\r\n      // });\r\n      this.handleResize();\r\n    }\r\n  };\r\n\r\n  private handleCanvasClick = (e: React.MouseEvent) => {\r\n    if (this.state.populationAttempt != null || this.state.highlightedHex != null) {\r\n      this.setState({\r\n        populationAttempt: undefined,\r\n        highlightedHex: undefined,\r\n      });\r\n    } else {\r\n      const coords = getClickedHexCoords(this.canvas!, this.state.cameraState, e);\r\n      const [{ overWorld }] = this.context;\r\n      const clicked = overWorld.hexAt(coords.i, coords.j);\r\n      // simplest check - we clicked on a tile we can see\r\n      if (clicked != null) {\r\n        // if clicked has no flora, migrate into it\r\n        if (clicked.info.flora == null) {\r\n          const target = clicked;\r\n          const source = overWorld.possibleMigrationSources(clicked)[0];\r\n          if (source != null) {\r\n            const populationAttempt: PopulationAttempt = {\r\n              targetHex: target,\r\n              sourceHex: source,\r\n              settlingSpecies: source.info.flora!.species,\r\n            };\r\n            this.setState({ populationAttempt, highlightedHex: undefined });\r\n          } else {\r\n            // For when you see a tile but can't reach it with anything\r\n            // this can happen in the future if earthquakes happen and destroy\r\n            // blocks you used to own\r\n            const highlightedHex = clicked;\r\n            this.setState({ highlightedHex, populationAttempt: undefined });\r\n          }\r\n        } else {\r\n          // clicked does have flora; just show a highlight\r\n          const highlightedHex = clicked;\r\n          this.setState({ highlightedHex, populationAttempt: undefined });\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private handleCanvasMouseLeave = () => {\r\n    this.setState({\r\n      hoveredHex: undefined,\r\n    });\r\n  };\r\n\r\n  private handleCanvasMouseMove = (e: React.MouseEvent) => {\r\n    const coords = getClickedHexCoords(this.canvas!, this.state.cameraState, e);\r\n    const hex = this.context[0].overWorld.hexAt(coords.i, coords.j);\r\n    this.setState({ hoveredHex: hex });\r\n  };\r\n\r\n  private handleClickPlay = () => {\r\n    const [, dispatch] = this.context;\r\n    const appAction = this.getAppAction();\r\n    if (appAction) {\r\n      dispatch({\r\n        type: \"AATransitionStart\",\r\n        transition: appAction,\r\n      });\r\n    }\r\n  };\r\n\r\n  private getAppAction(): AppActions | undefined {\r\n    if (this.state.populationAttempt != null) {\r\n      return {\r\n        type: \"AAStartPopulationAttempt\",\r\n        populationAttempt: this.state.populationAttempt,\r\n      };\r\n    } else if (this.state.highlightedHex != null) {\r\n      // re-populate the same tile\r\n      const sourceHex = this.state.highlightedHex;\r\n      return {\r\n        type: \"AAStartPopulationAttempt\",\r\n        populationAttempt: {\r\n          sourceHex,\r\n          targetHex: sourceHex,\r\n          settlingSpecies: sourceHex.info.flora!.species,\r\n        },\r\n      };\r\n    }\r\n  }\r\n\r\n  private handleWheel = (e: React.WheelEvent) => {\r\n    const delta = -(e.deltaX + e.deltaY) / 125 / 10;\r\n    const scalar = Math.pow(2, delta);\r\n\r\n    const scale = this.state.cameraState.scale * scalar;\r\n    this.setState({\r\n      cameraState: {\r\n        ...this.state.cameraState,\r\n        scale,\r\n      },\r\n    });\r\n  };\r\n\r\n  private handleResize = () => {\r\n    if (this.canvas != null) {\r\n      this.canvas.width = window.innerWidth;\r\n      this.canvas.height = window.innerHeight;\r\n      this.updateCanvas();\r\n    }\r\n  };\r\n\r\n  private updateCamera = () => {\r\n    const [state] = this.context;\r\n    const { transition } = state;\r\n    if (transition != null) {\r\n      if (transition.type === \"AAStartPopulationAttempt\") {\r\n        // zoom in\r\n        const { targetHex } = transition.populationAttempt;\r\n        const { scale, dX, dY } = this.state.cameraState;\r\n        const nextScale = scale * 1.02;\r\n        const [targetDX, targetDY] = getCameraPositionCenteredOn(targetHex, scale);\r\n        this.setState({\r\n          cameraState: {\r\n            dX: lerp(dX, targetDX, 0.2),\r\n            dY: lerp(dY, targetDY, 0.2),\r\n            scale: nextScale,\r\n          },\r\n        });\r\n      }\r\n    }\r\n    const panSpeed = 20;\r\n    let offset = new Vector2();\r\n    for (const key of Keyboard.keyMap) {\r\n      if (key === \"KeyW\" || key === \"ArrowUp\") {\r\n        offset.y += panSpeed;\r\n      } else if (key === \"KeyS\" || key === \"ArrowDown\") {\r\n        offset.y -= panSpeed;\r\n      } else if (key === \"KeyA\" || key === \"ArrowLeft\") {\r\n        offset.x += panSpeed;\r\n      } else if (key === \"KeyD\" || key === \"ArrowRight\") {\r\n        offset.x -= panSpeed;\r\n      }\r\n    }\r\n    offset.setLength(panSpeed);\r\n\r\n    if (offset.x !== 0 || offset.y !== 0) {\r\n      const cameraState = this.state.cameraState;\r\n\r\n      this.setState({\r\n        cameraState: {\r\n          ...cameraState,\r\n          dX: cameraState.dX + offset.x,\r\n          dY: cameraState.dY + offset.y,\r\n        },\r\n      });\r\n    }\r\n  };\r\n\r\n  private updateCanvas() {\r\n    if (this.canvas != null) {\r\n      const c = this.canvas.getContext(\"2d\")!;\r\n      this.drawMap(c);\r\n      this.drawMigrationArrows(c);\r\n      this.drawPopulationAttempt(c);\r\n    }\r\n  }\r\n\r\n  private drawMap(c: CanvasRenderingContext2D) {\r\n    const { hoveredHex, cameraState } = this.state;\r\n    c.clearRect(0, 0, c.canvas.width, c.canvas.height);\r\n\r\n    if (hoveredHex != null) {\r\n      this.hexTileSprites.get(hoveredHex)!.setIsHovered();\r\n    }\r\n\r\n    const sprites = Array.from(this.hexTileSprites.values());\r\n    sprites.sort((b, a) => {\r\n      return b.zIndex - a.zIndex;\r\n    });\r\n\r\n    for (const sprite of sprites) {\r\n      sprite.draw(c, cameraState);\r\n    }\r\n  }\r\n\r\n  private drawMigrationArrows(c: CanvasRenderingContext2D) {\r\n    const { hoveredHex, populationAttempt } = this.state;\r\n    if (hoveredHex != null && populationAttempt == null) {\r\n      if (hoveredHex.info.flora == null) {\r\n        this.drawPossibleMigrationIntoArrows(c, hoveredHex);\r\n      } else {\r\n        this.drawPossibleMigrationOutOfArrows(c, hoveredHex);\r\n      }\r\n    }\r\n  }\r\n\r\n  private drawPopulationAttempt(c: CanvasRenderingContext2D) {\r\n    const { populationAttempt } = this.state;\r\n    if (populationAttempt != null) {\r\n      this.drawMigrationArrow(c, populationAttempt.sourceHex!, populationAttempt.targetHex);\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener(\"resize\", this.handleResize);\r\n    this.rafId = Ticker.addAnimation(this.updateCamera);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener(\"resize\", this.handleResize);\r\n    Ticker.removeAnimation(this.rafId!);\r\n  }\r\n\r\n  componentDidUpdate(prevProps: OverWorldMapProps) {\r\n    if (prevProps.focusedHex !== this.props.focusedHex && this.props.focusedHex != null) {\r\n      this.focusHex(this.props.focusedHex);\r\n    }\r\n    this.updateCanvas();\r\n  }\r\n\r\n  focusHex(hex: HexTile) {\r\n    let tStart = 0;\r\n    Ticker.addAnimation((t) => {\r\n      if (tStart === 0) {\r\n        tStart = t;\r\n      }\r\n      const dt = t - tStart;\r\n      const [targetX, targetY] = getCameraPositionCenteredOn(hex, this.state.cameraState.scale);\r\n      const dX = this.state.cameraState.dX * 0.5 + targetX * 0.5;\r\n      const dY = this.state.cameraState.dY * 0.5 + targetY * 0.5;\r\n      this.setState({\r\n        cameraState: {\r\n          ...this.state.cameraState,\r\n          dX,\r\n          dY,\r\n        },\r\n      });\r\n      return dt > 1000 || (Math.abs(targetX - dX) < 1e-2 && Math.abs(targetY - dY) < 1e-2);\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"overworld-map-container\">\r\n        <canvas\r\n          tabIndex={-1}\r\n          ref={this.handleCanvasRef}\r\n          onClick={this.handleCanvasClick}\r\n          onMouseLeave={this.handleCanvasMouseLeave}\r\n          onMouseMove={this.handleCanvasMouseMove}\r\n          onWheel={this.handleWheel}\r\n        />\r\n        {this.maybeRenderPopover()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  drawPossibleMigrationIntoArrows(c: CanvasRenderingContext2D, target: HexTile) {\r\n    const [{ overWorld }] = this.context;\r\n    for (const source of overWorld.possibleMigrationSources(target)) {\r\n      this.drawMigrationArrow(c, source, target);\r\n    }\r\n  }\r\n\r\n  drawPossibleMigrationOutOfArrows(c: CanvasRenderingContext2D, source: HexTile) {\r\n    const [{ overWorld }] = this.context;\r\n    for (const target of overWorld.possibleMigrationTargets(source)) {\r\n      this.drawMigrationArrow(c, source, target);\r\n    }\r\n  }\r\n\r\n  public drawMigrationArrow(c: CanvasRenderingContext2D, source: HexTile, target: HexTile) {\r\n    const isShadowed = (() => {\r\n      if (this.highlightedHex != null) {\r\n        return true;\r\n      } else if (this.populationAttempt != null) {\r\n        return source !== this.populationAttempt.sourceHex || target !== this.populationAttempt.targetHex;\r\n      } else {\r\n        return false;\r\n      }\r\n    })();\r\n    if (isShadowed) {\r\n      c.globalAlpha = 0.2;\r\n    } else {\r\n      c.globalAlpha = 1;\r\n    }\r\n    const { scale } = this.state.cameraState;\r\n    c.shadowBlur = (3 * scale) / 48;\r\n    c.shadowOffsetX = (4 * scale) / 48;\r\n    c.shadowOffsetY = (4 * scale) / 48;\r\n    c.shadowColor = \"black\";\r\n    c.strokeStyle = \"white\";\r\n\r\n    c.lineWidth = (3 * scale) / 48;\r\n    c.lineCap = \"round\";\r\n    c.lineJoin = \"round\";\r\n    const targetCenter = new Vector2(...pixelPosition(target, this.state.cameraState));\r\n    const sourceCenter = new Vector2(...pixelPosition(source, this.state.cameraState));\r\n    const arrowStart = sourceCenter.clone().lerp(targetCenter, 0.2);\r\n    const arrowEnd = targetCenter.clone().lerp(sourceCenter, 0.2);\r\n    drawArrow(c, arrowStart.x, arrowStart.y, arrowEnd.x, arrowEnd.y, (10 * scale) / 48);\r\n    c.shadowColor = \"transparent\";\r\n  }\r\n\r\n  maybeRenderPopover() {\r\n    const { cameraState, populationAttempt, highlightedHex } = this.state;\r\n    if (populationAttempt != null) {\r\n      return (\r\n        <OverWorldPopover camera={cameraState} tile={populationAttempt.targetHex}>\r\n          <HexInfo tile={populationAttempt.targetHex} onClickPlay={this.handleClickPlay} />\r\n        </OverWorldPopover>\r\n      );\r\n    } else if (highlightedHex != null) {\r\n      const canPlay = highlightedHex.info.visible;\r\n      return (\r\n        <OverWorldPopover camera={cameraState} tile={highlightedHex}>\r\n          <HexInfo tile={highlightedHex} onClickPlay={canPlay ? this.handleClickPlay : undefined} />\r\n        </OverWorldPopover>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction drawArrow(c: CanvasRenderingContext2D, fromx: number, fromy: number, tox: number, toy: number, headlen = 10) {\r\n  c.beginPath();\r\n  var dx = tox - fromx;\r\n  var dy = toy - fromy;\r\n  var angle = Math.atan2(dy, dx);\r\n  c.moveTo(fromx, fromy);\r\n  c.lineTo(tox, toy);\r\n  c.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));\r\n  c.moveTo(tox, toy);\r\n  c.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));\r\n  c.stroke();\r\n}\r\n","import Chromosome from \"core/cell/chromosome\";\r\nimport { useAppReducer } from \"game/app\";\r\nimport React from \"react\";\r\nimport { IoIosAddCircleOutline } from \"react-icons/io\";\r\nimport { Color, Vector2 } from \"three\";\r\nimport Genome, { CellType } from \"../../../core/cell/genome\";\r\n\r\nexport const AddCellCard: React.FC<{\r\n  genome: Genome;\r\n}> = ({ genome }) => {\r\n  // const [state, setState] = React.useContext(DraggedContext);\r\n  const [, dispatch] = useAppReducer();\r\n  const handleAddCell = React.useCallback(() => {\r\n    const newCellType = new CellType(\r\n      \"Cell \" + (genome.cellTypes.length + 1),\r\n      0,\r\n      new Chromosome(),\r\n      {\r\n        texturePosition: new Vector2(1, 1),\r\n        color: new Color(Math.random(), Math.random(), Math.random()),\r\n      },\r\n      {\r\n        type: \"give\",\r\n        resources: \"water and sugar\",\r\n      }\r\n    );\r\n    genome.cellTypes.push(newCellType);\r\n    dispatch({ type: \"AAUpdateSpecies\" });\r\n  }, [dispatch, genome.cellTypes]);\r\n  return (\r\n    <div className=\"add-cell-card\">\r\n      <div className=\"add-cell\" onClick={handleAddCell}>\r\n        Add Cell\r\n      </div>\r\n      <button onClick={handleAddCell}>\r\n        <IoIosAddCircleOutline />\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n","export default function lazy<T>(fn: () => T): () => T {\r\n  let cache: T;\r\n  return () => {\r\n    if (cache === undefined) {\r\n      cache = fn();\r\n    }\r\n    return cache;\r\n  };\r\n}\r\n","import spritesheetUrl from \"assets/images/spritesheet.png\";\r\nimport * as THREE from \"three\";\r\nimport lazy from \"../common/lazy\";\r\n\r\nconst spriteSize = 32; // 32x32 sprites\r\nexport let spritesheetLoaded = false;\r\nexport const SPRITESHEET = lazy(() =>\r\n  new THREE.TextureLoader().load(spritesheetUrl, (texture) => {\r\n    texture.magFilter = texture.minFilter = THREE.NearestFilter;\r\n    texture.flipY = true;\r\n    texture.wrapS = texture.wrapT = THREE.ClampToEdgeWrapping;\r\n    SPRITESHEET().dispatchEvent({ type: \"update\" });\r\n    spritesheetLoaded = true;\r\n  })\r\n);\r\n\r\nexport const cache: { [key: string]: THREE.Texture } = {};\r\n// x, y are spritesheet coordinates, starting top-left and going down/right\r\nexport function textureFromSpritesheet(x: number, y: number, backgroundColor = \"transparent\") {\r\n  x = Math.floor(x);\r\n  y = Math.floor(y);\r\n  const key = `${x},${y}`;\r\n  if (cache[key] == null) {\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = spriteSize;\r\n    canvas.height = spriteSize;\r\n    const texture = new THREE.Texture(canvas);\r\n    texture.magFilter = THREE.NearestFilter;\r\n    texture.flipY = true;\r\n    texture.wrapS = THREE.RepeatWrapping;\r\n    texture.wrapT = THREE.RepeatWrapping;\r\n    function drawSpriteToCanvas() {\r\n      const image = SPRITESHEET().image;\r\n      const context = canvas.getContext(\"2d\")!;\r\n      context.fillStyle = backgroundColor;\r\n      context.fillRect(0, 0, spriteSize, spriteSize);\r\n      // context.fillStyle = \"white\";\r\n      // flip the image vertically\r\n      context.drawImage(\r\n        image,\r\n        // sx, sy, sWidth, sHeight\r\n        spriteSize * x,\r\n        spriteSize * y,\r\n        spriteSize,\r\n        spriteSize,\r\n        // dx, dy, dWidth, dHeight\r\n        0,\r\n        0,\r\n        spriteSize,\r\n        spriteSize\r\n      );\r\n      texture.needsUpdate = true;\r\n      // devlog(\"updated spritesheet for\", x, y);\r\n    }\r\n    if (spritesheetLoaded) {\r\n      drawSpriteToCanvas();\r\n    } else {\r\n      SPRITESHEET().addEventListener(\"update\", () => {\r\n        drawSpriteToCanvas();\r\n      });\r\n    }\r\n    cache[key] = texture;\r\n  }\r\n  return cache[key];\r\n}\r\n","import classNames from \"classnames\";\r\nimport React from \"react\";\r\nimport { CellType } from \"../../../core/cell/genome\";\r\nimport { textureFromSpritesheet } from \"../../spritesheet\";\r\nimport \"./IconCell.scss\";\r\nimport { ResourceIcon } from \"./ResourceIcon\";\r\n\r\nexport const ActionBarItem: React.FC<React.HTMLProps<HTMLDivElement>> = ({ children, className, ...props }) => {\r\n  return (\r\n    <div className={classNames(\"action-bar-item\", className)} {...props}>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst IconCell: React.FC<{ cellType: CellType; showCosts?: boolean; spritesheetLoaded: boolean } & React.HTMLProps<\r\n  HTMLDivElement\r\n>> = ({ children, cellType, spritesheetLoaded, showCosts = false, ...props }) => {\r\n  const { material } = cellType;\r\n  const { costSugar, costWater, timeToBuild } = cellType.chromosome.computeStaticProperties();\r\n  const color = (material.color && material.color.getStyle()) || \"transparent\";\r\n  const texture = textureFromSpritesheet(material.texturePosition.x, material.texturePosition.y, color);\r\n  const style: React.CSSProperties = React.useMemo(() => {\r\n    const image = texture.image;\r\n    const url = (() => {\r\n      if (image != null) {\r\n        if (image instanceof HTMLCanvasElement) {\r\n          return image.toDataURL();\r\n        } else if (image instanceof Image) {\r\n          return image.src;\r\n        } else {\r\n          throw new Error(\"image is\" + image);\r\n        }\r\n      } else {\r\n        return \"\";\r\n      }\r\n    })();\r\n    const backgroundImage = `url(${url}), linear-gradient(${color}, ${color})`;\r\n    return {\r\n      backgroundImage,\r\n    };\r\n    // Retrigger this when spritesheet gets loaded\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [color, spritesheetLoaded, texture.image]);\r\n\r\n  const costsEl = showCosts ? (\r\n    <div className=\"costs\">\r\n      <div className=\"time-to-build-info\">{timeToBuild} sec</div>\r\n      <div className=\"cost-to-build-info\">\r\n        {costWater}\r\n        <ResourceIcon name=\"water\" />\r\n        {costSugar}\r\n        <ResourceIcon name=\"sugar\" />\r\n      </div>\r\n    </div>\r\n  ) : null;\r\n\r\n  return (\r\n    <ActionBarItem\r\n      {...props}\r\n      className={classNames(\"icon-cell\", { reproducer: cellType.isReproducer() })}\r\n      style={style}\r\n    >\r\n      {children}\r\n      {costsEl}\r\n    </ActionBarItem>\r\n  );\r\n};\r\nexport default IconCell;\r\n","import React, { useCallback } from \"react\";\r\nimport { CellInteraction, describeCellInteraction } from \"../../../core/cell/genome\";\r\n\r\nexport const CellInteractionSelector: React.FC<{\r\n  interaction?: CellInteraction;\r\n  setInteraction: (i: CellInteraction | undefined) => void;\r\n}> = React.memo(({ interaction, setInteraction }) => {\r\n  const handleSelect = useCallback(\r\n    (event: React.ChangeEvent<HTMLSelectElement>) => {\r\n      const indexOrUndefined = event.target.value;\r\n      if (indexOrUndefined == null) {\r\n        setInteraction(undefined);\r\n        // cellType.interaction = undefined;\r\n      } else {\r\n        const newInteraction = possibleInteractions[Number(indexOrUndefined)];\r\n        if (interaction == null) {\r\n          setInteraction(ensureValidatedInteraction(newInteraction));\r\n        } else {\r\n          setInteraction(\r\n            ensureValidatedInteraction({\r\n              ...newInteraction,\r\n              continuous: interaction.continuous,\r\n            })\r\n          );\r\n        }\r\n      }\r\n    },\r\n    [interaction, setInteraction]\r\n  );\r\n\r\n  const handleChangeContinuous = useCallback(\r\n    (event: React.ChangeEvent<HTMLInputElement>) => {\r\n      if (interaction != null) {\r\n        setInteraction(\r\n          ensureValidatedInteraction({\r\n            ...interaction,\r\n            continuous: event.target.checked,\r\n          })\r\n        );\r\n      }\r\n    },\r\n    [interaction, setInteraction]\r\n  );\r\n  let selectValue =\r\n    interaction == null\r\n      ? undefined\r\n      : possibleInteractions.findIndex((i) => interaction.resources === i.resources && interaction.type === i.type);\r\n  if (selectValue === -1) {\r\n    selectValue = undefined;\r\n  }\r\n  const interactionEl = (\r\n    <select className=\"interaction-select\" onChange={handleSelect} defaultValue={String(selectValue)}>\r\n      <option value={undefined}>do nothing</option>\r\n      {possibleInteractions.map((interaction, index) => {\r\n        return (\r\n          <option key={index} value={index}>\r\n            {describeCellInteraction(interaction)}\r\n          </option>\r\n        );\r\n      })}\r\n    </select>\r\n  );\r\n\r\n  const continuousEl =\r\n    interaction != null ? (\r\n      <label>\r\n        <input type=\"checkbox\" checked={interaction.continuous} onChange={handleChangeContinuous} /> continuously.\r\n      </label>\r\n    ) : null;\r\n  return (\r\n    <form className=\"interaction-select-container\">\r\n      <label>Left-click to {interactionEl}.</label>\r\n      {continuousEl}\r\n    </form>\r\n  );\r\n});\r\n\r\nconst interactionTypes = [\"give\", \"take\"] as const;\r\nconst resourceTypes = [\"water\", \"sugar\", \"water and sugar\"] as const;\r\nexport const possibleInteractions: CellInteraction[] = interactionTypes.flatMap((type) =>\r\n  resourceTypes.map((resources) => ({\r\n    type,\r\n    resources,\r\n  }))\r\n);\r\npossibleInteractions.push(\r\n  {\r\n    type: \"give\",\r\n    resources: \"water take sugar\",\r\n  },\r\n  {\r\n    type: \"give\",\r\n    resources: \"sugar take water\",\r\n  }\r\n);\r\n\r\nfunction ensureValidatedInteraction(interaction: CellInteraction | undefined): CellInteraction | undefined {\r\n  if (interaction == null) {\r\n    return undefined;\r\n  }\r\n  const index = possibleInteractions.findIndex(\r\n    (i) => interaction.resources === i.resources && interaction.type === i.type\r\n  );\r\n  if (index === -1) {\r\n    return undefined;\r\n  } else {\r\n    return interaction;\r\n  }\r\n}\r\n","import { CellType } from \"core/cell\";\r\nimport Genome from \"core/cell/genome\";\r\n\r\nexport function droppableIdToCell(state: Genome, droppableId: string): CellType | undefined {\r\n  return state.cellTypes.find(({ name }) => name === droppableId);\r\n}\r\n\r\nexport function cellToDroppableId(cell: CellType): string {\r\n  return cell.name;\r\n}\r\n","import { Popover } from \"@blueprintjs/core\";\r\nimport React, { useCallback, useState } from \"react\";\r\nimport { IoMdMore } from \"react-icons/io\";\r\nimport \"./MoreOptionsPopover.scss\";\r\n\r\nconst MoreOptionsPopover: React.FC = ({ children }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const handleMoreClicked = useCallback(() => {\r\n    setIsOpen((open) => !open);\r\n  }, []);\r\n  const handleOuterAction = useCallback(() => {\r\n    setIsOpen(false);\r\n  }, []);\r\n  const popoverContent = (\r\n    <div className=\"more-options\">\r\n      {children}\r\n      <button onClick={handleOuterAction}>Back</button>\r\n    </div>\r\n  );\r\n  return (\r\n    <Popover\r\n      isOpen={isOpen}\r\n      position=\"right\"\r\n      transitionDuration={100}\r\n      content={popoverContent}\r\n      popoverClassName=\"more-options-popover\"\r\n    >\r\n      <IoMdMore className=\"more-options-icon\" onClick={handleMoreClicked} />\r\n    </Popover>\r\n  );\r\n};\r\n\r\nexport default MoreOptionsPopover;\r\n","import classNames from \"classnames\";\r\nimport DynamicNumber from \"game/ui/common/DynamicNumber\";\r\nimport React from \"react\";\r\nimport \"./GeneCost.scss\";\r\n\r\nexport function GeneCost({\r\n  cost,\r\n  className,\r\n  ...props\r\n}: {\r\n  cost: number;\r\n} & React.HTMLAttributes<HTMLSpanElement>) {\r\n  return (\r\n    <span\r\n      {...props}\r\n      className={classNames(\"gene-cost\", className, {\r\n        negative: cost < 0,\r\n      })}\r\n    >\r\n      {cost < 0 ? \"+\" : null}\r\n      <DynamicNumber value={Math.abs(cost)} speed={0.5} />\r\n    </span>\r\n  );\r\n}\r\n","import classNames from \"classnames\";\r\nimport { nf } from \"common/formatters\";\r\nimport { TIME_PER_DAY } from \"core/constants\";\r\nimport { arrayRange } from \"math/arrays\";\r\nimport React from \"react\";\r\nimport { Draggable } from \"react-beautiful-dnd\";\r\nimport { GiElectric } from \"react-icons/gi\";\r\nimport { RealizedGene } from \"../../../core/cell/realizedGene\";\r\nimport { GeneCost } from \"./GeneCost\";\r\nimport \"./RealizedGeneViewer.scss\";\r\n\r\nconst EnergyUpkeep: React.FC<{ upkeep: number }> = ({ upkeep }) => {\r\n  let els: JSX.Element;\r\n  if (upkeep % 1 === 0 && upkeep <= 3) {\r\n    els = (\r\n      <>\r\n        {arrayRange(upkeep).map((i) => (\r\n          <GiElectric key={i} />\r\n        ))}\r\n      </>\r\n    );\r\n  } else {\r\n    els = (\r\n      <>\r\n        {nf(upkeep * 100 * TIME_PER_DAY, 3)}% <GiElectric />\r\n        /day\r\n      </>\r\n    );\r\n  }\r\n  return <div className=\"energy-upkeep\">{els}</div>;\r\n};\r\n\r\nexport const RealizedGeneViewer: React.FC<{\r\n  gene: RealizedGene;\r\n  index: number;\r\n  invalid?: boolean;\r\n  draggable?: boolean;\r\n  view?: \"small\" | \"expanded\";\r\n}> = ({ index, gene, draggable = true, view = \"expanded\", invalid = false }) => {\r\n  const { gene: gd } = gene;\r\n  const cost = gene.getCost();\r\n  const energyUpkeepEl = gene.getStaticProperties().energyUpkeep ? (\r\n    <EnergyUpkeep upkeep={gene.getStaticProperties().energyUpkeep!} />\r\n  ) : null;\r\n  const geneLevelEl = gene.level > 0 ? <div className=\"gene-level\">{\"⬥\".repeat(gene.level)}</div> : null;\r\n  const reproducer = gene.getStaticProperties().isReproductive;\r\n  return (\r\n    <Draggable key={gene.uuid} draggableId={`draggable-${gene.uuid}`} index={index} isDragDisabled={!draggable}>\r\n      {(provided, snapshot, rubric) => (\r\n        <div\r\n          ref={provided.innerRef}\r\n          {...provided.draggableProps}\r\n          {...provided.dragHandleProps}\r\n          className={classNames(\"gene\", view, gd.blueprint.name.replace(\" \", \"\"), {\r\n            draggable,\r\n            invalid,\r\n            reproducer,\r\n            provider: cost < 0,\r\n          })}\r\n        >\r\n          <div className=\"gene-header\">\r\n            <GeneCost cost={cost} />\r\n            <h4>\r\n              {gd.blueprint.name} {geneLevelEl}\r\n            </h4>\r\n            {energyUpkeepEl}\r\n          </div>\r\n\r\n          <div className=\"description\">{gd.blueprint.description(gene.getProps(), gene.getStaticProperties())}</div>\r\n        </div>\r\n      )}\r\n    </Draggable>\r\n  );\r\n};\r\n","import { Species } from \"core/species\";\r\nimport React from \"react\";\r\n\r\nexport interface ViewerState {\r\n  view: \"small\" | \"expanded\";\r\n  editable: boolean;\r\n  isDragging: boolean;\r\n  species: Species;\r\n}\r\n\r\nexport const ViewerContext = React.createContext<ViewerState>({\r\n  view: \"expanded\",\r\n  editable: false,\r\n  isDragging: false,\r\n  species: null!,\r\n});\r\n","import { Tooltip } from \"@blueprintjs/core\";\r\nimport classNames from \"classnames\";\r\nimport { nf } from \"common/formatters\";\r\nimport { TIME_PER_DAY } from \"core/constants\";\r\nimport { useAppReducer } from \"game/app\";\r\nimport React, { useCallback, useContext } from \"react\";\r\nimport { Droppable } from \"react-beautiful-dnd\";\r\nimport { MdDelete } from \"react-icons/md\";\r\nimport Genome, { CellInteraction, CellType } from \"../../../core/cell/genome\";\r\nimport { spritesheetLoaded } from \"../../spritesheet\";\r\nimport DynamicNumber from \"../common/DynamicNumber\";\r\nimport IconCell from \"../common/IconCell\";\r\nimport { CellInteractionSelector } from \"./CellInteractionSelector\";\r\nimport \"./CellTypeViewer.scss\";\r\nimport { cellToDroppableId } from \"./droppableId\";\r\nimport MoreOptionsPopover from \"./MoreOptionsPopover\";\r\nimport { RealizedGeneViewer } from \"./RealizedGeneViewer\";\r\nimport { ViewerContext } from \"./viewerState\";\r\n\r\nexport const CellTypeViewer: React.FC<{\r\n  genome: Genome;\r\n  cellType: CellType;\r\n  editable?: boolean;\r\n}> = ({ genome, cellType, editable = false }) => {\r\n  const { name } = cellType;\r\n  const handleSetInteraction = React.useCallback(\r\n    (i: CellInteraction | undefined) => {\r\n      cellType.interaction = i;\r\n    },\r\n    [cellType.interaction]\r\n  );\r\n  const reproducer = cellType.isReproducer();\r\n  const handleNameChange = useCallback(\r\n    (event: React.FormEvent<HTMLInputElement>) => {\r\n      cellType.name = event.currentTarget.value;\r\n    },\r\n    [cellType.name]\r\n  );\r\n\r\n  return (\r\n    <div className={classNames(\"cell-type\", { reproducer })}>\r\n      <div className=\"cell-header\">\r\n        {/* <h2>{name}</h2> */}\r\n        <div className=\"name-container\">\r\n          <input className=\"name\" type=\"text\" defaultValue={name} onInput={handleNameChange} />\r\n        </div>\r\n        {editable ? <CellActionsPopover cellType={cellType} genome={genome} /> : null}\r\n      </div>\r\n      <ChromosomeViewer cellType={cellType} />\r\n      <div className=\"cell-footer\">\r\n        <GeneSlots cellType={cellType} />\r\n        <CellInteractionSelector interaction={cellType.interaction} setInteraction={handleSetInteraction} />\r\n        <IconCell cellType={cellType} spritesheetLoaded={spritesheetLoaded} showCosts />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst GeneSlots: React.FC<{ cellType: CellType }> = ({ cellType }) => {\r\n  const { chromosome } = cellType;\r\n  const chanceForCancer = cellType.getChanceToBecomeCancerous();\r\n  const cancerEl =\r\n    chanceForCancer > 0 ? (\r\n      <div className=\"chance-to-cancer\">\r\n        Cell may become cancerous: {nf(chanceForCancer * 100 * TIME_PER_DAY, 3)}% per day.\r\n      </div>\r\n    ) : (\r\n      undefined\r\n    );\r\n  const isGeneSlotsOver = chromosome.geneSlotsNet() < 0;\r\n  const tooltipContent = (\r\n    <>\r\n      Once you go over on your gene slots, negative effects will start accruing on your cell.\r\n      {cancerEl}\r\n    </>\r\n  );\r\n  return (\r\n    <Tooltip content={tooltipContent} position=\"top\" popoverClassName=\"gene-slots-popover\" hoverOpenDelay={250}>\r\n      <div className=\"gene-slots\">\r\n        Gene Slots:{\" \"}\r\n        <span className={classNames(\"slots-used\", { \"is-over\": isGeneSlotsOver })}>\r\n          <DynamicNumber value={Math.abs(chromosome.geneSlotsNet())} /> {isGeneSlotsOver ? \"over\" : \"under\"}.\r\n        </span>\r\n      </div>\r\n    </Tooltip>\r\n  );\r\n};\r\n\r\nconst ChromosomeViewer = ({ cellType }: { cellType: CellType }) => {\r\n  const viewerState = useContext(ViewerContext);\r\n  const { editable, view, isDragging } = viewerState;\r\n  const { chromosome } = cellType;\r\n  const { genes } = chromosome;\r\n  const empty = genes.length === 0;\r\n\r\n  const duplicateGenes = cellType.getDuplicateGenes();\r\n  const validationEl =\r\n    duplicateGenes.size > 0 ? <div className=\"invalid-alert-text\">Cannot have duplicate genes.</div> : null;\r\n\r\n  return (\r\n    <Droppable key={cellType.name} droppableId={cellToDroppableId(cellType)}>\r\n      {(provided, snapshot) => (\r\n        <div\r\n          {...provided.droppableProps}\r\n          ref={provided.innerRef}\r\n          className={classNames(\"chromosome\", { dragging: isDragging, empty, invalid: duplicateGenes.size > 0 })}\r\n        >\r\n          {validationEl}\r\n          {genes.map((gene, i) => (\r\n            <RealizedGeneViewer\r\n              index={i}\r\n              key={gene.uuid}\r\n              gene={gene}\r\n              draggable={editable}\r\n              view={view}\r\n              invalid={duplicateGenes.has(gene)}\r\n            />\r\n          ))}\r\n          {provided.placeholder}\r\n        </div>\r\n      )}\r\n    </Droppable>\r\n  );\r\n};\r\n\r\nconst CellActionsPopover: React.FC<{\r\n  cellType: CellType;\r\n  genome: Genome;\r\n}> = ({ cellType, genome }) => {\r\n  const [, dispatch] = useAppReducer();\r\n  const deleteCellType = useCallback(() => {\r\n    const index = genome.cellTypes.indexOf(cellType);\r\n    genome.cellTypes.splice(index, 1);\r\n    dispatch({ type: \"AAUpdateSpecies\" });\r\n  }, [cellType, dispatch, genome.cellTypes]);\r\n\r\n  const chromosomeEmpty = cellType.chromosome.isEmpty();\r\n\r\n  return (\r\n    <MoreOptionsPopover>\r\n      <button onClick={deleteCellType} className=\"delete\" disabled={!chromosomeEmpty}>\r\n        <MdDelete />\r\n        {chromosomeEmpty ? \"Delete\" : \"Delete (Remove all genes first)\"}\r\n      </button>\r\n    </MoreOptionsPopover>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport Genome from \"../../../core/cell/genome\";\r\nimport { AddCellCard } from \"./AddCellCard\";\r\nimport { CellTypeViewer } from \"./CellTypeViewer\";\r\nimport \"./GenomeViewer.scss\";\r\nimport { ViewerContext } from \"./viewerState\";\r\n\r\nconst GenomeViewer: React.FC<{ genome: Genome }> = ({ genome }) => {\r\n  const { editable } = React.useContext(ViewerContext);\r\n  return (\r\n    <div className=\"genome-viewer\">\r\n      {genome.cellTypes.map((c, index) => (\r\n        <CellTypeViewer key={index} cellType={c} editable={editable} genome={genome} />\r\n      ))}\r\n      {editable ? <AddCellCard genome={genome} /> : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GenomeViewer;\r\n","import { RealizedGene } from \"core/cell\";\r\nimport { Species } from \"core/species\";\r\nimport { AppActions } from \"game/app\";\r\nimport { geneDrop } from \"game/audio\";\r\nimport produce from \"immer\";\r\nimport { DropResult, ResponderProvided } from \"react-beautiful-dnd\";\r\nimport { droppableIdToCell } from \"./droppableId\";\r\nimport { generateGeneOptions } from \"./generateGeneOptions\";\r\n\r\nexport const ID_TRASH = \"trash\";\r\nexport const ID_GENE_OPTIONS = \"gene-options\";\r\nexport const ID_GENES_UNUSED = \"genes-unused\";\r\n\r\nfunction speciesViewerDragEnd(\r\n  result: DropResult,\r\n  provided: ResponderProvided,\r\n  species: Species,\r\n  dispatch: React.Dispatch<AppActions>\r\n) {\r\n  if (result.destination != null && result.destination.droppableId !== ID_GENE_OPTIONS) {\r\n    geneDrop.play();\r\n    const sourceIndex = result.source.index;\r\n    const { index: destinationIndex, droppableId } = result.destination;\r\n    const newSpecies = produce(species, (draft) => {\r\n      let gene: RealizedGene | undefined;\r\n      let shouldRepopulateGeneOptions = false;\r\n\r\n      if (result.source.droppableId === ID_GENE_OPTIONS) {\r\n        gene = draft.geneOptions[sourceIndex];\r\n\r\n        // delete gene options\r\n        draft.freeMutationPoints -= 1;\r\n        if (draft.freeMutationPoints > 0) {\r\n          shouldRepopulateGeneOptions = true;\r\n        } else {\r\n          draft.geneOptions = [];\r\n        }\r\n      } else if (result.source.droppableId === ID_GENES_UNUSED) {\r\n        gene = draft.genome.unusedGenes.splice(sourceIndex, 1)[0];\r\n      } else {\r\n        // drag between cells; move the gene\r\n        const sourceCell = droppableIdToCell(draft.genome, result.source.droppableId);\r\n        // delete and get gene from source cell\r\n        gene = sourceCell?.chromosome.genes.splice(sourceIndex, 1)[0];\r\n      }\r\n\r\n      if (gene != null) {\r\n        if (droppableId === ID_TRASH) {\r\n          // thrown in the trash, do nothing.\r\n        } else if (droppableId === ID_GENES_UNUSED) {\r\n          draft.genome.unusedGenes.splice(destinationIndex, 0, gene);\r\n        } else {\r\n          const destinationCell = droppableIdToCell(draft.genome, droppableId);\r\n          // put gene in destination cell\r\n          destinationCell?.chromosome.genes.splice(destinationIndex, 0, gene);\r\n        }\r\n      }\r\n      if (shouldRepopulateGeneOptions) {\r\n        draft.geneOptions = generateGeneOptions(draft, false);\r\n      }\r\n    });\r\n    dispatch({\r\n      type: \"AAUpdateSpecies\",\r\n      species: newSpecies,\r\n    });\r\n  }\r\n}\r\n\r\nexport default speciesViewerDragEnd;\r\n","import classNames from \"classnames\";\r\nimport { RealizedGene } from \"core/cell\";\r\nimport { lineage, Species } from \"core/species\";\r\nimport { useAppReducer } from \"game/app\";\r\nimport { genePickUp } from \"game/audio\";\r\nimport MP from \"game/ui/common/MP\";\r\nimport React, { useCallback, useState } from \"react\";\r\nimport { BeforeCapture, DragDropContext, Droppable, DropResult, ResponderProvided } from \"react-beautiful-dnd\";\r\nimport { FaArrowsAltV, FaTrash } from \"react-icons/fa\";\r\nimport { TiThMenu } from \"react-icons/ti\";\r\nimport GenomeViewer from \"./GenomeViewer\";\r\nimport { RealizedGeneViewer } from \"./RealizedGeneViewer\";\r\nimport \"./SpeciesViewer.scss\";\r\nimport speciesViewerDragEnd, { ID_GENES_UNUSED, ID_GENE_OPTIONS, ID_TRASH } from \"./speciesViewerDragEnd\";\r\nimport { ViewerContext } from \"./viewerState\";\r\n\r\nconst SpeciesViewer: React.FC<{\r\n  speciesId: string;\r\n  editable?: boolean;\r\n}> = ({ speciesId, editable = false }) => {\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [view, setView] = React.useState<\"small\" | \"expanded\">(\"small\");\r\n  const [state, dispatch] = useAppReducer();\r\n  const species = lineage(state.rootSpecies).find((s) => s.id === speciesId)!;\r\n\r\n  const viewerState = React.useMemo(() => ({ species, view, editable, isDragging }), [\r\n    editable,\r\n    isDragging,\r\n    species,\r\n    view,\r\n  ]);\r\n\r\n  const handleDragEnd = useCallback(\r\n    (result: DropResult, provided: ResponderProvided) => {\r\n      console.log(\"onDragEnd\", result, provided);\r\n      setIsDragging(false);\r\n      speciesViewerDragEnd(result, provided, species, dispatch);\r\n    },\r\n    [dispatch, species]\r\n  );\r\n\r\n  const handleBeforeCapture = useCallback((before: BeforeCapture) => {\r\n    setIsDragging(true);\r\n    genePickUp.play();\r\n  }, []);\r\n  const handleViewSmall = useCallback(() => {\r\n    setView(\"small\");\r\n  }, []);\r\n  const handleViewExpanded = useCallback(() => {\r\n    setView(\"expanded\");\r\n  }, []);\r\n\r\n  return (\r\n    <DragDropContext onDragEnd={handleDragEnd} onBeforeCapture={handleBeforeCapture}>\r\n      <ViewerContext.Provider value={viewerState}>\r\n        <div className=\"species-viewer\">\r\n          <div className=\"species-name\">{species.name}</div>\r\n          <div className=\"view-switcher\">\r\n            <TiThMenu onClick={handleViewSmall} className={classNames({ active: view === \"small\" })} />\r\n            <FaArrowsAltV onClick={handleViewExpanded} className={classNames({ active: view === \"expanded\" })} />\r\n          </div>\r\n          {species.freeMutationPoints > 0 && editable ? <MutationChooser species={species} /> : null}\r\n          {isDragging ? <DeleteGeneDroppable /> : null}\r\n          <GenomeViewer genome={species.genome} />\r\n          {editable || species.genome.unusedGenes.length > 0 ? (\r\n            <UnusedGeneArea genes={species.genome.unusedGenes} />\r\n          ) : null}\r\n        </div>\r\n      </ViewerContext.Provider>\r\n    </DragDropContext>\r\n  );\r\n};\r\n\r\nexport default SpeciesViewer;\r\n\r\nconst MutationChooser: React.FC<{ species: Species }> = ({ species }) => {\r\n  const { freeMutationPoints, geneOptions } = species;\r\n  return (\r\n    <div className=\"mutation-chooser\">\r\n      <h1>\r\n        Choose one Mutation{\" \"}\r\n        {freeMutationPoints > 1 ? (\r\n          <small>\r\n            <MP amount={freeMutationPoints - 1} /> more remaining\r\n          </small>\r\n        ) : null}\r\n      </h1>\r\n      <p className=\"instruction\">Drag and Drop into your cell</p>\r\n      <Droppable droppableId={ID_GENE_OPTIONS} isDropDisabled direction=\"horizontal\">\r\n        {(provided, snapshot) => (\r\n          <div className=\"gene-options\" ref={provided.innerRef} {...provided.droppableProps}>\r\n            {geneOptions.map((gene, index) => (\r\n              <RealizedGeneViewer index={index} key={gene.uuid} gene={gene} draggable view=\"expanded\" />\r\n            ))}\r\n            {provided.placeholder}\r\n          </div>\r\n        )}\r\n      </Droppable>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst DeleteGeneDroppable = () => {\r\n  return (\r\n    <Droppable droppableId={ID_TRASH}>\r\n      {(provided, snapshot) => (\r\n        <div\r\n          {...provided.droppableProps}\r\n          ref={provided.innerRef}\r\n          className={classNames(\"trash\", { hovered: snapshot.isDraggingOver })}\r\n        >\r\n          <FaTrash />\r\n          {/* <RealizedGeneViewer gene={tutorialGenome.cellTypes[0].chromosome.genes[0]} index={0} /> */}\r\n          {provided.placeholder}\r\n        </div>\r\n      )}\r\n    </Droppable>\r\n  );\r\n};\r\n\r\nconst UnusedGeneArea = ({ genes }: { genes: RealizedGene[] }) => {\r\n  const { isDragging, view, editable } = React.useContext(ViewerContext);\r\n  return (\r\n    <div className=\"unused-genes\">\r\n      <h2>Unused {genes.length}/5</h2>\r\n      <Droppable droppableId={ID_GENES_UNUSED} direction=\"horizontal\" isDropDisabled={genes.length >= 5}>\r\n        {(provided, snapshot) => (\r\n          <div\r\n            {...provided.droppableProps}\r\n            ref={provided.innerRef}\r\n            className={classNames(\"unused-genes-droppable\", { dragging: isDragging })}\r\n          >\r\n            {genes.map((gene, index) => (\r\n              <RealizedGeneViewer index={index} key={gene.uuid} gene={gene} draggable={editable} view={view} />\r\n            ))}\r\n            {provided.placeholder}\r\n          </div>\r\n        )}\r\n      </Droppable>\r\n    </div>\r\n  );\r\n};\r\n","import SpeciesViewer from \"./SpeciesViewer\";\r\n\r\nexport default SpeciesViewer;\r\n","import { Intent, Overlay, ProgressBar } from \"@blueprintjs/core\";\r\nimport classNames from \"classnames\";\r\nimport { nf } from \"common/formatters\";\r\nimport { sleep } from \"common/promise\";\r\nimport { lineage, Species } from \"core/species\";\r\nimport { useAppReducer } from \"game/app\";\r\nimport { resetGame, save } from \"game/app/saveLoad\";\r\nimport { mitoOverworld } from \"game/audio\";\r\nimport { Button } from \"game/ui/common/Button\";\r\nimport PhylogeneticTree from \"game/ui/overworld/PhylogeneticTree\";\r\nimport { map } from \"math\";\r\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { GiFamilyTree } from \"react-icons/gi\";\r\nimport { HexTile } from \"../../core/overworld/hexTile\";\r\nimport { EpochUI } from \"../ui/overworld/EpochUI\";\r\nimport { OverWorldMap } from \"../ui/overworld/map/OverWorldMap\";\r\nimport SpeciesViewer from \"../ui/SpeciesViewer\";\r\nimport \"./OverWorldScreen.scss\";\r\n\r\nexport interface OverWorldScreenProps {\r\n  onNextEpoch: () => void;\r\n}\r\n\r\nconst OverWorldScreen = React.memo(({ onNextEpoch }: OverWorldScreenProps) => {\r\n  useEffect(() => {\r\n    mitoOverworld.play();\r\n    return () => {\r\n      mitoOverworld.stop();\r\n    };\r\n  }, []);\r\n\r\n  const [leftPanelOpen, setLeftPanelOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    function handleKeyDown(e: KeyboardEvent) {\r\n      if (e.code === \"Tab\") {\r\n        setLeftPanelOpen((open) => !open);\r\n        e.preventDefault();\r\n      }\r\n    }\r\n    document.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleKeyDown);\r\n    };\r\n  }, []);\r\n\r\n  const [viewedSpecies, setViewedSpecies] = useState<string>();\r\n\r\n  const handleStartMutate = useCallback((s: Species) => {\r\n    setViewedSpecies(s.id);\r\n  }, []);\r\n\r\n  const [{ rootSpecies, epoch, overWorld }] = useAppReducer();\r\n\r\n  const onMountEpoch = useRef(epoch);\r\n\r\n  useEffect(() => {\r\n    if (epoch !== onMountEpoch.current) {\r\n      sleep(4500).then(() => {\r\n        // TODO add a UI to let you mutate multiple species\r\n        const speciesReadyToMutate = lineage(rootSpecies).filter((species) => species.freeMutationPoints > 0);\r\n        setViewedSpecies(speciesReadyToMutate[0].id);\r\n      });\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [epoch]);\r\n\r\n  function maybeRenderPhylogeneticTreePanel() {\r\n    const unusedPoints = lineage(rootSpecies)\r\n      .map((x) => x.freeMutationPoints)\r\n      .reduce((a, b) => a + b);\r\n    const unusedPointsEl = unusedPoints > 0 ? <div className=\"unused-points\">{unusedPoints}</div> : null;\r\n    return (\r\n      <div className={classNames(\"panel-left\", { open: leftPanelOpen })}>\r\n        {leftPanelOpen ? <PhylogeneticTree onMutate={handleStartMutate} /> : null}\r\n        <button className=\"panel-left-handle\" onClick={() => setLeftPanelOpen((open) => !open)}>\r\n          <GiFamilyTree className=\"icon\" />\r\n          {unusedPointsEl}\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handleSpeciesViewerClose = useCallback(() => {\r\n    setViewedSpecies(undefined);\r\n  }, []);\r\n  const speciesViewerEl = (\r\n    <Overlay isOpen={viewedSpecies != null} onClose={handleSpeciesViewerClose}>\r\n      <div className=\"species-viewer-modal\">\r\n        <button className=\"close\" onClick={handleSpeciesViewerClose}>\r\n          ✖\r\n        </button>\r\n        <SpeciesViewer speciesId={viewedSpecies!} editable />\r\n      </div>\r\n    </Overlay>\r\n  );\r\n\r\n  const [focusedHex, setFocusedHex] = useState<HexTile | undefined>(undefined);\r\n  const handleFocusHex = useCallback((hex: HexTile) => {\r\n    setFocusedHex(hex);\r\n  }, []);\r\n\r\n  const [appState] = useAppReducer();\r\n\r\n  const oxygenLevel = useMemo(() => overWorld.computeOxygenLevel(), [overWorld]);\r\n  function renderOxygenLevel() {\r\n    return (\r\n      <div className=\"oxygen-level\">\r\n        <ProgressBar\r\n          className=\"progress-bar\"\r\n          animate={false}\r\n          intent={Intent.SUCCESS}\r\n          stripes={false}\r\n          value={map(oxygenLevel, 0, 1, 0.01, 1)}\r\n        />\r\n        <div className=\"indicator\">{nf(oxygenLevel, 3)}% Global Atmospheric Oxygen</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"overworld-screen\">\r\n      <OverWorldMap focusedHex={focusedHex} />\r\n      {maybeRenderPhylogeneticTreePanel()}\r\n      {speciesViewerEl}\r\n      <EpochUI onNextEpoch={onNextEpoch} onFocusHex={handleFocusHex} />\r\n      {renderOxygenLevel()}\r\n      <div style={{ position: \"absolute\", right: \"10px\", top: \"10px\" }}>\r\n        <Button onClick={() => save(appState)}>Save</Button>\r\n      </div>\r\n      <div style={{ position: \"absolute\", right: \"10px\", top: \"60px\" }}>\r\n        <Button onClick={() => resetGame()}>Reset Game</Button>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default OverWorldScreen;\r\n","import devlog from \"common/devlog\";\r\nimport { sleep } from \"common/promise\";\r\nimport { OverWorld } from \"core/overworld/overWorld\";\r\nimport { newBaseSpecies } from \"core/species\";\r\nimport React, { useEffect } from \"react\";\r\nimport { AATransitionEnd, AppActions, AppReducerContext, reducer } from \"./reducer\";\r\nimport { load, saveOnActionMiddleware } from \"./saveLoad\";\r\nimport { AppState } from \"./state\";\r\n\r\nexport interface AppStateProviderProps {\r\n  children: React.ReactNode;\r\n  appState: AppState;\r\n}\r\n\r\n// when a TransitionStart action happens, automatically trigger a TransitionEnd\r\n// after millis\r\nexport function autoTransitionEndDispatchMiddleware(dispatch: React.Dispatch<AppActions>, millis = 2000) {\r\n  const newDispatch: React.Dispatch<AppActions> = (action: AppActions) => {\r\n    dispatch(action);\r\n    if (action.type === \"AATransitionStart\") {\r\n      sleep(millis).then(() => {\r\n        dispatch({ type: \"AATransitionEnd\" });\r\n      });\r\n    }\r\n  };\r\n  return newDispatch;\r\n}\r\n\r\nexport function handleTransitionEndMiddleware(\r\n  reducer: React.Reducer<AppState, AppActions>\r\n): React.Reducer<AppState, AppActions> {\r\n  function handleTransitionEnd(state: AppState, action: AATransitionEnd): AppState {\r\n    const { transition, ...stateWithoutTransition } = state;\r\n    if (transition) {\r\n      return reducer(stateWithoutTransition, transition);\r\n    } else {\r\n      devlog(\"handled transition end with no transition specified!\");\r\n      return state;\r\n    }\r\n  }\r\n\r\n  return (state, action) => {\r\n    if (action.type === \"AATransitionEnd\") {\r\n      return handleTransitionEnd(state, action);\r\n    } else {\r\n      return reducer(state, action);\r\n    }\r\n  };\r\n}\r\n\r\nexport function AppStateProvider({ children, appState }: AppStateProviderProps) {\r\n  const reducerWithMiddleware = React.useMemo(() => handleTransitionEndMiddleware(saveOnActionMiddleware(reducer)), []);\r\n  const [state, dispatchRaw] = React.useReducer(reducerWithMiddleware, appState);\r\n  const dispatch = React.useMemo(() => autoTransitionEndDispatchMiddleware(dispatchRaw), []);\r\n  const reducerTuple = React.useMemo(() => [state, dispatch] as [AppState, React.Dispatch<AppActions>], [\r\n    state,\r\n    dispatch,\r\n  ]);\r\n  return <AppReducerContext.Provider value={reducerTuple}>{children}</AppReducerContext.Provider>;\r\n}\r\n\r\nexport const LocalForageStateProvider: React.FC<{ loadingComponent: JSX.Element }> = ({\r\n  children,\r\n  loadingComponent = null,\r\n}) => {\r\n  const [state, setState] = React.useState<AppState | null>(null);\r\n  useEffect(() => {\r\n    load()\r\n      .then((appState) => {\r\n        setState(appState);\r\n        console.log(\"loading\", appState);\r\n      })\r\n      .catch(() => {\r\n        const newGameState = newInitialAppState();\r\n        console.log(\"couldn't load appState from localForage; resetting game\", newGameState);\r\n        setState(newGameState);\r\n      });\r\n  }, []);\r\n\r\n  return state == null ? loadingComponent : <AppStateProvider appState={state}>{children}</AppStateProvider>;\r\n};\r\n\r\nexport function newInitialAppState(): AppState {\r\n  const overWorld = OverWorld.generateLargeContinent(23);\r\n  const rootSpecies = newBaseSpecies(\"plantum originus\");\r\n  const startHex = overWorld.getStartHex();\r\n  // rootSpecies.freeMutationPoints = 25;\r\n  // const s3 = newBaseSpecies(\"s3\");\r\n  // s3.descendants = [newBaseSpecies(\"ya\"), newBaseSpecies(\"no\"), newBaseSpecies(\"whoa\")];\r\n  // let s: Species;\r\n  // rootSpecies.descendants = [s = newBaseSpecies(\"foo\"), newBaseSpecies(\"bar\"), s3];\r\n  // s.descendants = [newBaseSpecies(\"1\"), newBaseSpecies(\"2\")]\r\n  return {\r\n    overWorld,\r\n    rootSpecies,\r\n    activePopulationAttempt: {\r\n      settlingSpecies: rootSpecies,\r\n      targetHex: startHex,\r\n    },\r\n    epoch: 0,\r\n  };\r\n}\r\n","import { Vector2 } from \"three\";\r\n\r\nexport class Mouse {\r\n  public readonly position = new Vector2();\r\n\r\n  public isPressed = false;\r\n\r\n  public button = -1;\r\n\r\n  constructor(el: HTMLElement) {\r\n    el.addEventListener(\"mousedown\", this.handleMouseDown);\r\n    el.addEventListener(\"mousemove\", this.handleMouseMove);\r\n    el.addEventListener(\"mouseup\", this.handleMouseUp);\r\n  }\r\n\r\n  private handleMouseDown = (event: MouseEvent) => {\r\n    this.isPressed = true;\r\n    this.button = event.button;\r\n    this.handleMouseMove(event);\r\n  };\r\n\r\n  private handleMouseMove = (event: MouseEvent) => {\r\n    this.position.x = event.clientX!;\r\n    this.position.y = event.clientY!;\r\n  };\r\n\r\n  private handleMouseUp = (event: MouseEvent) => {\r\n    this.isPressed = false;\r\n    this.button = -1;\r\n    this.handleMouseMove(event);\r\n  };\r\n}\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\n\r\nexport const UI_EVENTS = {\r\n  click: true,\r\n  contextmenu: true,\r\n  dblclick: true,\r\n  mousedown: true,\r\n  mouseup: true,\r\n  mousemove: true,\r\n  touchstart: true,\r\n  touchmove: true,\r\n  touchend: true,\r\n  keyup: true,\r\n  keydown: true,\r\n  keypress: true,\r\n  wheel: true,\r\n};\r\n\r\nexport type UIEventReciever = {\r\n  [E in keyof typeof UI_EVENTS]?: (this: HTMLElement, ev: GlobalEventHandlersEventMap[E]) => void;\r\n  // [E in keyof typeof UI_EVENTS]?: (ev: Event) => void;\r\n};\r\n\r\nexport abstract class ISketch {\r\n  static id?: string;\r\n\r\n  public elements?: JSX.Element[];\r\n\r\n  public events?: UIEventReciever;\r\n\r\n  /**\r\n   * milliseconds since sketch started running.\r\n   */\r\n  public timeElapsed = 0;\r\n\r\n  public frameCount = 0;\r\n\r\n  constructor(public renderer: THREE.WebGLRenderer, public audioContext: SketchAudioContext) {}\r\n\r\n  /**\r\n   * height / width\r\n   */\r\n  get aspectRatio() {\r\n    return this.renderer.domElement.height / this.renderer.domElement.width;\r\n  }\r\n\r\n  get resolution() {\r\n    return new THREE.Vector2(this.renderer.domElement.width, this.renderer.domElement.height);\r\n  }\r\n\r\n  get canvas() {\r\n    return this.renderer.domElement;\r\n  }\r\n\r\n  abstract animate(millisElapsed: number): void;\r\n\r\n  render?(): React.ReactNode;\r\n\r\n  resize?(width: number, height: number): void;\r\n\r\n  destroy?(): void;\r\n}\r\n\r\nexport interface SketchAudioContext extends AudioContext {\r\n  gain: GainNode;\r\n}\r\n","import { Scene } from \"three\";\r\nimport { Mito } from \"../mito/mito\";\r\nexport abstract class Renderer<T> {\r\n  constructor(public target: T, public scene: Scene, public mito: Mito) {}\r\n\r\n  abstract update(): void;\r\n\r\n  abstract destroy(): void;\r\n}\r\n","// hack - to work with vscode-glsl-literal\r\nconst glsl = (x: TemplateStringsArray) => x[0];\r\n\r\nexport default glsl;\r\n","import { BufferAttribute, BufferGeometry, Color, DynamicDrawUsage, Points, ShaderMaterial, Texture } from \"three\";\r\nimport glsl from \"./glsl\";\r\n\r\nexport class CommittablePoints extends Points {\r\n  public geometry: BufferGeometry;\r\n\r\n  public material: ResourcePointsMaterial;\r\n\r\n  static newGeometry(size: number) {\r\n    const geometry = new BufferGeometry();\r\n    const positions = new Float32Array(size * 3);\r\n    const rotations = new Float32Array(size);\r\n    const sizes = new Float32Array(size);\r\n    const alphas = new Float32Array(size);\r\n    geometry.setAttribute(\"position\", new BufferAttribute(positions, 3).setUsage(DynamicDrawUsage));\r\n    geometry.setAttribute(\"rotation\", new BufferAttribute(rotations, 1).setUsage(DynamicDrawUsage));\r\n    geometry.setAttribute(\"size\", new BufferAttribute(sizes, 1).setUsage(DynamicDrawUsage));\r\n    geometry.setAttribute(\"alpha\", new BufferAttribute(alphas, 1).setUsage(DynamicDrawUsage));\r\n    return geometry;\r\n  }\r\n\r\n  constructor(size: number, public params: CommittablePointsParameters) {\r\n    super();\r\n    this.geometry = CommittablePoints.newGeometry(size);\r\n    this.material = new ResourcePointsMaterial(params);\r\n    this.frustumCulled = false;\r\n  }\r\n\r\n  private index = 0;\r\n\r\n  startFrame() {\r\n    this.index = 0;\r\n  }\r\n\r\n  commit(x: number, y: number, z: number, size: number, alpha: number, r?: number) {\r\n    this.geometry.attributes.position.setXYZ(this.index, x, y, z);\r\n    this.geometry.attributes.size.setX(this.index, size);\r\n    this.geometry.attributes.alpha.setX(this.index, alpha);\r\n    if (r != null) {\r\n      this.geometry.attributes.rotation.setX(this.index, r);\r\n    }\r\n    this.index++;\r\n  }\r\n\r\n  endFrame() {\r\n    const positions = this.geometry.attributes.position as BufferAttribute;\r\n    positions.needsUpdate = true;\r\n    const sizes = this.geometry.attributes.size as BufferAttribute;\r\n    sizes.needsUpdate = true;\r\n    const rotations = this.geometry.attributes.rotation as BufferAttribute;\r\n    rotations.needsUpdate = true;\r\n    const alphas = this.geometry.attributes.alpha as BufferAttribute;\r\n    alphas.needsUpdate = true;\r\n    this.geometry.setDrawRange(0, this.index);\r\n  }\r\n}\r\n\r\nexport interface CommittablePointsParameters {\r\n  opacity: number;\r\n  color: Color;\r\n  size: number;\r\n  map?: Texture;\r\n}\r\n\r\nclass ResourcePointsMaterial extends ShaderMaterial {\r\n  public map: Texture | undefined;\r\n\r\n  constructor(public params: CommittablePointsParameters) {\r\n    super({\r\n      uniforms: {\r\n        opacity: { value: params.opacity },\r\n        sizeGlobal: { value: params.size },\r\n        color: { value: params.color },\r\n        // you have to put it here too\r\n        map: { value: params.map },\r\n      },\r\n      vertexShader,\r\n      fragmentShader,\r\n      depthTest: false,\r\n      transparent: true,\r\n    } as any);\r\n\r\n    // OH MY GOD you can do this. You have to do this *AFTER* the super call!\r\n    // This hooks into threejs WebGLProgram's built-in properties that hooks up\r\n    // various named textures to glsl variables and #DEFINEs.\r\n    this.map = params.map;\r\n  }\r\n}\r\n\r\nconst vertexShader = glsl`\r\nattribute float size;\r\nattribute float rotation;\r\nattribute float alpha;\r\nuniform float sizeGlobal;\r\n\r\nvarying float vAlpha;\r\nvarying float vRotation;\r\n\r\nvoid main() {\r\n  vRotation = rotation;\r\n  vAlpha = alpha;\r\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n  gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\r\n  gl_Position = projectionMatrix * mvPosition;\r\n}\r\n`;\r\n\r\nconst fragmentShader = glsl`\r\nuniform vec3 color;\r\nuniform sampler2D texture;\r\nuniform float opacity;\r\n\r\nvarying float vRotation;\r\nvarying float vAlpha;\r\n\r\n#ifdef USE_MAP\r\n  uniform mat3 uvTransform;\r\n  uniform sampler2D map;\r\n#endif\r\n\r\nvec2 rotateAround ( in vec2 v, in vec2 center, in float angle ) {\r\n\r\n  float c = cos( angle );\r\n  float s = sin( angle );\r\n\r\n  float x = v.x - center.x;\r\n  float y = v.y - center.y;\r\n\r\n  vec2 r = vec2(x * c - y * s + center.x, x * s + y * c + center.y);\r\n\r\n  return r;\r\n}\r\n\r\nfloat zeroToOne(float x) {\r\n    return step(0., x) * (1. - step(1., x));\r\n}\r\n\r\nfloat inSquare(vec2 v) {\r\n  float xMult = zeroToOne(v.x);\r\n  float yMult = zeroToOne(v.y);\r\n  return xMult * yMult;\r\n}\r\n\r\nvoid main() {\r\n  gl_FragColor = vec4( color, 1. );\r\n  float alpha = vAlpha;\r\n\r\n  #ifdef USE_MAP\r\n    vec2 uv = gl_PointCoord;\r\n\r\n    // flip vRotation to account for flipped y viewport\r\n    uv = rotateAround(uv, vec2(0.5), -vRotation); //, vec2(0.), vec2(1.));\r\n\r\n    // if we're out of the UV clamped edge, set alpha to 0\r\n    alpha *= inSquare(uv);\r\n\r\n    vec4 mapTexel = texture2D( map, uv );\r\n    gl_FragColor *= mapTexelToLinear( mapTexel );\r\n  #endif\r\n  gl_FragColor.a *= opacity * alpha;\r\n}\r\n`;\r\n","import { CommittablePoints, CommittablePointsParameters } from \"./committablePoints\";\r\n\r\ninterface PointState<S> {\r\n  r?: number;\r\n  time: number;\r\n  size: number;\r\n  alpha: number;\r\n  x: number;\r\n  y: number;\r\n  z: number;\r\n  info: S;\r\n}\r\n\r\nexport class FireAndForgetPoints<S = any> extends CommittablePoints {\r\n  private state: Set<PointState<S>> = new Set();\r\n\r\n  constructor(public lifeFn: (s: PointState<S>, dt: number) => undefined | false, params: CommittablePointsParameters) {\r\n    super(10000, params);\r\n  }\r\n\r\n  fire(s: PointState<S>) {\r\n    this.state.add(s);\r\n  }\r\n\r\n  update(dt: number) {\r\n    const toRemove: PointState<S>[] = [];\r\n    for (const p of this.state) {\r\n      p.time += dt;\r\n      const nextState = this.lifeFn(p, dt);\r\n      if (nextState === false) {\r\n        toRemove.push(p);\r\n      }\r\n    }\r\n    for (const p of toRemove) {\r\n      this.state.delete(p);\r\n    }\r\n  }\r\n\r\n  commitAll() {\r\n    this.startFrame();\r\n    for (const p of this.state) {\r\n      this.commit(p.x, p.y, p.z, p.size, p.alpha, p.r);\r\n    }\r\n    this.endFrame();\r\n  }\r\n}\r\n","import { TileEvent } from \"core/tile/tileEvent\";\r\nimport { Renderer } from \"../Renderer\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\n\r\nexport abstract class EventRenderer<T extends TileEvent> extends Renderer<T[]> {\r\n  constructor(public eventName: T[\"type\"], public worldRenderer: WorldRenderer) {\r\n    super([], worldRenderer.scene, worldRenderer.mito);\r\n  }\r\n\r\n  abstract handle(event: T): void;\r\n\r\n  update() {\r\n    this.target = this.worldRenderer.target.getLastStepStats().events[this.eventName] as T[];\r\n  }\r\n}\r\n","import { TileEvent } from \"core/tile/tileEvent\";\r\nimport { FireAndForgetPoints } from \"../fireAndForgetPoints\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport { EventRenderer } from \"./eventRenderer\";\r\n\r\nexport abstract class EventRendererFFPoints<T extends TileEvent> extends EventRenderer<T> {\r\n  constructor(public eventName: T[\"type\"], public worldRenderer: WorldRenderer, public ffPoints: FireAndForgetPoints) {\r\n    super(eventName, worldRenderer);\r\n    this.scene.add(this.ffPoints);\r\n  }\r\n\r\n  abstract handle(event: T): void;\r\n\r\n  update() {\r\n    super.update();\r\n    this.ffPoints.update(1 / 30);\r\n    for (const event of this.target) {\r\n      this.handle(event);\r\n    }\r\n    this.ffPoints.commitAll();\r\n  }\r\n\r\n  destroy() {\r\n    this.scene.remove(this.ffPoints);\r\n  }\r\n}\r\n","import { EventCellEat } from \"core/tile/tileEvent\";\r\nimport { distScalar, eatBuffer } from \"game/audio\";\r\nimport { textureFromSpritesheet } from \"game/spritesheet\";\r\nimport { Audio, Color } from \"three\";\r\nimport { FireAndForgetPoints } from \"../fireAndForgetPoints\";\r\nimport { InstancedTileRenderer } from \"../tile/InstancedTileRenderer\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport { EventRendererFFPoints } from \"./eventRendererFFPoints\";\r\n\r\nexport default class EventCellEatRenderer extends EventRendererFFPoints<EventCellEat> {\r\n  static makePoints() {\r\n    const duration = 0.6;\r\n    return new FireAndForgetPoints(\r\n      (s) => {\r\n        if (s.time > duration) {\r\n          return false;\r\n        }\r\n        const x = s.time / duration;\r\n        s.size = 4 * (x - x * x);\r\n      },\r\n      {\r\n        color: new Color(\"yellow\"),\r\n        opacity: 0.8,\r\n        size: 200,\r\n        map: textureFromSpritesheet(1, 3, \"transparent\"),\r\n      }\r\n    );\r\n  }\r\n\r\n  constructor(target: WorldRenderer) {\r\n    super(\"cell-eat\", target, EventCellEatRenderer.makePoints());\r\n  }\r\n\r\n  private audio = (() => {\r\n    const audio = new Audio(this.mito.audioListener);\r\n    audio.loop = true;\r\n    audio.setVolume(0);\r\n    eatBuffer.then((buffer) => {\r\n      audio.setBuffer(buffer);\r\n      audio.play();\r\n      audio.setDetune(600);\r\n    });\r\n    return audio;\r\n  })();\r\n\r\n  handle(event: EventCellEat) {\r\n    const { who } = event;\r\n    const baseVolume = 0.04;\r\n    const volume = distScalar(who, this.mito.world.player) * baseVolume;\r\n    if (volume > this.audio.gain.gain.value) {\r\n      this.audio.gain.gain.setValueAtTime(volume, 0);\r\n      this.audio.gain.gain.cancelScheduledValues(this.audio.context.currentTime + 1);\r\n      this.audio.gain.gain.setTargetAtTime(0, this.audio.context.currentTime + 1, 0.1);\r\n    }\r\n    const tileRenderer = this.worldRenderer.renderers.get(who) as InstancedTileRenderer | null;\r\n    const activeSugar = tileRenderer?.inventoryRenderer?.getActiveSugar();\r\n    const dX = activeSugar?.x ?? 0;\r\n    const dY = activeSugar?.y ?? 0;\r\n    this.ffPoints.fire({\r\n      x: who.pos.x + dX,\r\n      y: who.pos.y + dY,\r\n      z: 1,\r\n      size: 1,\r\n      alpha: 1,\r\n      info: event,\r\n      time: 0,\r\n    });\r\n  }\r\n}\r\n","import { EventCellTransferEnergy } from \"core/tile/tileEvent\";\r\nimport { textureFromSpritesheet } from \"game/spritesheet\";\r\nimport { map } from \"math\";\r\nimport { Color } from \"three\";\r\nimport { FireAndForgetPoints } from \"../fireAndForgetPoints\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport { EventRendererFFPoints } from \"./eventRendererFFPoints\";\r\n\r\nexport default class EventCellTransferEnergyRenderer extends EventRendererFFPoints<EventCellTransferEnergy> {\r\n  static makePoints() {\r\n    const duration = 0.5;\r\n    return new FireAndForgetPoints<EventCellTransferEnergy>(\r\n      (s) => {\r\n        if (s.time > duration) {\r\n          return false;\r\n        }\r\n        const t = s.time / duration;\r\n        const size = 4 * (t - t * t);\r\n\r\n        const { from, to } = s.info;\r\n        const { x, y } = from.pos.clone().lerp(to.pos, map(t, 0, 1, 0.45, 0.55));\r\n        // const x = (from.pos.x + to.pos.x) / 2;\r\n        // const y = (from.pos.y + to.pos.y) / 2;\r\n        s.x = x;\r\n        s.y = y;\r\n        s.size = size;\r\n      },\r\n      {\r\n        color: new Color(\"yellow\"),\r\n        opacity: 0.8,\r\n        size: 350,\r\n        map: textureFromSpritesheet(2, 3, \"transparent\"),\r\n      }\r\n    );\r\n  }\r\n\r\n  constructor(target: WorldRenderer) {\r\n    super(\"cell-transfer-energy\", target, EventCellTransferEnergyRenderer.makePoints());\r\n  }\r\n\r\n  handle(event: EventCellTransferEnergy) {\r\n    const { from, to } = event;\r\n    const r = Math.atan2(to.pos.y - from.pos.y, to.pos.x - from.pos.x);\r\n\r\n    this.ffPoints.fire({\r\n      x: event.from.pos.x,\r\n      y: event.from.pos.y,\r\n      r,\r\n      z: 1,\r\n      size: 0.1,\r\n      alpha: 1,\r\n      info: event,\r\n      time: 0,\r\n    });\r\n  }\r\n}\r\n","import { clamp } from \"math\";\r\n\r\nexport function mirrored(f: (t: number) => number) {\r\n  // https://bl.ocks.org/mbostock/3145795\r\n  return (t: number) => (t < 0.5 ? f(2 * t) : f(2 - 2 * t));\r\n}\r\n\r\nexport function reversed(f: (t: number) => number) {\r\n  return (t: number) => f(1 - t);\r\n}\r\n\r\n/**\r\n * t - t^2, scaled between 0-1\r\n * 0 = 0\r\n * 0.5 = 1\r\n * 1 = 0\r\n */\r\nexport function polyUpDown(t: number) {\r\n  return 4 * (t - t * t);\r\n}\r\n\r\nexport function smoothstep(t: number) {\r\n  t = clamp(t, 0, 1);\r\n  return t * t * (3 - 2 * t);\r\n}\r\n\r\n/**\r\n * (t^2-t^3) scaled to 0 and 1\r\n * 0 = 0\r\n * ...smooth upwards curve\r\n * 2/3 = 1\r\n * ...sharper downards curve\r\n * 1 = 0\r\n */\r\nexport function polyLateUpDown(t: number) {\r\n  return clamp((27 / 4) * (t * t - t * t * t), 0, 1);\r\n}\r\n\r\nexport const polyEarlyUpDown = reversed(polyLateUpDown);\r\n","import { EventCollectSunlight } from \"core/tile/tileEvent\";\r\nimport { textureFromSpritesheet } from \"game/spritesheet\";\r\nimport { clamp, randElement, randFloat } from \"math\";\r\nimport { polyEarlyUpDown } from \"math/easing\";\r\nimport { Color } from \"three\";\r\nimport { FireAndForgetPoints } from \"../fireAndForgetPoints\";\r\nimport { InstancedTileRenderer } from \"../tile/InstancedTileRenderer\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport { EventRenderer } from \"./eventRenderer\";\r\n\r\nexport default class EventCollectSunlightRenderer extends EventRenderer<EventCollectSunlight> {\r\n  // private lightRays: LightRays;\r\n  private ffPoints: FireAndForgetPoints;\r\n\r\n  constructor(target: WorldRenderer) {\r\n    super(\"collect-sunlight\", target);\r\n    // this.lightRays = new LightRays();\r\n    // this.scene.add(this.lightRays.lineSegments);\r\n    const duration = 0.5;\r\n    // t.magFilter = LinearFilter;\r\n    this.ffPoints = new FireAndForgetPoints(\r\n      (s) => {\r\n        if (s.time > duration) {\r\n          return false;\r\n        }\r\n        const t = clamp(s.time / duration, 0, 1);\r\n        s.alpha = polyEarlyUpDown(t);\r\n        s.size = polyEarlyUpDown(t);\r\n      },\r\n      {\r\n        color: new Color(\"white\"),\r\n        opacity: 0.8,\r\n        size: 35,\r\n        map: textureFromSpritesheet(0, 4),\r\n      }\r\n    );\r\n    this.ffPoints.renderOrder = 1;\r\n    this.scene.add(this.ffPoints);\r\n  }\r\n\r\n  handle(event: EventCollectSunlight) {\r\n    let { numSunlight, leaf, point } = event;\r\n    while (numSunlight > 0) {\r\n      // if numSunlight is 0.5, only show half the sunlight events\r\n      if (numSunlight < 1 && numSunlight < Math.random()) {\r\n        return;\r\n      }\r\n\r\n      let x = point == null ? leaf.pos.x + (Math.random() - 0.5) * 0.05 : point.x + randFloat(-0.1, 0.1);\r\n      let y = point == null ? leaf.pos.y + (Math.random() - 0.5) * 0.05 : point.y + randFloat(-0.1, 0.1);\r\n      const itr = this.worldRenderer.renderers.get(leaf) as InstancedTileRenderer;\r\n      if (itr) {\r\n        const randWaterPosition = itr.inventoryRenderer ? randElement(itr.inventoryRenderer.waters) : undefined;\r\n        x += randWaterPosition?.x ?? 0;\r\n        y += randWaterPosition?.y ?? 0;\r\n      }\r\n      this.ffPoints.fire({\r\n        x,\r\n        y,\r\n        z: 10,\r\n        size: 0,\r\n        alpha: 0,\r\n        info: 0,\r\n        // stagger with the shouldUpdate of Tile so they look more continuous\r\n        // time: Math.random() * (1 / 10),\r\n        time: 0,\r\n      });\r\n      numSunlight--;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n    this.ffPoints.update(1 / 30);\r\n    for (const event of this.target) {\r\n      this.handle(event);\r\n    }\r\n    // this.lightRays.update(1 / 30);\r\n    this.ffPoints.commitAll();\r\n  }\r\n\r\n  destroy() {\r\n    this.scene.remove(this.ffPoints);\r\n    // this.scene.remove(this.lightRays.lineSegments);\r\n  }\r\n}\r\n","export default function configure<T>(obj: T, callback: (obj: T) => void): T {\r\n  callback(obj);\r\n  return obj;\r\n}\r\n","import configure from \"common/configure\";\r\nimport { Color, Scene, Vector2 } from \"three\";\r\nimport { Inventory } from \"../../core/inventory\";\r\nimport { map } from \"../../math\";\r\nimport { Mito } from \"../mito/mito\";\r\nimport { textureFromSpritesheet } from \"../spritesheet\";\r\nimport { CommittablePoints, CommittablePointsParameters } from \"./committablePoints\";\r\nimport { Renderer } from \"./Renderer\";\r\n\r\n// default\r\nconst graphics = {\r\n  particlesPerWater: 1,\r\n  particleSize: 45,\r\n  particleRepelStrength: 0.003,\r\n};\r\n\r\n// woooow\r\n// const graphics = {\r\n//   particlesPerWater: 10,\r\n//   particleSize: 25,\r\n//   particleRepelStrength: 0.0005,\r\n// };\r\n\r\nexport const WATER_POINTS_PARAMS: CommittablePointsParameters = {\r\n  color: new Color(\"rgb(9, 12, 255)\"),\r\n  size: graphics.particleSize,\r\n  opacity: 0.75,\r\n};\r\n\r\nexport const SUGAR_POINTS_PARAMS: CommittablePointsParameters = {\r\n  color: new Color(\"yellow\"),\r\n  size: 85,\r\n  opacity: 0.9,\r\n  map: textureFromSpritesheet(2, 2, \"transparent\"),\r\n};\r\n\r\nexport class InventoryPoints {\r\n  public waters = configure(new CommittablePoints(20000, WATER_POINTS_PARAMS), (p) => (p.renderOrder = 1));\r\n\r\n  public sugars = configure(new CommittablePoints(20000, SUGAR_POINTS_PARAMS), (p) => (p.renderOrder = 1));\r\n\r\n  public startFrame() {\r\n    this.waters.startFrame();\r\n    this.sugars.startFrame();\r\n  }\r\n\r\n  public endFrame() {\r\n    this.waters.endFrame();\r\n    this.sugars.endFrame();\r\n  }\r\n}\r\n\r\n// we represent Resources as dots of certain colors.\r\nexport class InventoryRenderer extends Renderer<Inventory> {\r\n  public animationOffset = 0;\r\n\r\n  public waters: Vector2[] = [];\r\n\r\n  public sugars: Vector2[] = [];\r\n\r\n  constructor(target: Inventory, scene: Scene, mito: Mito, public particlePoints: InventoryPoints) {\r\n    super(target, scene, mito);\r\n    target.on(\"get\", this.handleGetResources);\r\n    target.on(\"give\", this.handleGiveResources);\r\n    target.on(\"add\", this.handleAddResources);\r\n\r\n    this.updateSugarAndWaterParticles();\r\n  }\r\n\r\n  public getCarrierPos() {\r\n    return this.target.carrier.pos;\r\n  }\r\n\r\n  private handleGetResources = (giver: Inventory) => {\r\n    this.updateSugarAndWaterParticles(giver);\r\n  };\r\n\r\n  private verifyArrayLengths() {\r\n    if (this.waters.length !== Math.ceil(this.target.water * graphics.particlesPerWater)) {\r\n      throw new Error(\r\n        \"water array lengths mismatch: \" + this.waters.length + \" should be \" + Math.ceil(this.target.water)\r\n      );\r\n    }\r\n    if (this.sugars.length !== Math.ceil(this.target.sugar)) {\r\n      throw new Error(\r\n        \"sugar array lengths mismatch: \" + this.sugars.length + \" should be \" + Math.ceil(this.target.sugar)\r\n      );\r\n    }\r\n  }\r\n\r\n  private handleGiveResources = () => {\r\n    this.updateSugarAndWaterParticles();\r\n  };\r\n\r\n  private handleAddResources = (water: number, sugar: number) => {\r\n    this.updateSugarAndWaterParticles();\r\n  };\r\n\r\n  private updateSugarAndWaterParticles(giver?: Inventory) {\r\n    this.updateParticlesArray(this.waters, this.target.water * graphics.particlesPerWater, giver);\r\n    this.updateParticlesArray(this.sugars, this.target.sugar, giver);\r\n    this.verifyArrayLengths();\r\n  }\r\n\r\n  private updateParticlesArray(particles: Vector2[], resource: number, giver?: Inventory) {\r\n    const wantedParticles = Math.ceil(resource);\r\n    while (particles.length < wantedParticles) {\r\n      // // see if we can find the giver's InventoryRenderer\r\n      // if (giver != null) {\r\n      //   const carrier = giver.carrier;\r\n      //   const carrierRenderer = this.mito.worldRenderer.getOrCreateRenderer(carrier as any);\r\n      //   if (carrierRenderer instanceof InstancedTileRenderer) {\r\n      //     const carrierInventoryRenderer = carrierRenderer.inventoryRenderer;\r\n      //     const\r\n      //   }\r\n      const v = giver != null ? giver.carrier.pos.clone().sub(this.getCarrierPos()) : newParticle();\r\n      v.x += (Math.random() - 0.5) * 0.1;\r\n      v.y += (Math.random() - 0.5) * 0.1;\r\n      particles.push(v);\r\n    }\r\n    if (particles.length > wantedParticles) {\r\n      // delete from the start - makes soil water feel\r\n      // more dynamic since every small movement shows an animation\r\n      // particles.splice(0, particles.length - wantedParticles);\r\n\r\n      // delete from the end:\r\n      // otherwise going from 2.1 -> 2 water looks broken\r\n      // (the size 0.1 water suddenly becomes the size 1 water)\r\n      // makes soil water feel much more static\r\n      particles.splice(wantedParticles);\r\n    }\r\n    if (particles.length !== wantedParticles) {\r\n      throw new Error(\"array lengths mismatch: \" + particles.length + \" should be \" + wantedParticles);\r\n    }\r\n    return particles;\r\n  }\r\n\r\n  private commitParticles(particles: CommittablePoints, resource: number, resourceArray: Vector2[]) {\r\n    // this.verifyArrayLengths();\r\n    const numFullSizedParticles = Math.floor(resource);\r\n    for (let i = 0; i < numFullSizedParticles; i++) {\r\n      const p = resourceArray[i];\r\n      particles.commit(p.x + this.getCarrierPos().x, p.y + this.getCarrierPos().y, 10, 1, 1);\r\n    }\r\n    const fract = resource - numFullSizedParticles;\r\n    if (fract > 0) {\r\n      const p = resourceArray[resourceArray.length - 1];\r\n      particles.commit(\r\n        p.x + this.getCarrierPos().x,\r\n        p.y + this.getCarrierPos().y,\r\n        10,\r\n        map(Math.sqrt(fract), 0, 1, 0.2, 1),\r\n        1\r\n      );\r\n    }\r\n  }\r\n\r\n  private simulationT = 0;\r\n\r\n  private simulateResourcePositions() {\r\n    const numWaters = this.waters.length;\r\n    const numResources = numWaters + this.sugars.length;\r\n    // 16 ms\r\n    this.simulationT += 0.0166667;\r\n    const basePushAngle = this.simulationT / 3 + this.animationOffset;\r\n    const basePushForceX = Math.cos(basePushAngle) * 0.02;\r\n    for (let i = 0; i < numResources; i++) {\r\n      const resource = i < numWaters ? this.waters[i] : this.sugars[i - numWaters];\r\n      let vx = 0,\r\n        vy = 0;\r\n\r\n      vx += basePushForceX;\r\n\r\n      const goTowardsCenterStrength = 0.1 + resource.length() * 0.1;\r\n      vx += -resource.x * goTowardsCenterStrength;\r\n      vy += -resource.y * goTowardsCenterStrength;\r\n\r\n      // vx += -((r.x * 2) ** 1) * 0.2;\r\n      // vy += -((r.y * 2) ** 3) * 0.1;\r\n      const player = this.mito.world.player;\r\n      if (player.pos.equals(this.target.carrier.pos)) {\r\n        const playerX = player.posFloat.x - player.pos.x;\r\n        const playerY = player.posFloat.y - player.pos.y;\r\n        const offsetX = resource.x - playerX;\r\n        const offsetY = resource.y - playerY;\r\n        const mag2 = offsetX * offsetX + offsetY * offsetY;\r\n        const avoidPlayerStrength = Math.max(Math.min(map(mag2, 0, 1, 3, -5), 3), 0);\r\n        const accelerationX = offsetX * avoidPlayerStrength * 0.2;\r\n        const accelerationY = offsetY * avoidPlayerStrength * 0.2;\r\n        vx += accelerationX;\r\n        vy += accelerationY;\r\n      }\r\n      for (let j = 0; j < numResources; j++) {\r\n        const otherResource = j < numWaters ? this.waters[j] : this.sugars[j - numWaters];\r\n        if (resource === otherResource) {\r\n          break;\r\n        }\r\n        const dx = resource.x - otherResource.x;\r\n        const dy = resource.y - otherResource.y;\r\n        const lengthSq = dx * dx + dy * dy;\r\n        if (lengthSq > 0) {\r\n          // is the other resource a fractional resource\r\n          // true if j is at the last index of the waters, and there is a fractional water,\r\n          // or if j is at the last index of the sugars, and there is a fractional sugar\r\n          const fraction = j < numWaters ? this.target.water % 1 : this.target.sugar % 1;\r\n          const isAtLastResourceOfType = j === numWaters || j === numResources;\r\n          const isOtherResourceFractional = isAtLastResourceOfType && fraction !== 0;\r\n          let strength = graphics.particleRepelStrength / lengthSq; // + graphics.particleRepelStrength / Math.sqrt(lengthSq);\r\n          if (isOtherResourceFractional) {\r\n            strength *= fraction;\r\n          }\r\n          vx += dx * strength;\r\n          vy += dy * strength;\r\n        }\r\n      }\r\n      resource.x += vx;\r\n      resource.y += vy;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    if (this.isProbablyVisible()) {\r\n      this.simulateResourcePositions();\r\n      this.commitParticles(this.particlePoints.waters, this.target.water * graphics.particlesPerWater, this.waters);\r\n      this.commitParticles(this.particlePoints.sugars, this.target.sugar, this.sugars);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return true if this carrier's pos is within 100px of the screen.\r\n   */\r\n  public isProbablyVisible() {\r\n    // 100px buffer\r\n    const buffer = 100;\r\n    const screenPos = this.mito.worldToScreen(this.getCarrierPos());\r\n    const isVisible =\r\n      screenPos.x >= -buffer &&\r\n      screenPos.y >= -buffer &&\r\n      screenPos.x <= this.mito.canvas.width + buffer &&\r\n      screenPos.y <= this.mito.canvas.height + buffer;\r\n    return isVisible;\r\n  }\r\n\r\n  destroy() {\r\n    this.target.off(\"get\", this.handleGetResources);\r\n    this.target.off(\"give\", this.handleGiveResources);\r\n    this.target.off(\"add\", this.handleAddResources);\r\n  }\r\n\r\n  /**\r\n   * Stores the position of the fractional sugar in the last update.\r\n   * This is used by other renderers to position e.g. eat effects directly\r\n   * on the particle.\r\n   */\r\n  public getActiveSugar() {\r\n    return this.sugars[this.sugars.length - 1];\r\n  }\r\n\r\n  /**\r\n   * See getActiveSugar(), but this returns the \"oldest\" water.\r\n   */\r\n  public getStableWater() {\r\n    return this.waters[0];\r\n  }\r\n}\r\n\r\nfunction newParticle() {\r\n  return new Vector2((Math.random() - 0.5) * 0.01, (Math.random() - 0.5) * 0.01);\r\n}\r\n","import { EventEvaporation } from \"core/tile/tileEvent\";\r\nimport { FireAndForgetPoints } from \"../fireAndForgetPoints\";\r\nimport { WATER_POINTS_PARAMS } from \"../InventoryRenderer\";\r\nimport { InstancedTileRenderer } from \"../tile/InstancedTileRenderer\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport { EventRendererFFPoints } from \"./eventRendererFFPoints\";\r\n\r\nexport default class EventEvaporationRenderer extends EventRendererFFPoints<EventEvaporation> {\r\n  static makePoints() {\r\n    const duration = 1.5;\r\n    return new FireAndForgetPoints<EventEvaporation>(\r\n      (s) => {\r\n        if (s.time > duration) {\r\n          return false;\r\n        }\r\n        const t = s.time / duration;\r\n        const size = 1 + t;\r\n        const alpha = 1 - t;\r\n\r\n        s.x += Math.sin(t * 12) * 0.01;\r\n        s.y -= 0.01;\r\n        s.alpha = alpha;\r\n        s.size = size;\r\n      },\r\n      { ...WATER_POINTS_PARAMS }\r\n    );\r\n  }\r\n\r\n  constructor(target: WorldRenderer) {\r\n    super(\"evaporation\", target, EventEvaporationRenderer.makePoints());\r\n  }\r\n\r\n  handle(event: EventEvaporation) {\r\n    if (event.tile.darkness >= 1) {\r\n      return;\r\n    }\r\n    const tileRenderer = this.worldRenderer.renderers.get(event.tile) as InstancedTileRenderer | null;\r\n    const stableWater = tileRenderer?.inventoryRenderer?.getStableWater();\r\n    const dX = stableWater?.x ?? 0;\r\n    const dY = stableWater?.y ?? 0;\r\n    this.ffPoints.fire({\r\n      x: event.tile.pos.x + dX,\r\n      y: event.tile.pos.y + dY,\r\n      z: 1,\r\n      size: 1,\r\n      alpha: 1,\r\n      info: event,\r\n      time: 0,\r\n    });\r\n  }\r\n}\r\n","import { EventGrowFruit } from \"core/tile/tileEvent\";\r\nimport { easeCubicIn } from \"d3-ease\";\r\nimport { textureFromSpritesheet } from \"game/spritesheet\";\r\nimport { map } from \"math\";\r\nimport { polyUpDown, smoothstep } from \"math/easing\";\r\nimport { Color } from \"three\";\r\nimport { FireAndForgetPoints } from \"../fireAndForgetPoints\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport { EventRendererFFPoints } from \"./eventRendererFFPoints\";\r\n\r\nexport default class EventGrowFruitRenderer extends EventRendererFFPoints<EventGrowFruit> {\r\n  static makePoints() {\r\n    const duration = 1.2;\r\n    // const duration = 25;\r\n    return new FireAndForgetPoints(\r\n      (s) => {\r\n        if (s.time > duration) {\r\n          return false;\r\n        }\r\n        const t = s.time / duration;\r\n\r\n        const { cell, a0 } = s.info;\r\n        const dist = map(easeCubicIn(t), 0, 1, 0.7, 0.2);\r\n        const angle = map(smoothstep(t), 0, 1, 0, Math.PI * 0.0) + a0;\r\n        const size = Math.sqrt(polyUpDown(t));\r\n        s.x = cell.pos.x + Math.cos(angle) * dist;\r\n        s.y = cell.pos.y + Math.sin(angle) * dist;\r\n        s.size = size;\r\n        s.r = angle;\r\n      },\r\n      {\r\n        size: 80,\r\n        opacity: 1,\r\n        color: new Color(\"white\"),\r\n        map: textureFromSpritesheet(0, 5),\r\n      }\r\n    );\r\n  }\r\n\r\n  constructor(target: WorldRenderer) {\r\n    super(\"grow-fruit\", target, EventGrowFruitRenderer.makePoints());\r\n  }\r\n\r\n  handle(event: EventGrowFruit) {\r\n    const { cell } = event;\r\n\r\n    this.ffPoints.fire({\r\n      x: cell.pos.x,\r\n      y: cell.pos.y,\r\n      z: 1,\r\n      alpha: 1,\r\n      info: { ...event, a0: Math.random() * Math.PI * 2 },\r\n      size: 0,\r\n      time: 0,\r\n    });\r\n  }\r\n}\r\n","import { EventPhotosynthesis } from \"core/tile/tileEvent\";\r\nimport { textureFromSpritesheet } from \"game/spritesheet\";\r\nimport { polyUpDown } from \"math/easing\";\r\nimport { Color } from \"three\";\r\nimport { FireAndForgetPoints } from \"../fireAndForgetPoints\";\r\nimport { InstancedTileRenderer } from \"../tile/InstancedTileRenderer\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport { EventRendererFFPoints } from \"./eventRendererFFPoints\";\r\n\r\nexport default class EventPhotosynthesisRenderer extends EventRendererFFPoints<EventPhotosynthesis> {\r\n  static makePoints() {\r\n    const duration = 0.5;\r\n    return new FireAndForgetPoints<EventPhotosynthesis>(\r\n      (s) => {\r\n        if (s.time > duration) {\r\n          return false;\r\n        }\r\n        const t = s.time / duration;\r\n\r\n        s.alpha = polyUpDown(t) ** (1 / 4);\r\n        s.size = ((1 - t) ** 1 / 2) * 2 * s.info.sugarMade;\r\n        s.r = t * s.time;\r\n      },\r\n      {\r\n        color: new Color(\"yellow\"),\r\n        opacity: 0.95,\r\n        size: 200,\r\n        map: textureFromSpritesheet(3, 3),\r\n      }\r\n    );\r\n  }\r\n\r\n  constructor(target: WorldRenderer) {\r\n    super(\"photosynthesis\", target, EventPhotosynthesisRenderer.makePoints());\r\n  }\r\n\r\n  handle(event: EventPhotosynthesis) {\r\n    const tileRenderer = this.worldRenderer.renderers.get(event.cell) as InstancedTileRenderer | null;\r\n    const stableWater = tileRenderer?.inventoryRenderer?.getStableWater();\r\n    const dX = stableWater?.x ?? 0;\r\n    const dY = stableWater?.y ?? 0;\r\n    this.ffPoints.fire({\r\n      x: event.cell.pos.x + dX,\r\n      y: event.cell.pos.y + dY,\r\n      z: 1,\r\n      size: 1,\r\n      alpha: 1,\r\n      info: event,\r\n      time: 0,\r\n    });\r\n  }\r\n}\r\n","import { CancerEffect } from \"core/cell/cellEffect\";\r\nimport { clamp, lerp, randFloat } from \"math\";\r\nimport { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry, RingBufferGeometry, Scene } from \"three\";\r\nimport { Cell, CellEffect, FreezeEffect } from \"../../../core/tile\";\r\nimport Mito from \"../../mito/mito\";\r\nimport { textureFromSpritesheet } from \"../../spritesheet\";\r\nimport { Renderer } from \"../Renderer\";\r\n\r\nexport class CellEffectsRenderer extends Renderer<Cell> {\r\n  private renderers: Renderer<CellEffect>[] = [];\r\n\r\n  update() {\r\n    // account for if target has more effects\r\n    let index;\r\n    for (index = 0; index < this.target.effects.length; index++) {\r\n      const effect = this.target.effects[index];\r\n      const renderer = this.renderers[index];\r\n      if (renderer == null) {\r\n        this.renderers[index] = createEffectRenderer(effect, this.scene, this.mito);\r\n      } else if (effect !== renderer.target) {\r\n        // delete and add new renderer\r\n        renderer.destroy();\r\n        this.renderers[index] = createEffectRenderer(effect, this.scene, this.mito);\r\n      }\r\n    }\r\n    // delete extraneous effects\r\n    for (; index < this.renderers.length; index++) {\r\n      const renderer = this.renderers[index];\r\n      renderer.destroy();\r\n    }\r\n\r\n    for (const r of this.renderers) {\r\n      r.update();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    for (const r of this.renderers) {\r\n      r.destroy();\r\n    }\r\n  }\r\n}\r\n\r\nfunction createEffectRenderer<T extends CellEffect>(effect: T, scene: Scene, mito: Mito): Renderer<CellEffect> {\r\n  if (effect instanceof FreezeEffect) {\r\n    return new FreezeEffectRenderer(effect, scene, mito);\r\n  } else if (effect instanceof CancerEffect) {\r\n    return new CancerEffectRenderer(effect, scene, mito);\r\n  } else {\r\n    throw new Error(\"effect renderer not defined for\" + effect);\r\n  }\r\n}\r\n\r\n// export const FREEZE_BLUE = new Color(\"#1E90FF\").lerp(new Color(0), 0.5);\r\nexport const FREEZE_BLUE = new Color(\"lightblue\");\r\n\r\nclass FreezeEffectRenderer extends Renderer<FreezeEffect> {\r\n  static newMesh = (() => {\r\n    const g = new PlaneBufferGeometry(1, 1);\r\n    const material = new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(1, 2),\r\n      side: DoubleSide,\r\n      color: FREEZE_BLUE,\r\n      transparent: true,\r\n      opacity: 0.5,\r\n    });\r\n    const mesh = new Mesh(g, material);\r\n    return () => mesh.clone();\r\n  })();\r\n\r\n  private mesh: Mesh;\r\n\r\n  constructor(target: FreezeEffect, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    this.mesh = FreezeEffectRenderer.newMesh();\r\n    scene.add(this.mesh);\r\n    this.mesh.scale.set(0.01, 0.01, 1);\r\n  }\r\n\r\n  update() {\r\n    const percentFrozen = this.target.percentFrozen;\r\n    const s = percentFrozen ** 0.5;\r\n    this.mesh.scale.x = lerp(this.mesh.scale.x, s, 0.2);\r\n    this.mesh.scale.y = lerp(this.mesh.scale.y, s, 0.2);\r\n    const cell = this.target.cell;\r\n    const pos = cell.pos;\r\n    this.mesh.position.set(pos.x, pos.y + cell.droopY, 2);\r\n  }\r\n\r\n  destroy() {\r\n    this.scene.remove(this.mesh);\r\n  }\r\n}\r\n\r\nclass CancerEffectRenderer extends Renderer<CancerEffect> {\r\n  static newMesh = (() => {\r\n    // const g = new PlaneBufferGeometry(1, 1);\r\n    const g = new RingBufferGeometry(0.1, 0.5, 20, 20);\r\n    const material = new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(0, 1),\r\n      side: DoubleSide,\r\n      color: new Color(0xbe29ec),\r\n    });\r\n    const mesh = new Mesh(g, material);\r\n    mesh.position.z = 3;\r\n    return () => mesh.clone();\r\n  })();\r\n\r\n  private mesh: Mesh;\r\n\r\n  private lastTimeToDuplicate: number;\r\n\r\n  constructor(target: CancerEffect, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    this.mesh = CancerEffectRenderer.newMesh();\r\n    scene.add(this.mesh);\r\n    this.mesh.scale.set(0.01, 0.01, 1);\r\n    this.lastTimeToDuplicate = this.target.timeToDuplicate;\r\n  }\r\n\r\n  update() {\r\n    const { timeToDuplicate, secondsPerDuplication } = this.target;\r\n    const s = clamp((1 - timeToDuplicate / secondsPerDuplication) ** 0.5, 0.05, 1);\r\n    this.mesh.scale.x = lerp(this.mesh.scale.x, s, 0.2);\r\n    this.mesh.scale.y = lerp(this.mesh.scale.y, s, 0.2);\r\n    const cell = this.target.cell;\r\n    let pos = cell.pos;\r\n    const isBeingTreated = timeToDuplicate > this.lastTimeToDuplicate;\r\n    if (isBeingTreated) {\r\n      pos = pos.clone();\r\n      pos.x += randFloat(-0.1, 0.1);\r\n      pos.y += randFloat(-0.1, 0.1);\r\n    }\r\n    this.mesh.position.set(pos.x, pos.y + cell.droopY, 2);\r\n    this.lastTimeToDuplicate = timeToDuplicate;\r\n  }\r\n\r\n  destroy() {\r\n    this.scene.remove(this.mesh);\r\n  }\r\n}\r\n","import { EventThawIce } from \"core/tile/tileEvent\";\r\nimport { easeSinOut } from \"d3-ease\";\r\nimport { map } from \"math\";\r\nimport { FireAndForgetPoints } from \"../fireAndForgetPoints\";\r\nimport { FREEZE_BLUE } from \"../tile/CellEffectsRenderer\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport { EventRendererFFPoints } from \"./eventRendererFFPoints\";\r\n\r\nexport default class EventThawIceRenderer extends EventRendererFFPoints<EventThawIce> {\r\n  static makePoints() {\r\n    const duration = 0.6;\r\n    return new FireAndForgetPoints(\r\n      (s, dt) => {\r\n        if (s.time > duration) {\r\n          return false;\r\n        }\r\n        const t = s.time / duration;\r\n        const { dx, dy } = s.info;\r\n        s.x += dx * dt;\r\n        s.y += dy * dt;\r\n        s.alpha = t < 0.75 ? 1 : easeSinOut(map(t, 0.75, 1, 1, 0));\r\n      },\r\n      {\r\n        size: 40,\r\n        opacity: 0.5,\r\n        color: FREEZE_BLUE,\r\n      }\r\n    );\r\n  }\r\n\r\n  constructor(target: WorldRenderer) {\r\n    super(\"thaw\", target, EventThawIceRenderer.makePoints());\r\n  }\r\n\r\n  handle(event: EventThawIce) {\r\n    const { where } = event;\r\n\r\n    for (let i = 0; i < 4; i++) {\r\n      const angle = Math.random() * Math.PI * 2;\r\n      const speed = 1;\r\n      const dx = Math.cos(angle) * speed;\r\n      const dy = Math.sin(angle) * speed;\r\n      this.ffPoints.fire({\r\n        x: where.pos.x,\r\n        y: where.pos.y,\r\n        z: 1,\r\n        alpha: 1,\r\n        info: { dx, dy },\r\n        size: map(Math.random(), 0, 1, 0.5, 1.5),\r\n        time: 0,\r\n        r: angle,\r\n      });\r\n    }\r\n  }\r\n}\r\n","import { TileEvent, TileEventType } from \"../../../core/tile/tileEvent\";\r\nimport { Renderer } from \"../Renderer\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport EventCellEatRenderer from \"./eventCellEatRenderer\";\r\nimport EventCellTransferEnergyRenderer from \"./eventCellTransferEnergyRenderer\";\r\nimport EventCollectSunlightRenderer from \"./eventCollectSunlightRenderer\";\r\nimport EventEvaporationRenderer from \"./eventEvaporationRenderer\";\r\nimport EventGrowFruitRenderer from \"./eventGrowFruitRenderer\";\r\nimport EventPhotosynthesisRenderer from \"./eventPhotosynthesisRenderer\";\r\nimport { EventRenderer } from \"./eventRenderer\";\r\nimport EventThawIceRenderer from \"./eventThawIceRenderer\";\r\n\r\nexport class EventLogRenderer extends Renderer<WorldRenderer> {\r\n  private singleEventRenderers = {\r\n    \"cell-eat\": new EventCellEatRenderer(this.target),\r\n    \"cell-transfer-energy\": new EventCellTransferEnergyRenderer(this.target),\r\n    evaporation: new EventEvaporationRenderer(this.target),\r\n    photosynthesis: new EventPhotosynthesisRenderer(this.target),\r\n    thaw: new EventThawIceRenderer(this.target),\r\n    \"collect-sunlight\": new EventCollectSunlightRenderer(this.target),\r\n    \"grow-fruit\": new EventGrowFruitRenderer(this.target),\r\n  } as { [K in TileEventType]?: EventRenderer<Extract<TileEvent, { type: K }>> };\r\n\r\n  constructor(worldRenderer: WorldRenderer) {\r\n    super(worldRenderer, worldRenderer.scene, worldRenderer.mito);\r\n  }\r\n\r\n  update() {\r\n    const events = this.target.target.getLastStepStats().events;\r\n    let eventName: TileEventType;\r\n    for (eventName in events) {\r\n      const renderer = this.singleEventRenderers[eventName];\r\n      if (renderer != null) {\r\n        renderer.update();\r\n      }\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    for (const renderer of Object.values(this.singleEventRenderers)) {\r\n      if (renderer != null) {\r\n        renderer.destroy();\r\n      }\r\n    }\r\n  }\r\n}\r\n","import Ticker from \"std/ticker\";\r\n\r\nexport type Animation = (t: number, dt: number) => boolean;\r\n\r\nexport class AnimationController {\r\n  public animation?: Animation;\r\n\r\n  timeStarted?: number;\r\n\r\n  timeLastUpdated?: number;\r\n\r\n  set(a: Animation) {\r\n    this.animation = a;\r\n    this.timeLastUpdated = this.timeStarted = Ticker.now / 1000;\r\n  }\r\n\r\n  update() {\r\n    if (this.animation != null && this.timeStarted != null && this.timeLastUpdated != null) {\r\n      const now = Ticker.now / 1000;\r\n      const t = now - this.timeStarted;\r\n      const dt = now - this.timeLastUpdated;\r\n      const ended = this.animation(t, dt);\r\n      this.timeLastUpdated = now;\r\n      if (ended) {\r\n        this.animation = undefined;\r\n        this.timeStarted = undefined;\r\n        this.timeLastUpdated = undefined;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Sequence animations after each other.\r\n */\r\nexport function chain(...animations: Animation[]): Animation {\r\n  let numEnded = 0;\r\n  let lastStarted = 0;\r\n  return (t, dt) => {\r\n    const currAnimation = animations[numEnded];\r\n    const ended = currAnimation(t - lastStarted, dt);\r\n    if (ended) {\r\n      numEnded++;\r\n      lastStarted = t;\r\n    }\r\n    return numEnded >= animations.length;\r\n  };\r\n}\r\n\r\n/**\r\n * Do both animations at once; end when first one ends.\r\n */\r\nexport function also(firstAnim: Animation, secondAnim: Animation): Animation {\r\n  let secondEnded = false;\r\n  return (t, dt) => {\r\n    const firstEnded = firstAnim(t, dt);\r\n    if (!secondEnded) {\r\n      secondEnded = secondAnim(t, dt);\r\n    }\r\n\r\n    return firstEnded;\r\n  };\r\n}\r\n\r\nexport function animPause(time: number): Animation {\r\n  return (t) => {\r\n    return t > time;\r\n  };\r\n}\r\n","import { Insect } from \"core/insect\";\r\nimport { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry, Scene } from \"three\";\r\nimport { lerp2 } from \"../../math\";\r\nimport { Mito } from \"../mito/mito\";\r\nimport { textureFromSpritesheet } from \"../spritesheet\";\r\nimport { InventoryRenderer } from \"./InventoryRenderer\";\r\nimport { Renderer } from \"./Renderer\";\r\nimport { AnimationController } from \"./tile/Animation\";\r\n\r\nexport class InsectRenderer extends Renderer<Insect> {\r\n  public mesh: Mesh;\r\n\r\n  protected animation = new AnimationController();\r\n\r\n  public inventoryRenderer?: InventoryRenderer;\r\n\r\n  constructor(target: Insect, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    this.mesh = newMesh();\r\n    this.mesh.name = \"Insect Mesh\";\r\n    lerp2(this.mesh.position, this.target.pos, 1);\r\n    this.mesh.position.z = 1;\r\n    this.scene.add(this.mesh);\r\n\r\n    if (mito.worldRenderer.inventoryPoints) {\r\n      this.inventoryRenderer = new (class extends InventoryRenderer {\r\n        getCarrierPos() {\r\n          return target.posFloat;\r\n        }\r\n      })(this.target.inventory, this.scene, this.mito, mito.worldRenderer.inventoryPoints);\r\n      this.inventoryRenderer.animationOffset = (this.target.pos.x + this.target.pos.y) / 2;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    const pos = this.target.posFloat.clone();\r\n    this.mesh.position.set(pos.x, pos.y, 2);\r\n    this.animation.update();\r\n    this.inventoryRenderer?.update();\r\n  }\r\n\r\n  destroy() {\r\n    this.scene.remove(this.mesh);\r\n    this.inventoryRenderer?.destroy();\r\n  }\r\n}\r\n\r\nfunction newMesh() {\r\n  const m = new Mesh(\r\n    new PlaneBufferGeometry(1, 1),\r\n    new MeshBasicMaterial({\r\n      transparent: true,\r\n      map: textureFromSpritesheet(0, 7, \"transparent\"),\r\n      color: new Color(\"white\"),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n  return m;\r\n}\r\n","import classNames from \"classnames\";\r\nimport DynamicNumber from \"game/ui/common/DynamicNumber\";\r\nimport * as React from \"react\";\r\nimport { ResourceIcon } from \"../common/ResourceIcon\";\r\nimport \"./InventoryBar.scss\";\r\n\r\nexport const InventoryBar: React.FC<{\r\n  water: number;\r\n  sugar: number;\r\n  capacity: number;\r\n  format: \"text\" | \"icons\";\r\n  colored?: boolean;\r\n  capacityBasedWidth?: boolean;\r\n  className?: string;\r\n  showBar?: boolean;\r\n}> = React.memo(({ water, sugar, capacity, className, colored = true, showBar = true, format, capacityBasedWidth }) => {\r\n  if (capacity === 0) {\r\n    return null;\r\n  }\r\n  const waterPercent = water / capacity;\r\n  const sugarPercent = sugar / capacity;\r\n  const emptyPercent = 1 - (water + sugar) / capacity;\r\n  const waterStyles: React.CSSProperties = {\r\n    width: `${waterPercent * 100}%`,\r\n  };\r\n  const sugarStyles: React.CSSProperties = {\r\n    width: `${sugarPercent * 100}%`,\r\n  };\r\n  const emptyStyles: React.CSSProperties = {\r\n    width: `${emptyPercent * 100}%`,\r\n  };\r\n  const textElements =\r\n    format === \"text\" ? (\r\n      <>\r\n        <span className=\"text water\">\r\n          <DynamicNumber speed={0.5} value={water} /> water\r\n        </span>\r\n        &nbsp;\r\n        <span className=\"text sugar\">\r\n          <DynamicNumber speed={0.5} value={sugar} /> sugar\r\n        </span>\r\n      </>\r\n    ) : (\r\n      <>\r\n        {water !== 0 || (water === 0 && sugar === 0) ? (\r\n          <span className=\"text water\">\r\n            {/* {sugar > 0 ? <ResourceIcon name=\"water\" /> : null} <DynamicNumber speed={0.5} value={water} /> */}\r\n            <ResourceIcon name=\"water\" /> <DynamicNumber speed={0.5} value={water} />\r\n          </span>\r\n        ) : null}\r\n        {sugar !== 0 ? (\r\n          <span className=\"text sugar\">\r\n            <ResourceIcon name=\"sugar\" /> <DynamicNumber speed={0.5} value={sugar} />\r\n          </span>\r\n        ) : null}\r\n      </>\r\n    );\r\n\r\n  const barStyles: React.CSSProperties = {\r\n    width: capacityBasedWidth ? 10 * capacity : undefined,\r\n  };\r\n\r\n  return (\r\n    <div className={classNames(\"inventory-bar-container\", className)}>\r\n      {showBar ? (\r\n        <div className=\"inventory-bar\" style={barStyles}>\r\n          <div style={waterStyles} className=\"bar-water\"></div>\r\n          <div style={sugarStyles} className=\"bar-sugar\"></div>\r\n          <div style={emptyStyles} className=\"bar-empty\"></div>\r\n          {capacityBasedWidth ? <div className=\"markers\" /> : null}\r\n        </div>\r\n      ) : null}\r\n      <div className={classNames(\"inventory-text\", { colored })}>{textElements}</div>\r\n    </div>\r\n  );\r\n});\r\n","import { lerp, lerp2 } from \"math\";\r\nimport { arrayRange } from \"math/arrays\";\r\nimport {\r\n  CircleBufferGeometry,\r\n  DoubleSide,\r\n  Geometry,\r\n  Line,\r\n  LineBasicMaterial,\r\n  Mesh,\r\n  MeshBasicMaterial,\r\n  Object3D,\r\n  Vector2,\r\n} from \"three\";\r\n\r\nexport const playerBrown = 0x8f673f;\r\nexport const playerTeal = 0x5eb780;\r\nexport const darkPink = 0x8c4b7a;\r\n\r\nconst baseMesh = (() => {\r\n  const geometry = new CircleBufferGeometry(0.07, 20);\r\n  const material = new MeshBasicMaterial({\r\n    color: playerTeal,\r\n    // color: ,\r\n    side: DoubleSide,\r\n  });\r\n  const mesh = new Mesh(geometry, material);\r\n  return mesh;\r\n})();\r\n\r\nclass Node {\r\n  constructor(public pos: Vector2, public vel: Vector2 = new Vector2(0, 0), public scale = 1) {}\r\n}\r\n/**\r\n * For now: A thick line that branches out into 3 nodes.\r\n *\r\n * Should have a physics-y feel to it (maybe bones?)\r\n * Be UV-able\r\n */\r\nclass NeuronMesh extends Object3D {\r\n  // const geom = new LineGeometry();\r\n  // geom.setPositions([0, 0, 0, 1, 0, 0]);\r\n  // geom.setColors([1, 1, 1, 1, 0, 0]);\r\n  // const mat = new LineMaterial({\r\n  //   color: 0xffffff,\r\n  //   linewidth: 5,\r\n  //   vertexColors: VertexColors,\r\n  //   dashed: false,\r\n  // });\r\n  // mat.resolution.set(window.innerWidth, window.innerHeight);\r\n\r\n  // const line = new Line2(geom, mat);\r\n  // line.computeLineDistances();\r\n  // line.scale.set(1, 1, 1);\r\n  // return line;\r\n\r\n  public nodes: Node[] = [];\r\n\r\n  public meshes: Mesh[] = [];\r\n\r\n  public line: Line;\r\n\r\n  constructor(numNodes: number) {\r\n    super();\r\n    this.nodes = arrayRange(numNodes).map((i) => {\r\n      return new Node(new Vector2(i / numNodes, 0));\r\n    });\r\n    this.meshes = this.nodes.map((n) => {\r\n      const m = baseMesh.clone();\r\n      m.position.set(n.pos.x, n.pos.y, m.position.z);\r\n      return m;\r\n    });\r\n    this.add(...this.meshes);\r\n    const lineGeo = new Geometry();\r\n    lineGeo.vertices.push(...this.meshes.map((m) => m.position));\r\n    this.line = new Line(\r\n      lineGeo,\r\n      new LineBasicMaterial({\r\n        color: playerTeal,\r\n      })\r\n    );\r\n    this.add(this.line);\r\n    // const r1 = new Mesh(\r\n    //   new PlaneBufferGeometry(0.7, 0.1).translate(0.35, 0, 0),\r\n    //   new MeshBasicMaterial({ side: DoubleSide, color: 0x8f673f })\r\n    // );\r\n    // const branchLeft = new Mesh(\r\n    //   new PlaneBufferGeometry(0.3, 0.05).translate(0.15, 0, 0),\r\n    //   new MeshBasicMaterial({ side: DoubleSide, color: 0x5eb780 })\r\n    // );\r\n    // branchLeft.position.set(0.35, 0, 0);\r\n    // const branchCenter = branchLeft.clone();\r\n    // const branchRight = branchLeft.clone();\r\n    // branchLeft.rotation.z = -Math.PI / 3;\r\n    // branchRight.rotation.z = Math.PI / 3;\r\n\r\n    // r1.add(branchLeft, branchCenter, branchRight);\r\n    // this.add(r1);\r\n\r\n    // const gui = new GUI();\r\n    // gui.add(this, \"pullForceScalar\", 0, 100);\r\n    // gui.add(this, \"towardsTargetForce\", 0, 100);\r\n    // gui.add(this, \"dragForceScalar\", -100, -0);\r\n  }\r\n\r\n  public setColor(color: number) {\r\n    const mat = this.line.material as LineBasicMaterial;\r\n    const oldColor = mat.color;\r\n    if (color !== oldColor.getHex()) {\r\n      for (const mesh of this.meshes) {\r\n        const meshMaterial = mesh.material as MeshBasicMaterial;\r\n        meshMaterial.color.set(color);\r\n        meshMaterial.needsUpdate = true;\r\n      }\r\n      mat.color.set(color);\r\n      mat.needsUpdate = true;\r\n    }\r\n  }\r\n\r\n  public handleInteracted() {\r\n    const last = this.nodes[this.nodes.length - 1];\r\n    last.scale = 2.1;\r\n  }\r\n\r\n  private pullForceScalar = 10;\r\n\r\n  private towardsTargetForce = 5;\r\n\r\n  private dragForceScalar = -3;\r\n\r\n  update(dt: number, target: Vector2) {\r\n    // node 0 is always tied to 0, 0\r\n    // node n is tied directly at target\r\n    // intermediate nodes move towards their targets\r\n    // const first = this.nodes[0];\r\n    const last = this.nodes[this.nodes.length - 1];\r\n    lerp2(last.pos, target, 0.5);\r\n    let force = new Vector2();\r\n    for (let i = 1; i < this.nodes.length - 1; i++) {\r\n      force.set(0, 0);\r\n\r\n      const node = this.nodes[i];\r\n      const prev = this.nodes[i - 1];\r\n      const next = this.nodes[i + 1];\r\n\r\n      // prev force\r\n      force.add(this.pullForce(node, prev, this.pullForceScalar));\r\n      force.add(this.pullForce(node, next, this.pullForceScalar));\r\n      force.add(this.goTowardsTargetForce(node, target, i / (this.nodes.length - 1), this.towardsTargetForce));\r\n      force.add(this.dragForce(node, this.dragForceScalar));\r\n\r\n      node.scale = lerp(node.scale, next.scale, 0.5);\r\n\r\n      node.vel.add(force.multiplyScalar(dt));\r\n    }\r\n\r\n    this.nodes.forEach((node, i) => {\r\n      node.pos.x += node.vel.x * dt;\r\n      node.pos.y += node.vel.y * dt;\r\n      const mesh = this.meshes[i];\r\n      mesh.position.set(node.pos.x, node.pos.y, mesh.position.z);\r\n      mesh.scale.set(node.scale, node.scale, 1);\r\n    });\r\n    last.scale = lerp(last.scale, 1, 0.5);\r\n    (this.line.geometry as Geometry).verticesNeedUpdate = true;\r\n  }\r\n\r\n  goTowardsTargetForce = (() => {\r\n    const offset = new Vector2();\r\n    return (node: Node, target: Vector2, percent: number, pow: number) => {\r\n      offset\r\n        .copy(target)\r\n        .multiplyScalar(percent)\r\n        .sub(node.pos);\r\n      return offset.multiplyScalar(pow);\r\n    };\r\n  })();\r\n\r\n  dragForce = (() => {\r\n    const drag = new Vector2();\r\n    return (node: Node, pow: number) => {\r\n      drag.copy(node.vel).multiplyScalar(pow);\r\n      return drag;\r\n    };\r\n  })();\r\n\r\n  private pullForce = (() => {\r\n    const offset = new Vector2();\r\n    return (node: Node, other: Node, pow: number) => {\r\n      offset.copy(node.pos).sub(other.pos);\r\n      return offset.multiplyScalar(-pow);\r\n    };\r\n  })();\r\n}\r\n\r\nexport default NeuronMesh;\r\n","import { sleep } from \"common/promise\";\r\nimport { EventOof } from \"core/tile/tileEvent\";\r\nimport { easeSinInOut } from \"d3-ease\";\r\nimport Keyboard from \"game/input/keyboard\";\r\nimport { WorldDOMElement } from \"game/mito/WorldDOMElement\";\r\nimport { InventoryBar } from \"game/ui/ingame/InventoryBar\";\r\nimport React from \"react\";\r\nimport { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry, Scene, Vector2 } from \"three\";\r\nimport { Player } from \"../../core\";\r\nimport { Action, ActionBuild, ActionLong } from \"../../core/player/action\";\r\nimport { Tile } from \"../../core/tile\";\r\nimport { clamp, lerp2, map, randFloat } from \"../../math\";\r\nimport {\r\n  build,\r\n  buildComplete,\r\n  deconstruct,\r\n  dropSugar,\r\n  dropWater,\r\n  footsteps,\r\n  interactSound,\r\n  moveBumped,\r\n  sticky,\r\n} from \"../audio\";\r\nimport { Mito } from \"../mito/mito\";\r\nimport { textureFromSpritesheet } from \"../spritesheet\";\r\nimport NeuronMesh, { darkPink, playerTeal } from \"./neuronMesh\";\r\nimport \"./PlayerRenderer.scss\";\r\nimport { Renderer } from \"./Renderer\";\r\nimport { also, Animation, AnimationController, animPause, chain } from \"./tile/Animation\";\r\n\r\nexport class PlayerRenderer extends Renderer<Player> {\r\n  public mesh: Mesh;\r\n\r\n  public neuronMesh = new NeuronMesh(8);\r\n\r\n  protected animation = new AnimationController();\r\n\r\n  constructor(target: Player, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    this.mesh = newMesh();\r\n    this.mesh.name = \"Player Mesh\";\r\n    lerp2(this.mesh.position, this.target.pos, 1);\r\n    this.mesh.position.z = 2;\r\n    this.mesh.add(this.neuronMesh);\r\n\r\n    // wait a bit so the player doesn't pop out behind the seed\r\n    sleep(300).then(() => {\r\n      this.scene.add(this.mesh);\r\n    });\r\n\r\n    // TODO unregister these!\r\n    this.target.on(\"start-long-action\", this.handleStartLongAction);\r\n    this.target.on(\"action\", this.handleAction);\r\n    this.target.on(\"action-fail\", this.handlePlayerActionFail);\r\n    // this.target.inventory.on(\"get\", this.handleResourceGet);\r\n    this.target.inventory.on(\"change\", this.handleResourceChange);\r\n  }\r\n\r\n  private resourceText?: {\r\n    element: WorldDOMElement;\r\n    water: number;\r\n    sugar: number;\r\n    position: Vector2;\r\n    timeoutId: number;\r\n  };\r\n\r\n  // handleResourceGet = (from: Inventory, w: number, s: number) => {\r\n  //   this.handleResourceAdd(w, s);\r\n  // };\r\n\r\n  handleResourceChange = (w: number, s: number) => {\r\n    const positionFn = () => this.resourceText!.position;\r\n    const renderFn = () => {\r\n      const { water, sugar } = this.resourceText!;\r\n      // const { water, sugar } = this.target.inventory;\r\n      const sign = water > 0 || sugar > 0 ? \"+\" : null;\r\n      return (\r\n        <div className=\"player-resource-popup\">\r\n          {sign}\r\n          <InventoryBar water={water} sugar={sugar} showBar={false} format=\"icons\" capacity={100} colored={false} />\r\n        </div>\r\n      );\r\n    };\r\n    if (this.resourceText == null) {\r\n      this.resourceText = {\r\n        element: this.mito.addWorldDOMElement(positionFn, renderFn),\r\n        position: this.target.posFloat.clone(),\r\n        water: w,\r\n        sugar: s,\r\n        timeoutId: (setTimeout(() => {\r\n          this.mito.removeWorldDOMElement(this.resourceText!.element);\r\n          delete this.resourceText;\r\n        }, 1500) as unknown) as number,\r\n      };\r\n    } else {\r\n      if (Math.sign(this.resourceText.water) !== Math.sign(w) || Math.sign(this.resourceText.sugar) !== Math.sign(s)) {\r\n        this.resourceText.water = 0;\r\n        this.resourceText.sugar = 0;\r\n      }\r\n      this.resourceText.position.copy(this.target.posFloat);\r\n      this.resourceText.water += w;\r\n      this.resourceText.sugar += s;\r\n      this.mito.removeWorldDOMElement(this.resourceText.element);\r\n      this.resourceText.element = this.mito.addWorldDOMElement(positionFn, renderFn);\r\n      clearTimeout(this.resourceText.timeoutId);\r\n      this.resourceText.timeoutId = (setTimeout(() => {\r\n        this.mito.removeWorldDOMElement(this.resourceText!.element);\r\n        delete this.resourceText;\r\n      }, 1500) as unknown) as number;\r\n    }\r\n  };\r\n\r\n  handleStartLongAction = (action: ActionLong) => {\r\n    if (action.effect.type === \"build\") {\r\n      this.animation.set(this.buildReproducerAnimation(action as ActionLong<ActionBuild>));\r\n    }\r\n  };\r\n\r\n  handleAction = (action: Action) => {\r\n    if (action.type === \"pickup\") {\r\n      this.neuronMesh.handleInteracted();\r\n      interactSound.fade(0.5, 0.0, 200);\r\n      interactSound.rate(randFloat(0.8, 1.5));\r\n    } else if (action.type === \"drop\") {\r\n      if (action.sugar > 0) {\r\n        dropSugar.play();\r\n        dropSugar.rate(randFloat(0.8, 1.2));\r\n      }\r\n      if (action.water > 0) {\r\n        if (!dropWater.playing()) {\r\n          const id = dropWater.play();\r\n          dropWater.fade(0.2, 0, 400, id);\r\n          dropWater.rate(randFloat(0.8, 1.5));\r\n        }\r\n      }\r\n    } else if (action.type === \"build\") {\r\n      if (action.cellType.chromosome.computeStaticProperties().timeToBuild >= 0) {\r\n        const id = build.play();\r\n        build.rate(randFloat(0.5, 1.0), id);\r\n      } else {\r\n        const id = buildComplete.play();\r\n        buildComplete.rate(id, randFloat(0.5, 1));\r\n      }\r\n    } else if (action.type === \"deconstruct\") {\r\n      const id = deconstruct.play();\r\n      deconstruct.rate(randFloat(0.9, 1.1), id);\r\n    } else if (action.type === \"move\") {\r\n      footsteps.fade(0.1, 0, 50);\r\n      footsteps.rate(randFloat(0.8, 1.5));\r\n    }\r\n  };\r\n\r\n  handlePlayerActionFail = (action: Action, message?: string) => {\r\n    if (action.type === \"move\") {\r\n      if (!moveBumped.playing()) {\r\n        moveBumped.play();\r\n        moveBumped.rate(randFloat(0.8, 1.2));\r\n      }\r\n    }\r\n    if (message == null) {\r\n      if (action.type === \"pickup\" && this.target.inventory.isMaxed()) {\r\n        message = \"Inventory full!\";\r\n      }\r\n      // else if (action.type === \"drop\" && action.target && action.target.inventory.isMaxed()) {\r\n      //   message = `${action.target.displayName} inventory full!`;\r\n      // }\r\n    }\r\n\r\n    if (message != null) {\r\n      if (action.continuous) {\r\n        // only show an error if it's not the exact same error that already exists\r\n        if (this.mito.invalidAction?.message !== message) {\r\n          this.mito.showInvalidAction({ message });\r\n        }\r\n      } else {\r\n        this.mito.showInvalidAction({ message });\r\n      }\r\n    }\r\n  };\r\n\r\n  private prevHighlightedTile?: Tile;\r\n\r\n  update() {\r\n    const pos = this.target.droopPosFloat().clone();\r\n\r\n    const oof = this.target.world.getLastStepStats().events.oof[0] as EventOof;\r\n    if (oof) {\r\n      this.mito.addFloatingText(pos, \"oof\");\r\n    }\r\n\r\n    this.mesh.position.set(pos.x, pos.y, 2);\r\n\r\n    const dt = 1 / 60;\r\n    const isUsingShift = Keyboard.keyMap.has(\"ShiftLeft\");\r\n    const isInteract = (this.mito.controls?.wouldLeftClickInteract() ?? false) && !isUsingShift;\r\n    const highlight = this.mito.highlightedTile;\r\n    const neuronMeshTarget = isInteract ? highlight!.pos.clone().sub(pos) : ZERO;\r\n    if (this.prevHighlightedTile !== highlight) {\r\n      const id = sticky.play();\r\n      sticky.rate(randFloat(0.9, 1.1), id);\r\n      sticky.volume(randFloat(0.8, 1), id);\r\n    }\r\n    this.neuronMesh.setColor(this.mito.toolBar.interactTool.isTakeAll ? darkPink : playerTeal);\r\n    this.neuronMesh.update(isInteract ? dt * 10 : dt * 5, neuronMeshTarget);\r\n    this.prevHighlightedTile = highlight;\r\n    // this.neuronMesh.visible = Cell.is(this.mito.getHighlightedTile());\r\n\r\n    // pos.x += Math.cos(Ticker.now / 1000) * 0.04;\r\n    // pos.y += Math.sin(Ticker.now / 400) * 0.08;\r\n    // lerp2(this.mesh.position, pos, 0.5);\r\n\r\n    this.animation.update();\r\n  }\r\n\r\n  destroy() {\r\n    this.scene.remove(this.mesh);\r\n  }\r\n\r\n  buildReproducerAnimation(actionLong: ActionLong<ActionBuild>): Animation {\r\n    const animWaitForCameraZoomIn = animPause(0.5);\r\n    let w = 0;\r\n    const animShakeDuration = 1.5;\r\n    const animShake: Animation = (t, dt) => {\r\n      const tNorm = t / animShakeDuration;\r\n      // const pow = clamp(polyBiasUpDown(tNorm), 0, 1);\r\n      const pow = clamp(tNorm, 0, 1);\r\n      const shakeFrequency = 9 * Math.sqrt(pow);\r\n      const shakeAmplitude = 0.15 * pow ** 1.5;\r\n      w += dt * Math.PI * 2 * shakeFrequency;\r\n      this.mesh.position.x += Math.sin(w) * shakeAmplitude;\r\n      return tNorm > 1;\r\n    };\r\n    const animPulse: Animation = (t) => {\r\n      const tNorm = t / 0.25;\r\n      const s = map(clamp(4 * (tNorm - tNorm * tNorm), 0, 1), 0, 1, 1, 1.5);\r\n      this.mesh.scale.set(s, s, 1);\r\n      return t > tNorm;\r\n    };\r\n    const animSendCopy = this.animSendCopy(actionLong.effect.position);\r\n    const animWaitEnd = animPause(0.5);\r\n\r\n    const focusCamera: Animation = () => {\r\n      this.mito.suggestCamera({\r\n        center: this.target.posFloat,\r\n        zoom: 3,\r\n      });\r\n      return false;\r\n    };\r\n\r\n    return also(chain(animWaitForCameraZoomIn, animShake, also(animSendCopy, animPulse), animWaitEnd), focusCamera);\r\n  }\r\n\r\n  animSendCopy(target: Vector2): Animation {\r\n    const copy = newMesh();\r\n    copy.scale.x = this.mesh.scale.x * 1;\r\n    copy.scale.y = this.mesh.scale.y * 1;\r\n    copy.position.z = this.mesh.position.z - 0.01;\r\n    this.scene.add(copy);\r\n    const animDuplicate: Animation = (t) => {\r\n      const tNorm = t / 0.5;\r\n      const dX = easeSinInOut(tNorm) * 0.5;\r\n      this.mesh.position.x -= dX;\r\n      lerp2(copy.position, this.target.droopPosFloat(), 1);\r\n      copy.position.x += dX;\r\n      return tNorm > 1;\r\n    };\r\n    const animStayLeft: Animation = (t) => {\r\n      this.mesh.position.x -= 0.5;\r\n      return false;\r\n    };\r\n    const animReturnOriginal: Animation = (t) => {\r\n      const tNorm = t / 0.5;\r\n      const dX = easeSinInOut(1 - tNorm) * 0.5;\r\n      this.mesh.position.x -= dX;\r\n      return tNorm > 1;\r\n    };\r\n    const animShrinkAndMove: Animation = (t, dt) => {\r\n      const tNorm = t / 1.2;\r\n      // lerp2(copy.position, this.mesh.position, 1);\r\n      lerp2(copy.position, target, 0.1);\r\n      // lerp2(copy.position, target, easeExpOut(tNorm));\r\n      // lerp2(copy.scale, { x: this.mesh.scale.x, y: this.mesh.scale.y }, 1);\r\n      // lerp2(copy.scale, { x: this.mesh.scale.x * 0.2, y: this.mesh.scale.y * 0.2 }, easeSinInOut(tNorm));\r\n      lerp2(copy.scale, { x: this.mesh.scale.x * 0.2, y: this.mesh.scale.y * 0.2 }, 0.1);\r\n      return tNorm > 1;\r\n    };\r\n    const animShrinkToZeroAndRemove: Animation = (t) => {\r\n      const tNorm = t / 0.5;\r\n      lerp2(copy.scale, { x: this.mesh.scale.x * 0.2, y: this.mesh.scale.y * 0.2 }, 1);\r\n      lerp2(copy.scale, { x: 0, y: 0 }, easeSinInOut(tNorm));\r\n\r\n      const ended = tNorm > 1;\r\n      if (ended) {\r\n        this.scene.remove(copy);\r\n      }\r\n      return ended;\r\n    };\r\n    return chain(\r\n      animDuplicate,\r\n      also(animPause(0.5), animStayLeft),\r\n      also(animShrinkAndMove, animReturnOriginal),\r\n      animShrinkToZeroAndRemove\r\n    );\r\n  }\r\n}\r\n\r\nfunction newMesh() {\r\n  const m = new Mesh(\r\n    new PlaneBufferGeometry(0.75, 0.75),\r\n    new MeshBasicMaterial({\r\n      transparent: true,\r\n      // depthWrite: false,\r\n      // depthTest: false,\r\n      map: textureFromSpritesheet(3, 2, \"transparent\"),\r\n      color: new Color(\"white\"),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n  m.renderOrder = 9;\r\n  return m;\r\n}\r\n\r\nconst ZERO = new Vector2();\r\n","import { easeBounceOut, easeQuadOut } from \"d3-ease\";\r\nimport { polyUpDown } from \"math/easing\";\r\nimport Ticker from \"std/ticker\";\r\nimport { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry, Scene } from \"three\";\r\nimport { PlayerSeed } from \"../../core\";\r\nimport { MaterialInfo } from \"../../core/cell/materialInfo\";\r\nimport { lerp, map } from \"../../math\";\r\nimport { fruitPoof, introBounce } from \"../audio\";\r\nimport { Mito } from \"../mito/mito\";\r\nimport { textureFromSpritesheet } from \"../spritesheet\";\r\nimport { Renderer } from \"./Renderer\";\r\nimport { also, Animation, AnimationController, animPause, chain } from \"./tile/Animation\";\r\n\r\nexport class PlayerSeedRenderer extends Renderer<PlayerSeed> {\r\n  public mesh: Mesh;\r\n\r\n  protected animation = new AnimationController();\r\n\r\n  constructor(target: PlayerSeed, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    const reproducerCellType = target.world.genome.cellTypes.find(\r\n      (cellType) => cellType.chromosome.computeStaticProperties().isReproductive\r\n    )!;\r\n    const material = reproducerCellType.material;\r\n    this.mesh = newMesh(material);\r\n    this.mesh.name = \"Player Seed Mesh\";\r\n    this.mito.scenePlayerSeed.add(this.mesh);\r\n    this.animation.set(chain(this.fallInAnimation(), animPause(2), this.wiggleAnimationForever()));\r\n    // this.animation.set(this.wiggleAnimationForever());\r\n  }\r\n\r\n  update() {\r\n    const pos = this.target.posFloat.clone();\r\n    this.mesh.rotation.set(0, 0, 0);\r\n    this.mesh.position.set(pos.x, pos.y, 11);\r\n    this.animation.update();\r\n  }\r\n\r\n  destroy() {\r\n    this.animation.set(\r\n      chain(this.popOutAnimation(), () => {\r\n        this.scene.remove(this.mesh);\r\n        return true;\r\n      })\r\n    );\r\n    Ticker.addAnimation((t) => {\r\n      this.animation.update();\r\n      if (this.animation.animation == null) {\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n\r\n  public popOutAnimation(): Animation {\r\n    const growBigDuration = 0.5;\r\n    const finalScale = 7.0;\r\n    const growBig: Animation = (t) => {\r\n      const tNorm = t / growBigDuration;\r\n      this.mesh.scale.setScalar(lerp(1, finalScale, easeQuadOut(tNorm)));\r\n      // (this.mesh.material as MeshBasicMaterial).opacity = lerp(1, 0.5, tNorm);\r\n      return tNorm > 1;\r\n    };\r\n    const stayBig: Animation = (t) => {\r\n      this.mesh.scale.setScalar(finalScale);\r\n      return t > 1;\r\n    };\r\n    const fadeOut: Animation = (t) => {\r\n      const tNorm = t / 0.2;\r\n      (this.mesh.material as MeshBasicMaterial).opacity = lerp(1, 0, tNorm);\r\n      return tNorm > 1;\r\n    };\r\n    return chain(\r\n      also(growBig, () => {\r\n        fruitPoof.play();\r\n        return true;\r\n      }),\r\n      stayBig,\r\n      fadeOut\r\n    );\r\n  }\r\n\r\n  public fallInAnimation(): Animation {\r\n    const startY = 12;\r\n    const startPosition: Animation = (t) => {\r\n      this.mesh.position.y -= startY;\r\n      return false;\r\n    };\r\n    const duration = 2;\r\n    const anim: Animation = (t) => {\r\n      const tNorm = t / duration;\r\n      this.mesh.position.y -= lerp(startY, 0, easeBounceOut(tNorm));\r\n      return tNorm > 1;\r\n    };\r\n    return chain(\r\n      also(animPause(1), startPosition),\r\n      also(anim, () => {\r\n        introBounce.play();\r\n        return true;\r\n      })\r\n    );\r\n  }\r\n\r\n  public wiggleAnimationForever(): Animation {\r\n    const wiggleDuration = 1;\r\n    const waitDuration = 2;\r\n    return (t) => {\r\n      const tBounded = t % (wiggleDuration + waitDuration);\r\n      if (tBounded < wiggleDuration) {\r\n        const tNorm = tBounded / wiggleDuration;\r\n        const zRot = Math.sin(map(Math.sin(tNorm * Math.PI * 4), -1, 1, -Math.PI / 6, Math.PI / 6)) * polyUpDown(tNorm);\r\n        // this.mesh.rotation.set(0, 0, zRot);\r\n        this.mesh.position.y -= Math.abs(zRot * 1);\r\n      }\r\n      return false;\r\n    };\r\n  }\r\n}\r\n\r\nfunction newMesh(material: MaterialInfo) {\r\n  const m = new Mesh(\r\n    new PlaneBufferGeometry(1, 1),\r\n    new MeshBasicMaterial({\r\n      transparent: true,\r\n      // depthWrite: false,\r\n      // depthTest: false,\r\n      map: textureFromSpritesheet(material.texturePosition.x, material.texturePosition.y),\r\n      color: material.color ?? new Color(\"white\"),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n  m.renderOrder = 9;\r\n  return m;\r\n}\r\n","import snowUrl from \"assets/images/snow.png\";\r\nimport { Temperature } from \"core/temperature\";\r\nimport { Weather } from \"core/world/weather\";\r\nimport { lerpLinear } from \"math\";\r\nimport {\r\n  DoubleSide,\r\n  Mesh,\r\n  MeshBasicMaterial,\r\n  NearestFilter,\r\n  PlaneGeometry,\r\n  RepeatWrapping,\r\n  Scene,\r\n  Texture,\r\n  TextureLoader,\r\n  Vector2,\r\n} from \"three\";\r\n\r\nexport class SnowRenderer {\r\n  static geometry = new PlaneGeometry(50, 100);\r\n\r\n  snowMesh: Mesh;\r\n\r\n  snowMap: Texture;\r\n\r\n  enabledOpacity: number;\r\n\r\n  snowMaterial: MeshBasicMaterial;\r\n\r\n  constructor(public target: Weather, public scene: Scene, public readonly scalar = 1) {\r\n    this.snowMap = new TextureLoader().load(snowUrl, (texture) => {\r\n      texture.magFilter = texture.minFilter = NearestFilter;\r\n      texture.flipY = true;\r\n      texture.wrapS = texture.wrapT = RepeatWrapping;\r\n      texture.repeat = new Vector2(3 * scalar, 6 * scalar);\r\n    });\r\n    this.enabledOpacity = 0.4 / scalar;\r\n    this.snowMaterial = new MeshBasicMaterial({\r\n      map: this.snowMap,\r\n      color: 0xffffff,\r\n      transparent: true,\r\n      opacity: 0,\r\n      side: DoubleSide,\r\n    });\r\n    this.snowMesh = new Mesh(SnowRenderer.geometry, this.snowMaterial);\r\n    this.snowMesh.position.set(25, 50, -9);\r\n    this.snowMesh.renderOrder = 1;\r\n    scene.add(this.snowMesh);\r\n  }\r\n\r\n  update() {\r\n    const targetOpacity = this.target.getBaseTemperature() < Temperature.Mild ? this.enabledOpacity : 0;\r\n    if (this.snowMaterial.opacity !== targetOpacity) {\r\n      this.snowMaterial.opacity = lerpLinear(this.snowMaterial.opacity, targetOpacity, this.enabledOpacity * 0.02);\r\n      this.snowMaterial.needsUpdate = true;\r\n    }\r\n    this.snowMap.offset.x -= 0.0001 / this.scalar;\r\n    this.snowMap.offset.y -= 0.0005 / this.scalar;\r\n  }\r\n}\r\n","/**\r\n * A Proxy that makes every .get() into a method that, upon invocation,\r\n * calls the corresponding method name in its backing array with the arguments.\r\n * Returns void.\r\n */\r\nexport function arrayProxy<T>(values: T[]) {\r\n  return new Proxy(\r\n    {},\r\n    {\r\n      get: (target, p: keyof T) => {\r\n        const v0 = values[0];\r\n        if (v0 != null && typeof v0[p] === \"function\") {\r\n          return function(...args: any[]) {\r\n            for (const t of values) {\r\n              const method = t[p];\r\n              if (typeof method === \"function\") {\r\n                method.apply(t, args);\r\n              }\r\n            }\r\n          };\r\n        } else {\r\n          return NO_OP;\r\n        }\r\n      },\r\n    }\r\n  ) as T;\r\n}\r\n\r\nconst NO_OP = () => {};\r\n","import { Gene } from \"core/cell/gene\";\r\nimport { GeneInstance } from \"core/cell/geneInstance\";\r\nimport { Renderer } from \"../Renderer\";\r\nimport { InstancedTileRenderer } from \"./InstancedTileRenderer\";\r\n\r\nexport abstract class GeneRenderer<G extends Gene = Gene> extends Renderer<GeneInstance<G>> {\r\n  constructor(t: GeneInstance<G>, public tileRenderer: InstancedTileRenderer) {\r\n    super(t, tileRenderer.scene, tileRenderer.mito);\r\n    this.init();\r\n  }\r\n\r\n  init() {}\r\n\r\n  abstract hover?(): void;\r\n}\r\n","import { BufferGeometry, Float32BufferAttribute, Line, LineBasicMaterial, Vector3 } from \"three\";\r\n\r\nconst lineGeometry = (() => {\r\n  const g = new BufferGeometry();\r\n  g.setAttribute(\"position\", new Float32BufferAttribute([0, 0, 0, 0, 1, 0], 3));\r\n  return g;\r\n})();\r\n\r\nexport default function makeLine(dir: Vector3, origin: Vector3, length: number, color: number) {\r\n  // copied from https://github.com/mrdoob/js/blob/master/src/helpers/ArrowHelper.js\r\n  const line = new Line(lineGeometry, new LineBasicMaterial({ color: color }));\r\n  line.position.copy(origin);\r\n  // dir is assumed to be normalized\r\n  if (dir.y > 0.99999) {\r\n    line.quaternion.set(0, 0, 0, 1);\r\n  } else if (dir.y < -0.99999) {\r\n    line.quaternion.set(1, 0, 0, 0);\r\n  } else {\r\n    const axis = new Vector3(dir.z, 0, -dir.x).normalize();\r\n    const radians = Math.acos(dir.y);\r\n    line.quaternion.setFromAxisAngle(axis, radians);\r\n  }\r\n  line.scale.set(1, Math.max(0, length), 1);\r\n  line.position.z = 0.1;\r\n  line.updateMatrix();\r\n  line.matrixAutoUpdate = false;\r\n  return line;\r\n}\r\n","import configure from \"common/configure\";\r\nimport { blopBuffer, distScalar } from \"game/audio\";\r\nimport { GenePhotosynthesis } from \"std/genes/GenePhotosynthesis\";\r\nimport { Audio, Object3D, Vector2, Vector3 } from \"three\";\r\nimport { GeneRenderer } from \"./GeneRenderer\";\r\nimport makeLine from \"./makeLine\";\r\nexport class GenePhotosynthesisRenderer extends GeneRenderer<GenePhotosynthesis> {\r\n  private audio = this.tileRenderer.worldRenderer.renderResources\r\n    ? configure(new Audio(this.mito.audioListener), (audio) => {\r\n        blopBuffer.then((buffer) => audio.setBuffer(buffer));\r\n      })\r\n    : undefined;\r\n\r\n  private lastAudioValueTracker = 0;\r\n\r\n  private neighborLines = new Object3D();\r\n\r\n  update() {\r\n    // audio\r\n    const newAudioValueTracker = this.target.state.totalSugarProduced;\r\n    if (newAudioValueTracker > this.lastAudioValueTracker) {\r\n      const baseVolume = this.target.state.sugarConverted * this.target.state.sugarConverted;\r\n      const volume = distScalar(this.target.cell, this.mito.world.player) * baseVolume;\r\n      this.audio?.setVolume(volume);\r\n      // this.audio.setRefDistance(2);\r\n      // play blop sound\r\n      this.audio?.play();\r\n      this.tileRenderer.animation.set(this.tileRenderer.growPulseAnimation());\r\n    }\r\n    this.lastAudioValueTracker = newAudioValueTracker;\r\n    if (this.neighborLines.parent != null) {\r\n      this.scene.remove(this.neighborLines);\r\n    }\r\n  }\r\n\r\n  hover() {\r\n    this.scene.add(this.neighborLines);\r\n    this.neighborLines.position.set(this.tileRenderer.target.pos.x, this.tileRenderer.target.pos.y, 1);\r\n    const lines: Vector2[] = this.target.state.activeNeighbors;\r\n    if (lines.length !== this.neighborLines.children.length) {\r\n      // redo neighbor lines\r\n      this.neighborLines.remove(...this.neighborLines.children);\r\n      lines.forEach((dir) => {\r\n        const length = dir.length() - 0.25;\r\n        const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\r\n        const line = makeLine(arrowDir, new Vector3(), length, color);\r\n        this.neighborLines.add(line);\r\n      });\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.scene.remove(this.neighborLines);\r\n    this.audio?.disconnect();\r\n  }\r\n}\r\n\r\nconst color = 0xffc90e;\r\n","import { World } from \"core\";\r\nimport { Cell, Tile } from \"core/tile\";\r\nimport { SPRITESHEET } from \"game/spritesheet\";\r\nimport {\r\n  Color,\r\n  DoubleSide,\r\n  DynamicDrawUsage,\r\n  InstancedBufferAttribute,\r\n  InstancedBufferGeometry,\r\n  Mesh,\r\n  PlaneBufferGeometry,\r\n  RawShaderMaterial,\r\n  Vector2,\r\n  Vector3,\r\n} from \"three\";\r\nimport glsl from \"../glsl\";\r\n\r\nconst vertexShader = glsl`\r\nprecision mediump float;\r\n\r\n// the vertex shader's main goals are:\r\n// 1. set gl_Position to a clip-coordinate\r\n// 2. pass varyings along to fragment shader.\r\n// you can accept two types of inputs:\r\n//   'attribute' variables, which change per vertex\r\n//   'uniform' variables, which are constant for a given draw context.\r\n// WebGL thankfully hooks up a bunch of attributes and uniforms, see https://threejs.org/docs/index.html#api/en/renderers/webgl/WebGLProgram\r\n// see also my explorations: https://codesandbox.io/s/reactthreejstemplate-lwvhu\r\n\r\n\r\n// Comes from WebGLProgram\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\n// Comes from threejs Geometry\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\n\r\n// attributes we provide\r\n// these are constant per instance\r\nattribute vec3 centers;\r\nattribute vec3 scales;\r\nattribute vec3 colors;\r\nattribute vec2 texturePositions;\r\nattribute float alphas;\r\n\r\n// things we pass onto fragment\r\nvarying vec3 vTileCenter;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\nvarying vec2 vTexturePosition;\r\nvarying float vAlpha;\r\n\r\n// based on https://github.com/mrdoob/three.js/blob/master/examples/webgl_buffergeometry_instancing_billboards.html\r\nvoid main() {\r\n  vTileCenter = centers;\r\n  vColor = colors;\r\n  vUv = uv;\r\n  vTexturePosition = texturePositions;\r\n  vAlpha = alphas;\r\n\r\n  vec4 mvPosition = modelViewMatrix * vec4(centers, 1.);\r\n  mvPosition.xyz += position * scales;\r\n  // mvPosition.xyz += position;\r\n  gl_Position = projectionMatrix * mvPosition;\r\n}\r\n`;\r\n\r\nconst fragmentShader = glsl`\r\n// for the fragment shader, the main goal is to set gl_FragColor. Its inputs are\r\n//   'varying' variables from the vertex shader, interpolated along the triangle\r\n//   'uniform' variables\r\nprecision mediump float;\r\n\r\n// these should match the corresponding section in the vertexShader exactly\r\nvarying vec3 vTileCenter;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\nvarying vec2 vTexturePosition;\r\nvarying float vAlpha;\r\n\r\nconst vec2 spritesheetSize = vec2(256., 256.);\r\nconst vec2 spriteSize = vec2(32.);\r\nuniform sampler2D spriteSheet;\r\n\r\nfloat myRound(float x) {\r\n  return sign(x) * floor(abs(x) + 0.5);\r\n}\r\n\r\n// uv - [0,1]x[0,1] - our local sprite (32x32) UV coords\r\n// texturePosition - the grid x/y where our sprite lives in our texture. NOTE:\r\n// for texturePosition, top-left is 0, 0 (Y is image coordinates)\r\n// textureSize - the pixel width/height of the full spritesheet\r\n// returns: a UV coordinate for this sprite, relative to the full spritesheet\r\nvec2 getCorrectUv(vec2 uv, vec2 texturePosition) {\r\n  vec2 spriteSheetPxStart = texturePosition * spriteSize;\r\n  spriteSheetPxStart.y = spritesheetSize.y - spriteSheetPxStart.y - spriteSize.y;\r\n  vec2 spriteSheetUv = spriteSheetPxStart + uv * spriteSize;\r\n  vec2 minUv = spriteSheetPxStart;\r\n  vec2 maxUv = spriteSheetPxStart + spriteSize;\r\n  return clamp(spriteSheetUv / spritesheetSize, minUv / spritesheetSize, maxUv / spritesheetSize);\r\n}\r\n\r\nvoid main() {\r\n  vec2 correctUv = getCorrectUv(vUv, vTexturePosition);\r\n  vec4 textureColor = texture2D(spriteSheet, correctUv);\r\n  gl_FragColor = vec4(textureColor.rgb * vColor, textureColor.a * vAlpha);\r\n}\r\n`;\r\n\r\nfunction newTileShaderMaterial() {\r\n  return new RawShaderMaterial({\r\n    uniforms: {\r\n      spriteSheet: { value: SPRITESHEET() },\r\n    },\r\n    transparent: true,\r\n    vertexShader,\r\n    fragmentShader,\r\n    side: DoubleSide,\r\n  });\r\n}\r\n\r\nfunction newTileBatcherGeometry() {\r\n  // overdraw just a tiny bit to prevent aliased black lines from appearing\r\n  // in various zoom levels\r\n  const referenceGeometry = new PlaneBufferGeometry(1.01, 1.01);\r\n  const geometry = new InstancedBufferGeometry();\r\n  // this copies:\r\n  // [0, 2, 1, 2, 3, 1]\r\n  // index has a specific and somewhat cryptic data storage format\r\n  // it's a flattened array of size three elements\r\n  // each three adjacent numbers gets interpreted as one triangle\r\n  // each individual number's value is an *index* into a \"virtual\r\n  // vertex array\" that's defined the attributes array.\r\n  geometry.index = referenceGeometry.index;\r\n  // this copies:\r\n  // position: BufferAttribute, 4 items, size 3\r\n  // normal: BufferAttribute, 4 items, size 3\r\n  // uv: BufferAttribute, 4 items, size 2\r\n  geometry.attributes = referenceGeometry.attributes;\r\n  return geometry;\r\n}\r\n\r\nclass TileBatcher {\r\n  private geometry = newTileBatcherGeometry();\r\n\r\n  public readonly maxTiles = this.world.height * this.world.width * 2;\r\n\r\n  centers = this.attr(3);\r\n\r\n  colors = this.attr(3);\r\n\r\n  scales = this.attr(3);\r\n\r\n  texturePositions = this.attr(2);\r\n\r\n  alphas = this.attr(1, 1);\r\n\r\n  private attr(dim: number, fill = 0) {\r\n    const attr = new InstancedBufferAttribute(new Float32Array(this.maxTiles * dim).fill(fill), dim, false, 1);\r\n    attr.setUsage(DynamicDrawUsage);\r\n    return attr;\r\n  }\r\n\r\n  public readonly mesh: Mesh;\r\n\r\n  constructor(public world: World) {\r\n    this.mesh = new Mesh(this.geometry, newTileShaderMaterial());\r\n    this.mesh.name = \"TileBatcher Mesh\";\r\n    this.mesh.frustumCulled = false;\r\n    this.mesh.matrixAutoUpdate = false;\r\n    this.mesh.updateMatrixWorld();\r\n\r\n    for (const prop in this) {\r\n      const v = this[prop];\r\n      if (v instanceof InstancedBufferAttribute) {\r\n        this.geometry.setAttribute(prop, v);\r\n      }\r\n    }\r\n  }\r\n\r\n  private instances = new Map<string, BatchInstance>();\r\n\r\n  // getInstance(layer: number, pos: Vector2) {\r\n  getBatchInstance(tile: Tile) {\r\n    const pos = tile.pos;\r\n    const layer = Cell.is(tile) ? 1 : 0;\r\n    const layerOffset = (layer * this.maxTiles) / 2;\r\n    const positionOffset = pos.y * this.world.width + pos.x;\r\n    const index = layerOffset + positionOffset;\r\n    if (!Number.isInteger(index)) {\r\n      console.error(\"index \" + index + \" is not integer!\");\r\n    }\r\n    const key = String(index);\r\n    if (!this.instances.has(key)) {\r\n      this.instances.set(key, new BatchInstance(this, index));\r\n    }\r\n    const instance = this.instances.get(key)!;\r\n    instance.checkout(tile);\r\n    return instance;\r\n  }\r\n\r\n  endFrame() {\r\n    for (const prop in this) {\r\n      const v = this[prop];\r\n      if (v instanceof InstancedBufferAttribute) {\r\n        v.needsUpdate = true;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const BLACK = new Color(0, 0, 0);\r\nconst ZERO = new Vector3(0, 0, 0);\r\nexport class BatchInstance {\r\n  public readonly batcher: TileBatcher;\r\n\r\n  public readonly index: number;\r\n\r\n  private static numInUse = 0;\r\n\r\n  private owner?: object;\r\n\r\n  constructor(batcher: TileBatcher, index: number) {\r\n    this.batcher = batcher;\r\n    this.index = index;\r\n  }\r\n\r\n  checkout(owner: object) {\r\n    if (this.owner != null) {\r\n      // throw new Error(\"Checking out instance that's already in use!\" + this.index);\r\n      console.warn(\"Checking out instance that's already in use!\", this.index, owner);\r\n    }\r\n    this.owner = owner;\r\n    BatchInstance.numInUse++;\r\n  }\r\n\r\n  commitColor(r: number, g: number, b: number) {\r\n    if (!this.owner) {\r\n      console.error(\"freed tileBatcher still in use!\");\r\n    }\r\n    this.batcher.colors.setXYZ(this.index, r, g, b);\r\n  }\r\n\r\n  commitCenter(x: number, y: number, z: number) {\r\n    if (!this.owner) {\r\n      console.error(\"freed tileBatcher still in use!\");\r\n    }\r\n    this.batcher.centers.setXYZ(this.index, x, y, z);\r\n  }\r\n\r\n  commitScale(scale: Vector3) {\r\n    if (!this.owner) {\r\n      console.error(\"freed tileBatcher still in use!\");\r\n    }\r\n    this.batcher.scales.setXYZ(this.index, scale.x, scale.y, scale.z);\r\n  }\r\n\r\n  commitTexturePosition(pos: Vector2) {\r\n    this.batcher.texturePositions.setXY(this.index, pos.x, pos.y);\r\n  }\r\n\r\n  commitAlpha(alpha: number) {\r\n    this.batcher.alphas.setX(this.index, alpha);\r\n  }\r\n\r\n  destroy() {\r\n    this.commitColor(0, 0, 0);\r\n    this.commitScale(ZERO);\r\n    this.owner = undefined;\r\n    BatchInstance.numInUse--;\r\n  }\r\n}\r\n\r\nexport default TileBatcher;\r\n","import classNames from \"classnames\";\r\nimport configure from \"common/configure\";\r\nimport { Cell, CellType, GeneInstance } from \"core/cell\";\r\nimport { Directions, DIRECTIONS, oppositeDir } from \"core/directions\";\r\nimport { clickGeneric, playSmallRand } from \"game/audio\";\r\nimport Keyboard from \"game/input/keyboard\";\r\nimport { WorldDOMElement } from \"game/mito/WorldDOMElement\";\r\nimport React, { useCallback } from \"react\";\r\nimport { IoIosClose } from \"react-icons/io\";\r\nimport { GenePipes } from \"std/genes/GenePipes\";\r\nimport { BoxBufferGeometry, Color, DoubleSide, Mesh, MeshBasicMaterial } from \"three\";\r\nimport \"./GenePipesRenderer.scss\";\r\nimport { GeneRenderer } from \"./GeneRenderer\";\r\nimport { BLACK } from \"./tileBatcher\";\r\n\r\nconst PIPE_DIR_GEOMETRY = new BoxBufferGeometry(0.4, 0.2);\r\nconst PIPE_CENTER_GEOMETRY = new BoxBufferGeometry(0.2, 0.2);\r\n\r\nconst materialMap = new Map<CellType, MeshBasicMaterial>();\r\nfunction getPipeMaterial(cellType: CellType) {\r\n  if (!materialMap.has(cellType)) {\r\n    const color = new Color(cellType.material.color?.getHex() ?? 0xffffff);\r\n    color.lerp(BLACK, 0.5);\r\n    materialMap.set(\r\n      cellType,\r\n      new MeshBasicMaterial({\r\n        color,\r\n        side: DoubleSide,\r\n        opacity: 0.5,\r\n        transparent: true,\r\n      })\r\n    );\r\n  }\r\n  return materialMap.get(cellType);\r\n}\r\n\r\nexport class GenePipesRenderer extends GeneRenderer<GenePipes> {\r\n  public meshes: Partial<Record<Directions, Mesh>> = {};\r\n\r\n  public zeroMesh = configure(new Mesh(PIPE_CENTER_GEOMETRY, getPipeMaterial(this.target.cell.type)), (mesh) => {\r\n    mesh.name = `Pipe Center`;\r\n    mesh.position.x = this.target.cell.pos.x;\r\n    mesh.position.y = this.target.cell.pos.y;\r\n    mesh.position.z = 1;\r\n    mesh.updateMatrix();\r\n    mesh.matrixAutoUpdate = false;\r\n    this.scene.add(mesh);\r\n  });\r\n\r\n  private argsEditor?: WorldDOMElement;\r\n\r\n  update() {\r\n    const { connections } = this.target.state;\r\n    let direction: Directions;\r\n    for (direction in this.target.state.connections) {\r\n      if (connections[direction] && this.meshes[direction] == null) {\r\n        this.addMesh(direction);\r\n      } else if (!connections[direction] && this.meshes[direction] != null) {\r\n        this.removeMesh(direction);\r\n      }\r\n    }\r\n\r\n    if (this.tileRenderer.worldRenderer.renderResources) {\r\n      this.updateArgsEditor();\r\n    }\r\n  }\r\n\r\n  private addMesh(dir: Directions) {\r\n    const mesh = (this.meshes[dir] = new Mesh(PIPE_DIR_GEOMETRY, getPipeMaterial(this.target.cell.type)));\r\n    mesh.name = `Pipe ${dir}`;\r\n    const direction = DIRECTIONS[dir];\r\n    mesh.position.x = this.target.cell.pos.x + direction.x * 0.3;\r\n    mesh.position.y = this.target.cell.pos.y + direction.y * 0.3;\r\n    mesh.position.z = 1;\r\n    mesh.rotation.z = direction.angle();\r\n    mesh.updateMatrix();\r\n    mesh.matrixAutoUpdate = false;\r\n    this.scene.add(mesh);\r\n  }\r\n\r\n  private removeMesh(directionName: Directions) {\r\n    const mesh = this.meshes[directionName]!;\r\n    delete this.meshes[directionName];\r\n    this.scene.remove(mesh);\r\n  }\r\n\r\n  updateArgsEditor() {\r\n    const shouldShowArgsEditor = Keyboard.keyMap.has(\"ShiftLeft\") && this.mito.getTileAtScreen() === this.target.cell;\r\n    if (shouldShowArgsEditor && this.argsEditor == null) {\r\n      this.argsEditor = this.mito.addWorldDOMElement(this.positionFn, this.renderFn);\r\n    } else if (!shouldShowArgsEditor && this.argsEditor != null) {\r\n      this.mito.removeWorldDOMElement(this.argsEditor);\r\n      this.argsEditor = undefined;\r\n    }\r\n  }\r\n\r\n  private positionFn = () => this.target.cell;\r\n\r\n  private renderFn = () => {\r\n    return <PipesEditor gene={this.target} />;\r\n  };\r\n\r\n  hover() {}\r\n\r\n  destroy() {\r\n    if (this.argsEditor) {\r\n      this.mito.removeWorldDOMElement(this.argsEditor);\r\n    }\r\n    let dir: Directions;\r\n    for (dir in this.meshes) {\r\n      const mesh = this.meshes[dir];\r\n      if (mesh != null) {\r\n        this.scene.remove(mesh);\r\n      }\r\n    }\r\n    this.scene.remove(this.zeroMesh);\r\n  }\r\n}\r\n\r\nfunction setPipe(gene: GeneInstance<GenePipes>, dir: Directions, val: boolean | \"flip\", silent = false) {\r\n  const { connections } = gene.state;\r\n  if (val === \"flip\") {\r\n    val = !connections[dir];\r\n  }\r\n  if (connections[dir] !== val && !silent) {\r\n    playSmallRand(clickGeneric);\r\n  }\r\n  connections[dir] = val;\r\n  // also set neighbor's connecting pipe\r\n  const neighbor = gene.cell.world.tileNeighbors(gene.cell.pos).get(DIRECTIONS[dir]);\r\n  if (Cell.is(neighbor)) {\r\n    const neighborPipes = neighbor.findGene(GenePipes);\r\n    if (neighborPipes != null) {\r\n      neighborPipes.state.connections[oppositeDir(dir)] = val;\r\n    }\r\n  }\r\n\r\n  return val;\r\n}\r\n\r\nfunction setAllPipes(gene: GeneInstance<GenePipes>, off: boolean) {\r\n  if (off) {\r\n    if (isAnyOn(gene)) {\r\n      playSmallRand(clickGeneric);\r\n    }\r\n    setPipe(gene, \"n\", false, true);\r\n    setPipe(gene, \"s\", false, true);\r\n    setPipe(gene, \"e\", false, true);\r\n    setPipe(gene, \"w\", false, true);\r\n    lastEventStateType = \"all-false\";\r\n  } else {\r\n    if (!isAnyOn(gene)) {\r\n      playSmallRand(clickGeneric);\r\n    }\r\n    setPipe(gene, \"n\", true, true);\r\n    setPipe(gene, \"s\", true, true);\r\n    setPipe(gene, \"e\", true, true);\r\n    setPipe(gene, \"w\", true, true);\r\n    lastEventStateType = \"all-true\";\r\n  }\r\n}\r\n\r\nlet lastEventStateType: \"set-true\" | \"set-false\" | \"all-true\" | \"all-false\" | undefined;\r\n\r\nfunction handleMouseDown(gene: GeneInstance<GenePipes>, dir: Directions) {\r\n  const val = setPipe(gene, dir, \"flip\");\r\n  lastEventStateType = val ? \"set-true\" : \"set-false\";\r\n}\r\n\r\nfunction handleMouseMove(event: React.MouseEvent, gene: GeneInstance<GenePipes>, dir: Directions) {\r\n  if (event.buttons > 0) {\r\n    if (lastEventStateType === \"set-true\") {\r\n      setPipe(gene, dir, true);\r\n    } else if (lastEventStateType === \"set-false\") {\r\n      setPipe(gene, dir, false);\r\n    } else if (lastEventStateType === \"all-false\") {\r\n      setAllPipes(gene, true);\r\n    } else if (lastEventStateType === \"all-true\") {\r\n      setAllPipes(gene, false);\r\n    }\r\n  }\r\n}\r\n\r\nfunction isAnyOn(gene: GeneInstance<GenePipes>) {\r\n  const { connections } = gene.state;\r\n  return !!(connections.n || connections.s || connections.e || connections.w);\r\n}\r\n\r\nconst PipesEditor: React.FC<{ gene: GeneInstance<GenePipes> }> = ({ gene }) => {\r\n  const setDirN = useCallback(() => handleMouseDown(gene, \"n\"), [gene]);\r\n  const setDirS = useCallback(() => handleMouseDown(gene, \"s\"), [gene]);\r\n  const setDirE = useCallback(() => handleMouseDown(gene, \"e\"), [gene]);\r\n  const setDirW = useCallback(() => handleMouseDown(gene, \"w\"), [gene]);\r\n\r\n  const mouseMoveDirN = useCallback((event) => handleMouseMove(event, gene, \"n\"), [gene]);\r\n  const mouseMoveDirS = useCallback((event) => handleMouseMove(event, gene, \"s\"), [gene]);\r\n  const mouseMoveDirE = useCallback((event) => handleMouseMove(event, gene, \"e\"), [gene]);\r\n  const mouseMoveDirW = useCallback((event) => handleMouseMove(event, gene, \"w\"), [gene]);\r\n\r\n  let shouldClickTurnOff = isAnyOn(gene);\r\n  const toggleAllDirections = useCallback(() => {\r\n    setAllPipes(gene, shouldClickTurnOff);\r\n  }, [gene, shouldClickTurnOff]);\r\n  const mouseMoveAllDirections = useCallback(\r\n    (event) => {\r\n      if (event.buttons > 0) {\r\n        if (lastEventStateType === \"all-false\") {\r\n          setAllPipes(gene, true);\r\n        } else {\r\n          setAllPipes(gene, false);\r\n        }\r\n      }\r\n    },\r\n    [gene]\r\n  );\r\n\r\n  return (\r\n    <div className=\"pipes-editor\">\r\n      <div className=\"zone-n\" onMouseDown={setDirN} onMouseMove={mouseMoveDirN}></div>\r\n      <div className=\"zone-w\" onMouseDown={setDirW} onMouseMove={mouseMoveDirW}></div>\r\n      <div\r\n        className={classNames(\"zone-center\", { \"turn-on\": !shouldClickTurnOff })}\r\n        onMouseDown={toggleAllDirections}\r\n        onMouseMove={mouseMoveAllDirections}\r\n      >\r\n        <IoIosClose />\r\n      </div>\r\n      <div className=\"zone-e\" onMouseDown={setDirE} onMouseMove={mouseMoveDirE}></div>\r\n      <div className=\"zone-s\" onMouseDown={setDirS} onMouseMove={mouseMoveDirS}></div>\r\n    </div>\r\n  );\r\n};\r\n","import { Gene } from \"core/cell/gene\";\r\nimport { map } from \"math\";\r\nimport React from \"react\";\r\nimport { reproducerGetPercentMatured, ReproducerState } from \"std/genes/GeneReproducer\";\r\nimport { GeneRenderer } from \"./GeneRenderer\";\r\nimport \"./GeneReproducerRenderer.scss\";\r\n\r\nexport class GeneReproducerRenderer extends GeneRenderer<Gene<ReproducerState, any>> {\r\n  percentMatureElement = this.tileRenderer.worldRenderer.renderResources\r\n    ? this.mito.addWorldDOMElement(\r\n        () => this.target.cell,\r\n        () => {\r\n          const matured = reproducerGetPercentMatured(this.target);\r\n          return <div className=\"reproducer-percent-mature\">{(matured * 100).toFixed(1)}%</div>;\r\n        }\r\n      )\r\n    : null;\r\n\r\n  hover() {}\r\n\r\n  update() {\r\n    this.updateScale();\r\n  }\r\n\r\n  updateScale() {\r\n    const scale = map(reproducerGetPercentMatured(this.target), 0, 1, 0.2, 1);\r\n    this.tileRenderer.scale.set(scale, scale, 1);\r\n  }\r\n\r\n  //   super.update();\r\n  // if (this.target.age - this.lastEmitAge > 0.5) {\r\n  //   const angle = Math.random() * Math.PI * 2;\r\n  //   const speed = 0.1;\r\n  //   const dx = Math.cos(angle) * speed;\r\n  //   const dy = Math.sin(angle) * speed;\r\n  //   fruitSparkle.fire({\r\n  //     x: this.target.pos.x,\r\n  //     y: this.target.pos.y,\r\n  //     z: 1,\r\n  //     alpha: 1,\r\n  //     info: { dx, dy },\r\n  //     size: 1,\r\n  //     time: 0,\r\n  //     // r: angle,\r\n  //   });\r\n  //   this.lastEmitAge = this.target.age;\r\n  // }\r\n  // }\r\n\r\n  destroy() {\r\n    if (this.percentMatureElement) {\r\n      this.mito.removeWorldDOMElement(this.percentMatureElement);\r\n    }\r\n  }\r\n}\r\n","import { distScalar, suckWaterBuffer } from \"game/audio\";\r\nimport { GeneSoilAbsorption } from \"std/genes\";\r\nimport { Audio, Color, Object3D, Vector2, Vector3 } from \"three\";\r\nimport { GeneRenderer } from \"./GeneRenderer\";\r\nimport makeLine from \"./makeLine\";\r\nexport class GeneSoilAbsorptionRenderer extends GeneRenderer<GeneSoilAbsorption> {\r\n  private audio = (() => {\r\n    const audio = new Audio(this.mito.audioListener);\r\n    suckWaterBuffer.then((buffer) => audio.setBuffer(buffer));\r\n    return audio;\r\n  })();\r\n\r\n  private lastAudioValueTracker = 0;\r\n\r\n  private neighborLines = new Object3D();\r\n\r\n  update() {\r\n    const newAudioValueTracker = this.target.state.totalSucked;\r\n    if (newAudioValueTracker !== this.lastAudioValueTracker) {\r\n      // const baseVolume = this.target.waterTransferAmount / (2 + this.target.waterTransferAmount);\r\n      const baseVolume = 1;\r\n      const volume = distScalar(this.target.cell, this.mito.world.player) * baseVolume;\r\n      this.audio.setVolume(volume);\r\n      if (this.audio.source != null) {\r\n        this.audio.stop();\r\n      }\r\n      this.audio.play();\r\n      this.tileRenderer.animation.set(this.tileRenderer.growPulseAnimation());\r\n    }\r\n    this.lastAudioValueTracker = newAudioValueTracker;\r\n    if (this.neighborLines.parent != null) {\r\n      this.scene.remove(this.neighborLines);\r\n    }\r\n  }\r\n\r\n  hover() {\r\n    this.scene.add(this.neighborLines);\r\n    this.neighborLines.position.set(this.tileRenderer.target.pos.x, this.tileRenderer.target.pos.y, 1);\r\n    const lines: Vector2[] = this.target.state.activeNeighbors;\r\n    if (lines.length !== this.neighborLines.children.length) {\r\n      // redo neighbor lines\r\n      this.neighborLines.remove(...this.neighborLines.children);\r\n      lines.forEach((dir) => {\r\n        const length = dir.length() - 0.25;\r\n        const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\r\n        const line = makeLine(arrowDir, new Vector3(), length, color);\r\n        this.neighborLines.add(line);\r\n      });\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.scene.remove(this.neighborLines);\r\n    this.audio.disconnect();\r\n  }\r\n}\r\nconst color = new Color(\"rgb(9, 12, 255)\").getHex();\r\n","import { GeneInstance } from \"core/cell\";\r\nimport { easeCubicOut, easeExpOut } from \"d3-ease\";\r\nimport { clickGeneric, playSmallRand } from \"game/audio\";\r\nimport Keyboard from \"game/input/keyboard\";\r\nimport { WorldDOMElement } from \"game/mito/WorldDOMElement\";\r\nimport { randFloat, roundToNearest } from \"math\";\r\nimport React, { useCallback, useEffect, useState } from \"react\";\r\nimport { GeneTransport } from \"std/genes/GeneTransport\";\r\nimport { ArrowHelper, Vector2, Vector3 } from \"three\";\r\nimport { Animation } from \"./Animation\";\r\nimport { GeneRenderer } from \"./GeneRenderer\";\r\nimport \"./GeneTransportRenderer.scss\";\r\n\r\nexport class GeneTransportRenderer extends GeneRenderer<GeneTransport> {\r\n  private arrow!: ArrowHelper;\r\n\r\n  private origin!: Vector2;\r\n\r\n  private lastDir = new Vector2(0, 0);\r\n\r\n  private argsEditor?: WorldDOMElement;\r\n\r\n  update() {\r\n    this.updateArrow();\r\n    this.updateArrowPosition();\r\n    if (this.tileRenderer.worldRenderer.renderResources) {\r\n      this.updateArgsEditor();\r\n    }\r\n\r\n    if (this.target.state.didJustTransport) {\r\n      this.tileRenderer.animation.set(this.arrowMoveAnimation());\r\n    }\r\n  }\r\n\r\n  updateArgsEditor() {\r\n    const shouldShowArgsEditor = Keyboard.keyMap.has(\"ShiftLeft\") && this.mito.getTileAtScreen() === this.target.cell;\r\n    if (shouldShowArgsEditor && this.argsEditor == null) {\r\n      this.argsEditor = this.mito.addWorldDOMElement(this.positionFn, this.renderFn);\r\n    } else if (!shouldShowArgsEditor && this.argsEditor != null) {\r\n      this.mito.removeWorldDOMElement(this.argsEditor);\r\n      this.argsEditor = undefined;\r\n    }\r\n  }\r\n\r\n  private positionFn = () => this.target.cell;\r\n\r\n  private renderFn = () => {\r\n    return <TransportEditor gene={this.target} />;\r\n  };\r\n\r\n  updateArrow() {\r\n    const dir = this.target.cell.args!.direction!;\r\n    if (!dir.equals(this.lastDir)) {\r\n      if (this.arrow != null) {\r\n        this.arrow.parent!.remove(this.arrow);\r\n      }\r\n      // const length = target.dir.length() - 0.25;\r\n      const length = 0.5;\r\n      const arrowDir = dir.clone().normalize();\r\n      this.origin = arrowDir.clone().multiplyScalar(-length / 2);\r\n      this.arrow = new ArrowHelper(\r\n        new Vector3(arrowDir.x, arrowDir.y, 0),\r\n        new Vector3(this.origin.x, this.origin.y, 2),\r\n        length,\r\n        0xffffff,\r\n        0.1,\r\n        0.1\r\n      );\r\n      this.scene.add(this.arrow);\r\n      this.lastDir.copy(dir);\r\n      this.tileRenderer.animation.set(this.arrowSetAnimation());\r\n    }\r\n  }\r\n\r\n  updateArrowPosition({ x, y }: { x: number; y: number } = this.origin) {\r\n    this.arrow.position.set(this.target.cell.pos.x + x, this.target.cell.pos.y + this.target.cell.droopY + y, 2);\r\n  }\r\n\r\n  arrowMoveAnimation(): Animation {\r\n    const duration = 0.25;\r\n    const len = this.origin.length();\r\n    const start = this.origin.clone().setLength(len * 1.1);\r\n    const target = this.origin.clone().setLength(len * 0.5);\r\n    return (t) => {\r\n      const tNorm = t / duration;\r\n      this.updateArrowPosition(start.clone().lerp(target, easeExpOut(tNorm)));\r\n      return tNorm >= 1;\r\n    };\r\n  }\r\n\r\n  arrowSetAnimation(): Animation {\r\n    const duration = 0.2;\r\n    return (t) => {\r\n      const tNorm = t / duration;\r\n      const vibrationAmount = easeCubicOut(1 - tNorm) * 0.1;\r\n      this.updateArrowPosition({\r\n        x: randFloat(-vibrationAmount, vibrationAmount),\r\n        y: randFloat(-vibrationAmount, vibrationAmount),\r\n      });\r\n      // const scale = clamp(map(tNorm, 0, 1, 2, 1), 1, 2);\r\n      // this.arrow.scale.set(scale, scale, 1);\r\n      return tNorm >= 1;\r\n    };\r\n  }\r\n\r\n  hover() {}\r\n\r\n  destroy() {\r\n    this.scene.remove(this.arrow);\r\n    if (this.argsEditor) {\r\n      this.mito.removeWorldDOMElement(this.argsEditor);\r\n    }\r\n  }\r\n}\r\n\r\nconst TransportEditor: React.FC<{ gene: GeneInstance<GeneTransport> }> = ({ gene }) => {\r\n  const setDirN = useCallback(() => {\r\n    gene.cell.args?.direction?.set(0, -1);\r\n    playSmallRand(clickGeneric);\r\n  }, [gene.cell.args]);\r\n\r\n  const setDirS = useCallback(() => {\r\n    gene.cell.args?.direction?.set(0, 1);\r\n    playSmallRand(clickGeneric);\r\n  }, [gene.cell.args]);\r\n\r\n  const setDirE = useCallback(() => {\r\n    gene.cell.args?.direction?.set(1, 0);\r\n    playSmallRand(clickGeneric);\r\n  }, [gene.cell.args]);\r\n\r\n  const setDirW = useCallback(() => {\r\n    gene.cell.args?.direction?.set(-1, 0);\r\n    playSmallRand(clickGeneric);\r\n  }, [gene.cell.args]);\r\n\r\n  const [wantedDirection, addEvent] = useWantedDirection();\r\n  useEffect(() => {\r\n    if (wantedDirection) {\r\n      if (!gene.cell.args?.direction?.equals(wantedDirection)) {\r\n        gene.cell.args?.direction?.copy(wantedDirection);\r\n        playSmallRand(clickGeneric);\r\n      }\r\n    }\r\n  }, [gene.cell.args, wantedDirection]);\r\n  const handleMouseMove = useCallback(\r\n    (event: React.MouseEvent) => {\r\n      if (event.buttons !== 0) {\r\n        addEvent(event);\r\n      }\r\n    },\r\n    [addEvent]\r\n  );\r\n\r\n  return (\r\n    <div className=\"directional-push-editor\" onMouseMove={handleMouseMove}>\r\n      <div className=\"zone-n\" onClick={setDirN}></div>\r\n      <div className=\"zone-w\" onClick={setDirW}></div>\r\n      <div className=\"zone-center\" />\r\n      <div className=\"zone-e\" onClick={setDirE}></div>\r\n      <div className=\"zone-s\" onClick={setDirS}></div>\r\n    </div>\r\n  );\r\n};\r\n\r\nfunction useWantedDirection() {\r\n  const [latestMovements, setLatestMovements] = useState<Vector2[]>([]);\r\n\r\n  const addEvent = useCallback((event: React.MouseEvent) => {\r\n    const { movementX, movementY } = event;\r\n    const movement = new Vector2(movementX, movementY);\r\n    setLatestMovements((latestMovements) => [movement, ...latestMovements]);\r\n  }, []);\r\n\r\n  let wantedDirection: Vector2 | undefined;\r\n\r\n  const totalMovement = latestMovements.reduce((a, b) => a.add(b), new Vector2());\r\n  // only make a decision once total movement is large enough\r\n  if (totalMovement.lengthSq() > 12 * 12) {\r\n    const angle = totalMovement.angle();\r\n    const nearestAngle90 = roundToNearest(angle, Math.PI / 2);\r\n    wantedDirection = new Vector2(Math.round(Math.cos(nearestAngle90)), Math.round(Math.sin(nearestAngle90)));\r\n  }\r\n  return [wantedDirection, addEvent] as const;\r\n}\r\n","import { arrayProxy } from \"common/arrayProxy\";\r\nimport { GeneInstance } from \"core/cell/geneInstance\";\r\nimport { Temperature } from \"core/temperature\";\r\nimport { Air, Cell, DeadCell, Fountain, GrowingCell, Rock, Tile } from \"core/tile\";\r\nimport { BarrenLand } from \"core/tile/BarrenLand\";\r\nimport { Clay, Sand, Silt } from \"core/tile/soil\";\r\nimport { easeCubic } from \"d3-ease\";\r\nimport { scaleLinear } from \"d3-scale\";\r\nimport Mito from \"game/mito/mito\";\r\nimport { params } from \"game/params\";\r\nimport { clamp, lerp, lerp2, map } from \"math\";\r\nimport { reversed } from \"math/easing\";\r\nimport { GeneFruit, GenePhotosynthesis, GenePipes, GeneSeed, GeneSoilAbsorption, GeneTransport } from \"std/genes\";\r\nimport { Color, Scene, Vector2, Vector3 } from \"three\";\r\nimport { Constructor } from \"typings/constructor\";\r\nimport { MaterialInfo } from \"../../../core/cell/materialInfo\";\r\nimport { InventoryRenderer } from \"../InventoryRenderer\";\r\nimport { Renderer } from \"../Renderer\";\r\nimport { WorldRenderer } from \"../WorldRenderer\";\r\nimport { Animation, AnimationController } from \"./Animation\";\r\nimport { CellEffectsRenderer } from \"./CellEffectsRenderer\";\r\nimport { GenePhotosynthesisRenderer } from \"./GenePhotosynthesisRenderer\";\r\nimport { GenePipesRenderer } from \"./GenePipesRenderer\";\r\nimport { GeneRenderer } from \"./GeneRenderer\";\r\nimport { GeneReproducerRenderer } from \"./GeneReproducerRenderer\";\r\nimport { GeneSoilAbsorptionRenderer } from \"./GeneSoilAbsorptionRenderer\";\r\nimport { GeneTransportRenderer } from \"./GeneTransportRenderer\";\r\nimport TileBatcher, { BatchInstance } from \"./tileBatcher\";\r\n\r\nexport class InstancedTileRenderer<T extends Tile = Tile> extends Renderer<T> {\r\n  public static readonly TEMPERATURE_COLORS = {\r\n    [Temperature.Scorching]: new Color(\"orange\"),\r\n    [Temperature.Hot]: new Color(\"orange\").lerp(new Color(\"white\"), 0.5),\r\n    [Temperature.Mild]: new Color(\"white\"),\r\n    [Temperature.Cold]: new Color(\"blue\"),\r\n    [Temperature.Freezing]: new Color(\"rgb(43, 34, 126)\"),\r\n  } as Record<Temperature, Color>;\r\n\r\n  private static readonly ONE = Object.freeze(new Vector2(1, 1));\r\n\r\n  public inventoryRenderer?: InventoryRenderer;\r\n\r\n  private originalColor: Color;\r\n\r\n  private cellEffectsRenderer?: CellEffectsRenderer;\r\n\r\n  private geneRenderer?: GeneRenderer;\r\n\r\n  animation = new AnimationController();\r\n\r\n  scale = new Vector3(1, 1, 1);\r\n\r\n  private color = new Color();\r\n\r\n  private instance: BatchInstance;\r\n\r\n  worldRenderer: WorldRenderer;\r\n\r\n  get materialInfo() {\r\n    return getMaterialInfo(this.target);\r\n  }\r\n\r\n  constructor(target: T, scene: Scene, mito: Mito, batchMesh: TileBatcher, worldRenderer: WorldRenderer) {\r\n    super(target, scene, mito);\r\n    this.worldRenderer = worldRenderer;\r\n    this.instance = batchMesh.getBatchInstance(target);\r\n    if (this.target instanceof GrowingCell) {\r\n      this.scale.set(0.01, 0.01, 1);\r\n    }\r\n\r\n    this.originalColor = (this.materialInfo.color || WHITE).clone();\r\n    if (worldRenderer.inventoryPoints) {\r\n      this.inventoryRenderer = new InventoryRenderer(\r\n        this.target.inventory,\r\n        this.scene,\r\n        this.mito,\r\n        worldRenderer.inventoryPoints\r\n      );\r\n      this.inventoryRenderer.animationOffset = (this.target.pos.x + this.target.pos.y) / 2;\r\n    }\r\n    if (Cell.is(this.target)) {\r\n      // if it takes no time to build, and it was just built, start it off small just for show\r\n      if (this.target.timeToBuild <= 0 && worldRenderer.renderResources && this.target.age < 0.1) {\r\n        this.scale.set(0.01, 0.01, 1);\r\n      }\r\n      this.cellEffectsRenderer = new CellEffectsRenderer(this.target, this.scene, this.mito);\r\n      this.geneRenderer = arrayProxy(\r\n        this.target.geneInstances.map((g) => this.createGeneRendererFor(g)!).filter((g) => g != null)\r\n      );\r\n    }\r\n\r\n    if (this.getLightAmount() > 0) {\r\n      this.commit();\r\n    } else {\r\n      this.commitBlack();\r\n    }\r\n  }\r\n\r\n  public getLightAmount() {\r\n    if (params.debugLevel) {\r\n      return 1;\r\n    }\r\n    return this.target.lightAmount();\r\n  }\r\n\r\n  private createGeneRendererFor(inst: GeneInstance<any>): GeneRenderer<any> | undefined {\r\n    if (inst.isType(GeneSoilAbsorption)) {\r\n      return new GeneSoilAbsorptionRenderer(inst, this);\r\n    } else if (inst.isType(GenePhotosynthesis)) {\r\n      return new GenePhotosynthesisRenderer(inst, this);\r\n    } else if (inst.isType(GeneTransport)) {\r\n      return new GeneTransportRenderer(inst, this);\r\n    } else if (inst.isType(GeneFruit) || inst.isType(GeneSeed)) {\r\n      return new GeneReproducerRenderer(inst, this);\r\n    } else if (inst.isType(GenePipes)) {\r\n      return new GenePipesRenderer(inst, this);\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  commit() {\r\n    if (this.target instanceof GrowingCell) {\r\n      const { start, pos } = this.target;\r\n      const p = start.clone().lerp(pos, 0.5);\r\n      const t1Pos = pos;\r\n      const t = this.scale.x;\r\n      lerp2(p, t1Pos, t);\r\n      this.instance.commitCenter(p.x, p.y, 1);\r\n    } else if (Cell.is(this.target)) {\r\n      this.instance.commitCenter(this.target.pos.x, this.target.pos.y + this.target.droopY, 1);\r\n    } else {\r\n      const z = Air.is(this.target) ? -10 : 0;\r\n      this.instance.commitCenter(this.target.pos.x, this.target.pos.y, z);\r\n    }\r\n    this.instance.commitTexturePosition(this.materialInfo.texturePosition);\r\n    this.instance.commitColor(this.color.r, this.color.g, this.color.b);\r\n    // const dist = this.target.pos.distanceTo(this.mito.world.player.pos);\r\n    // const timeAlive = this.target.age;\r\n    // const alpha = clamp(easeCubicIn(timeAlive * 3 - dist), 0, 1);\r\n    // this.instance.commitAlpha(alpha);\r\n    this.instance.commitScale(this.scale);\r\n  }\r\n\r\n  commitBlack() {\r\n    this.instance.commitTexturePosition(this.materialInfo.texturePosition);\r\n    this.instance.commitColor(0, 0, 0);\r\n    this.instance.commitCenter(this.target.pos.x, this.target.pos.y, 10);\r\n    this.instance.commitScale(this.scale);\r\n  }\r\n\r\n  update() {\r\n    if (this.getLightAmount() > 0) {\r\n      this.updateScale();\r\n      this.updateColor();\r\n\r\n      this.updateInventory();\r\n      this.maybeUpdateCellEffectsRenderer();\r\n\r\n      if (this.geneRenderer) {\r\n        this.geneRenderer.update();\r\n      }\r\n\r\n      if (this.worldRenderer.renderResources) {\r\n        this.animation.update();\r\n      }\r\n      this.commit();\r\n    } else {\r\n      this.commitBlack();\r\n    }\r\n  }\r\n\r\n  maybeUpdateCellEffectsRenderer() {\r\n    if (this.cellEffectsRenderer != null) {\r\n      this.cellEffectsRenderer.update();\r\n    }\r\n  }\r\n\r\n  updateInventory() {\r\n    // will not render without an update\r\n    this.inventoryRenderer?.update();\r\n  }\r\n\r\n  updateScale() {\r\n    if (this.target instanceof GrowingCell) {\r\n      const s = map(this.target.percentGrown, 0, 1, 0.1, 1);\r\n      lerp2(this.scale, { x: s, y: s }, 0.5);\r\n    } else if (Cell.is(this.target) && this.target.isReproductive) {\r\n      // Do nothing; GeneRenderer sets scale for you\r\n    } else {\r\n      lerp2(this.scale, InstancedTileRenderer.ONE, 0.25);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * A few considerations go into color computation:\r\n   *\r\n   * 1) there's the \"original color\" of the materialInfo, or, for Air, get the co2 color as the base\r\n   * 2) that's fed into \"re-color based on temperature\"\r\n   * 3) this is fed into \"darken based on energy\"\r\n   * 4) then fed into \"shade based on darkness\"\r\n   */\r\n  updateColor() {\r\n    const lightAmount = this.getLightAmount();\r\n    if (Air.is(this.target)) {\r\n      const co2Color = getCo2Color(this.target.co2());\r\n      this.originalColor.copy(co2Color);\r\n    }\r\n    this.color.copy(this.originalColor);\r\n\r\n    // modify color based on temperature\r\n    this.modifyColorFromTemperature(this.color);\r\n\r\n    if (Cell.is(this.target) && this.target.energy < 0.5) {\r\n      const amountBlack = map(this.target.energy, 0, 0.5, 1, 0);\r\n      this.color.lerp(BLACK, amountBlack);\r\n    }\r\n\r\n    // darkness overlay\r\n    this.color.lerp(BLACK, map(lightAmount, 0, 1, 0.8, 0));\r\n  }\r\n\r\n  private temperatureColor: Color = InstancedTileRenderer.TEMPERATURE_COLORS[Temperature.Mild];\r\n\r\n  private currentLerp = 0;\r\n\r\n  /**\r\n   * What we want:\r\n   *\r\n   * input: Color\r\n   *\r\n   * output: new color\r\n   *\r\n   * mild: *no* movement from input color\r\n   * cold: target is lerping input color to 25% blue\r\n   */\r\n  private modifyColorFromTemperature(input: Color) {\r\n    const { temperature } = this.target;\r\n    let tColor = InstancedTileRenderer.TEMPERATURE_COLORS[temperature];\r\n    if (tColor !== this.temperatureColor) {\r\n      this.currentLerp = 0;\r\n    }\r\n    const targetLerp = temperature === Temperature.Mild ? 0 : 0.25;\r\n    this.temperatureColor = tColor;\r\n    this.currentLerp = lerp(this.currentLerp, targetLerp, 0.1);\r\n    input.lerp(this.temperatureColor, this.currentLerp);\r\n  }\r\n\r\n  updateHover() {\r\n    this.geneRenderer?.hover?.();\r\n  }\r\n\r\n  growPulseAnimation(): Animation {\r\n    const duration = 0.5 * (Cell.is(this.target) ? this.target.tempo : 1);\r\n    const ease = reversed(easeCubic);\r\n    return (t) => {\r\n      const tNorm = clamp(t / duration, 0, 1);\r\n      const scale = map(ease(tNorm), 0, 1, 1, 1.3);\r\n      this.scale.setScalar(scale);\r\n      return tNorm >= 1;\r\n    };\r\n  }\r\n\r\n  hasActiveNeighbors(\r\n    t: any\r\n  ): t is {\r\n    activeNeighbors: Vector2[];\r\n  } {\r\n    return Array.isArray(t.activeNeighbors);\r\n  }\r\n\r\n  destroy() {\r\n    this.instance.destroy();\r\n    // this.scene.remove(this.mesh);\r\n    this.inventoryRenderer?.destroy();\r\n    this.cellEffectsRenderer?.destroy();\r\n    this.geneRenderer?.destroy();\r\n  }\r\n}\r\n\r\nconst materialInfoMapping = (() => {\r\n  const materials = new Map<Constructor<Tile>, MaterialInfo>();\r\n  materials.set(Air, {\r\n    texturePosition: new Vector2(0, 3),\r\n    color: new Color(\"white\"),\r\n  });\r\n  const siltColor = new Color(\"rgb(112, 89, 44)\");\r\n  materials.set(Sand, {\r\n    texturePosition: new Vector2(1, 0),\r\n    color: new Color(\"rgb(223, 220, 231)\").multiplyScalar(1 / 1.2),\r\n  });\r\n  materials.set(Silt, {\r\n    texturePosition: new Vector2(1, 0),\r\n    color: siltColor,\r\n  });\r\n  materials.set(Clay, {\r\n    texturePosition: new Vector2(1, 0),\r\n    color: siltColor.clone().multiplyScalar(1 / 1.5),\r\n  });\r\n  materials.set(BarrenLand, {\r\n    texturePosition: new Vector2(4, 0),\r\n    color: new Color(\"rgb(193, 159, 92)\"),\r\n  });\r\n  materials.set(Fountain, {\r\n    color: new Color(\"white\"),\r\n    texturePosition: new Vector2(2, 0),\r\n  });\r\n  materials.set(Rock, {\r\n    texturePosition: new Vector2(3, 0),\r\n    color: new Color(\"rgb(63, 77, 84)\"),\r\n  });\r\n  materials.set(DeadCell, {\r\n    texturePosition: new Vector2(0, 1),\r\n    color: new Color(\"rgb(128, 128, 128)\"),\r\n  });\r\n  return materials;\r\n})();\r\n\r\nexport function getMaterialInfo(tile: Tile): MaterialInfo {\r\n  if (tile instanceof GrowingCell) {\r\n    return getMaterialInfo(tile.completedCell);\r\n  } else if (Cell.is(tile)) {\r\n    return tile.type.material;\r\n  } else {\r\n    return materialInfoMapping.get(tile.constructor as Constructor<Tile>)!;\r\n  }\r\n}\r\n\r\nconst getCo2Color = (() => {\r\n  const CO2_COLORSCALE = scaleLinear<string, string>()\r\n    .domain([0.25, 0.5, 1])\r\n    .range([\"hsl(51, 32%, 28%)\", \"hsl(180, 31%, 76%)\", \"hsl(213, 83%, 48%)\"]);\r\n  const cache: Color[] = [];\r\n  const NUM_STEPS = 200;\r\n  for (let i = 0; i <= NUM_STEPS; i++) {\r\n    // creating threejs colors from the d3 colorscale is expensive! cache it once\r\n    cache[i] = new Color(CO2_COLORSCALE(i / NUM_STEPS));\r\n  }\r\n  return (co2: number) => {\r\n    return cache[Math.floor(co2 * NUM_STEPS)];\r\n  };\r\n})();\r\n\r\nconst WHITE = new Color(1, 1, 1);\r\nconst BLACK = new Color(0, 0, 0);\r\n","import { Insect } from \"core/insect\";\r\nimport { arrayRange } from \"math/arrays\";\r\nimport { createSelector } from \"reselect\";\r\nimport { Scene } from \"three\";\r\nimport { Entity, Player, PlayerSeed, StepStats, World } from \"../../core\";\r\nimport { Tile } from \"../../core/tile\";\r\nimport Mito from \"../mito/mito\";\r\nimport { EventLogRenderer } from \"./events/eventLogRenderer\";\r\nimport { InsectRenderer } from \"./InsectRenderer\";\r\nimport { InventoryPoints } from \"./InventoryRenderer\";\r\nimport { PlayerRenderer } from \"./PlayerRenderer\";\r\nimport { PlayerSeedRenderer } from \"./PlayerSeedRenderer\";\r\nimport { Renderer } from \"./Renderer\";\r\nimport { SnowRenderer } from \"./SnowRenderer\";\r\nimport { InstancedTileRenderer } from \"./tile/InstancedTileRenderer\";\r\nimport TileBatcher from \"./tile/tileBatcher\";\r\n\r\nexport class WorldRenderer extends Renderer<World> {\r\n  public renderers = new Map<Entity, Renderer<Entity>>();\r\n\r\n  public readonly tileBatcher: TileBatcher;\r\n\r\n  // private lightEmitter: LightEmitter;\r\n  public eventLogRenderer?: EventLogRenderer;\r\n\r\n  public inventoryPoints?: InventoryPoints;\r\n\r\n  public snow: SnowRenderer[];\r\n\r\n  constructor(target: World, scene: Scene, mito: Mito, public renderResources = true) {\r\n    super(target, scene, mito);\r\n\r\n    // must be added before all particles\r\n    this.tileBatcher = new TileBatcher(this.target);\r\n    scene.add(this.tileBatcher.mesh);\r\n\r\n    this.inventoryPoints = new InventoryPoints();\r\n    scene.add(this.inventoryPoints.waters);\r\n    scene.add(this.inventoryPoints.sugars);\r\n    this.eventLogRenderer = new EventLogRenderer(this);\r\n    if (renderResources) {\r\n    }\r\n    this.snow = arrayRange(3).map((i) => new SnowRenderer(this.target.weather, scene, 1.5 ** (i + 1)));\r\n    // this.lightEmitter = new LightEmitter(this);\r\n  }\r\n\r\n  public getOrCreateRenderer(entity: Entity) {\r\n    const renderer = this.renderers.get(entity);\r\n    if (renderer == null) {\r\n      const created = this.createRendererFor(entity);\r\n      if (created) {\r\n        this.renderers.set(entity, created);\r\n        return created;\r\n      }\r\n    } else {\r\n      return renderer;\r\n    }\r\n  }\r\n\r\n  public createRendererFor<E extends Entity>(object: E): Renderer<Entity> | null {\r\n    if (object instanceof Player) {\r\n      return new PlayerRenderer(object, this.scene, this.mito);\r\n    } else if (object instanceof PlayerSeed) {\r\n      return new PlayerSeedRenderer(object, this.scene, this.mito);\r\n    } else if (object instanceof Tile) {\r\n      return new InstancedTileRenderer(object, this.scene, this.mito, this.tileBatcher, this);\r\n    } else if (object instanceof Insect) {\r\n      return new InsectRenderer(object, this.scene, this.mito);\r\n    } else {\r\n      console.error(`Couldn't find renderer for`, object);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private deleteDeadEntityRenderers = createSelector(\r\n    (stats: StepStats) => stats,\r\n    (stats) => {\r\n      const deletedEntities = stats.deleted;\r\n\r\n      for (const e of deletedEntities) {\r\n        const renderer = this.renderers.get(e);\r\n        if (renderer == null) {\r\n          console.warn(`Couldn't find renderer for ${e}!`);\r\n          continue;\r\n        }\r\n        renderer.destroy();\r\n        this.renderers.delete(e);\r\n      }\r\n    }\r\n  );\r\n\r\n  update(): void {\r\n    this.deleteDeadEntityRenderers(this.target.getLastStepStats());\r\n    // this.lightEmitter.update(1 / 30);\r\n    this.snow.forEach((s) => s.update());\r\n\r\n    // careful - event log renderers rely on state from other renderers (e.g. position\r\n    // of water particle as it's evaporating) that requires it to update before others\r\n    if (this.eventLogRenderer) {\r\n      this.eventLogRenderer.update();\r\n    }\r\n\r\n    this.inventoryPoints?.startFrame();\r\n    const entities = this.target.entities();\r\n    for (let i = 0; i < entities.length; i++) {\r\n      const entity = entities[i];\r\n      const renderer = this.getOrCreateRenderer(entity);\r\n      renderer?.update();\r\n    }\r\n    this.inventoryPoints?.endFrame();\r\n    this.tileBatcher.endFrame();\r\n  }\r\n\r\n  destroy(): void {\r\n    throw new Error(\"Method not implemented.\");\r\n  }\r\n}\r\n","import { TIME_PER_DAY } from \"core/constants\";\r\nimport { Tile } from \"core/tile\";\r\nimport Mito from \"game/mito/mito\";\r\nimport { WorldRenderer } from \"game/renderers/WorldRenderer\";\r\nimport { map } from \"math\";\r\n// import { createRendererFor } from \"sketches/mito/renderers/WorldRenderer\";\r\nimport { OrthographicCamera, Scene, Vector2, WebGLRenderTarget } from \"three\";\r\n\r\n/**\r\n * A Vignette is a visual snapshot of a plant at a specific stage of growth. It's actually\r\n * just an image.\r\n *\r\n * You can control:\r\n *   How big the vignette is.\r\n */\r\nclass VignetteCapturer {\r\n  static renderTarget = new WebGLRenderTarget(1024, 1024);\r\n\r\n  static rtBuffer = new Uint8Array(VignetteCapturer.renderTarget.width * VignetteCapturer.renderTarget.height * 4);\r\n\r\n  static rtCanvas = (() => {\r\n    const c = document.createElement(\"canvas\");\r\n    c.width = VignetteCapturer.renderTarget.width;\r\n    c.height = VignetteCapturer.renderTarget.height;\r\n    return c;\r\n  })();\r\n\r\n  private lastCaptureTime: number = 0;\r\n\r\n  public constructor(public readonly mito: Mito, public pxPerTile = 32, public captureInterval = TIME_PER_DAY) {}\r\n\r\n  isTimeForNewCapture() {\r\n    return this.mito.world.time - this.lastCaptureTime > this.captureInterval;\r\n  }\r\n\r\n  capture() {\r\n    const { renderTarget, rtBuffer, rtCanvas } = VignetteCapturer;\r\n    this.lastCaptureTime = this.mito.world.time;\r\n\r\n    // Cells that form the vignette:\r\n    const picturesqueCells = Array.from(this.mito.world.allCells());\r\n    // .filter(\r\n    //   (t) => t.pos.y < t.world.height / 2 && !(t instanceof GrowingCell)\r\n    // );\r\n\r\n    const [minBounds, maxBounds] = this.getBounds(picturesqueCells);\r\n\r\n    // add all renderers to a scene\r\n    const scene = new Scene();\r\n    const worldRenderer = new WorldRenderer(this.mito.world, scene, this.mito, false);\r\n    const picturesqueRenderers = picturesqueCells.map((c) => {\r\n      const renderer = worldRenderer.createRendererFor(c);\r\n      renderer?.update();\r\n      return renderer;\r\n    });\r\n\r\n    worldRenderer.tileBatcher.endFrame();\r\n\r\n    // webgl render to a renderTarget\r\n    const camera = this.cameraEncompassingBounds([minBounds, maxBounds]);\r\n    const { renderer } = this.mito;\r\n    renderer.setRenderTarget(renderTarget);\r\n    renderer.clear(true, true, true);\r\n    renderer.render(scene, camera);\r\n    renderer.setRenderTarget(null);\r\n\r\n    // buffer will now contain [r1, g1, b1, a1, r2, g2, b2, a2, ...]\r\n    renderer.readRenderTargetPixels(renderTarget, 0, 0, renderTarget.width, renderTarget.height, rtBuffer);\r\n\r\n    // copy buffer pixels into the full resolution canvas\r\n    const context = rtCanvas.getContext(\"2d\")!;\r\n    const imageData: ImageData = context.createImageData(rtCanvas.width, rtCanvas.height);\r\n    const imageBuffer = imageData.data;\r\n    for (let i = 0; i < rtBuffer.length; i++) {\r\n      imageBuffer[i] = rtBuffer[i];\r\n    }\r\n    context.putImageData(imageData, 0, 0);\r\n\r\n    const boundsWidth = maxBounds.x - minBounds.x;\r\n    const boundsHeight = maxBounds.y - minBounds.y;\r\n    const maxDimension = Math.max(boundsWidth, boundsHeight);\r\n\r\n    const roiWidth = map(boundsWidth, 0, maxDimension, 0, 1024);\r\n    const roiHeight = map(boundsHeight, 0, maxDimension, 0, 1024);\r\n    const roiTopLeft = new Vector2(512 - roiWidth / 2, 512 - roiHeight / 2);\r\n\r\n    const dest = document.createElement(\"canvas\");\r\n    dest.width = Math.ceil(boundsWidth * this.pxPerTile);\r\n    dest.height = Math.ceil(boundsHeight * this.pxPerTile);\r\n    const destContext = dest.getContext(\"2d\")!;\r\n    destContext.drawImage(rtCanvas, roiTopLeft.x, roiTopLeft.y, roiWidth, roiHeight, 0, 0, dest.width, dest.height);\r\n\r\n    const img = new Image();\r\n    img.src = dest.toDataURL();\r\n    // debug\r\n    // document.body.appendChild(img);\r\n\r\n    picturesqueRenderers.forEach((t) => {\r\n      t?.destroy();\r\n    });\r\n    return dest;\r\n  }\r\n\r\n  getBounds(tiles: Tile[]): [Vector2, Vector2] {\r\n    const min = new Vector2();\r\n    const max = new Vector2();\r\n    if (tiles[0] != null) {\r\n      min.copy(tiles[0].pos);\r\n      max.copy(tiles[0].pos);\r\n    }\r\n    for (const t of tiles) {\r\n      min.min(t.pos);\r\n      max.max(t.pos);\r\n    }\r\n    // .pos is the center; pad to the edges of each tile\r\n    min.subScalar(0.5);\r\n    max.addScalar(0.5);\r\n    return [min, max];\r\n  }\r\n\r\n  private cameraEncompassingBounds([min, max]: [Vector2, Vector2]) {\r\n    const center = min.clone().lerp(max, 0.5);\r\n\r\n    const width = max.x - min.x;\r\n    const height = max.y - min.y;\r\n\r\n    // now that we know the bounding box, we want the camera to fit that bounding\r\n    // box perfectly while maintaining the aspect ratio of the renderTarget.\r\n    const largerDim = Math.max(width, height);\r\n    const camera = new OrthographicCamera(\r\n      center.x - largerDim / 2,\r\n      center.x + largerDim / 2,\r\n      center.y + largerDim / 2,\r\n      center.y - largerDim / 2,\r\n      -100,\r\n      100\r\n    );\r\n    return camera;\r\n  }\r\n}\r\n\r\nexport default VignetteCapturer;\r\n","import { Cell } from \"../core/tile\";\r\nimport { World } from \"../core/world/world\";\r\nimport Mito from \"./mito/mito\";\r\n\r\nexport interface GameResult {\r\n  oxygenContribution: number;\r\n  status: \"won\" | \"lost\";\r\n  mpEarners: Map<Cell, number>;\r\n  /**\r\n   * Computed - sum of mpEarners.\r\n   */\r\n  mutationPointsPerEpoch: number;\r\n  world: World;\r\n  vignettes?: HTMLCanvasElement[];\r\n}\r\n\r\nexport function maybeGetGameResult(mito: Mito): GameResult | null {\r\n  const { world } = mito;\r\n  if (world.playerSeed != null) {\r\n    return null;\r\n  }\r\n  let anyCellsAlive = false;\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  for (const tile of world.bfsIterator(world.player.pos, world.width * world.height)) {\r\n    if (Cell.is(tile)) {\r\n      anyCellsAlive = true;\r\n      break;\r\n    }\r\n  }\r\n  // const isStandingOnDeadCell = this.tileAt(this.player.pos.x, this.player.pos.y) instanceof DeadCell;\r\n  // const isTimePastOneYear = this.time >= TIME_PER_YEAR;\r\n  // const shouldGameEnd = isStandingOnDeadCell;\r\n  if (anyCellsAlive) {\r\n    return null;\r\n  }\r\n\r\n  // make a decision\r\n  return getDecidedGameResult(mito);\r\n}\r\n\r\nexport function getDecidedGameResult(mito: Mito): GameResult {\r\n  const { world, vignettes } = mito;\r\n  const matureEarners = Array.from(world.mpEarners.entries()).filter(([f, mpEarned]) => mpEarned > 0);\r\n  const shouldWin = matureEarners.length > 0;\r\n\r\n  return {\r\n    mpEarners: world.mpEarners,\r\n    oxygenContribution: world.oxygenPerSecond,\r\n    mutationPointsPerEpoch: matureEarners.map(([, mp]) => mp).reduce((a, b) => a + b, 0),\r\n    status: shouldWin ? \"won\" : \"lost\",\r\n    vignettes,\r\n    world,\r\n  };\r\n}\r\n","import { DIRECTIONS } from \"../../core/directions\";\r\nimport { Action, ActionMove } from \"../../core/player/action\";\r\n\r\nexport const ACTION_CONTINUOUS_KEYMAP: { [key: string]: Action } = {\r\n  // Space: {\r\n  //   type: \"pickup\",\r\n  //   sugar: 30,\r\n  //   water: 30,\r\n  // },\r\n};\r\n\r\nexport const ACTION_INSTANT_KEYMAP: { [key: string]: Action } = {\r\n  // KeyQ: {\r\n  //   type: \"drop\",\r\n  //   sugar: 0,\r\n  //   water: 5,\r\n  // },\r\n  // KeyE: {\r\n  //   type: \"drop\",\r\n  //   sugar: 1,\r\n  //   water: 0,\r\n  // },\r\n};\r\n\r\nexport const MOVEMENT_KEYS: { [key: string]: ActionMove } = {\r\n  KeyW: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.n,\r\n  },\r\n  KeyA: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.w,\r\n  },\r\n  KeyS: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.s,\r\n  },\r\n  KeyD: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.e,\r\n  },\r\n};\r\n\r\nexport const MOVEMENTS = Object.keys(MOVEMENT_KEYS).map((key) => MOVEMENT_KEYS[key]);\r\n","import { Cell } from \"core/cell\";\r\nimport { ActionMove } from \"core/player/action\";\r\nimport { Vector2 } from \"three\";\r\nimport { Mito } from \"../mito/mito\";\r\nimport Keyboard from \"./keyboard\";\r\nimport { ACTION_CONTINUOUS_KEYMAP, ACTION_INSTANT_KEYMAP, MOVEMENT_KEYS } from \"./keymap\";\r\n\r\nexport interface ControlScheme {\r\n  animate(): void;\r\n\r\n  destroy(): void;\r\n\r\n  wouldLeftClickInteract(): boolean;\r\n}\r\n\r\nexport class PlayerControlScheme implements ControlScheme {\r\n  public constructor(public mito: Mito) {\r\n    window.addEventListener(\"keydown\", this.handleKeyDown);\r\n    window.addEventListener(\"mousedown\", this.handleMouseDown);\r\n  }\r\n\r\n  destroy() {\r\n    window.removeEventListener(\"keydown\", this.handleKeyDown);\r\n    window.removeEventListener(\"mousedown\", this.handleMouseDown);\r\n  }\r\n\r\n  handleMouseDown = (event: MouseEvent) => {\r\n    // control inspectedCell on click\r\n    if (event.target === this.mito.canvas) {\r\n      if (this.mito.isPaused) {\r\n        if (event.button === 0) {\r\n          this.mito.pausedInspectedTile = this.mito.getTileAtScreen();\r\n        } else if (event.button === 2) {\r\n          this.mito.pausedInspectedTile = undefined;\r\n        }\r\n        return;\r\n      }\r\n      if (this.mito.inspectedCell != null) {\r\n        this.mito.inspectedCell = undefined;\r\n        return;\r\n      }\r\n      if (event.button === 0) {\r\n        this.leftClick();\r\n      } else if (event.button === 2) {\r\n        this.rightClick();\r\n      }\r\n    }\r\n  };\r\n\r\n  animate() {\r\n    const { mito } = this;\r\n    // keyboard actions\r\n    const moveAction = this.keysToMovement(Keyboard.keyMap);\r\n    if (moveAction) {\r\n      mito.world.player.setAction(moveAction);\r\n    }\r\n    for (const key of Keyboard.keyMap) {\r\n      if (ACTION_CONTINUOUS_KEYMAP[key]) {\r\n        mito.world.player.setAction(ACTION_CONTINUOUS_KEYMAP[key]);\r\n      }\r\n    }\r\n\r\n    // mouse actions\r\n    switch (this.mito.mouse.button) {\r\n      case 0:\r\n        this.leftClickHold();\r\n        break;\r\n    }\r\n  }\r\n\r\n  handleKeyDown = (event: KeyboardEvent) => {\r\n    const { mito } = this;\r\n    const code = event.code;\r\n    if (!event.repeat) {\r\n      if (code === \"Space\") {\r\n        mito.isPaused = !mito.isPaused;\r\n        return;\r\n      }\r\n      if (ACTION_INSTANT_KEYMAP[code]) {\r\n        mito.world.player.setAction(ACTION_INSTANT_KEYMAP[code]);\r\n      } else if (mito.inspectedCell != null && code === \"Escape\") {\r\n        mito.inspectedCell = undefined;\r\n      }\r\n    }\r\n    mito.toolBar.keyDown(event);\r\n  };\r\n\r\n  public keysToMovement(keys: Set<string>): ActionMove | null {\r\n    const dir = new Vector2();\r\n    for (const key of keys) {\r\n      if (MOVEMENT_KEYS[key]) {\r\n        dir.add(MOVEMENT_KEYS[key].dir);\r\n      }\r\n    }\r\n    if (dir.x === 0 && dir.y === 0) {\r\n      return null;\r\n    } else {\r\n      return {\r\n        type: \"move\",\r\n        dir,\r\n      };\r\n    }\r\n  }\r\n\r\n  public leftClick() {\r\n    // no-op for left-clicking\r\n    const { mito } = this;\r\n    const target = mito.highlightedTile;\r\n    if (target == null) {\r\n      return;\r\n    }\r\n    const action = mito.toolBar.leftClick(target);\r\n    if (action != null && !action.continuous) {\r\n      mito.world.player.setAction(action);\r\n    }\r\n  }\r\n\r\n  public rightClick() {\r\n    const tile = this.mito.highlightedTile;\r\n    if (tile == null) {\r\n      return;\r\n    }\r\n    if (Cell.is(tile)) {\r\n      // HACK stop movement\r\n      Keyboard.keyMap.delete(\"KeyW\");\r\n      Keyboard.keyMap.delete(\"KeyS\");\r\n      Keyboard.keyMap.delete(\"KeyA\");\r\n      Keyboard.keyMap.delete(\"KeyD\");\r\n      this.mito.inspectedCell = tile;\r\n    }\r\n  }\r\n\r\n  public leftClickHold() {\r\n    const { mito } = this;\r\n    const target = mito.highlightedTile;\r\n    if (target == null) {\r\n      return;\r\n    }\r\n    const action = mito.toolBar.leftClick(target);\r\n    if (action != null && action.continuous) {\r\n      mito.world.player.setAction(action);\r\n    }\r\n  }\r\n\r\n  public wouldLeftClickInteract() {\r\n    const { mito } = this;\r\n    const tile = mito.highlightedTile;\r\n    // return tile != null && mito.actionBar.leftClick(tile)?.type === \"interact\";\r\n    const type = tile && mito.toolBar.leftClick(tile)?.type;\r\n    return type === \"pickup\" || type === \"drop\";\r\n  }\r\n}\r\n\r\nexport class PlayerSeedControlScheme implements ControlScheme {\r\n  handleKeyDown = (event: KeyboardEvent) => {\r\n    if (event.code === \"Space\") {\r\n      this.popOut();\r\n    }\r\n  };\r\n\r\n  constructor(public mito: Mito) {\r\n    window.addEventListener(\"keydown\", this.handleKeyDown);\r\n  }\r\n\r\n  destroy() {\r\n    window.removeEventListener(\"keydown\", this.handleKeyDown);\r\n  }\r\n\r\n  animate(): void {\r\n    if (this.mito.mouse.button === 0) {\r\n      this.handleLeftClick();\r\n    }\r\n  }\r\n\r\n  public popOut() {\r\n    if (this.mito.world.playerSeed && this.mito.world.time > 3) {\r\n      this.mito.world.playerSeed!.popOut();\r\n      this.mito.controls = new PlayerControlScheme(this.mito);\r\n    }\r\n  }\r\n\r\n  public handleLeftClick(): void {\r\n    if (this.mito.highlightedPosition) {\r\n      const clickedPos = this.mito.highlightedPosition.round();\r\n      if (this.mito.world.playerSeed!.pos.distanceTo(clickedPos) < 0.5) {\r\n        this.popOut();\r\n      }\r\n    }\r\n  }\r\n\r\n  public wouldLeftClickInteract() {\r\n    return false;\r\n  }\r\n}\r\n","import { CellType } from \"core/cell\";\r\nimport { CellArgs } from \"../../core/cell/cell\";\r\nimport { isInteractable } from \"../../core/interactable\";\r\nimport { Action, ActionBuild, ActionPickup } from \"../../core/player/action\";\r\nimport { Tile } from \"../../core/tile\";\r\nimport Mito from \"../mito/mito\";\r\n\r\nexport class ToolBar {\r\n  static DIGIT_KEYS = [\"Digit1\", \"Digit2\", \"Digit3\", \"Digit4\", \"Digit5\", \"Digit6\", \"Digit7\", \"Digit8\"];\r\n\r\n  tools: Record<string, Tool> = {\r\n    KeyQ: TOOL_INTERACT,\r\n  };\r\n\r\n  public currentKey: string = \"KeyQ\";\r\n\r\n  get interactTool() {\r\n    return TOOL_INTERACT;\r\n  }\r\n\r\n  constructor(public mito: Mito) {\r\n    const validCellTypes = mito.world.genome.cellTypes.filter((c) => c.getDuplicateGenes().size === 0);\r\n    for (const index in validCellTypes) {\r\n      const cellType = validCellTypes[index];\r\n      if (cellType.getDuplicateGenes().size === 0) {\r\n        const digitKey = ToolBar.DIGIT_KEYS[index];\r\n        this.tools[digitKey] = makeToolToBuildCellType(cellType);\r\n      }\r\n    }\r\n  }\r\n\r\n  isInteract() {\r\n    return this.currentTool === TOOL_INTERACT;\r\n  }\r\n\r\n  leftClick(target: Tile): Action | undefined {\r\n    return this.currentTool.leftClick(target);\r\n  }\r\n\r\n  get currentTool() {\r\n    return this.tools[this.currentKey];\r\n  }\r\n\r\n  setKey(key: string) {\r\n    if (key in this.tools) {\r\n      if (this.currentKey !== key) {\r\n        this.currentKey = key;\r\n        this.currentTool.onActivate?.(this.mito);\r\n      } else {\r\n        this.currentTool.onReActivate?.(this.mito);\r\n      }\r\n    }\r\n  }\r\n\r\n  keyDown(event: KeyboardEvent) {\r\n    if (event.code === \"Escape\" && this.currentKey !== \"KeyQ\") {\r\n      this.setKey(\"KeyQ\");\r\n    } else if (this.shouldCapture(event)) {\r\n      this.setKey(event.code);\r\n    }\r\n  }\r\n\r\n  shouldCapture(event: KeyboardEvent) {\r\n    return !event.repeat && event.code in this.tools;\r\n  }\r\n}\r\n\r\nexport type Tool = ToolInteract | ToolBuild;\r\n\r\ninterface ToolBase {\r\n  name: string;\r\n  leftClick: (tile: Tile) => Action | undefined;\r\n  onActivate?: (mito: Mito) => void;\r\n  onReActivate?: (mito: Mito) => void;\r\n}\r\n\r\nexport interface ToolInteract extends ToolBase {\r\n  type: \"interact\";\r\n  isTakeAll: boolean;\r\n}\r\n\r\nexport interface ToolBuild extends ToolBase {\r\n  type: \"build\";\r\n  cellType: CellType;\r\n}\r\n\r\nconst TOOL_INTERACT: ToolInteract = {\r\n  name: \"Interact\",\r\n  type: \"interact\",\r\n  isTakeAll: false,\r\n  leftClick(target: Tile): Action | undefined {\r\n    if (this.isTakeAll) {\r\n      const action: ActionPickup = {\r\n        type: \"pickup\",\r\n        sugar: 1,\r\n        target,\r\n        water: 1,\r\n        continuous: true,\r\n      };\r\n      return action;\r\n    } else {\r\n      return isInteractable(target) ? target.interact(null!) : undefined;\r\n    }\r\n  },\r\n  onActivate(mito: Mito) {\r\n    this.isTakeAll = false;\r\n    mito.showInteractToolSwitcher = true;\r\n  },\r\n  onReActivate(mito: Mito) {\r\n    if (mito.showInteractToolSwitcher) {\r\n      // this is handled by the InteractToolSwitcher component\r\n    } else {\r\n      this.isTakeAll = false;\r\n      mito.showInteractToolSwitcher = true;\r\n    }\r\n  },\r\n};\r\n\r\nfunction makeToolToBuildCellType(cellType: CellType): ToolBuild {\r\n  return {\r\n    name: cellType.name,\r\n    type: \"build\",\r\n    cellType,\r\n    leftClick(target: Tile) {\r\n      let args: CellArgs | undefined;\r\n      if (cellType.args) {\r\n        args = { ...cellType.args };\r\n      }\r\n\r\n      const action: ActionBuild = {\r\n        type: \"build\",\r\n        cellType,\r\n        position: target.pos.clone(),\r\n        args,\r\n      };\r\n      return action;\r\n    },\r\n  };\r\n}\r\n\r\n// function maybeDeconstructAction(tile: Tile): ActionDeconstruct | undefined {\r\n//   if (Cell.is(tile) && tile.isReproductive) {\r\n//     return undefined; // disallow deleting reproductive cells\r\n//   }\r\n//   return {\r\n//     type: \"deconstruct\",\r\n//     position: tile.pos,\r\n//   };\r\n// }\r\n","import classNames from \"classnames\";\r\nimport React, { useRef } from \"react\";\r\nimport { Vector2 } from \"three\";\r\nimport uuid from \"uuid\";\r\nimport { Tile } from \"../../core/tile\";\r\nimport { Mito } from \"./mito\";\r\n\r\nexport class WorldDOMElement {\r\n  uuid = uuid();\r\n\r\n  constructor(\r\n    public mito: Mito,\r\n    public positionFn: () => Vector2 | Tile | null,\r\n    public renderFn: () => React.ReactNode\r\n  ) {}\r\n\r\n  render() {\r\n    const posOrTile = this.positionFn();\r\n    if (posOrTile == null) {\r\n      return null;\r\n    }\r\n    let style: React.CSSProperties;\r\n    if (posOrTile instanceof Vector2) {\r\n      const pos = posOrTile;\r\n      const pixelPosition = this.mito.worldToScreen(pos);\r\n      const left = pixelPosition.x;\r\n      const top = pixelPosition.y;\r\n      style = {\r\n        left,\r\n        top,\r\n      };\r\n    } else {\r\n      const tile = posOrTile;\r\n      const worldTopLeft = tile.pos.clone().addScalar(-0.5);\r\n      const worldBottomRight = tile.pos.clone().addScalar(0.5);\r\n      const pixelTopLeft = this.mito.worldToScreen(worldTopLeft);\r\n      const pixelBottomRight = this.mito.worldToScreen(worldBottomRight);\r\n      const left = pixelTopLeft.x;\r\n      const top = pixelTopLeft.y;\r\n      const width = pixelBottomRight.x - left;\r\n      const height = pixelBottomRight.y - top;\r\n      style = {\r\n        left,\r\n        top,\r\n        width,\r\n        height,\r\n      };\r\n    }\r\n    return (\r\n      <div key={this.uuid} style={style}>\r\n        {this.renderFn()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const WorldDOMComponent: React.FC<{\r\n  className?: string;\r\n  mito: Mito;\r\n  positionFn: () => Vector2 | Tile | null;\r\n}> = ({ className, children, mito, positionFn }) => {\r\n  const id = useRef(uuid());\r\n\r\n  const posOrTile = positionFn();\r\n  if (posOrTile == null) {\r\n    return null;\r\n  }\r\n  let style: React.CSSProperties;\r\n  if (posOrTile instanceof Vector2) {\r\n    const pos = posOrTile;\r\n    const pixelPosition = mito.worldToScreen(pos);\r\n    const left = pixelPosition.x;\r\n    const top = pixelPosition.y;\r\n    style = {\r\n      left,\r\n      top,\r\n    };\r\n  } else {\r\n    const tile = posOrTile;\r\n    const worldTopLeft = tile.pos.clone().addScalar(-0.5);\r\n    const worldBottomRight = tile.pos.clone().addScalar(0.5);\r\n    const pixelTopLeft = mito.worldToScreen(worldTopLeft);\r\n    const pixelBottomRight = mito.worldToScreen(worldBottomRight);\r\n    const left = pixelTopLeft.x;\r\n    const top = pixelTopLeft.y;\r\n    const width = pixelBottomRight.x - left;\r\n    const height = pixelBottomRight.y - top;\r\n    style = {\r\n      left,\r\n      top,\r\n      width,\r\n      height,\r\n    };\r\n  }\r\n\r\n  return (\r\n    <div key={id.current} style={style} className={classNames(\"world-dom-component\", className)}>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport Ticker from \"std/ticker\";\r\n\r\nexport class Animate extends React.Component<{\r\n  a: (time: number) => void;\r\n}> {\r\n  private rafid?: number;\r\n\r\n  private animate = (time: number) => {\r\n    this.props.a(time / 1000);\r\n  };\r\n\r\n  render() {\r\n    return null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.rafid = Ticker.addAnimation(this.animate);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.rafid) {\r\n      Ticker.removeAnimation(this.rafid);\r\n    }\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\ninterface SceneObjectProps {\r\n  object: THREE.Object3D;\r\n  parent: THREE.Object3D;\r\n  // children?: SceneObject[];\r\n}\r\nexport class SceneObject extends React.PureComponent<SceneObjectProps, {}> {\r\n  // render() {\r\n  //     if (this.props.children) {\r\n  //         return <>\r\n  //             {\r\n  //                 this.props.children.map((child) => React.cloneElement(child, { parent: this.props.object }))\r\n  //             }\r\n  //         </>;\r\n  //     }\r\n  // }\r\n\r\n  render() {\r\n    return null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.parent.add(this.props.object);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.parent.remove(this.props.object);\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry } from \"three\";\r\nimport { CellType } from \"../../../core/cell/genome\";\r\nimport { textureFromSpritesheet } from \"../../spritesheet\";\r\nimport { SceneObject } from \"./sceneObject\";\r\n\r\nexport const BUILD_BLUEPRINT = (() => {\r\n  const geometry = new PlaneBufferGeometry(1, 1);\r\n  const material = new MeshBasicMaterial({\r\n    side: DoubleSide,\r\n    color: 0xffffff,\r\n    transparent: true,\r\n    opacity: 0.5,\r\n  });\r\n  const mesh = new Mesh(geometry, material);\r\n  mesh.name = \"Build Blueprint\";\r\n  mesh.position.z = 1;\r\n  return mesh;\r\n})();\r\n\r\nexport interface BuildBlueprintProps {\r\n  x: number;\r\n  y: number;\r\n  cellType: CellType;\r\n  scene: THREE.Scene;\r\n}\r\n\r\nexport const BuildBlueprint: React.FC<BuildBlueprintProps> = ({ x, y, cellType, scene }) => {\r\n  const object = React.useMemo(() => BUILD_BLUEPRINT.clone(), []);\r\n\r\n  React.useEffect(() => {\r\n    object.position.x = x;\r\n    object.position.y = y;\r\n  }, [object.position.x, object.position.y, x, y]);\r\n\r\n  React.useEffect(() => {\r\n    const { material } = cellType;\r\n    const { color, texturePosition } = material;\r\n    const texture = textureFromSpritesheet(texturePosition.x, texturePosition.y);\r\n    const mat = object.material as MeshBasicMaterial;\r\n    mat.map = texture;\r\n    mat.color.set(color || new Color(1, 1, 1));\r\n    mat.needsUpdate = true;\r\n  }, [cellType, object.material]);\r\n\r\n  return <SceneObject object={object} parent={scene} />;\r\n};\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\nimport lazy from \"../../../common/lazy\";\r\nimport { SceneObject } from \"./sceneObject\";\r\n\r\nexport const POINT_HIGHLIGHT = lazy(() => {\r\n  const geometry = new THREE.CircleBufferGeometry(0.1, 20);\r\n  const material = new THREE.MeshBasicMaterial({\r\n    color: 0xffffff,\r\n    transparent: true,\r\n    opacity: 0.75,\r\n    side: THREE.DoubleSide,\r\n  });\r\n  const mesh = new THREE.Mesh(geometry, material);\r\n  mesh.position.z = 10;\r\n  return mesh;\r\n  // const edgesGeometry = new THREE.EdgesGeometry(geometry, 1); // or WireframeGeometry( geometry )\r\n  // const material = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.75 });\r\n  // const lineSegments = new THREE.LineSegments(edgesGeometry, material);\r\n  // lineSegments.position.z = 10;\r\n  // return lineSegments;\r\n});\r\n\r\nexport interface PointHighlightProps {\r\n  x: number;\r\n  y: number;\r\n  z?: number;\r\n  scene: THREE.Scene;\r\n}\r\n\r\nexport class PointHighlight extends React.PureComponent<PointHighlightProps, {}> {\r\n  private object = POINT_HIGHLIGHT().clone();\r\n\r\n  render() {\r\n    this.object.position.x = this.props.x;\r\n    this.object.position.y = this.props.y;\r\n    return (\r\n      <>\r\n        {/* <Animate a={((t) => this.object.scale.setScalar(Math.sin(t * 3.7) * 0.04 + 0.94))} /> */}\r\n        <SceneObject object={this.object} parent={this.props.scene} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\nimport lazy from \"../../../common/lazy\";\r\nimport { Animate } from \"./Animate\";\r\nimport { SceneObject } from \"./sceneObject\";\r\n\r\nexport const TILE_HIGHLIGHT = lazy(() => {\r\n  const geometry = new THREE.PlaneBufferGeometry(1, 1);\r\n  const edgesGeometry = new THREE.EdgesGeometry(geometry, 1); // or WireframeGeometry( geometry )\r\n  const material = new THREE.LineBasicMaterial({\r\n    color: 0xffffff,\r\n    transparent: true,\r\n    opacity: 0.75,\r\n  });\r\n  const lineSegments = new THREE.LineSegments(edgesGeometry, material);\r\n  lineSegments.position.z = 10;\r\n  return lineSegments;\r\n});\r\n\r\nexport interface TileHighlightProps {\r\n  x: number;\r\n  y: number;\r\n  scene: THREE.Scene;\r\n}\r\n\r\nexport class TileHighlight extends React.PureComponent<TileHighlightProps, {}> {\r\n  private object = TILE_HIGHLIGHT().clone();\r\n\r\n  render() {\r\n    this.object.position.x = this.props.x;\r\n    this.object.position.y = this.props.y;\r\n    return (\r\n      <>\r\n        <Animate a={(t) => this.object.scale.setScalar(Math.sin(t * 3.7) * 0.04 + 0.94)} />\r\n        <SceneObject object={this.object} parent={this.props.scene} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { World } from \"../core\";\r\nimport { Tile } from \"../core/tile\";\r\n\r\nexport function findBuildCandidateTiles(world: World, predicate?: (tile: Tile) => boolean) {\r\n  const entityPredicate: (tile: Tile) => boolean = (t) => world.player.isWalkable(t);\r\n  const candidates: Set<Tile> = new Set();\r\n  for (const entity of world.entities()) {\r\n    if (entity instanceof Tile && entityPredicate(entity)) {\r\n      for (const [, neighbor] of world.tileNeighbors(entity.pos)) {\r\n        if (world.player.canBuildAt(neighbor)) {\r\n          if (predicate == null) {\r\n            candidates.add(neighbor);\r\n          } else if (predicate(neighbor)) {\r\n            candidates.add(neighbor);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return candidates;\r\n}\r\n","import classNames from \"classnames\";\r\nimport Keyboard from \"game/input/keyboard\";\r\nimport { WorldDOMComponent } from \"game/mito/WorldDOMElement\";\r\nimport { BuildBlueprint, PointHighlight, TileHighlight } from \"game/renderers/r3\";\r\nimport * as React from \"react\";\r\nimport { findBuildCandidateTiles } from \"std/worldUtils\";\r\nimport { Tile } from \"../../../core/tile\";\r\nimport Mito from \"../../mito/mito\";\r\nimport \"./Hover.scss\";\r\n\r\ninterface HoverProps {\r\n  mito: Mito;\r\n}\r\n\r\nexport class Hover extends React.Component<HoverProps> {\r\n  get scene() {\r\n    return this.props.mito.scene;\r\n  }\r\n\r\n  public render() {\r\n    const isTakingLongAction = this.props.mito.world.player.isTakingLongAction();\r\n    const isUsingShift = Keyboard.keyMap.has(\"ShiftLeft\");\r\n    if (isTakingLongAction || isUsingShift) {\r\n      return null;\r\n    }\r\n    let { highlightedPosition, highlightedTile } = this.props.mito;\r\n    if (this.props.mito.isPaused) {\r\n      highlightedTile = this.props.mito.getTileAtScreen();\r\n    }\r\n    return (\r\n      <>\r\n        {highlightedPosition ? (\r\n          <PointHighlight x={highlightedPosition.x} y={highlightedPosition.y} scene={this.scene} />\r\n        ) : null}\r\n        {this.maybeRenderBuildBlueprint(highlightedTile)}\r\n        {this.maybeRenderTileHighlight(highlightedTile)}\r\n        {this.maybeRenderTutorialBuildHighlights(highlightedTile)}\r\n        {/* {this.maybeRenderPath()} */}\r\n      </>\r\n    );\r\n  }\r\n\r\n  public maybeRenderTileHighlight(tile?: Tile) {\r\n    if (tile == null) {\r\n      return;\r\n    }\r\n    const { mito } = this.props;\r\n    const leftClickType = mito.toolBar.leftClick(tile)?.type;\r\n    const showBuildBlueprint = leftClickType === \"pickup\" || leftClickType === \"drop\";\r\n    const tileHighlight = showBuildBlueprint ? (\r\n      <TileHighlight x={tile.pos.x} y={tile.pos.y} scene={this.props.mito.scene} />\r\n    ) : null;\r\n    return tileHighlight;\r\n  }\r\n\r\n  public maybeRenderBuildBlueprint(tile?: Tile) {\r\n    const { mito } = this.props;\r\n    if (tile == null || mito.isPaused) {\r\n      return;\r\n    }\r\n    const action = mito.toolBar.leftClick(tile);\r\n    if (action != null && action.type === \"build\") {\r\n      const isBuildValid = mito.world.player.canBuildAt(tile);\r\n      return (\r\n        <>\r\n          <WorldDOMComponent\r\n            className={classNames(\"build-drop-shadow\", { valid: isBuildValid })}\r\n            mito={mito}\r\n            positionFn={() => tile}\r\n          ></WorldDOMComponent>\r\n          <BuildBlueprint x={tile.pos.x} y={tile.pos.y} cellType={action.cellType} scene={this.props.mito.scene} />\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\n  maybeRenderTutorialBuildHighlights(tile?: Tile) {\r\n    const { mito } = this.props;\r\n    if (tile == null || mito.isPaused || !mito.isFirstPlaythrough) {\r\n      return;\r\n    }\r\n    const action = mito.toolBar.leftClick(tile);\r\n    if (action != null && action.type === \"build\") {\r\n      const buildCandidateHighlights: JSX.Element[] = [];\r\n      for (const candidate of findBuildCandidateTiles(this.props.mito.world)) {\r\n        buildCandidateHighlights.push(\r\n          <TileHighlight\r\n            key={candidate.pos.x + \",\" + candidate.pos.y}\r\n            x={candidate.pos.x}\r\n            y={candidate.pos.y}\r\n            scene={this.scene}\r\n          />\r\n        );\r\n      }\r\n      return buildCandidateHighlights;\r\n    }\r\n  }\r\n}\r\n","import classNames from \"classnames\";\r\nimport * as React from \"react\";\r\nimport \"./HotkeyButton.scss\";\r\n\r\ninterface HotkeyButtonProps extends React.HTMLProps<HTMLDivElement> {\r\n  hotkey: string;\r\n}\r\n\r\nexport function HotkeyButton({ hotkey, className, onClick, ...restProps }: HotkeyButtonProps) {\r\n  const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    onClick && onClick(e);\r\n    ensureCanvasFocus(e);\r\n  };\r\n  return (\r\n    <div className={classNames(\"hotkey-button\", className)} onClick={handleClick} {...restProps}>\r\n      <span className=\"hotkey\">{hotkey}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ensureCanvasFocus(e: React.SyntheticEvent<any>) {\r\n  e.preventDefault();\r\n  const canvas = document.getElementsByTagName(\"canvas\")[0];\r\n  canvas.focus();\r\n}\r\n","/* eslint-disable jsx-a11y/accessible-emoji */\r\nimport { Tooltip } from \"@blueprintjs/core\";\r\nimport { nf } from \"common/formatters\";\r\nimport {\r\n  CancerEffect,\r\n  Cell,\r\n  CellEffectConstructor,\r\n  describeCellInteraction,\r\n  FreezeEffect,\r\n  Gene,\r\n  GeneInstance,\r\n  GrowingCell,\r\n} from \"core/cell\";\r\nimport { Air, Fountain, Soil, Tile } from \"core/tile\";\r\nimport Keyboard from \"game/input/keyboard\";\r\nimport * as React from \"react\";\r\nimport {\r\n  GeneFruit,\r\n  GeneOsmosis,\r\n  GenePhotosynthesis,\r\n  GeneSeed,\r\n  GeneSoilAbsorption,\r\n  PhotosynthesisState,\r\n  ReproducerState,\r\n  SoilAbsorptionState,\r\n} from \"std/genes\";\r\nimport { InventoryBar } from \"./InventoryBar\";\r\nimport TemperatureGauge from \"./TemperatureGauge\";\r\nimport \"./TileDetails.scss\";\r\n\r\ninterface TileDetailsProps {\r\n  tile?: Tile;\r\n}\r\n\r\nfunction formatSeconds(seconds: number, fractionDigits = 1) {\r\n  return `${Math.max(0, seconds).toFixed(fractionDigits)}s`;\r\n}\r\n\r\nexport class TileDetails extends React.Component<TileDetailsProps> {\r\n  public render() {\r\n    const { tile } = this.props;\r\n    if (!tile) {\r\n      return null;\r\n    }\r\n    return (\r\n      <div className=\"tile-details\">\r\n        {this.tileInfo(tile)}\r\n        {this.cellInfo(tile)}\r\n        {this.growingCellInfo(tile)}\r\n        {this.airInfo(tile)}\r\n        {this.soilInfo(tile)}\r\n        {this.fountainInfo(tile)}\r\n        {this.interactInfo(tile)}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private interactInfo(tile: Tile) {\r\n    if (Cell.is(tile)) {\r\n      const leftClickEl =\r\n        tile.type.interaction != null ? (\r\n          <div className=\"interact-info first\">Left click - {describeCellInteraction(tile.type.interaction)}.</div>\r\n        ) : null;\r\n      return (\r\n        <div className=\"interact-infos\">\r\n          {leftClickEl}\r\n          <div className=\"interact-info\">Right click - more options.</div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private cellInfo(tile: Tile) {\r\n    if (Cell.is(tile)) {\r\n      const secondsPerUpkeep = 1 / tile.energyUpkeep;\r\n      const secondsRemaining = secondsPerUpkeep != null ? tile.energy * secondsPerUpkeep : null;\r\n      const secondsRemainingEl = secondsRemaining ? <>({Math.floor(secondsRemaining)} seconds remaining)</> : null;\r\n      const energyEl = (\r\n        <Tooltip content={\"Energy keeps your cell alive, and is used for cell operations.\"}>\r\n          <div className=\"info-energy\">\r\n            💚&nbsp;{nf(tile.energy * 100, 3)}% Energy {secondsRemainingEl}\r\n          </div>\r\n        </Tooltip>\r\n      );\r\n      return (\r\n        <>\r\n          {energyEl}\r\n          {Keyboard.keyMap.has(\"ShiftLeft\") ? <>Alive for {Math.floor(tile.age)} seconds.</> : null}\r\n          {tile.droopY * 200 > 1 ? <div className=\"info-cell\">{(tile.droopY * 200).toFixed(0)}% droop</div> : null}\r\n          {this.cellEffects(tile)}\r\n          {this.geneInfos(tile)}\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\n  private geneInfos(cell: Cell) {\r\n    return (\r\n      <>\r\n        {cell.geneInstances.map((gene, index) => {\r\n          if (gene.isType(GeneSoilAbsorption)) {\r\n            return <React.Fragment key={index}>{this.soilAbsorptionInfo(gene.state)}</React.Fragment>;\r\n          } else if (gene.isType(GenePhotosynthesis)) {\r\n            return <React.Fragment key={index}>{this.photosynthesisInfo(gene.state)}</React.Fragment>;\r\n          } else if (gene.isType(GeneFruit) || gene.isType(GeneSeed)) {\r\n            return <React.Fragment key={index}>{this.reproducerInfo(gene)}</React.Fragment>;\r\n          } else if (gene.isType(GeneOsmosis)) {\r\n            return <React.Fragment key={index}>{this.osmosisInfo(gene.state)}</React.Fragment>;\r\n          } else {\r\n            return null;\r\n          }\r\n        })}\r\n      </>\r\n    );\r\n  }\r\n\r\n  private soilAbsorptionInfo(state: SoilAbsorptionState) {\r\n    return (\r\n      <div className=\"info-root\">\r\n        <div>Absorbs in {formatSeconds(state.cooldown)}.</div>\r\n        <div>{state.totalSucked.toFixed(1)} total water absorbed so far.</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private osmosisInfo({ isOsmosising }: any) {\r\n    return isOsmosising ? <div className=\"info-osmosis\">Osmotic</div> : null;\r\n  }\r\n\r\n  private photosynthesisInfo(state: PhotosynthesisState) {\r\n    return (\r\n      <div className=\"info-leaf\">\r\n        <div>{(state.averageChancePerSecond * 100).toFixed(1)}% chance to photosynthesize per second.</div>\r\n        <div>{(1 / state.averageConversionRate).toFixed(2)} water per sugar.</div>\r\n        <div>{state.totalSugarProduced.toFixed(2)} total sugar produced so far.</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private reproducerInfo(instance: GeneInstance<Gene<ReproducerState, any>>) {\r\n    const { state, props } = instance;\r\n    return (\r\n      <div>\r\n        {nf(state.energyRecieved, 3)}/{props.neededEnergy} energy absorbed.\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private airInfo(tile: Tile) {\r\n    if (Air.is(tile)) {\r\n      return (\r\n        <div className=\"info-air\">\r\n          <Tooltip content={\"Sunlight increases photosynthesis rate.\"}>\r\n            <div>☀️ {nf(tile.sunlight() * 100, 2)}%</div>\r\n          </Tooltip>\r\n          <Tooltip content=\"CO2 improves the water to sugar ratio.\">\r\n            <div className=\"co2-container\">\r\n              <span className=\"co2\">\r\n                CO<sub>2</sub>\r\n              </span>{\" \"}\r\n              {nf(tile.co2() * 100, 2)}%\r\n            </div>\r\n          </Tooltip>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private soilInfo(tile: Tile) {\r\n    if (tile instanceof Soil) {\r\n      return (\r\n        <div className=\"info-soil\">\r\n          <Tooltip\r\n            content={\r\n              \"Deeper soil restricts water movement, is harder to see through, and is less affected by the outside temperature.\"\r\n            }\r\n          >\r\n            <div>Depth {tile.depth}.</div>\r\n          </Tooltip>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private fountainInfo(tile: Tile) {\r\n    if (tile instanceof Fountain) {\r\n      return (\r\n        <div className=\"info-fountain\">\r\n          <div>{formatSeconds(tile.cooldown)} until next water.</div>\r\n          <div>{tile.waterRemaining} water left.</div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private tileInfo(tile: Tile) {\r\n    return (\r\n      <div className=\"info-tile\">\r\n        <div className=\"info-tile-name\">{tile.displayName}</div>\r\n        <TemperatureGauge temperature={tile.temperature} />\r\n        <Tooltip content=\"Inventory is how much water and sugar this Tile can hold.\">\r\n          <InventoryBar\r\n            water={tile.inventory.water}\r\n            sugar={tile.inventory.sugar}\r\n            capacity={tile.inventory.capacity}\r\n            format=\"icons\"\r\n            colored={false}\r\n            capacityBasedWidth\r\n          />\r\n        </Tooltip>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private cellEffects(cell: Cell) {\r\n    const { effects } = cell;\r\n    if (effects.length > 0) {\r\n      const descriptors = effects\r\n        .map((e) => {\r\n          const name = (e.constructor as CellEffectConstructor).displayName;\r\n          if (e instanceof FreezeEffect) {\r\n            return `${nf(e.percentFrozen * 100, 2)}% ${name}!`;\r\n          } else if (e instanceof CancerEffect) {\r\n            return `${name}! ${nf(e.timeToDuplicate, 2)}s until spread.`;\r\n          } else {\r\n            return name;\r\n          }\r\n        })\r\n        .join(\", \");\r\n      return <div className=\"info-cell-effects\">{descriptors}</div>;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private growingCellInfo(tile: Tile) {\r\n    if (tile instanceof GrowingCell) {\r\n      return <div className=\"info-growing-cell\">{nf(tile.percentGrown * 100, 2)}% grown.</div>;\r\n    }\r\n  }\r\n}\r\n","import { Player } from \"core\";\r\nimport { Cell } from \"core/tile\";\r\nimport { ResourceIcon } from \"game/ui/common/ResourceIcon\";\r\nimport React from \"react\";\r\nimport \"./CellInspector.scss\";\r\n\r\nexport const CellInspector: React.FC<{\r\n  cell: Cell;\r\n  player: Player;\r\n  onDone: () => void;\r\n}> = ({ cell, player, onDone }) => {\r\n  return (\r\n    <>\r\n      <div className=\"cell-inspector left\">\r\n        {/* <div>\r\n          <h3>{cell.displayName}</h3>\r\n        </div> */}\r\n        <div className=\"buttons\">\r\n          <div className=\"resources\">\r\n            <div className=\"resource-row\">\r\n              <button\r\n                disabled={player.inventory.water === 0}\r\n                onMouseUpCapture={(e) => {\r\n                  player.inventory.give(cell.inventory, cell.inventory.space(), 0);\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  onDone();\r\n                }}\r\n              >\r\n                Give&nbsp;\r\n                <ResourceIcon name=\"water\" />\r\n              </button>\r\n              <button\r\n                disabled={cell.inventory.water === 0}\r\n                onMouseUpCapture={(e) => {\r\n                  cell.inventory.give(player.inventory, cell.inventory.water, 0);\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  onDone();\r\n                }}\r\n              >\r\n                Take&nbsp;\r\n                <ResourceIcon name=\"water\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"resource-row\">\r\n              <button\r\n                disabled={player.inventory.sugar === 0}\r\n                onMouseUpCapture={(e) => {\r\n                  player.inventory.give(cell.inventory, 0, cell.inventory.space());\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  onDone();\r\n                }}\r\n              >\r\n                Give&nbsp;\r\n                <ResourceIcon name=\"sugar\" />\r\n              </button>\r\n              <button\r\n                disabled={cell.inventory.sugar === 0}\r\n                onMouseUpCapture={(e) => {\r\n                  cell.inventory.give(player.inventory, 0, cell.inventory.sugar);\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  onDone();\r\n                }}\r\n              >\r\n                Take&nbsp;\r\n                <ResourceIcon name=\"sugar\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"cell-inspector right\">\r\n        <button className=\"deconstruct\" onClick={() => player.setAction({ type: \"deconstruct\", position: cell.pos })}>\r\n          Deconstruct\r\n        </button>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n","import { Overlay, Tab, Tabs } from \"@blueprintjs/core\";\r\nimport { useHotkey } from \"common/useHotkey\";\r\nimport { getDecidedGameResult } from \"game/gameResult\";\r\nimport React from \"react\";\r\nimport { FaArrowLeft } from \"react-icons/fa\";\r\nimport { GoGear } from \"react-icons/go\";\r\nimport \"./GameMenu.scss\";\r\nimport { HUDProps } from \"./HUD\";\r\n\r\nexport const GameMenu: React.FC<HUDProps> = ({ mito }) => {\r\n  const [isOpen, setIsOpen] = React.useState(false);\r\n  const handleOverlayClose = React.useCallback(() => {\r\n    setIsOpen(false);\r\n  }, []);\r\n  const handleGameMenuToggleClick = React.useCallback(() => {\r\n    setIsOpen(true);\r\n  }, []);\r\n  const toggleMenu = React.useCallback(() => setIsOpen((open) => !open), []);\r\n  const handleAbandonPlant = React.useCallback(() => {\r\n    mito.onWinLoss(getDecidedGameResult(mito));\r\n  }, [mito]);\r\n  useHotkey(\"Escape\", toggleMenu);\r\n\r\n  const menuPanel = (\r\n    <div>\r\n      <div className=\"option abandon\" onClick={handleAbandonPlant}>\r\n        {mito.isFirstPlaythrough ? \"Restart\" : \"Abandon\"} Plant\r\n      </div>\r\n    </div>\r\n  );\r\n  return (\r\n    <>\r\n      <button className=\"game-menu-toggle game-options-button\" onClick={handleGameMenuToggleClick}>\r\n        <GoGear />\r\n      </button>\r\n      <Overlay\r\n        isOpen={isOpen}\r\n        onClose={handleOverlayClose}\r\n        canEscapeKeyClose={false}\r\n        canOutsideClickClose={false}\r\n        className=\"bp3-dark\"\r\n        backdropClassName=\"game-menu-backdrop\"\r\n      >\r\n        <div className=\"game-menu\">\r\n          <Tabs defaultSelectedTabId=\"menu\">\r\n            <div className=\"esc\" onClick={handleOverlayClose}>\r\n              <FaArrowLeft />\r\n            </div>\r\n            <Tab id=\"menu\" title=\"Menu\" panel={menuPanel} />\r\n            <Tab id=\"attr\" title=\"Attribution\" panel={<Attribution />} />\r\n          </Tabs>\r\n        </div>\r\n      </Overlay>\r\n    </>\r\n  );\r\n};\r\n\r\nconst Attribution = () => {\r\n  return (\r\n    <div className=\"attribution\">\r\n      <p>\r\n        In-game Tileset:{\" \"}\r\n        <a href=\"http://kenney.nl/assets?s=roguelike\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n          Kenney.nl Roguelike Assets\r\n        </a>\r\n      </p>\r\n      <p>\r\n        Photosynthesis pop sound:{\" \"}\r\n        <a href=\"http://soundbible.com/2067-Blop.html\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n          Blop by Mark DiAngelo\r\n        </a>{\" \"}\r\n        (<a href=\"https://creativecommons.org/licenses/by/3.0/us/\">CC BY 3.0 US</a>)\r\n      </p>\r\n      <p>\r\n        Fruit icon:{\" \"}\r\n        <a href=\"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm\">Designed by Freepik</a>\r\n      </p>\r\n      <p>\r\n        Part of 7drl 2018:{\" \"}\r\n        <a href=\"http://7drl.org/\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n          http://7drl.org/\r\n        </a>\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n","import React from \"react\";\r\n\r\nexport function useHotkey(key: string, action: (event: KeyboardEvent) => void) {\r\n  React.useEffect(() => {\r\n    const cb = (event: KeyboardEvent) => {\r\n      if (key === event.code) {\r\n        action(event);\r\n      }\r\n    };\r\n    window.addEventListener(\"keyup\", cb);\r\n    return () => {\r\n      window.removeEventListener(\"keyup\", cb);\r\n    };\r\n  }, [action, key]);\r\n}\r\n","import classNames from \"classnames\";\r\nimport Keyboard from \"game/input/keyboard\";\r\nimport { spritesheetLoaded } from \"game/spritesheet\";\r\nimport IconCell, { ActionBarItem } from \"game/ui/common/IconCell\";\r\nimport * as React from \"react\";\r\nimport { Vector2 } from \"three\";\r\nimport { Tool, ToolBar, ToolBuild } from \"../../../input/toolBar\";\r\nimport { HotkeyButton } from \"../HotkeyButton\";\r\nimport \"./ToolBarUI.scss\";\r\n\r\nexport const ToolBarUI: React.FC<{ bar: ToolBar }> = ({ bar }) => {\r\n  const keys = Object.keys(bar.tools);\r\n  return (\r\n    <div className=\"tool-bar\">\r\n      <div className=\"tool-bar-items\">\r\n        {keys.map((code) => {\r\n          return (\r\n            <ToolBarItem key={code} bar={bar} code={code} selected={bar.currentKey === code} tool={bar.tools[code]} />\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst ToolBarItem: React.FC<{ bar: ToolBar; code: string; selected: boolean; tool: Tool }> = ({\r\n  bar,\r\n  code,\r\n  selected,\r\n  tool,\r\n}) => {\r\n  const onClick = React.useCallback(() => {\r\n    bar.setKey(code);\r\n  }, [bar, code]);\r\n\r\n  const hotkey = code.charAt(code.length - 1);\r\n  const itemIcon =\r\n    tool.type === \"interact\" ? (\r\n      <>\r\n        <InteractToolItem onClick={onClick} isTakeAll={tool.isTakeAll} />\r\n        <HotkeyButton hotkey={hotkey} onClick={onClick} />\r\n      </>\r\n    ) : (\r\n      <>\r\n        <ToolBuildIcon onClick={onClick} tool={tool} spritesheetLoaded={spritesheetLoaded} />\r\n        <HotkeyButton hotkey={hotkey} onClick={onClick} />\r\n      </>\r\n    );\r\n\r\n  return <div className={classNames(\"tool-bar-item\", { selected })}>{itemIcon}</div>;\r\n};\r\n\r\nexport const InteractToolItem: React.FC<{ onClick?: () => void; isTakeAll: boolean }> = ({ onClick, isTakeAll }) => (\r\n  <ActionBarItem onClick={onClick} className={classNames(\"interact-tool-icon\", { \"take-all\": isTakeAll })}>\r\n    {isTakeAll ? \"Take All\" : \"Interact\"}\r\n  </ActionBarItem>\r\n);\r\n\r\nexport interface CellBarItemProps {\r\n  onClick: () => void;\r\n  spritesheetLoaded: boolean;\r\n  tool: ToolBuild;\r\n}\r\n\r\nconst ToolBuildIcon: React.FC<CellBarItemProps> = ({ onClick, spritesheetLoaded, tool }) => {\r\n  const argsChildren: JSX.Element[] = [];\r\n  const type = tool.cellType;\r\n  if (type.args && type.args.direction) {\r\n    argsChildren.push(<TransportDirArrow key={argsChildren.length} dir={type.args.direction} />);\r\n  }\r\n  return (\r\n    <IconCell\r\n      onClick={onClick}\r\n      cellType={type}\r\n      spritesheetLoaded={spritesheetLoaded}\r\n      showCosts={Keyboard.keyMap.has(\"ShiftLeft\")}\r\n    >\r\n      {type.name}\r\n      {argsChildren}\r\n    </IconCell>\r\n  );\r\n};\r\n\r\nconst TransportDirArrow: React.FC<{ dir: Vector2 }> = ({ dir }) => {\r\n  return <div className=\"transport-dir-arrow\" style={{ transform: `rotate(${dir.angle()}rad)` }}></div>;\r\n};\r\n","import classNames from \"classnames\";\r\nimport { sleep } from \"common/promise\";\r\nimport React, { useEffect } from \"react\";\r\nimport Mito from \"../../../mito/mito\";\r\nimport { HotkeyButton } from \"../HotkeyButton\";\r\nimport \"./InteractToolSwitcher.scss\";\r\nimport { InteractToolItem } from \"./ToolBarUI\";\r\n\r\nexport const InteractToolSwitcher: React.FC<{\r\n  mito: Mito;\r\n}> = ({ mito }) => {\r\n  useEffect(() => {\r\n    sleep(500).then(() => {\r\n      mito.showInteractToolSwitcher = false;\r\n    });\r\n  }, [mito.showInteractToolSwitcher]);\r\n  const interactTool = mito.toolBar.interactTool;\r\n  useEffect(() => {\r\n    const handleKeyDown = (event: KeyboardEvent) => {\r\n      if (!event.repeat && event.code === \"KeyQ\") {\r\n        // switch the tool\r\n        interactTool.isTakeAll = true;\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => {\r\n      window.removeEventListener(\"keydown\", handleKeyDown);\r\n    };\r\n  }, [interactTool.isTakeAll]);\r\n  return (\r\n    <div className={classNames(\"interact-tool-switcher\", { \"take-all\": interactTool.isTakeAll })}>\r\n      <div className=\"item\">\r\n        <HotkeyButton hotkey=\"Q\" />\r\n        <InteractToolItem isTakeAll={false} />\r\n      </div>\r\n      <div className=\"item\">\r\n        <HotkeyButton hotkey=\"QQ\" />\r\n        <InteractToolItem isTakeAll={true} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import * as React from \"react\";\r\nimport uuid from \"uuid\";\r\nexport const InvalidActionMessage: React.FC<{\r\n  invalidAction: {\r\n    message: string;\r\n  };\r\n}> = React.memo(({ invalidAction }) => {\r\n  // get new id on every render (aka reference equal invalidAction)\r\n  // to trigger animation each time\r\n  const id = uuid();\r\n  return (\r\n    <div className=\"hud-below-center\">\r\n      <div className=\"invalid-action\" key={id}>\r\n        {invalidAction.message}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n","import { Popover } from \"@blueprintjs/core\";\r\nimport { Tile } from \"core/tile\";\r\nimport { WorldDOMComponent } from \"game/mito/WorldDOMElement\";\r\nimport React from \"react\";\r\nimport Mito from \"../../../mito/mito\";\r\nimport { TileDetails } from \"../TileDetails\";\r\n\r\nexport const PausedTileDetailsPopover = ({ mito, tile }: { mito: Mito; tile: Tile }) => {\r\n  const positionFn = React.useCallback(() => tile, [tile]);\r\n  return (\r\n    <WorldDOMComponent mito={mito} positionFn={positionFn} className=\"paused-popover\">\r\n      <Popover\r\n        content={<TileDetails key={tile.toString()} tile={tile} />}\r\n        usePortal={false}\r\n        autoFocus={false}\r\n        isOpen\r\n        minimal\r\n      >\r\n        <span />\r\n      </Popover>\r\n    </WorldDOMComponent>\r\n  );\r\n};\r\n","import { Temperature } from \"core/temperature\";\r\nimport * as React from \"react\";\r\nimport { Season, SEASON_NAMES } from \"../../../../core\";\r\nimport TemperatureGauge from \"../TemperatureGauge\";\r\nimport \"./SeasonsTracker.scss\";\r\n\r\nexport default function SeasonsTracker({\r\n  time,\r\n  season,\r\n  temperature,\r\n}: {\r\n  time: number;\r\n  season: Season;\r\n  temperature: Temperature;\r\n}) {\r\n  return (\r\n    <div className=\"seasons-tracker\">\r\n      <div className=\"season-display\">\r\n        {season.year > 0 ? <>Year {season.year + 1}, </> : null}\r\n        {SEASON_NAMES[season.season]}, Month {season.month}\r\n        <br />\r\n        Day {season.day}\r\n        <br />\r\n        <TemperatureGauge temperature={temperature} showMild />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import classNames from \"classnames\";\r\nimport { Player, StepStats } from \"core\";\r\nimport { Action } from \"core/player/action\";\r\nimport { Cell } from \"core/tile\";\r\nimport { EventPhotosynthesis } from \"core/tile/tileEvent\";\r\nimport Mito from \"game/mito/mito\";\r\nimport * as React from \"react\";\r\nimport { GeneSeed } from \"std/genes\";\r\nimport { HUDProps } from \".\";\r\nimport { HotkeyButton } from \"../HotkeyButton\";\r\nimport \"./Tutorial.scss\";\r\n\r\nexport const Tutorial = ({ mito, isViewerOpen }: HUDProps & { isViewerOpen: boolean }) => {\r\n  const [activeIndex, setActiveIndex] = React.useState(0);\r\n  const handleDone = React.useCallback(\r\n    (index) => {\r\n      if (index === activeIndex) {\r\n        setActiveIndex((i) => i + 1);\r\n      }\r\n    },\r\n    [activeIndex]\r\n  );\r\n  return (\r\n    <div className=\"hud-left\">\r\n      {tutorialSteps.map((Step, index) => (\r\n        <TutorialStepContainer\r\n          mito={mito}\r\n          active={activeIndex === index}\r\n          isViewerOpen={isViewerOpen}\r\n          Step={Step}\r\n          index={index}\r\n          isFirst={index === 0}\r\n          onDone={handleDone}\r\n          key={index}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nfunction useCountActions(player: Player, predicate: (action: Action) => boolean) {\r\n  const [count, setCount] = React.useState(0);\r\n  React.useEffect(() => {\r\n    const cb = (action: Action) => {\r\n      if (predicate(action)) {\r\n        setCount((c) => c + 1);\r\n      }\r\n    };\r\n    player.on(\"action\", cb);\r\n    return () => {\r\n      player.off(\"action\", cb);\r\n    };\r\n  });\r\n  return count;\r\n}\r\n\r\nfunction useCountActionTarget(player: Player, predicate: (a: Action) => boolean, target: number) {\r\n  const count = useCountActions(player, predicate);\r\n  return count / target;\r\n}\r\n\r\ninterface TutorialStepProps {\r\n  player: Player;\r\n  setPercentDone: (percent: number) => void;\r\n  active: boolean;\r\n  isViewerOpen: boolean;\r\n}\r\n\r\nconst build = (name: string) => {\r\n  return (action: Action) => action.type === \"build\" && action.cellType.name === name;\r\n};\r\n\r\nconst tutorialSteps: Array<React.FC<TutorialStepProps>> = [\r\n  ({ player, setPercentDone }) => {\r\n    setPercentDone(useCountActionTarget(player, (action) => action.type === \"move\", 120));\r\n    return (\r\n      <>\r\n        Move - <HotkeyButton hotkey=\"W\" />\r\n        <HotkeyButton hotkey=\"A\" />\r\n        <HotkeyButton hotkey=\"S\" />\r\n        <HotkeyButton hotkey=\"D\" />\r\n      </>\r\n    );\r\n  },\r\n  ({ player, setPercentDone }) => {\r\n    setPercentDone(useCountActionTarget(player, build(\"Tissue\"), 3));\r\n    return (\r\n      <>\r\n        Grow Tissue - <HotkeyButton hotkey=\"1\" />, click.{\" \"}\r\n      </>\r\n    );\r\n  },\r\n  ({ player, setPercentDone }) => {\r\n    setPercentDone(useCountActionTarget(player, build(\"Root\"), 4));\r\n    return (\r\n      <>\r\n        Grow Roots - <HotkeyButton hotkey=\"3\" />, click Soil.\r\n      </>\r\n    );\r\n  },\r\n  ({ player, setPercentDone }) => {\r\n    setPercentDone(\r\n      useCountActionTarget(\r\n        player,\r\n        (action) => action.type === \"pickup\" && Cell.is(action.target) && action.target.displayName === \"Root\",\r\n        14\r\n      )\r\n    );\r\n    return (\r\n      <>\r\n        Take water from Roots - <HotkeyButton hotkey=\"Q\" />, click Root.\r\n      </>\r\n    );\r\n  },\r\n  ({ player, setPercentDone }) => {\r\n    setPercentDone(useCountActionTarget(player, build(\"Leaf\"), 4));\r\n    return (\r\n      <>\r\n        Grow Leaves - <HotkeyButton hotkey=\"2\" />, click Air.\r\n      </>\r\n    );\r\n  },\r\n  ({ player, setPercentDone }) => {\r\n    setPercentDone(\r\n      useCountActionTarget(\r\n        player,\r\n        (action) => action.type === \"drop\" && Cell.is(action.target) && action.target.displayName === \"Leaf\",\r\n        14\r\n      )\r\n    );\r\n    return (\r\n      <>\r\n        Put water in Leaf - <HotkeyButton hotkey=\"Q\" />, click Leaf.\r\n      </>\r\n    );\r\n  },\r\n  ({ player, setPercentDone }) => {\r\n    const [sugarMade, setSugarMade] = React.useState(0);\r\n    React.useEffect(() => {\r\n      const cb = (stats: StepStats) => {\r\n        const sugarMade = stats.events.photosynthesis.reduce(\r\n          (sum, event: EventPhotosynthesis) => event.sugarMade + sum,\r\n          0\r\n        );\r\n        setSugarMade((s) => s + sugarMade);\r\n      };\r\n      player.world.on(\"step\", cb);\r\n      return () => {\r\n        player.world.off(\"step\", cb);\r\n      };\r\n    }, [player.world]);\r\n    setPercentDone(sugarMade / 4);\r\n    return <>Wait for Photosynthesis.</>;\r\n  },\r\n  ({ player, setPercentDone }) => {\r\n    setPercentDone(useCountActionTarget(player, build(\"Seed\"), 1));\r\n    return (\r\n      <>\r\n        Grow Seed - <HotkeyButton hotkey=\"4\" />, click.\r\n      </>\r\n    );\r\n  },\r\n  ({ player, setPercentDone, active }) => {\r\n    setPercentDone(\r\n      useCountActionTarget(\r\n        player,\r\n        (action) =>\r\n          active && action.type === \"drop\" && Cell.is(action.target) && action.target.displayName === \"Tissue\",\r\n        7\r\n      )\r\n    );\r\n    return (\r\n      <>\r\n        Feed Tissue - <HotkeyButton hotkey=\"Q\" />, click Tissue.\r\n      </>\r\n    );\r\n  },\r\n  // ({ player, setPercentDone, isViewerOpen, active }) => {\r\n  //   const percentDone = isViewerOpen && active ? 1 : 0;\r\n  //   setPercentDone(percentDone);\r\n  //   return (\r\n  //     <>\r\n  //       Look at your Genes - <HotkeyButton hotkey=\"Tab\" />.\r\n  //     </>\r\n  //   );\r\n  // },\r\n  ({ player, setPercentDone }) => {\r\n    const percentDone =\r\n      (Array.from(player.world.mpEarners.keys())[0]?.findGene(GeneSeed)?.state.energyRecieved ?? 0) / 100;\r\n    setPercentDone(percentDone);\r\n    return <>Get seed to 250 energy.</>;\r\n  },\r\n];\r\n\r\nconst TutorialStepContainer: React.FC<{\r\n  mito: Mito;\r\n  index: number;\r\n  active: boolean;\r\n  isViewerOpen: boolean;\r\n  isFirst: boolean;\r\n  Step: React.FC<TutorialStepProps>;\r\n  onDone: (index: number) => void;\r\n}> = ({ mito, active, index, isViewerOpen, isFirst, Step, onDone }) => {\r\n  const [percentDoneRaw, setPercentDone] = React.useState(0);\r\n  const percentDone = Math.min(percentDoneRaw, 1);\r\n  const isDone = percentDone >= 1;\r\n\r\n  React.useEffect(() => {\r\n    if (isDone) {\r\n      onDone(index);\r\n    }\r\n  }, [active, index, isDone, onDone]);\r\n\r\n  const percentCss = `${(percentDone * 100).toFixed(1)}%`;\r\n  const style: React.CSSProperties = {\r\n    // background: `linear-gradient(to right, ${filled}, ${filled} ${percentCss}, transparent ${percentCss}, transparent)`,\r\n    width: percentCss,\r\n  };\r\n\r\n  // kill animation in the WASD tutorial\r\n  if (isFirst) {\r\n    style.transition = \"unset\";\r\n  }\r\n\r\n  return (\r\n    <div className={classNames(\"instruction\", { active, first: isFirst, done: isDone })}>\r\n      <div className=\"background-fill\" style={style} />\r\n      <div className=\"instruction-content\">\r\n        <Step player={mito.world.player} setPercentDone={setPercentDone} active={active} isViewerOpen={isViewerOpen} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import { Tooltip } from \"@blueprintjs/core\";\r\nimport classNames from \"classnames\";\r\nimport { nf } from \"common/formatters\";\r\nimport { WorldDOMComponent } from \"game/mito/WorldDOMElement\";\r\nimport { Button } from \"game/ui/common/Button\";\r\nimport * as React from \"react\";\r\nimport { DragDropContext } from \"react-beautiful-dnd\";\r\nimport { MdPause, MdPlayArrow } from \"react-icons/md\";\r\nimport { getDecidedGameResult } from \"../../../gameResult\";\r\nimport { PlayerSeedControlScheme } from \"../../../input/ControlScheme\";\r\nimport Mito from \"../../../mito/mito\";\r\nimport SpeciesViewer from \"../../SpeciesViewer\";\r\nimport { HotkeyButton } from \"../HotkeyButton\";\r\nimport { InventoryBar } from \"../InventoryBar\";\r\nimport { TileDetails } from \"../TileDetails\";\r\nimport { CellInspector } from \"./CellInspector\";\r\nimport { GameMenu } from \"./GameMenu\";\r\nimport \"./HUD.scss\";\r\nimport { InteractToolSwitcher } from \"./InteractToolSwitcher\";\r\nimport { InvalidActionMessage } from \"./InvalidActionMessage\";\r\nimport { PausedTileDetailsPopover } from \"./PausedTileDetailsPopover\";\r\nimport SeasonsTracker from \"./SeasonsTracker\";\r\nimport { ToolBarUI } from \"./ToolBarUI\";\r\nimport { Tutorial } from \"./Tutorial\";\r\n\r\nexport interface HUDProps {\r\n  mito: Mito;\r\n}\r\n\r\nexport interface HUDState {\r\n  isViewerOpen: boolean;\r\n}\r\n\r\nexport class HUD extends React.Component<HUDProps, HUDState> {\r\n  state: HUDState = {\r\n    isViewerOpen: false,\r\n  };\r\n\r\n  get mito() {\r\n    return this.props.mito;\r\n  }\r\n\r\n  get world() {\r\n    return this.mito.world;\r\n  }\r\n\r\n  get player() {\r\n    return this.world.player;\r\n  }\r\n\r\n  get inventory() {\r\n    return this.player.inventory;\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener(\"keydown\", this.handleKeyDown);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener(\"keydown\", this.handleKeyDown);\r\n  }\r\n\r\n  private handleKeyDown = (e: KeyboardEvent) => {\r\n    if (e.code === \"Tab\") {\r\n      this.setState({\r\n        isViewerOpen: !this.state.isViewerOpen,\r\n      });\r\n    }\r\n  };\r\n\r\n  public render() {\r\n    const isMaxed = this.inventory.isMaxed();\r\n    const isMaxedEl = <div className={`mito-inventory-maxed${isMaxed ? \" is-maxed\" : \"\"}`}>maxed</div>;\r\n    const showPlayerHUD = this.world.playerSeed == null;\r\n    const isFirstPlaythrough = this.mito.isFirstPlaythrough;\r\n    return (\r\n      <>\r\n        {!isFirstPlaythrough ? <div className=\"hex-title\">{this.mito.attempt.targetHex.displayName}</div> : null}\r\n        <div className={classNames(\"hud-top-center\")}>\r\n          <SeasonsTracker\r\n            time={this.world.time}\r\n            season={this.world.season}\r\n            temperature={this.world.weather.getCurrentTemperature()}\r\n          />\r\n          {this.renderTime()}\r\n          <div className=\"oxygen-rate\">{nf(this.world.oxygenPerSecond, 3)} Oxygen per second</div>\r\n        </div>\r\n        <GameMenu {...this.props} />\r\n        {this.maybeRenderSpeciesViewer()}\r\n        <div className=\"hud-right-of-time\">{this.maybeRenderWinButton()}</div>\r\n        {this.maybeRenderWinShine()}\r\n        {this.maybeRenderGerminateButton()}\r\n        {this.maybeRenderPausedUI()}\r\n        {this.maybeRenderInvalidAction()}\r\n        {this.maybeRenderTutorial()}\r\n        {this.maybeRenderInteractToolSwitcher()}\r\n        <div className={classNames(\"hud-bottom-right\", { hidden: !showPlayerHUD })}>\r\n          {this.mito.isPaused ? (\r\n            this.mito.pausedInspectedTile ? null : (\r\n              <TileDetails tile={this.mito.getTileAtScreen()} />\r\n            )\r\n          ) : (\r\n            <TileDetails tile={this.mito.highlightedTile} />\r\n          )}\r\n          <div className=\"player-inventory-container\">\r\n            {isMaxedEl}\r\n            <InventoryBar\r\n              water={this.inventory.water}\r\n              sugar={this.inventory.sugar}\r\n              capacity={this.inventory.capacity}\r\n              format=\"icons\"\r\n              className=\"player-inventory-bar\"\r\n            />\r\n          </div>\r\n          <ToolBarUI bar={this.mito.toolBar} />\r\n        </div>\r\n        {this.maybeRenderCellInspector()}\r\n      </>\r\n    );\r\n  }\r\n\r\n  maybeRenderInteractToolSwitcher() {\r\n    if (this.mito.showInteractToolSwitcher) {\r\n      return <InteractToolSwitcher mito={this.mito} />;\r\n    }\r\n  }\r\n\r\n  private positionFn = () => {\r\n    return this.mito.inspectedCell ?? null;\r\n  };\r\n\r\n  maybeRenderCellInspector() {\r\n    const cell = this.mito.inspectedCell;\r\n    if (cell != null) {\r\n      return (\r\n        // <ReactModal\r\n        //   isOpen\r\n        //   ariaHideApp={false}\r\n        //   shouldCloseOnEsc\r\n        //   shouldCloseOnOverlayClick\r\n        //   onRequestClose={() => {\r\n        //     this.mito.inspectedCell = undefined;\r\n        //   }}\r\n        // >\r\n        <WorldDOMComponent mito={this.mito} positionFn={this.positionFn}>\r\n          <CellInspector cell={cell} player={this.player} onDone={this.handleCellInspectorDone} />\r\n        </WorldDOMComponent>\r\n      );\r\n    }\r\n  }\r\n\r\n  private handleCellInspectorDone = () => {\r\n    this.mito.inspectedCell = undefined;\r\n  };\r\n\r\n  maybeRenderInvalidAction() {\r\n    const invalidAction = this.mito.invalidAction;\r\n    if (invalidAction != null) {\r\n      return <InvalidActionMessage invalidAction={invalidAction} />;\r\n    }\r\n  }\r\n\r\n  private formatTime(t: number) {\r\n    return new Date(1000 * t).toISOString().substr(14, 5);\r\n  }\r\n\r\n  private timeTooltipContent = (\r\n    <>\r\n      There are sixty seconds per day.\r\n      <br />\r\n      <br />\r\n      There are three days per month.\r\n    </>\r\n  );\r\n\r\n  private renderTime() {\r\n    const time = this.world.time;\r\n    const isPaused = this.mito.isPaused;\r\n    return (\r\n      <Tooltip content={this.timeTooltipContent}>\r\n        <div className=\"time\">\r\n          {this.formatTime(time)} -{\" \"}\r\n          <span className=\"icon\" onClick={this.handlePauseClick}>\r\n            {isPaused ? <MdPause /> : <MdPlayArrow />}\r\n          </span>\r\n        </div>\r\n      </Tooltip>\r\n    );\r\n  }\r\n\r\n  private handlePauseClick = () => {\r\n    this.mito.isPaused = !this.mito.isPaused;\r\n  };\r\n\r\n  maybeRenderGerminateButton() {\r\n    const showSeedHUD = this.world.playerSeed != null;\r\n    const popOutFn = () => {\r\n      const { controls } = this.mito;\r\n      if (controls instanceof PlayerSeedControlScheme) {\r\n        controls.popOut();\r\n      }\r\n    };\r\n    if (showSeedHUD) {\r\n      return (\r\n        <div className=\"hud-germinate\" onClick={popOutFn}>\r\n          <p>Germinate</p>\r\n          <HotkeyButton hotkey=\"Space\" onClick={popOutFn} />\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  maybeRenderWinButton() {\r\n    const result = getDecidedGameResult(this.mito);\r\n    if (result.status === \"won\") {\r\n      return (\r\n        <Button color=\"purple\" onClick={() => this.mito.onWinLoss(result)}>\r\n          Win (+ {result.mutationPointsPerEpoch} MP per epoch)\r\n        </Button>\r\n      );\r\n    }\r\n  }\r\n\r\n  maybeRenderWinShine() {\r\n    const result = getDecidedGameResult(this.mito);\r\n    if (result.status === \"won\") {\r\n      return <div className=\"win-shine\"></div>;\r\n    }\r\n  }\r\n\r\n  maybeRenderSpeciesViewer() {\r\n    if (this.state.isViewerOpen) {\r\n      return (\r\n        <div className=\"hud-top\">\r\n          <DragDropContext onDragEnd={this.handleDragEnd}>\r\n            <SpeciesViewer speciesId={this.mito.world.species.id} />\r\n          </DragDropContext>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  maybeRenderPausedUI() {\r\n    if (this.mito.isPaused) {\r\n      const pausedInspectedTile = this.mito.pausedInspectedTile;\r\n      const mouseInstructions =\r\n        pausedInspectedTile == null ? (\r\n          <div className=\"mouse-position\" style={{ left: this.mito.mouse.position.x, top: this.mito.mouse.position.y }}>\r\n            <span className=\"click-to-inspect\">{pausedInspectedTile == null ? \"Click to inspect.\" : null}</span>\r\n          </div>\r\n        ) : null;\r\n      const popover =\r\n        pausedInspectedTile != null ? <PausedTileDetailsPopover mito={this.mito} tile={pausedInspectedTile} /> : null;\r\n\r\n      return (\r\n        <>\r\n          <div className=\"paused\">Paused</div>\r\n          {mouseInstructions}\r\n          {popover}\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\n  maybeRenderTutorial() {\r\n    const showPlayerHUD = this.world.playerSeed == null;\r\n    if (this.mito.isFirstPlaythrough && showPlayerHUD) {\r\n      return <Tutorial {...this.props} isViewerOpen={this.state.isViewerOpen} />;\r\n    }\r\n  }\r\n\r\n  // no-op\r\n  private handleDragEnd = () => {};\r\n}\r\n","import { nf } from \"common/formatters\";\r\nimport React, { memo, useRef } from \"react\";\r\nimport { World } from \"../../../core\";\r\nimport { TIME_PER_SEASON } from \"../../../core/constants\";\r\nimport { GenePhotosynthesis, GeneSoilAbsorption } from \"../../../std/genes\";\r\nimport { ResourceIcon } from \"../common/ResourceIcon\";\r\n\r\n// time is just used for re-rendering\r\nconst PlantStats: React.FC<{ world: World; time: number }> = memo(({ world, time }) => {\r\n  const lastTime = useRef(0);\r\n  const lastTotalEnergy = useRef(0);\r\n  const dt = time - lastTime.current;\r\n\r\n  let numWater = 0;\r\n  let numSugar = 0;\r\n  let totalEnergy = 0;\r\n  let numCells = 0;\r\n  let totalWaterAbsorbed = 0;\r\n  let totalSugarProduced = 0;\r\n  for (const cell of world.allCells()) {\r\n    numWater += cell.inventory.water;\r\n    numSugar += cell.inventory.sugar;\r\n    totalEnergy += cell.energy;\r\n    numCells++;\r\n    const soilAbsorb = cell.findGene(GeneSoilAbsorption);\r\n    if (soilAbsorb) {\r\n      totalWaterAbsorbed += soilAbsorb.state.totalSucked;\r\n    }\r\n    const photosynthesis = cell.findGene(GenePhotosynthesis);\r\n    if (photosynthesis) {\r\n      totalSugarProduced += photosynthesis.state.totalSugarProduced;\r\n    }\r\n  }\r\n  const energyUsed = lastTotalEnergy.current - totalEnergy;\r\n  const energyUsePerSecond = energyUsed / dt;\r\n  const energyUsePerSeason = energyUsePerSecond * TIME_PER_SEASON;\r\n  const sugarUsePerSeason = energyUsePerSeason;\r\n  const timeUntilStarvation = totalEnergy / energyUsePerSecond;\r\n  const averageWaterPerSeason = (totalWaterAbsorbed / world.time) * TIME_PER_SEASON;\r\n  const averageSugarPerSeason = (totalSugarProduced / world.time) * TIME_PER_SEASON;\r\n\r\n  lastTotalEnergy.current = totalEnergy;\r\n  lastTime.current = time;\r\n\r\n  return (\r\n    <div className=\"plant-stats\" style={{ margin: \"10px 0\", textAlign: \"left\" }}>\r\n      <div>\r\n        {nf(numWater, 3)} <ResourceIcon name=\"water\" />,{nf(numSugar, 3)} <ResourceIcon name=\"sugar\" />\r\n      </div>\r\n      <div>Water per season: {nf(averageWaterPerSeason, 3)}</div>\r\n      <div>Sugar per season: {nf(averageSugarPerSeason, 3)}</div>\r\n      <div>Total energy: {nf(totalEnergy, 4)}</div>\r\n      <div>Average energy: {nf((totalEnergy / numCells) * 100, 2)}%</div>\r\n      <div>Sugar use per season: {nf(sugarUsePerSeason, 3)}</div>\r\n      <div>Time until starvation: {nf(timeUntilStarvation, 3)} seconds.</div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default PlantStats;\r\n","import { Button } from \"game/ui/common/Button\";\r\nimport * as React from \"react\";\r\nimport Keyboard from \"../../input/keyboard\";\r\nimport Mito from \"../../mito/mito\";\r\nimport { ResourceIcon } from \"../common/ResourceIcon\";\r\nimport PlantStats from \"./PlantStats\";\r\n\r\nconst Debug: React.FC<{ mito: Mito }> = ({ mito }) => {\r\n  const doWin = React.useCallback(() => {\r\n    mito.onWinLoss({\r\n      mpEarners: mito.world.mpEarners,\r\n      world: mito.world,\r\n      status: \"won\",\r\n      oxygenContribution: mito.world.oxygenPerSecond,\r\n      mutationPointsPerEpoch: 1,\r\n      vignettes: mito.vignettes,\r\n    });\r\n  }, [mito]);\r\n\r\n  const doLose = React.useCallback(() => {\r\n    mito.onWinLoss({\r\n      oxygenContribution: 0,\r\n      mpEarners: mito.world.mpEarners,\r\n      world: mito.world,\r\n      status: \"lost\",\r\n      mutationPointsPerEpoch: 0,\r\n      vignettes: mito.vignettes,\r\n    });\r\n  }, [mito]);\r\n\r\n  const plusWater = React.useCallback(() => {\r\n    mito.world.player.inventory.add(5, 0);\r\n  }, [mito.world.player.inventory]);\r\n\r\n  const plusSugar = React.useCallback(() => {\r\n    mito.world.player.inventory.add(0, 5);\r\n  }, [mito.world.player.inventory]);\r\n\r\n  return (\r\n    <div style={{ position: \"absolute\", bottom: 0, left: 0, background: \"white\" }}>\r\n      <div style={{ display: \"flex\" }}>\r\n        <Button color=\"green\" onClick={doWin}>\r\n          Win\r\n        </Button>\r\n        <Button color=\"green\" onClick={doLose}>\r\n          Lose\r\n        </Button>\r\n      </div>\r\n      <div style={{ display: \"flex\" }}>\r\n        <Button onClick={plusWater}>\r\n          +5 <ResourceIcon name=\"water\" />\r\n        </Button>\r\n        <Button onClick={plusSugar}>\r\n          +5 <ResourceIcon name=\"sugar\" />\r\n        </Button>\r\n      </div>\r\n      <PlantStats world={mito.world} time={Math.floor(mito.world.time)} />\r\n      <div>\r\n        <div>Rainwater: {mito.world.numRainWater}</div>\r\n        <div>Recharged water: {mito.world.numRechargedWater}</div>\r\n        <div>Evaporated Air: {mito.world.numEvaporatedAir}</div>\r\n        <div>Evaporated Soil: {mito.world.numEvaporatedSoil}</div>\r\n      </div>\r\n      <div style={{ background: \"white\" }}>{Array.from(Keyboard.keyMap.values()).join(\", \")}</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Debug;\r\n","import { FunctionNode, Node, NodeBuilder, TempNode, UVNode } from \"three/examples/jsm/nodes/Nodes\";\r\n\r\nexport class OvalNode extends TempNode {\r\n  private uv = new UVNode();\r\n\r\n  // VERY IMPORTANT TO TRIM WHITESPACE because THREE's internal regex is whitespace sensitive\r\n  static ovalOutFn = new FunctionNode(\r\n    `\r\nfloat ovalOut(vec2 vUv, float time) {\r\n    return clamp((time - length(vUv - vec2(0.5))) * 15., 0.0, 1.0);\r\n}`.trim()\r\n  );\r\n\r\n  constructor(public time: Node) {\r\n    super(\"f\");\r\n  }\r\n\r\n  generate(builder: NodeBuilder, output: string) {\r\n    const fn = builder.include(OvalNode.ovalOutFn);\r\n    return builder.format(\r\n      fn + \"( \" + this.uv.build(builder, \"v2\") + \", \" + this.time.build(builder, \"f\") + \" )\",\r\n      this.getType(builder),\r\n      output\r\n    );\r\n  }\r\n}\r\n","import devlog from \"common/devlog\";\r\nimport { sleep } from \"common/promise\";\r\nimport { CancerEffect, FreezeEffect } from \"core/cell\";\r\nimport { easeSinIn } from \"d3-ease\";\r\nimport { PopulationAttempt } from \"game/app\";\r\nimport { Mouse } from \"game/input/mouse\";\r\nimport { ISketch, SketchAudioContext } from \"game/screens/sketch/sketch\";\r\nimport * as React from \"react\";\r\nimport Stats from \"stats.js\";\r\nimport { environmentFromLevelInfo } from \"std/environments\";\r\nimport VignetteCapturer from \"std/vignette\";\r\nimport * as THREE from \"three\";\r\nimport { Object3D, OrthographicCamera, PerspectiveCamera, Scene, Vector2, Vector3, WebGLRenderer } from \"three\";\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\r\nimport * as Nodes from \"three/examples/jsm/nodes/Nodes\";\r\nimport configure from \"../../common/configure\";\r\nimport { World } from \"../../core\";\r\nimport { Cell, Tile } from \"../../core/tile\";\r\nimport { clamp, lerp, lerp2, map, toVector2 } from \"../../math/index\";\r\nimport { drums, hookUpAudio, strings, whoosh } from \"../audio\";\r\nimport { GameResult, maybeGetGameResult } from \"../gameResult\";\r\nimport { ControlScheme, PlayerSeedControlScheme } from \"../input/ControlScheme\";\r\nimport { ToolBar } from \"../input/toolBar\";\r\nimport { params } from \"../params\";\r\nimport { InstancedTileRenderer } from \"../renderers/tile/InstancedTileRenderer\";\r\nimport { WorldRenderer } from \"../renderers/WorldRenderer\";\r\nimport { Hover, HUD } from \"../ui/ingame\";\r\nimport Debug from \"../ui/ingame/Debug\";\r\nimport { CameraState } from \"./cameraState\";\r\nimport { logRenderInfo } from \"./logRenderInfo\";\r\nimport \"./mito.scss\";\r\nimport { OvalNode } from \"./ovalNode\";\r\nimport { perfDebugThreeObjects } from \"./perfDebugThreeObjects\";\r\nimport { WorldDOMElement } from \"./WorldDOMElement\";\r\n\r\nexport class Mito extends ISketch {\r\n  static id = \"mito\";\r\n\r\n  public readonly world: World;\r\n\r\n  public readonly toolBar: ToolBar;\r\n\r\n  public readonly scene = configure(new Scene(), (s) => {\r\n    s.background = new THREE.Color(\"black\");\r\n    if (params.debug) {\r\n      const oldAdd = s.add;\r\n      s.add = function(...object: Object3D[]) {\r\n        for (const o of object) {\r\n          (o as any).addedStack = new Error().stack;\r\n          (o as any).addedOn = performance.now();\r\n        }\r\n\r\n        return oldAdd.apply(this, object);\r\n      };\r\n    }\r\n  });\r\n\r\n  public readonly scenePlayerSeed = new Scene();\r\n\r\n  private readonly camera = new OrthographicCamera(0, 0, 0, 0, -100, 100);\r\n\r\n  public mouse = new Mouse(this.canvas);\r\n\r\n  public readonly audioListener = new THREE.AudioListener();\r\n\r\n  public highlightedTile?: Tile;\r\n\r\n  public highlightedPosition?: Vector2;\r\n\r\n  private _inspectedCell?: Cell;\r\n\r\n  public showInteractToolSwitcher = false;\r\n\r\n  public get inspectedCell() {\r\n    return this._inspectedCell;\r\n  }\r\n\r\n  public set inspectedCell(c: Cell | undefined) {\r\n    if (params.showGodUI) {\r\n      console.trace(\"set inspectedCell to\", c);\r\n    }\r\n    this._inspectedCell = c;\r\n  }\r\n\r\n  get isFirstPlaythrough() {\r\n    return this.attempt.sourceHex == null;\r\n  }\r\n\r\n  public readonly worldRenderer: WorldRenderer;\r\n\r\n  private vignetteCapturer = new VignetteCapturer(this);\r\n\r\n  public vignettes: HTMLCanvasElement[] = [];\r\n\r\n  private hackCamera?: PerspectiveCamera;\r\n\r\n  private orbitControls?: OrbitControls;\r\n\r\n  private suggestedCamera?: CameraState;\r\n\r\n  private userZoom: number;\r\n\r\n  private _controls?: ControlScheme;\r\n\r\n  public get controls() {\r\n    return this._controls;\r\n  }\r\n\r\n  public set controls(controls: ControlScheme | undefined) {\r\n    if (this._controls != null) {\r\n      this._controls.destroy();\r\n    }\r\n    this._controls = controls;\r\n  }\r\n\r\n  public nodeFrame = new Nodes.NodeFrame(0);\r\n\r\n  public nodePost: Nodes.NodePostProcessing;\r\n\r\n  public ovalOutTime: Nodes.FloatNode;\r\n\r\n  public stats = new Stats();\r\n\r\n  public statsStep = configure(new Stats(), (s) => s.showPanel(1));\r\n\r\n  public statsRenderer = configure(new Stats(), (s) => s.showPanel(1));\r\n\r\n  public isPaused = false;\r\n\r\n  public pausedInspectedTile?: Tile;\r\n\r\n  constructor(\r\n    renderer: WebGLRenderer,\r\n    context: SketchAudioContext,\r\n    public attempt: PopulationAttempt,\r\n    public onWinLoss: (result: GameResult) => void\r\n  ) {\r\n    super(renderer, context);\r\n    this.renderer.autoClear = false;\r\n    this.nodePost = new Nodes.NodePostProcessing(renderer);\r\n    this.ovalOutTime = new Nodes.FloatNode(0);\r\n    const minNode = new Nodes.MathNode(\r\n      new Nodes.ScreenNode(),\r\n      new OvalNode(this.ovalOutTime),\r\n      this.ovalOutTime,\r\n      Nodes.MathNode.MIN\r\n    );\r\n    this.nodePost.output = minNode as any;\r\n    const { info } = attempt.targetHex;\r\n    this.world = new World(environmentFromLevelInfo(info), info.seed, attempt.settlingSpecies);\r\n\r\n    this.camera.position.z = 10;\r\n    this.camera.lookAt(0, 0, 0);\r\n    this.camera.position.x = this.world.player.pos.x;\r\n    this.camera.position.y = this.world.player.pos.y;\r\n    this.camera.zoom = this.userZoom = params.debugLevel ? 0.25 : 1.5;\r\n    this.camera.add(this.audioListener);\r\n\r\n    // this.hackCamera = new PerspectiveCamera(60, this.canvas.height / this.canvas.width);\r\n\r\n    if (this.hackCamera != null) {\r\n      // this.hackCamera.position.copy(this.camera.position);\r\n      // this.hackCamera.lookAt(0, 0, 0);\r\n      this.orbitControls = new OrbitControls(this.hackCamera, this.canvas);\r\n      this.scene.add(new THREE.AxesHelper(25));\r\n    }\r\n\r\n    this.worldRenderer = new WorldRenderer(this.world, this.scene, this);\r\n\r\n    hookUpAudio(this.audioContext);\r\n    this.updateAmbientAudio();\r\n    this.attachWindowEvents();\r\n\r\n    this.toolBar = new ToolBar(this);\r\n    // this.actionBar = new SwitchableBar(new CellBar(this), new InteractBar(this));\r\n    // this.actionBar = new AltHeldBar(this);\r\n    // this.controls = new ControlScheme(this);\r\n    this.controls = new PlayerSeedControlScheme(this);\r\n  }\r\n\r\n  public events = {\r\n    wheel: (e: WheelEvent) => {\r\n      const delta = -(e.deltaX + e.deltaY) / 125 / 20;\r\n      const currZoom = this.userZoom;\r\n      const scalar = Math.pow(2, delta);\r\n      let newZoom = currZoom * scalar;\r\n      if (!params.debugLevel) {\r\n        newZoom = clamp(newZoom, 1, 3);\r\n      }\r\n      this.userZoom = newZoom;\r\n    },\r\n  };\r\n\r\n  private handleBeforeUnload = () => {\r\n    return true;\r\n  };\r\n\r\n  private handleContextMenu = (e: MouseEvent) => {\r\n    e.preventDefault();\r\n    return false;\r\n  };\r\n\r\n  private attachWindowEvents() {\r\n    window.onbeforeunload = this.handleBeforeUnload;\r\n    window.addEventListener(\"contextmenu\", this.handleContextMenu);\r\n    (window as any).mito = this;\r\n    (window as any).THREE = THREE;\r\n  }\r\n\r\n  destroy() {\r\n    // settings controls to undefined calls destroy on controls\r\n    window.removeEventListener(\"contextmenu\", this.handleContextMenu);\r\n    this.controls = undefined;\r\n    window.onbeforeunload = null;\r\n  }\r\n\r\n  public render() {\r\n    if (!params.hud) {\r\n      return null;\r\n    }\r\n    const worldDomElementComponents: React.ReactNode[] = [];\r\n    for (const e of this.worldDomElements) {\r\n      worldDomElementComponents.push(e.render());\r\n    }\r\n    const showPlayerHUD = this.world.playerSeed == null;\r\n    return (\r\n      <>\r\n        <HUD mito={this} />\r\n        {showPlayerHUD ? <Hover mito={this} /> : null}\r\n        <div className=\"world-dom-components\">{worldDomElementComponents}</div>\r\n        {params.showGodUI ? <Debug mito={this} /> : null}\r\n        {params.showFPS ? <WindowFPS mito={this} /> : null}\r\n      </>\r\n    );\r\n  }\r\n\r\n  public updateAmbientAudio() {\r\n    const yPos = this.world.player.pos.y;\r\n    const drumVolume = map(yPos, this.world.height / 2, this.world.height, 0, 0.5);\r\n    const stringsVolume = map(yPos, this.world.height / 2, 0, 0, 0.5);\r\n    drums.gain.gain.value = Math.max(0, drumVolume);\r\n    strings.gain.gain.value = Math.max(0, stringsVolume);\r\n  }\r\n\r\n  public worldStep(dt: number) {\r\n    this.statsStep.begin();\r\n    this.world.step(dt);\r\n    this.statsStep.end();\r\n\r\n    const gameResult = maybeGetGameResult(this);\r\n    if (gameResult != null) {\r\n      this.onWinLoss(gameResult);\r\n    }\r\n\r\n    this.updateAmbientAudio();\r\n  }\r\n\r\n  private getCameraNormCoordinates(clientX: number, clientY: number) {\r\n    return new THREE.Vector2((clientX / this.canvas.width) * 2 - 1, (-clientY / this.canvas.height) * 2 + 1);\r\n  }\r\n\r\n  public readonly PLAYER_TETHER_DISTANCE = 0.9;\r\n\r\n  public getPlayerInfluenceVector(clientX = this.mouse.position.x, clientY = this.mouse.position.y) {\r\n    const cursorWorld = this.getWorldCoordinates(clientX, clientY);\r\n\r\n    const offset = new Vector2(cursorWorld.x, cursorWorld.y).sub(this.world.player.posFloat);\r\n    offset.clampLength(0, this.PLAYER_TETHER_DISTANCE);\r\n    return offset;\r\n  }\r\n\r\n  public getWorldCoordinates(clientX: number, clientY: number) {\r\n    const cursorCameraNorm = this.getCameraNormCoordinates(clientX, clientY);\r\n    return toVector2(new Vector3(cursorCameraNorm.x, cursorCameraNorm.y, 0).unproject(this.camera));\r\n  }\r\n\r\n  public getTileAtScreen(clientX: number = this.mouse.position.x, clientY: number = this.mouse.position.y) {\r\n    const coords = this.getWorldCoordinates(clientX, clientY);\r\n    coords.round();\r\n\r\n    const tile = this.world.tileAt(coords.x, coords.y);\r\n    if (tile != null && tile.lightAmount() > 0) {\r\n      return tile;\r\n    }\r\n  }\r\n\r\n  private computeHighlightedPosition() {\r\n    if (this.inspectedCell) {\r\n      return this.inspectedCell.pos;\r\n    }\r\n    const offset = this.getPlayerInfluenceVector();\r\n    const { x, y } = this.world.player.posFloat;\r\n\r\n    offset.x += x;\r\n    offset.y += y;\r\n    return offset;\r\n  }\r\n\r\n  private computeHighlightedTile() {\r\n    const p = this.computeHighlightedPosition();\r\n    p.round();\r\n\r\n    const tile = this.world.tileAt(p.x, p.y);\r\n    if (tile != null && tile.lightAmount() > 0) {\r\n      return tile;\r\n    }\r\n  }\r\n\r\n  worldToScreen(world: Vector2) {\r\n    const screen = new Vector3(world.x, world.y, 0);\r\n    screen.project(this.camera); // `camera` is a THREE.PerspectiveCamera\r\n\r\n    screen.x = Math.round((0.5 + screen.x / 2) * this.canvas.width);\r\n    screen.y = Math.round((0.5 - screen.y / 2) * this.canvas.height);\r\n\r\n    return screen;\r\n  }\r\n\r\n  private worldDomElements = new Set<WorldDOMElement>();\r\n\r\n  addWorldDOMElement(positionFn: () => THREE.Vector2 | Tile, renderFn: () => React.ReactNode): WorldDOMElement {\r\n    const e = new WorldDOMElement(this, positionFn, renderFn);\r\n    this.worldDomElements.add(e);\r\n    return e;\r\n  }\r\n\r\n  removeWorldDOMElement(worldDomElement: WorldDOMElement) {\r\n    this.worldDomElements.delete(worldDomElement);\r\n  }\r\n\r\n  async addFloatingText(position: Vector2 | Tile, text: React.ReactNode) {\r\n    const element = this.addWorldDOMElement(\r\n      () => position,\r\n      () => <div className=\"floating-text\">{text}</div>\r\n    );\r\n    await sleep(1000);\r\n    this.removeWorldDOMElement(element);\r\n  }\r\n\r\n  invalidAction?: { message: string };\r\n\r\n  async showInvalidAction(invalidAction: { message: string }) {\r\n    this.invalidAction = invalidAction;\r\n    await sleep(3000);\r\n    if (this.invalidAction === invalidAction) {\r\n      this.invalidAction = undefined;\r\n    }\r\n  }\r\n\r\n  public animate(millisDelta: number) {\r\n    this.stats.end();\r\n    this.stats.begin();\r\n    if (!this.isPaused) {\r\n      this.controls?.animate();\r\n    }\r\n\r\n    const c = this.inspectedCell;\r\n    if (c != null) {\r\n      if (c.isDead || c.findEffectOfType(CancerEffect) || c.findEffectOfType(FreezeEffect)) {\r\n        this.inspectedCell = undefined;\r\n      }\r\n      if (this.world.player.getAction() != null) {\r\n        this.inspectedCell = undefined;\r\n      }\r\n    }\r\n\r\n    // cap out at 1/10th of a second in one frame (about 10fps)\r\n    const dt = Math.min(millisDelta / 1000, 1 / 10);\r\n    if (!this.isPaused) {\r\n      this.worldStep(dt);\r\n      this.statsRenderer.begin();\r\n      this.worldRenderer.update();\r\n      this.statsRenderer.end();\r\n      this.updateCamera(this.suggestedCamera ?? this.defaultCameraState());\r\n      this.pausedInspectedTile = undefined;\r\n\r\n      this.highlightedPosition = this.computeHighlightedPosition();\r\n      this.highlightedTile = this.computeHighlightedTile();\r\n      if (this.highlightedTile != null) {\r\n        (this.worldRenderer.getOrCreateRenderer(this.highlightedTile) as InstancedTileRenderer).updateHover();\r\n      }\r\n    }\r\n\r\n    if (this.vignetteCapturer.isTimeForNewCapture()) {\r\n      const v = this.vignetteCapturer.capture();\r\n      devlog(\"captured\", v);\r\n      this.vignettes.push(v);\r\n    }\r\n\r\n    this.suggestedCamera = undefined;\r\n\r\n    if (this.hackCamera != null) {\r\n      this.renderer.render(this.scene, this.hackCamera);\r\n    } else {\r\n      const ovalOutStart = 3.5;\r\n      // did trigger this frame?\r\n      if (this.world.time - dt < ovalOutStart && this.world.time > ovalOutStart) {\r\n        whoosh.play();\r\n      }\r\n      if (params.debugLevel) {\r\n        this.ovalOutTime.value = 1;\r\n      } else {\r\n        this.ovalOutTime.value = easeSinIn(clamp((this.world.time - ovalOutStart) / 1.5, 0, 1));\r\n      }\r\n      this.nodeFrame.update(millisDelta / 1000);\r\n\r\n      // render everything as per norm\r\n      this.renderer.clear();\r\n      this.nodePost.render(this.scene, this.camera, this.nodeFrame);\r\n\r\n      // render the player seed on top, after PostProcessing, so it's always there\r\n      this.renderer.clearDepth();\r\n      this.renderer.render(this.scenePlayerSeed, this.camera);\r\n    }\r\n    if (params.debugPerf && this.frameCount % 100 === 0) {\r\n      perfDebugThreeObjects(this);\r\n      logRenderInfo(this.renderer);\r\n    }\r\n  }\r\n\r\n  defaultCameraState(): CameraState {\r\n    if (this.world.playerSeed == null) {\r\n      const mouseNorm = this.getCameraNormCoordinates(this.mouse.position.x, this.mouse.position.y);\r\n\r\n      const cameraTarget = this.world.player.droopPosFloat().clone();\r\n      cameraTarget.x += mouseNorm.x / 2;\r\n      cameraTarget.y -= mouseNorm.y / 2;\r\n\r\n      return {\r\n        center: cameraTarget,\r\n        zoom: this.userZoom,\r\n      };\r\n    } else {\r\n      return {\r\n        center: this.world.playerSeed.pos,\r\n        zoom: this.userZoom,\r\n      };\r\n    }\r\n  }\r\n\r\n  updateCamera(targetState: CameraState) {\r\n    const { center, zoom } = targetState;\r\n    lerp2(this.camera.position, center, 0.2);\r\n    if (Math.abs(this.camera.zoom - zoom) > 0.001) {\r\n      this.camera.zoom = lerp(this.camera.zoom, targetState.zoom, 0.1);\r\n      this.camera.updateProjectionMatrix();\r\n    }\r\n  }\r\n\r\n  suggestCamera(suggestedCamera: CameraState) {\r\n    this.suggestedCamera = suggestedCamera;\r\n  }\r\n\r\n  public resize(w: number, h: number) {\r\n    const aspect = h / w;\r\n    // at zoom 1, we see 12 pixels up and 12 pixels down\r\n    const cameraHeight = 12;\r\n    this.camera.left = -cameraHeight / aspect;\r\n    this.camera.right = cameraHeight / aspect;\r\n    this.camera.top = -cameraHeight;\r\n    this.camera.bottom = cameraHeight;\r\n    // this.camera.position.z = 1;\r\n    // this.camera.lookAt(new Vector3(0, 0, 0));\r\n    this.camera.updateProjectionMatrix();\r\n    this.nodePost.setSize(w, h);\r\n  }\r\n}\r\n\r\nexport default Mito;\r\n\r\nconst WindowFPS: React.FC<{ mito: Mito }> = ({ mito }) => {\r\n  React.useEffect(() => {\r\n    document.body.appendChild(mito.stats.dom);\r\n    return () => {\r\n      document.body.removeChild(mito.stats.dom);\r\n    };\r\n  }, [mito.stats.dom]);\r\n  React.useEffect(() => {\r\n    mito.statsStep.dom.style.marginTop = \"50px\";\r\n    document.body.appendChild(mito.statsStep.dom);\r\n    return () => {\r\n      document.body.removeChild(mito.statsStep.dom);\r\n    };\r\n  }, [mito.statsStep.dom]);\r\n  React.useEffect(() => {\r\n    mito.statsRenderer.dom.style.marginTop = \"100px\";\r\n    document.body.appendChild(mito.statsRenderer.dom);\r\n    return () => {\r\n      document.body.removeChild(mito.statsRenderer.dom);\r\n    };\r\n  }, [mito.statsRenderer.dom]);\r\n\r\n  return null;\r\n};\r\n","import { WebGLRenderer } from \"three\";\r\n\r\nexport function logRenderInfo(renderer: WebGLRenderer) {\r\n  console.log(`Geometries in memory: ${renderer.info.memory.geometries}\r\nTextures in memory: ${renderer.info.memory.textures}\r\nNumber of Programs: ${renderer.info.programs!.length}\r\n# Render Calls: ${renderer.info.render.calls}\r\n# Render Lines: ${renderer.info.render.lines}\r\n# Render Points: ${renderer.info.render.points}\r\n# Render Tris: ${renderer.info.render.triangles}\r\n`);\r\n}\r\n","import { Mito } from \"./mito\";\r\n\r\nexport function perfDebugThreeObjects(mito: Mito) {\r\n  // count how many have autoUpdate enabled\r\n  let yes = 0,\r\n    no = 0;\r\n  mito.scene.traverse((o) => {\r\n    if (o.matrixAutoUpdate) {\r\n      yes++;\r\n    } else {\r\n      no++;\r\n    }\r\n  });\r\n  console.log(\"matrixAutoUpdate: yes\", yes, \", no\", no);\r\n  // count how many Objects of each type there are\r\n  const s = new Map();\r\n  mito.scene.traverse((o) => {\r\n    const k = s.get(o.name || o.constructor.name) || [];\r\n    s.set(o.name || o.constructor.name, k);\r\n    k.push(o);\r\n  });\r\n  console.log(s);\r\n}\r\n","import classnames from \"classnames\";\r\nimport { PopulationAttempt } from \"game/app\";\r\nimport { GameResult } from \"game/gameResult\";\r\nimport { params } from \"game/params\";\r\nimport { Howler } from \"howler\";\r\nimport * as React from \"react\";\r\nimport { FaVolumeOff, FaVolumeUp } from \"react-icons/fa\";\r\nimport Ticker from \"std/ticker\";\r\nimport * as THREE from \"three\";\r\nimport Mito from \"../../mito/mito\";\r\nimport { ISketch, SketchAudioContext, UI_EVENTS } from \"./sketch\";\r\nimport \"./SketchComponent.scss\";\r\n\r\nexport interface ISketchComponentProps extends React.DOMAttributes<HTMLDivElement> {\r\n  eventsOnBody?: boolean;\r\n  errorElement?: JSX.Element;\r\n  attempt: PopulationAttempt;\r\n  onWinLoss: (result: GameResult) => void;\r\n}\r\n\r\nexport interface SketchSuccess {\r\n  type: \"success\";\r\n  sketch: ISketch;\r\n}\r\n\r\nexport interface SketchError {\r\n  type: \"error\";\r\n  error: Error;\r\n}\r\n\r\nexport interface SketchLoading {\r\n  type: \"loading\";\r\n}\r\n\r\nexport type SketchStatus = SketchSuccess | SketchError | SketchLoading;\r\n\r\n// Expects sketch to be setup but not init. SketchSuccessComponent is responsible for:\r\n//      firing resize events\r\n//      attaching ui event listeners\r\n//      keeping focus on the canvas\r\ninterface SketchSuccessComponentProps {\r\n  sketch: ISketch;\r\n  eventsOnBody?: boolean;\r\n}\r\n\r\ninterface SketchSuccessComponentState {\r\n  frameCount: number;\r\n  volumeEnabled: boolean;\r\n}\r\n\r\nclass SketchSuccessComponent extends React.PureComponent<SketchSuccessComponentProps, SketchSuccessComponentState> {\r\n  private frameId?: number;\r\n\r\n  private lastTimestamp = 0;\r\n\r\n  private stop = false;\r\n\r\n  constructor(props: SketchSuccessComponentProps) {\r\n    super(props);\r\n    this.state = {\r\n      frameCount: props.sketch.frameCount,\r\n      volumeEnabled: JSON.parse(window.localStorage.getItem(\"sketch-volumeEnabled\") || \"true\"),\r\n    };\r\n  }\r\n\r\n  public shouldPlayAudio() {\r\n    return this.state.volumeEnabled && document.visibilityState === \"visible\" && document.hasFocus();\r\n  }\r\n\r\n  public syncAudioContext() {\r\n    const { audioContext } = this.props.sketch;\r\n    if (audioContext != null) {\r\n      // this.userVolume.gain.value = this.state.volumeEnabled ? 1 : 0;\r\n      if (this.shouldPlayAudio() && audioContext.state === \"suspended\") {\r\n        audioContext.resume();\r\n      } else if (!this.shouldPlayAudio() && audioContext.state === \"running\") {\r\n        audioContext.suspend();\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener(\"resize\", this.handleWindowResize);\r\n    document.addEventListener(\"visibilitychange\", this.handleVisibilityChange);\r\n    this.handleWindowResize();\r\n\r\n    // canvas setup\r\n    const canvas = this.props.sketch.renderer.domElement;\r\n    canvas.tabIndex = 1;\r\n    (Object.keys(UI_EVENTS) as Array<keyof typeof UI_EVENTS>).forEach((eventName) => {\r\n      if (this.props.sketch.events != null) {\r\n        const callback = this.props.sketch.events[eventName] as EventListener;\r\n        if (callback != null) {\r\n          if (this.props.eventsOnBody) {\r\n            document.body.addEventListener(eventName, callback);\r\n          } else {\r\n            canvas.addEventListener(eventName, callback);\r\n          }\r\n        }\r\n      }\r\n    });\r\n    // prevent scrolling the viewport\r\n    // $canvas.on(\"touchmove\", (event) => {\r\n    //     event.preventDefault();\r\n    // });\r\n\r\n    this.frameId = Ticker.addAnimation(this.loop);\r\n  }\r\n\r\n  render() {\r\n    const sketchElementsWithKey: React.ReactNode[] = [];\r\n    if (this.props.sketch.render != null) {\r\n      sketchElementsWithKey.push(this.props.sketch.render());\r\n    }\r\n    if (this.props.sketch.elements != null) {\r\n      sketchElementsWithKey.push(...this.props.sketch.elements);\r\n    }\r\n    return (\r\n      <div className=\"sketch-elements\">\r\n        {/* {sketchElementsWithKey} */}\r\n        {sketchElementsWithKey.map((el, idx) => {\r\n          if (React.isValidElement(el)) {\r\n            return React.cloneElement(el, { key: idx });\r\n          } else {\r\n            return el;\r\n          }\r\n        })}\r\n        {this.renderVolumeButton()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderVolumeButton() {\r\n    if (params.hud) {\r\n      const { volumeEnabled } = this.state;\r\n      return (\r\n        <button className=\"user-volume game-options-button\" onClick={this.handleVolumeButtonClick}>\r\n          {volumeEnabled ? <FaVolumeUp /> : <FaVolumeOff />}\r\n        </button>\r\n      );\r\n    }\r\n  }\r\n\r\n  private handleVolumeButtonClick = () => {\r\n    const volumeEnabled = !this.state.volumeEnabled;\r\n    this.setState({ volumeEnabled });\r\n    window.localStorage.setItem(\"sketch-volumeEnabled\", JSON.stringify(volumeEnabled));\r\n  };\r\n\r\n  componentWillUnmount() {\r\n    this.stop = true;\r\n\r\n    if (this.props.sketch.destroy) {\r\n      this.props.sketch.destroy();\r\n    }\r\n    if (this.frameId != null) {\r\n      Ticker.removeAnimation(this.frameId);\r\n    }\r\n    this.props.sketch.renderer.dispose();\r\n    window.removeEventListener(\"resize\", this.handleWindowResize);\r\n    document.removeEventListener(\"visibilitychange\", this.handleVisibilityChange);\r\n\r\n    const canvas = this.props.sketch.canvas;\r\n    (Object.keys(UI_EVENTS) as Array<keyof typeof UI_EVENTS>).forEach((eventName) => {\r\n      if (this.props.sketch.events != null) {\r\n        const callback = this.props.sketch.events[eventName] as EventListener;\r\n        if (callback != null) {\r\n          if (this.props.eventsOnBody) {\r\n            document.body.removeEventListener(eventName, callback);\r\n          } else {\r\n            canvas.removeEventListener(eventName, callback);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private loop = (timestamp: number) => {\r\n    const millisElapsed = timestamp - this.lastTimestamp;\r\n    this.lastTimestamp = timestamp;\r\n    this.props.sketch.frameCount++;\r\n    this.props.sketch.timeElapsed = timestamp;\r\n    this.syncAudioContext();\r\n    try {\r\n      this.props.sketch.animate(millisElapsed);\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n\r\n    // careful - sketch.animate() might have triggered a whole React update loop\r\n    // and made this component unmount.\r\n    if (!this.stop) {\r\n      // force new render()\r\n      this.setState({\r\n        frameCount: this.props.sketch.frameCount,\r\n      });\r\n    } else {\r\n      Ticker.removeAnimation(this.frameId!);\r\n    }\r\n  };\r\n\r\n  private handleWindowResize = () => {\r\n    const { renderer } = this.props.sketch;\r\n    this.updateRendererCanvasToMatchParent(renderer);\r\n    if (this.props.sketch.resize != null) {\r\n      this.props.sketch.resize(renderer.domElement.width, renderer.domElement.height);\r\n    }\r\n  };\r\n\r\n  private handleVisibilityChange = () => {\r\n    this.syncAudioContext();\r\n  };\r\n\r\n  private updateRendererCanvasToMatchParent(renderer: THREE.WebGLRenderer) {\r\n    const parent = renderer.domElement.parentElement;\r\n    if (parent != null) {\r\n      renderer.setSize(parent.clientWidth, parent.clientHeight);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface ISketchComponentState {\r\n  status: SketchStatus;\r\n}\r\n\r\nexport class SketchComponent extends React.PureComponent<ISketchComponentProps, ISketchComponentState> {\r\n  public state: ISketchComponentState = {\r\n    status: { type: \"loading\" },\r\n  };\r\n\r\n  // private renderer?: THREE.WebGLRenderer;\r\n  private audioContext?: SketchAudioContext;\r\n\r\n  private userVolume?: GainNode;\r\n\r\n  private handleContainerRef = (ref: HTMLDivElement | null) => {\r\n    if (ref != null) {\r\n      try {\r\n        // create dependencies, setup sketch, and move to success state\r\n        // we are responsible for live-updating the global user volume.\r\n        // const AudioContextConstructor: typeof AudioContext =\r\n        //   (window as any).AudioContext || (window as any).webkitAudioContext;\r\n        // const audioContext = (this.audioContext = new AudioContextConstructor() as SketchAudioContext);\r\n        const audioContext = (this.audioContext = Howler.ctx as SketchAudioContext);\r\n        (THREE.AudioContext as any).setContext(audioContext);\r\n        this.userVolume = audioContext.createGain();\r\n        this.userVolume.gain.setValueAtTime(0.8, 0);\r\n        this.userVolume.connect(Howler.masterGain);\r\n        const audioContextGain = (audioContext.gain = audioContext.createGain());\r\n        audioContextGain.connect(this.userVolume);\r\n\r\n        const renderer = new THREE.WebGLRenderer({\r\n          alpha: true,\r\n          preserveDrawingBuffer: true,\r\n          antialias: true,\r\n        });\r\n        renderer.debug.checkShaderErrors = true;\r\n        ref.appendChild(renderer.domElement);\r\n\r\n        const { attempt, onWinLoss } = this.props;\r\n        const sketch = new Mito(renderer, this.audioContext, attempt, onWinLoss);\r\n        this.setState({ status: { type: \"success\", sketch: sketch } });\r\n      } catch (e) {\r\n        this.setState({ status: { type: \"error\", error: e } });\r\n        console.error(e);\r\n      }\r\n    } else {\r\n      if (this.state.status.type === \"success\") {\r\n        this.state.status.sketch.canvas.remove();\r\n      }\r\n      this.userVolume?.disconnect();\r\n      this.setState({ status: { type: \"loading\" } });\r\n    }\r\n  };\r\n\r\n  public render() {\r\n    const { onWinLoss, attempt, eventsOnBody, errorElement, ...containerProps } = this.props;\r\n    const className = classnames(\"sketch-component\", this.state.status.type);\r\n    return (\r\n      <div {...containerProps} className={className} ref={this.handleContainerRef}>\r\n        {this.renderSketchOrStatus()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderSketchOrStatus() {\r\n    const { status } = this.state;\r\n    if (status.type === \"success\") {\r\n      // key on id to not destroy and re-create the component somehow\r\n      return <SketchSuccessComponent sketch={status.sketch} eventsOnBody={this.props.eventsOnBody} />;\r\n    } else if (status.type === \"error\") {\r\n      const errorElement = this.props.errorElement || this.renderDefaultErrorElement(status.error.message);\r\n      return errorElement;\r\n    } else if (status.type === \"loading\") {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private renderDefaultErrorElement(message: string) {\r\n    return (\r\n      <p className=\"sketch-error\">\r\n        Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.\r\n        <pre>{message}</pre>\r\n      </p>\r\n    );\r\n  }\r\n}\r\n","import { PopulationAttempt } from \"game/app\";\r\nimport { GameResult } from \"game/gameResult\";\r\nimport { SketchComponent } from \"game/screens/sketch/SketchComponent\";\r\nimport * as React from \"react\";\r\nimport \"./MitoScreen.scss\";\r\n\r\nexport interface IMitoInstanceProps {\r\n  attempt: PopulationAttempt;\r\n  onWinLoss: (result: GameResult) => void;\r\n}\r\n\r\nexport default class MitoScreen extends React.PureComponent<IMitoInstanceProps, {}> {\r\n  public render() {\r\n    return (\r\n      <div className=\"full-page-sketch\" ref={this.handleDivRef}>\r\n        <SketchComponent {...this.props} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private handleDivRef = (div: HTMLDivElement | null) => {\r\n    if (div != null) {\r\n      // this.requestFullscreen(div);\r\n    } else {\r\n      this.exitFullscreen();\r\n    }\r\n  };\r\n\r\n  private exitFullscreen() {\r\n    if (document.webkitExitFullscreen) {\r\n      document.webkitExitFullscreen();\r\n    } else if (document.mozCancelFullScreen) {\r\n      document.mozCancelFullScreen();\r\n    }\r\n  }\r\n}\r\n","import { Button } from \"game/ui/common/Button\";\r\nimport Character from \"game/ui/common/Character\";\r\nimport React, { useEffect } from \"react\";\r\nimport { FaDiscord } from \"react-icons/fa\";\r\nimport \"./StartScreen.scss\";\r\n\r\nconst StartScreen: React.FC<{ onStart: () => void }> = React.memo(({ onStart }) => {\r\n  // useEffect(() => {\r\n  //   mitoStartScreen.play();\r\n  //   return () => {\r\n  //     mitoStartScreen.stop();\r\n  //   };\r\n  // }, []);\r\n  useEffect(() => {\r\n    const listenForEnter = (event: KeyboardEvent) => {\r\n      if (event.code === \"Enter\" || event.code === \"Space\") {\r\n        onStart();\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", listenForEnter);\r\n    return () => {\r\n      window.removeEventListener(\"keydown\", listenForEnter);\r\n    };\r\n  }, [onStart]);\r\n\r\n  return (\r\n    <div className=\"start-screen\">\r\n      <h1>\r\n        Mito\r\n        <Character size=\"small\" className=\"mito-i\" />\r\n      </h1>\r\n      <div className=\"bottom-area\">\r\n        <Button color=\"green\" onClick={onStart}>\r\n          Continue Game\r\n        </Button>\r\n        <a className=\"discord\" rel=\"noopener noreferrer\" target=\"_blank\" href=\"http://discord.gg/N8wWwPX\">\r\n          <FaDiscord />\r\n        </a>\r\n      </div>\r\n      <div className=\"game-version\">v0.9.0-dev</div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default StartScreen;\r\n","import { GameResult } from \"game/gameResult\";\r\nimport OverWorldScreen from \"game/screens/OverWorldScreen\";\r\nimport { Button } from \"game/ui/common/Button\";\r\nimport React, { memo, useRef } from \"react\";\r\nimport { FaDiscord } from \"react-icons/fa\";\r\nimport { CSSTransition } from \"react-transition-group\";\r\nimport { serialize } from \"serializr\";\r\nimport { LocalForageStateProvider } from \"../app/AppStateProvider\";\r\nimport { AppReducerContext, useAppReducer } from \"../app/reducer\";\r\nimport { AppState, AppStateSchema } from \"../app/state\";\r\nimport \"./App.scss\";\r\nimport GameResultsScreen from \"./GameResultsScreen\";\r\nimport MitoScreen from \"./MitoScreen\";\r\nimport StartScreen from \"./StartScreen\";\r\n\r\ninterface AppComponentState {\r\n  showStartScreen: boolean;\r\n  error?: Error;\r\n}\r\n\r\nclass AppComponent extends React.PureComponent<{}, AppComponentState> {\r\n  static contextType = AppReducerContext;\r\n\r\n  context!: React.ContextType<typeof AppReducerContext>;\r\n\r\n  constructor(props: {}, context: any) {\r\n    super(props, context);\r\n    this.state = {\r\n      showStartScreen: true,\r\n      error: undefined,\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error) {\r\n    return { error };\r\n  }\r\n\r\n  handleNextEpoch = () => {\r\n    const [, dispatch] = this.context;\r\n    dispatch({ type: \"AANextEpoch\" });\r\n  };\r\n\r\n  handleWinLoss = (result: GameResult) => {\r\n    const [, dispatch] = this.context;\r\n    dispatch({\r\n      type: \"AATransitionStart\",\r\n      transition: {\r\n        type: \"AAGetGameResult\",\r\n        result,\r\n      },\r\n    });\r\n  };\r\n\r\n  handleResultsDone = () => {\r\n    const [, dispatch] = this.context;\r\n    dispatch({\r\n      type: \"AATransitionStart\",\r\n      transition: {\r\n        type: \"AAGameResultDone\",\r\n      },\r\n    });\r\n  };\r\n\r\n  handleCloseStartScreen = () => this.setState({ showStartScreen: false });\r\n\r\n  render() {\r\n    const [state] = this.context;\r\n\r\n    const appContent = this.state.error ? (\r\n      <AppError error={this.state.error} appState={state} />\r\n    ) : (\r\n      <>\r\n        <AppScreen show={this.state.showStartScreen}>\r\n          <StartScreen onStart={this.handleCloseStartScreen} />\r\n        </AppScreen>\r\n        <AppScreen show={state.activePopulationAttempt == null && !this.state.showStartScreen}>\r\n          <OverWorldScreen onNextEpoch={this.handleNextEpoch} />\r\n        </AppScreen>\r\n        <AppScreen show={state.activePopulationAttempt != null && state.activeGameResult == null}>\r\n          <MitoScreen attempt={state.activePopulationAttempt!} onWinLoss={this.handleWinLoss} />\r\n        </AppScreen>\r\n        <AppScreen show={state.activeGameResult != null}>\r\n          {state.activeGameResult ? (\r\n            <GameResultsScreen\r\n              attempt={state.activePopulationAttempt}\r\n              results={state.activeGameResult}\r\n              onDone={this.handleResultsDone}\r\n            />\r\n          ) : (\r\n            // HACK AppScreen *needs* one element; I think there's one single tick where\r\n            // AppScreen is still rendering its children even when it shouldn't.\r\n            <div></div>\r\n          )}\r\n        </AppScreen>\r\n      </>\r\n    );\r\n\r\n    return <div className=\"App\">{appContent}</div>;\r\n  }\r\n}\r\n\r\nconst AppError = React.memo(({ error, appState }: { error: Error; appState: AppState }) => {\r\n  const appStateJson = serialize(AppStateSchema, appState);\r\n  const errorRef = useRef<HTMLTextAreaElement>(null);\r\n  const errorReport = {\r\n    error: {\r\n      name: error.name,\r\n      message: error.message,\r\n      stack: error.stack,\r\n    },\r\n    time: new Date(),\r\n    appState: appStateJson,\r\n  };\r\n  const handleClick = () => {\r\n    const el = errorRef.current;\r\n    if (el) {\r\n      el.select();\r\n      document.execCommand(\"copy\");\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"app-error\">\r\n      {/* eslint-disable-next-line jsx-a11y/accessible-emoji */}\r\n      <h1>😢😢😢Mito has crashed! 😢😢😢</h1>\r\n      <div className=\"bottom\">\r\n        <p>Please report this to the dev team.</p>\r\n        <div className=\"instructions\">\r\n          <Button className=\"copy\" onClick={handleClick}>\r\n            Copy Error Report\r\n          </Button>\r\n          <span className=\"arrow-right\">➡</span>\r\n          <a className=\"discord\" rel=\"noopener noreferrer\" target=\"_blank\" href=\"http://discord.gg/N8wWwPX\">\r\n            <FaDiscord />\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <textarea ref={errorRef} className=\"error-textarea\" value={JSON.stringify(errorReport, null, 2)} readOnly />\r\n    </div>\r\n  );\r\n});\r\n\r\nconst AppScreen: React.FC<{ show: boolean; children?: JSX.Element }> = memo(({ show, children }) => {\r\n  const [state] = useAppReducer();\r\n  return (\r\n    <CSSTransition\r\n      in={show && state.transition == null}\r\n      timeout={2000}\r\n      mountOnEnter\r\n      unmountOnExit\r\n      classNames=\"fade-to-black\"\r\n    >\r\n      {children}\r\n    </CSSTransition>\r\n  );\r\n});\r\n\r\nconst App = () => (\r\n  <LocalForageStateProvider loadingComponent={<div>Loading...</div>}>\r\n    <AppComponent />\r\n  </LocalForageStateProvider>\r\n);\r\n\r\nexport default App;\r\n","import { HexTile } from \"core/overworld/hexTile\";\r\nimport { newBaseSpecies } from \"core/species\";\r\nimport { PopulationAttempt } from \"game/app\";\r\nimport { params } from \"game/params\";\r\nimport MitoScreen from \"game/screens/MitoScreen\";\r\nimport React, { useCallback, useEffect, useState } from \"react\";\r\n\r\nfunction newHexWithSeed(seed: number) {\r\n  const hex = new HexTile(0, 0);\r\n  hex.info.height = 11;\r\n  hex.info.seed = seed;\r\n  return hex;\r\n}\r\n\r\nfunction TestLevel() {\r\n  useEffect(() => {\r\n    params.debugLevel = true;\r\n    params.hud = false;\r\n  }, []);\r\n  const [attempt, setAttempt] = useState<PopulationAttempt>({\r\n    settlingSpecies: newBaseSpecies(),\r\n    targetHex: newHexWithSeed(0),\r\n  });\r\n  const nextSeed = useCallback(() => {\r\n    setAttempt((attempt: PopulationAttempt) => {\r\n      return {\r\n        settlingSpecies: attempt.settlingSpecies,\r\n        targetHex: newHexWithSeed(attempt.targetHex.info.seed + 1),\r\n      };\r\n    });\r\n  }, []);\r\n  return (\r\n    <>\r\n      <button onClick={nextSeed} style={{ zIndex: 1, position: \"absolute\", left: 0, top: 0 }}>\r\n        Seed {attempt.targetHex.info.seed}\r\n      </button>\r\n      <MitoScreen key={attempt.targetHex.info.seed} attempt={attempt} onWinLoss={() => {}} />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default TestLevel;\r\n","import { OverWorld } from \"core/overworld/overWorld\";\r\nimport { newBaseSpecies } from \"core/species\";\r\nimport { AppState } from \"game/app\";\r\nimport { AppStateProvider } from \"game/app/AppStateProvider\";\r\nimport { OverWorldMap } from \"game/ui/overworld/map/OverWorldMap\";\r\nimport React, { useCallback, useMemo, useState } from \"react\";\r\n\r\nexport function newInitialAppState(): AppState {\r\n  const overWorld = OverWorld.generateLargeContinent(23);\r\n  const rootSpecies = newBaseSpecies(\"plantum originus\");\r\n  const startHex = overWorld.getStartHex();\r\n  // rootSpecies.freeMutationPoints = 25;\r\n  // const s3 = newBaseSpecies(\"s3\");\r\n  // s3.descendants = [newBaseSpecies(\"ya\"), newBaseSpecies(\"no\"), newBaseSpecies(\"whoa\")];\r\n  // let s: Species;\r\n  // rootSpecies.descendants = [s = newBaseSpecies(\"foo\"), newBaseSpecies(\"bar\"), s3];\r\n  // s.descendants = [newBaseSpecies(\"1\"), newBaseSpecies(\"2\")]\r\n  return {\r\n    overWorld,\r\n    rootSpecies,\r\n    activePopulationAttempt: {\r\n      settlingSpecies: rootSpecies,\r\n      targetHex: startHex,\r\n    },\r\n    epoch: 0,\r\n  };\r\n}\r\n\r\nfunction TestOverworld() {\r\n  const [count, setCount] = useState(0);\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  const appState = useMemo(() => newInitialAppState(), [count]);\r\n  const nextSeed = useCallback(() => setCount((s) => s + 1), []);\r\n  return (\r\n    <>\r\n      <button onClick={nextSeed} style={{ zIndex: 1, position: \"absolute\", left: 0, top: 0 }}>\r\n        {count}\r\n      </button>\r\n      <AppStateProvider key={count} appState={appState}>\r\n        <OverWorldMap key={count} />\r\n      </AppStateProvider>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default TestOverworld;\r\n","import { Environment } from \"core/environment\";\r\nimport { Layout, PlotData } from \"plotly.js\";\r\nimport React from \"react\";\r\nimport { World } from \"../core\";\r\nimport { newBaseSpecies } from \"../core/species\";\r\nimport { Air, Fountain, Rock, Soil } from \"../core/tile\";\r\nimport { Desert, Rocky, Temperate } from \"../std/environments\";\r\nimport { findBuildCandidateTiles } from \"../std/worldUtils\";\r\nimport { Experiment, ExperimentSuite } from \"./experiment\";\r\n\r\nfunction runTests(environment: Environment, id: string) {\r\n  console.log(\"running\");\r\n  const suite = new ExperimentSuite([\r\n    new Experiment({\r\n      countAir: (t) => t.filter((tile) => tile.constructor === Air).length,\r\n    }),\r\n    new Experiment({\r\n      countSoil: (t) => t.filter((tile) => tile.constructor === Soil).length,\r\n    }),\r\n    new Experiment({\r\n      countRock: (t) => t.filter((tile) => tile.constructor === Rock).length,\r\n    }),\r\n    new Experiment({\r\n      countFountain: (t) => t.filter((tile) => tile.constructor === Fountain).length,\r\n    }),\r\n    new Experiment({\r\n      playerY: (_, w) => w.player.pos.y,\r\n    }),\r\n    new Experiment({\r\n      startAdjacentWaters: (_, w) => {\r\n        const adjacentTiles = findBuildCandidateTiles(w, (t) => t instanceof Soil);\r\n        let water = 0;\r\n        for (const t of adjacentTiles) {\r\n          water += t.inventory.water;\r\n        }\r\n        return water;\r\n      },\r\n    }),\r\n    new Experiment({\r\n      countWaters: (t) => {\r\n        return t.reduce((w, tile) => w + tile.inventory.water, 0);\r\n      },\r\n    }),\r\n  ]);\r\n  for (let i = 0; i < 20; i++) {\r\n    console.time(\"trial \" + i);\r\n    const world = new World(environment, i, newBaseSpecies());\r\n    suite.recordDataFor(Array.from(world.allEnvironmentTiles()));\r\n    console.timeEnd(\"trial \" + i);\r\n  }\r\n\r\n  plotStackedBar(suite.experiments.slice(0, 4), id);\r\n\r\n  for (const e of suite.experiments) {\r\n    plotHistogram(e, id);\r\n  }\r\n}\r\n\r\nfunction plotStackedBar(experiments: Experiment[], divId: string) {\r\n  const data = [];\r\n  const names = experiments.map((e) => e.visitorNames().join(\"\"));\r\n  for (const idx in names) {\r\n    const name = names[idx];\r\n    const x = [];\r\n    const y = [];\r\n    for (let i = 0; i < experiments[0].trials.length; i++) {\r\n      x.push(i);\r\n\r\n      const e = experiments[idx];\r\n      const trial = e.trials[i];\r\n      const value = trial[name];\r\n      y.push(value);\r\n    }\r\n    const trace: Partial<PlotData> = {\r\n      x,\r\n      y,\r\n      name,\r\n      type: \"bar\",\r\n    };\r\n    data.push(trace);\r\n  }\r\n  var layout: Partial<Layout> = { barmode: \"stack\" };\r\n\r\n  const div = document.createElement(\"div\");\r\n  const el = document.getElementById(divId)!;\r\n  el.appendChild(div);\r\n  window.Plotly.newPlot(div, data, layout);\r\n}\r\n\r\nfunction plotHistogram(stats: Experiment, divId: string) {\r\n  const data = [];\r\n  const layout: Partial<Layout> = {};\r\n\r\n  for (const name of stats.visitorNames()) {\r\n    var trace: Partial<PlotData> = {\r\n      x: stats.trials.map((t) => t[name]),\r\n      type: \"histogram\",\r\n      name: name,\r\n    };\r\n    data.push(trace);\r\n\r\n    layout.title = {\r\n      text: name,\r\n    };\r\n  }\r\n  const div = document.createElement(\"div\");\r\n  const el = document.getElementById(divId)!;\r\n  el.appendChild(div);\r\n  div.style.height = \"240px\";\r\n  div.style.width = \"320px\";\r\n  div.style.display = \"inline-block\";\r\n  window.Plotly.newPlot(div, data, layout);\r\n}\r\n\r\nfunction TestStats() {\r\n  React.useEffect(() => {\r\n    var script = document.createElement(\"script\");\r\n    script.src = \"https://cdn.plot.ly/plotly-latest.min.js\";\r\n    script.addEventListener(\"load\", function() {\r\n      runTests(Temperate, \"temperate\");\r\n      runTests(Rocky, \"rocky\");\r\n      runTests(Desert, \"desert\");\r\n    });\r\n\r\n    document.body.appendChild(script);\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <h1>Experiments</h1>\r\n      <div id=\"temperate\">\r\n        <h2>Temperate</h2>\r\n      </div>\r\n      <div id=\"rocky\">\r\n        <h2>Rocky</h2>\r\n      </div>\r\n      <div id=\"desert\">\r\n        <h2>Desert</h2>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TestStats;\r\n","import React from \"react\";\r\nimport { Link, Route, RouteComponentProps, Switch } from \"react-router-dom\";\r\nimport TestDiffusion from \"tests/TestDiffusion\";\r\nimport { TestLoseScreen } from \"tests/TestLoseScreen\";\r\nimport { TestWinScreen } from \"tests/TestWinScreen\";\r\nimport WFCTest from \"tests/WFCTest\";\r\nimport App from \"./game/screens/App\";\r\nimport \"./index.scss\";\r\n// tests must be imported with './' syntax to come after the './game' import; ordering is important\r\nimport TestLevel from \"./tests/TestLevel\";\r\nimport TestOverworld from \"./tests/TestOverworld\";\r\nimport TestStats from \"./tests/TestStats\";\r\n\r\nexport default () => (\r\n  <Switch>\r\n    <Route path=\"/test-lose\">\r\n      <TestLoseScreen />\r\n    </Route>\r\n    <Route path=\"/test-win\">\r\n      <TestWinScreen />\r\n    </Route>\r\n    <Route path=\"/test-stats\">\r\n      <TestStats />\r\n    </Route>\r\n    <Route path=\"/test-diffusion\">\r\n      <TestDiffusion />\r\n    </Route>\r\n    <Route path=\"/test-level\">\r\n      <TestLevel />\r\n    </Route>\r\n    <Route path=\"/test-overworld\">\r\n      <TestOverworld />\r\n    </Route>\r\n    <Route path=\"/wfc\">\r\n      <WFCTest />\r\n    </Route>\r\n    <Route exact path=\"/\">\r\n      <App />\r\n    </Route>\r\n    <Route path=\"*\" component={Page404} />\r\n  </Switch>\r\n);\r\n\r\nconst Page404: React.FC<RouteComponentProps> = () => {\r\n  return (\r\n    <div>\r\n      <h1>Unknown page</h1>\r\n      <Link to=\"/\">Back to main screen</Link>\r\n    </div>\r\n  );\r\n};\r\n","import { createModelSchema, primitive } from \"serializr\";\r\nimport { Color, Vector2 } from \"three\";\r\ncreateModelSchema(Color, {\r\n  r: primitive(),\r\n  g: primitive(),\r\n  b: primitive(),\r\n});\r\ncreateModelSchema(Vector2, {\r\n  x: primitive(),\r\n  y: primitive(),\r\n});\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL((process as { env: { [key: string]: string } }).env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (response.status === 404 || (contentType != null && contentType.indexOf(\"javascript\") === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\"No internet connection found. App is running in offline mode.\");\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","// import \"@blueprintjs/icons/lib/css/blueprint.css\";\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { HashRouter } from \"react-router-dom\";\r\nimport Routes from \"Routes\";\r\nimport \"./addThreeJsModelSchemas\";\r\nimport \"./index.scss\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nfunction requireAll(r: any) {\r\n  r.keys().forEach(r);\r\n}\r\nrequireAll((require as any).context(\"./std/genes/\", true, /Gene.*\\.tsx?$/));\r\n\r\nReactDOM.render(\r\n  <HashRouter>\r\n    <Routes />\r\n  </HashRouter>,\r\n\r\n  document.getElementById(\"root\")\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}