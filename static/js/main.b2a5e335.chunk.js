(this.webpackJsonpmito=this.webpackJsonpmito||[]).push([[0],[,,,,,function(e,t,n){"use strict";var r=n(2);function a(e,t){return Math.random()*(t-e)+e}function i(e,t){return Math.floor(a(e,t+1))}function o(e){return e[i(0,e.length-1)]}function s(e,t,n){return e+(t-e)*n}function l(e,t,n){e.x=e.x*(1-n)+t.x*n,e.y=e.y*(1-n)+t.y*n}function c(e,t,n,r,a){return s(r,a,(e-t)/(n-t))}function u(e,t,n){return e<t?t:e>n?n:e}function h(e){var t=Math.floor(e),n=e-t;return t+(Math.random()<n?1:0)}function d(e,t){return(e%t+t)%t}function f(e){return d(e,1)}function v(e,t){return Math.round(e/t)*t}function m(e){return new r.Vector2(e.x,e.y)}n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"h",(function(){return h})),n.d(t,"j",(function(){return f})),n.d(t,"i",(function(){return v})),n.d(t,"k",(function(){return m})),n.d(t,"f",(function(){return a})),n.d(t,"g",(function(){return i})),n.d(t,"e",(function(){return o}))},,,,,,function(e,t,n){"use strict";var r=n(45),a=n(94),i=n(82),o=n(81),s=n(4),l=n(3),c=n(8),u=n(6),h=n(55),d=n(7),f=n(46),v=function(e){function t(e,n,r,a){var i;return Object(s.a)(this,t),(i=Object(c.a)(this,Object(u.a)(t).call(this,e,n))).secondsPerWater=r,i.waterRemaining=a,i.displayName="Fountain",i.isObstacle=!0,i.cooldown=0,i}return Object(d.a)(t,e),Object(l.a)(t,[{key:"shouldStep",value:function(e){return e>.1}},{key:"step",value:function(e){if(Object(h.a)(Object(u.a)(t.prototype),"step",this).call(this,e),this.cooldown>0&&(this.cooldown-=e),this.inventory.space()>1&&this.cooldown<=0&&this.waterRemaining>0)if(this.inventory.add(1,0),this.waterRemaining-=1,this.waterRemaining>0)this.cooldown=this.secondsPerWater;else{var n=new f.c(this.pos.clone(),this.world);this.inventory.give(n.inventory,this.inventory.water,this.inventory.sugar),this.world.maybeRemoveCellAt(this.pos),this.world.setTileAt(this.pos,n)}}}]),t}(f.c),m=n(25),p=n(43),y=n(51),g=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).displayName="Rock",n.isObstacle=!0,n.isStructuralSupport=!0,n.inventory=new p.a(0,Object(m.a)(n)),n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"shouldStep",value:function(e){return e>.3}},{key:"darknessContrib",get:function(){return 1}},{key:"cellDistanceContrib",get:function(){return 1/0}}]),t}(y.a),b=n(58);n.d(t,"e",(function(){return b.b})),n.d(t,"a",(function(){return i.a})),n.d(t,"c",(function(){return o.a})),n.d(t,"d",(function(){return v})),n.d(t,"g",(function(){return g})),n.d(t,"h",(function(){return f.d})),n.d(t,"i",(function(){return y.a})),n.d(t,"b",(function(){return r.a})),n.d(t,"f",(function(){return a.a}))},,function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return l}));var r=n(22),a=n(4),i=n(3),o=n(70),s=function(){function e(t,n,r,i){Object(a.a)(this,e),this.blueprint=t,this.initialStateFn=n,this.stepFn=r,this.shouldStepFn=i}return Object(i.a)(e,[{key:"level",value:function(e){return new o.a(this,e)}},{key:"numLevels",get:function(){return this.blueprint.levelCosts.length}}],[{key:"make",value:function(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null!=a?u:h,o="function"===typeof n?n:function(){return Object(r.a)({},null!==n&&void 0!==n?n:{})},s=new e(t,o,null!==a&&void 0!==a?a:c,i);if(!t.isHidden){var d=s.blueprint.name,f=l.has(d);f&&console.error("A gene named",d,"already exists!"),l.set(s.blueprint.name,s)}return s}}]),e}(),l=new Map,c=function(){},u=function(e){return!0},h=function(e){return!0}},function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"f",(function(){return a})),n.d(t,"h",(function(){return i})),n.d(t,"g",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"n",(function(){return l})),n.d(t,"m",(function(){return c})),n.d(t,"l",(function(){return u})),n.d(t,"k",(function(){return h})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return v})),n.d(t,"j",(function(){return m})),n.d(t,"i",(function(){return p}));var r=4.2,a=100,i=25,o=25,s=30,l=2160,c=l/4,u=c/3,h=u/3,d=.9,f=0,v=.027,m=.15,p=0},,,function(e,t,n){"use strict";n.d(t,"u",(function(){return a})),n.d(t,"h",(function(){return i})),n.d(t,"m",(function(){return q})),n.d(t,"l",(function(){return _})),n.d(t,"s",(function(){return $})),n.d(t,"q",(function(){return ee})),n.d(t,"r",(function(){return te})),n.d(t,"j",(function(){return ne})),n.d(t,"o",(function(){return re})),n.d(t,"p",(function(){return ae})),n.d(t,"w",(function(){return ie})),n.d(t,"k",(function(){return oe})),n.d(t,"b",(function(){return se})),n.d(t,"c",(function(){return le})),n.d(t,"d",(function(){return ce})),n.d(t,"t",(function(){return ue})),n.d(t,"f",(function(){return he})),n.d(t,"g",(function(){return de})),n.d(t,"a",(function(){return me})),n.d(t,"v",(function(){return pe})),n.d(t,"i",(function(){return ye})),n.d(t,"n",(function(){return ge})),n.d(t,"e",(function(){return Ee}));var r,a,i,o=n(145),s=n.n(o),l=n(146),c=n.n(l),u=n(147),h=n.n(u),d=n(148),f=n.n(d),v=n(149),m=n.n(v),p=n(150),y=n.n(p),g=n(151),b=n.n(g),w=n(152),E=n.n(w),k=n(153),O=n.n(k),A=n(154),j=n.n(A),x=n(155),C=n.n(x),S=n(156),P=n.n(S),M=n(157),T=n.n(M),N=n(158),R=n.n(N),F=n(159),D=n.n(F),B=n(160),I=n.n(B),z=n(161),G=n.n(z),L=n(162),W=n.n(L),V=n(163),U=n.n(V),H=n(164),Q=n.n(H),Y=n(165),K=n.n(Y),X=n(41),Z=n(2),J=n(71),q=new X.Howl({src:[Q.a]}),_=new X.Howl({src:[n(253)]}),$=new X.Howl({src:[n(254)]}),ee=new X.Howl({src:G.a,autoplay:!1,loop:!0,volume:1}),te=(new X.Howl({src:D.a,autoplay:!1,loop:!0,volume:.3}),new X.Howl({src:R.a,autoplay:!1,loop:!0,volume:.15})),ne=new X.Howl({src:[b.a],autoplay:!0,loop:!0,volume:0}),re=new X.Howl({src:[j.a],autoplay:!0,loop:!0,volume:0}),ae=new X.Howl({src:C.a,volume:.5}),ie=new X.Howl({src:K.a,volume:.2}),oe=new X.Howl({src:E.a,volume:.3}),se=new X.Howl({src:[c.a],volume:.1}),le=new X.Howl({src:[h.a],volume:.5}),ce=new X.Howl({src:[f.a],volume:.5}),ue=new X.Howl({src:[W.a]}),he=new X.Howl({src:[O.a],volume:.5}),de=new X.Howl({src:[m.a]}),fe=new Z.AudioLoader;function ve(e){return new Promise((function(t,n){fe.load(e,(function(e){t(e)}),(function(e){}),(function(e){Object(J.a)("An error happened"),n(e)}))}))}var me=ve(s.a),pe=ve(U.a),ye=ve(y.a);function ge(e){var t=0;function n(){3===++t&&(r.audio.currentTime=0,a.audio.currentTime=0,i.audio.currentTime=0,r.gain.connect(e.gain),a.gain.connect(e.gain),i.gain.connect(e.gain))}(r=we(e,P.a)).audio.oncanplaythrough=n,r.gain.gain.value=.25,(a=we(e,I.a)).audio.oncanplaythrough=n,a.gain.gain.value=0,(i=we(e,T.a)).audio.oncanplaythrough=n,i.gain.gain.value=0}function be(e){var t=e.substr(e.length-3),n=document.createElement("source");return n.src=e,n.type="audio/".concat(t),n}function we(e){var t=document.createElement("audio");t.autoplay=!0,t.loop=!0;for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var i=0,o=r;i<o.length;i++){var s=o[i];t.appendChild(be(s))}var l=e.createMediaElementSource(t),c=e.createGain();return l.connect(c),{audio:t,gain:c}}function Ee(e,t){var n=e.pos.distanceToSquared(t.pos);return Math.min(1,1/(1+n/25))}},function(e,t,n){"use strict";n(106),n(87);var r=n(107);n.d(t,"a",(function(){return r.GeneAttractsWater}));n(108),n(88),n(109),n(110),n(89),n(111);var a=n(112);n.d(t,"c",(function(){return a.GeneInventory}));var i=n(113);n.d(t,"d",(function(){return i.GeneLiving}));n(114),n(115);var o=n(65);n.d(t,"e",(function(){return o.GeneObstacle}));var s=n(116);n.d(t,"f",(function(){return s.GeneOsmosis}));var l=n(90);n.d(t,"g",(function(){return l.GenePhotosynthesis}));var c=n(91);n.d(t,"h",(function(){return c.GenePipes}));n(117);var u=n(52);n.d(t,"b",(function(){return u.GeneFruit})),n.d(t,"j",(function(){return u.GeneSeed}));var h=n(118);n.d(t,"i",(function(){return h.GeneScaffolding}));var d=n(119);n.d(t,"k",(function(){return d.GeneSoilAbsorption}));var f=n(75);n.d(t,"l",(function(){return f.GeneTransport}));n(120)},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(166),a=n.n(r),i=n(167),o=n.n(i),s=n(1),l=s.memo((function(e){var t=e.name,n=e.s;return s.createElement("img",{alt:"",src:n||"sugar"===t||"s"===t?a.a:o.a,className:"resource-icon"})}))},function(e,t,n){"use strict";n(81);var r=n(45);n.d(t,"b",(function(){return r.a}));var a=n(58);n.d(t,"a",(function(){return a.a})),n.d(t,"c",(function(){return a.b}));n(95),n(44),n(13),n(96);var i=n(29);n.d(t,"f",(function(){return i.c}));var o=n(94);n.d(t,"d",(function(){return o.a}));n(97);var s=n(70);n.d(t,"e",(function(){return s.a}))},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=new Map;function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2?arguments[2]:void 0,a="".concat(n,",").concat(t);return r.has(a)||r.set(a,new Intl.NumberFormat(void 0,{maximumSignificantDigits:t,minimumSignificantDigits:n,useGrouping:!0})),r.get(a).format(e)}},,,,,function(e,t,n){"use strict";n.d(t,"d",(function(){return T})),n.d(t,"a",(function(){return R})),n.d(t,"b",(function(){return F})),n.d(t,"c",(function(){return D}));var r,a,i,o,s,l,c,u,h,d,f,v,m,p,y=n(36),g=n(9),b=n(27),w=n(4),E=n(3),k=n(28),O=(n(80),n(72)),A=n(5),j=n(10),x=n(2),C=n(44),S=n(97),P=n(70),M={"give water":"instant","give sugar":"instant","give water and sugar":"continuous","give water take sugar":"continuous","give sugar take water":"instant","take water":"continuous","take sugar":"continuous","take water and sugar":"continuous"};function T(e){var t,n=e.resources,r=e.type,a="".concat(r," ").concat(n);return null!==(t=M[a])&&void 0!==t?t:"instant"}var N=Object(j.b)({"*":!0}),R=(r=Object(j.k)(Object(j.h)(C.a)),a=Object(j.k)(Object(j.h)(S.a)),i=Object(j.k)(Object(j.h)(N)),o=function(){function e(t,n,r,a,i){Object(w.a)(this,e),Object(b.a)(this,"name",s,this),Object(b.a)(this,"geneSlots",l,this),Object(b.a)(this,"chromosome",c,this),Object(b.a)(this,"material",u,this),Object(b.a)(this,"interaction",h,this),this.args=void 0,this.name=t,this.geneSlots=n,this.chromosome=r,this.material=a,this.interaction=i,(null===r||void 0===r?void 0:r.computeStaticProperties().isDirectional)&&(this.args={direction:new x.Vector2(0,-1)})}return Object(E.a)(e,[{key:"rotateArgDirection",value:function(){var e,t=null===(e=this.args)||void 0===e?void 0:e.direction;null===t||void 0===t||t.rotateAround(new x.Vector2,-Math.PI/4).setLength(1).round()}},{key:"isReproducer",value:function(){return this.chromosome.genes.some((function(e){return e.getStaticProperties().isReproductive}))}},{key:"getDuplicateGenes",value:function(){var e=Object(O.toPairs)(Object(O.groupBy)(this.chromosome.genes,(function(e){return e.gene.blueprint.name}))).filter((function(e){return Object(g.a)(e,2)[1].length>1}));return new Set(e.flatMap((function(e){return Object(g.a)(e,2)[1]})))}},{key:"getChanceToBecomeCancerous",value:function(){var e=this.chromosome.geneSlotsNet();return e<0?Object(A.a)(.00125*Math.pow(1.3,Math.abs(e)),0,1):0}}]),e}(),s=Object(k.a)(o.prototype,"name",[j.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=Object(k.a)(o.prototype,"geneSlots",[j.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=Object(k.a)(o.prototype,"chromosome",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=Object(k.a)(o.prototype,"material",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=Object(k.a)(o.prototype,"interaction",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o),F=(d=Object(j.k)(Object(j.f)(Object(j.h)(R))),f=Object(j.k)(Object(j.f)(Object(j.h)(P.a))),v=function(){function e(t,n){Object(w.a)(this,e),Object(b.a)(this,"cellTypes",m,this),Object(b.a)(this,"unusedGenes",p,this),this.cellTypes=t,this.unusedGenes=null!==n&&void 0!==n?n:[]}return Object(E.a)(e,[{key:"getAllGenes",value:function(){return[].concat(Object(y.a)(this.cellTypes.flatMap((function(e){return e.chromosome.genes}))),Object(y.a)(this.unusedGenes))}}]),e}(),m=Object(k.a)(v.prototype,"cellTypes",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=Object(k.a)(v.prototype,"unusedGenes",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v);function D(e){var t=e.resources,n=e.type;return"".concat(n," ").concat(t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var r=n(2),a={nw:new r.Vector2(-1,-1),w:new r.Vector2(-1,0),sw:new r.Vector2(-1,1),n:new r.Vector2(0,-1),s:new r.Vector2(0,1),ne:new r.Vector2(1,-1),e:new r.Vector2(1,0),se:new r.Vector2(1,1)},i=Object.keys(a).map((function(e){return a[e]}))},,function(e,t,n){"use strict";var r=n(48),a=n(1),i=n.n(a);t.a=function(e){return i.a.createElement("span",{className:"gn"},i.a.createElement(r.a,e))}},function(e,t,n){"use strict";var r=n(4),a=n(3),i=new(function(){function e(){var t=this;Object(r.a)(this,e),this.tickerId=1,this.tickers={},this._time=0,this.tickerLoop=function(e){t._time=e;var n=[];for(var r in t.tickers){!0===(0,t.tickers[r])(e)&&n.push(Number(r))}for(var a=0,i=n;a<i.length;a++){var o=i[a];t.removeAnimation(o)}requestAnimationFrame(t.tickerLoop)}}return Object(a.a)(e,[{key:"addAnimation",value:function(e){var t=this.tickerId++;return this.tickers[t]=e,t}},{key:"removeAnimation",value:function(e){return delete this.tickers[e]}},{key:"start",value:function(){requestAnimationFrame(this.tickerLoop)}},{key:"now",get:function(){return this._time}}]),e}());i.start(),t.a=i},function(e,t,n){"use strict";var r=n(19),a=n(1),i=n.n(a);t.a=function(e){return i.a.createElement("span",{className:"ri"},i.a.createElement(r.a,e))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o}));var r,a=n(5);function i(e){return e<=0?r.Freezing:e<=32?r.Cold:e<=64?r.Mild:e<=96?r.Hot:r.Scorching}function o(e,t,n){var r=e,i=!0,o=!1,s=void 0;try{for(var l,c=t[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){r+=l.value}}catch(u){o=!0,s=u}finally{try{i||null==c.return||c.return()}finally{if(o)throw s}}return r/=t.length+1,Object(a.b)(e,r,n/12)}!function(e){e.Scorching="Scorching",e.Hot="Hot",e.Mild="Mild",e.Cold="Cold",e.Freezing="Freezing"}(r||(r={}))},,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(22),a=n(102),i={hud:!0,showGodUI:!1,showFPS:!1,debugPerf:!1,debug:!1},o=Object(r.a)({},i),s=Object(a.parse)(window.location.search);if(null!=s.params){var l=JSON.parse(s.params);Object.assign(o,l)}!function(){for(var e={},t=0,n=Object.keys(i);t<n.length;t++){var s=n[t],l=o[s];l!==i[s]&&(e[s]=l)}if(Object.keys(e).length>0){var c=Object(a.stringify)(Object(r.a)({},Object(a.parse)(window.location.search),{params:JSON.stringify(e)}));window.location.search=c}}()},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(4),a=n(3),i=n(66);function o(e){return Math.round(1e12*e)/1e12}var s=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(r.a)(this,e),this.capacity=t,this.carrier=n,this.water=a,this.sugar=i,this.events=void 0,this.validate()}return Object(a.a)(e,[{key:"isEmpty",value:function(){return 0===this.water&&0===this.sugar}},{key:"has",value:function(e,t){return this.water>=e&&this.sugar>=t}},{key:"give",value:function(e,t,n){if(e===this)throw new Error("shouldn't give to self");if(0===t&&0===n)return{water:0,sugar:0};var r=t>0?Math.min(t,this.water):-Math.min(-t,e.water),a=n>0?Math.min(n,this.sugar):-Math.min(-n,e.sugar),i=o(r+a),s=e.space();return i>s&&(r=Math.floor(r/i*s),a=Math.floor(a/i*s)),0===r&&0===a||(this.change(-r,-a),e.change(r,a),this.events&&this.events.emit("give",e,r,a),e.events&&e.events.emit("get",this,r,a)),{water:r,sugar:a}}},{key:"on",value:function(e,t){this.events=this.events||new i.EventEmitter,this.events.on(e,t)}},{key:"off",value:function(e,t){this.events=this.events||new i.EventEmitter,this.events.off(e,t)}},{key:"set",value:function(e,t){this.water=0,this.sugar=0,this.add(e,t)}},{key:"add",value:function(e,t){var n=o(e+t),r=this.space();n>r&&(e=e/n*r,t=t/n*r),this.change(e,t),this.events&&this.events.emit("add",e,t)}},{key:"change",value:function(e,t){var n=o(this.water+e),r=o(this.sugar+t);this.validate(n,r),this.water=n,this.sugar=r,this.water<0&&(this.water=0),this.sugar<0&&(this.sugar=0),this.water+this.sugar>this.capacity&&(this.water>this.sugar?this.water=this.capacity-this.sugar:this.sugar=this.capacity-this.water)}},{key:"space",value:function(){return o(this.capacity-this.water-this.sugar)}},{key:"isMaxed",value:function(){return this.space()<1}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.water,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sugar,n=this.capacity;e<0&&console.warn("water < 0: ".concat(e)),t<0&&console.warn("sugar < 0: ".concat(t)),e+t>n&&console.warn("bad inventory: ".concat(e," water + ").concat(t," > ").concat(n," max"))}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r,a,i,o=n(9),s=n(27),l=n(4),c=n(3),u=n(28),h=(n(80),n(10)),d=n(95),f=n(70),v=(r=Object(h.k)(Object(h.f)(Object(h.h)(f.a))),a=function(){function e(){Object(l.a)(this,e),Object(s.a)(this,"genes",i,this);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.genes=n}return Object(c.a)(e,[{key:"computeStaticProperties",value:function(){var e=Object(d.a)(),t=!0,n=!1,r=void 0;try{for(var a,i=this.genes[Symbol.iterator]();!(t=(a=i.next()).done);t=!0)for(var s=a.value,l=0,c=Object.entries(s.getStaticProperties());l<c.length;l++){var u=Object(o.a)(c[l],2),h=u[0],f=u[1];"tempo"===h?e[h]*=f:"number"===typeof f?e[h]=e[h]+f:null!=f&&(e[h]=f)}}catch(v){n=!0,r=v}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e.timeToBuild=Math.max(e.timeToBuild,0),e}},{key:"newGeneInstances",value:function(e){return this.genes.map((function(t){return t.newInstance(e)}))}},{key:"has",value:function(e){return null!=this.genes.find((function(t){return t.gene===e}))}},{key:"isEmpty",value:function(){return 0===this.genes.length}},{key:"geneSlotsUsed",value:function(){return this.genes.map((function(e){return e.getCost()})).filter((function(e){return e>=0})).reduce((function(e,t){return e+t}),0)}},{key:"geneSlotsAdded",value:function(){return-1*this.genes.map((function(e){return e.getCost()})).filter((function(e){return e<0})).reduce((function(e,t){return e+t}),0)}},{key:"geneSlotsNet",value:function(){return this.geneSlotsAdded()-this.geneSlotsUsed()}}]),e}(),i=Object(u.a)(a.prototype,"genes",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));var r=n(9),a=n(22),i=n(4),o=n(8),s=n(25),l=n(6),c=n(55),u=n(3),h=n(7),d=n(43),f=n(40),v=n(2),m=n(14),p=n(30),y=n(64),g=n(98),b=n(35),w=n(81),E=n(51),k=n(58),O=n(29),A=function(e){function t(e,n,r,a){var c;Object(i.a)(this,t),(c=Object(o.a)(this,Object(l.a)(t).call(this,e,n))).type=r,c.energy=1,c.darkness=0,c.closestCellDistance=0,c.nextTemperature=void 0,c.droopY=0,c.effects=[],c.chromosome=void 0,c.geneInstances=void 0,c.inventory=void 0,c.staticProperties=void 0,c.properties=void 0,c.args={direction:new v.Vector2(0,-1)},c.isDead=!1,c.chromosome=r.chromosome,c.staticProperties=c.chromosome.computeStaticProperties();var u=c.staticProperties.inventoryCapacity;return c.inventory=new d.a(u,Object(s.a)(c)),(null===a||void 0===a?void 0:a.direction)&&c.args.direction.copy(null===a||void 0===a?void 0:a.direction),c.temperatureFloat=48,c.nextTemperature=c.temperatureFloat,c.properties=c.computeDynamicProperties(),c.geneInstances=c.chromosome.newGeneInstances(Object(s.a)(c)),c}return Object(h.a)(t,e),Object(u.a)(t,[{key:"displayName",get:function(){return this.type.name},set:function(e){}},{key:"isObstacle",get:function(){return this.properties.isObstacle}},{key:"isReproductive",get:function(){return this.properties.isReproductive}},{key:"diffusionWater",get:function(){return this.properties.diffusionWater}},{key:"diffusionSugar",get:function(){return this.properties.diffusionSugar}},{key:"moveSpeed",get:function(){return this.temperatureTempo*this.properties.moveSpeed}},{key:"timeToBuild",get:function(){return this.properties.timeToBuild}},{key:"tempo",get:function(){return this.properties.tempo*this.temperatureTempo}},{key:"energyUpkeep",get:function(){return this.properties.energyUpkeep}},{key:"darknessContrib",get:function(){return 0}},{key:"cellDistanceContrib",get:function(){return 0}}]),Object(u.a)(t,[{key:"computeDynamicProperties",value:function(){var e=Object(a.a)({},this.staticProperties),t=!0,n=!1,r=void 0;try{for(var i,o=this.chromosome.genes[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s;e=null!==(s=i.value.getDynamicProperties(this,e))&&void 0!==s?s:e}}catch(l){n=!0,r=l}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return e}},{key:"canPullResources",value:function(e){return e instanceof t}},{key:"addEffect",value:function(e){(e.constructor.stacks||null==this.findEffectOfType(e.constructor))&&(this.properties.cantFreeze&&e instanceof k.b||(e.attachTo(this),this.effects.push(e)))}},{key:"findEffectOfType",value:function(e){return this.effects.find((function(t){return t.constructor===e}))}},{key:"interact",value:function(e){var t=!0,n=!1,a=void 0;try{for(var i,o=this.effects[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;if(Object(g.a)(s)){var l=s.interact(e);if(null!=l)return l}}}catch(v){n=!0,a=v}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}var c=this.type.interaction;if(null!=c){var u=function(){switch(c.resources){case"water":return[1,0];case"sugar":return[0,1];case"water and sugar":return[1,1];case"sugar take water":return[-1,1];case"water take sugar":return[1,-1]}}(),h=Object(r.a)(u,2),d=h[0],f=h[1];return{type:"give"===c.type?"drop":"pickup",water:d,sugar:f,target:this,continuous:"continuous"===Object(O.d)(c)}}}},{key:"die",value:function(){this.world.setTileAt(this.pos,new w.a(this.pos,this.world))}},{key:"shouldStep",value:function(e){return e>.1}},{key:"findGene",value:function(e){return this.geneInstances.find((function(t){return t.isType(e)}))}},{key:"step",value:function(e){f.a.debug&&this.validateDirection(),this.properties=this.computeDynamicProperties(),Object(c.a)(Object(l.a)(t.prototype),"step",this).call(this,e),this.stepDroop(e),e=this.tempo*e,this.stepCancer(e),this.stepCellEffects(e),this.stepGeneInstances(e),this.stepEnergyUpkeep(e)}},{key:"stepEnergyUpkeep",value:function(e){this.energy-=this.energyUpkeep*e,this.energy<=0&&this.die()}},{key:"stepGeneInstances",value:function(e){this.geneInstances.forEach((function(t){return Object(y.c)(t,e)}))}},{key:"stepCellEffects",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.effects[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.step(e)}}catch(o){n=!0,r=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"stepCancer",value:function(e){Math.random()<this.type.getChanceToBecomeCancerous()*e&&this.addEffect(new k.a)}},{key:"stepTemperature",value:function(e){var t=this.world.tileNeighbors(this.pos),n=Array.from(t.values()).map((function(e){return e.temperatureFloat}));if(this.nextTemperature=Object(b.b)(this.temperatureFloat,n,e),this.temperatureFloat<=0){var r=.01667*e;Math.random()<r&&this.addEffect(new k.b)}else if(this.temperatureFloat>96){var a=Math.min(this.inventory.water,1),i=.01667*a;Math.random()<i*e&&(this.inventory.add(-a,0),this.world.logEvent({type:"evaporation",tile:this}))}}},{key:"stepDroop",value:function(e){var n=this.world.tileNeighbors(this.pos),r=n.get(p.a.s),a=n.get(p.a.sw),i=n.get(p.a.se),o=n.get(p.a.w),s=n.get(p.a.e),l=n.get(p.a.n),c=n.get(p.a.nw),u=n.get(p.a.ne),h=m.b;this.droopY+=h;for(var d=0,f=[r,a,i];d<f.length;d++){var v=f[d];if(v.isStructuralSupport)return void(this.droopY=Math.min(this.droopY,0));if(v instanceof t)return void(this.droopY=Math.min(this.droopY,v.droopY))}var y=[c,l,u,o,s,this].filter((function(e){return e instanceof t}));this.droopY=y.reduce((function(e,t){return e+t.droopY}),0)/y.length,this.stepDroopPositionUpdate()}},{key:"stepDroopPositionUpdate",value:function(){this.droopY>.5&&(this.pos.y<this.world.height-1?(this.world.player.pos.equals(this.pos)&&(this.world.player.posFloat.y+=1),this.world.maybeRemoveCellAt(this.pos),this.pos.y+=1,this.droopY-=1,this.world.setTileAt(this.pos,this)):this.droopY=.5)}},{key:"stepDarkness",value:function(e){this.darkness=0}},{key:"stepClosestCellDistance",value:function(){this.closestCellDistance=0}},{key:"validateDirection",value:function(){if(this.properties.isDirectional){var e=this.args.direction;(j(e.x)||j(e.y))&&console.error("build transport with fractional dir "+e.x+", "+e.y),(e.manhattanLength()<1||e.manhattanLength()>3)&&console.error("bad dir length",e)}}},{key:"temperatureTempo",get:function(){return this.temperatureFloat<=0?.5:this.temperatureFloat<=32?2/3:this.temperatureFloat<=64?1:this.temperatureFloat<=96?1.25:1.5}}]),t}(E.a);function j(e){return e%1!==0}},function(e,t,n){"use strict";n.d(t,"d",(function(){return m})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return y})),n.d(t,"a",(function(){return g}));var r=n(25),a=n(4),i=n(3),o=n(8),s=n(6),l=n(55),c=n(7),u=n(14),h=n(43),d=n(51),f=n(5),v=n(82),m=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(n=Object(o.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(i)))).depth=1e3,n.isObstacle=!1,n.isStructuralSupport=!0,n.rechargeWaterCooldown=Object(f.f)(0,u.k),n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"canPullResources",value:function(e){return e instanceof t||e instanceof v.a}},{key:"interact",value:function(){return{type:"pickup",water:.1,sugar:.1,target:this,continuous:!0}}},{key:"shouldStep",value:function(e){return e>.2}},{key:"step",value:function(e){Object(l.a)(Object(s.a)(t.prototype),"step",this).call(this,e),this.stepEvaporation(e),this.stepGiveWater(e)}},{key:"stepEvaporation",value:function(e){var t=this.world.environment.secondsToEvaporate,n=this.inventory.water,r=n/t*Object(f.a)(Object(f.d)(this.depth,1,8,1,0),0,1);if(Math.random()<r*e){var a=Math.min(n,1);this.inventory.add(-a,0),this.world.logEvent({type:"evaporation",tile:this}),this.world.numEvaporatedSoil+=a}}},{key:"stepGiveWater",value:function(e){this.rechargeWaterCooldown-=e,this.rechargeWaterCooldown<=0&&(this.inventory.water<this.saturation&&(this.inventory.add(1,0),this.world.numRechargedWater+=1),this.rechargeWaterCooldown+=u.k)}},{key:"diffuseWater",value:function(e,n,r){if(!(this.pos.y<e.pos.y)&&!(e instanceof t&&e.inventory.water<=e.saturation))return Object(l.a)(Object(s.a)(t.prototype),"diffuseWater",this).call(this,e,n,r)}},{key:"stepGravity",value:function(e){var t=this.inventory.water-this.saturation;if(t>0){var n=this.fallAmount*e,r=this.world.tileAt(this.pos.x,this.pos.y+1);if(n>0&&null!=r&&r.canPullResources(this)){var a=Math.min(Object(f.h)(n),t);this.inventory.give(r.inventory,a,0)}}}},{key:"stepTemperature",value:function(e){var t=this.world.weather.getCurrentTemperature();this.temperatureFloat=Object(f.b)(t,50,Object(f.a)(Object(f.d)(this.depth-1,0,8,0,1),0,1))}},{key:"depthDiffusionFactor",get:function(){return 1+(this.depth-1)/10}}]),t}(d.a),p=function(e){function t(){var e,n;Object(a.a)(this,t);for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).displayName="Sand",n.inventory=new h.a(20,Object(r.a)(n)),n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"diffusionWater",get:function(){return 1/(3*this.depthDiffusionFactor)}},{key:"saturation",get:function(){return 0}},{key:"fallAmount",get:function(){return 2/this.depthDiffusionFactor}}]),t}(m),y=function(e){function t(){var e,n;Object(a.a)(this,t);for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).displayName="Silt",n.inventory=new h.a(10,Object(r.a)(n)),n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"diffusionWater",get:function(){return 1/(12*this.depthDiffusionFactor)}},{key:"saturation",get:function(){return 2}},{key:"fallAmount",get:function(){return.3/this.depthDiffusionFactor}}]),t}(m),g=function(e){function t(){var e,n;Object(a.a)(this,t);for(var i=arguments.length,l=new Array(i),c=0;c<i;c++)l[c]=arguments[c];return(n=Object(o.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(l)))).displayName="Clay",n.inventory=new h.a(10,Object(r.a)(n)),n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"diffusionWater",get:function(){return 1/(100*this.depthDiffusionFactor)}},{key:"saturation",get:function(){return 5}},{key:"fallAmount",get:function(){return.075/this.depthDiffusionFactor}}]),t}(m)},,function(e,t,n){"use strict";var r=n(9),a=n(1),i=n.n(a),o=n(33),s=n(24);t.a=function(e){var t=e.value,n=e.speed,a=void 0===n?.5:n,l=e.sigFigs,c=void 0===l?3:l,u=i.a.useState(t),h=Object(r.a)(u,2),d=h[0],f=h[1];return i.a.useEffect((function(){function e(){f((function(e){return Math.abs(e-t)<.005?(o.a.removeAnimation(n),t):e*(1-a)+t*a}))}e();var n=o.a.addAnimation(e);return function(){o.a.removeAnimation(n)}}),[t,a]),i.a.createElement(i.a.Fragment,null,Object(s.a)(d,c))}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(9),a=n(4),i=n(3),o=n(63),s=n(5),l=n(35),c=function(){function e(t,n){if(Object(a.a)(this,e),this.world=n,this.displayName="Tile",this.darkness=1/0,this.temperatureFloat=void 0,this.isStructuralSupport=!1,this.dtSinceLastStepped=0,this.inventory=void 0,this.closestCellDistance=1/0,this.timeMade=void 0,this.pos=void 0,this.pos=t.clone(),null==n)throw new Error("null world!");this.timeMade=n.time,this.temperatureFloat=this.world.weather.getCurrentTemperature()}return Object(i.a)(e,[{key:"temperature",get:function(){return Object(l.c)(this.temperatureFloat)}},{key:"diffusionWater",get:function(){return this.constructor.diffusionWater}},{key:"diffusionSugar",get:function(){return this.constructor.diffusionSugar}},{key:"fallAmount",get:function(){return this.constructor.fallAmount}},{key:"darknessContrib",get:function(){return Math.max(.2)}},{key:"cellDistanceContrib",get:function(){return 1}},{key:"age",get:function(){return this.world.time-this.timeMade}}]),Object(i.a)(e,[{key:"canPullResources",value:function(e){return this instanceof e.constructor||e instanceof this.constructor}},{key:"lightAmount",value:function(){return Math.sqrt(Object(s.a)(1-this.darkness,0,1))}},{key:"redistributeInventoryToNeighbors",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inventory.water,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.inventory.sugar;if(t=Object(s.a)(t,0,this.inventory.water),n=Object(s.a)(n,0,this.inventory.sugar),t>0||n>0){for(var r=this.world.tileNeighbors(this.pos),a=Array.from(r.values()).filter((function(t){return t.canPullResources(e)})),i=0;(t>0||n>0)&&a.length>0&&i<20;){Object(o.a)(a);for(var l=0;l<a.length;l++){var c=a[l],u=this.inventory.give(c.inventory,Object(s.a)(t,0,1),Object(s.a)(n,0,1)),h=u.water,d=u.sugar;if(t-=h,n-=d,c.inventory.isMaxed()&&a.splice(l,1),0===t&&0===n)break}i++}i>=100&&console.error("redistributeInventoryToNeighbors passed guard limit")}}},{key:"step",value:function(e){var t=this.world.tileNeighbors(this.pos);this.stepDarkness(t),this.stepClosestCellDistance(t),this.stepDiffusion(t,e),this.stepTemperature(e),this.stepGravity(e)}},{key:"stepTemperature",value:function(e){this.temperatureFloat=this.world.weather.getCurrentTemperature()}},{key:"stepDarkness",value:function(e){var t=this.darkness,n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=Object(r.a)(o.value,2)[1],c=l.darkness+l.darknessContrib;t=Math.min(t,c)}}catch(u){a=!0,i=u}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}this.darkness=t}},{key:"stepClosestCellDistance",value:function(e){var t=this.closestCellDistance,n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=Object(r.a)(o.value,2),c=l[0],u=l[1].closestCellDistance+this.cellDistanceContrib*c.length();t=Math.min(t,u)}}catch(h){a=!0,i=h}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}this.closestCellDistance=t}},{key:"stepDiffusion",value:function(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=e.values()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;this.canPullResources(s)&&(null!=this.diffusionWater&&s.inventory.water>this.inventory.water&&this.diffuseWater(s,t),null!=this.diffusionSugar&&s.inventory.sugar>this.inventory.sugar&&this.diffuseSugar(s,t))}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}}},{key:"diffuseWater",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.diffusionWater,r=e.inventory.water-this.inventory.water,a=this.inventory.water>0||e.inventory.water>1;if(r>0&&a){var i=Math.min(r*n*t,r/2);e.inventory.give(this.inventory,i,0)}}},{key:"diffuseSugar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.diffusionSugar,r=e.inventory.sugar-this.inventory.sugar;if(r>1){var a=Math.min(r*n*t,r/2);e.inventory.give(this.inventory,0,a)}}},{key:"stepGravity",value:function(e){var t=this.fallAmount*e,n=this.world.tileAt(this.pos.x,this.pos.y+1);t>0&&null!=n&&n.canPullResources(this)&&this.inventory.give(n.inventory,Object(s.h)(t),0)}},{key:"toString",value:function(){return this.displayName+"("+this.pos.x+","+this.pos.y+")"}}]),e}();c.fallAmount=0},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneFruit",(function(){return u})),n.d(t,"GeneSeed",(function(){return h})),n.d(t,"reproducerGetPercentMatured",(function(){return v}));var r=n(24),a=n(54),i=n(5),o=n(1),s=n.n(o),l=n(45),c=n(13),u=c.b.make({name:"Fruit",levelCosts:[10,15,20,25,30],levelProps:{mpEarned:[3,4,5,6,7],neededEnergy:400},static:{isReproductive:!0,timeToBuild:-1},description:d},(function(){return{isMature:!1,energyRecieved:0}}),(function(e,t){f(e,t)})),h=c.b.make({name:"Seed",levelCosts:[3,4,5,6,8],levelProps:{mpEarned:[1,1.25,1.5,1.75,2],neededEnergy:150},static:{isReproductive:!0,timeToBuild:-1},description:d},(function(){return{isMature:!1,energyRecieved:0}}),(function(e,t){f(e,t)}));function d(e){var t=e.mpEarned,n=e.neededEnergy;return s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Absorbs ",n," energy from neighbors to mature."),s.a.createElement("p",null,"Each neighboring Cell contributes 1 energy every ",s.a.createElement("b",null,Object(r.a)(4,1))," seconds."),s.a.createElement("p",null,"On maturation,"," ",s.a.createElement("b",null,"achieve ",s.a.createElement("span",{className:"reproduction"},"Survival"))," ","and earn ",s.a.createElement(a.a,{amount:t}),"."))}function f(e,t){var n=t.cell,r=t.state,a=t.props,o=a.mpEarned,s=a.neededEnergy;if(!r.isMature){!function(e,t,n,r){var a=r-n.energyRecieved,o=0,s=t.world.tileNeighbors(t.pos),c=!0,u=!1,h=void 0;try{for(var d,f=s.values()[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var v=d.value;if(v instanceof l.a&&(v.energy>.5&&a>0&&!v.isReproductive)){var m=Object(i.a)(v.energy,0,.25*e);n.energyRecieved+=m,v.energy-=m,a-=m,o+=m,t.world.logEvent({type:"cell-transfer-energy",from:v,to:t,amount:m})}}}catch(p){u=!0,h=p}finally{try{c||null==f.return||f.return()}finally{if(u)throw h}}o>0&&t.world.logEvent({type:"grow-fruit",cell:t,resourcesUsed:20*o})}(e,n,r,s);var c=v(t)>=1;if(c&&(r.isMature=c,r.timeMatured=n.world.time,t.earnMP(n,o)),n.energy<.5){var u=Object(i.a)(Object(i.a)(.5-n.energy,0,.25*e),0,r.energyRecieved);r.energyRecieved-=u,n.energy+=u}}}function v(e){return e.state.energyRecieved/(e.props.neededEnergy-1e-12)}},,function(e,t,n){"use strict";var r=n(47),a=n(12),i=n.n(a),o=n(1),s=n.n(o),l=n(67),c=n(48);n(255);t.a=function(e){var t=e.amount,n=e.total,a=Object(r.a)(e,["amount","total"]);return s.a.createElement("span",Object.assign({},a,{className:i()("mp",a.className)}),s.a.createElement(c.a,{speed:.5,sigFigs:5,value:t}),null!=n?s.a.createElement(s.a.Fragment,null,"/",n):null,s.a.createElement(l.a,{className:"mp-icon"}))}},,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return m}));var r=n(9),a=n(8),i=n(6),o=n(7),s=n(4),l=n(3),c=n(14),u=n(64),h=n(35),d=n(45),f=function(){function e(){Object(s.a)(this,e),this.timeMade=void 0,this.cell=void 0}return Object(l.a)(e,[{key:"attachTo",value:function(e){this.cell=e,this.timeMade=this.cell.world.time,this.onAttached()}},{key:"onAttached",value:function(){}},{key:"remove",value:function(){var e=this.cell.effects.indexOf(this);this.cell.effects.splice(e,1)}},{key:"age",get:function(){return this.cell.world.time-this.timeMade}}]),e}(),v=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return(n=Object(a.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(o)))).secondsToDie=c.k,n.percentFrozen=.25,n.chunkCooldown=0,n}return Object(o.a)(t,e),Object(l.a)(t,[{key:"interact",value:function(e){return{type:"thaw",target:this}}},{key:"thaw",value:function(e){this.chunkCooldown<=0&&(this.chunkCooldown+=.5,this.percentFrozen-=15/this.secondsToDie*.5,this.percentFrozen<.02&&(this.percentFrozen=0),this.cell.world.logEvent({type:"thaw",where:this.cell})),this.onFrozenChanged()}},{key:"step",value:function(e){throw this.chunkCooldown>0&&(this.chunkCooldown-=e),this.cell.temperature===h.a.Cold?this.percentFrozen+=1/this.secondsToDie*e:this.cell.temperature===h.a.Freezing&&(this.percentFrozen+=10/this.secondsToDie*e),this.onFrozenChanged(),this.cell.energy-=e/this.secondsToDie,new u.a}},{key:"onAttached",value:function(){this.cell.energy-=.2}},{key:"onFrozenChanged",value:function(){this.percentFrozen>1?this.cell.die():this.percentFrozen<=0&&this.remove()}},{key:"timeUntilDeath",get:function(){return this.secondsToDie-this.age}}]),t}(f);v.displayName="Frozen",v.stacks=!1;var m=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return(n=Object(a.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(o)))).secondsPerDuplication=12,n.timeToDuplicate=n.secondsPerDuplication,n}return Object(o.a)(t,e),Object(l.a)(t,[{key:"interact",value:function(e){return{type:"remove-cancer",target:this}}},{key:"removeCancer",value:function(e){this.timeToDuplicate+=4*e,this.timeToDuplicate>1.05*this.secondsPerDuplication&&this.remove()}},{key:"step",value:function(e){if(this.cell.energy-=1/300*e,this.timeToDuplicate-=e,this.timeToDuplicate<0){var n=this.cell.world.tileNeighbors(this.cell.pos),a=!0,i=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=Object(r.a)(s.value,2)[1];if(c instanceof d.a&&!c.findEffectOfType(t)){c.addEffect(new t);break}if(c.world.player.canBuildAt(c)){var u=new d.a(c.pos,c.world,this.cell.type,this.cell.args);this.cell.energy/=2,u.energy=this.cell.energy,u.droopY=this.cell.droopY,c.world.setTileAt(u.pos,u);break}}}catch(h){i=!0,o=h}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}this.timeToDuplicate+=this.secondsPerDuplication}}}]),t}(f);m.displayName="Cancerous",m.stacks=!1},,,,,function(e,t,n){"use strict";function r(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return u}));var r=n(4),a=n(8),i=n(6),o=n(7),s=n(183),l=function(e){function t(){return Object(r.a)(this,t),Object(a.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(o.a)(t,e),t}(Object(s.a)(Error));function c(e){return"function"===typeof e.step}function u(e,t){var n=e.dtSinceLastStepped+t;if(e.shouldStep(n))try{e.step(n)}catch(r){if(!(r instanceof l))throw r}finally{e.dtSinceLastStepped=0}else e.dtSinceLastStepped=n}},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneObstacle",(function(){return i}));var r=n(1),a=n.n(r),i=n(13).b.make({name:"Obstacle",levelCosts:[-3],levelProps:{},static:{isObstacle:!0},description:function(){return a.a.createElement(a.a.Fragment,null,"You may not walk on this Cell.")}},{},(function(){}))},,,,,function(e,t,n){"use strict";var r=n(27),a=n(4),i=n(3),o=n(28);n(80);function s(e,t){var n,r={};for(n in e){var a=e[n];r[n]=t(a,n)}return r}var l,c,u,h,d,f,v=n(5),m=n(10),p=n(59),y=n.n(p),g=n(13),b=n(96),w=n(1),E=n.n(w);n.d(t,"a",(function(){return k}));var k=(l=Object(m.k)(Object(m.c)((function(e){var t=e.blueprint.name.match(/^Unknown \((.+)\)$/);return null!=t?t[1]:e.blueprint.name}),(function(e){var t=g.a.get(e);return null==t?(console.error("Couldn't load gene",e),function(e){return g.b.make({isHidden:!0,name:"Unknown (".concat(e,")"),levelCosts:[0,0,0,0,0],levelProps:{},description:function(){return E.a.createElement(E.a.Fragment,null,"Oops, this Gene couldn't be loaded!")}})}(e)):t}))),c=Object(m.k)(Object(m.e)()),u=function(){function e(t,n){Object(a.a)(this,e),Object(r.a)(this,"gene",h,this),Object(r.a)(this,"level",d,this),Object(r.a)(this,"uuid",f,this),this.gene=t,null!=n&&this.setLevel(n)}return Object(i.a)(e,[{key:"getStaticProperties",value:function(){var e=this;return s(this.gene.blueprint.static||{},(function(t){return Array.isArray(t)?t[e.level]:t}))}},{key:"getDynamicProperties",value:function(e,t){var n,r;return null===(n=(r=this.gene.blueprint).dynamic)||void 0===n?void 0:n.call(r,e,t)}},{key:"getProps",value:function(){var e=this;return s(this.gene.blueprint.levelProps,(function(t){return"number"===typeof t?t:t[e.level]}))}},{key:"getCost",value:function(){return this.gene.blueprint.levelCosts[this.level]}},{key:"setLevel",value:function(e){this.level=Object(v.a)(e,0,this.gene.numLevels-1)}},{key:"newInstance",value:function(e){return new b.a(this.gene,this.getProps(),e)}},{key:"toString",value:function(){return"RealizedGene(".concat(this.gene.blueprint.name," ").concat(this.level," [").concat(this.uuid,"])")}}]),e}(),h=Object(o.a)(u.prototype,"gene",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=Object(o.a)(u.prototype,"level",[m.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=Object(o.a)(u.prototype,"uuid",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return y()()}}),u)},function(e,t,n){"use strict";function r(e){}n.d(t,"a",(function(){return r}))},,,,function(e,t,n){"use strict";n.r(t),n.d(t,"GeneTransport",(function(){return c}));var r=n(19),a=n(5),i=n(1),o=n.n(i),s=n(32),l=n(45),c=n(13).b.make({name:"Transport",levelCosts:[1,1,1,2,3],levelProps:{secondsPerPush:[5,4,3,2,1]},description:function(e){var t=e.secondsPerPush;return o.a.createElement(o.a.Fragment,null,o.a.createElement("b",null,"Hold Shift to configure."),o.a.createElement("p",null,"Every ",o.a.createElement(s.a,{value:t,sigFigs:2})," seconds, move 1",o.a.createElement(r.a,{name:"water"}),"1",o.a.createElement(r.a,{name:"sugar"})," into the directed cell from behind."))},static:{isDirectional:!0,energyUpkeep:1/1500}},(function(e,t){var n=t.secondsPerPush;return{didJustTransport:!1,cooldown:Object(a.f)(0,n)}}),(function(e,t){var n=t.cell,r=t.state,a=t.props.secondsPerPush;if(r.didJustTransport=!1,r.cooldown<=0){r.cooldown+=a;var i=n.world.tileAt(n.pos.x+n.args.direction.x,n.pos.y+n.args.direction.y);i instanceof l.a&&(r.didJustTransport=u(n,i,1,1));var o=n.world.tileAt(n.pos.x-n.args.direction.x,n.pos.y-n.args.direction.y);o instanceof l.a&&(r.didJustTransport=r.didJustTransport||u(o,n,1,1))}r.cooldown-=e}));function u(e,t,n,r){var a=e.inventory.give(t.inventory,n,r),i=a.water,o=a.sugar;return i>0||o>0}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(4),a=n(3),i=function(){function e(t,n,a){Object(r.a)(this,e),this.x=t,this.y=n,this.z=a}return Object(a.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,n){return this.x*e+this.y*t+this.z*n}}]),e}(),o=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],s=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],l=.5*(Math.sqrt(3)-1),c=(3-Math.sqrt(3))/6,u=1/6,h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2147483647*Math.random();Object(r.a)(this,e),this.perm=new Array(512),this.gradP=new Array(512),this.octaveNum=6,this.octaveFalloff=.5,this.octaveMatrix2=[2*Math.cos(1),2*-Math.sin(1),2*Math.sin(1),2*Math.cos(1)],this.seed(t)}return Object(a.a)(e,[{key:"seed",value:function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?s[t]^255&e:s[t]^e>>8&255,this.perm[t]=this.perm[t+256]=n,this.gradP[t]=this.gradP[t+256]=o[n%12]}}}]),Object(a.a)(e,[{key:"simplex2",value:function(e,t){var n,r,a=(e+t)*l,i=Math.floor(e+a),o=Math.floor(t+a),s=(i+o)*c,u=e-i+s,h=t-o+s;u>h?(n=1,r=0):(n=0,r=1);var d=u-n+c,f=h-r+c,v=u-1+2*c,m=h-1+2*c;i&=255,o&=255;var p=this.gradP[i+this.perm[o]],y=this.gradP[i+n+this.perm[o+r]],g=this.gradP[i+1+this.perm[o+1]],b=.5-u*u-h*h,w=.5-d*d-f*f,E=.5-v*v-m*m;return 70*((b<0?0:(b*=b)*b*p.dot2(u,h))+(w<0?0:(w*=w)*w*y.dot2(d,f))+(E<0?0:(E*=E)*E*g.dot2(v,m)))}},{key:"octaveSimplex2",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.octaveNum,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveFalloff,a=0,i=e,o=t,s=1,l=0;l<n;l++){a+=this.simplex2(i,o)*s;var c=i*this.octaveMatrix2[0]+o*this.octaveMatrix2[1],u=i*this.octaveMatrix2[2]+o*this.octaveMatrix2[3];i=c,o=u,s*=r}return a}},{key:"simplex3",value:function(e,t,n){var r,a,i,o,s,l,c=(e+t+n)*(1/3),h=Math.floor(e+c),d=Math.floor(t+c),f=Math.floor(n+c),v=(h+d+f)*u,m=e-h+v,p=t-d+v,y=n-f+v;m>=p?p>=y?(r=1,a=0,i=0,o=1,s=1,l=0):m>=y?(r=1,a=0,i=0,o=1,s=0,l=1):(r=0,a=0,i=1,o=1,s=0,l=1):p<y?(r=0,a=0,i=1,o=0,s=1,l=1):m<y?(r=0,a=1,i=0,o=0,s=1,l=1):(r=0,a=1,i=0,o=1,s=1,l=0);var g=m-r+u,b=p-a+u,w=y-i+u,E=m-o+2*u,k=p-s+2*u,O=y-l+2*u,A=m-1+.5,j=p-1+.5,x=y-1+.5;h&=255,d&=255,f&=255;var C=this.gradP,S=this.perm,P=C[h+S[d+S[f]]],M=C[h+r+S[d+a+S[f+i]]],T=C[h+o+S[d+s+S[f+l]]],N=C[h+1+S[d+1+S[f+1]]],R=.6-m*m-p*p-y*y,F=.6-g*g-b*b-w*w,D=.6-E*E-k*k-O*O,B=.6-A*A-j*j-x*x;return 32*((R<0?0:(R*=R)*R*P.dot3(m,p,y))+(F<0?0:(F*=F)*F*M.dot3(g,b,w))+(D<0?0:(D*=D)*D*T.dot3(E,k,O))+(B<0?0:(B*=B)*B*N.dot3(A,j,x)))}},{key:"octaveSimplex3",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveNum,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.octaveFalloff,i=0,o=e,s=t,l=n,c=1,u=0;u<r;u++)i+=this.simplex3(o,s,l)*c,o*=2,s*=2,l*=2,c*=a;return i}},{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,n){return(1-n)*e+n*t}},{key:"perlin2",value:function(e,t){var n=Math.floor(e),r=Math.floor(t);e-=n,t-=r,n&=255,r&=255;var a=this.gradP,i=this.perm,o=a[n+i[r]].dot2(e,t),s=a[n+i[r+1]].dot2(e,t-1),l=a[n+1+i[r]].dot2(e-1,t),c=a[n+1+i[r+1]].dot2(e-1,t-1),u=this.fade(e);return this.lerp(this.lerp(o,l,u),this.lerp(s,c,u),this.fade(t))}},{key:"perlin3",value:function(e,t,n){var r=this.gradP,a=this.perm,i=Math.floor(e),o=Math.floor(t),s=Math.floor(n);e-=i,t-=o,n-=s;var l=r[(i&=255)+a[(o&=255)+a[s&=255]]].dot3(e,t,n),c=r[i+a[o+a[s+1]]].dot3(e,t,n-1),u=r[i+a[o+1+a[s]]].dot3(e,t-1,n),h=r[i+a[o+1+a[s+1]]].dot3(e,t-1,n-1),d=r[i+1+a[o+a[s]]].dot3(e-1,t,n),f=r[i+1+a[o+a[s+1]]].dot3(e-1,t,n-1),v=r[i+1+a[o+1+a[s]]].dot3(e-1,t-1,n),m=r[i+1+a[o+1+a[s+1]]].dot3(e-1,t-1,n-1),p=this.fade(e),y=this.fade(t),g=this.fade(n);return this.lerp(this.lerp(this.lerp(l,d,p),this.lerp(c,f,p),g),this.lerp(this.lerp(u,v,p),this.lerp(h,m,p),g),y)}}]),e}()},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(4),a=n(3),i=n(8),o=n(6),s=n(25),l=n(7),c=n(43),u=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];return(n=Object(i.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(l)))).displayName="Dead Cell",n.isStructuralSupport=!0,n.isObstacle=!1,n.inventory=new c.a(0,Object(s.a)(n)),n}return Object(l.a)(t,e),Object(a.a)(t,[{key:"shouldStep",value:function(e){return e>.3}}]),t}(n(51).a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(4),a=n(3),i=n(8),o=n(6),s=n(25),l=n(7),c=n(78),u=n(5),h=n(43),d=function(e){function t(e,n){var a;return Object(r.a)(this,t),(a=Object(i.a)(this,Object(o.a)(t).call(this,e,n))).pos=e,a.displayName="Air",a.sunlightCached=1,a._co2=void 0,a.inventory=new h.a(6,Object(s.a)(a)),a.isObstacle=!1,a.darkness=0,a._co2=a.computeCo2(),a}return Object(l.a)(t,e),Object(a.a)(t,[{key:"interact",value:function(){return{type:"pickup",water:.1,sugar:.1,target:this,continuous:!0}}},{key:"shouldStep",value:function(e){return e>.06667}},{key:"computeCo2",value:function(){var e=Object(u.d)(this.pos.y,this.world.height/2,this.world.height/4,this.world.environment.floorCo2,1.15),t=5*Math.max(1,Object(u.d)(this.pos.y,this.world.height/2,0,4,9)),n=null==this.world?0:this.world.time,r=.25*f.perlin3(94.231+(this.pos.x-this.world.width/2)/t,2312+this.pos.y/8,n/50+93.1)-.125;return Object(u.a)(e+r,.25,1)}},{key:"lightAmount",value:function(){return this.sunlight()}},{key:"step",value:function(e){this.stepClosestCellDistance(this.world.tileNeighbors(this.pos)),this.stepGravity(e),this.world.tileAt(this.pos.x,this.pos.y+1)instanceof t||this.stepDiffusionCheap(e),this.stepEvaporation(e),this.stepTemperature(e),this._co2=this.computeCo2()}},{key:"stepDiffusionCheap",value:function(e){var t=this.world.tileAt(this.pos.x-1,this.pos.y),n=this.world.tileAt(this.pos.x+1,this.pos.y);Math.random()<.5?(this.tryDiffuse(t,e),this.tryDiffuse(n,e)):(this.tryDiffuse(n,e),this.tryDiffuse(t,e))}},{key:"tryDiffuse",value:function(e,t){null!=e&&e.canPullResources(this)&&e.inventory.water<this.inventory.water&&e.diffuseWater(this,t)}},{key:"stepEvaporation",value:function(e){Math.random()<this.world.environment.airEvaporation*this.inventory.water*e&&(this.world.numEvaporatedAir+=1,this.inventory.add(-1,0),this.world.logEvent({type:"evaporation",tile:this}))}},{key:"co2",value:function(){return this._co2}},{key:"sunlight",value:function(){return this.sunlightCached}}]),t}(n(51).a);d.fallAmount=30,d.diffusionWater=1.5;var f=new c.a},,function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(9),a=n(20);function i(e,t,n){var i=e.world.tileNeighbors(e.pos),o=!0,s=!1,l=void 0;try{for(var c,u=i[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=Object(r.a)(c.value,2)[1];if(h instanceof a.b){var d=h.inventory.give(e.inventory,t,n),f=d.water,v=d.sugar;if(f>0||v>0)break}}}catch(m){s=!0,l=m}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}}function o(e,t,n){var i=e.world.tileNeighbors(e.pos),o=!0,s=!1,l=void 0;try{for(var c,u=i[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=Object(r.a)(c.value,2)[1];h instanceof a.b&&h.inventory.give(e.inventory,t,n)}}catch(d){s=!0,l=d}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}}},,,function(e,t,n){"use strict";n.r(t),n.d(t,"GeneAttractsSugar",(function(){return c}));var r=n(1),a=n.n(r),i=n(32),o=n(84),s=n(13),l=n(34),c=s.b.make({name:"Attracts Sugar",levelCosts:[1,1,1,1,4],levelProps:{secondsPerPull:[20,14,9,5,1]},static:{energyUpkeep:1/1200},description:function(e){var t=e.secondsPerPull;return a.a.createElement(a.a.Fragment,null,"Every ",a.a.createElement(i.a,{value:t,sigFigs:2})," seconds, take 1",a.a.createElement(l.a,{s:!0})," from every neighboring Cell.")}},{cooldown:0},(function(e,t){var n=t.cell,r=t.state,a=t.props.secondsPerPull;r.cooldown<=0&&(Object(o.a)(n,0,1),r.cooldown+=a),r.cooldown-=e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneCannotFreeze",(function(){return r}));var r=n(13).b.make({name:"Cannot Freeze",levelCosts:[3],levelProps:{},static:{cantFreeze:!0,energyUpkeep:1/600},description:function(){return null}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneDiffuseWater",(function(){return s}));var r=n(19),a=n(1),i=n.n(a),o=n(32),s=n(13).b.make({name:"Diffuse Water",levelCosts:[0,0,0,0,1],static:{diffusionWater:[.1,.12,.14,.16,.25]},levelProps:{},description:function(e,t){var n=t.diffusionWater;return i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Continuously recieve ",i.a.createElement(r.a,{name:"water"})," from neighboring Cells with more."),i.a.createElement("p",null,"On average, get 1",i.a.createElement(r.a,{name:"water"})," every ",i.a.createElement(o.a,{value:1/n,sigFigs:3})," seconds."))}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GenePhotosynthesis",(function(){return u}));var r=n(9),a=n(19),i=n(1),o=n.n(i),s=n(32),l=n(13),c=n(82),u=l.b.make({name:"Photosynthesis",levelCosts:[4,6,8,10,12],levelProps:{reactionChancePerSecond:[.05,.075,.1,.15,.2]},static:{energyUpkeep:1/800},description:function(e){var t=e.reactionChancePerSecond;return o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"Converts ",o.a.createElement(a.a,{name:"water"})," into ",o.a.createElement(a.a,{name:"sugar"}),"."),o.a.createElement("p",null,"50% co2, the trade is 2:1. At 100% co2, the trade is 1:1."),o.a.createElement("p",null,"Each neighboring Air provides a ",o.a.createElement(s.a,{value:100*t,sigFigs:3}),"% chance per second, scaled with sunlight."))}},{totalSugarProduced:0,averageConversionRate:0,averageChancePerSecond:0,sugarConverted:0,activeNeighbors:[]},(function(e,t){var n=t.cell,a=t.state,i=t.props.reactionChancePerSecond;a.averageConversionRate=0,a.averageChancePerSecond=0,a.sugarConverted=0,a.activeNeighbors=[];var o=n.world.tileNeighbors(n.pos),s=0,l=!0,u=!1,d=void 0;try{for(var f,v=o[Symbol.iterator]();!(l=(f=v.next()).done);l=!0){var m=Object(r.a)(f.value,2),p=m[0],y=m[1];y instanceof c.a&&(a.activeNeighbors.push(p),s+=1,h(e,y,n,i,a))}}catch(g){u=!0,d=g}finally{try{l||null==v.return||v.return()}finally{if(u)throw d}}s>0&&(a.averageConversionRate/=s)}));function h(e,t,n,r,a){var i=t.sunlight(),o=t.co2();a.averageConversionRate+=o;var s=1/o,l=Math.min(n.inventory.water,s),c=r*i;l>0&&c>0&&n.world.logEvent({type:"collect-sunlight",leaf:n,air:t,numSunlight:c/.05*e*5});var u=c;if(a.averageChancePerSecond+=u,Math.random()<u*e&&l>0){var h=l*o;n.inventory.add(-l,h),a.sugarConverted+=h,a.totalSugarProduced+=h,n.world.logEvent({type:"photosynthesis",cell:n,sugarMade:h})}}},function(e,t,n){"use strict";n.r(t),n.d(t,"GenePipes",(function(){return c}));var r=n(30),a=n(1),i=n.n(a),o=n(13),s=n(32),l=n(34),c=o.b.make({name:"Pipes",levelCosts:[1,1,1,2,3],levelProps:{diffusionRate:[.15,.175,.2,.25,.25]},static:{energyUpkeep:1/1500},description:function(e){var t=e.diffusionRate;return i.a.createElement(i.a.Fragment,null,i.a.createElement("b",null,"Hold Shift to configure."),i.a.createElement("p",null,"Continuously equalize ",i.a.createElement(l.a,{w:!0})," ",i.a.createElement(l.a,{s:!0})," between connected cells."),i.a.createElement("p",null,"On average, exchange 1 sugar and 1 water every ",i.a.createElement(s.a,{value:1/t,sigFigs:3})," seconds."))}},(function(){return{connections:{n:!1,e:!1,s:!1,w:!1}}}),(function(e,t){var n,a=t.cell,i=t.props.diffusionRate,o=t.state.connections;for(n in o)if(o[n]){var s=r.a[n],l=a.world.cellAt(a.pos.x+s.x,a.pos.y+s.y);l&&(a.diffuseWater(l,e,i),l.diffuseWater(a,e,i),a.diffuseSugar(l,e,i),l.diffuseSugar(a,e,i))}}))},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n(4),a=n(3),i=n(8),o=n(6),s=n(55),l=n(7),c=n(17),u=n(5),h=n(18),d=n(65),f=n(45),v=n(44),m=n(29),p=new v.a(h.d.level(2),d.GeneObstacle.level(0)),y=function(e){function t(e,n,a,s){var l;return Object(r.a)(this,t),(l=Object(i.a)(this,Object(o.a)(t).call(this,e,n,g))).completedCell=a,l.start=s,l.percentGrown=0,l.timeToGrow=void 0,l.silent=void 0,l.timeToGrow=Math.max(a.timeToBuild,1e-5),l}return Object(l.a)(t,e),Object(a.a)(t,[{key:"step",value:function(e){if(Object(s.a)(Object(o.a)(t.prototype),"step",this).call(this,e),this.percentGrown+=this.tempo*e/this.timeToGrow,this.completedCell.pos.copy(this.pos),this.percentGrown>=1){this.world.maybeRemoveCellAt(this.pos),this.completedCell.energy=this.energy;var n=!0,r=!1,a=void 0;try{for(var i,l=this.effects[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var h=i.value;this.completedCell.addEffect(h)}}catch(f){r=!0,a=f}finally{try{n||null==l.return||l.return()}finally{if(r)throw a}}if(this.world.setTileAt(this.pos,this.completedCell),!this.silent){var d=c.c.play();c.c.rate(d,Object(u.f)(.5,1))}}}}]),t}(f.a),g=new m.a("Growing Cell",0,p)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(14);function a(){return{cantFreeze:!1,isReproductive:!1,isObstacle:!1,inventoryCapacity:0,costSugar:1,costWater:1,diffusionWater:0,diffusionSugar:0,moveSpeed:1,tempo:1,energyUpkeep:0,timeToBuild:r.a,isDirectional:!1}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(4),a=n(3),i=function(){function e(t,n,a){Object(r.a)(this,e),this.gene=t,this.props=n,this.cell=a,this.dtSinceLastStepped=0,this.state=void 0,this.state=t.initialStateFn(t,n,a)}return Object(a.a)(e,[{key:"blueprint",get:function(){return this.gene.blueprint}}]),Object(a.a)(e,[{key:"isType",value:function(e){return this.gene===e}},{key:"shouldStep",value:function(e){return this.gene.shouldStepFn(e,this)}},{key:"step",value:function(e){var t=this.gene.stepFn(e,this);void 0!==t&&(this.state=t)}},{key:"earnMP",value:function(e,t){e.world.earnMP(e,t)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(10),a=n(2),i=Object(r.b)({color:Object(r.h)(a.Color),texturePosition:Object(r.h)(a.Vector2)})},function(e,t,n){"use strict";function r(e){return"function"===typeof e.interact}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(4),a=n(3),i=n(8),o=n(6),s=n(25),l=n(7),c=n(43),u=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];return(n=Object(i.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(l)))).displayName="Barren Land",n.isObstacle=!1,n.isStructuralSupport=!0,n.inventory=new c.a(1,Object(s.a)(n)),n}return Object(l.a)(t,e),Object(a.a)(t,[{key:"shouldStep",value:function(e){return e>.2}}]),t}(n(51).a)},,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"GeneAiryExpansion",(function(){return s}));var r=n(11),a=n(1),i=n.n(a),o=n(13),s=o.b.make({name:"Airy Expansion",levelCosts:[1],levelProps:{},description:function(){return i.a.createElement(i.a.Fragment,null,"Grow at ",i.a.createElement("b",null,200,"%")," speed if there's ",i.a.createElement("b",null,5)," or more neighboring Air (diagonals included).")},dynamic:function(e,t){return Array.from(e.world.tileNeighbors(e.pos).values()).filter((function(e){return e instanceof r.a})).length>=5&&(t.timeToBuild/=2),t}})},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneAttractsWater",(function(){return u}));var r=n(5),a=n(1),i=n.n(a),o=n(32),s=n(84),l=n(13),c=n(34),u=l.b.make({name:"Attracts Water",levelCosts:[1,1,1,1,4],levelProps:{secondsPerPull:[20,14,9,5,1]},static:{energyUpkeep:.001},description:function(e){var t=e.secondsPerPull;return i.a.createElement(i.a.Fragment,null,"Every ",i.a.createElement(o.a,{value:t,sigFigs:2})," seconds, take 1",i.a.createElement(c.a,{w:!0})," from every neighboring Cell.")}},(function(e,t){return{cooldown:Object(r.f)(0,t.secondsPerPull)}}),(function(e,t){var n=t.cell,r=t.state,a=t.props.secondsPerPull;r.cooldown<=0&&(Object(s.a)(n,1,0),r.cooldown+=a),r.cooldown-=e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneBark",(function(){return u}));var r=n(9),a=n(14),i=n(11),o=n(1),s=n.n(o),l=n(13),c=n(34),u=l.b.make({name:"Bark",levelCosts:[0],levelProps:{timeBeforeGrowth:a.k},static:{costSugar:1,costWater:1},description:function(e){var t=e.timeBeforeGrowth;return s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Cell costs 1",s.a.createElement(c.a,{w:!0}),"1",s.a.createElement(c.a,{s:!0})," more to grow."),s.a.createElement("p",null,s.a.createElement("b",null,t," seconds")," after growth, this cell emits a Dead Cell on each directly neighboring Air."))}},(function(){return{tried:!1}}),(function(e,t){var n=t.cell,a=t.state,o=t.props;if(!a.tried&&n.age>o.timeBeforeGrowth){var s=n.world.tileNeighbors(n.pos),l=!0,c=!1,u=void 0;try{for(var h,d=s[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f=Object(r.a)(h.value,2)[1];if(f.pos.manhattanDistanceTo(n.pos)<=1&&f instanceof i.a){var v=new i.c(f.pos,f.world);f.world.setTileAt(v.pos,v)}}}catch(m){c=!0,u=m}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}a.tried=!0}}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneCostly",(function(){return o}));var r=n(19),a=n(1),i=n.n(a),o=n(13).b.make({name:"Costly",levelCosts:[-3,-4,-5,-6,-10],levelProps:{},static:{costSugar:[2,3,4,5,8],costWater:[2,3,4,5,8]},description:function(e,t){var n=t.costSugar,a=t.costWater;return i.a.createElement(i.a.Fragment,null,"This cell costs ",a,i.a.createElement(r.a,{name:"water"}),n,i.a.createElement(r.a,{name:"sugar"})," more to grow.")}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneDiffuseSugar",(function(){return l}));var r=n(1),a=n.n(r),i=n(32),o=n(13),s=n(34),l=o.b.make({name:"Diffuse Sugar",levelCosts:[0,0,0,0,1],static:{diffusionSugar:[.1,.12,.14,.16,.25]},levelProps:{},description:function(e,t){var n=t.diffusionSugar;return a.a.createElement(a.a.Fragment,null,a.a.createElement("p",null,"Continuously recieve ",a.a.createElement(s.a,{s:!0})," from neighboring Cells with more."),a.a.createElement("p",null,"On average, get 1",a.a.createElement(s.a,{s:!0})," every ",a.a.createElement(i.a,{value:1/n,sigFigs:3})," seconds."))}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneHydrostasis",(function(){return s}));var r=n(19),a=n(1),i=n.n(a),o=n(13),s=o.b.make({name:"Hydrostasis",levelCosts:[1,1,1,2,3],levelProps:{},static:{energyUpkeep:1/1200},description:function(){return i.a.createElement(i.a.Fragment,null,"If this cell holds between ",2," and ",5," ",i.a.createElement(r.a,{name:"water"}),", it operates"," ",i.a.createElement("b",null,100,"%")," faster.")},dynamic:function(e,t){var n=e.inventory.water;return n>=2&&n<=5&&(t.tempo*=2),t}})},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneInventory",(function(){return o}));var r=n(1),a=n.n(r),i=n(32),o=n(13).b.make({name:"Inventory",levelCosts:[1,1,2,2,3],levelProps:{},static:{inventoryCapacity:[2,4,7,11,15]},description:function(e,t){var n=t.inventoryCapacity;return a.a.createElement(a.a.Fragment,null,"Resource Capacity +",a.a.createElement(i.a,{value:n}),".")}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneLiving",(function(){return l}));var r=n(20),a=n(1),i=n.n(a),o=n(13),s=n(34),l=o.b.make({name:"Living",levelCosts:[-3,-4,-5,-6,-7],levelProps:{},static:{inventoryCapacity:5,energyUpkeep:1/1200},description:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Eats 1",i.a.createElement(s.a,{s:!0})," for 100% energy."),i.a.createElement("p",null,"Shares energy with other cells."),i.a.createElement("p",null,"Allows cell to hold ",i.a.createElement(s.a,{w:!0}),i.a.createElement(s.a,{s:!0}),". Resource Capacity +5."))}},{},(function(e,t){var n=t.cell,a=function(e,t){var n=1-e.energy;if(n<.05)return 0;return Math.min(n,.333*t)}(n,e);a>0&&(a-=function(e,t,n){var r=Math.min(t/n,e.inventory.sugar);if(r>0){e.inventory.add(0,-r);var a=r*n;return e.energy+=a,a>0&&e.world.logEvent({type:"cell-eat",who:e}),a}return 0}(n,a,c));var i=n.world.tileNeighbors(n.pos),o=!0,s=!1,l=void 0;try{for(var h,d=i.values()[Symbol.iterator]();!(o=(h=d.next()).done);o=!0){var f=h.value;f instanceof r.b&&u(e,n,f,.01)}}catch(v){s=!0,l=v}finally{try{o||null==d.return||d.return()}finally{if(s)throw l}}})),c=1;function u(e,t,n,r){var a=t.energy-n.energy;if(a>r){var i=Math.min(a-r,.25*e);t.energy-=i,n.energy+=i,t.world.logEvent({type:"cell-transfer-energy",from:t,to:n,amount:i})}}},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneNetworkEffect",(function(){return s}));var r=n(20),a=n(1),i=n.n(a),o=n(13),s=o.b.make({name:"Network Effect",levelCosts:[2],levelProps:{energyUpkeep:1/1200},description:function(){return i.a.createElement(i.a.Fragment,null,"If this cell has ",6," or more neighbors (diagonals included), it operates"," ",i.a.createElement("b",null,100,"%")," faster.")},dynamic:function(e,t){for(var n=0,a=0,i=Array.from(e.world.tileNeighbors(e.pos).values());a<i.length;a++){i[a]instanceof r.b&&n++}return n>=6&&(t.tempo*=2),t}})},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneNutrientExtraction",(function(){return c}));var r=n(9),a=n(14),i=n(11),o=n(99),s=n(1),l=n.n(s),c=n(13).b.make({name:"Nutrient Extraction",levelCosts:[1,1,1,1,4],levelProps:{energyPerSecond:[.02,.03,.04,.05,.1]},static:{energyUpkeep:1/1200},description:function(e){var t=e.energyPerSecond;return l.a.createElement(l.a.Fragment,null,l.a.createElement("p",null,"While this cell has a neighboring Soil, it gets ",l.a.createElement("b",null,100*t,"%")," energy per second."),l.a.createElement("p",null,"Every ",l.a.createElement("b",null,a.k)," seconds, turn one neighboring Soil into Barren Land."," ",l.a.createElement("i",null,"(Barren Land is not a Soil).")))}},{hasMonthPassed:!1,cooldown:a.k,soil:null},(function(e,t){var n=t.cell,s=t.props,l=t.state;if(null!=l.soil&&n.world.tileAt(l.soil.pos)!==l.soil&&(l.soil=null),null==l.soil){var c=n.world.tileNeighbors(n.pos),u=!0,h=!1,d=void 0;try{for(var f,v=c[Symbol.iterator]();!(u=(f=v.next()).done);u=!0){var m=Object(r.a)(f.value,2)[1];if(m instanceof i.h){l.soil=m;break}}}catch(y){h=!0,d=y}finally{try{u||null==v.return||v.return()}finally{if(h)throw d}}}if(null!=l.soil&&(n.energy+=s.energyPerSecond*e,n.world.logEvent({type:"cell-transfer-energy",amount:s.energyPerSecond*e,from:l.soil,to:n}),n.world.logEvent({type:"cell-eat",who:l.soil})),l.cooldown<=0&&null!=l.soil){var p=new o.a(l.soil.pos,l.soil.world);l.soil.world.setTileAt(p.pos,p),l.soil=null,l.cooldown+=a.k}l.cooldown-=e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneOsmosis",(function(){return l}));var r=n(1),a=n.n(r),i=n(84),o=n(13),s=n(34),l=o.b.make({name:"Osmosis",levelCosts:[1],levelProps:{secondsPerPull:1},static:{},description:function(e){var t=e.secondsPerPull;return a.a.createElement(a.a.Fragment,null,"While this cell has more ",a.a.createElement(s.a,{s:!0})," than ",a.a.createElement(s.a,{w:!0}),", take 1",a.a.createElement(s.a,{w:!0})," every ",t," seconds from a neighbor.")}},{cooldown:0,isOsmosising:!1},(function(e,t){var n=t.cell,r=t.state,a=t.props.secondsPerPull;r.isOsmosising=n.inventory.sugar>n.inventory.water,r.cooldown<=0&&(r.isOsmosising&&Object(i.b)(n,1,0),r.cooldown+=a),r.cooldown-=e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GenePushWater",(function(){return l}));var r=n(9),a=n(1),i=n.n(a),o=n(32),s=n(45),l=n(13).b.make({name:"Push Water",levelCosts:[1,1,1,1,1],levelProps:{secondsPerPush:[20,12,7,3,1]},description:function(e){var t=e.secondsPerPush;return i.a.createElement(i.a.Fragment,null,"Every ",i.a.createElement(o.a,{value:t,sigFigs:2})," seconds, push 1 water from this Cell to each neighboring Cell.")}},{cooldown:0},(function(e,t){var n=t.cell,a=t.state,i=t.props.secondsPerPush,o=n.world.tileNeighbors(n.pos);if(a.cooldown<=0){var l=!0,c=!1,u=void 0;try{for(var h,d=o[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f=Object(r.a)(h.value,2)[1];f instanceof s.a&&n.inventory.give(f.inventory,1,0)}}catch(v){c=!0,u=v}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}a.cooldown+=i}a.cooldown-=e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneScaffolding",(function(){return s}));var r=n(1),a=n.n(r),i=n(13),o=n(32),s=i.b.make({name:"Scaffolding",levelCosts:[-3,-4,-5,-6,-10],levelProps:{},static:{timeToBuild:[3,4,5,6,15]},description:function(e,t){var n=t.timeToBuild;return a.a.createElement(a.a.Fragment,null,"This cell takes ",a.a.createElement(o.a,{value:n})," seconds longer to grow.")}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneSoilAbsorption",(function(){return c}));var r=n(9),a=n(11),i=n(19),o=n(1),s=n.n(o),l=n(32),c=n(13).b.make({name:"Soil Absorption",levelCosts:[3,5,7,9,11],levelProps:{secondsPerAbsorb:[15,12,9.6,7.68,6.14]},static:{energyUpkeep:1/800},description:function(e){var t=e.secondsPerAbsorb;return s.a.createElement(s.a.Fragment,null,"Absorb 1",s.a.createElement(i.a,{name:"water"})," every ",s.a.createElement(l.a,{value:t})," seconds from every neighboring Soil.")}},{cooldown:0,totalSucked:0,activeNeighbors:[]},(function(e,t){var n=t.cell,i=t.state,o=t.props.secondsPerAbsorb;i.cooldown<=0&&(i.activeNeighbors=[],i.totalSucked+=function(e,t){var n=t.world.tileNeighbors(t.pos),i=0,o=!0,s=!1,l=void 0;try{for(var c,u=n[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=Object(r.a)(c.value,2),d=h[0],f=h[1];if(f instanceof a.h){e.push(d);var v=f.inventory.give(t.inventory,1,0).water;i+=v}}}catch(m){s=!0,l=m}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}return i}(i.activeNeighbors,n),i.cooldown+=o),i.cooldown-=e}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneVascular",(function(){return a}));var r=n(45),a=n(13).b.make({name:"Vascular",levelCosts:[1,1,2,2,3],levelProps:{diffusionRate:[.1,.15,.2,.25,.35]},static:{energyUpkeep:1/1200},description:function(e){var t=e.diffusionRate;return"Diffuses water to other Vascular cells with rate ".concat(t,".")}},{},(function(e,t){var n=t.cell,i=t.props.diffusionRate,o=Array.from(n.world.tileNeighbors(n.pos).values()).filter((function(e){return e instanceof r.a&&e.chromosome.has(a)})),s=!0,l=!1,c=void 0;try{for(var u,h=o[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value;n.diffuseWater(d,e,i)}}catch(f){l=!0,c=f}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}}))},,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/Blop-Mark_DiAngelo-79054334.627c0e8b.mp3"},function(e,t,n){e.exports=n.p+"static/media/build.0e2001c4.mp3"},function(e,t,n){e.exports=n.p+"static/media/build_complete.9af6ac71.mp3"},function(e,t,n){e.exports=n.p+"static/media/deconstruct.e5356177.mp3"},function(e,t,n){e.exports=n.p+"static/media/drop_water.7ab1e6f0.mp3"},function(e,t,n){e.exports=n.p+"static/media/eating.e78fa644.mp3"},function(e,t,n){e.exports=n.p+"static/media/footsteps.636605b0.wav"},function(e,t,n){e.exports=n.p+"static/media/fruit-popOpen.5991698f.mp3"},function(e,t,n){e.exports=n.p+"static/media/impactSoft_medium_003.b8698323.mp3"},function(e,t,n){e.exports=n.p+"static/media/interact.848e9d20.mp3"},function(e,t,n){e.exports=n.p+"static/media/intro-bounce.6e8ea313.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-base.28ee2cbb.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-drums.1c82b4f4.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-overworld.62281b29.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-start.473c2a0e.mp3"},function(e,t,n){e.exports=n.p+"static/media/mito-strings.9f30639c.mp3"},function(e,t,n){e.exports=n.p+"static/media/mitodeath.207c4872.mp3"},function(e,t,n){e.exports=n.p+"static/media/sticky.6d27b20f.mp3"},function(e,t,n){e.exports=n.p+"static/media/suckwater.b0fe81fa.wav"},function(e,t,n){e.exports=n.p+"static/media/switch25.f76e435c.wav"},function(e,t,n){e.exports=n.p+"static/media/whoosh.fde62e78.mp3"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wwdEQIkKFbu2wAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAA0UlEQVRYw2NgGAUjHTCSovjYTIb/xKizSifeXKZBGQK4fGppwEeUoccvfCI6ZAZXCMB8TqxPSQWwkEEOicERAkT7XL4Glf+wheKQGPAQYCFJNZk+HtTlAAtFcY1D3cePqOUAPz/fUAsBYuMahzp8Ph7aJSEpcTtkSkK85QDMxzCfEutjdH1Dtz1AbK1IyMfY4n7whMCzW/txSj7Y7/ifGi0ifG3EwR0CDAwMDFJqjvRrFX/+8GpgywFeATGq+WzI1AVMuIKdXtHBhCvYCUUHtQAAj7ZTZKkXht4AAAAASUVORK5CYII="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wwdECsv+gDCjwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAR0lEQVRYw2P8//8/w0ACJoYBBqMOYEEXkBY9TNNE8fS1LeNoFIw6YNQBow4YdcCoA0YdMOqAUQeMOmDUAYPKAYyjfcMR7wAAvzUKOwLggbEAAAAASUVORK5CYII="},,,,function(e,t,n){e.exports=n.p+"static/media/fruit.e136487f.png"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAACC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KD0UqkwAAAM1JREFUKBVjYBgowIjL4v50+/8wucKZB7GqwxCEadJSkYfpZbh25yGYjW4IimaQRpimSbL8cM15jz+C2SBDkA1ggqtAYiBrBAmj82FK4TbDbF2qowSWe/vxLUwNgzC/MJgdfeUe2Asw27HajKwRpAudDzMVq2aYJCGaepr5JSH+hfkRZjOMD5OHicMDDCSAHmgwRSAaPbBAYhjOBpmehQhokBowH91WkDiKzSABWAqztHUEccHg+OH9YBoWRVBhTM0wCZghID66JpgaimgAWfxCZhIsrg0AAAAASUVORK5CYII="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5AQeFiQ4xQbzogAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAFCklEQVRYw8WWXWhbZRjHf+csSZs2zYlztbLqki1erCAkCitM0WSgRRBpWtiFSJveCM4VMqQTtpv0yoIrbANnL1T6MfBCcKe7GVoZ7QSnrEI6h9vY7JpQs62trmv63aR5vEhz2qzpGgdlD7xwyPPmff7P918REZ6mmLIfXV1dEovFAHC5XASDQTdwZ8sRiAihUEiAnONwOKSzs1NEhK08rKRAAGloNktDs1k81aoBZKtBICI4nU4BxFOtSn3QJB29xdLSZjFAjIyMyJYC6OzsXJeC9p4iqanbJoAEAgERkT1bBkBEGBkZEY/HYwDwVKvS3lO05TVhfASDQcNYfdAkJ3qK5NwVq7S0WeTtlUhsRU0oIsLAwIAcOHAAmx1OdBfjrlLXdUufnqL92BIOhwOv14vD4cDv91NbW4vL5VK6urrk0qVLRKPRgjswFAplAAQCATl//jwtbRZq6kzcj6exlSnY7ErOH9qPLdKnL697yOVy/S/Da0URERRFEQB90EppmULdvjmef0GhQ7fmXB6+kebqlWXcVSozCeHyxWV+WgG0/81dHPzgZV7cpRVk+JOPLjAam1qdhAClZRmPZ6fh/t/rR7S7Ss1Jz+tvmahvTMP8Pt6rfa0gw4mpRVo/vchobApN0zIAnE4nsViMsXiaikqVukYTFZVKQQ+6q1SKzTFgcwD37iVoqv+eP/8YR9M0BgYGUAH8fv9KoWXCeei4hfqgueA8LiT/4eHs9Q31i8kkv96+jn6tn4nEw+zuwev1KipAU1MTAHpPkuGb6ScqptmF+Dqjf43d5cerv/NN/wV+u3WDxWQK9z4bAENDQ6vb0O/3K6FQSE6fPk3r4UXae4qoqFQ3NTo9b2IsYeWlimnuTo5y+fbPqMoUVss4dmuK2EQp4wnrY98wrJw6dUrxeDyMxYVDdQv06SkAzn6RZHY6P2cos6Zw7pgBIJ1eZHf5Nap2RnHtmGN76RJWy/qWnYgusjbtyiOEZE9TU9Nwd3c3ADY7zCSgodlMQ7M5x/P4ZAmVz8wRnyxh786EoZtfyviUXFYZvPMsqeVtqx0wkeSrw7EsDXADd5R8jKi3t1eOHDlClqDY7HCipxj33vxpmZlT+HfOSnyyBLMqvOJ6wC+3yllIrnb54twy37XGGY8uARCJRFaL8FEJBAJKNBpVIpEIoVCImQQcbVxA70nm3BuLpznauMD7b8zz7dcwNQVe1wMi0e05xgGKSrbR8PkuXn1Xyzq5yog2O9lFtXZDProtAenoLZb6oEkAsZeb5J2Pn5Pmrt2y/+B2KSpVc+729/eLiKAW0mLZNn2ctLRZGL6R5lx3aiXfKX74cpyeo6No5SY+POM07obDYfx+v1JwBLI8oaZuW94IuKsU6btZIjZ7xrtQKCT9/f3i8/nWER2fzyd5+cBm4XdXKXL2YrG4q5S8KWhpsxg0zuFwSCQSERFhLRCfz2f8XhCALFWz2ZEOvdigaPkA2OyZGsje8Xq9BdG4DRWRSMR4vPWMRQ4dN+eEMl8RVlQqog9ajSitcMknA5Blyg3N5hxD4XB4HQCfz2fwSU+1Kvqg1aiHzSjchl2QHUKeapXW5sz4PHnypDFCZ6aFmTUjemhoyK1pGlevpOn4bImauswc2JQpbRaB7AkGg4Ynmqbl6LJerk1b9ui6Lk9cA7W1taJpWtb4nrU6n88nTqdTwuFwjgFd18Xj8eTVbciKn6aoPGX5D2F3mdViPbrMAAAAAElFTkSuQmCC"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAFJklEQVRIS62We2xTVRzHv+e2ty0bfa223VMjMEjWTXyuBmOIsCiYIGCMRpYoiSYIGjSOmGE0gCSogcnDR0biwIQoCmqmLg4msP2xBLYYQmCj4GOKjLmue/Tlut3b3mPOvbT3di2tiTt/9fZ3ft/+fp/z7e9cgv+wpt4nFD7A9Bkl+bbn3SDshqriA/hDyJmTX7B7JSVn25XCZkOQ6YjdKyla2sEfzl0d25u1Qi0zzyflFJJKrv+VQZKLaYaguBs0le4DFteUQppWFS9wfujIzS1ZEKQEaa+5k9RGHhG7V1CcPZFiVrOoBPuqpuTn1/qNuPDQ3dCdU+PskJK5GS2roiqzo2230R19elnw7YUC6p8cJ2L34xQtP8pMtWJZGXZ13kFPBubKAkvMUTQOJABJpfBBtQFdgQI5XmcLYfmjg2nYMhhuPeaha0qikKZFtEcd+PqPsTSGa+c58ExFFJFoHB3RIuxceym7IO2x9BFvuJoJPuscg5MXcWCoGK3XxnG4JiZXtP6CCUxwc+kwAiKPowEH3n26nyRzszC0fH8maFl1KmiFw12IZYnr6IuK2HVZYbi1UkCN3Yjjo0WwOubgvrgfdfbQD6Q2/ETSGWnl0nPmhq5J+56OUbMcX2oN45fYNJqv8fLzhnIB1UWFOBUoTDFcZgltIQ9GmjIEaY/lC+INr2MtP1UcAp+I45uwC8cHRrFrnmKbRp9Bbnl9RRDBSYq2sENmmMxNa5n2WPzEG3YzwRfcAbh5EbsGS9F6fQKt90zKgqt7FYZvlg/BL/Jo8TuTDOXcTIY9ls9PBy3rToessDsLsFS6AV9UwHs+heEbCwR47Ca0jtlhsZvwgOTHcluYdVafnWGPZVtX1La9Y0xhyHx2ZVLAx38qgi9XCPAUFSLp0+XWEBPcTrzhHdkYniLecJ1sG/cECiHiSKgEx34fxUcLFdtsumSUW95YMYbxGPBt2Il31sgM5dyZDIeJN1zMBF90j8AlMyzDsZ9HcGKFiFW9JllUYXgDIyKPT/2uJEM5NwtDc/OZkHUD86G1yISH8TcuRwQ0XVVaZqvlfg5t43bMtRpRiwDqbMGDxBt5KTvDXuuezoi14aebDB+zhXA1No39A4oPN98u4AYpQTyujDPGeJkt0kRqQ1syGfZaL5La0F2s5eddo7Dp4zg4UY6vfgvgiEexTf15xTY6HYd6xwi+DLmxY/VFQm/mZrTMvmCCz7lGYdfHsX+oGMfPj0Bv06VaZoKvlg7LMbbYfzkVzHYFnO4op4yh2WbEEoxgU7+UNm2a79XjZNCKArMBkxEhtyDtMTdX91o2SII6/xoqRTT9qjB8/U4Be/8ygiY0t0TD0C3Hl3z0VftKqTSl3iGckcN3ixWGzDqE50BFNX6lcTh3y/MbnZTXMItHJOjNXApTYlKCrkB9ziuYrULtrZe3Qs+HZTQtwcCBCmpLMwWInoDGVYaEI6CaO4dU7S+jUiyRaokzcZjJMFeFGT8wv9FFeZvKJIPZPxJ0hWpcilFwc9RzYI7gDOrz7FfoOVCWZhNi5EA1rx7EQEA1viQ8ARVVhtARQOPL2a9wwVsuqp+r9RmFrkBlkohR6LTMpik4oxpn1bKqU9Nm1k+5ijHU2saogzStsZGBg5TLlzqS9t+efYaV29w0jdEUBWe6tc+oCBBl+MiLxgGi3hCY/Qq105Z9rm6uoJqXYuUtXGO7mfv7Nl7PPb6q9mbOw5zTZmueebhoZzHVMpnJiCYAol4xuJJP8P9W+C+xZd+qpRkU/AAAAABJRU5ErkJggg=="},function(e,t){e.exports="data:image/png;base64,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"},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n(330)},,,,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/switch26.69545541.wav"},function(e,t,n){e.exports=n.p+"static/media/rollover6.a81b9fe6.wav"},function(e,t,n){},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){var r={"./GeneAdhesion.tsx":325,"./GeneAiryExpansion.tsx":106,"./GeneAttractsSugar.tsx":87,"./GeneAttractsWater.tsx":107,"./GeneBark.tsx":108,"./GeneCannotFreeze.tsx":88,"./GeneCostly.tsx":109,"./GeneDiffuseSugar.tsx":110,"./GeneDiffuseWater.tsx":89,"./GeneFastMetabolism.tsx":326,"./GeneFluidMembrane.tsx":327,"./GeneHydrostasis.tsx":111,"./GeneInventory.tsx":112,"./GeneLiving.tsx":113,"./GeneNetworkEffect.tsx":114,"./GeneNutrientExtraction.tsx":115,"./GeneObstacle.tsx":65,"./GeneOsmosis.tsx":116,"./GenePhotosynthesis.tsx":90,"./GenePipes.tsx":91,"./GeneProliferation.tsx":328,"./GenePushWater.tsx":117,"./GeneReproducer.tsx":52,"./GeneScaffolding.tsx":118,"./GeneSlowMetabolism.tsx":329,"./GeneSoilAbsorption.tsx":119,"./GeneTransport.tsx":75,"./GeneVascular.tsx":120};function a(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=i,e.exports=a,a.id=324},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneAdhesion",(function(){return u}));var r=n(9),a=n(20),i=n(1),o=n.n(i),s=n(32),l=n(13),c=n(34),u=l.b.make({name:"Adhesion",levelCosts:[1],levelProps:{},static:{energyUpkeep:1/1200},dynamic:function(e,t){var n=e.world.tileNeighbors(e.pos),i=0,o=!0,s=!1,l=void 0;try{for(var c,u=n[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){Object(r.a)(c.value,2)[1]instanceof a.b||i++}}catch(h){s=!0,l=h}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}return i>=3&&(t.diffusionWater+=.1),t},description:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"While this cell has 3 or more non-Cell neighbors, take ",o.a.createElement(c.a,{w:!0})," from other Cells."),o.a.createElement("p",null,"On average, get 1",o.a.createElement(c.a,{w:!0})," every ",o.a.createElement(s.a,{value:10,sigFigs:3})," seconds."))}},{},(function(){}))},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneFastMetabolism",(function(){return o}));var r=n(24),a=n(1),i=n.n(a),o=n(13).b.make({name:"Fast Metabolism",levelCosts:[1,1,1,1,3],levelProps:{energyUpkeep:1/1500},static:{tempo:[1.1,1.21,1.331,1.4641,1.771561]},description:function(e,t){var n=t.tempo;return i.a.createElement(i.a.Fragment,null,"Cell operates ",i.a.createElement("b",null,Object(r.a)(100*(n-1),3),"%")," faster. ",i.a.createElement("i",null,"(Energy upkeep is also increased)"),".")}})},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneFluidMembrane",(function(){return i}));var r=n(1),a=n.n(r),i=n(13).b.make({name:"Fluid Membrane",levelCosts:[1,1,1,1,3],levelProps:{energyUpkeep:1/1200},static:{moveSpeed:[1.2,1.3,1.4,1.5,2]},description:function(e,t){var n=t.moveSpeed;return a.a.createElement(a.a.Fragment,null,"Move ",a.a.createElement("b",null,100*(n-1),"%")," faster over this Cell.")}})},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneProliferation",(function(){return s}));var r=n(20),a=n(1),i=n.n(a),o=n(13),s=o.b.make({name:"Proliferation",levelCosts:[1],levelProps:{},description:function(){return i.a.createElement(i.a.Fragment,null,"Grow at ",i.a.createElement("b",null,200,"%")," speed if there's ",i.a.createElement("b",null,4)," or more neighboring Cells.")},dynamic:function(e,t){return Array.from(e.world.tileNeighbors(e.pos).values()).filter((function(e){return e instanceof r.b})).length>=4&&(t.timeToBuild/=2),t}})},function(e,t,n){"use strict";n.r(t),n.d(t,"GeneSlowMetabolism",(function(){return o}));var r=n(24),a=n(1),i=n.n(a),o=n(13).b.make({name:"Slow Metabolism",levelCosts:[1,1,1,1,3],levelProps:{energyUpkeep:1/1500},static:{tempo:[.909,.826,.751,.683,.5644]},description:function(e,t){var n=t.tempo;return i.a.createElement(i.a.Fragment,null,"Cell operates ",i.a.createElement("b",null,Object(r.a)(100*(1-n),3),"%")," slower. ",i.a.createElement("i",null,"(Energy upkeep is also decreased)"),".")}})},function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(31),o=n.n(i),s=n(101),l=n(73),c=n(11),u=n(2),h=n(44),d=n(29),f=n(18),v=n(87),m=n(88),p=n(65),y=n(90),g=n(52),b=n(75),w=new d.a("Tissue",0,new h.a(f.d.level(2),f.c.level(3)),{texturePosition:new u.Vector2(1,1),color:new u.Color(3190309)},{type:"take",resources:"water and sugar"}),E=new d.a("Leaf",0,new h.a(f.d.level(2),f.c.level(3),p.GeneObstacle.level(0),y.GenePhotosynthesis.level(1),f.a.level(3)),{color:new u.Color("white"),texturePosition:new u.Vector2(2,1)},{type:"give",resources:"water take sugar"}),k=new d.a("Root",0,new h.a(f.d.level(2),f.c.level(4),p.GeneObstacle.level(0),f.k.level(2)),{color:new u.Color("white"),texturePosition:new u.Vector2(3,1)},{type:"take",resources:"water and sugar"}),O=new d.a("Transport",0,new h.a(f.d.level(3),f.c.level(3),b.GeneTransport.level(2)),{texturePosition:new u.Vector2(1,1),color:new u.Color(3190309)},{type:"take",resources:"water and sugar"}),A=new d.a("Fruit",0,new h.a(f.d.level(2),f.c.level(0),p.GeneObstacle.level(0),m.GeneCannotFreeze.level(0),g.GeneFruit.level(0),v.GeneAttractsSugar.level(1),f.a.level(1)),{texturePosition:new u.Vector2(0,2)},{type:"give",resources:"water and sugar"}),j=new d.b([w,E,k,O,A]),x=n(64),C=n(4),S=n(3);function P(e){return new Promise((function(t){setTimeout(t,e)}))}var M=n(66),T=n(40),N=n(14),R=n(43),F=function(){function e(t,n){Object(C.a)(this,e),this.posFloat=t,this.world=n,this.inventory=new R.a(N.f,this,N.h,N.g),this.action=void 0,this.events=new M.EventEmitter,this.baseSpeed=void 0,this.dtSinceLastStepped=0,this.baseSpeed=N.d}return Object(S.a)(e,[{key:"speed",get:function(){var e=this.currentTile();return this.baseSpeed*(e instanceof c.b?e.moveSpeed:1)}},{key:"pos",get:function(){return this.posFloat.clone().round()}}]),Object(S.a)(e,[{key:"shouldStep",value:function(){return!0}},{key:"setAction",value:function(e){if(null!=this.action){if("long"===this.action.type)return;this.action={type:"multiple",actions:[this.action,e]}}else"build"===e.type&&e.cellType.chromosome.computeStaticProperties().isReproductive?this.action={type:"long",duration:4.5,effect:e,elapsed:0}:this.action=e}},{key:"getAction",value:function(){return this.action}},{key:"droopY",value:function(){var e=this.world.tileAt(this.pos.x,this.pos.y);return e instanceof c.b?e.droopY:0}},{key:"droopPosFloat",value:function(){var e=this.droopY();if(0!==e){var t=this.posFloat.clone();return t.y+=e,t}return this.posFloat}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"findNearestDirectlyWalkableCell",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.world.bfsIterator(this.pos,this.world.width*this.world.height)[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;if(this.isWalkable(i))return i}}catch(o){t=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"step",value:function(e){if(!this.isWalkable(this.currentTile())){var t=this.findNearestDirectlyWalkableCell();t&&this.posFloat.lerp(t.pos,.13)}null!=this.action&&(this.attemptAction(this.action,e),"long"!==this.action.type&&(this.action=void 0))}},{key:"attemptAction",value:function(e,t){var n=this._attemptAction(e,t);return T.a.showGodUI&&console.log(e),!0===n?this.events.emit("action",e):this.events.emit("action-fail",e,!1===n?void 0:n),n}},{key:"_attemptAction",value:function(e,t){switch(e.type){case"move":return this.attemptMove(e,t);case"build":return this.attemptBuild(e,t);case"deconstruct":return this.attemptDeconstruct(e,t);case"drop":return this.attemptDrop(e,t);case"pickup":return this.attemptPickup(e,t);case"multiple":return this.attemptMultiple(e,t);case"long":return this.attemptLong(e,t);case"thaw":return this.attemptThaw(e,t);case"remove-cancer":return this.attemptRemoveCancer(e,t)}}},{key:"isWalkable",value:function(e){return null!=e&&(!e.isObstacle&&(e instanceof c.b&&null==e.findEffectOfType(c.e)))}},{key:"canBuildAt",value:function(e){if(null==e)return!1;if(e instanceof c.b)return!1;if(e.isObstacle)return!1;var t=this.world.tileNeighbors(e.pos),n=!0,r=!1,a=void 0;try{for(var i,o=t.values()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){if(i.value instanceof c.b)return!0}}catch(s){r=!0,a=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return!1}},{key:"isTakingLongAction",value:function(){return null!=this.action&&"long"===this.action.type}},{key:"attemptMove",value:function(e,t){var n=this.posFloat.clone().add(e.dir.clone().setLength(this.speed*t));return this.posFloat.copy(n),!0}},{key:"attemptStill",value:function(e){return!0}},{key:"canBuild",value:function(e){var t=this.world.tileAt(e.position);if(!this.canBuildAt(t))return"Can't build over ".concat(t.displayName,"!");var n=this.world.cellAt(e.position.x,e.position.y);if(null!=n)return"Deconstruct ".concat(n.displayName," first!");var r=e.cellType.chromosome.computeStaticProperties(),a=r.costSugar,i=r.costWater,o=this.inventory.water<i,s=this.inventory.sugar<a;return o&&s?"Need water and sugar!":o&&!s?"Need water!":!(s&&!o)||"Need sugar!"}},{key:"attemptBuild",value:function(e,t){var n=this.canBuild(e);if(!0!==n)return n;var r=e.cellType.chromosome.computeStaticProperties(),a=r.costSugar,i=r.costWater;this.inventory.add(-i,-a);var o,s=new c.b(e.position,this.world,e.cellType,e.args);return(o=e.cellType.chromosome.computeStaticProperties().timeToBuild>0?new c.f(e.position,this.world,s,this.currentTile().pos):s).droopY=this.droopY(),this.world.setTileAt(e.position,o),!0}},{key:"attemptDeconstruct",value:function(e,t){if(!e.position.equals(this.pos)||e.force){var n=this.world.maybeRemoveCellAt(e.position);if(null!=n){if(n instanceof c.f){var r=n.completedCell.type.chromosome.computeStaticProperties(),a=r.costSugar,i=r.costWater;this.inventory.add(i,a)}return n.inventory.give(this.inventory,n.inventory.water,n.inventory.sugar),!0}}return!1}},{key:"attemptDrop",value:function(e,t){var n=e.target,r=e.water,a=e.sugar;e.continuous&&(r*=N.e*t,a*=N.e*t);var i=this.inventory.give(n.inventory,r,a),o=i.water,s=i.sugar;return o>0||s>0}},{key:"attemptPickup",value:function(e,t){var n=e.target.inventory,r=e.water,a=e.sugar;e.continuous&&(r*=N.e*t,a*=N.e*t);var i=n.give(this.inventory,r,a),o=i.water,s=i.sugar;return o>0||s>0}},{key:"attemptMultiple",value:function(e,t){var n=!0,r=!0,a=!1,i=void 0;try{for(var o,s=e.actions[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;n=!0===this.attemptAction(l,t)&&n}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}},{key:"attemptLong",value:function(e,t){if(0===e.elapsed){if("build"===e.effect.type){var n=this.canBuild(e.effect);if(!0!==n)return this.action=void 0,n}this.events.emit("start-long-action",e)}return e.elapsed+=t,e.elapsed>e.duration&&(this.action=void 0,this.attemptAction(e.effect,t))}},{key:"attemptThaw",value:function(e,t){return e.target.thaw(t),!0}},{key:"attemptRemoveCancer",value:function(e,t){return e.target.removeCancer(t),!0}}]),e}(),D=function(){function e(t,n,r){Object(C.a)(this,e),this.posFloat=t,this.world=n,this.player=r,this.inventory=new R.a(0,this),this.dtSinceLastStepped=0,this.poppedOut=!1}return Object(S.a)(e,[{key:"shouldStep",value:function(){return!0}},{key:"step",value:function(e){var t=this.pos;if(this.world.tileAt(t.x,t.y+1)instanceof c.a){var n=Math.min(20*e,1);this.posFloat.y+=n}this.player.posFloat.copy(this.posFloat),this.poppedOut&&this.world.removePlayerSeed()}},{key:"popOut",value:function(){var e=this,t=this.pos,n=new c.b(t,this.world,this.world.genome.cellTypes[0]),r=new c.f(t,this.world,n,t);r.silent=!0,this.world.setTileAt(t,r),Array.from(this.world.bfsIterator(t,30,(function(e){return!e.isObstacle&&e.pos.distanceTo(t)<2.5}),(function(e){return e.pos.distanceTo(t)}))).forEach((function(t,n){P(300).then((function(){var n=new c.b(t.pos,e.world,e.world.genome.cellTypes[0]);e.world.setTileAt(t.pos,n)}))})),this.poppedOut=!0}},{key:"pos",get:function(){return this.posFloat.clone().round()}}]),e}();function B(e){var t=Math.floor(e/N.n),n=e%N.n;return{year:t,season:Math.floor(n/N.m),percent:n%N.m/N.m,month:Math.floor(n%N.m/N.l)+1,day:Math.floor(n%N.l/N.k)+1}}var I=["Spring","Summer","Fall","Winter"];function z(e){return"".concat(e.year>0?"Year ".concat(e.year,", "):"").concat(I[e.season],", Month ").concat(e.month)}var G=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];Object(C.a)(this,e),this.dt=t,this.frame=n,this.deleted=r,this.added=a,this.events={"cell-eat":[],"cell-transfer-energy":[],evaporation:[],photosynthesis:[],thaw:[],"collect-sunlight":[],"grow-fruit":[],oof:[]}}return Object(S.a)(e,[{key:"logEvent",value:function(e){this.events[e.type].push(e)}}]),e}(),L=n(16),W=n(26),V=n.n(W),U=n(9),H=n(36),Q=n(22),Y=n(342),K=n(72),X=n(20),Z=function(){function e(t,n){Object(C.a)(this,e),this.posFloat=t,this.world=n,this.events=new M.EventEmitter,this.inventory=new R.a(10,this),this.action=void 0,this.dtSinceLastStepped=0,this.speed=3.2}return Object(S.a)(e,[{key:"pos",get:function(){return this.posFloat.clone().round()}}]),Object(S.a)(e,[{key:"shouldStep",value:function(){return!0}},{key:"setAction",value:function(e){if(null!=this.action){if("long"===this.action.type)return;this.action={type:"multiple",actions:[this.action,e]}}else"build"===e.type&&e.cellType.chromosome.computeStaticProperties().isReproductive?this.action={type:"long",duration:4.5,effect:e,elapsed:0}:this.action=e}},{key:"getAction",value:function(){return this.action}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"findNearestWalkableCell",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.world.bfsIterator(this.pos,this.world.width*this.world.height)[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;if(this.isWalkable(i))return i}}catch(o){t=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"step",value:function(e){null==this.action&&this.findNextAction(),null!=this.action&&(this.attemptAction(this.action,e),"long"!==this.action.type&&(this.action=void 0))}},{key:"findNextAction",value:function(){var e=this,t=Array.from(this.world.tileNeighbors(this.pos).values()).filter((function(t){return t.pos.manhattanDistanceTo(e.pos)<2&&(t instanceof c.a||t instanceof X.b)}));if(this.inventory.sugar<1){var n=Object(K.minBy)(t,(function(e){return e.closestCellDistance}));n instanceof c.a?this.setAction({type:"move",dir:n.pos.clone().sub(this.posFloat).normalize()}):n instanceof X.b&&this.setAction({type:"deconstruct",position:n.pos,force:!0})}else{var r=Object(K.maxBy)(t,(function(e){return e.closestCellDistance}));this.world.isAtEdge(this.pos)&&this.world.removeInsect(this),null!=r&&this.setAction({type:"move",dir:r.pos.clone().sub(this.posFloat).normalize()})}}},{key:"attemptAction",value:function(e,t){var n=this._attemptAction(e,t);return T.a.showGodUI&&console.log(e),!0===n?this.events.emit("action",e):this.events.emit("action-fail",e,!1===n?void 0:n),n}},{key:"_attemptAction",value:function(e,t){switch(e.type){case"move":return this.attemptMove(e,t);case"build":return this.attemptBuild(e,t);case"deconstruct":return this.attemptDeconstruct(e,t);case"drop":return this.attemptDrop(e,t);case"pickup":return this.attemptPickup(e,t);case"multiple":return this.attemptMultiple(e,t);case"long":return this.attemptLong(e,t);case"thaw":return this.attemptThaw(e,t);case"remove-cancer":return this.attemptRemoveCancer(e,t)}}},{key:"isWalkable",value:function(e){var t=e instanceof u.Vector2?this.world.tileAt(Math.round(e.x),Math.round(e.y)):e;return t instanceof c.a&&!t.isObstacle}},{key:"canBuildAt",value:function(e){return null!=e&&(!(e instanceof X.b)&&!e.isObstacle)}},{key:"isTakingLongAction",value:function(){return null!=this.action&&"long"===this.action.type}},{key:"attemptMove",value:function(e,t){var n=this.posFloat.clone().add(e.dir.clone().setLength(this.speed*t));return!!this.isWalkable(n)&&(this.posFloat.copy(n),!0)}},{key:"attemptStill",value:function(e){return!0}},{key:"canBuild",value:function(e){var t=this.world.tileAt(e.position);if(!this.canBuildAt(t))return"Can't build over ".concat(t.displayName,"!");var n=this.world.cellAt(e.position.x,e.position.y);if(null!=n)return"Deconstruct ".concat(n.displayName," first!");var r=e.cellType.chromosome.computeStaticProperties(),a=r.costSugar,i=r.costWater,o=this.inventory.water<i,s=this.inventory.sugar<a;return o&&s?"Need water and sugar!":o&&!s?"Need water!":!(s&&!o)||"Need sugar!"}},{key:"attemptBuild",value:function(e,t){var n=this.canBuild(e);if(!0!==n)return n;var r=e.cellType.chromosome.computeStaticProperties(),a=r.costSugar,i=r.costWater;this.inventory.add(-i,-a);var o,s=new X.b(e.position,this.world,e.cellType,e.args);return o=e.cellType.chromosome.computeStaticProperties().timeToBuild>0?new X.d(e.position,this.world,s,this.currentTile().pos):s,this.world.setTileAt(e.position,o),!0}},{key:"attemptDeconstruct",value:function(e,t){var n=this.world.cellAt(e.position);if(null!=n){n.inventory.give(this.inventory,n.inventory.water,n.inventory.sugar);var r=n.type.chromosome.computeStaticProperties(),a=r.costSugar,i=r.costWater;return this.inventory.add(i,a),this.world.maybeRemoveCellAt(n.pos),!0}return!1}},{key:"attemptDrop",value:function(e,t){var n=e.target,r=e.water,a=e.sugar;e.continuous&&(r*=N.e*t,a*=N.e*t);var i=this.inventory.give(n.inventory,r,a),o=i.water,s=i.sugar;return o>0||s>0}},{key:"attemptPickup",value:function(e,t){var n=e.target.inventory,r=e.water,a=e.sugar;e.continuous&&(r*=N.e*t,a*=N.e*t);var i=n.give(this.inventory,r,a),o=i.water,s=i.sugar;return o>0||s>0}},{key:"attemptMultiple",value:function(e,t){var n=!0,r=!0,a=!1,i=void 0;try{for(var o,s=e.actions[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;n=!0===this.attemptAction(l,t)&&n}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}},{key:"attemptLong",value:function(e,t){if(0===e.elapsed){if("build"===e.effect.type){var n=this.canBuild(e.effect);if(!0!==n)return this.action=void 0,n}this.events.emit("start-long-action",e)}return e.elapsed+=t,e.elapsed>e.duration&&(this.action=void 0,this.attemptAction(e.effect,t))}},{key:"attemptThaw",value:function(e,t){return e.target.thaw(t),!0}},{key:"attemptRemoveCancer",value:function(e,t){return e.target.removeCancer(t),!0}}]),e}(),J=n(5);function q(e,t){return new Array(e).fill(void 0).map((function(e,n){return"function"===typeof t?t(n):void 0===t?n:t}))}function _(e,t,n){return q(e,(function(e){return q(t,(function(t){return n(e,t)}))}))}var $=n(46),ee=function(e,t){var n=t.generatorContext,r=n.noiseSoil,a=(n.noiseWater,e.x),i=e.y,o=r.octaveSimplex2(a/10,i/10),s=new(o<-.37?$.b:o<.37?$.c:o<1.2?$.a:c.g)(e,t),l=Object(J.a)(30*o,1,20);return s.inventory.add(l,0),s},te={Level0:function(e,t){var n=t.generatorContext,r=n.noiseHeight,a=n.noiseWater,i=n.noiseRock,o=e.x,s=e.y,l=t.height/2-4*(r.perlin2(0,o/5)+1)/2-16*r.perlin2(10,o/20+10);if(s>l){var u=Object(J.d)(s-t.height/2,0,t.height/2,-.8,.3);if(i.simplex2(o/5,s/5)<u)return new c.g(e,t);var h=Math.pow(Object(J.d)(s-t.height/2,0,t.height/2,.5,1),2),d=a.simplex2(.2*o,.2*s)+.15;if(d>.93&&s-l>5&&s-l<13)return new c.d(e,t,3,75+Object(J.g)(-10,10));if(h*d>1&&s-l>8){var f=Math.min(h*d,1);return new c.d(e,t,Math.round(3/f),Object(J.d)(s,t.height/2,t.height,100,300)+Object(J.g)(-10,10))}var v=new $.c(e,t),m=Math.round(Object(J.a)(10*(d>.4?h:0)*3,1,10));return v.inventory.set(m,0),v}},Temperate:function(e,t){var n=t.generatorContext,r=n.noiseHeight,a=n.noiseWater,i=n.noiseRock,o=e.x,s=e.y,l=t.height/2-4*(r.perlin2(0,o/5)+1)/2-16*r.perlin2(10,o/20+10);if(s>l){var u=Object(J.d)(s-t.height/2,0,t.height/2,-.7,.3);if(i.simplex2(o/5,s/5)<u)return new c.g(e,t);var h=Math.pow(Object(J.d)(s-t.height/2,0,t.height/2,.5,1),2),d=a.simplex2(.2*o,.2*s)+.13;if(d>.93&&s-l>5&&s-l<13)return new c.d(e,t,3,Object(J.d)(s,t.height/2,t.height,100,300));if(h*d>1&&s-l>8){var f=Math.min(h*d,1);return new c.d(e,t,Math.round(3/f),Object(J.d)(s,t.height/2,t.height,100,300))}return ee(e,t)}},Desert:function(e,t){var n=t.generatorContext,r=n.noiseHeight,a=n.noiseRock,i=e.x,o=e.y,s=t.height/2-2*(r.perlin2(0,i/20)+1)/2-3*r.perlin2(10,i/100+10),l=Object(J.d)(o,t.height/2,t.height,-.8,-.4),u=a.simplex2(i/4,o/4)<l;if(o>s){if(u)return new c.g(e,t);var h=ee(e,t),d=Math.floor(Math.max(0,Object(J.d)(o,.75*t.height,t.height,1,9)));return h.inventory.set(d,0),h}},Rocky:function(e,t){var n=t.generatorContext,r=n.noiseHeight,a=n.noiseRock,i=e.x,o=e.y,s=.55*t.height-4*(r.perlin2(0,i/5)+1)/2-16*r.perlin2(10,i/20+10)-Object(J.d)(i,0,t.width,10,-10),l=o-6*(r.perlin2(0,i/25)+1)/2-20*r.perlin2(10,i/150+10)<.5*t.height?-1:-.15;if(a.simplex2(i/10,o/10)<l)return new c.g(e,t);if(o>s){var u=new $.c(e,t);return u.inventory.add(2,0),u}},Reservoires:function(e,t){var n=t.generatorContext.noiseHeight,r=e.x,a=e.y,i=t.height/2-4*(n.perlin2(0,r/5)+1)/2-16*n.perlin2(10,r/20+10),o=Math.pow(Math.sin(r/4+a/30),2)+Math.pow(Math.cos(a/4),2)>1.2,s=Math.pow(Math.sin(r/4+(a+2)/30),2)+Math.pow(Math.cos((a+2)/4),2)>1.2;return o&&!s&&a+1>i?new c.g(e,t):a>i?ee(e,t):void 0},SkySoil:function(e,t){var n=t.generatorContext.noiseHeight,r=e.x,a=e.y,i=Math.pow(Math.sin(r/2.5+a/12),2)+Math.pow(Math.cos(a/2.5),2)+n.perlin2(r/4,a/26);if(i>1.2&&a>80-20*i){var o=new $.c(e,t);return o.inventory.add(Math.floor(5*(i-1.1)),0),o}if(a>t.height/2*1.2-4*(n.perlin2(0,r/5)+1)/2-16*n.perlin2(10,r/20+10))return ee(e,t)}},ne=n(71),re=n(63),ae=n(30),ie=n(78);function oe(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;e|=e<<7+Math.pow(s.charCodeAt(0),2)}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return e}function se(e){return{seed:e,noiseHeight:new ie.a(oe(e,"height")),noiseRock:new ie.a(oe(e,"rock")),noiseWater:new ie.a(oe(e,"water")),noiseSoil:new ie.a(oe(e,"soil"))}}var le=function(){function e(t){Object(C.a)(this,e),this.world=t}return Object(S.a)(e,[{key:"getCurrentTemperature",value:function(){var e=this.world.season.season;return this.world.environment.temperaturePerSeason[e]}},{key:"step",value:function(e){this.updateTemperatures(),this.computeSunlight(),this.stepWeather(e)}},{key:"stepWeather",value:function(e){var t=this.world;if((t.time+t.environment.climate.timeBetweenRainfall-6)%t.environment.climate.timeBetweenRainfall<t.environment.climate.rainDuration)for(var n=t.environment.climate.waterPerSecond*e;n>0;){var r=Math.min(n,1),a=Object(J.g)(0,t.width-1),i=t.tileAt(a,0);if(i instanceof c.a){var o=Object(J.h)(r);i.inventory.add(o,0),t.numRainWater+=o}n-=1}}},{key:"computeSunlight",value:function(){for(var e=this.sunAngle,t=Math.sin(e-Math.PI/2),n=this.sunAmount,r=0;r<=this.world.height;r++)for(var a=0;a<this.world.width;a++){var i=this.world.environmentTileAt(a,r);if(i instanceof c.a){var o=0;if(0===r)o=1;else{var s=this.world.tileAt(a,r-1),l=this.world.tileAt(a+1,r-1),u=this.world.tileAt(a-1,r-1),h=s instanceof c.a?s.sunlightCached/n:null==s?1:0,d=l instanceof c.a?l.sunlightCached/n:null==l?1:0,f=u instanceof c.a?u.sunlightCached/n:null==u?1:0;o=(o=t>0?d*t+h*(1-t):f*-t+h*(1- -t))*(1-N.i)+(h+d+f)/3*N.i}o=N.j+o*(1-N.j),o*=n,i.sunlightCached=o}}}},{key:"updateTemperatures",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.world.allCells()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;i.temperatureFloat=i.nextTemperature}}catch(o){t=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"sunAngle",get:function(){var e=this.world.time/N.k%1;return e<N.c?e/N.c*Math.PI:Math.PI*(1+(e-N.c)/(1-N.c))}},{key:"sunAmount",get:function(){return Math.atan(12*Math.sin(this.sunAngle))/(Math.PI/2)*.5+.5}}]),e}(),ce={width:50,height:100},ue=function(){function e(t,n,r){var a=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(C.a)(this,e),this.environment=t,this.time=0,this.frame=0,this.width=void 0,this.height=void 0,this.player=void 0,this.insects=[],this.playerSeed=void 0,this.events=new M.EventEmitter,this.gridEnvironment=void 0,this.gridCells=void 0,this.neighborCache=void 0,this.mpEarners=new Map,this.species=void 0,this.generatorContext=void 0,this.weather=void 0,this.genome=void 0,this.cachedEntities=void 0,this.stepStats=new G(0,this.frame),this.numRainWater=0,this.numEvaporatedAir=0,this.numEvaporatedSoil=0,this.numRechargedWater=0;var o=Object(Q.a)({},ce,{},i);this.width=o.width,this.height=o.height,this.generatorContext=se(n),this.species=r,this.genome=r.genome,this.weather=new le(this);var s="string"===typeof t.fill?te[t.fill]:t.fill;this.gridEnvironment=_(this.width,this.height,(function(e,t){var n=new u.Vector2(e,t);return s(n,a)||new c.a(n,a)})),this.gridCells=_(this.width,this.height,(function(){return null})),this.neighborCache=_(this.width,this.height,(function(e,t){return a.computeTileNeighbors(e,t)})),this.fillCachedEntities(),this.computeSoilDepths();var l=new u.Vector2(Math.floor(this.width/2),Math.floor(this.height/2)),h=this.gridEnvironment[l.x].find((function(e){return!(e instanceof c.a)}));null!=h&&(l.y=h.isObstacle?h.pos.y-1:h.pos.y),this.player=new F(l,this),this.playerSeed=new D(l,this,this.player),this.fillCachedEntities(),_(this.width,this.height,(function(e,t){var n=a.gridEnvironment[e][t];n&&n.step(0);var r=a.gridCells[e][t];r&&r.step(0)})),this.weather.step(0)}return Object(S.a)(e,[{key:"isAtEdge",value:function(e){return 0===e.x||e.x===this.width-1||0===e.y||e.y===this.height-1}},{key:"season",get:function(){return B(this.time)}}]),Object(S.a)(e,[{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"off",value:function(e,t){this.events.off(e,t)}},{key:"removePlayerSeed",value:function(){this.stepStats.deleted.push(this.playerSeed),delete this.playerSeed}},{key:"tileAt",value:function(e,t){var n;if(e instanceof u.Vector2?(n=e.x,t=e.y):(n=e,t=t),!this.isValidPosition(n,t))return null;var r=this.gridCells[n][t];return null!=r?r:this.gridEnvironment[n][t]}},{key:"cellAt",value:function(e,t){return e instanceof u.Vector2&&(t=e.y,e=e.x),this.isValidPosition(e,t)?this.gridCells[e][t]:null}},{key:"environmentTileAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridEnvironment[e][t]:null}},{key:"setTileAt",value:function(e,t){var n=e.x,r=e.y;if(!this.isValidPosition(n,r))throw new Error("invalid position ".concat(n,", ").concat(r," "));t instanceof c.b&&t.isReproductive&&this.mpEarners.set(t,0);var a=this.tileAt(n,r);a.redistributeInventoryToNeighbors(),0===a.inventory.water&&0===a.inventory.sugar||(console.warn("lost",a.inventory,"resources to building"),a.inventory.add(-a.inventory.water,-a.inventory.sugar));var i=this.gridCells[n][r];if(null!=i&&this.stepStats.deleted.push(i),t instanceof c.b)this.gridCells[n][r]=t;else{this.gridCells[n][r]=null;var o=this.gridEnvironment[n][r];null!=o&&this.stepStats.deleted.push(o),this.gridEnvironment[n][r]=t}this.stepStats.added.push(t),this.handleTileUpdated(e)}},{key:"maybeRemoveCellAt",value:function(e){var t=this.cellAt(e.x,e.y);return t&&(t.redistributeInventoryToNeighbors(),this.gridCells[e.x][e.y]=null,this.stepStats.deleted.push(t),t.isDead=!0),this.handleTileUpdated(e),t}},{key:"removeInsect",value:function(e){return this.insects.splice(this.insects.indexOf(e),1),this.stepStats.deleted.push(e),!0}},{key:"isValidPosition",value:function(e,t){return!(e>=this.width||e<0||t>=this.height||t<0)}},{key:"tileNeighbors",value:function(e){return this.neighborCache[e.x][e.y]}},{key:"computeTileNeighbors",value:function(e,t){var n=this,r=new Map;return he[this.frame%he.length].forEach((function(a){var i=e+a.x,o=t+a.y,s=n.tileAt(i,o);null!=s&&r.set(a,s)})),r}},{key:"entities",value:function(){if(null==this.cachedEntities)throw new Error("accessed entities before filling");return this.cachedEntities}},{key:"handleTileUpdated",value:function(e){this.neighborCache[e.x][e.y]=this.computeTileNeighbors(e.x,e.y);var t=!0,n=!1,r=void 0;try{for(var a,i=ae.b[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,s=e.x+o.x,l=e.y+o.y;this.isValidPosition(s,l)&&(this.neighborCache[s][l]=this.computeTileNeighbors(s,l))}}catch(c){n=!0,r=c}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}this.fillCachedEntities()}},{key:"fillCachedEntities",value:function(){var e=[],t=0,n=0;for(t=0;t<this.width;t++)for(n=(t+this.frame)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));for(t=0;t<this.width;t++)for(n=(t+this.frame+1)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));this.frame%4<2&&e.reverse(),this.playerSeed?e.push(this.playerSeed):e.push(this.player),e.push.apply(e,Object(H.a)(this.insects)),this.cachedEntities=e}},{key:"step",value:function(e){var t=this.entities();return this.stepStats=new G(e,this.frame),t.forEach((function(t){Object(x.b)(t)&&Object(x.c)(t,e)})),this.stepInsects(e),this.weather.step(e),this.frame++,this.time+=e,this.fillCachedEntities(),this.events.emit("step",this.stepStats),this.stepStats}},{key:"stepInsects",value:function(e){null==this.playerSeed&&this.insects.length<1&&Math.random()<this.environment.insectsPerDay/N.k*e&&(de.clear(),de.show({message:"Insect approaching!"}),this.insects.push(new Z(new u.Vector2(Object(J.f)(0,this.width),0),this)))}},{key:"logEvent",value:function(e){this.stepStats.logEvent(e)}},{key:"getLastStepStats",value:function(){return this.stepStats}},{key:"computeSoilDepths",value:function(){var e=Array.from(this.allEnvironmentTiles()).filter((function(e){return e instanceof c.a})).map((function(e){return e.pos})),t=!0,n=!1,r=void 0;try{for(var a,i=this.bfsIterator(e,this.width*this.height)[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(o instanceof c.h){var s=o.depth,l=!0,u=!1,h=void 0;try{for(var d,f=this.tileNeighbors(o.pos)[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var v=Object(U.a)(d.value,2)[1];v instanceof c.a?s=0:v instanceof c.h&&(s=Math.min(s,v.depth))}}catch(m){u=!0,h=m}finally{try{l||null==f.return||f.return()}finally{if(u)throw h}}o.depth=s+1}}}catch(m){n=!0,r=m}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"earnMP",value:function(e,t){this.mpEarners.set(e,t)}},{key:"checkResources",value:function(){var e=0,t=0,n=0;this.entities().forEach((function(r){e+=r.inventory.sugar,t+=r.inventory.water,r instanceof c.b&&(n+=r.energy)})),Object(ne.a)("sugar",e,"water",t,"energy",n)}},{key:"allCells",value:function(){var e=this.gridCells,t=this.width,n=this.height;return Object(L.a)({},Symbol.iterator,V.a.mark((function r(){var a,i,o;return V.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=0;case 1:if(!(a<t)){r.next=14;break}i=0;case 3:if(!(i<n)){r.next=11;break}if(null==(o=e[a][i])){r.next=8;break}return r.next=8,o;case 8:i++,r.next=3;break;case 11:a++,r.next=1;break;case 14:case"end":return r.stop()}}),r)})))}},{key:"allEnvironmentTiles",value:function(){var e=this;return Object(L.a)({},Symbol.iterator,V.a.mark((function t(){var n,r,a,i,o,s,l,c,u,h,d,f;return V.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,r=!1,a=void 0,t.prev=3,i=e.gridEnvironment[Symbol.iterator]();case 5:if(n=(o=i.next()).done){t.next=36;break}s=o.value,l=!0,c=!1,u=void 0,t.prev=10,h=s[Symbol.iterator]();case 12:if(l=(d=h.next()).done){t.next=19;break}return f=d.value,t.next=16,f;case 16:l=!0,t.next=12;break;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(10),c=!0,u=t.t0;case 25:t.prev=25,t.prev=26,l||null==h.return||h.return();case 28:if(t.prev=28,!c){t.next=31;break}throw u;case 31:return t.finish(28);case 32:return t.finish(25);case 33:n=!0,t.next=5;break;case 36:t.next=42;break;case 38:t.prev=38,t.t1=t.catch(3),r=!0,a=t.t1;case 42:t.prev=42,t.prev=43,n||null==i.return||i.return();case 45:if(t.prev=45,!r){t.next=48;break}throw a;case 48:return t.finish(45);case 49:return t.finish(42);case 50:case"end":return t.stop()}}),t,null,[[3,38,42,50],[10,21,25,33],[26,,28,32],[43,,45,49]])})))}},{key:"allTiles",value:function(){var e=this.width,t=this.height,n=this;return Object(L.a)({},Symbol.iterator,V.a.mark((function r(){var a,i,o;return V.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=0;case 1:if(!(a<e)){r.next=14;break}i=0;case 3:if(!(i<t)){r.next=11;break}if(null==(o=n.tileAt(a,i))){r.next=8;break}return r.next=8,o;case 8:i++,r.next=3;break;case 11:a++,r.next=1;break;case 14:case"end":return r.stop()}}),r)})))}},{key:"bfsIterator",value:function(e,t,n,r){var a=this,i=this,o=(Array.isArray(e)?e:[e]).map((function(e){return a.tileAt(e)})),s=new Set;return Object(L.a)({},Symbol.iterator,V.a.mark((function e(){var a,l,c,u,h,d,f,v,m,p;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o.length>0&&s.size<t)){e.next=30;break}if(null!=(a=o.shift())){e.next=4;break}return e.abrupt("return");case 4:return s.add(a),e.next=7,a;case 7:for(l=i.tileNeighbors(a.pos),c=!0,u=!1,h=void 0,e.prev=11,d=l[Symbol.iterator]();!(c=(f=d.next()).done);c=!0)v=Object(U.a)(f.value,2),m=v[0],p=v[1],1!==m.manhattanLength()||null!=n&&!n(p)||-1!==o.indexOf(p)||s.has(p)||o.push(p);e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),u=!0,h=e.t0;case 19:e.prev=19,e.prev=20,c||null==d.return||d.return();case 22:if(e.prev=22,!u){e.next=25;break}throw h;case 25:return e.finish(22);case 26:return e.finish(19);case 27:r&&o.sort((function(e,t){return r(e)-r(t)})),e.next=0;break;case 30:case"end":return e.stop()}}),e,null,[[11,15,19,27],[20,,22,26]])})))}}]),e}(),he=[Object(re.a)(ae.b.slice()),Object(re.a)(ae.b.slice()),Object(re.a)(ae.b.slice()),Object(re.a)(ae.b.slice()),Object(re.a)(ae.b.slice())],de=Y.f.create({canEscapeKeyClear:!1,maxToasts:1,position:"bottom"}),fe=n(10),ve=new d.a("Tissue",0,new h.a(f.d.level(0)),{texturePosition:new u.Vector2(1,1),color:new u.Color(3190309)},{type:"give",resources:"sugar"}),me=new d.a("Leaf",0,new h.a(f.d.level(0),f.e.level(0),f.g.level(0)),{color:new u.Color("white"),texturePosition:new u.Vector2(2,1)},{type:"give",resources:"water take sugar"}),pe=new d.a("Root",0,new h.a(f.d.level(0),f.i.level(0),f.c.level(0),f.k.level(0)),{color:new u.Color("white"),texturePosition:new u.Vector2(3,1)},{type:"take",resources:"water and sugar"}),ye=new d.a("Seed",0,new h.a(f.d.level(0),f.j.level(0)),{texturePosition:new u.Vector2(1,4)}),ge=new d.b([ve,me,pe,ye]),be=n(59),we=n.n(be),Ee=Object(fe.b)({genome:Object(fe.h)(d.b),id:Object(fe.e)(),name:Object(fe.i)(),freeMutationPoints:Object(fe.i)(),totalMutationPoints:Object(fe.i)(),geneOptions:Object(fe.f)(Object(fe.h)(X.e))});function ke(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"plantum originus";return{id:we()(),genome:ge,name:e,freeMutationPoints:0,descendants:[],geneOptions:[]}}function Oe(e){var t=[];t.push(e);var n=!0,r=!1,a=void 0;try{for(var i,o=e.descendants[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;t.push.apply(t,Object(H.a)(Oe(s)))}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}Ee.props.descendants=Object(fe.f)(Object(fe.h)(Ee)),Ee.props.parent=Object(fe.j)(Ee);var Ae=function(){function e(t){Object(C.a)(this,e),this.visitors=t,this.trials=[]}return Object(S.a)(e,[{key:"recordDataFor",value:function(e){var t=function(e,t){for(var n={},r=0,a=Object.entries(t);r<a.length;r++){var i=Object(U.a)(a[r],2),o=i[0],s=(0,i[1])(e,e[0].world);n[o]=s}return n}(e,this.visitors);this.trials.push(t)}},{key:"visitorNames",value:function(){return Object.keys(this.visitors)}}]),e}(),je=function(){function e(t){Object(C.a)(this,e),this.experiments=t}return Object(S.a)(e,[{key:"recordDataFor",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.experiments[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.recordDataFor(e)}}catch(o){n=!0,r=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}}]),e}(),xe={insectsPerDay:0,airEvaporation:0,climate:{rainDuration:0,timeBetweenRainfall:1/0,waterPerSecond:0},fill:function(e,t){},secondsToEvaporate:1/0,floorCo2:1,temperaturePerSeason:[50,50,50,50]};function Ce(e,t){var n=new ue(xe,0,ke(),{width:e,height:t}),r=j.cellTypes[0],a=!0,i=!1,o=void 0;try{for(var s,l=n.allEnvironmentTiles()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var u=s.value.pos;n.setTileAt(u,new c.b(u,n,r))}}catch(h){i=!0,o=h}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return n.cellAt(0,0).inventory.set(100,0),n}function Se(){var e=Ce(20,1),t=Ce(20,2),n={time:function(e){return e[0].world.time}},r=!0,a=!1,i=void 0;try{for(var o,s=function(){var r=o.value.pos,a=e.cellAt(r),i=t.cellAt(r);n[r.x]=function(){var e=a.inventory.water;return i.inventory.water-e}},l=e.allCells()[Symbol.iterator]();!(r=(o=l.next()).done);r=!0)s()}catch(u){a=!0,i=u}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}var c=new Ae(n);console.time("run simulation");do{e.time%1<.1&&c.recordDataFor(Array.from(e.allCells())),e.step(.1),t.step(.1)}while(e.time<=10);return console.timeEnd("run simulation"),c}var Pe=function(){return a.a.useEffect((function(){var e=document.createElement("script");e.src="https://cdn.plot.ly/plotly-latest.min.js",e.addEventListener("load",(function(){!function(e,t){var n=[];for(var r in e.trials){var a=e.trials[r],i=[],o=[],s=!0,l=!1,c=void 0;try{for(var u,h=e.visitorNames()[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value;i.push(d);var f=a[d];o.push(f)}}catch(p){l=!0,c=p}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}var v={x:i,y:o,name:"t=".concat(Number(r)/10),type:"bar"};n.push(v)}var m=document.createElement("div");document.getElementById(t).appendChild(m),window.Plotly.newPlot(m,n,{barmode:"stack"})}(Se(),"water-over-time")})),e.addEventListener("error",(function(){var e=function(){var e=Ce(20,1),t={time:function(e){return e[0].world.time}},n=!0,r=!1,a=void 0;try{for(var i,o=function(){var n=i.value.pos,r=e.cellAt(n);t[n.x]=function(){return r.inventory.water}},s=e.allCells()[Symbol.iterator]();!(n=(i=s.next()).done);n=!0)o()}catch(c){r=!0,a=c}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}var l=new Ae(t);console.time("run simulation");do{e.time%1<.1&&l.recordDataFor(Array.from(e.allCells())),e.step(.1)}while(e.time<=10);return console.timeEnd("run simulation"),l}();console.table(e.trials);var t=Se();console.table(t.trials)})),document.body.appendChild(e)}),[]),a.a.createElement("div",null,a.a.createElement("h1",null,"Test Diffusion"),a.a.createElement("div",{id:"water-over-time"},a.a.createElement("h2",null,"width 20 world, water from t=0 to t=1 ")))};function Me(e){switch(e.height){case 0:return Te;case 1:return Ne;case 2:return Re;case 3:return Fe;case 4:return De;case 5:default:return Be}}var Te={insectsPerDay:0,airEvaporation:.2,climate:{timeBetweenRainfall:70,rainDuration:3,waterPerSecond:210},secondsToEvaporate:166,floorCo2:.5,temperaturePerSeason:[48,56,52,43],fill:"Level0"},Ne={insectsPerDay:1,airEvaporation:.3,climate:{timeBetweenRainfall:65,rainDuration:3,waterPerSecond:220},secondsToEvaporate:166,floorCo2:.5,temperaturePerSeason:[53,81,43,20],fill:"Temperate"},Re={insectsPerDay:1,airEvaporation:.3,climate:{timeBetweenRainfall:20,rainDuration:8,waterPerSecond:30},secondsToEvaporate:166,floorCo2:.5,temperaturePerSeason:[53,75,43,25],fill:"Reservoires"},Fe={insectsPerDay:0,airEvaporation:.03,climate:{timeBetweenRainfall:83.333,rainDuration:6,waterPerSecond:180},secondsToEvaporate:166,floorCo2:.8,temperaturePerSeason:[40,62,36,15],fill:"Rocky"},De={insectsPerDay:0,airEvaporation:.3,climate:{timeBetweenRainfall:12,rainDuration:6,waterPerSecond:21},secondsToEvaporate:166,floorCo2:.5,temperaturePerSeason:[18,62,36,15],fill:"SkySoil"},Be={insectsPerDay:0,airEvaporation:.3,climate:{timeBetweenRainfall:110,rainDuration:6.3333,waterPerSecond:220},secondsToEvaporate:16,floorCo2:.95,temperaturePerSeason:[72,89,110,50],fill:"Desert"},Ie=n(171),ze=n.n(Ie),Ge=n(12),Le=n.n(Ge),We=n(54),Ve=n(17),Ue=n(47),He=n(172),Qe=n.n(He);n(283);var Ye=function(e){var t=e.size,n=e.className,r=Object(Ue.a)(e,["size","className"]);return a.a.createElement("img",Object.assign({className:Le()("character",t,n),alt:"",src:Qe.a},r))};n(284);function Ke(){return r.createElement("div",{className:"glow"},r.createElement("span",null))}n(285);function Xe(e){var t=e.fruit,n=e.mpEarned,a=Object(J.d)(Object(g.reproducerGetPercentMatured)(t),0,1,.2,1),i=r.useMemo((function(){return{transform:"scale(".concat(a,")")}}),[a]);return r.createElement("div",{className:"fruit-info"},r.createElement("div",{className:"fruit-visual"},t.state.isMature?r.createElement(Ke,null):null,r.createElement("img",{alt:"",src:ze.a,style:i})),null!=t.state.timeMatured?r.createElement(r.Fragment,null,r.createElement("span",{className:"matured-info success"},"+",r.createElement(We.a,{amount:n})),"\xa0at ",z(B(t.state.timeMatured)),", Mutation Points earned: 1"):r.createElement("span",{className:"matured-info in-progress"},(100*Object(g.reproducerGetPercentMatured)(t)).toFixed(0),"% maturity"),", started at ",z(B(t.cell.timeMade)),".")}function Ze(e){var t=e.cell,n=e.mpEarned,a=t.findGene(g.GeneFruit);return null!=a?r.createElement(Xe,{fruit:a,mpEarned:n}):r.createElement("div",null,t.toString()," +",r.createElement(We.a,{amount:n}))}function Je(e){var t=e.mpEarners,n=e.className;return t.size>0?r.createElement("div",{className:Le()("mp-earner-list",n)},r.createElement("h5",null,"Reproductive Cells"),r.createElement("div",null,Array.from(t.entries()).map((function(e){var t=Object(U.a)(e,2),n=t[0],a=t[1];return r.createElement(Ze,{cell:n,mpEarned:a})})))):null}function qe(e){var t=e.vignettes,n=r.useState(0),a=Object(U.a)(n,2),i=a[0],o=a[1];return t&&t.length>0?r.createElement("div",{className:"vignette-viewer"},r.createElement(Y.c,{className:"slider",value:i,min:0,stepSize:1,max:t.length-1,onChange:o,showTrackFill:!1,labelRenderer:function(e){return"Day ".concat(e+1)}}),r.createElement("div",{className:"current-vignette"},r.createElement("img",{src:t[i].toDataURL(),alt:""}))):null}function _e(e){var t=e.results,n=Array.from(t.mpEarners.entries()).filter((function(e){var t=Object(U.a)(e,2);t[0];return t[1]>0})).length<3?"survived":"thrived";return r.createElement(r.Fragment,null,r.createElement("div",{className:"character-container"},r.createElement(Ye,{size:"large",className:"dance"})),r.createElement("h1",null,"You ",n,"!"),r.createElement("h2",null,t.mutationPointsPerEpoch," Mutation Points earned."),r.createElement(qe,{vignettes:t.vignettes}),r.createElement(Je,{mpEarners:t.mpEarners}))}function $e(e){var t=e.results;return r.useEffect((function(){return Ve.q.play(),function(){Ve.q.stop()}}),[]),r.createElement(r.Fragment,null,r.createElement("div",{className:"character-container"},r.createElement(Ye,{className:"sad",size:"large"})),r.createElement("h1",null,r.createElement("i",null,t.world.species.name)," couldn't survive!"),r.createElement("div",null,"You survived until ",z(t.world.season),"!"),r.createElement(qe,{vignettes:t.vignettes}),r.createElement(Je,{mpEarners:t.mpEarners,className:"dark"}))}var et=r.memo((function(e){var t=e.onDone,n=e.results,a=e.attempt,i=null!=a&&null==a.sourceHex&&"lost"===n.status?"Retry":"Continue";return r.createElement("div",{className:"game-results-screen ".concat(n.status)},r.createElement("div",{className:"game-results-content"},"won"===n.status?r.createElement(_e,e):r.createElement($e,e),r.createElement("button",{className:"done-button",onClick:t},i," \u2192")))}));function tt(e,t,n){var r=j.cellTypes[4],a=new c.b(new u.Vector2(0,0),e,r),i=a.findGene(g.GeneFruit);return i.state.energyRecieved=i.props.neededResources*t,i.state.timeMatured=n,i.state.isMature=1===t,a}function nt(){var e=new ue(Ne,0,ke()),t=tt(e,1,250),n=tt(e,.4),r=tt(e,1,900),i={status:"won",mpEarners:new Map([[t,3],[n,0],[r,3]]),mutationPointsPerEpoch:6,world:e};return a.a.createElement(et,{results:i,onDone:function(){}})}function rt(){var e=new ue(Ne,0,ke());e.time=4*N.k;var t=tt(e,.4);e.time=9*N.k;var n=tt(e,.3);e.time=19*N.k;var r=tt(e,.01459),i={mpEarners:new Map([[t,0],[n,0],[r,0]]),status:"lost",mutationPointsPerEpoch:0,world:e};return a.a.createElement(et,{results:i,onDone:function(){}})}var at=n(76);n(286);var it={0:"~",1:"\xb7",2:"\ud83c\udf33",3:"\ud83c\udfef"};function ot(e,t){return a.a.createElement("div",{className:"grid"},e.map((function(e,n){return a.a.createElement("div",{className:"row"},e.map((function(e,r){return a.a.createElement("span",{"grid-x":r,"grid-y":n,className:"tile"+String(e),onClick:t},it[e])})))})))}var st="\n000\n111\n121\n".trim().split("\n").map((function(e){return e.split("").map((function(e){return Number(e)}))}));var lt=4,ct=q(lt);function ut(e){var t=0;if(e.forEach((function(e){0!==e&&(t+=-e*Math.log(e))})),isNaN(t))throw new Error("NaN entropy");return t}function ht(e){return e.every((function(e){return 0===e}))}function dt(e,t,n){var r=e[t.y][t.x];if("number"===typeof r)throw new Error("Collapsing an already collapsed point!");if(!ht(r)){i(r=r.slice(),t.x,t.y-1,"s"),i(r,t.x,t.y+1,"n"),i(r,t.x-1,t.y,"e"),i(r,t.x+1,t.y,"w"),vt(r);var a=function(e){return function(e,t){if(e.length!==t.length)throw new RangeError("Chance: Length of array and weights must match");for(var n,r=0,a=0;a<t.length;++a)n=t[a],isNaN(n)&&(n=0),n>0&&(r+=n);if(0===r)throw new RangeError("Chance: No valid entries in array weights");var i,o=Math.random()*r,s=0,l=-1;for(a=0;a<t.length;++a){if(n=t[a],s+=n,n>0){if(o<=s){i=a;break}l=a}a===t.length-1&&(i=l)}return e[i]}(ct,e)}(r);return e[t.y][t.x]=a,a}function i(t,r,a,i){var o,s=null===(o=e[a])||void 0===o?void 0:o[r];null!=s&&"number"===typeof s&&(t=function(e,t){if(e.length!==t.length)throw new Error("multiply length mismatch");return q(e.length,(function(n){return e[n]*t[n]}))}(t,n.get(s)[i]))}}function ft(e){ht(e)?e.fill(1/e.length):vt(e)}function vt(e){var t=e.reduce((function(e,t){return e+t}),0);if(t<=0)throw new Error("normalizing a zero weight!");for(var n=0;n<e.length;n++)e[n]=e[n]/t}function mt(e){return new Array(e).fill(0)}var pt=function(){var e=Object(r.useState)(st),t=Object(U.a)(e,2),n=t[0],i=t[1],o=Object(r.useState)(0),s=Object(U.a)(o,2),l=s[0],c=s[1],u=Object(r.useMemo)((function(){return function(e,t,n){var r=e.flat(),a=function(e){var t=new Map;function n(t,n,r){var a,i,o=null===(a=e[n])||void 0===a?void 0:a[t];null!=o&&(r[o]=(null!==(i=r[o])&&void 0!==i?i:0)+1)}function r(e,r,a){t.has(a)||t.set(a,{s:mt(lt),e:mt(lt),n:mt(lt),w:mt(lt)});var i=t.get(a);n(e,r-1,i.n),n(e,r+1,i.s),n(e-1,r,i.w),n(e+1,r,i.e)}for(var a=0;a<e.length;a++)for(var i=0;i<e[a].length;i++)r(i,a,e[a][i]);var o=!0,s=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=Object(U.a)(c.value,2),d=(h[0],h[1]);ft(d.n),ft(d.e),ft(d.s),ft(d.w)}}catch(f){s=!0,l=f}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}return t}(e);console.log(a);var i=mt(lt);function o(){var e=_(t,n,(function(){return i.slice()})),r={x:Object(J.g)(0,t-1),y:Object(J.g)(0,n-1)},o=new Map;do{var s=function(t,n,r){var a,i=null===(a=e[n])||void 0===a?void 0:a[t];if(null!=i&&"number"!==typeof i){var s=q(i.length,(function(e){return 0===r[e]?0:i[e]}));ht(s)||vt(s),e[n][t]=s,o.set("".concat(t,",").concat(n),ut(s))}},l=dt(e,r,a);if(null==l)return;o.delete("".concat(r.x,",").concat(r.y)),s(r.x,r.y-1,a.get(l).n),s(r.x,r.y+1,a.get(l).s),s(r.x-1,r.y,a.get(l).w),s(r.x+1,r.y,a.get(l).e),r=function(){if(0===o.size)return null;var e=Object(K.minBy)(Array.from(o.entries()),(function(e){var t=Object(U.a)(e,2);t[0];return t[1]})),t=Object(U.a)(e,1)[0].split(","),n=Object(U.a)(t,2),r=n[0],a=n[1];return{x:Number(r),y:Number(a)}}()}while(null!=r);return e}r.forEach((function(e){var t;return i[e]=(null!==(t=i[e])&&void 0!==t?t:0)+1})),vt(i);for(var s,l=0;null==s;l++)s=o();return s}(n,25,25)}),[n,l]),h=Object(r.useMemo)((function(){return ot(u)}),[u]),d=Object(r.useCallback)((function(){return c((function(e){return e+1}))}),[]),f=Object(r.useCallback)((function(e){var t=Number(e.currentTarget.attributes.getNamedItem("grid-x").value),n=Number(e.currentTarget.attributes.getNamedItem("grid-y").value);i((function(e){return Object(at.a)(e,(function(e){e[n][t]=(e[n][t]+1)%lt}))}))}),[]),v=Object(r.useMemo)((function(){return ot(n,f)}),[f,n]);return a.a.createElement("div",{className:"wfc-container"},a.a.createElement("div",{className:"source"},a.a.createElement("h2",null,"Source"),v),a.a.createElement("div",{className:"output"},a.a.createElement("button",{onClick:d,style:{padding:"1em 0.5em",fontSize:20,margin:20}},"New"),h))};var yt=n(8),gt=n(6),bt=n(7),wt=a.a.createContext({x:window.innerWidth/2,y:window.innerHeight/2});var Et=n(89),kt=n(91),Ot=n(13);function At(e,t){if(t)return[b.GeneTransport.level(0),kt.GenePipes.level(0),Et.GeneDiffuseWater.level(0)];var n=Array.from(Ot.a.values());Object(re.a)(n);var r=n.filter((function(e){return e.blueprint.levelCosts[0]<0})),a=n.filter((function(e){return e.blueprint.levelCosts[0]>=0}));return[].concat(Object(H.a)(a.slice(0,2).map((function(e){return e.level(Object(J.g)(0,e.numLevels-1))}))),[r[0].level(Object(J.g)(0,r[0].numLevels-1))])}var jt=a.a.createContext(null);function xt(){return Object(r.useContext)(jt)}function Ct(e,t){if(null==t)return console.error("can't reduce null action!",e,t),e;switch(t.type){case"AAUpdateSpecies":return function(e,t){return t.species?Object(Q.a)({},e,{rootSpecies:t.species}):Object(Q.a)({},e)}(e,t);case"AAStartPopulationAttempt":return function(e,t){var n=t.populationAttempt,r=n.targetHex,a=n.sourceHex;if(!r.info.visible)return e;if(null!=a&&null==a.info.flora)return console.error("sourceHex isn't null but the flora is null"),e;return Object(Q.a)({},e,{activePopulationAttempt:t.populationAttempt})}(e,t);case"AAPopulationAttemptSuccess":return St(e,t);case"AANextEpoch":return function(e,t){return Object(at.a)(e,(function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=Oe(e.rootSpecies)[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(o.freeMutationPoints=e.overWorld.getMaxGenePool(o),o.freeMutationPoints>0){var s=0===e.epoch;o.geneOptions=At(0,s)}}}catch(l){n=!0,r=l}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}e.epoch+=1}))}(e);case"AAGetGameResult":return function(e,t){"won"===t.result.status&&(e=St(e,{type:"AAPopulationAttemptSuccess",attempt:e.activePopulationAttempt,results:t.result}));return Object(Q.a)({},e,{activeGameResult:t.result})}(e,t);case"AAGameResultDone":return function(e,t){var n=e.activeGameResult,r=e.activePopulationAttempt;if("lost"===(null===n||void 0===n?void 0:n.status)&&null==r.sourceHex)return Object(Q.a)({},e,{activeGameResult:void 0,activePopulationAttempt:Object(Q.a)({},r)});return Object(Q.a)({},e,{activePopulationAttempt:void 0,activeGameResult:void 0})}(e);case"AATransitionStart":return function(e,t){return Object(Q.a)({},e,{transition:t.transition})}(e,t);case"AATransitionEnd":return e}}function St(e,t){return Object(at.a)(e,(function(e){var n=t.attempt,r=void 0===n?e.activePopulationAttempt:n,a=t.results,i=r.settlingSpecies,o=e.overWorld.hexAt(r.targetHex.i,r.targetHex.j);null==r.sourceHex&&gtag("event","Beat first playthrough",{label:"mp earned",value:a.mutationPointsPerEpoch});var s=void 0;null!=o.info.flora&&(s=o.info.flora.species),o.info.flora={species:i,mutationPointsPerEpoch:a.mutationPointsPerEpoch},s&&(s.freeMutationPoints=Math.min(s.freeMutationPoints,e.overWorld.getMaxGenePool(s)));var l=!0,c=!1,u=void 0;try{for(var h,d=e.overWorld.hexNeighbors(o)[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f=h.value;f&&(f.info.visible=!0)}}catch(v){c=!0,u=v}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}}))}var Pt=n(27),Mt=n(28);n(80);var Tt=function(e){return e.substr(0,1).toLocaleUpperCase()+e.substr(1)},Nt="abcdefghijklmnopqrstuvwxyz",Rt=Nt.toUpperCase();function Ft(e){var t,n;return t="lower"===e.casing?Nt:"upper"===e.casing?Rt:Nt+Rt,e.pool?n=e.pool:(n="",e.alpha&&(n+=t),e.numeric&&(n+="0123456789"),e.symbols&&(n+="!@#$%^&*()[]"),n||(n=t+"0123456789!@#$%^&*()[]")),n.charAt(Object(J.g)(0,n.length-1))}function Dt(){for(var e,t=Object(J.g)(2,3),n="",r=0;r<t;r++)n+=e=0===r?Ft({pool:"bcdfghjklmnprstvwzaeiou"}):-1==="bcdfghjklmnprstvwz".indexOf(e)?Ft({pool:"bcdfghjklmnprstvwz"}):Ft({pool:"aeiou"});return n}var Bt=["@ Steppes","@ Plains","@ Area","@ Basin","@ Bend","@ Beach","@ Cape","@ Flat","@ Ridge","@ Summit","Mount @","@'s Valley","@ Hills","@ Pinnacle","@ Heights"];function It(){return e=Tt(function(e){var t=(null===e||void 0===e?void 0:e.syllables)||2,n="";if(null===e||void 0===e?void 0:e.length){do{n+=Dt()}while(n.length<e.length);n=n.substring(0,e.length)}else for(var r=0;r<t;r++)n+=Dt();return n}()),Object(J.e)(Bt).replace("@",e);var e}var zt,Gt,Lt,Wt,Vt,Ut,Ht,Qt,Yt,Kt,Xt,Zt,Jt,qt,_t,$t,en,tn,nn,rn=Object(fe.b)({climate:Object(fe.h)(Object(fe.b)({"*":!0})),"*":!0}),an=Object(fe.b)({seed:Object(fe.i)(),height:Object(fe.i)(),temperature:Object(fe.i)(),rainfall:Object(fe.i)(),soilType:Object(fe.i)(),wind:Object(fe.i)(),visible:Object(fe.i)(),environment:Object(fe.h)(rn),flora:Object(fe.h)(Object(fe.b)({species:Object(fe.j)(Ee),mutationPointsPerEpoch:Object(fe.i)(),actionPoints:Object(fe.i)()}))}),on=Math.sqrt(3)/2,sn=(zt=Object(fe.k)(Object(fe.e)()),Gt=Object(fe.k)(Object(fe.h)(an)),Lt=function(){function e(t,n){Object(C.a)(this,e),Object(Pt.a)(this,"version",Wt,this),Object(Pt.a)(this,"uuid",Vt,this),Object(Pt.a)(this,"_displayName",Ut,this),Object(Pt.a)(this,"info",Ht,this),Object(Pt.a)(this,"i",Qt,this),Object(Pt.a)(this,"j",Yt,this),this.i=t,this.j=n}return Object(S.a)(e,[{key:"displayName",get:function(){return null==this._displayName&&(this.info.height<0?this._displayName="Deep Water":this._displayName=It()),this._displayName}}]),Object(S.a)(e,[{key:"cartesian",get:function(){var e=this.i,t=this.j;return{x:1.5*e,y:2*on*t+on*e}}},{key:"isHabitable",get:function(){return-1!==this.info.height}},{key:"k",get:function(){return-(this.i+this.j)}},{key:"magnitude",get:function(){return Math.abs(this.i)+Math.abs(this.j)+Math.abs(this.k)}}]),e}(),Wt=Object(Mt.a)(Lt.prototype,"version",[fe.k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Vt=Object(Mt.a)(Lt.prototype,"uuid",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return we()()}}),Ut=Object(Mt.a)(Lt.prototype,"_displayName",[fe.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ht=Object(Mt.a)(Lt.prototype,"info",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{seed:Math.random()*Number.MAX_SAFE_INTEGER,height:-1,rainfall:"medium",soilType:"average",temperature:"temperate",visible:!1}}}),Qt=Object(Mt.a)(Lt.prototype,"i",[fe.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yt=Object(Mt.a)(Lt.prototype,"j",[fe.k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lt),ln=n(127),cn=n.n(ln),un=(Xt=Object(fe.k)(Object(fe.g)(Object(fe.h)(sn))),Kt=Symbol.iterator,Zt=function(){function e(){Object(C.a)(this,e),Object(Pt.a)(this,"tiles",Jt,this)}return Object(S.a)(e,[{key:"hash",value:function(e,t){return"".concat(e,",").concat(t)}},{key:"get",value:function(e,t){return this.tiles[this.hash(e,t)]}},{key:"set",value:function(e,t,n){this.tiles[this.hash(e,t)]=n}},{key:Kt,value:V.a.mark((function e(){var t;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=V.a.keys(this.tiles);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.tiles[t];case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))}]),e}(),Jt=Object(Mt.a)(Zt.prototype,"tiles",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),Zt),hn=(_t=Object(fe.k)(Object(fe.h)(un)),$t=Object(fe.k)(Object(fe.j)(sn)),qt=Symbol.iterator,en=function(){function e(t,n){Object(C.a)(this,e),Object(Pt.a)(this,"storage",tn,this),Object(Pt.a)(this,"startTile",nn,this),this.storage=t,this.startTile=n,this.startTile&&(this.startTile.info.visible=!0)}return Object(S.a)(e,[{key:"hexNeighbors",value:function(e){var t=e.i,n=e.j,r=[];return r[0]=this.storage.get(t+1,n),r[1]=this.storage.get(t,n+1),r[2]=this.storage.get(t-1,n+1),r[3]=this.storage.get(t-1,n),r[4]=this.storage.get(t,n-1),r[5]=this.storage.get(t+1,n-1),r}},{key:"possibleMigrationSources",value:function(e){var t=this.hexNeighbors(e).filter((function(e){return null!=(null===e||void 0===e?void 0:e.info.flora)}));return null==e.info.flora?t:t.filter((function(t){return null!=t&&t.info.flora.species!==e.info.flora.species}))}},{key:"possibleMigrationTargets",value:function(e){return null==e.info.flora?(console.error("can't migrate from a null flora source"),[]):this.hexNeighbors(e).filter((function(t){return null!=t&&(null==t.info.flora||t.info.flora.species!==e.info.flora.species)}))}},{key:"getStartHex",value:function(){return this.startTile}},{key:"hexAt",value:function(e,t){return this.storage.get(e,t)}},{key:qt,value:V.a.mark((function e(){var t,n,r,a,i,o;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,a=this.storage[Symbol.iterator]();case 5:if(t=(i=a.next()).done){e.next=12;break}return o=i.value,e.next=9,o;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,r=e.t0;case 18:e.prev=18,e.prev=19,t||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw r;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))},{key:"getMaxGenePool",value:function(e){return this.getHexesPopulatedBy(e).reduce((function(e,t){return e+t.info.flora.mutationPointsPerEpoch}),0)}},{key:"getHexesPopulatedBy",value:function(e){var t=[],n=!0,r=!1,a=void 0;try{for(var i,o=this.storage[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,l=s.info.flora;l&&l.species.id===e.id&&t.push(s)}}catch(c){r=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}}],[{key:"randomHeight",value:function(e,t){var n=e.cartesian,r=n.x,a=n.y,i=0;return i+=6*(t.noise3D(r/24,a/24,0)-.2),i+=6*t.noise3D(r/24,a/24,1.453),i+=1.5*t.noise3D(r/6,a/6,1.453),i+=1,(i-=.025*Math.abs(a*a))<0&&i>=-1&&(i=0),i=Math.round(Math.max(Math.min(i,6),-1))}},{key:"populateLevelInfo",value:function(t,n){t.info.height=e.randomHeight(t,n)}},{key:"generateFilledHex",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=new un,r=new cn.a,a=-t;a<=t;a++)for(var i=-t;i<=t;i++){var o=-(a+i);if(!(Math.abs(o)>t)){var s=new sn(a,i);e.populateLevelInfo(s,r),n.set(a,i,s)}}var l=e.getDefaultStartTile(n);return new e(n,l)}},{key:"generateRectangle",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,r=new un,a=new cn.a,i=Math.max(t/2,n/2),o=-i;o<=i;o++)for(var s=-i;s<=i;s++){var l=-(o+s);if(!(Math.abs(l)>i)){var c=new sn(o,s),u=c.cartesian,h=u.x,d=u.y;h<-t/2||h>t/2||d<-n/2||d>n/2||(e.populateLevelInfo(c,a),r.set(o,s,c))}}var f=e.getDefaultStartTile(r);return new e(r,f)}},{key:"getDefaultStartTile",value:function(e){if(null!=e)return Array.from(e).filter((function(e){return 0===e.info.height})).sort((function(e,t){return e.magnitude-t.magnitude}))[0]}}]),e}(),tn=Object(Mt.a)(en.prototype,"storage",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nn=Object(Mt.a)(en.prototype,"startTile",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),en),dn=(Object(fe.b)({sourceHex:Object(fe.j)(sn),targetHex:Object(fe.j)(sn),settlingSpecies:Object(fe.j)(Ee)}),Object(fe.b)({overWorld:Object(fe.h)(hn),rootSpecies:Object(fe.h)(Ee),epoch:!0})),fn=n(77),vn=n(104),mn=n.n(vn);function pn(e){var t=Object(fe.l)(dn,e);console.log("saved json",t);var n=JSON.stringify(t);return mn.a.setItem("gameData",n)}function yn(){return(yn=Object(fn.a)(V.a.mark((function e(){var t,n,r;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.a.getItem("gameData");case 2:return t=e.sent,n=JSON.parse(t),r=Object(fe.d)(dn,n),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var gn={AAGameResultDone:!0,AAGetGameResult:!0,AAUpdateSpecies:!0,AANextEpoch:!0,AAPopulationAttemptSuccess:!0,AAStartPopulationAttempt:!0};n(287);function bn(e){return a.a.createElement("button",Object.assign({},e,{className:Le()("button",e.className,e.color||"purple")}),e.children)}n(288),n(289);var wn=function e(t){var n=t.species,i=t.onMutate,o=n.descendants.length>0?a.a.createElement("div",{className:"descendants-container"},n.descendants.map((function(t,n){return a.a.createElement(e,{key:n,species:t,onMutate:i})}))):null,s=Object(r.useCallback)((function(){i(n)}),[i,n]);return a.a.createElement("div",{className:"species-node"},o,a.a.createElement("div",{className:"species-info",onClick:s},a.a.createElement("div",{className:"species-info-name"},n.name),a.a.createElement("div",{className:"species-info-animation"},a.a.createElement(Ye,{size:"small"})),a.a.createElement(We.a,{amount:n.freeMutationPoints})))};var En=function(e){var t=e.onMutate,n=xt(),r=Object(U.a)(n,1)[0].rootSpecies;return a.a.createElement("div",{className:"phylogenetic-tree"},a.a.createElement("div",{className:"title"},"Phylogenetic Tree"),a.a.createElement("div",{className:"tree-nodes"},a.a.createElement(wn,{species:r,onMutate:t})))},kn=n(67),On=n(48);n(290);function An(e){var t=e.onNextEpoch,n=(e.onFocusHex,xt()),i=Object(U.a)(n,1)[0],o=i.epoch,s=i.overWorld,l=i.rootSpecies,c=Object(r.useState)(!1),u=Object(U.a)(c,2),h=u[0],d=u[1],f=a.a.useCallback((function(){d(!0),setTimeout((function(){return d(!1)}),5e3),t()}),[t]),v=[],m=Oe(l),p=!0,y=!1,g=void 0;try{for(var b,w=m[Symbol.iterator]();!(p=(b=w.next()).done);p=!0){var E=b.value,k=s.getMaxGenePool(E);v.push(a.a.createElement("div",{key:E.id},a.a.createElement("span",{className:"species-name"},E.name)," ",a.a.createElement(We.a,{amount:E.freeMutationPoints,total:k})))}}catch(A){y=!0,g=A}finally{try{p||null==w.return||w.return()}finally{if(y)throw g}}var O=a.a.createElement(a.a.Fragment,null,"Refill mutation points.");return a.a.createElement("div",{className:Le()("epoch-display",{"ready-to-advance":!1,transitioning:h})},a.a.createElement("h1",{className:"number"},"Epoch ",a.a.createElement(On.a,{sigFigs:6,value:o,speed:.08})),a.a.createElement("div",{className:"production-overview"},v),a.a.createElement(Y.g,{position:"left",content:O},a.a.createElement("button",{className:"button-next-epoch",onClick:f,disabled:h},a.a.createElement(kn.d,{className:"icon"}))))}var jn=n(92),xn=n(25),Cn=n(33);function Sn(e){var t=e.width,n=void 0===t?1:t,r=e.height,a=void 0===r?1:r,i=e.radius,o=void 0===i?.1:i,s=e.max,l=void 0===s?1e3:s,c=e.initialSample,h=void 0===c?void 0:c,d=e.rng,f=void 0===d?Math.random:d,v=o*o,m=3*v,p=o*Math.SQRT1_2,y=Math.ceil(n/p),g=Math.ceil(a/p),b=new Array(y*g),w=[],E=0,k=0;function O(e,t){var n=e/p|0,r=t/p|0,a=Math.max(n-2,0),i=Math.max(r-2,0),o=Math.min(n+3,y),s=Math.min(r+3,g);for(r=i;r<s;++r){var l=r*y;for(n=a;n<o;++n){var c;if(c=b[l+n]){var u=c[0]-e,h=c[1]-t;if(u*u+h*h<v)return!1}}}return!0}function A(e,t){var n=[e,t];return w.push(n),b[y*(t/p|0)+(e/p|0)]=n,k++,E++,n}f=f||Math.random;for(var j=function(){if(!k)return null!=h?A(h[0],h[1]):A(f()*n,f()*a);for(;E;){for(var e=f()*E|0,t=w[e],r=0;r<30;++r){var i=2*Math.PI*f(),o=Math.sqrt(f()*m+v),s=t[0]+o*Math.cos(i),l=t[1]+o*Math.sin(i);if(s>=0&&s<n&&l>=0&&l<a&&O(s,l))return A(s,l)}w[e]=w[--E],w.length=E}},x=[],C=0;C<l;C++){var S=j();if(null==S)break;x.push(new u.Vector2(S[0],S[1]))}return x}var Pn=Math.sqrt(3)/2;function Mn(e,t,n){var r=t.scale,a=t.dX,i=t.dY,o=e.width/2+a,s=e.height/2+i,l=n.nativeEvent,c=(l.offsetX-o)/r/1.5,u=((l.offsetY-s)/r-Pn*c)/(2*Pn);return function(e,t,n){var r=Math.round(e),a=Math.round(t),i=Math.round(n),o=Math.abs(r-e),s=Math.abs(a-t),l=Math.abs(i-n);o>s&&o>l?r=-a-i:s>l?a=-r-i:i=-r-a;return{i:r,j:a,k:i}}(c,u,-(c+u))}function Tn(e,t){var n=t.dX,r=t.dY,a=t.scale,i=e.cartesian,o=i.x,s=i.y;return[window.innerWidth/2+n+o*a,window.innerHeight/2+r+s*a]}function Nn(e,t){var n=e.cartesian,r=n.x,a=n.y,i=window.innerWidth/2-r*t,o=window.innerHeight/2-a*t;return[i-window.innerWidth/2,o-window.innerHeight/2]}!function(){var e=[new u.Vector2(-1,0),new u.Vector2(.5,Pn),new u.Vector2(.5,-Pn)]}();var Rn=function(){var e=1*Pn;return function(t,n){var r=Math.abs(t),a=Math.abs(n);return!(r>1||a>e)&&1*e-e*r-.5*a>=0}}(),Fn=n(173),Dn=n.n(Fn);n(291);var Bn=function(e){var t=e.environment,n=e.info;return a.a.createElement("div",{className:"environment-info"},t.insectsPerDay>0?a.a.createElement("div",{className:"insects"},a.a.createElement("img",{src:Dn.a}),a.a.createElement("b",null,"Has Locusts")):null,a.a.createElement("div",null,a.a.createElement("b",null,"Rainfall"),": ",n.rainfall),a.a.createElement("div",null,a.a.createElement("b",null,"Temperature"),": ",n.temperature),a.a.createElement("div",null,a.a.createElement("b",null,"Soil Type"),": ",n.soilType))},In=function(e){e.playSpecies;var t=e.tile,n=e.onClickPlay,r=t.info,i=r.height,o=r.flora,s=-1===i?null:a.a.createElement("div",{className:"play-selector"},a.a.createElement(bn,{color:"green",className:"play-button",onClick:n},"Play Level")),l=null!=o?a.a.createElement("div",{className:"inhabited"},a.a.createElement("p",null,"Inhabited by"," ",a.a.createElement("b",null,a.a.createElement("i",null,o.species.name))),a.a.createElement("p",null,a.a.createElement(We.a,{amount:o.mutationPointsPerEpoch})," per epoch")):null;delete Object(Q.a)({},t.info).flora;var c=t.isHabitable?a.a.createElement(Bn,{info:t.info,environment:Me(t.info)}):a.a.createElement("p",{style:{color:"red"}},"Uninhabitable");return a.a.createElement("div",{className:"hex-info-container"},a.a.createElement("div",{className:"header"},t.displayName),a.a.createElement("div",{className:"body"},l,c),s)},zn=n(174),Gn=n.n(zn),Ln=n(336),Wn=n(341),Vn=new Image;Vn.src=Gn.a;var Un=Object(Wn.a)().domain([-1,0,1,5,6]).range(["rgb(0, 60, 255)","lightblue","yellow","orange"]),Hn=function(){function e(t,n){Object(C.a)(this,e),this.tile=t,this.context=n,this.vignettePositions=void 0,this.isHovered=!1}return Object(S.a)(e,[{key:"setIsHovered",value:function(){this.isHovered=!0}},{key:"draw",value:function(e,t){var n=t.scale,r=Tn(this.tile,t),a=Object(U.a)(r,2),i=a[0],o=a[1];e.lineWidth=1*n/48,this.isShadowed?e.globalAlpha=.2:e.globalAlpha=1,this.tile.info.visible,e.fillStyle=Un(this.tile.info.height),e.strokeStyle="rgb(112, 112, 112)",Qn(e,i,o,n),this.isHovered||this.drawNumericHeight(e,n,i,o),null!=this.tile.info.flora&&this.drawVignettes(e,this.tile.info.flora.species,i,o,n),this.isHovered&&(e.strokeStyle="rgb(112, 112, 112)",e.lineWidth=1*n/48,function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.beginPath(),e.moveTo(t+r,n),e.arc(t,n,r,0,2*Math.PI),a&&e.fill();e.stroke()}(e,i,o,n/48*12,!1),this.tile.info.visible&&this.drawNumericHeight(e,n,i,o)),this.isHovered=!1}},{key:"drawActivePulse",value:function(e,t,n,r){for(var a=0;a<10;a++)this.drawPulse(a/10,e,t,n,r)}},{key:"drawPulse",value:function(t,n,r,a,i){var o=Object(J.d)(e.easePulse(Object(J.a)(Object(J.d)(Object(J.j)(Cn.a.now/6e3+t),0,1,-1,2),-1/0,1)),0,1,0,20);n.lineWidth=o*r/48;var s=100/(o*o*o);n.strokeStyle="rgba(255, 255, 255, ".concat(s,")"),Qn(n,a,i,r+n.lineWidth/2,!1)}},{key:"drawNumericHeight",value:function(e,t,n,r){this.tile.info.height>=0&&(e.font="".concat(12*t/48,"px serif"),e.textAlign="center",e.textBaseline="middle",e.fillStyle="#666",e.fillText(this.tile.info.height+"",n,r,t))}},{key:"drawVignettes",value:function(e,t,n,r,a){if(null==this.vignettePositions){var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=2,r=Pn*n,a=Sn({width:n,height:r,radius:e,initialSample:[n/2,r/2],max:1e4}),i=a.map((function(e){return e.x-=n/2,e.y-=r/2,e})).filter((function(e){return Rn(e.x,e.y)}));return t&&i.shift(),i}(.3,!0);this.vignettePositions=[];var o=this.vignettePositions;Object(fn.a)(V.a.mark((function e(){var t,n,r,a,s,l;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,a=i[Symbol.iterator]();case 5:if(t=(s=a.next()).done){e.next=13;break}return l=s.value,o.push(l),e.next=10,P(300);case 10:t=!0,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),n=!0,r=e.t0;case 19:e.prev=19,e.prev=20,t||null==a.return||a.return();case 22:if(e.prev=22,!n){e.next=25;break}throw r;case 25:return e.finish(22);case 26:return e.finish(19);case 27:case"end":return e.stop()}}),e,null,[[3,15,19,27],[20,,22,26]])})))()}var s=a/48/2,l=!0,c=!1,u=void 0;try{for(var h,d=this.vignettePositions[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f=h.value;e.drawImage(Vn,n+f.x*a-Vn.width/2*s,r+f.y*a-Vn.height*s,Vn.width*s,Vn.height*s)}}catch(v){c=!0,u=v}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}}},{key:"zIndex",get:function(){var e=this.tile.cartesian.y;return null!=this.tile.info.flora&&(e+=1e3),e}},{key:"isShadowed",get:function(){return null!=this.context.highlightedHex?this.context.highlightedHex!==this.tile:null!=this.context.populationAttempt&&(this.context.populationAttempt.sourceHex!==this.tile&&this.context.populationAttempt.targetHex!==this.tile)}}]),e}();function Qn(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.beginPath(),e.moveTo(t+r,n);for(var i=1;i<6;i++){var o=i/6*Math.PI*2;e.lineTo(t+Math.cos(o)*r,n+Math.sin(o)*r)}e.closePath(),a&&e.fill(),e.stroke()}Hn.easePulse=Ln.a;n(292),n(293);var Yn=function(e){var t=e.tile,n=e.camera,r=e.children,i=Tn(t,n),o=Object(U.a)(i,2),s=o[0],l=o[1],c={left:s+.3*n.scale,top:l};return a.a.createElement("div",{className:"overworld-popover",style:c},a.a.createElement("div",{className:"overworld-popover-positioner"},r))},Kn=function(e){function t(e,n){var r;Object(C.a)(this,t),(r=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n))).context=void 0,r.hexTileSprites=new Map,r.canvas=null,r.rafId=void 0,r.handleCanvasRef=function(e){r.canvas=e,null!=e&&r.handleResize()},r.handleCanvasClick=function(e){if(null!=r.state.populationAttempt||null!=r.state.highlightedHex)r.setState({populationAttempt:void 0,highlightedHex:void 0});else{var t=Mn(r.canvas,r.state.cameraState,e),n=Object(U.a)(r.context,1)[0].overWorld,a=n.hexAt(t.i,t.j);if(null!=a&&a.info.visible)if(null==a.info.flora){var i=a,o=n.possibleMigrationSources(a)[0];if(null!=o){var s={targetHex:i,sourceHex:o,settlingSpecies:o.info.flora.species};r.setState({populationAttempt:s,highlightedHex:void 0})}}else{var l=a;r.setState({highlightedHex:l,populationAttempt:void 0})}}},r.handleCanvasMouseLeave=function(){r.setState({hoveredHex:void 0})},r.handleCanvasMouseMove=function(e){var t=Mn(r.canvas,r.state.cameraState,e),n=r.context[0].overWorld.hexAt(t.i,t.j);r.setState({hoveredHex:n})},r.handleClickPlay=function(){var e=Object(U.a)(r.context,2)[1],t=r.getAppAction();t&&e({type:"AATransitionStart",transition:t})},r.handleKeyDown=function(e){if(!e.repeat){var t=Object(Q.a)({},r.state.pressedKeys,Object(L.a)({},e.code,!0));r.setState({pressedKeys:t})}},r.handleKeyUp=function(e){var t=Object(Q.a)({},r.state.pressedKeys);delete t[e.code],r.setState({pressedKeys:t})},r.handleWheel=function(e){var t=-(e.deltaX+e.deltaY)/125/10,n=Math.pow(2,t),a=r.state.cameraState.scale*n;r.setState({cameraState:Object(Q.a)({},r.state.cameraState,{scale:a})})},r.handleResize=function(){null!=r.canvas&&(r.canvas.width=window.innerWidth,r.canvas.height=window.innerHeight,r.updateCanvas())},r.updateCamera=function(){var e=Object(U.a)(r.context,1)[0].transition;if(null!=e&&"AAStartPopulationAttempt"===e.type){var t=e.populationAttempt.targetHex,n=r.state.cameraState,a=n.scale,i=n.dX,o=n.dY,s=1.02*a,l=Nn(t,a),c=Object(U.a)(l,2),h=c[0],d=c[1];r.setState({cameraState:{dX:Object(J.b)(i,h,.2),dY:Object(J.b)(o,d,.2),scale:s}})}var f=new u.Vector2;for(var v in r.state.pressedKeys)"KeyW"===v||"ArrowUp"===v?f.y+=20:"KeyS"===v||"ArrowDown"===v?f.y-=20:"KeyA"===v||"ArrowLeft"===v?f.x+=20:"KeyD"!==v&&"ArrowRight"!==v||(f.x-=20);if(f.setLength(20),0!==f.x||0!==f.y){var m=r.state.cameraState;r.setState({cameraState:Object(Q.a)({},m,{dX:m.dX+f.x,dY:m.dY+f.y})})}};var a=Object(U.a)(n,1)[0].overWorld,i=Nn(a.getStartHex(),96),o=Object(U.a)(i,2),s=o[0],l=o[1];r.state={cameraState:{scale:96,dX:s,dY:l},pressedKeys:{},frame:0};var c=!0,h=!1,d=void 0;try{for(var f,v=a[Symbol.iterator]();!(c=(f=v.next()).done);c=!0){var m=f.value,p=new Hn(m,Object(xn.a)(r));r.hexTileSprites.set(m,p)}}catch(y){h=!0,d=y}finally{try{c||null==v.return||v.return()}finally{if(h)throw d}}return r}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"populationAttempt",get:function(){return this.state.populationAttempt}},{key:"highlightedHex",get:function(){return this.state.highlightedHex}}]),Object(S.a)(t,[{key:"getAppAction",value:function(){if(null!=this.state.populationAttempt)return{type:"AAStartPopulationAttempt",populationAttempt:this.state.populationAttempt};if(null!=this.state.highlightedHex){var e=this.state.highlightedHex;return{type:"AAStartPopulationAttempt",populationAttempt:{sourceHex:e,targetHex:e,settlingSpecies:e.info.flora.species}}}}},{key:"updateCanvas",value:function(){if(null!=this.canvas){var e=this.canvas.getContext("2d");this.drawMap(e),this.drawMigrationArrows(e),this.drawPopulationAttempt(e)}}},{key:"drawMap",value:function(e){var t=this.state,n=t.hoveredHex,r=t.cameraState;e.clearRect(0,0,e.canvas.width,e.canvas.height),null!=n&&this.hexTileSprites.get(n).setIsHovered();var a=Array.from(this.hexTileSprites.values());a.sort((function(e,t){return e.zIndex-t.zIndex}));for(var i=0,o=a;i<o.length;i++){o[i].draw(e,r)}}},{key:"drawMigrationArrows",value:function(e){var t=this.state,n=t.hoveredHex,r=t.populationAttempt;null!=n&&null==r&&(null==n.info.flora?this.drawPossibleMigrationIntoArrows(e,n):this.drawPossibleMigrationOutOfArrows(e,n))}},{key:"drawPopulationAttempt",value:function(e){var t=this.state.populationAttempt;null!=t&&this.drawMigrationArrow(e,t.sourceHex,t.targetHex)}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),window.addEventListener("resize",this.handleResize),this.rafId=Cn.a.addAnimation(this.updateCamera)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("resize",this.handleResize),Cn.a.removeAnimation(this.rafId)}},{key:"componentDidUpdate",value:function(e){e.focusedHex!==this.props.focusedHex&&null!=this.props.focusedHex&&this.focusHex(this.props.focusedHex),this.updateCanvas()}},{key:"focusHex",value:function(e){var t=this,n=0;Cn.a.addAnimation((function(r){0===n&&(n=r);var a=r-n,i=Nn(e,t.state.cameraState.scale),o=Object(U.a)(i,2),s=o[0],l=o[1],c=.5*t.state.cameraState.dX+.5*s,u=.5*t.state.cameraState.dY+.5*l;return t.setState({cameraState:Object(Q.a)({},t.state.cameraState,{dX:c,dY:u})}),a>1e3||Math.abs(s-c)<.01&&Math.abs(l-u)<.01}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"overworld-map-container"},a.a.createElement("canvas",{tabIndex:-1,ref:this.handleCanvasRef,onClick:this.handleCanvasClick,onMouseLeave:this.handleCanvasMouseLeave,onMouseMove:this.handleCanvasMouseMove,onWheel:this.handleWheel}),this.maybeRenderPopover())}},{key:"drawPossibleMigrationIntoArrows",value:function(e,t){var n=Object(U.a)(this.context,1)[0].overWorld,r=!0,a=!1,i=void 0;try{for(var o,s=n.possibleMigrationSources(t)[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;this.drawMigrationArrow(e,l,t)}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}},{key:"drawPossibleMigrationOutOfArrows",value:function(e,t){var n=Object(U.a)(this.context,1)[0].overWorld,r=!0,a=!1,i=void 0;try{for(var o,s=n.possibleMigrationTargets(t)[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;this.drawMigrationArrow(e,t,l)}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}},{key:"drawMigrationArrow",value:function(e,t,n){var r=this,a=null!=r.highlightedHex||null!=r.populationAttempt&&(t!==r.populationAttempt.sourceHex||n!==r.populationAttempt.targetHex);e.globalAlpha=a?.2:1;var i=this.state.cameraState.scale;e.shadowBlur=3*i/48,e.shadowOffsetX=4*i/48,e.shadowOffsetY=4*i/48,e.shadowColor="black",e.strokeStyle="white",e.lineWidth=3*i/48,e.lineCap="round",e.lineJoin="round";var o=Object(jn.a)(u.Vector2,Object(H.a)(Tn(n,this.state.cameraState))),s=Object(jn.a)(u.Vector2,Object(H.a)(Tn(t,this.state.cameraState))),l=s.clone().lerp(o,.2),c=o.clone().lerp(s,.2);!function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10;e.beginPath();var o=r-t,s=a-n,l=Math.atan2(s,o);e.moveTo(t,n),e.lineTo(r,a),e.lineTo(r-i*Math.cos(l-Math.PI/6),a-i*Math.sin(l-Math.PI/6)),e.moveTo(r,a),e.lineTo(r-i*Math.cos(l+Math.PI/6),a-i*Math.sin(l+Math.PI/6)),e.stroke()}(e,l.x,l.y,c.x,c.y,10*i/48),e.shadowColor="transparent"}},{key:"maybeRenderPopover",value:function(){var e=this.state,t=e.cameraState,n=e.populationAttempt,r=e.highlightedHex;return null!=n?a.a.createElement(Yn,{camera:t,tile:n.targetHex},a.a.createElement(In,{playSpecies:n.settlingSpecies,tile:n.targetHex,onClickPlay:this.handleClickPlay})):null!=r?a.a.createElement(Yn,{camera:t,tile:r},a.a.createElement(In,{playSpecies:r.info.flora.species,tile:r,onClickPlay:this.handleClickPlay})):void 0}}]),t}(a.a.PureComponent);function Xn(e,t){return t(e),e}Kn.contextType=jt;var Zn=n(60),Jn=n(56),qn=n(179),_n=n(85),$n=function(e){var t=e.genome,n=xt(),r=Object(U.a)(n,2)[1],i=a.a.useCallback((function(){var e=new d.a("Cell "+(t.cellTypes.length+1),0,new h.a,{texturePosition:new u.Vector2(1,1),color:new u.Color(Math.random(),Math.random(),Math.random())},{type:"give",resources:"water and sugar"});t.cellTypes.push(e),r({type:"AAUpdateSpecies"})}),[r,t.cellTypes]);return a.a.createElement("div",{className:"add-cell-card"},a.a.createElement("div",{className:"add-cell",onClick:i},"Add Cell"),a.a.createElement("button",{onClick:i},a.a.createElement(_n.a,null)))},er=n(24),tr=n(178),nr=n(175),rr=n.n(nr);function ar(e){var t;return function(){return void 0===t&&(t=e()),t}}var ir=!1,or=ar((function(){return(new u.TextureLoader).load(rr.a,(function(e){e.magFilter=u.NearestFilter,e.flipY=!0,e.wrapS=e.wrapT=u.ClampToEdgeWrapping,or().dispatchEvent({type:"update"}),ir=!0}))})),sr={};function lr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"transparent";e=Math.floor(e),t=Math.floor(t);var r="".concat(e,",").concat(t);if(null==sr[r]){var a=function(){var r=or().image,a=i.getContext("2d");a.fillStyle=n,a.fillRect(0,0,32,32),a.drawImage(r,32*e,32*t,32,32,0,0,32,32),o.needsUpdate=!0},i=document.createElement("canvas");i.width=32,i.height=32;var o=new u.Texture(i);o.magFilter=u.NearestFilter,o.flipY=!0,o.wrapS=u.RepeatWrapping,o.wrapT=u.RepeatWrapping,ir?a():or().addEventListener("update",(function(){a()})),sr[r]=o}return sr[r]}n(294);var cr=n(19),ur=function(e){var t=e.children,n=e.className,r=Object(Ue.a)(e,["children","className"]);return a.a.createElement("div",Object.assign({className:Le()("action-bar-item",n)},r),t)},hr=function(e){var t=e.children,n=e.cellType,r=e.spritesheetLoaded,i=e.showCosts,o=void 0!==i&&i,s=Object(Ue.a)(e,["children","cellType","spritesheetLoaded","showCosts"]),l=n.material,c=n.chromosome.computeStaticProperties(),u=c.costSugar,h=c.costWater,d=c.timeToBuild,f=l.color&&l.color.getStyle()||"transparent",v=lr(l.texturePosition.x,l.texturePosition.y,f),m=a.a.useMemo((function(){var e=v.image,t=function(){if(null!=e){if(e instanceof HTMLCanvasElement&&r)return e.toDataURL();if(e instanceof Image)return e.src;throw new Error("image is"+e)}return""}();return{backgroundImage:"url(".concat(t,"), linear-gradient(").concat(f,", ").concat(f,")")}}),[f,r,v.image]),p=o?a.a.createElement("div",{className:"costs"},a.a.createElement("div",{className:"time-to-build-info"},d," sec"),a.a.createElement("div",{className:"cost-to-build-info"},h,a.a.createElement(cr.a,{name:"water"}),u,a.a.createElement(cr.a,{name:"sugar"}))):null;return a.a.createElement(ur,Object.assign({},s,{className:Le()("icon-cell",{reproducer:n.isReproducer()}),style:m}),t,p)},dr=a.a.memo((function(e){var t=e.interaction,n=e.setInteraction,r=a.a.useCallback((function(e){var t=e.target.value;n(null==t?void 0:vr[Number(t)])}),[n]),i=null==t?void 0:vr.findIndex((function(e){return t.resources===e.resources&&t.type===e.type})),o=a.a.createElement("select",{className:"interaction-select",onChange:r,defaultValue:String(i)},a.a.createElement("option",{value:void 0},"do nothing"),vr.map((function(e,t){return a.a.createElement("option",{key:t,value:t},Object(d.c)(e))})));return a.a.createElement("div",{className:"interaction-select-container"},"Left-click to ",o,".")})),fr=["water","sugar","water and sugar"],vr=["give","take"].flatMap((function(e){return fr.map((function(t){return{type:e,resources:t}}))}));vr.push({type:"give",resources:"water take sugar"},{type:"give",resources:"sugar take water"});n(295);function mr(e,t){return e.cellTypes.find((function(e){return e.name===t}))}n(296);var pr=function(e){var t=e.children,n=Object(r.useState)(!1),i=Object(U.a)(n,2),o=i[0],s=i[1],l=Object(r.useCallback)((function(){s((function(e){return!e}))}),[]),c=Object(r.useCallback)((function(){s(!1)}),[]),u=a.a.createElement("div",{className:"more-options"},t,a.a.createElement("button",{onClick:c},"Back"));return a.a.createElement(Y.b,{isOpen:o,position:"right",transitionDuration:100,content:u,popoverClassName:"more-options-popover"},a.a.createElement(_n.c,{className:"more-options-icon",onClick:l}))};n(297);function yr(e){var t=e.cost,n=e.className,r=Object(Ue.a)(e,["cost","className"]);return a.a.createElement("span",Object.assign({},r,{className:Le()("gene-cost",n,{negative:t<0})}),t<0?"+":null,a.a.createElement(On.a,{value:Math.abs(t),speed:.5}))}n(298);var gr=function(e){var t,n=e.upkeep;return t=n%1===0&&n<=3?a.a.createElement(a.a.Fragment,null,q(n).map((function(e){return a.a.createElement(kn.b,{key:e})}))):a.a.createElement(a.a.Fragment,null,Object(er.a)(100*n*N.k,3),"% ",a.a.createElement(kn.b,null),"/day"),a.a.createElement("div",{className:"energy-upkeep"},t)},br=function(e){var t=e.index,n=e.gene,r=e.draggable,i=void 0===r||r,o=e.view,s=void 0===o?"expanded":o,l=e.invalid,c=void 0!==l&&l,u=n.gene,h=n.getCost(),d=n.getStaticProperties().energyUpkeep?a.a.createElement(gr,{upkeep:n.getStaticProperties().energyUpkeep}):null,f=n.level>0?a.a.createElement("div",{className:"gene-level"},q(n.level).map((function(e){return a.a.createElement(a.a.Fragment,{key:e},"\u2b25")}))):null,v=n.getStaticProperties().isReproductive;return a.a.createElement(Zn.b,{key:n.uuid,draggableId:"draggable-".concat(n.uuid),index:t,isDragDisabled:!i},(function(e,t,r){return a.a.createElement("div",Object.assign({ref:e.innerRef},e.draggableProps,e.dragHandleProps,{className:Le()("gene",s,u.blueprint.name.replace(" ",""),{draggable:i,invalid:c,reproducer:v,provider:h<0})}),a.a.createElement("div",{className:"gene-header"},a.a.createElement(yr,{cost:h}),a.a.createElement("h4",null,u.blueprint.name," ",f),d),a.a.createElement("div",{className:"description"},u.blueprint.description(n.getProps(),n.getStaticProperties())))}))},wr=a.a.createContext({view:"expanded",editable:!1,isDragging:!1,species:null}),Er=function(e){var t=e.genome,n=e.cellType,r=e.editable,i=void 0!==r&&r,o=n.name,s=a.a.useCallback((function(e){n.interaction=e}),[n.interaction]),l=n.isReproducer();return a.a.createElement("div",{className:Le()("cell-type",{reproducer:l})},a.a.createElement("div",{className:"cell-header"},a.a.createElement("h2",null,o),i?a.a.createElement(Ar,{cellType:n,genome:t}):null),a.a.createElement(Or,{cellType:n}),a.a.createElement("div",{className:"cell-footer"},a.a.createElement(kr,{cellType:n}),a.a.createElement(dr,{interaction:n.interaction,setInteraction:s}),a.a.createElement(hr,{cellType:n,spritesheetLoaded:ir,showCosts:!0})))},kr=function(e){var t=e.cellType,n=t.chromosome,r=t.getChanceToBecomeCancerous(),i=r>0?a.a.createElement("div",{className:"chance-to-cancer"},"Cell may become cancerous: ",Object(er.a)(100*r*N.k,3),"% per day."):void 0,o=n.geneSlotsNet()<0,s=a.a.createElement(a.a.Fragment,null,"Once you go over on your gene slots, negative effects will start accruing on your cell.",i);return a.a.createElement(Y.g,{content:s,position:"top",popoverClassName:"gene-slots-popover",hoverOpenDelay:250},a.a.createElement("div",{className:"gene-slots"},"Gene Slots:"," ",a.a.createElement("span",{className:Le()("slots-used",{"is-over":o})},a.a.createElement(On.a,{value:Math.abs(n.geneSlotsNet())})," ",o?"over":"under",".")))},Or=function(e){var t,n=e.cellType,i=Object(r.useContext)(wr),o=i.editable,s=i.view,l=i.isDragging,c=n.chromosome.genes,u=0===c.length,h=n.getDuplicateGenes(),d=h.size>0?a.a.createElement("div",{className:"invalid-alert-text"},"Cannot have duplicate genes."):null;return a.a.createElement(Zn.c,{key:n.name,droppableId:(t=n,t.name)},(function(e,t){return a.a.createElement("div",Object.assign({},e.droppableProps,{ref:e.innerRef,className:Le()("chromosome",{dragging:l,empty:u,invalid:h.size>0})}),d,c.map((function(e,t){return a.a.createElement(br,{index:t,key:e.uuid,gene:e,draggable:o,view:s,invalid:h.has(e)})})),e.placeholder)}))},Ar=function(e){var t=e.cellType,n=e.genome,i=xt(),o=Object(U.a)(i,2)[1],s=Object(r.useCallback)((function(){var e=n.cellTypes.indexOf(t);n.cellTypes.splice(e,1),o({type:"AAUpdateSpecies"})}),[t,o,n.cellTypes]),l=t.chromosome.isEmpty();return a.a.createElement(pr,null,a.a.createElement("button",{onClick:s,className:"delete",disabled:!l},a.a.createElement(tr.a,null),l?"Delete":"Delete (Remove all genes first)"))},jr=(n(302),function(e){var t=e.genome,n=a.a.useContext(wr).editable;return a.a.createElement("div",{className:"genome-viewer"},t.cellTypes.map((function(e){return a.a.createElement(Er,{key:e.name,cellType:e,editable:n,genome:t})})),n?a.a.createElement($n,{genome:t}):null)});n(303);var xr=function(e,t,n,r){if(null!=e.destination&&"gene-options"!==e.destination.droppableId){Ve.l.play();var a=e.source.index,i=e.destination,o=i.index,s=i.droppableId;r({type:"AAUpdateSpecies",species:Object(at.a)(n,(function(t){var n,r=!1;if("gene-options"===e.source.droppableId)n=t.geneOptions[a],t.freeMutationPoints-=1,t.freeMutationPoints>0?r=!0:t.geneOptions=[];else if("genes-unused"===e.source.droppableId)n=t.genome.unusedGenes.splice(a,1)[0];else{var i=mr(t.genome,e.source.droppableId);n=null===i||void 0===i?void 0:i.chromosome.genes.splice(a,1)[0]}if(null!=n)if("trash"===s);else if("genes-unused"===s)t.genome.unusedGenes.splice(o,0,n);else{var l=mr(t.genome,s);null===l||void 0===l||l.chromosome.genes.splice(o,0,n)}r&&(t.geneOptions=At(0,!1))}))})}},Cr=function(e){var t=e.speciesId,n=e.editable,i=void 0!==n&&n,o=Object(r.useState)(!1),s=Object(U.a)(o,2),l=s[0],c=s[1],u=a.a.useState("small"),h=Object(U.a)(u,2),d=h[0],f=h[1],v=xt(),m=Object(U.a)(v,2),p=m[0],y=m[1],g=Oe(p.rootSpecies).find((function(e){return e.id===t})),b=a.a.useMemo((function(){return{species:g,view:d,editable:i,isDragging:l}}),[i,l,g,d]),w=Object(r.useCallback)((function(e,t){console.log("onDragEnd",e,t),c(!1),xr(e,t,g,y)}),[y,g]),E=Object(r.useCallback)((function(e){c(!0),Ve.m.play()}),[]),k=Object(r.useCallback)((function(){f("small")}),[]),O=Object(r.useCallback)((function(){f("expanded")}),[]);return a.a.createElement(Zn.a,{onDragEnd:w,onBeforeCapture:E},a.a.createElement(wr.Provider,{value:b},a.a.createElement("div",{className:"species-viewer"},a.a.createElement("div",{className:"species-name"},g.name),a.a.createElement("div",{className:"view-switcher"},a.a.createElement(qn.a,{onClick:k,className:Le()({active:"small"===d})}),a.a.createElement(Jn.b,{onClick:O,className:Le()({active:"expanded"===d})})),g.freeMutationPoints>0&&i?a.a.createElement(Sr,{species:g}):null,l?a.a.createElement(Pr,null):null,a.a.createElement(jr,{genome:g.genome}),i||g.genome.unusedGenes.length>0?a.a.createElement(Mr,{genes:g.genome.unusedGenes}):null)))},Sr=function(e){var t=e.species,n=t.freeMutationPoints,r=t.geneOptions;return a.a.createElement("div",{className:"mutation-chooser"},a.a.createElement("h1",null,"Choose one Mutation"," ",n>1?a.a.createElement("small",null,a.a.createElement(We.a,{amount:n-1})," more remaining"):null),a.a.createElement("p",null,"Drag and Drop into your cell"),a.a.createElement(Zn.c,{droppableId:"gene-options",isDropDisabled:!0,direction:"horizontal"},(function(e,t){return a.a.createElement("div",Object.assign({className:"gene-options",ref:e.innerRef},e.droppableProps),r.map((function(e,t){return a.a.createElement(br,{index:t,key:e.uuid,gene:e,draggable:!0,view:"expanded"})})),e.placeholder)})))},Pr=function(){return a.a.createElement(Zn.c,{droppableId:"trash"},(function(e,t){return a.a.createElement("div",Object.assign({},e.droppableProps,{ref:e.innerRef,className:Le()("trash",{hovered:t.isDraggingOver,foo:Xn(t,console.log)})}),a.a.createElement(Jn.d,null),e.placeholder)}))},Mr=function(e){var t=e.genes,n=a.a.useContext(wr),r=n.isDragging,i=n.view,o=n.editable;return a.a.createElement("div",{className:"unused-genes"},a.a.createElement("h2",null,"Unused ",t.length,"/5"),a.a.createElement(Zn.c,{droppableId:"genes-unused",direction:"horizontal",isDropDisabled:t.length>=5},(function(e,n){return a.a.createElement("div",Object.assign({},e.droppableProps,{ref:e.innerRef,className:Le()("unused-genes-droppable",{dragging:r})}),t.map((function(e,t){return a.a.createElement(br,{index:t,key:e.uuid,gene:e,draggable:o,view:i})})),e.placeholder)})))},Tr=Cr,Nr=(n(304),a.a.memo((function(e){var t=e.onNextEpoch;Object(r.useEffect)((function(){return Ve.r.play(),function(){Ve.r.stop()}}),[]);var n=Object(r.useState)(!1),i=Object(U.a)(n,2),o=i[0],s=i[1];Object(r.useEffect)((function(){function e(e){"Tab"===e.code&&(s((function(e){return!e})),e.preventDefault())}return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[]);var l=Object(r.useState)(),c=Object(U.a)(l,2),u=c[0],h=c[1],d=Object(r.useCallback)((function(e){h(e.id)}),[]),f=xt(),v=Object(U.a)(f,1)[0],m=v.rootSpecies,p=v.epoch,y=Object(r.useRef)(p);Object(r.useEffect)((function(){p!==y.current&&P(4500).then((function(){var e=Oe(m).filter((function(e){return e.freeMutationPoints>0}));h(e[0].id)}))}),[p]);var g=Object(r.useCallback)((function(){h(void 0)}),[]),b=a.a.createElement(Y.a,{isOpen:null!=u,onClose:g},a.a.createElement("div",{className:"species-viewer-modal"},a.a.createElement("button",{className:"close",onClick:g},"\u2716"),a.a.createElement(Tr,{speciesId:u,editable:!0}))),w=Object(r.useState)(void 0),E=Object(U.a)(w,2),k=E[0],O=E[1],A=Object(r.useCallback)((function(e){O(e)}),[]),j=xt(),x=Object(U.a)(j,1)[0];return a.a.createElement("div",{className:"overworld-screen"},a.a.createElement(Kn,{focusedHex:k}),function(){var e=Oe(m).map((function(e){return e.freeMutationPoints})).reduce((function(e,t){return e+t})),t=e>0?a.a.createElement("div",{className:"unused-points"},e):null;return a.a.createElement("div",{className:Le()("panel-left",{open:o})},o?a.a.createElement(En,{onMutate:d}):null,a.a.createElement("button",{className:"panel-left-handle",onClick:function(){return s((function(e){return!e}))}},a.a.createElement(kn.c,{className:"icon"}),t))}(),b,a.a.createElement(An,{onNextEpoch:t,onFocusHex:A}),a.a.createElement("div",{style:{position:"absolute",right:"10px",top:"10px"}},a.a.createElement(bn,{onClick:function(){return pn(x)}},"Save")),a.a.createElement("div",{style:{position:"absolute",right:"10px",top:"60px"}},a.a.createElement(bn,{onClick:function(){return window.confirm("Are you sure you want to reset your whole game?")?mn.a.removeItem("gameData").then((function(){window.location.reload()})):Promise.reject()}},"Reset Game")))}))),Rr=n(343),Fr=n(100);function Dr(e){return function(t,n){return"AATransitionEnd"===n.type?function(t,n){var r=t.transition,a=Object(Ue.a)(t,["transition"]);return r?e(a,r):(Object(ne.a)("handled transition end with no transition specified!"),t)}(t):e(t,n)}}function Br(e){var t=e.children,n=e.appState,r=a.a.useMemo((function(){return Dr((e=Ct,function(t,n){var r=e(t,n);return gn.hasOwnProperty(n.type)&&(console.log("saved from",n),pn(r)),r}));var e}),[]),i=a.a.useReducer(r,n),o=Object(U.a)(i,2),s=o[0],l=o[1],c=a.a.useMemo((function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,n=function(n){e(n),"AATransitionStart"===n.type&&P(t).then((function(){e({type:"AATransitionEnd"})}))};return n}(l)}),[]),u=a.a.useMemo((function(){return[s,c]}),[s,c]);return a.a.createElement(jt.Provider,{value:u},t)}var Ir=function(e){var t=e.children,n=e.loadingComponent,i=void 0===n?null:n,o=a.a.useState(null),s=Object(U.a)(o,2),l=s[0],c=s[1];return Object(r.useEffect)((function(){(function(){return yn.apply(this,arguments)})().then((function(e){c(e),console.log("loading",e)})).catch((function(){var e=function(){var e=hn.generateRectangle(100,50),t=ke("plantum originus"),n=e.getStartHex();return{overWorld:e,rootSpecies:t,activePopulationAttempt:{settlingSpecies:t,targetHex:n},epoch:0}}();console.log("couldn't load appState from localForage; resetting game",e),c(e)}))}),[]),null==l?i:a.a.createElement(Br,{appState:l},t)};n(305);var zr=n(41),Gr=n(338),Lr=function e(t){var n=this;Object(C.a)(this,e),this.position=new u.Vector2,this.isPressed=!1,this.button=-1,this.handleMouseDown=function(e){n.isPressed=!0,n.button=e.button,n.handleMouseMove(e)},this.handleMouseMove=function(e){n.position.x=e.clientX,n.position.y=e.clientY},this.handleMouseUp=function(e){n.isPressed=!1,n.button=-1,n.handleMouseMove(e)},t.addEventListener("mousedown",this.handleMouseDown),t.addEventListener("mousemove",this.handleMouseMove),t.addEventListener("mouseup",this.handleMouseUp)},Wr={click:!0,contextmenu:!0,dblclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,touchstart:!0,touchmove:!0,touchend:!0,keyup:!0,keydown:!0,keypress:!0,wheel:!0},Vr=function(){function e(t,n){Object(C.a)(this,e),this.renderer=t,this.audioContext=n,this.elements=void 0,this.events=void 0,this.timeElapsed=0,this.frameCount=0}return Object(S.a)(e,[{key:"aspectRatio",get:function(){return this.renderer.domElement.height/this.renderer.domElement.width}},{key:"resolution",get:function(){return new u.Vector2(this.renderer.domElement.width,this.renderer.domElement.height)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),e}();Vr.id=void 0;var Ur=n(180),Hr=n.n(Ur),Qr=function e(t,n,r){Object(C.a)(this,e),this.target=t,this.scene=n,this.mito=r},Yr=n(86),Kr=function(e){return e[0]};function Xr(){var e=Object(Yr.a)(["\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\nvarying float vRotation;\nvarying float vAlpha;\n\n#ifdef USE_MAP\n  uniform mat3 uvTransform;\n  uniform sampler2D map;\n#endif\n\nvec2 rotateAround ( in vec2 v, in vec2 center, in float angle ) {\n\n  float c = cos( angle );\n  float s = sin( angle );\n\n  float x = v.x - center.x;\n  float y = v.y - center.y;\n\n  vec2 r = vec2(x * c - y * s + center.x, x * s + y * c + center.y);\n\n  return r;\n}\n\nfloat zeroToOne(float x) {\n    return step(0., x) * (1. - step(1., x));\n}\n\nfloat inSquare(vec2 v) {\n  float xMult = zeroToOne(v.x);\n  float yMult = zeroToOne(v.y);\n  return xMult * yMult;\n}\n\nvoid main() {\n  gl_FragColor = vec4( color, 1. );\n  float alpha = vAlpha;\n\n  #ifdef USE_MAP\n    vec2 uv = gl_PointCoord;\n\n    // flip vRotation to account for flipped y viewport\n    uv = rotateAround(uv, vec2(0.5), -vRotation); //, vec2(0.), vec2(1.));\n\n    // if we're out of the UV clamped edge, set alpha to 0\n    alpha *= inSquare(uv);\n\n    vec4 mapTexel = texture2D( map, uv );\n    gl_FragColor *= mapTexelToLinear( mapTexel );\n  #endif\n  gl_FragColor.a *= opacity * alpha;\n}\n"]);return Xr=function(){return e},e}function Zr(){var e=Object(Yr.a)(["\nattribute float size;\nattribute float rotation;\nattribute float alpha;\nuniform float sizeGlobal;\n\nvarying float vAlpha;\nvarying float vRotation;\n\nvoid main() {\n  vRotation = rotation;\n  vAlpha = alpha;\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n  gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n  gl_Position = projectionMatrix * mvPosition;\n}\n"]);return Zr=function(){return e},e}var Jr=function(e){function t(e,n){var r;return Object(C.a)(this,t),(r=Object(yt.a)(this,Object(gt.a)(t).call(this))).params=n,r.geometry=void 0,r.material=void 0,r.index=0,r.geometry=t.newGeometry(e),r.material=new qr(n),r.frustumCulled=!1,r}return Object(bt.a)(t,e),Object(S.a)(t,null,[{key:"newGeometry",value:function(e){var t=new u.BufferGeometry,n=new Float32Array(3*e),r=new Float32Array(e),a=new Float32Array(e),i=new Float32Array(e);return t.setAttribute("position",new u.BufferAttribute(n,3).setUsage(u.DynamicDrawUsage)),t.setAttribute("rotation",new u.BufferAttribute(r,1).setUsage(u.DynamicDrawUsage)),t.setAttribute("size",new u.BufferAttribute(a,1).setUsage(u.DynamicDrawUsage)),t.setAttribute("alpha",new u.BufferAttribute(i,1).setUsage(u.DynamicDrawUsage)),t}}]),Object(S.a)(t,[{key:"startFrame",value:function(){this.index=0}},{key:"commit",value:function(e,t,n,r,a,i){this.geometry.attributes.position.setXYZ(this.index,e,t,n),this.geometry.attributes.size.setX(this.index,r),this.geometry.attributes.alpha.setX(this.index,a),null!=i&&this.geometry.attributes.rotation.setX(this.index,i),this.index++}},{key:"endFrame",value:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.attributes.rotation.needsUpdate=!0,this.geometry.attributes.alpha.needsUpdate=!0,this.geometry.setDrawRange(0,this.index)}}]),t}(u.Points),qr=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(yt.a)(this,Object(gt.a)(t).call(this,{uniforms:{opacity:{value:e.opacity},sizeGlobal:{value:e.size},color:{value:e.color},map:{value:e.map}},vertexShader:_r,fragmentShader:$r,depthTest:!1,transparent:!0}))).params=e,n.map=void 0,n.map=e.map,n}return Object(bt.a)(t,e),t}(u.ShaderMaterial),_r=Kr(Zr()),$r=Kr(Xr()),ea=function(e){function t(e,n){var r;return Object(C.a)(this,t),(r=Object(yt.a)(this,Object(gt.a)(t).call(this,1e4,n))).lifeFn=e,r.state=new Set,r}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"fire",value:function(e){this.state.add(e)}},{key:"update",value:function(e){var t=[],n=!0,r=!1,a=void 0;try{for(var i,o=this.state[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;s.time+=e,!1===this.lifeFn(s,e)&&t.push(s)}}catch(h){r=!0,a=h}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}for(var l=0,c=t;l<c.length;l++){var u=c[l];this.state.delete(u)}}},{key:"commitAll",value:function(){this.startFrame();var e=!0,t=!1,n=void 0;try{for(var r,a=this.state[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;this.commit(i.x,i.y,i.z,i.size,i.alpha,i.r)}}catch(o){t=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}this.endFrame()}}]),t}(Jr),ta=n(55),na=function(e){function t(e,n){var r;return Object(C.a)(this,t),(r=Object(yt.a)(this,Object(gt.a)(t).call(this,[],n.scene,n.mito))).eventName=e,r.worldRenderer=n,r}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){this.target=this.worldRenderer.target.getLastStepStats().events[this.eventName]}}]),t}(Qr),ra=function(e){function t(e,n,r){var a;return Object(C.a)(this,t),(a=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n))).eventName=e,a.worldRenderer=n,a.ffPoints=r,a.scene.add(a.ffPoints),a}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){Object(ta.a)(Object(gt.a)(t.prototype),"update",this).call(this),this.ffPoints.update(1/30);var e=!0,n=!1,r=void 0;try{for(var a,i=this.target[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;this.handle(o)}}catch(s){n=!0,r=s}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}this.ffPoints.commitAll()}},{key:"destroy",value:function(){this.scene.remove(this.ffPoints)}}]),t}(na),aa=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(yt.a)(this,Object(gt.a)(t).call(this,"cell-eat",e,t.makePoints()))).audio=function(){var e=new u.Audio(n.mito.audioListener);return e.loop=!0,e.setVolume(0),Ve.i.then((function(t){e.setBuffer(t),e.play(),e.setDetune(600)})),e}(),n}return Object(bt.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new ea((function(e){if(e.time>.6)return!1;var t=e.time/.6;e.size=4*(t-t*t)}),{color:new u.Color("yellow"),opacity:.8,size:200,map:lr(1,3,"transparent")})}}]),Object(S.a)(t,[{key:"handle",value:function(e){var t,n,r,a=e.who,i=.04*Object(Ve.e)(a,this.mito.world.player);i>this.audio.gain.gain.value&&(this.audio.gain.gain.setValueAtTime(i,0),this.audio.gain.gain.cancelScheduledValues(this.audio.context.currentTime+1),this.audio.gain.gain.setTargetAtTime(0,this.audio.context.currentTime+1,.1));var o=this.worldRenderer.renderers.get(a),s=null===o||void 0===o?void 0:null===(t=o.inventoryRenderer)||void 0===t?void 0:t.getActiveSugar(),l=null!==(n=null===s||void 0===s?void 0:s.x)&&void 0!==n?n:0,c=null!==(r=null===s||void 0===s?void 0:s.y)&&void 0!==r?r:0;this.ffPoints.fire({x:a.pos.x+l,y:a.pos.y+c,z:1,size:1,alpha:1,info:e,time:0})}}]),t}(ra),ia=function(e){function t(e){return Object(C.a)(this,t),Object(yt.a)(this,Object(gt.a)(t).call(this,"cell-transfer-energy",e,t.makePoints()))}return Object(bt.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new ea((function(e){if(e.time>.5)return!1;var t=e.time/.5,n=4*(t-t*t),r=e.info,a=r.from,i=r.to,o=a.pos.clone().lerp(i.pos,Object(J.d)(t,0,1,.45,.55)),s=o.x,l=o.y;e.x=s,e.y=l,e.size=n}),{color:new u.Color("yellow"),opacity:.8,size:350,map:lr(2,3,"transparent")})}}]),Object(S.a)(t,[{key:"handle",value:function(e){var t=e.from,n=e.to,r=Math.atan2(n.pos.y-t.pos.y,n.pos.x-t.pos.x);this.ffPoints.fire({x:e.from.pos.x,y:e.from.pos.y,r:r,z:1,size:.1,alpha:1,info:e,time:0})}}]),t}(ra);function oa(e){return function(t){return e(1-t)}}function sa(e){return 4*(e-e*e)}var la=oa((function(e){return Object(J.a)(6.75*(e*e-e*e*e),0,1)})),ca=function(e){function t(e){var n;Object(C.a)(this,t),(n=Object(yt.a)(this,Object(gt.a)(t).call(this,"collect-sunlight",e))).ffPoints=void 0;return n.ffPoints=new ea((function(e){if(e.time>.5)return!1;var t=Object(J.a)(e.time/.5,0,1);e.alpha=la(t),e.size=la(t)}),{color:new u.Color("white"),opacity:.8,size:35,map:lr(0,4)}),n.scene.add(n.ffPoints),n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"handle",value:function(e){for(var t=e.numSunlight,n=e.leaf,r=e.point;t>0;){if(t<1&&t<Math.random())return;var a=null==r?n.pos.x+.05*(Math.random()-.5):r.x+Object(J.f)(-.1,.1),i=null==r?n.pos.y+.05*(Math.random()-.5):r.y+Object(J.f)(-.1,.1),o=this.worldRenderer.renderers.get(n);if(o){var s,l,c=o.inventoryRenderer?Object(J.e)(o.inventoryRenderer.waters):void 0;a+=null!==(s=null===c||void 0===c?void 0:c.x)&&void 0!==s?s:0,i+=null!==(l=null===c||void 0===c?void 0:c.y)&&void 0!==l?l:0}this.ffPoints.fire({x:a,y:i,z:10,size:0,alpha:0,info:0,time:0}),t--}}},{key:"update",value:function(){Object(ta.a)(Object(gt.a)(t.prototype),"update",this).call(this),this.ffPoints.update(1/30);var e=!0,n=!1,r=void 0;try{for(var a,i=this.target[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;this.handle(o)}}catch(s){n=!0,r=s}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}this.ffPoints.commitAll()}},{key:"destroy",value:function(){this.scene.remove(this.ffPoints)}}]),t}(na),ua=1,ha=45,da=.003,fa={color:new u.Color("rgb(9, 12, 255)"),size:ha,opacity:.75},va={color:new u.Color("yellow"),size:85,opacity:.9,map:lr(2,2,"transparent")},ma=function(){function e(){Object(C.a)(this,e),this.waters=new Jr(1e4,fa),this.sugars=new Jr(1e4,va)}return Object(S.a)(e,[{key:"startFrame",value:function(){this.waters.startFrame(),this.sugars.startFrame()}},{key:"endFrame",value:function(){this.waters.endFrame(),this.sugars.endFrame()}}]),e}(),pa=function(e){function t(e,n,r,a){var i;return Object(C.a)(this,t),(i=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n,r))).particlePoints=a,i.animationOffset=0,i.waters=[],i.sugars=[],i.activeSugar=void 0,i.stableWater=void 0,i.handleGetResources=function(e){i.updateSugarAndWaterParticles(e)},i.handleGiveResources=function(){i.updateSugarAndWaterParticles()},i.handleAddResources=function(e,t){i.updateSugarAndWaterParticles()},e.on("get",i.handleGetResources),e.on("give",i.handleGiveResources),e.on("add",i.handleAddResources),i.updateSugarAndWaterParticles(),i}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"getCarrierPos",value:function(){return this.target.carrier.pos}},{key:"verifyArrayLengths",value:function(){if(this.waters.length!==Math.ceil(this.target.water*ua))throw new Error("water array lengths mismatch: "+this.waters.length+" should be "+Math.ceil(this.target.water));if(this.sugars.length!==Math.ceil(this.target.sugar))throw new Error("sugar array lengths mismatch: "+this.sugars.length+" should be "+Math.ceil(this.target.sugar))}},{key:"updateSugarAndWaterParticles",value:function(e){this.updateParticlesArray(this.waters,this.target.water*ua,e),this.updateParticlesArray(this.sugars,this.target.sugar,e),this.verifyArrayLengths()}},{key:"updateParticlesArray",value:function(e,t,n){for(var r=Math.ceil(t);e.length<r;){var a=null!=n?n.carrier.pos.clone().sub(this.getCarrierPos()):new u.Vector2(.01*(Math.random()-.5),.01*(Math.random()-.5));a.x+=.1*(Math.random()-.5),a.y+=.1*(Math.random()-.5),e.push(a)}if(e.length>r&&e.splice(r),e.length!==r)throw new Error("array lengths mismatch: "+e.length+" should be "+r);return e}},{key:"commitParticles",value:function(e,t,n){for(var r=Math.floor(t),a=0;a<r;a++){var i=n[a];e.commit(i.x+this.getCarrierPos().x,i.y+this.getCarrierPos().y,10,1,1)}var o=t-r;if(o>0){var s=n[n.length-1];e.commit(s.x+this.getCarrierPos().x,s.y+this.getCarrierPos().y,10,Object(J.d)(Math.sqrt(o),0,1,.2,1),1)}}},{key:"simulateResourcePositions",value:function(){for(var e=this.waters.length,t=e+this.sugars.length,n=0;n<t;n++){var r=n<e?this.waters[n]:this.sugars[n-e],a=0,i=0,o=Cn.a.now/3e3+this.animationOffset;a+=.02*Math.cos(o);var s=.1+.1*r.length();a+=-r.x*s,i+=-r.y*s;var l=this.mito.world.player;if(l.pos.equals(this.target.carrier.pos)){var c=l.posFloat.x-l.pos.x,u=l.posFloat.y-l.pos.y,h=r.x-c,d=r.y-u,f=h*h+d*d,v=Math.max(Math.min(Object(J.d)(f,0,1,3,-5),3),0);a+=h*v*.2,i+=d*v*.2}for(var m=0;m<t;m++){var p=m<e?this.waters[m]:this.sugars[m-e];if(r===p)break;var y=r.x-p.x,g=r.y-p.y,b=y*y+g*g;if(b>0){var w=m<e?this.target.water%1:this.target.sugar%1,E=da/b;(m===e||m===t)&&0!==w&&(E*=w),a+=y*E,i+=g*E}}r.x+=a,r.y+=i}}},{key:"update",value:function(){this.simulateResourcePositions(),this.commitParticles(this.particlePoints.waters,this.target.water*ua,this.waters),this.commitParticles(this.particlePoints.sugars,this.target.sugar,this.sugars),this.activeSugar=this.sugars[this.sugars.length-1],this.stableWater=this.waters[0]}},{key:"destroy",value:function(){this.target.off("get",this.handleGetResources),this.target.off("give",this.handleGiveResources),this.target.off("add",this.handleAddResources)}},{key:"getActiveSugar",value:function(){return this.activeSugar}},{key:"getStableWater",value:function(){return this.stableWater}}]),t}(Qr);var ya=function(e){function t(e){return Object(C.a)(this,t),Object(yt.a)(this,Object(gt.a)(t).call(this,"evaporation",e,t.makePoints()))}return Object(bt.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new ea((function(e){if(e.time>1.5)return!1;var t=e.time/1.5,n=1+t,r=1-t;e.x+=.01*Math.sin(12*t),e.y-=.01,e.alpha=r,e.size=n}),Object(Q.a)({},fa))}}]),Object(S.a)(t,[{key:"handle",value:function(e){var t,n,r;if(!(e.tile.darkness>=1)){var a=this.worldRenderer.renderers.get(e.tile),i=null===a||void 0===a?void 0:null===(t=a.inventoryRenderer)||void 0===t?void 0:t.getStableWater(),o=null!==(n=null===i||void 0===i?void 0:i.x)&&void 0!==n?n:0,s=null!==(r=null===i||void 0===i?void 0:i.y)&&void 0!==r?r:0;this.ffPoints.fire({x:e.tile.pos.x+o,y:e.tile.pos.y+s,z:1,size:1,alpha:1,info:e,time:0})}}}]),t}(ra),ga=n(337),ba=function(e){function t(e){return Object(C.a)(this,t),Object(yt.a)(this,Object(gt.a)(t).call(this,"grow-fruit",e,t.makePoints()))}return Object(bt.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new ea((function(e){if(e.time>1.2)return!1;var t=e.time/1.2,n=e.info,r=n.cell,a=n.a0,i=Object(J.d)(Object(ga.a)(t),0,1,.7,.2),o=Object(J.d)(function(e){return(e=Object(J.a)(e,0,1))*e*(3-2*e)}(t),0,1,0,0*Math.PI)+a,s=Math.sqrt(sa(t));e.x=r.pos.x+Math.cos(o)*i,e.y=r.pos.y+Math.sin(o)*i,e.size=s,e.r=o}),{size:80,opacity:1,color:new u.Color("white"),map:lr(0,5)})}}]),Object(S.a)(t,[{key:"handle",value:function(e){var t=e.cell;this.ffPoints.fire({x:t.pos.x,y:t.pos.y,z:1,alpha:1,info:Object(Q.a)({},e,{a0:Math.random()*Math.PI*2}),size:0,time:0})}}]),t}(ra),wa=function(e){function t(e){return Object(C.a)(this,t),Object(yt.a)(this,Object(gt.a)(t).call(this,"photosynthesis",e,t.makePoints()))}return Object(bt.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new ea((function(e){if(e.time>.5)return!1;var t=e.time/.5;e.alpha=Math.pow(sa(t),.25),e.size=Math.pow(1-t,1)/2*2*e.info.sugarMade,e.r=t*e.time}),{color:new u.Color("yellow"),opacity:.95,size:200,map:lr(3,3)})}}]),Object(S.a)(t,[{key:"handle",value:function(e){var t,n,r,a=this.worldRenderer.renderers.get(e.cell),i=null===a||void 0===a?void 0:null===(t=a.inventoryRenderer)||void 0===t?void 0:t.getStableWater(),o=null!==(n=null===i||void 0===i?void 0:i.x)&&void 0!==n?n:0,s=null!==(r=null===i||void 0===i?void 0:i.y)&&void 0!==r?r:0;this.ffPoints.fire({x:e.cell.pos.x+o,y:e.cell.pos.y+s,z:1,size:1,alpha:1,info:e,time:0})}}]),t}(ra),Ea=n(58),ka=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(a)))).renderers=[],n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e;for(e=0;e<this.target.effects.length;e++){var t=this.target.effects[e],n=this.renderers[e];null==n?this.renderers[e]=Oa(t,this.scene,this.mito):t!==n.target&&(n.destroy(),this.renderers[e]=Oa(t,this.scene,this.mito))}for(;e<this.renderers.length;e++){this.renderers[e].destroy()}var r=!0,a=!1,i=void 0;try{for(var o,s=this.renderers[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value.update()}}catch(l){a=!0,i=l}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}},{key:"destroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.renderers[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.destroy()}}catch(i){t=!0,n=i}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}}]),t}(Qr);function Oa(e,t,n){if(e instanceof c.e)return new ja(e,t,n);if(e instanceof Ea.a)return new xa(e,t,n);throw new Error("effect renderer not defined for"+e)}var Aa=new u.Color("lightblue"),ja=function(e){function t(e,n,r){var a;return Object(C.a)(this,t),(a=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n,r))).mesh=void 0,a.mesh=t.newMesh(),n.add(a.mesh),a.mesh.scale.set(.01,.01,1),a}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target.percentFrozen,t=Math.pow(e,.5);this.mesh.scale.x=Object(J.b)(this.mesh.scale.x,t,.2),this.mesh.scale.y=Object(J.b)(this.mesh.scale.y,t,.2);var n=this.target.cell,r=n.pos;this.mesh.position.set(r.x,r.y+n.droopY,2)}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(Qr);ja.newMesh=function(){var e=new u.PlaneBufferGeometry(1,1),t=new u.MeshBasicMaterial({map:lr(1,2),side:u.DoubleSide,color:Aa,transparent:!0,opacity:.5}),n=new u.Mesh(e,t);return function(){return n.clone()}}();var xa=function(e){function t(e,n,r){var a;return Object(C.a)(this,t),(a=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n,r))).mesh=void 0,a.lastTimeToDuplicate=void 0,a.mesh=t.newMesh(),n.add(a.mesh),a.mesh.scale.set(.01,.01,1),a.lastTimeToDuplicate=a.target.timeToDuplicate,a}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target,t=e.timeToDuplicate,n=e.secondsPerDuplication,r=Object(J.a)(Math.pow(1-t/n,.5),.05,1);this.mesh.scale.x=Object(J.b)(this.mesh.scale.x,r,.2),this.mesh.scale.y=Object(J.b)(this.mesh.scale.y,r,.2);var a=this.target.cell,i=a.pos;t>this.lastTimeToDuplicate&&((i=i.clone()).x+=Object(J.f)(-.1,.1),i.y+=Object(J.f)(-.1,.1)),this.mesh.position.set(i.x,i.y+a.droopY,2),this.lastTimeToDuplicate=t}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(Qr);xa.newMesh=function(){var e=new u.RingBufferGeometry(.1,.5,20,20),t=new u.MeshBasicMaterial({map:lr(0,1),side:u.DoubleSide,color:new u.Color(12462572)}),n=new u.Mesh(e,t);return n.position.z=3,function(){return n.clone()}}();var Ca=function(e){function t(e){return Object(C.a)(this,t),Object(yt.a)(this,Object(gt.a)(t).call(this,"thaw",e,t.makePoints()))}return Object(bt.a)(t,e),Object(S.a)(t,null,[{key:"makePoints",value:function(){return new ea((function(e,t){if(e.time>.6)return!1;var n=e.time/.6,r=e.info,a=r.dx,i=r.dy;e.x+=a*t,e.y+=i*t,e.alpha=n<.75?1:Object(Gr.c)(Object(J.d)(n,.75,1,1,0))}),{size:40,opacity:.5,color:Aa})}}]),Object(S.a)(t,[{key:"handle",value:function(e){for(var t=e.where,n=0;n<4;n++){var r=Math.random()*Math.PI*2,a=1*Math.cos(r),i=1*Math.sin(r);this.ffPoints.fire({x:t.pos.x,y:t.pos.y,z:1,alpha:1,info:{dx:a,dy:i},size:Object(J.d)(Math.random(),0,1,.5,1.5),time:0,r:r})}}}]),t}(ra),Sa=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(yt.a)(this,Object(gt.a)(t).call(this,e,e.scene,e.mito))).singleEventRenderers={"cell-eat":new aa(n.target),"cell-transfer-energy":new ia(n.target),evaporation:new ya(n.target),photosynthesis:new wa(n.target),thaw:new Ca(n.target),"collect-sunlight":new ca(n.target),"grow-fruit":new ba(n.target)},n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e,t=this.target.target.getLastStepStats().events;for(e in t){var n=this.singleEventRenderers[e];null!=n&&n.update()}}},{key:"destroy",value:function(){for(var e=0,t=Object.values(this.singleEventRenderers);e<t.length;e++){var n=t[e];null!=n&&n.destroy()}}}]),t}(Qr),Pa=function(){function e(){Object(C.a)(this,e),this.animation=void 0,this.timeStarted=void 0,this.timeLastUpdated=void 0}return Object(S.a)(e,[{key:"set",value:function(e){this.animation=e,this.timeLastUpdated=this.timeStarted=Cn.a.now/1e3}},{key:"update",value:function(){if(null!=this.animation&&null!=this.timeStarted&&null!=this.timeLastUpdated){var e=Cn.a.now/1e3,t=e-this.timeStarted,n=e-this.timeLastUpdated,r=this.animation(t,n);this.timeLastUpdated=e,r&&(this.animation=void 0,this.timeStarted=void 0,this.timeLastUpdated=void 0)}}}]),e}();function Ma(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=0,a=0;return function(e,n){return(0,t[r])(e-a,n)&&(r++,a=e),r>=t.length}}function Ta(e,t){var n=!1;return function(r,a){var i=e(r,a);return n||(n=t(r,a)),i}}function Na(e){return function(t){return t>e}}var Ra=function(e){function t(e,n,r){var a;return Object(C.a)(this,t),(a=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n,r))).mesh=void 0,a.animation=new Pa,a.inventoryRenderer=void 0,a.mesh=new u.Mesh(new u.PlaneBufferGeometry(1,1),new u.MeshBasicMaterial({transparent:!0,map:lr(0,7,"transparent"),color:new u.Color("white"),side:u.DoubleSide})),a.mesh.name="Insect Mesh",Object(J.c)(a.mesh.position,a.target.pos,1),a.mesh.position.z=1,a.scene.add(a.mesh),r.worldRenderer.inventoryPoints&&(a.inventoryRenderer=new(function(t){function n(){return Object(C.a)(this,n),Object(yt.a)(this,Object(gt.a)(n).apply(this,arguments))}return Object(bt.a)(n,t),Object(S.a)(n,[{key:"getCarrierPos",value:function(){return e.posFloat}}]),n}(pa))(a.target.inventory,a.scene,a.mito,r.worldRenderer.inventoryPoints),a.inventoryRenderer.animationOffset=(a.target.pos.x+a.target.pos.y)/2),a}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e,t=this.target.posFloat.clone();this.mesh.position.set(t.x,t.y,2),this.animation.update(),null===(e=this.inventoryRenderer)||void 0===e||e.update()}},{key:"destroy",value:function(){var e;this.scene.remove(this.mesh),null===(e=this.inventoryRenderer)||void 0===e||e.destroy()}}]),t}(Qr);var Fa={KeyS:"KeyW",KeyW:"KeyS",KeyA:"KeyD",KeyD:"KeyA"},Da=new function e(){var t=this;Object(C.a)(this,e),this.keyMap=new Set,this.handleBlur=function(){t.keyMap.clear()},this.handleKeyDown=function(e){var n=e.code;if(t.keyMap.add(n),e.code in Fa&&t.keyMap.delete(Fa[n]),"KeyH"===n&&(T.a.hud=!T.a.hud),"Period"===n&&(T.a.showFPS=!T.a.showFPS),"Slash"===n&&(T.a.showGodUI=!T.a.showGodUI),!("KeyI"===n&&e.shiftKey&&e.ctrlKey||"KeyI"===n&&e.altKey&&e.metaKey))return e.preventDefault(),!1},this.handleKeyUp=function(e){t.keyMap.delete(e.code)},window.addEventListener("blur",this.handleBlur),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)};function Ba(e){return"pickup"===e.type||"drop"===e.type?!!e.continuous:"remove-cancer"===e.type||"thaw"===e.type}var Ia=function(){var e=new u.CircleBufferGeometry(.07,20),t=new u.MeshBasicMaterial({color:6207360,side:u.DoubleSide});return new u.Mesh(e,t)}(),za=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.Vector2(0,0),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(C.a)(this,e),this.pos=t,this.vel=n,this.scale=r},Ga=function(e){function t(e){var n,r,a;Object(C.a)(this,t),(a=Object(yt.a)(this,Object(gt.a)(t).call(this))).nodes=[],a.meshes=[],a.line=void 0,a.pullForceScalar=10,a.towardsTargetForce=5,a.dragForceScalar=-3,a.goTowardsTargetForce=function(){var e=new u.Vector2;return function(t,n,r,a){return e.copy(n).multiplyScalar(r).sub(t.pos),e.multiplyScalar(a)}}(),a.dragForce=function(){var e=new u.Vector2;return function(t,n){return e.copy(t.vel).multiplyScalar(n),e}}(),a.pullForce=function(){var e=new u.Vector2;return function(t,n,r){return e.copy(t.pos).sub(n.pos),e.multiplyScalar(-r)}}(),a.nodes=q(e).map((function(t){return new za(new u.Vector2(t/e,0))})),a.meshes=a.nodes.map((function(e){var t=Ia.clone();return t.position.set(e.pos.x,e.pos.y,t.position.z),t})),(n=a).add.apply(n,Object(H.a)(a.meshes));var i=new u.Geometry;return(r=i.vertices).push.apply(r,Object(H.a)(a.meshes.map((function(e){return e.position})))),a.line=new u.Line(i,new u.LineBasicMaterial({color:6207360})),a.add(a.line),a}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"handleInteracted",value:function(){this.nodes[this.nodes.length-1].scale=2.1}},{key:"update",value:function(e,t){var n=this,r=this.nodes[this.nodes.length-1];Object(J.c)(r.pos,t,.5);for(var a=new u.Vector2,i=1;i<this.nodes.length-1;i++){a.set(0,0);var o=this.nodes[i],s=this.nodes[i-1],l=this.nodes[i+1];a.add(this.pullForce(o,s,this.pullForceScalar)),a.add(this.pullForce(o,l,this.pullForceScalar)),a.add(this.goTowardsTargetForce(o,t,i/(this.nodes.length-1),this.towardsTargetForce)),a.add(this.dragForce(o,this.dragForceScalar)),o.scale=Object(J.b)(o.scale,l.scale,.5),o.vel.add(a.multiplyScalar(e))}this.nodes.forEach((function(t,r){t.pos.x+=t.vel.x*e,t.pos.y+=t.vel.y*e;var a=n.meshes[r];a.position.set(t.pos.x,t.pos.y,a.position.z),a.scale.set(t.scale,t.scale,1)})),r.scale=Object(J.b)(r.scale,1,.5),this.line.geometry.verticesNeedUpdate=!0}}]),t}(u.Object3D),La=function(e){function t(e,n,r){var a;return Object(C.a)(this,t),(a=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n,r))).mesh=void 0,a.neuronMesh=new Ga(8),a.animation=new Pa,a.handleStartLongAction=function(e){"build"===e.effect.type&&a.animation.set(a.buildReproducerAnimation(e))},a.handleAction=function(e){if("pickup"===e.type)a.neuronMesh.handleInteracted(),Ve.o.fade(.5,0,200),Ve.o.rate(Object(J.f)(.8,1.5));else if("drop"===e.type){if(e.sugar>0&&(Ve.f.play(),Ve.f.rate(Object(J.f)(.8,1.2))),e.water>0&&!Ve.g.playing()){var t=Ve.g.play();Ve.g.fade(.2,0,400,t),Ve.g.rate(Object(J.f)(.8,1.5))}}else if("build"===e.type){var n=Ve.b.play();Ve.b.rate(Object(J.f)(.5,1),n)}else if("deconstruct"===e.type){var r=Ve.d.play();Ve.d.rate(Object(J.f)(.9,1.1),r)}else"move"===e.type&&(Ve.j.fade(.1,0,50),Ve.j.rate(Object(J.f)(.8,1.5)))},a.handlePlayerActionFail=function(e,t){var n;("move"===e.type&&(Ve.s.playing()||(Ve.s.play(),Ve.s.rate(Object(J.f)(.8,1.2)))),null==t&&"pickup"===e.type&&a.target.inventory.isMaxed()&&(t="Inventory full!"),null!=t)&&(Ba(e)?(null===(n=a.mito.invalidAction)||void 0===n?void 0:n.message)!==t&&a.mito.showInvalidAction({message:t}):a.mito.showInvalidAction({message:t}))},a.prevHighlightedTile=void 0,a.mesh=Wa(),a.mesh.name="Player Mesh",Object(J.c)(a.mesh.position,a.target.pos,1),a.mesh.position.z=2,a.mesh.add(a.neuronMesh),P(300).then((function(){a.scene.add(a.mesh)})),a.target.on("start-long-action",a.handleStartLongAction),a.target.on("action",a.handleAction),a.target.on("action-fail",a.handlePlayerActionFail),a}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e,t,n=this.target.droopPosFloat().clone();this.target.world.getLastStepStats().events.oof[0]&&this.mito.addFloatingText(n,"oof"),this.mesh.position.set(n.x,n.y,2);var r=Da.keyMap.has("ShiftLeft"),a=null!==(e=null===(t=this.mito.controls)||void 0===t?void 0:t.wouldLeftClickInteract())&&void 0!==e&&e&&!r,i=this.mito.highlightedTile,o=a?i.pos.clone().sub(n):Va;if(this.prevHighlightedTile!==i){var s=Ve.t.play();Ve.t.rate(Object(J.f)(.9,1.1),s),Ve.t.volume(Object(J.f)(.8,1),s)}this.neuronMesh.update(a?1/60*10:1/60*5,o),this.prevHighlightedTile=i,this.animation.update()}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}},{key:"buildReproducerAnimation",value:function(e){var t=this,n=Na(.5),r=0,a=this.animSendCopy(e.effect.position),i=Na(.5);return Ta(Ma(n,(function(e,n){var a=e/1.5,i=Object(J.a)(a,0,1),o=9*Math.sqrt(i),s=.15*Math.pow(i,1.5);return r+=n*Math.PI*2*o,t.mesh.position.x+=Math.sin(r)*s,a>1}),Ta(a,(function(e){var n=e/.25,r=Object(J.d)(Object(J.a)(4*(n-n*n),0,1),0,1,1,1.5);return t.mesh.scale.set(r,r,1),e>n})),i),(function(){return t.mito.suggestCamera({center:t.target.posFloat,zoom:3}),!1}))}},{key:"animSendCopy",value:function(e){var t=this,n=Wa();n.scale.x=1*this.mesh.scale.x,n.scale.y=1*this.mesh.scale.y,n.position.z=this.mesh.position.z-.01,this.scene.add(n);return Ma((function(e){var r=e/.5,a=.5*Object(Gr.b)(r);return t.mesh.position.x-=a,Object(J.c)(n.position,t.target.droopPosFloat(),1),n.position.x+=a,r>1}),Ta(Na(.5),(function(e){return t.mesh.position.x-=.5,!1})),Ta((function(r,a){var i=r/1.2;return Object(J.c)(n.position,e,.1),Object(J.c)(n.scale,{x:.2*t.mesh.scale.x,y:.2*t.mesh.scale.y},.1),i>1}),(function(e){var n=e/.5,r=.5*Object(Gr.b)(1-n);return t.mesh.position.x-=r,n>1})),(function(e){var r=e/.5;Object(J.c)(n.scale,{x:.2*t.mesh.scale.x,y:.2*t.mesh.scale.y},1),Object(J.c)(n.scale,{x:0,y:0},Object(Gr.b)(r));var a=r>1;return a&&t.scene.remove(n),a}))}}]),t}(Qr);function Wa(){var e=new u.Mesh(new u.PlaneBufferGeometry(.75,.75),new u.MeshBasicMaterial({transparent:!0,map:lr(3,2,"transparent"),color:new u.Color("white"),side:u.DoubleSide}));return e.renderOrder=9,e}var Va=new u.Vector2,Ua=n(339),Ha=n(340),Qa=function(e){function t(e,n,r){var a;Object(C.a)(this,t),(a=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n,r))).mesh=void 0,a.animation=new Pa;var i=e.world.genome.cellTypes.find((function(e){return e.chromosome.computeStaticProperties().isReproductive})).material;return a.mesh=function(e){var t,n=new u.Mesh(new u.PlaneBufferGeometry(1,1),new u.MeshBasicMaterial({transparent:!0,map:lr(e.texturePosition.x,e.texturePosition.y),color:null!==(t=e.color)&&void 0!==t?t:new u.Color("white"),side:u.DoubleSide}));return n.renderOrder=9,n}(i),a.mesh.name="Player Seed Mesh",a.mito.scenePlayerSeed.add(a.mesh),a.animation.set(Ma(a.fallInAnimation(),Na(2),a.wiggleAnimationForever())),a}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target.posFloat.clone();this.mesh.rotation.set(0,0,0),this.mesh.position.set(e.x,e.y,11),this.animation.update()}},{key:"destroy",value:function(){var e=this;this.animation.set(Ma(this.popOutAnimation(),(function(){return e.scene.remove(e.mesh),!0}))),Cn.a.addAnimation((function(t){if(e.animation.update(),null==e.animation.animation)return!0}))}},{key:"popOutAnimation",value:function(){var e=this;return Ma(Ta((function(t){var n=t/.5;return e.mesh.scale.setScalar(Object(J.b)(1,7,Object(Ua.a)(n))),n>1}),(function(){return Ve.k.play(),!0})),(function(t){return e.mesh.scale.setScalar(7),t>1}),(function(t){var n=t/.2;return e.mesh.material.opacity=Object(J.b)(1,0,n),n>1}))}},{key:"fallInAnimation",value:function(){var e=this;return Ma(Ta(Na(1),(function(t){return e.mesh.position.y-=12,!1})),Ta((function(t){var n=t/2;return e.mesh.position.y-=Object(J.b)(12,0,Object(Ha.a)(n)),n>1}),(function(){return Ve.p.play(),!0})))}},{key:"wiggleAnimationForever",value:function(){var e=this;return function(t){var n=t%3;if(n<1){var r=n/1,a=Math.sin(Object(J.d)(Math.sin(r*Math.PI*4),-1,1,-Math.PI/6,Math.PI/6))*sa(r);e.mesh.position.y-=Math.abs(1*a)}return!1}}}]),t}(Qr);var Ya=function(){},Ka=n(35),Xa=n(99),Za=function(e){function t(e,n){var r;return Object(C.a)(this,t),(r=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n.scene,n.mito))).tileRenderer=n,r.init(),r}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"init",value:function(){}}]),t}(Qr),Ja=function(){var e=new u.BufferGeometry;return e.setAttribute("position",new u.Float32BufferAttribute([0,0,0,0,1,0],3)),e}();function qa(e,t,n,r){var a=new u.Line(Ja,new u.LineBasicMaterial({color:r}));if(a.position.copy(t),e.y>.99999)a.quaternion.set(0,0,0,1);else if(e.y<-.99999)a.quaternion.set(1,0,0,0);else{var i=new u.Vector3(e.z,0,-e.x).normalize(),o=Math.acos(e.y);a.quaternion.setFromAxisAngle(i,o)}return a.scale.set(1,Math.max(0,n),1),a.position.z=.1,a.updateMatrix(),a.matrixAutoUpdate=!1,a}var _a=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(a)))).audio=n.tileRenderer.worldRenderer.renderResources?Xn(new u.Audio(n.mito.audioListener),(function(e){Ve.a.then((function(t){return e.setBuffer(t)}))})):void 0,n.lastAudioValueTracker=0,n.neighborLines=new u.Object3D,n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target.state.totalSugarProduced;if(e>this.lastAudioValueTracker){var t,n,r=this.target.state.sugarConverted*this.target.state.sugarConverted,a=Object(Ve.e)(this.target.cell,this.mito.world.player)*r;null===(t=this.audio)||void 0===t||t.setVolume(a),null===(n=this.audio)||void 0===n||n.play(),this.tileRenderer.animation.set(this.tileRenderer.growPulseAnimation())}this.lastAudioValueTracker=e,null!=this.neighborLines.parent&&this.scene.remove(this.neighborLines)}},{key:"hover",value:function(){var e=this;this.scene.add(this.neighborLines),this.neighborLines.position.set(this.tileRenderer.target.pos.x,this.tileRenderer.target.pos.y,1);var t,n=this.target.state.activeNeighbors;n.length!==this.neighborLines.children.length&&((t=this.neighborLines).remove.apply(t,Object(H.a)(this.neighborLines.children)),n.forEach((function(t){var n=t.length()-.25,r=qa(new u.Vector3(t.x,t.y,0).normalize(),new u.Vector3,n,$a);e.neighborLines.add(r)})))}},{key:"destroy",value:function(){var e;this.scene.remove(this.neighborLines),null===(e=this.audio)||void 0===e||e.disconnect()}}]),t}(Za),$a=16763150,ei=(n(306),new u.BoxBufferGeometry(.2,.1)),ti=new Map;var ni,ri=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(i)))).meshes={},n.argsEditor=void 0,n.positionFn=function(){return n.target.cell},n.renderFn=function(){return a.a.createElement(ai,{gene:n.target})},n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e,t=this.target.state.connections;for(e in this.target.state.connections)t[e]&&null==this.meshes[e]?this.addMesh(e):t[e]||null==this.meshes[e]||this.removeMesh(e);this.tileRenderer.worldRenderer.renderResources&&this.updateArgsEditor()}},{key:"addMesh",value:function(e){var t=this.meshes[e]=new u.Mesh(ei,function(e){if(!ti.has(e)){var t,n,r=null!==(t=null===(n=e.material.color)||void 0===n?void 0:n.getHex())&&void 0!==t?t:16777215;ti.set(e,new u.MeshBasicMaterial({color:r,side:u.DoubleSide}))}return ti.get(e)}(this.target.cell.type)),n=ae.a[e];t.position.x=this.target.cell.pos.x+.4*n.x,t.position.y=this.target.cell.pos.y+.4*n.y,t.position.z=2,t.rotation.z=n.angle(),this.scene.add(t)}},{key:"removeMesh",value:function(e){var t=this.meshes[e];delete this.meshes[e],this.scene.remove(t)}},{key:"updateArgsEditor",value:function(){var e=Da.keyMap.has("ShiftLeft")&&this.mito.getTileAtScreen()===this.target.cell;e&&null==this.argsEditor?this.argsEditor=this.mito.addWorldDOMElement(this.positionFn,this.renderFn):e||null==this.argsEditor||(this.mito.removeWorldDOMElement(this.argsEditor),this.argsEditor=void 0)}},{key:"hover",value:function(){}},{key:"destroy",value:function(){this.argsEditor&&this.mito.removeWorldDOMElement(this.argsEditor)}}]),t}(Za),ai=function(e){var t=e.gene.state.connections,n=Object(r.useCallback)((function(){t.n=!t.n}),[t.n]),i=Object(r.useCallback)((function(){t.s=!t.s}),[t.s]),o=Object(r.useCallback)((function(){t.e=!t.e}),[t.e]),s=Object(r.useCallback)((function(){t.w=!t.w}),[t.w]),l=Object(r.useCallback)((function(){var e;for(e in t)t[e]=!1}),[t]);return a.a.createElement("div",{className:"pipes-editor"},a.a.createElement("div",{className:"zone-n",onClick:n}),a.a.createElement("div",{className:"zone-w",onClick:s}),a.a.createElement("div",{className:"zone-center",onClick:l},a.a.createElement(_n.b,null)),a.a.createElement("div",{className:"zone-e",onClick:o}),a.a.createElement("div",{className:"zone-s",onClick:i}))},ii=(n(307),function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(i)))).percentMatureElement=n.tileRenderer.worldRenderer.renderResources?n.mito.addWorldDOMElement((function(){return n.target.cell}),(function(){var e=Object(g.reproducerGetPercentMatured)(n.target);return a.a.createElement("div",{className:"reproducer-percent-mature"},(100*e).toFixed(1),"%")})):null,n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"hover",value:function(){}},{key:"update",value:function(){this.updateScale()}},{key:"updateScale",value:function(){var e=Object(J.d)(Object(g.reproducerGetPercentMatured)(this.target),0,1,.2,1);this.tileRenderer.scale.set(e,e,1)}},{key:"destroy",value:function(){this.percentMatureElement&&this.mito.removeWorldDOMElement(this.percentMatureElement)}}]),t}(Za)),oi=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(a)))).audio=function(){var e=new u.Audio(n.mito.audioListener);return Ve.v.then((function(t){return e.setBuffer(t)})),e}(),n.lastAudioValueTracker=0,n.neighborLines=new u.Object3D,n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){var e=this.target.state.totalSucked;if(e!==this.lastAudioValueTracker){var t=1*Object(Ve.e)(this.target.cell,this.mito.world.player);this.audio.setVolume(t),null!=this.audio.source&&this.audio.stop(),this.audio.play(),this.tileRenderer.animation.set(this.tileRenderer.growPulseAnimation())}this.lastAudioValueTracker=e,null!=this.neighborLines.parent&&this.scene.remove(this.neighborLines)}},{key:"hover",value:function(){var e=this;this.scene.add(this.neighborLines),this.neighborLines.position.set(this.tileRenderer.target.pos.x,this.tileRenderer.target.pos.y,1);var t,n=this.target.state.activeNeighbors;n.length!==this.neighborLines.children.length&&((t=this.neighborLines).remove.apply(t,Object(H.a)(this.neighborLines.children)),n.forEach((function(t){var n=t.length()-.25,r=qa(new u.Vector3(t.x,t.y,0).normalize(),new u.Vector3,n,si);e.neighborLines.add(r)})))}},{key:"destroy",value:function(){this.scene.remove(this.neighborLines),this.audio.disconnect()}}]),t}(Za),si=new u.Color("rgb(9, 12, 255)").getHex(),li=(n(308),function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(i)))).arrow=void 0,n.origin=void 0,n.lastDir=new u.Vector2(0,0),n.argsEditor=void 0,n.positionFn=function(){return n.target.cell},n.renderFn=function(){return a.a.createElement(ci,{gene:n.target})},n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"update",value:function(){this.updateArrow(),this.updateArrowPosition(),this.tileRenderer.worldRenderer.renderResources&&this.updateArgsEditor(),this.target.state.didJustTransport&&this.tileRenderer.animation.set(this.arrowMoveAnimation())}},{key:"updateArgsEditor",value:function(){var e=Da.keyMap.has("ShiftLeft")&&this.mito.getTileAtScreen()===this.target.cell;e&&null==this.argsEditor?this.argsEditor=this.mito.addWorldDOMElement(this.positionFn,this.renderFn):e||null==this.argsEditor||(this.mito.removeWorldDOMElement(this.argsEditor),this.argsEditor=void 0)}},{key:"updateArrow",value:function(){var e=this.target.cell.args.direction;if(!e.equals(this.lastDir)){null!=this.arrow&&this.arrow.parent.remove(this.arrow);var t=e.clone().normalize();this.origin=t.clone().multiplyScalar(-.25),this.arrow=new u.ArrowHelper(new u.Vector3(t.x,t.y,0),new u.Vector3(this.origin.x,this.origin.y,2),.5,16777215,.1,.1),this.scene.add(this.arrow),this.lastDir.copy(e),this.tileRenderer.animation.set(this.arrowSetAnimation())}}},{key:"updateArrowPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.origin,t=e.x,n=e.y;this.arrow.position.set(this.target.cell.pos.x+t,this.target.cell.pos.y+this.target.cell.droopY+n,2)}},{key:"arrowMoveAnimation",value:function(){var e=this,t=this.origin.length(),n=this.origin.clone().setLength(1.1*t),r=this.origin.clone().setLength(.5*t);return function(t){var a=t/.25;return e.updateArrowPosition(n.clone().lerp(r,Object(Ln.b)(a))),a>=1}}},{key:"arrowSetAnimation",value:function(){var e=this;return function(t){var n=t/.2,r=.1*Object(ga.c)(1-n);return e.updateArrowPosition({x:Object(J.f)(-r,r),y:Object(J.f)(-r,r)}),n>=1}}},{key:"hover",value:function(){}},{key:"destroy",value:function(){this.scene.remove(this.arrow),this.argsEditor&&this.mito.removeWorldDOMElement(this.argsEditor)}}]),t}(Za)),ci=function(e){var t=e.gene,n=Object(r.useCallback)((function(){var e,n;null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.set(0,-1)}),[t.cell.args]),i=Object(r.useCallback)((function(){var e,n;null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.set(0,1)}),[t.cell.args]),o=Object(r.useCallback)((function(){var e,n;null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.set(1,0)}),[t.cell.args]),s=Object(r.useCallback)((function(){var e,n;null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.set(-1,0)}),[t.cell.args]),l=function(){var e,t=Object(r.useState)([]),n=Object(U.a)(t,2),a=n[0],i=n[1],o=Object(r.useCallback)((function(e){var t=e.movementX,n=e.movementY,r=new u.Vector2(t,n);i((function(e){return[r].concat(Object(H.a)(e))}))}),[]),s=a.reduce((function(e,t){return e.add(t)}),new u.Vector2);if(s.lengthSq()>144){var l=s.angle(),c=Object(J.i)(l,Math.PI/2);e=new u.Vector2(Math.round(Math.cos(c)),Math.round(Math.sin(c)))}return[e,o]}(),c=Object(U.a)(l,2),h=c[0],d=c[1];Object(r.useEffect)((function(){var e,n;h&&(null===(e=t.cell.args)||void 0===e||null===(n=e.direction)||void 0===n||n.copy(h))}),[t.cell.args,h]);var f=Object(r.useCallback)((function(e){0!==e.buttons&&(console.log(t.cell.toString(),e.movementX,e.movementY),d(e))}),[d,t.cell]);return a.a.createElement("div",{className:"directional-push-editor",onMouseMove:f},a.a.createElement("div",{className:"zone-n",onClick:n}),a.a.createElement("div",{className:"zone-w",onClick:s}),a.a.createElement("div",{className:"zone-center"}),a.a.createElement("div",{className:"zone-e",onClick:o}),a.a.createElement("div",{className:"zone-s",onClick:i}))};var ui=function(e){function t(e,n,r,a,i){var o,s;return Object(C.a)(this,t),(o=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n,r))).inventoryRenderer=void 0,o.originalColor=void 0,o.cellEffectsRenderer=void 0,o.geneRenderer=void 0,o.animation=new Pa,o.scale=new u.Vector3(1,1,1),o.color=new u.Color,o.instance=void 0,o.worldRenderer=void 0,o.temperatureColor=t.TEMPERATURE_COLORS[Ka.a.Mild],o.currentLerp=0,o.worldRenderer=i,o.instance=a.getBatchInstance(e),o.target instanceof c.f&&o.scale.set(.01,.01,1),o.originalColor=(o.materialInfo.color||fi).clone(),i.inventoryPoints&&(o.inventoryRenderer=new pa(o.target.inventory,o.scene,o.mito,i.inventoryPoints),o.inventoryRenderer.animationOffset=(o.target.pos.x+o.target.pos.y)/2),o.target instanceof c.b&&(o.target.timeToBuild<=0&&o.scale.set(.01,.01,1),o.cellEffectsRenderer=new ka(o.target,o.scene,o.mito),o.geneRenderer=(s=o.target.geneInstances.map((function(e){return o.createGeneRendererFor(e)})).filter((function(e){return null!=e})),new Proxy({},{get:function(e,t){var n=s[0];return null!=n&&"function"===typeof n[t]?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=!0,i=!1,o=void 0;try{for(var l,c=s[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value,h=u[t];"function"===typeof h&&h.apply(u,n)}}catch(d){i=!0,o=d}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}}:Ya}}))),o.target.darkness<1&&o.commit(),o}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"materialInfo",get:function(){return function e(t){return t instanceof c.f?e(t.completedCell):t instanceof c.b?t.type.material:hi.get(t.constructor)}(this.target)}}]),Object(S.a)(t,[{key:"createGeneRendererFor",value:function(e){return e.isType(f.k)?new oi(e,this):e.isType(f.g)?new _a(e,this):e.isType(f.l)?new li(e,this):e.isType(f.b)||e.isType(f.j)?new ii(e,this):e.isType(f.h)?new ri(e,this):void 0}},{key:"commit",value:function(){if(this.target instanceof c.f){var e=this.target,t=e.start,n=e.pos,r=t.clone().lerp(n,.5),a=n,i=this.scale.x;Object(J.c)(r,a,i),this.instance.commitCenter(r.x,r.y,1)}else if(this.target instanceof c.b)this.instance.commitCenter(this.target.pos.x,this.target.pos.y+this.target.droopY,1);else{var o=this.target instanceof c.a?-10:0;this.instance.commitCenter(this.target.pos.x,this.target.pos.y,o)}this.instance.commitTexturePosition(this.materialInfo.texturePosition),this.instance.commitColor(this.color),this.instance.commitTemperature(this.target.temperatureFloat),this.instance.commitScale(this.scale)}},{key:"update",value:function(){this.target.darkness<1&&(this.updateScale(),this.updateColor(),this.updateInventory(),this.maybeUpdateCellEffectsRenderer(),this.geneRenderer&&this.geneRenderer.update(),this.animation.update(),this.commit())}},{key:"maybeUpdateCellEffectsRenderer",value:function(){null!=this.cellEffectsRenderer&&this.cellEffectsRenderer.update()}},{key:"updateInventory",value:function(){var e;null===(e=this.inventoryRenderer)||void 0===e||e.update()}},{key:"updateScale",value:function(){if(this.target instanceof c.f){var e=Object(J.d)(this.target.percentGrown,0,1,.1,1);Object(J.c)(this.scale,{x:e,y:e},.5)}else this.target instanceof c.b&&this.target.isReproductive||Object(J.c)(this.scale,t.ONE,.25)}},{key:"updateColor",value:function(){var e=this.target.lightAmount();if(this.target instanceof c.a){var t=di(this.target.co2());this.originalColor.set(t)}if(this.color.copy(this.originalColor),this.target instanceof c.b&&this.target.energy<.5){var n=Object(J.d)(this.target.energy,0,.5,1,0);this.color.lerp(vi,n)}this.lerpColorTemperature(this.color),this.color.lerp(vi,Object(J.d)(e,0,1,.8,0))}},{key:"lerpColorTemperature",value:function(e){var n=this.target.temperature,r=t.TEMPERATURE_COLORS[n];r!==this.temperatureColor&&(this.currentLerp=0);var a=n===Ka.a.Mild?0:.25;this.temperatureColor=r,this.currentLerp=Object(J.b)(this.currentLerp,a,.1),e.lerp(this.temperatureColor,this.currentLerp)}},{key:"updateHover",value:function(){var e,t;null===(e=this.geneRenderer)||void 0===e||null===(t=e.hover)||void 0===t||t.call(e)}},{key:"growPulseAnimation",value:function(){var e=this,t=.5*(this.target instanceof c.b?this.target.tempo:1),n=oa(ga.b);return function(r){var a=Object(J.a)(r/t,0,1),i=Object(J.d)(n(a),0,1,1,1.3);return e.scale.setScalar(i),a>=1}}},{key:"hasActiveNeighbors",value:function(e){return Array.isArray(e.activeNeighbors)}},{key:"destroy",value:function(){var e,t,n;this.instance.destroy(),null===(e=this.inventoryRenderer)||void 0===e||e.destroy(),null===(t=this.cellEffectsRenderer)||void 0===t||t.destroy(),null===(n=this.geneRenderer)||void 0===n||n.destroy()}}]),t}(Qr);ui.TEMPERATURE_COLORS=(ni={},Object(L.a)(ni,Ka.a.Scorching,new u.Color("orange")),Object(L.a)(ni,Ka.a.Hot,new u.Color("orange").lerp(new u.Color("white"),.5)),Object(L.a)(ni,Ka.a.Mild,new u.Color("white")),Object(L.a)(ni,Ka.a.Cold,new u.Color("lightblue").lerp(new u.Color("white"),.5)),Object(L.a)(ni,Ka.a.Freezing,new u.Color("rgb(43, 34, 126)")),ni),ui.ONE=Object.freeze(new u.Vector2(1,1));var hi=function(){var e=new Map;e.set(c.a,{texturePosition:new u.Vector2(0,3),color:new u.Color("white")});var t=new u.Color("rgb(112, 89, 44)");return e.set($.b,{texturePosition:new u.Vector2(1,0),color:new u.Color("rgb(223, 220, 231)").multiplyScalar(1/1.2)}),e.set($.c,{texturePosition:new u.Vector2(1,0),color:t}),e.set($.a,{texturePosition:new u.Vector2(1,0),color:t.clone().multiplyScalar(1/1.5)}),e.set(Xa.a,{texturePosition:new u.Vector2(4,0),color:new u.Color("rgb(193, 159, 92)")}),e.set(c.d,{color:new u.Color("white"),texturePosition:new u.Vector2(2,0)}),e.set(c.g,{texturePosition:new u.Vector2(3,0),color:new u.Color("rgb(63, 77, 84)")}),e.set(c.c,{texturePosition:new u.Vector2(0,1),color:new u.Color("rgb(128, 128, 128)")}),e}();var di=Object(Wn.a)().domain([.25,.5,1]).range(["hsl(51, 32%, 28%)","hsl(180, 31%, 76%)","hsl(213, 83%, 48%)"]),fi=new u.Color(1,1,1),vi=new u.Color(0,0,0);function mi(){var e=Object(Yr.a)(["\n// for the fragment shader, the main goal is to set gl_FragColor. Its inputs are\n//   'varying' variables from the vertex shader, interpolated along the triangle\n//   'uniform' variables\nprecision mediump float;\n\n// these should match the corresponding section in the vertexShader exactly\nvarying vec3 vTileCenter;\nvarying vec3 vColor;\nvarying vec2 vUv;\nvarying vec2 vTexturePosition;\nvarying float vAlpha;\nvarying float vTemperature;\n\nconst vec2 spritesheetSize = vec2(256., 256.);\nuniform sampler2D spriteSheet;\n\nfloat myRound(float x) {\n  return sign(x) * floor(abs(x) + 0.5);\n}\n\nfloat random(float x) {\n  return fract(sin(x * .43));\n}\n\nvec3 applyTemperature(vec3 color) {\n  return color;\n\n  // TODO add heat, maybe rework this to look better\n\n  // vec3 colorFreezing = vec3(12., 54., 89.) / 255.;\n  // vec3 colorCold = vec3(214., 235., 242.) / 255.;\n  // float amtFreezing = (1. - step(0., vTemperature));\n  // float amtCold = (1. - step(32., vTemperature)) * step(0., vTemperature);\n  // return mix(mix(color, colorCold, amtCold * 0.5), colorFreezing, amtFreezing * 0.5);\n}\n\n// uv - [0,1]x[0,1] - our local sprite (16x16) UV coords\n// texturePosition - the grid x/y where our sprite lives in our texture. NOTE:\n// for texturePosition, top-left is 0, 0 (Y is image coordinates)\n// textureSize - the pixel width/height of the full spritesheet\n// returns: a UV coordinate for this sprite, relative to the full spritesheet\nvec2 getCorrectUv(vec2 uv, vec2 texturePosition, vec2 textureSize) {\n  vec2 spriteSheetPxStart = texturePosition * vec2(32.);\n  spriteSheetPxStart.y = textureSize.y - spriteSheetPxStart.y - 32.;\n  vec2 spriteSheetUv = spriteSheetPxStart + uv * vec2(32.);\n  vec2 minUv = spriteSheetPxStart + vec2(1.);\n  vec2 maxUv = spriteSheetPxStart + vec2(32. - 1.);\n  return clamp(spriteSheetUv / textureSize, minUv / textureSize, maxUv / textureSize);\n}\n\nvoid main() {\n  vec2 correctUv = getCorrectUv(vUv, vTexturePosition, spritesheetSize);\n  vec4 textureColor = texture2D(spriteSheet, correctUv);\n  gl_FragColor = vec4(applyTemperature(textureColor.rgb * vColor), textureColor.a * vAlpha);\n}\n"]);return mi=function(){return e},e}function pi(){var e=Object(Yr.a)(["\nprecision mediump float;\n\n// the vertex shader's main goals are:\n// 1. set gl_Position to a clip-coordinate\n// 2. pass varyings along to fragment shader.\n// you can accept two types of inputs:\n//   'attribute' variables, which change per vertex\n//   'uniform' variables, which are constant for a given draw context.\n// WebGL thankfully hooks up a bunch of attributes and uniforms, see https://threejs.org/docs/index.html#api/en/renderers/webgl/WebGLProgram\n// see also my explorations: https://codesandbox.io/s/reactthreejstemplate-lwvhu\n\n\n// Comes from WebGLProgram\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\n// Comes from threejs Geometry\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\n// attributes we provide\n// these are constant per instance\nattribute vec3 centers;\nattribute vec3 scales;\nattribute vec3 colors;\nattribute vec2 texturePositions;\nattribute float alphas;\nattribute float temperatures;\n\n// things we pass onto fragment\nvarying vec3 vTileCenter;\nvarying vec3 vColor;\nvarying vec2 vUv;\nvarying vec2 vTexturePosition;\nvarying float vAlpha;\nvarying float vTemperature;\n\n// based on https://github.com/mrdoob/three.js/blob/master/examples/webgl_buffergeometry_instancing_billboards.html\nvoid main() {\n  vTileCenter = centers;\n  vColor = colors;\n  vUv = uv;\n  vTexturePosition = texturePositions;\n  vAlpha = alphas;\n  vTemperature = temperatures;\n\n  vec4 mvPosition = modelViewMatrix * vec4(centers, 1.);\n  mvPosition.xyz += position * scales;\n  // mvPosition.xyz += position;\n  gl_Position = projectionMatrix * mvPosition;\n}\n"]);return pi=function(){return e},e}var yi=Kr(pi()),gi=Kr(mi());var bi=function(){function e(t){for(var n in Object(C.a)(this,e),this.world=t,this.geometry=function(){var e=new u.PlaneBufferGeometry(1,1),t=new u.InstancedBufferGeometry;return t.index=e.index,t.attributes=e.attributes,t}(),this.maxTiles=this.world.height*this.world.width*2,this.centers=this.attr(3),this.colors=this.attr(3),this.scales=this.attr(3),this.texturePositions=this.attr(2),this.alphas=this.attr(1,1),this.temperatures=this.attr(1,1),this.mesh=void 0,this.instances=new Map,this.mesh=new u.Mesh(this.geometry,new u.RawShaderMaterial({uniforms:{spriteSheet:{value:or()}},transparent:!0,vertexShader:yi,fragmentShader:gi,side:u.DoubleSide})),this.mesh.name="TileBatcher Mesh",this.mesh.frustumCulled=!1,this.mesh.matrixAutoUpdate=!1,this.mesh.updateMatrixWorld(),this){var r=this[n];r instanceof u.InstancedBufferAttribute&&this.geometry.setAttribute(n,r)}}return Object(S.a)(e,[{key:"attr",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new u.InstancedBufferAttribute(new Float32Array(this.maxTiles*e).fill(t),e,!1,1);return n.setUsage(u.DynamicDrawUsage),n}}]),Object(S.a)(e,[{key:"getBatchInstance",value:function(e){var t=e.pos,n=(e instanceof c.b?1:0)*this.maxTiles/2+(t.y*this.world.width+t.x);Number.isInteger(n)||console.error("index "+n+" is not integer!");var r=String(n);this.instances.has(r)||this.instances.set(r,new ki(this,n));var a=this.instances.get(r);return a.checkout(e),a}},{key:"endFrame",value:function(){for(var e in this){var t=this[e];t instanceof u.InstancedBufferAttribute&&(t.needsUpdate=!0)}}}]),e}(),wi=new u.Color(0,0,0),Ei=new u.Vector3(0,0,0),ki=function(){function e(t,n){Object(C.a)(this,e),this.batcher=void 0,this.index=void 0,this.owner=void 0,this.batcher=t,this.index=n}return Object(S.a)(e,[{key:"checkout",value:function(t){null!=this.owner&&console.warn("Checking out instance that's already in use!",this.index,t),this.owner=t,e.numInUse++}},{key:"commitColor",value:function(e){this.owner||console.error("freed tileBatcher still in use!"),this.batcher.colors.setXYZ(this.index,e.r,e.g,e.b)}},{key:"commitTemperature",value:function(e){this.owner||console.error("freed tileBatcher still in use!"),this.batcher.temperatures.setX(this.index,e)}},{key:"commitCenter",value:function(e,t,n){this.owner||console.error("freed tileBatcher still in use!"),this.batcher.centers.setXYZ(this.index,e,t,n)}},{key:"commitScale",value:function(e){this.owner||console.error("freed tileBatcher still in use!"),this.batcher.scales.setXYZ(this.index,e.x,e.y,e.z)}},{key:"commitTexturePosition",value:function(e){this.batcher.texturePositions.setXY(this.index,e.x,e.y)}},{key:"commitAlpha",value:function(e){this.batcher.alphas.setX(this.index,e)}},{key:"destroy",value:function(){this.commitColor(wi),this.commitScale(Ei),this.owner=void 0,e.numInUse--}}]),e}();ki.numInUse=0;var Oi=bi,Ai=function(e){function t(e,n,r){var a,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Object(C.a)(this,t),(a=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n,r))).renderResources=i,a.renderers=new Map,a.tileBatcher=void 0,a.eventLogRenderer=void 0,a.inventoryPoints=void 0,a.deleteDeadEntityRenderers=Object(Fr.a)((function(e){return e}),(function(e){var t=e.deleted,n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,c=a.renderers.get(l);null!=c?(c.destroy(),a.renderers.delete(l)):console.warn("Couldn't find renderer for ".concat(l,"!"))}}catch(u){r=!0,i=u}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}})),a.tileBatcher=new Oi(a.target),n.add(a.tileBatcher.mesh),a.inventoryPoints=new ma,n.add(a.inventoryPoints.waters),n.add(a.inventoryPoints.sugars),a.eventLogRenderer=new Sa(Object(xn.a)(a)),a}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"getOrCreateRenderer",value:function(e){var t=this.renderers.get(e);if(null!=t)return t;var n=this.createRendererFor(e);return n?(this.renderers.set(e,n),n):void 0}},{key:"createRendererFor",value:function(e){return e instanceof F?new La(e,this.scene,this.mito):e instanceof D?new Qa(e,this.scene,this.mito):e instanceof c.i?new ui(e,this.scene,this.mito,this.tileBatcher,this):e instanceof Z?new Ra(e,this.scene,this.mito):(console.error("Couldn't find renderer for",e),null)}},{key:"update",value:function(){var e,t,n=this;this.deleteDeadEntityRenderers(this.target.getLastStepStats()),this.eventLogRenderer&&this.eventLogRenderer.update(),null===(e=this.inventoryPoints)||void 0===e||e.startFrame(),this.target.entities().forEach((function(e){var t=n.getOrCreateRenderer(e);null===t||void 0===t||t.update()})),null===(t=this.inventoryPoints)||void 0===t||t.endFrame(),this.tileBatcher.endFrame()}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}}]),t}(Qr),ji=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.k;Object(C.a)(this,e),this.mito=t,this.pxPerTile=n,this.captureInterval=r,this.lastCaptureTime=0}return Object(S.a)(e,[{key:"isTimeForNewCapture",value:function(){return this.mito.world.time-this.lastCaptureTime>this.captureInterval}},{key:"capture",value:function(){var t=e.renderTarget,n=e.rtBuffer,r=e.rtCanvas;this.lastCaptureTime=this.mito.world.time;var a=Array.from(this.mito.world.allCells()),i=this.getBounds(a),o=Object(U.a)(i,2),s=o[0],l=o[1],c=new u.Scene,h=new Ai(this.mito.world,c,this.mito,!1),d=a.map((function(e){var t=h.createRendererFor(e);return null===t||void 0===t||t.update(),t}));h.tileBatcher.endFrame();var f=this.cameraEncompassingBounds([s,l]),v=this.mito.renderer;v.setRenderTarget(t),v.clear(!0,!0,!0),v.render(c,f),v.setRenderTarget(null),v.readRenderTargetPixels(t,0,0,t.width,t.height,n);for(var m=r.getContext("2d"),p=m.createImageData(r.width,r.height),y=p.data,g=0;g<n.length;g++)y[g]=n[g];m.putImageData(p,0,0);var b=l.x-s.x,w=l.y-s.y,E=Math.max(b,w),k=Object(J.d)(b,0,E,0,1024),O=Object(J.d)(w,0,E,0,1024),A=new u.Vector2(512-k/2,512-O/2),j=document.createElement("canvas");return j.width=Math.ceil(b*this.pxPerTile),j.height=Math.ceil(w*this.pxPerTile),j.getContext("2d").drawImage(r,A.x,A.y,k,O,0,0,j.width,j.height),(new Image).src=j.toDataURL(),d.forEach((function(e){null===e||void 0===e||e.destroy()})),j}},{key:"getBounds",value:function(e){var t=new u.Vector2,n=new u.Vector2;null!=e[0]&&(t.copy(e[0].pos),n.copy(e[0].pos));var r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;t.min(l.pos),n.max(l.pos)}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return t.subScalar(.5),n.addScalar(.5),[t,n]}},{key:"cameraEncompassingBounds",value:function(e){var t=Object(U.a)(e,2),n=t[0],r=t[1],a=n.clone().lerp(r,.5),i=r.x-n.x,o=r.y-n.y,s=Math.max(i,o);return new u.OrthographicCamera(a.x-s/2,a.x+s/2,a.y+s/2,a.y-s/2,-100,100)}}]),e}();ji.renderTarget=new u.WebGLRenderTarget(1024,1024),ji.rtBuffer=new Uint8Array(ji.renderTarget.width*ji.renderTarget.height*4),ji.rtCanvas=function(){var e=document.createElement("canvas");return e.width=ji.renderTarget.width,e.height=ji.renderTarget.height,e}();var xi=ji,Ci=n(181),Si=n(61);function Pi(e){var t=e.world,n=e.vignettes,r=Array.from(t.mpEarners.entries()).filter((function(e){var t=Object(U.a)(e,2);t[0];return t[1]>0})),a=r.length>0;return{mpEarners:t.mpEarners,mutationPointsPerEpoch:r.map((function(e){return Object(U.a)(e,2)[1]})).reduce((function(e,t){return e+t}),0),status:a?"won":"lost",vignettes:n,world:t}}var Mi={},Ti={},Ni={KeyW:{type:"move",dir:ae.a.n},KeyA:{type:"move",dir:ae.a.w},KeyS:{type:"move",dir:ae.a.s},KeyD:{type:"move",dir:ae.a.e}},Ri=(Object.keys(Ni).map((function(e){return Ni[e]})),function(){function e(t){var n=this;Object(C.a)(this,e),this.mito=t,this.handleMouseDown=function(e){if(e.target===n.mito.canvas){if(n.mito.isPaused)return void(0===e.button?n.mito.pausedInspectedTile=n.mito.getTileAtScreen():2===e.button&&(n.mito.pausedInspectedTile=void 0));if(null!=n.mito.inspectedCell)return void(n.mito.inspectedCell=void 0);0===e.button?n.leftClick():2===e.button&&n.rightClick()}},this.handleKeyDown=function(e){var t=n.mito,r=e.code;if(!e.repeat){if("Space"===r)return void(t.isPaused=!t.isPaused);Ti[r]?t.world.player.setAction(Ti[r]):null!=t.inspectedCell&&"Escape"===r&&(t.inspectedCell=void 0)}t.toolBar.keyDown(e)},window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("mousedown",this.handleMouseDown)}return Object(S.a)(e,[{key:"destroy",value:function(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("mousedown",this.handleMouseDown)}},{key:"animate",value:function(e){var t=this.mito,n=this.keysToMovement(Da.keyMap);n&&t.world.player.setAction(n);var r=!0,a=!1,i=void 0;try{for(var o,s=Da.keyMap[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;Mi[l]&&t.world.player.setAction(Mi[l])}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}switch(this.mito.mouse.button){case 0:this.leftClickHold()}}},{key:"keysToMovement",value:function(e){var t=new u.Vector2,n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;Ni[s]&&t.add(Ni[s].dir)}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return 0===t.x&&0===t.y?null:{type:"move",dir:t}}},{key:"leftClick",value:function(){var e=this.mito,t=e.highlightedTile;if(null!=t){var n=e.toolBar.leftClick(t);null==n||Ba(n)||e.world.player.setAction(n)}}},{key:"rightClick",value:function(){var e=this.mito.highlightedTile;null!=e&&e instanceof X.b&&(Da.keyMap.delete("KeyW"),Da.keyMap.delete("KeyS"),Da.keyMap.delete("KeyA"),Da.keyMap.delete("KeyD"),this.mito.inspectedCell=e)}},{key:"leftClickHold",value:function(){var e=this.mito,t=e.highlightedTile;if(null!=t){var n=e.toolBar.leftClick(t);null!=n&&Ba(n)&&e.world.player.setAction(n)}}},{key:"wouldLeftClickInteract",value:function(){var e,t=this.mito,n=t.highlightedTile,r=n&&(null===(e=t.toolBar.leftClick(n))||void 0===e?void 0:e.type);return"pickup"===r||"drop"===r}}]),e}()),Fi=function(){function e(t){var n=this;Object(C.a)(this,e),this.mito=t,this.handleKeyDown=function(e){"Space"===e.code&&n.popOut()},window.addEventListener("keydown",this.handleKeyDown)}return Object(S.a)(e,[{key:"destroy",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"animate",value:function(e){0===this.mito.mouse.button&&this.handleLeftClick()}},{key:"popOut",value:function(){this.mito.world.playerSeed&&this.mito.world.time>3&&(this.mito.world.playerSeed.popOut(),this.mito.controls=new Ri(this.mito))}},{key:"handleLeftClick",value:function(){if(this.mito.highlightedPosition){var e=this.mito.highlightedPosition.round();this.mito.world.playerSeed.pos.distanceTo(e)<.5&&this.popOut()}}},{key:"wouldLeftClickInteract",value:function(){return!1}}]),e}(),Di=n(98),Bi=function(){function e(t){Object(C.a)(this,e),this.mito=t,this.tools={KeyQ:Ii},this.currentKey="KeyQ";var n=t.world.genome.cellTypes.filter((function(e){return 0===e.getDuplicateGenes().size}));for(var r in n){var a=n[r];if(0===a.getDuplicateGenes().size){var i=e.DIGIT_KEYS[r];this.tools[i]=zi(a)}}}return Object(S.a)(e,[{key:"isInteract",value:function(){return this.currentTool===Ii}},{key:"leftClick",value:function(e){return this.currentTool.leftClick(e)}},{key:"rightClick",value:function(e){return this.currentTool.rightClick(e)}},{key:"setKey",value:function(e){if(e in this.tools){var t,n;if(e===this.currentKey)null===(t=(n=this.currentTool).nextConfiguration)||void 0===t||t.call(n);this.currentKey=e}}},{key:"keyDown",value:function(e){"Escape"===e.code&&"KeyQ"!==this.currentKey?this.setKey("KeyQ"):this.shouldCapture(e)&&this.setKey(e.code)}},{key:"shouldCapture",value:function(e){return!e.repeat&&e.code in this.tools}},{key:"currentTool",get:function(){return this.tools[this.currentKey]}}]),e}();Bi.DIGIT_KEYS=["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8"];var Ii={name:"Interact",type:"interact",leftClick:function(e){return Object(Di.a)(e)?e.interact(null):void 0},rightClick:function(e){return{type:"deconstruct",position:e.pos}}};function zi(e){return{name:e.name,type:"build",cellType:e,leftClick:function(t){var n;return e.args&&(n=Object(Q.a)({},e.args)),{type:"build",cellType:e,position:t.pos.clone(),args:n}},rightClick:function(e){},nextConfiguration:function(){e.rotateArgDirection()}}}var Gi=function(){function e(t,n,r){Object(C.a)(this,e),this.mito=t,this.positionFn=n,this.renderFn=r,this.uuid=we()()}return Object(S.a)(e,[{key:"render",value:function(){var e,t=this.positionFn();if(null==t)return null;if(t instanceof u.Vector2){var n=t,r=this.mito.worldToScreen(n);e={left:r.x,top:r.y}}else{var i=t,o=i.pos.clone().addScalar(-.5),s=i.pos.clone().addScalar(.5),l=this.mito.worldToScreen(o),c=this.mito.worldToScreen(s),h=l.x,d=l.y;e={left:h,top:d,width:c.x-h,height:c.y-d}}return a.a.createElement("div",{key:this.uuid,style:e},this.renderFn())}}]),e}(),Li=function(e){var t,n=e.className,i=e.children,o=e.mito,s=e.positionFn,l=Object(r.useRef)(we()()),c=s();if(null==c)return null;if(c instanceof u.Vector2){var h=c,d=o.worldToScreen(h);t={left:d.x,top:d.y}}else{var f=c,v=f.pos.clone().addScalar(-.5),m=f.pos.clone().addScalar(.5),p=o.worldToScreen(v),y=o.worldToScreen(m),g=p.x,b=p.y;t={left:g,top:b,width:y.x-g,height:y.y-b}}return a.a.createElement("div",{key:l.current,style:t,className:Le()("world-dom-component",n)},i)},Wi=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(a)))).rafid=void 0,n.animate=function(e){n.props.a(e/1e3)},n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.rafid=Cn.a.addAnimation(this.animate)}},{key:"componentWillUnmount",value:function(){this.rafid&&Cn.a.removeAnimation(this.rafid)}}]),t}(a.a.Component),Vi=function(e){function t(){return Object(C.a)(this,t),Object(yt.a)(this,Object(gt.a)(t).apply(this,arguments))}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.props.parent.add(this.props.object)}},{key:"componentWillUnmount",value:function(){this.props.parent.remove(this.props.object)}}]),t}(r.PureComponent),Ui=function(){var e=new u.PlaneBufferGeometry(1,1),t=new u.MeshBasicMaterial({side:u.DoubleSide,color:16777215,transparent:!0,opacity:.5}),n=new u.Mesh(e,t);return n.name="Build Blueprint",n.position.z=1,n}(),Hi=function(e){var t=e.x,n=e.y,a=e.cellType,i=e.scene,o=r.useMemo((function(){return Ui.clone()}),[]);return r.useEffect((function(){o.position.x=t,o.position.y=n}),[o.position.x,o.position.y,t,n]),r.useEffect((function(){var e=a.material,t=e.color,n=e.texturePosition,r=lr(n.x,n.y),i=o.material;i.map=r,i.color.set(t||new u.Color(1,1,1)),i.needsUpdate=!0}),[a,o.material]),r.createElement(Vi,{object:o,parent:i})},Qi=ar((function(){var e=new u.CircleBufferGeometry(.1,20),t=new u.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.75,side:u.DoubleSide}),n=new u.Mesh(e,t);return n.position.z=10,n})),Yi=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(a)))).object=Qi().clone(),n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(Vi,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),Ki=ar((function(){var e=new u.PlaneBufferGeometry(1,1),t=new u.EdgesGeometry(e,1),n=new u.LineBasicMaterial({color:16777215,transparent:!0,opacity:.75}),r=new u.LineSegments(t,n);return r.position.z=10,r})),Xi=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(a)))).object=Ki().clone(),n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this;return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(Wi,{a:function(t){return e.object.scale.setScalar(.04*Math.sin(3.7*t)+.94)}}),r.createElement(Vi,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent);function Zi(e,t){var n,r=new Set,a=!0,i=!1,o=void 0;try{for(var s,l=e.entities()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var u=s.value;if(u instanceof c.i&&(n=u,e.player.isWalkable(n))){var h=!0,d=!1,f=void 0;try{for(var v,m=e.tileNeighbors(u.pos)[Symbol.iterator]();!(h=(v=m.next()).done);h=!0){var p=Object(U.a)(v.value,2)[1];e.player.canBuildAt(p)&&(null==t?r.add(p):t(p)&&r.add(p))}}catch(y){d=!0,f=y}finally{try{h||null==m.return||m.return()}finally{if(d)throw f}}}}}catch(y){i=!0,o=y}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r}n(309);var Ji=function(e){function t(){return Object(C.a)(this,t),Object(yt.a)(this,Object(gt.a)(t).apply(this,arguments))}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props.mito.world.player.isTakingLongAction(),t=Da.keyMap.has("ShiftLeft");if(e||t)return null;var n=this.props.mito,a=n.highlightedPosition,i=n.highlightedTile;return this.props.mito.isPaused&&(i=this.props.mito.getTileAtScreen()),r.createElement(r.Fragment,null,a?r.createElement(Yi,{x:a.x,y:a.y,scene:this.scene}):null,this.maybeRenderBuildBlueprint(i),this.maybeRenderTileHighlight(i),this.maybeRenderTutorialBuildHighlights(i))}},{key:"maybeRenderTileHighlight",value:function(e){var t;if(null!=e){var n=null===(t=this.props.mito.toolBar.leftClick(e))||void 0===t?void 0:t.type;return"pickup"===n||"drop"===n?r.createElement(Xi,{x:e.pos.x,y:e.pos.y,scene:this.props.mito.scene}):null}}},{key:"maybeRenderBuildBlueprint",value:function(e){var t=this.props.mito;if(null!=e&&!t.isPaused){var n=t.toolBar.leftClick(e);if(null!=n&&"build"===n.type){var a=t.world.player.canBuildAt(e);return r.createElement(r.Fragment,null,r.createElement(Li,{className:Le()("build-drop-shadow",{valid:a}),mito:t,positionFn:function(){return e}}),r.createElement(Hi,{x:e.pos.x,y:e.pos.y,cellType:n.cellType,scene:this.props.mito.scene}))}}}},{key:"maybeRenderTutorialBuildHighlights",value:function(e){var t=this.props.mito;if(null!=e&&!t.isPaused&&t.isFirstPlaythrough){var n=t.toolBar.leftClick(e);if(null!=n&&"build"===n.type){var a=[],i=!0,o=!1,s=void 0;try{for(var l,c=Zi(this.props.mito.world)[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value;a.push(r.createElement(Xi,{key:u.pos.x+","+u.pos.y,x:u.pos.x,y:u.pos.y,scene:this.scene}))}}catch(h){o=!0,s=h}finally{try{i||null==c.return||c.return()}finally{if(o)throw s}}return a}}}},{key:"scene",get:function(){return this.props.mito.scene}}]),t}(r.Component);function qi(e){var t=e.hotkey,n=e.className,a=e.onClick,i=Object(Ue.a)(e,["hotkey","className","onClick"]);return r.createElement("div",Object.assign({className:Le()("mito-hud-button",n),onClick:function(e){a&&a(e),function(e){e.preventDefault(),document.getElementsByTagName("canvas")[0].focus()}(e)}},i),r.createElement("span",{className:"mito-hud-button-hotkey"},t))}n(310);var _i=r.memo((function(e){var t=e.water,n=e.sugar,a=e.capacity,i=e.className,o=e.colored,s=void 0===o||o,l=e.format,c=e.capacityBasedWidth;if(0===a)return null;var u=n/a,h=1-(t+n)/a,d={width:"".concat(100*(t/a),"%")},f={width:"".concat(100*u,"%")},v={width:"".concat(100*h,"%")},m="text"===l?r.createElement(r.Fragment,null,r.createElement("span",{className:"text water"},r.createElement(On.a,{speed:.5,value:t})," water"),"\xa0",r.createElement("span",{className:"text sugar"},r.createElement(On.a,{speed:.5,value:n})," sugar")):r.createElement(r.Fragment,null,t>0||0===t&&0===n?r.createElement("span",{className:"text water"},n>0?r.createElement(cr.a,{name:"water"}):null," ",r.createElement(On.a,{speed:.5,value:t})):null,n>0?r.createElement("span",{className:"text sugar"},r.createElement(cr.a,{name:"sugar"})," ",r.createElement(On.a,{speed:.5,value:n})):null),p={width:c?10*a:void 0};return r.createElement("div",{className:Le()("inventory-bar-container",i)},r.createElement("div",{className:"inventory-bar",style:p},r.createElement("div",{style:d,className:"bar-water"}),r.createElement("div",{style:f,className:"bar-sugar"}),r.createElement("div",{style:v,className:"bar-empty"}),c?r.createElement("div",{className:"markers"}):null),r.createElement("div",{className:Le()("inventory-text",{colored:s})},m))})),$i=(n(311),{Freezing:"darkblue",Cold:"lightblue",Mild:"lightgray",Hot:"orange",Scorching:"red"}),eo=function(e){for(var t=e.tile,n=[],a=0;a<96;a+=32/3){var i=(a+(a+32/3))/2,o=Object(J.d)(i,0,96,-210,30),s=r.createElement("div",{key:o,className:"temperature-scale",style:{transform:"rotate(".concat(o,"deg)"),borderRight:"".concat(7.5,"px solid ").concat($i[Object(Ka.c)(i)])}});n.push(s)}var l=Object(J.d)(t.temperatureFloat,0,96,-210,30);return r.createElement(Y.g,{content:r.createElement(r.Fragment,null,r.createElement("b",null,"Temperature")," seeps into your Cells from the outside.")},r.createElement("div",{className:"temperature-gauge"},r.createElement("div",{style:{width:30,height:30}},n,r.createElement("div",{className:"temperature-pointer",style:{transform:"rotate(".concat(l,"deg)")}}),r.createElement("div",{className:"temperature-label"},"\xb0",t.temperatureFloat.toFixed(0)))))};n(312);function to(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return"".concat(Math.max(0,e).toFixed(t),"s")}var no,ro=function(e){function t(){return Object(C.a)(this,t),Object(yt.a)(this,Object(gt.a)(t).apply(this,arguments))}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props.tile;return e?r.createElement("div",{className:"tile-details"},this.tileInfo(e),this.cellInfo(e),this.growingCellInfo(e),this.airInfo(e),this.soilInfo(e),this.fountainInfo(e),this.interactInfo(e)):null}},{key:"interactInfo",value:function(e){if(e instanceof X.b){var t=null!=e.type.interaction?r.createElement("div",{className:"interact-info first"},"Left click - ",Object(X.f)(e.type.interaction),"."):null;return r.createElement("div",{className:"interact-infos"},t,r.createElement("div",{className:"interact-info"},"Right click - more options."))}}},{key:"cellInfo",value:function(e){if(e instanceof X.b){var t=1/e.energyUpkeep,n=null!=t?e.energy*t:null,a=n?r.createElement(r.Fragment,null,"(",Math.floor(n)," seconds remaining)"):null,i=r.createElement(Y.g,{content:"Energy keeps your cell alive, and is used for cell operations."},r.createElement("div",{className:"info-energy"},"\ud83d\udc9a\xa0",Object(er.a)(100*e.energy,3),"% Energy ",a));return r.createElement(r.Fragment,null,i,Da.keyMap.has("ShiftLeft")?r.createElement(r.Fragment,null,"Alive for ",Math.floor(e.age)," seconds."):null,200*e.droopY>1?r.createElement("div",{className:"info-cell"},(200*e.droopY).toFixed(0),"% droop"):null,this.cellEffects(e),this.geneInfos(e))}}},{key:"geneInfos",value:function(e){var t=this;return r.createElement(r.Fragment,null,e.geneInstances.map((function(e,n){return e.isType(f.k)?r.createElement(r.Fragment,{key:n},t.soilAbsorptionInfo(e.state)):e.isType(f.g)?r.createElement(r.Fragment,{key:n},t.photosynthesisInfo(e.state)):e.isType(f.b)||e.isType(f.j)?r.createElement(r.Fragment,{key:n},t.reproducerInfo(e)):e.isType(f.f)?r.createElement(r.Fragment,{key:n},t.osmosisInfo(e.state)):null})))}},{key:"soilAbsorptionInfo",value:function(e){return r.createElement("div",{className:"info-root"},r.createElement("div",null,"Absorbs in ",to(e.cooldown),"."),r.createElement("div",null,e.totalSucked.toFixed(1)," total water absorbed so far."))}},{key:"osmosisInfo",value:function(e){return e.isOsmosising?r.createElement("div",{className:"info-osmosis"},"Osmotic"):null}},{key:"photosynthesisInfo",value:function(e){return r.createElement("div",{className:"info-leaf"},r.createElement("div",null,(100*e.averageChancePerSecond).toFixed(1),"% chance to photosynthesize per second."),r.createElement("div",null,(1/e.averageConversionRate).toFixed(2)," water per sugar."),r.createElement("div",null,e.totalSugarProduced.toFixed(2)," total sugar produced so far."))}},{key:"reproducerInfo",value:function(e){var t=e.state,n=e.props;return r.createElement("div",null,Object(er.a)(t.energyRecieved,3),"/",n.neededEnergy," energy absorbed.")}},{key:"airInfo",value:function(e){if(e instanceof c.a)return r.createElement("div",{className:"info-air"},r.createElement(Y.g,{content:"Sunlight increases photosynthesis rate."},r.createElement("div",null,"\u2600\ufe0f ",Object(er.a)(100*e.sunlight(),2),"%")),r.createElement(Y.g,{content:"CO2 improves the water to sugar ratio."},r.createElement("div",{className:"co2-container"},r.createElement("span",{className:"co2"},"CO",r.createElement("sub",null,"2"))," ",Object(er.a)(100*e.co2(),2),"%")))}},{key:"soilInfo",value:function(e){if(e instanceof c.h)return r.createElement("div",{className:"info-soil"},r.createElement(Y.g,{content:"Deeper soil restricts water movement, is harder to see through, and is less affected by the outside temperature."},r.createElement("div",null,"Depth ",e.depth,".")))}},{key:"fountainInfo",value:function(e){if(e instanceof c.d)return r.createElement("div",{className:"info-fountain"},r.createElement("div",null,to(e.cooldown)," until next water."),r.createElement("div",null,e.waterRemaining," water left."))}},{key:"tileInfo",value:function(e){return r.createElement("div",{className:"info-tile"},r.createElement("div",{className:"info-tile-row"},r.createElement("div",{className:"info-tile-name"},e.displayName),r.createElement(eo,{tile:e}),r.createElement(Y.g,{content:"Inventory is how much water and sugar this Tile can hold."},r.createElement(_i,{water:e.inventory.water,sugar:e.inventory.sugar,capacity:e.inventory.capacity,format:"icons",colored:!1,capacityBasedWidth:!0}))))}},{key:"cellEffects",value:function(e){var t=e.effects;if(t.length>0){var n=t.map((function(e){var t=e.constructor.displayName;return e instanceof X.c?"".concat(Object(er.a)(100*e.percentFrozen,2),"% ").concat(t,"!"):e instanceof X.a?"".concat(t,"! ").concat(Object(er.a)(e.timeToDuplicate,2),"s until spread."):t})).join(", ");return r.createElement("div",{className:"info-cell-effects"},n)}return null}},{key:"growingCellInfo",value:function(e){if(e instanceof X.d)return r.createElement("div",{className:"info-growing-cell"},Object(er.a)(100*e.percentGrown,2),"% grown.")}}]),t}(r.Component),ao=(n(313),function(e){var t=e.cell,n=e.player,r=e.onDone;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"cell-inspector left"},a.a.createElement("div",{className:"buttons"},a.a.createElement("div",{className:"resources"},a.a.createElement("div",{className:"resource-row"},a.a.createElement("button",{disabled:0===n.inventory.water,onMouseUpCapture:function(e){n.inventory.give(t.inventory,t.inventory.space(),0),e.preventDefault(),e.stopPropagation(),r()}},"Give\xa0",a.a.createElement(cr.a,{name:"water"})),a.a.createElement("button",{disabled:0===t.inventory.water,onMouseUpCapture:function(e){t.inventory.give(n.inventory,t.inventory.water,0),e.preventDefault(),e.stopPropagation(),r()}},"Take\xa0",a.a.createElement(cr.a,{name:"water"}))),a.a.createElement("div",{className:"resource-row"},a.a.createElement("button",{disabled:0===n.inventory.sugar,onMouseUpCapture:function(e){n.inventory.give(t.inventory,0,t.inventory.space()),e.preventDefault(),e.stopPropagation(),r()}},"Give\xa0",a.a.createElement(cr.a,{name:"sugar"})),a.a.createElement("button",{disabled:0===t.inventory.sugar,onMouseUpCapture:function(e){t.inventory.give(n.inventory,0,t.inventory.sugar),e.preventDefault(),e.stopPropagation(),r()}},"Take\xa0",a.a.createElement(cr.a,{name:"sugar"})))))),a.a.createElement("div",{className:"cell-inspector right"},a.a.createElement("button",{className:"deconstruct",onClick:function(){return n.setAction({type:"deconstruct",position:t.pos})}},"Deconstruct")))}),io=n(182),oo=(n(314),function(e){var t,n,i=e.mito,o=a.a.useState(!1),s=Object(U.a)(o,2),l=s[0],c=s[1],u=a.a.useCallback((function(){c(!1)}),[]),h=a.a.useCallback((function(){c(!0)}),[]),d=a.a.useCallback((function(){return c((function(e){return!e}))}),[]),f=a.a.useCallback((function(){i.onWinLoss(Pi(i))}),[i]);t="Escape",n=d,r.useEffect((function(){var e=function(e){t===e.code&&n(e)};return window.addEventListener("keyup",e),function(){window.removeEventListener("keyup",e)}}),[n,t]);var v=a.a.createElement("div",null,a.a.createElement("div",{className:"option abandon",onClick:f},i.isFirstPlaythrough?"Restart":"Abandon"," Plant"));return a.a.createElement(a.a.Fragment,null,a.a.createElement("button",{className:"game-menu-toggle game-options-button",onClick:h},a.a.createElement(io.a,null)),a.a.createElement(Y.a,{isOpen:l,onClose:u,canEscapeKeyClose:!1,canOutsideClickClose:!1,className:"bp3-dark",backdropClassName:"game-menu-backdrop"},a.a.createElement("div",{className:"game-menu"},a.a.createElement(Y.e,{defaultSelectedTabId:"menu"},a.a.createElement("div",{className:"esc",onClick:u},a.a.createElement(Jn.a,null)),a.a.createElement(Y.d,{id:"menu",title:"Menu",panel:v}),a.a.createElement(Y.d,{id:"attr",title:"Attribution",panel:a.a.createElement(so,null)})))))}),so=function(){return a.a.createElement("div",{className:"attribution"},a.a.createElement("p",null,"In-game Tileset:"," ",a.a.createElement("a",{href:"http://kenney.nl/assets?s=roguelike",target:"_blank",rel:"noopener noreferrer"},"Kenney.nl Roguelike Assets")),a.a.createElement("p",null,"Photosynthesis pop sound:"," ",a.a.createElement("a",{href:"http://soundbible.com/2067-Blop.html",target:"_blank",rel:"noopener noreferrer"},"Blop by Mark DiAngelo")," ","(",a.a.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/us/"},"CC BY 3.0 US"),")"),a.a.createElement("p",null,"Fruit icon:"," ",a.a.createElement("a",{href:"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm"},"Designed by Freepik")),a.a.createElement("p",null,"Part of 7drl 2018:"," ",a.a.createElement("a",{href:"http://7drl.org/",target:"_blank",rel:"noopener noreferrer"},"http://7drl.org/")))},lo=(n(315),r.memo((function(e){var t=e.invalidAction,n=we()();return r.createElement("div",{className:"hud-below-center"},r.createElement("div",{className:"invalid-action",key:n},t.message))}))),co=function(e){var t=e.mito,n=e.tile,r=a.a.useCallback((function(){return n}),[n]);return a.a.createElement(Li,{mito:t,positionFn:r,className:"paused-popover"},a.a.createElement(Y.b,{content:a.a.createElement(ro,{key:n.toString(),tile:n}),usePortal:!1,autoFocus:!1,isOpen:!0,minimal:!0},a.a.createElement("span",null)))},uo=(n(316),no={},Object(L.a)(no,Ka.a.Freezing,r.createElement(r.Fragment,null,"Cells may freeze! Cells operate 50% slower, you walk 50% slower.")),Object(L.a)(no,Ka.a.Cold,r.createElement(r.Fragment,null,"Cells operate 33% slower, you walk 33% slower.")),Object(L.a)(no,Ka.a.Mild,null),Object(L.a)(no,Ka.a.Hot,r.createElement(r.Fragment,null,"Cells operate 25% faster, you walk 25% faster.")),Object(L.a)(no,Ka.a.Scorching,r.createElement(r.Fragment,null,"Cells evaporate water! Cells operate 50% faster, you walk 50% faster.")),no),ho=r.createElement(r.Fragment,null,"There are sixty seconds per day.",r.createElement("br",null),r.createElement("br",null),"There are three days per month.");function fo(e){var t=e.time,n=e.season,a=e.temperature,i=Object(Ka.c)(a),o=uo[i],s=null!=o?r.createElement(Y.g,{content:o},r.createElement("div",{className:Le()("temperature-label",i)},"\xb0",a.toFixed(0)," - ",i)):r.createElement("div",{className:Le()("temperature-label",i)},"\xb0",a.toFixed(0));return r.createElement("div",{className:"seasons-tracker"},r.createElement("div",{className:"season-display"},n.year>0?r.createElement(r.Fragment,null,"Year ",n.year+1,", "):null,I[n.season],", Month ",n.month,r.createElement("br",null),"Day ",n.day,r.createElement("br",null),s),r.createElement(Y.g,{content:ho},r.createElement("div",{className:"time"},new Date(1e3*t).toISOString().substr(14,5))))}n(317);var vo=function(e){var t=e.bar,n=Object.keys(t.tools);return r.createElement("div",{className:"tool-bar"},r.createElement("div",{className:"tool-bar-items"},n.map((function(e){return r.createElement(mo,{key:e,bar:t,code:e,selected:t.currentKey===e,tool:t.tools[e]})}))))},mo=function(e){var t=e.bar,n=e.code,a=e.selected,i=e.tool,o=r.useCallback((function(){t.setKey(n)}),[t,n]),s="interact"===i.type?r.createElement(ur,{onClick:o,className:"interact-tool-icon"},i.name):r.createElement(po,{onClick:o,tool:i,spritesheetLoaded:ir}),l=n.charAt(n.length-1);return r.createElement("div",{className:Le()("tool-bar-item",{selected:a})},s,r.createElement(qi,{className:"mito-hud-build-item",hotkey:l,onClick:o}))},po=function(e){var t=e.onClick,n=e.spritesheetLoaded,a=[],i=e.tool.cellType;return i.args&&i.args.direction&&a.push(r.createElement(yo,{key:a.length,dir:i.args.direction})),r.createElement(hr,{onClick:t,cellType:i,spritesheetLoaded:n,showCosts:Da.keyMap.has("ShiftLeft")},i.name,a)},yo=function(e){var t=e.dir;return r.createElement("div",{className:"transport-dir-arrow",style:{transform:"rotate(".concat(t.angle(),"rad)")}})},go=(n(318),function(e){var t=e.mito,n=e.isViewerOpen,a=r.useState(0),i=Object(U.a)(a,2),o=i[0],s=i[1],l=r.useCallback((function(e){e===o&&s((function(e){return e+1}))}),[o]);return r.createElement("div",{className:"hud-left"},Eo.map((function(e,a){return r.createElement(ko,{mito:t,active:o===a,isViewerOpen:n,Step:e,index:a,isFirst:0===a,onDone:l,key:a})})))});function bo(e,t,n){return function(e,t){var n=r.useState(0),a=Object(U.a)(n,2),i=a[0],o=a[1];return r.useEffect((function(){var n=function(e){t(e)&&o((function(e){return e+1}))};return e.on("action",n),function(){e.off("action",n)}})),i}(e,t)/n}var wo=function(e){return function(t){return"build"===t.type&&t.cellType.name===e}},Eo=[function(e){var t=e.player;return(0,e.setPercentDone)(bo(t,(function(e){return"move"===e.type}),120)),r.createElement(r.Fragment,null,"Move - ",r.createElement(qi,{hotkey:"W"}),r.createElement(qi,{hotkey:"A"}),r.createElement(qi,{hotkey:"S"}),r.createElement(qi,{hotkey:"D"}))},function(e){var t=e.player;return(0,e.setPercentDone)(bo(t,wo("Tissue"),3)),r.createElement(r.Fragment,null,"Grow Tissue - ",r.createElement(qi,{hotkey:"1"}),", click."," ")},function(e){var t=e.player;return(0,e.setPercentDone)(bo(t,wo("Root"),4)),r.createElement(r.Fragment,null,"Grow Roots - ",r.createElement(qi,{hotkey:"3"}),", click Soil.")},function(e){var t=e.player;return(0,e.setPercentDone)(bo(t,(function(e){return"pickup"===e.type&&e.target instanceof X.b&&"Root"===e.target.displayName}),14)),r.createElement(r.Fragment,null,"Take water from Roots - ",r.createElement(qi,{hotkey:"Q"}),", click Root.")},function(e){var t=e.player;return(0,e.setPercentDone)(bo(t,wo("Leaf"),4)),r.createElement(r.Fragment,null,"Grow Leaves - ",r.createElement(qi,{hotkey:"2"}),", click Air.")},function(e){var t=e.player;return(0,e.setPercentDone)(bo(t,(function(e){return"drop"===e.type&&e.target instanceof X.b&&"Leaf"===e.target.displayName}),14)),r.createElement(r.Fragment,null,"Put water in Leaf - ",r.createElement(qi,{hotkey:"Q"}),", click Leaf.")},function(e){var t=e.player,n=e.setPercentDone,a=r.useState(0),i=Object(U.a)(a,2),o=i[0],s=i[1];return r.useEffect((function(){var e=function(e){var t=e.events.photosynthesis.reduce((function(e,t){return t.sugarMade+e}),0);s((function(e){return e+t}))};return t.world.on("step",e),function(){t.world.off("step",e)}}),[t.world]),n(o/4),r.createElement(r.Fragment,null,"Wait for Photosynthesis.")},function(e){var t=e.player;return(0,e.setPercentDone)(bo(t,wo("Seed"),1)),r.createElement(r.Fragment,null,"Grow Seed - ",r.createElement(qi,{hotkey:"4"}),", click.")},function(e){var t=e.player,n=e.setPercentDone,a=e.active;return n(bo(t,(function(e){return a&&"drop"===e.type&&e.target instanceof X.b&&"Tissue"===e.target.displayName}),7)),r.createElement(r.Fragment,null,"Feed Tissue - ",r.createElement(qi,{hotkey:"Q"}),", click Tissue.")},function(e){var t,n,a,i=e.player;return(0,e.setPercentDone)((null!==(t=null===(n=Array.from(i.world.mpEarners.keys())[0])||void 0===n?void 0:null===(a=n.findGene(f.j))||void 0===a?void 0:a.state.energyRecieved)&&void 0!==t?t:0)/100),r.createElement(r.Fragment,null,"Get seed to 150 energy.")}],ko=function(e){var t=e.mito,n=e.active,a=e.index,i=e.isViewerOpen,o=e.isFirst,s=e.Step,l=e.onDone,c=r.useState(0),u=Object(U.a)(c,2),h=u[0],d=u[1],f=Math.min(h,1),v=f>=1;r.useEffect((function(){v&&l(a)}),[n,a,v,l]);var m={width:"".concat((100*f).toFixed(1),"%")};return o&&(m.transition="unset"),r.createElement("div",{className:Le()("instruction",{active:n,first:o,done:v})},r.createElement("div",{className:"background-fill",style:m}),r.createElement("div",{className:"instruction-content"},r.createElement(s,{player:t.world.player,setPercentDone:d,active:n,isViewerOpen:i})))},Oo=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(a)))).state={isViewerOpen:!1},n.handleKeyDown=function(e){"Tab"===e.code&&n.setState({isViewerOpen:!n.state.isViewerOpen})},n.positionFn=function(){var e;return null!==(e=n.mito.inspectedCell)&&void 0!==e?e:null},n.handleCellInspectorDone=function(){n.mito.inspectedCell=void 0},n.handleDragEnd=function(){},n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this.inventory.isMaxed(),t=r.createElement("div",{className:"mito-inventory-maxed".concat(e?" is-maxed":"")},"maxed"),n=null==this.world.playerSeed,a=this.mito.isFirstPlaythrough;return r.createElement(r.Fragment,null,a?null:r.createElement("div",{className:"hex-title"},this.mito.attempt.targetHex.displayName),r.createElement("div",{className:Le()("hud-top-center")},r.createElement(fo,{time:this.world.time,season:this.world.season,temperature:this.world.weather.getCurrentTemperature()})),r.createElement(oo,this.props),this.maybeRenderSpeciesViewer(),this.maybeRenderCollectButton(),this.maybeRenderWinShine(),this.maybeRenderGerminateButton(),this.maybeRenderPausedUI(),this.maybeRenderInvalidAction(),this.maybeRenderTutorial(),r.createElement("div",{className:Le()("hud-bottom-right",{hidden:!n})},this.mito.isPaused?this.mito.pausedInspectedTile?null:r.createElement(ro,{tile:this.mito.getTileAtScreen()}):r.createElement(ro,{tile:this.mito.highlightedTile}),r.createElement("div",{className:"player-inventory-container"},t,r.createElement(_i,{water:this.inventory.water,sugar:this.inventory.sugar,capacity:this.inventory.capacity,format:"icons",className:"player-inventory-bar"})),r.createElement(vo,{bar:this.mito.toolBar})),this.maybeRenderCellInspector())}},{key:"maybeRenderCellInspector",value:function(){var e=this.mito.inspectedCell;if(null!=e)return r.createElement(Li,{mito:this.mito,positionFn:this.positionFn},r.createElement(ao,{cell:e,player:this.player,onDone:this.handleCellInspectorDone}))}},{key:"maybeRenderInvalidAction",value:function(){var e=this.mito.invalidAction;if(null!=e)return r.createElement(lo,{invalidAction:e})}},{key:"maybeRenderGerminateButton",value:function(){var e=this,t=function(){var t=e.mito.controls;t instanceof Fi&&t.popOut()};if(null!=this.world.playerSeed)return r.createElement("div",{className:"hud-germinate",onClick:t},r.createElement("p",null,"Germinate"),r.createElement(qi,{hotkey:"Space",onClick:t}))}},{key:"maybeRenderCollectButton",value:function(){var e=this,t=Pi(this.mito);if("won"===t.status)return r.createElement("div",{className:"hud-right-of-time"},r.createElement(bn,{color:"purple",onClick:function(){return e.mito.onWinLoss(t)}},"Win (+ ",t.mutationPointsPerEpoch," MP per epoch)"))}},{key:"maybeRenderWinShine",value:function(){if("won"===Pi(this.mito).status)return r.createElement("div",{className:"win-shine"})}},{key:"maybeRenderSpeciesViewer",value:function(){if(this.state.isViewerOpen)return r.createElement("div",{className:"hud-top"},r.createElement(Zn.a,{onDragEnd:this.handleDragEnd},r.createElement(Tr,{speciesId:this.mito.world.species.id})))}},{key:"maybeRenderPausedUI",value:function(){if(this.mito.isPaused){var e=this.mito.pausedInspectedTile,t=null==e?r.createElement("div",{className:"mouse-position",style:{left:this.mito.mouse.position.x,top:this.mito.mouse.position.y}},r.createElement("span",{className:"click-to-inspect"},null==e?"Click to inspect.":null)):null,n=null!=e?r.createElement(co,{mito:this.mito,tile:e}):null;return r.createElement(r.Fragment,null,r.createElement("div",{className:"paused"},"Paused"),t,n)}}},{key:"maybeRenderTutorial",value:function(){var e=null==this.world.playerSeed;if(this.mito.isFirstPlaythrough&&e)return r.createElement(go,Object.assign({},this.props,{isViewerOpen:this.state.isViewerOpen}))}},{key:"mito",get:function(){return this.props.mito}},{key:"world",get:function(){return this.mito.world}},{key:"player",get:function(){return this.world.player}},{key:"inventory",get:function(){return this.player.inventory}}]),t}(r.Component);var Ao=Object(r.memo)((function(e){var t=e.world,n=e.time,i=Object(r.useRef)(0),o=Object(r.useRef)(0),s=n-i.current,l=0,c=0,u=0,h=0,d=0,v=0,m=!0,p=!1,y=void 0;try{for(var g,b=t.allCells()[Symbol.iterator]();!(m=(g=b.next()).done);m=!0){var w=g.value;l+=w.inventory.water,c+=w.inventory.sugar,u+=w.energy,h++;var E=w.findGene(f.k);E&&(d+=E.state.totalSucked);var k=w.findGene(f.g);k&&(v+=k.state.totalSugarProduced)}}catch(S){p=!0,y=S}finally{try{m||null==b.return||b.return()}finally{if(p)throw y}}var O=(o.current-u)/s,A=O*N.m,j=u/O,x=d/t.time*N.m,C=v/t.time*N.m;return o.current=u,i.current=n,a.a.createElement("div",{className:"plant-stats",style:{margin:"10px 0",textAlign:"left"}},a.a.createElement("div",null,Object(er.a)(l,3)," ",a.a.createElement(cr.a,{name:"water"}),",",Object(er.a)(c,3)," ",a.a.createElement(cr.a,{name:"sugar"})),a.a.createElement("div",null,"Water per season: ",Object(er.a)(x,3)),a.a.createElement("div",null,"Sugar per season: ",Object(er.a)(C,3)),a.a.createElement("div",null,"Total energy: ",Object(er.a)(u,4)),a.a.createElement("div",null,"Average energy: ",Object(er.a)(u/h*100,2),"%"),a.a.createElement("div",null,"Sugar use per season: ",Object(er.a)(A,3)),a.a.createElement("div",null,"Time until starvation: ",Object(er.a)(j,3)," seconds."))})),jo=function(e){var t=e.mito,n=r.useCallback((function(){t.onWinLoss({mpEarners:t.world.mpEarners,world:t.world,status:"won",mutationPointsPerEpoch:1,vignettes:t.vignettes})}),[t]),a=r.useCallback((function(){t.onWinLoss({mpEarners:t.world.mpEarners,world:t.world,status:"lost",mutationPointsPerEpoch:0,vignettes:t.vignettes})}),[t]),i=r.useCallback((function(){t.world.player.inventory.add(5,0)}),[t.world.player.inventory]),o=r.useCallback((function(){t.world.player.inventory.add(0,5)}),[t.world.player.inventory]);return r.createElement("div",{style:{position:"absolute",bottom:0,left:0,background:"white"}},r.createElement("div",{style:{display:"flex"}},r.createElement(bn,{color:"green",onClick:n},"Win"),r.createElement(bn,{color:"green",onClick:a},"Lose")),r.createElement("div",{style:{display:"flex"}},r.createElement(bn,{onClick:i},"+5 ",r.createElement(cr.a,{name:"water"})),r.createElement(bn,{onClick:o},"+5 ",r.createElement(cr.a,{name:"sugar"}))),r.createElement(Ao,{world:t.world,time:Math.floor(t.world.time)}),r.createElement("div",null,r.createElement("div",null,"Rainwater: ",t.world.numRainWater),r.createElement("div",null,"Recharged water: ",t.world.numRechargedWater),r.createElement("div",null,"Evaporated Air: ",t.world.numEvaporatedAir),r.createElement("div",null,"Evaporated Soil: ",t.world.numEvaporatedSoil)),r.createElement("div",{style:{background:"white"}},Array.from(Da.keyMap.values()).join(", ")))};n(319);var xo=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(yt.a)(this,Object(gt.a)(t).call(this,"f"))).time=e,n.uv=new Si.h,n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"generate",value:function(e,n){var r=e.include(t.ovalOutFn);return e.format(r+"( "+this.uv.build(e,"v2")+", "+this.time.build(e,"f")+" )",this.getType(e),n)}}]),t}(Si.g);xo.ovalOutFn=new Si.b("\nfloat ovalOut(vec2 vUv, float time) {\n    return clamp((time - length(vUv - vec2(0.5))) * 15., 0.0, 1.0);\n}".trim());var Co=function(e){function t(e,n,r,a){var i;Object(C.a)(this,t),(i=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n))).attempt=r,i.onWinLoss=a,i.world=void 0,i.toolBar=void 0,i.scene=Xn(new u.Scene,(function(e){e.background=new u.Color("black")})),i.scenePlayerSeed=new u.Scene,i.camera=new u.OrthographicCamera(0,0,0,0,-100,100),i.mouse=new Lr(i.canvas),i.audioListener=new u.AudioListener,i.highlightedTile=void 0,i.highlightedPosition=void 0,i._inspectedCell=void 0,i.worldRenderer=void 0,i.vignetteCapturer=new xi(Object(xn.a)(i)),i.vignettes=[],i.hackCamera=void 0,i.orbitControls=void 0,i.suggestedCamera=void 0,i.userZoom=void 0,i._controls=void 0,i.nodeFrame=new Si.d(0),i.nodePost=void 0,i.ovalOutTime=void 0,i.stats=new Hr.a,i.isPaused=!1,i.pausedInspectedTile=void 0,i.events={wheel:function(e){var t=-(e.deltaX+e.deltaY)/125/20,n=i.userZoom,r=Math.pow(2,t),a=Object(J.a)(n*r,1,3);i.userZoom=a}},i.handleBeforeUnload=function(){return!0},i.handleContextMenu=function(e){return e.preventDefault(),!1},i.PLAYER_TETHER_DISTANCE=.9,i.worldDomElements=new Set,i.invalidAction=void 0,i.renderer.autoClear=!1,i.nodePost=new Si.e(e),i.ovalOutTime=new Si.a(0);var o=new Si.c(new Si.f,new xo(i.ovalOutTime),i.ovalOutTime,Si.c.MIN);i.nodePost.output=o;var s=r.targetHex.info;return i.world=new ue(Me(s),s.seed,r.settlingSpecies),i.camera.position.z=10,i.camera.lookAt(0,0,0),i.camera.position.x=i.world.player.pos.x,i.camera.position.y=i.world.player.pos.y,i.camera.zoom=i.userZoom=1.5,i.camera.add(i.audioListener),null!=i.hackCamera&&(i.orbitControls=new Ci.a(i.hackCamera,i.canvas),i.scene.add(new u.AxesHelper(25))),i.worldRenderer=new Ai(i.world,i.scene,Object(xn.a)(i)),Object(Ve.n)(i.audioContext),i.updateAmbientAudio(),i.attachWindowEvents(),i.toolBar=new Bi(Object(xn.a)(i)),i.controls=new Fi(Object(xn.a)(i)),i}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"inspectedCell",get:function(){return this._inspectedCell},set:function(e){T.a.showGodUI&&console.trace("set inspectedCell to",e),this._inspectedCell=e}},{key:"isFirstPlaythrough",get:function(){return null==this.attempt.sourceHex}},{key:"controls",get:function(){return this._controls},set:function(e){null!=this._controls&&this._controls.destroy(),this._controls=e}}]),Object(S.a)(t,[{key:"attachWindowEvents",value:function(){window.onbeforeunload=this.handleBeforeUnload,window.addEventListener("contextmenu",this.handleContextMenu),window.mito=this,window.THREE=u}},{key:"destroy",value:function(){window.removeEventListener("contextmenu",this.handleContextMenu),this.controls=void 0,window.onbeforeunload=null}},{key:"render",value:function(){if(!T.a.hud)return null;var e=[],t=!0,n=!1,a=void 0;try{for(var i,o=this.worldDomElements[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;e.push(s.render())}}catch(c){n=!0,a=c}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}var l=null==this.world.playerSeed;return r.createElement(r.Fragment,null,r.createElement(Oo,{mito:this}),l?r.createElement(Ji,{mito:this}):null,r.createElement("div",{className:"world-dom-components"},e),T.a.showGodUI?r.createElement(jo,{mito:this}):null,T.a.showFPS?r.createElement(Po,{mito:this}):null)}},{key:"updateAmbientAudio",value:function(){var e=this.world.player.pos.y,t=Object(J.d)(e,this.world.height/2,this.world.height,0,.5),n=Object(J.d)(e,this.world.height/2,0,0,.5);Ve.h.gain.gain.value=Math.max(0,t),Ve.u.gain.gain.value=Math.max(0,n)}},{key:"worldStep",value:function(e){this.world.step(e);var t=function(e){var t=e.world,n=null!=t.playerSeed,r=!0,a=!1,i=void 0;try{for(var o,s=t.allCells()[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value;n=!0;break}}catch(l){a=!0,i=l}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return!n?Pi(e):null}(this);null!=t&&this.onWinLoss(t),this.updateAmbientAudio()}},{key:"getCameraNormCoordinates",value:function(e,t){return new u.Vector2(e/this.canvas.width*2-1,-t/this.canvas.height*2+1)}},{key:"getPlayerInfluenceVector",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.position.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.position.y,n=this.getWorldCoordinates(e,t),r=new u.Vector2(n.x,n.y).sub(this.world.player.posFloat);return r.clampLength(0,this.PLAYER_TETHER_DISTANCE),r}},{key:"getWorldCoordinates",value:function(e,t){var n=this.getCameraNormCoordinates(e,t);return Object(J.k)(new u.Vector3(n.x,n.y,0).unproject(this.camera))}},{key:"getTileAtScreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.position.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.position.y,n=this.getWorldCoordinates(e,t);n.round();var r=this.world.tileAt(n.x,n.y);if(null!=r&&r.lightAmount()>0)return r}},{key:"computeHighlightedPosition",value:function(){if(this.inspectedCell)return this.inspectedCell.pos;var e=this.getPlayerInfluenceVector(),t=this.world.player.posFloat,n=t.x,r=t.y;return e.x+=n,e.y+=r,e}},{key:"computeHighlightedTile",value:function(){var e=this.computeHighlightedPosition();e.round();var t=this.world.tileAt(e.x,e.y);if(null!=t&&t.lightAmount()>0)return t}},{key:"worldToScreen",value:function(e){var t=new u.Vector3(e.x,e.y,0);return t.project(this.camera),t.x=Math.round((.5+t.x/2)*this.canvas.width),t.y=Math.round((.5-t.y/2)*this.canvas.height),t}},{key:"addWorldDOMElement",value:function(e,t){var n=new Gi(this,e,t);return this.worldDomElements.add(n),n}},{key:"removeWorldDOMElement",value:function(e){this.worldDomElements.delete(e)}},{key:"addFloatingText",value:function(){var e=Object(fn.a)(V.a.mark((function e(t,n){var a;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.addWorldDOMElement((function(){return t}),(function(){return r.createElement("div",{className:"floating-text"},n)})),e.next=3,P(1e3);case 3:this.removeWorldDOMElement(a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"showInvalidAction",value:function(){var e=Object(fn.a)(V.a.mark((function e(t){return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.invalidAction=t,e.next=3,P(3e3);case 3:this.invalidAction===t&&(this.invalidAction=void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"animate",value:function(e){var t;this.stats.end(),this.stats.begin(),null===(t=this.controls)||void 0===t||t.animate(e);var n=this.inspectedCell;null!=n&&((n.isDead||n.findEffectOfType(X.a)||n.findEffectOfType(X.c))&&(this.inspectedCell=void 0),null!=this.world.player.getAction()&&(this.inspectedCell=void 0));var r,a=Math.min(e/1e3,1/3);if(this.isPaused||(this.worldStep(a),this.worldRenderer.update(),this.updateCamera(this.suggestedCamera||this.defaultCameraState()),this.pausedInspectedTile=void 0,this.highlightedPosition=this.computeHighlightedPosition(),this.highlightedTile=this.computeHighlightedTile(),null!=this.highlightedTile&&this.worldRenderer.getOrCreateRenderer(this.highlightedTile).updateHover()),this.vignetteCapturer.isTimeForNewCapture()){var i=this.vignetteCapturer.capture();Object(ne.a)("captured",i),this.vignettes.push(i)}if(this.suggestedCamera=void 0,null!=this.hackCamera)this.renderer.render(this.scene,this.hackCamera);else{this.world.time-a<3.5&&this.world.time>3.5&&Ve.w.play(),this.ovalOutTime.value=Object(Gr.a)(Object(J.a)((this.world.time-3.5)/1.5,0,1)),this.nodeFrame.update(e/1e3),this.renderer.clear(),this.nodePost.render(this.scene,this.camera,this.nodeFrame),this.renderer.clearDepth(),this.renderer.render(this.scenePlayerSeed,this.camera)}T.a.debugPerf&&this.frameCount%100===0&&(!function(e){var t=0,n=0;e.scene.traverse((function(e){e.matrixAutoUpdate?t++:n++})),console.log("matrixAutoUpdate: yes",t,", no",n);var r=new Map;e.scene.traverse((function(e){var t=r.get(e.name||e.constructor.name)||[];r.set(e.name||e.constructor.name,t),t.push(e)})),console.log(r)}(this),r=this.renderer,console.log("Geometries in memory: ".concat(r.info.memory.geometries,"\nTextures in memory: ").concat(r.info.memory.textures,"\nNumber of Programs: ").concat(r.info.programs.length,"\n# Render Calls: ").concat(r.info.render.calls,"\n# Render Lines: ").concat(r.info.render.lines,"\n# Render Points: ").concat(r.info.render.points,"\n# Render Tris: ").concat(r.info.render.triangles,"\n")))}},{key:"defaultCameraState",value:function(){if(null==this.world.playerSeed){var e=this.getCameraNormCoordinates(this.mouse.position.x,this.mouse.position.y),t=this.world.player.droopPosFloat().clone();return t.x+=e.x/2,t.y-=e.y/2,{center:t,zoom:this.userZoom}}return{center:this.world.playerSeed.pos,zoom:this.userZoom}}},{key:"updateCamera",value:function(e){var t=e.center,n=e.zoom;Object(J.c)(this.camera.position,t,.2),Math.abs(this.camera.zoom-n)>.001&&(this.camera.zoom=Object(J.b)(this.camera.zoom,e.zoom,.1),this.camera.updateProjectionMatrix())}},{key:"suggestCamera",value:function(e){this.suggestedCamera=e}},{key:"resize",value:function(e,t){var n=t/e;this.camera.left=-12/n,this.camera.right=12/n,this.camera.top=-12,this.camera.bottom=12,this.camera.updateProjectionMatrix(),this.nodePost.setSize(e,t)}}]),t}(Vr);Co.id="mito";var So=Co,Po=function(e){var t=e.mito;return r.useEffect((function(){return document.body.appendChild(t.stats.dom),function(){document.body.removeChild(t.stats.dom)}}),[t.stats.dom]),null},Mo=(n(320),function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(yt.a)(this,Object(gt.a)(t).call(this,e))).frameId=void 0,n.lastTimestamp=0,n.stop=!1,n.handleVolumeButtonClick=function(){var e=!n.state.volumeEnabled;n.setState({volumeEnabled:e}),window.localStorage.setItem("sketch-volumeEnabled",JSON.stringify(e))},n.loop=function(e){var t=e-n.lastTimestamp;n.lastTimestamp=e,n.props.sketch.frameCount++,n.props.sketch.timeElapsed=e,n.syncAudioContext();try{n.props.sketch.animate(t)}catch(r){console.error(r)}n.stop?Cn.a.removeAnimation(n.frameId):n.setState({frameCount:n.props.sketch.frameCount})},n.handleWindowResize=function(){var e=n.props.sketch.renderer;n.updateRendererCanvasToMatchParent(e),null!=n.props.sketch.resize&&n.props.sketch.resize(e.domElement.width,e.domElement.height)},n.handleVisibilityChange=function(){n.syncAudioContext()},n.state={frameCount:e.sketch.frameCount,volumeEnabled:JSON.parse(window.localStorage.getItem("sketch-volumeEnabled")||"true")},n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"shouldPlayAudio",value:function(){return this.state.volumeEnabled&&"visible"===document.visibilityState&&document.hasFocus()}},{key:"syncAudioContext",value:function(){var e=this.props.sketch.audioContext;null!=e&&(this.shouldPlayAudio()&&"suspended"===e.state?e.resume():this.shouldPlayAudio()||"running"!==e.state||e.suspend())}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleWindowResize),document.addEventListener("visibilitychange",this.handleVisibilityChange),this.handleWindowResize();var t=this.props.sketch.renderer.domElement;t.tabIndex=1,Object.keys(Wr).forEach((function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.addEventListener(n,r):t.addEventListener(n,r))}})),this.frameId=Cn.a.addAnimation(this.loop)}},{key:"render",value:function(){var e=[];return null!=this.props.sketch.render&&e.push(this.props.sketch.render()),null!=this.props.sketch.elements&&e.push.apply(e,Object(H.a)(this.props.sketch.elements)),r.createElement("div",{className:"sketch-elements"},e.map((function(e,t){return r.isValidElement(e)?r.cloneElement(e,{key:t}):e})),this.renderVolumeButton())}},{key:"renderVolumeButton",value:function(){if(T.a.hud){var e=this.state.volumeEnabled;return r.createElement("button",{className:"user-volume game-options-button",onClick:this.handleVolumeButtonClick},e?r.createElement(Jn.f,null):r.createElement(Jn.e,null))}}},{key:"componentWillUnmount",value:function(){var e=this;this.stop=!0,this.props.sketch.destroy&&this.props.sketch.destroy(),null!=this.frameId&&Cn.a.removeAnimation(this.frameId),this.props.sketch.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize),document.removeEventListener("visibilitychange",this.handleVisibilityChange);var t=this.props.sketch.canvas;Object.keys(Wr).forEach((function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.removeEventListener(n,r):t.removeEventListener(n,r))}}))}},{key:"updateRendererCanvasToMatchParent",value:function(e){var t=e.domElement.parentElement;null!=t&&e.setSize(t.clientWidth,t.clientHeight)}}]),t}(r.PureComponent)),To=function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(a)))).state={status:{type:"loading"}},n.audioContext=void 0,n.userVolume=void 0,n.handleContainerRef=function(e){var t;if(null!=e)try{var r=n.audioContext=zr.Howler.ctx;u.AudioContext.setContext(r),n.userVolume=r.createGain(),n.userVolume.gain.setValueAtTime(.8,0),n.userVolume.connect(zr.Howler.masterGain),(r.gain=r.createGain()).connect(n.userVolume);var a=new u.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0,antialias:!0});a.debug.checkShaderErrors=!0,e.appendChild(a.domElement);var i=n.props.otherArgs||[],o=Object(U.a)(i,2),s=o[0],l=o[1],c=new So(a,n.audioContext,s,l);n.setState({status:{type:"success",sketch:c}})}catch(h){n.setState({status:{type:"error",error:h}}),console.error(h)}else"success"===n.state.status.type&&n.state.status.sketch.canvas.remove(),null===(t=n.userVolume)||void 0===t||t.disconnect(),n.setState({status:{type:"loading"}})},n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.otherArgs,e.eventsOnBody,e.errorElement,Object(Ue.a)(e,["otherArgs","eventsOnBody","errorElement"])),n=Le()("sketch-component",this.state.status.type);return r.createElement("div",Object.assign({},t,{className:n,ref:this.handleContainerRef}),this.renderSketchOrStatus())}},{key:"renderSketchOrStatus",value:function(){var e=this.state.status;return"success"===e.type?r.createElement(Mo,{sketch:e.sketch,eventsOnBody:this.props.eventsOnBody}):"error"===e.type?this.props.errorElement||this.renderDefaultErrorElement(e.error.message):"loading"===e.type?null:void 0}},{key:"renderDefaultErrorElement",value:function(e){return r.createElement("p",{className:"sketch-error"},"Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.",r.createElement("pre",null,e))}}]),t}(r.PureComponent),No=(n(321),function(e){function t(){var e,n;Object(C.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(yt.a)(this,(e=Object(gt.a)(t)).call.apply(e,[this].concat(a)))).handleDivRef=function(e){null!=e||n.exitFullscreen()},n}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:"full-page-sketch",ref:this.handleDivRef},r.createElement(To,{otherArgs:this.props.otherArgs}))}},{key:"exitFullscreen",value:function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}}]),t}(r.PureComponent)),Ro=(n(322),a.a.memo((function(e){var t=e.onStart;return Object(r.useEffect)((function(){var e=function(e){"Enter"!==e.code&&"Space"!==e.code||t()};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[t]),a.a.createElement("div",{className:"start-screen"},a.a.createElement("h1",null,"Mito",a.a.createElement(Ye,{size:"small",className:"mito-i"})),a.a.createElement("div",{className:"bottom-area"},a.a.createElement(bn,{color:"green",onClick:t},"Start Game"),a.a.createElement("a",{className:"discord",rel:"noopener noreferrer",target:"_blank",href:"http://discord.gg/N8wWwPX"},a.a.createElement(Jn.c,null))),a.a.createElement("div",{className:"game-version"},"v0.8.0-dev"))}))),Fo=function(e){function t(e,n){var r;return Object(C.a)(this,t),(r=Object(yt.a)(this,Object(gt.a)(t).call(this,e,n))).context=void 0,r.handleMousePosition=function(e){r.setState({mousePosition:{x:e.clientX,y:e.clientY}})},r.handleNextEpoch=function(){(0,Object(U.a)(r.context,2)[1])({type:"AANextEpoch"})},r.handleWinLoss=function(e){(0,Object(U.a)(r.context,2)[1])({type:"AATransitionStart",transition:{type:"AAGetGameResult",result:e}})},r.handleResultsDone=function(){(0,Object(U.a)(r.context,2)[1])({type:"AATransitionStart",transition:{type:"AAGameResultDone"}})},r.handleCloseStartScreen=function(){return r.setState({showStartScreen:!1})},r.otherArgsSelector=Object(Fr.a)((function(e){return e.activePopulationAttempt}),(function(e){return[e,r.handleWinLoss]})),r.state={mousePosition:{x:window.innerWidth/2,y:window.innerHeight/2},showStartScreen:!0,error:void 0},r}return Object(bt.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("mousemove",this.handleMousePosition)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.handleMousePosition)}},{key:"render",value:function(){var e=Object(U.a)(this.context,1)[0],t=this.state.error?a.a.createElement(Do,{error:this.state.error,appState:e}):a.a.createElement(a.a.Fragment,null,a.a.createElement(Bo,{show:this.state.showStartScreen},a.a.createElement(Ro,{onStart:this.handleCloseStartScreen})),a.a.createElement(Bo,{show:null==e.activePopulationAttempt&&!this.state.showStartScreen},a.a.createElement(Nr,{onNextEpoch:this.handleNextEpoch})),a.a.createElement(Bo,{show:null!=e.activePopulationAttempt&&null==e.activeGameResult},a.a.createElement(No,{otherArgs:this.otherArgsSelector(e)})),a.a.createElement(Bo,{show:null!=e.activeGameResult},e.activeGameResult?a.a.createElement(et,{attempt:e.activePopulationAttempt,results:e.activeGameResult,onDone:this.handleResultsDone}):a.a.createElement("div",null)));return a.a.createElement(wt.Provider,{value:this.state.mousePosition},a.a.createElement("div",{className:"App"},t))}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),t}(a.a.PureComponent);Fo.contextType=jt;var Do=a.a.memo((function(e){var t=e.error,n=e.appState,i=Object(fe.l)(dn,n),o=Object(r.useRef)(null),s={error:{name:t.name,message:t.message,stack:t.stack},time:new Date,appState:i};return a.a.createElement("div",{className:"app-error"},a.a.createElement("h1",null,"\ud83d\ude22\ud83d\ude22\ud83d\ude22Mito has crashed! \ud83d\ude22\ud83d\ude22\ud83d\ude22"),a.a.createElement("div",{className:"bottom"},a.a.createElement("p",null,"Please report this to the dev team."),a.a.createElement("div",{className:"instructions"},a.a.createElement(bn,{className:"copy",onClick:function(){var e=o.current;e&&(e.select(),document.execCommand("copy"))}},"Copy Error Report"),a.a.createElement("span",{className:"arrow-right"},"\u27a1"),a.a.createElement("a",{className:"discord",rel:"noopener noreferrer",target:"_blank",href:"http://discord.gg/N8wWwPX"},a.a.createElement(Jn.c,null)))),a.a.createElement("textarea",{ref:o,className:"error-textarea",value:JSON.stringify(s,null,2),readOnly:!0}))})),Bo=Object(r.memo)((function(e){var t=e.show,n=e.children,r=xt(),i=Object(U.a)(r,1)[0];return a.a.createElement(Rr.a,{in:t&&null==i.transition,timeout:2e3,mountOnEnter:!0,unmountOnExit:!0,classNames:"fade-to-black"},n)})),Io=function(){return a.a.createElement(Ir,{loadingComponent:a.a.createElement("div",null,"Loading...")},a.a.createElement(Fo,null))};n(144);function zo(e,t){console.log("running");for(var n=new je([new Ae({countAir:function(e){return e.filter((function(e){return e.constructor===c.a})).length}}),new Ae({countSoil:function(e){return e.filter((function(e){return e.constructor===c.h})).length}}),new Ae({countRock:function(e){return e.filter((function(e){return e.constructor===c.g})).length}}),new Ae({countFountain:function(e){return e.filter((function(e){return e.constructor===c.d})).length}}),new Ae({playerY:function(e,t){return t.player.pos.y}}),new Ae({startAdjacentWaters:function(e,t){var n=Zi(t,(function(e){return e instanceof c.h})),r=0,a=!0,i=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){r+=s.value.inventory.water}}catch(u){i=!0,o=u}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r}}),new Ae({countWaters:function(e){return e.reduce((function(e,t){return e+t.inventory.water}),0)}})]),r=0;r<20;r++){console.time("trial "+r);var a=new ue(e,r,ke());n.recordDataFor(Array.from(a.allEnvironmentTiles())),console.timeEnd("trial "+r)}!function(e,t){var n=[],r=e.map((function(e){return e.visitorNames().join("")}));for(var a in r){for(var i=r[a],o=[],s=[],l=0;l<e[0].trials.length;l++){o.push(l);var c=e[a].trials[l][i];s.push(c)}var u={x:o,y:s,name:i,type:"bar"};n.push(u)}var h=document.createElement("div");document.getElementById(t).appendChild(h),window.Plotly.newPlot(h,n,{barmode:"stack"})}(n.experiments.slice(0,4),t);var i=!0,o=!1,s=void 0;try{for(var l,u=n.experiments[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){Go(l.value,t)}}catch(h){o=!0,s=h}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}}function Go(e,t){var n=[],r={},a=!0,i=!1,o=void 0;try{for(var s,l=function(){var t=s.value;u={x:e.trials.map((function(e){return e[t]})),type:"histogram",name:t},n.push(u),r.title={text:t}},c=e.visitorNames()[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var u;l()}}catch(d){i=!0,o=d}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}var h=document.createElement("div");document.getElementById(t).appendChild(h),h.style.height="240px",h.style.width="320px",h.style.display="inline-block",window.Plotly.newPlot(h,n,r)}var Lo=function(){return a.a.useEffect((function(){var e=document.createElement("script");e.src="https://cdn.plot.ly/plotly-latest.min.js",e.addEventListener("load",(function(){zo(Ne,"temperate"),zo(Fe,"rocky"),zo(Be,"desert")})),document.body.appendChild(e)}),[]),a.a.createElement("div",null,a.a.createElement("h1",null,"Experiments"),a.a.createElement("div",{id:"temperate"},a.a.createElement("h2",null,"Temperate")),a.a.createElement("div",{id:"rocky"},a.a.createElement("h2",null,"Rocky")),a.a.createElement("div",{id:"desert"},a.a.createElement("h2",null,"Desert")))},Wo=function(){return a.a.createElement("div",null,a.a.createElement("h1",null,"Unknown page"),a.a.createElement(s.b,{to:"/"},"Back to main screen"))};Object(fe.a)(u.Color,{r:Object(fe.i)(),g:Object(fe.i)(),b:Object(fe.i)()}),Object(fe.a)(u.Vector2,{x:Object(fe.i)(),y:Object(fe.i)()});var Vo;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));(Vo=n(324)).keys().forEach(Vo),o.a.render(a.a.createElement(s.a,null,a.a.createElement((function(){return a.a.createElement(l.c,null,a.a.createElement(l.a,{path:"/test-lose"},a.a.createElement(rt,null)),a.a.createElement(l.a,{path:"/test-win"},a.a.createElement(nt,null)),a.a.createElement(l.a,{path:"/test-stats"},a.a.createElement(Lo,null)),a.a.createElement(l.a,{path:"/test-diffusion"},a.a.createElement(Pe,null)),a.a.createElement(l.a,{path:"/wfc"},a.a.createElement(pt,null)),a.a.createElement(l.a,{exact:!0,path:"/"},a.a.createElement(Io,null)),a.a.createElement(l.a,{path:"*",component:Wo}))}),null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[234,1,2]]]);
//# sourceMappingURL=main.b2a5e335.chunk.js.map