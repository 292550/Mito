{"version":3,"sources":["common/useMousePosition.ts","global/ticker.ts","common/DynamicNumber.tsx","common/Button.tsx","common/Character.tsx","common/MP.tsx","common/capitalize.ts","evolution/traits.ts","common/Expand.tsx","evolution/TraitDisplay.tsx","evolution/GeneDisplay.tsx","evolution/GenesToTraits.tsx","evolution/mutation.ts","evolution/MutationScreen.tsx","common/LookAtMouse.tsx","evolution/SpeciesPopoverDetails.tsx","evolution/SpeciesNode.tsx","evolution/PhylogeneticTree.tsx","overworld/hexMath.ts","math/poissonDisc.ts","evolution/species.ts","overworld/map/HexTileInfo.tsx","common/promise.ts","overworld/map/hexTileSprite.ts","overworld/map/OverWorldPopover.tsx","overworld/map/OverWorldMap.tsx","overworld/OverWorldScreen.tsx","sketches/sketch.ts","sketches/sketchComponent.tsx","sketches/fullPageSketch.tsx","math/index.ts","sketches/mito/audio.ts","sketches/mito/inventory.ts","sketches/mito/params.ts","sketches/mito/game/temperature.ts","common/perlin.ts","sketches/mito/directions.ts","sketches/mito/game/entity.ts","sketches/mito/game/interactable.ts","sketches/mito/game/world.ts","sketches/mito/game/tile.ts","sketches/mito/game/player.ts","common/lazy.ts","sketches/mito/spritesheet.ts","sketches/mito/renderers/Renderer.tsx","sketches/mito/renderers/resourceParticles.ts","sketches/mito/renderers/InventoryRenderer.tsx","sketches/mito/renderers/PlayerRenderer.tsx","sketches/mito/renderers/CellEffectsRenderer.tsx","sketches/mito/renderers/TileRenderer.tsx","math/easing.ts","sketches/mito/renderers/TransportRenderer.tsx","sketches/mito/renderers/WorldRenderer.tsx","common/vignette.ts","sketches/mito/keymap.ts","sketches/mito/ui/Instructions.tsx","sketches/mito/ui/GameStack.tsx","sketches/mito/ui/TileDetails.tsx","sketches/mito/ui/CellBar.tsx","sketches/mito/ui/SeasonsTracker.tsx","sketches/mito/ui/HUD.tsx","sketches/mito/game/environment.ts","sketches/mito/tutorial/sceneObject.tsx","sketches/mito/ui/ParamsGUI.tsx","sketches/mito/tutorial/Animate.tsx","sketches/mito/tutorial/tileHighlight.tsx","sketches/mito/tutorial/PointHighlight.tsx","sketches/mito/ui/Hover.tsx","sketches/mito/index.tsx","sketches/mito/ui/GameResultsScreen.tsx","overworld/hexStore.ts","overworld/hexTile.ts","overworld/overWorld.ts","app/reducer.ts","app/AppStateProvider.tsx","app/App.tsx","serviceWorker.ts","tests/TestStats.tsx","sketches/mito/game/worldUtils.ts","index.tsx","tests/TestWinScreen.tsx","assets/images/fruit.png","assets/images/character.png","assets/images/test-vignette.png","assets/audio/mito-base.mp3","assets/audio/mito-strings.mp3","assets/audio/mito-drums.mp3","assets/audio/footsteps.wav","assets/audio/build.wav","assets/audio/Blop-Mark_DiAngelo-79054334.mp3","assets/audio/suckwater.wav","assets/images/roguelikeSheet_transparent.png"],"names":["MousePositionContext","React","createContext","x","window","innerWidth","y","innerHeight","useMousePosition","useContext","Ticker","tickerId","tickers","_time","tickerLoop","time","_this","toDelete","id","f","push","Number","_i","_toDelete","length","removeAnimation","requestAnimationFrame","fn","this","start","NUMBER_FORMATTER","Intl","NumberFormat","undefined","maximumFractionDigits","useGrouping","DynamicNumber","_ref","value","_ref$speed","speed","_ref$formatter","formatter","_React$useState","useState","_React$useState2","Object","slicedToArray","v","setV","useEffect","addAnimation","Math","abs","react_default","a","createElement","Fragment","format","Button","props","assign","className","classNames","color","children","Character","size","otherProps","objectWithoutProperties","alt","src","characterSrc","MP_NUMBER_FORMATTER","MP","amount","total","common_DynamicNumber","index_esm","capitalize","s","substr","toLocaleUpperCase","TRAIT_TYPES","keys","carryCapacity","energyEfficiency","photosynthesis","rootAbsorption","structuralStability","activeTransportSugar","activeTransportWater","walkSpeed","diffuseWater","diffuseSugar","buildTime","heatTolerant","coldTolerant","fruitGrowthSpeed","fruitMutationPoints","fruitNeededResources","displayName","trait","splits","split","i","addTraits","source","modifier","traitType","t","getTraits","genes","traits","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","getTraitInfluence","err","return","gene","traitDiff","traitTypePlus","dnaPairToTraitType","traitTypeMinus","dnaTuple","traitMod","val","base","exponent","pow","Expand","shrunkElements","_useState","_useState2","expanded","setExpanded","onClick","TraitDisplay","nonzeroTraits","filter","name","sort","b","nonzeroTraitEl","map","green","red","key","zeroTraits","zeroTraitEl","common_Expand","GeneComponent","title","width","GeneDisplay","_ref2","geneContent","p","GenesToTraits","useMemo","evolution_GeneDisplay","evolution_TraitDisplay","mutatePosition","position","geneStr","join","strToGene","old","d","randomDNA","randomNewDNA","charAt","str","randomDNATuple","r","random","MutationScreen","species","onCommit","pool","freeMutationPoints","setPool","arg","uuid","descendants","totalMutationPoints","toConsumableArray","parent","newSpecies","setNewSpecies","_React$useState3","_React$useState4","clickMode","setClickMode","isSwapping","type","isRerolling","newGeneCost","swap","gene1","position1","gene2","position2","geneIndex1","indexOf","geneIndex2","newGenes","_mutateSwapDNA","gene1Str","gene2Str","dnaPosition1","dnaPosition2","newGeneStr1","newGeneStr2","mutateSwapDNA","_mutateSwapDNA2","newGene1","newGene2","objectSpread","isGenesChanged","genes1","genes2","some","_","click-mode-active","common_Character","common_MP","Button_Button","concat","disabled","is-cancel","evolution_GenesToTraits","geneIndex","newGene","slice","reroll","p1","onChange","e","target","LookAtMouse","mouse","useBoundingclientrectRef","ref","_props$zScale","zScale","restProps","z","style","midX","left","midY","top","height","ox","oy","rotY","atan","rotX","transform","SpeciesPopoverDetails","onMutate","SpeciesNode","handleOnMutate","setPopoverIsOpen","popoverIsOpen","SpeciesNode_SpeciesNode","popoverBody","evolution_SpeciesPopoverDetails","react_popover_default","isOpen","preferPlace","onOuterAction","body","common_LookAtMouse","PhylogeneticTree","rootSpecies","evolution_SpeciesNode","Y_SQUISH_FACTOR","sqrt","getClickedHexCoords","canvas","camera","event","scale","dX","dY","cX","cY","nativeEvent","offsetX","j","offsetY","k","rx","round","ry","rz","x_diff","y_diff","z_diff","roundCubeCoordinates","pixelPosition","tile","_tile$cartesian","cartesian","getCameraPositionCenteredOn","hex","_hex$cartesian","vectors","Vector2","generateNaturalRandomHexagonPoints","radius","_ref$width","_ref$height","_ref$radius","_ref$max","max","_ref$rng","rng","radius2","R","cellSize","SQRT1_2","gridWidth","ceil","gridHeight","grid","Array","queue","queueSize","sampleSize","far","i0","j0","i1","min","j1","o","dx","dy","sample","sampler","PI","cos","sin","samples","poissonDisc","isPointInHexagon","HALF_HEIGHT","q2x","q2y","newBaseSpecies","arguments","lineage","arr","apply","HexTileInfo","onClickPlay","allSpecies","selectedSpecies","setSelectedSpecies","_tile$info","info","flora","options","label","playButtonElement","dist_default","option","find","header","mutationPointsPerEpoch","expand","fontSize","JSON","stringify","sleep","Promise","setTimeout","testVignette","Image","testVignetteUrl","COLOR_SCALE_HEIGHT","scaleLinear","domain","range","HexTileSprite","classCallCheck","vignettePositions","c","_pixelPosition","_pixelPosition2","px","py","visible","fillStyle","drawHex","font","textAlign","textBaseline","fillText","updateVignettes","strokeStyle","positions","asyncToGenerator","regenerator_default","mark","_callee","wrap","_context","prev","t0","finish","stop","sizeScale","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","drawImage","fill","beginPath","moveTo","angle","lineTo","closePath","stroke","OverWorldPopover","container","OverWorldMap","_React$PureComponent","possibleConstructorReturn","getPrototypeOf","call","hexTileSprites","Map","rafId","handleCanvasRef","setState","frame","state","handleResize","handleCanvasClick","highlightedHex","coords","cameraState","level","overWorld","tileAt","onPlayLevel","handleKeyDown","repeat","newPressedKeys","pressedKeys","defineProperty","code","handleKeyUp","handleWheel","delta","deltaX","deltaY","scalar","drawMap","updateCamera","offset","setLength","_getCameraPositionCen","getStartTile","_getCameraPositionCen2","sprite","set","inherits","createClass","context","getContext","clearRect","values","draw","document","addEventListener","removeEventListener","prevProps","focusedHex","focusHex","_this2","tStart","dt","_getCameraPositionCen3","_getCameraPositionCen4","targetX","targetY","tabIndex","maybeRenderHexPopover","map_OverWorldPopover","map_HexTileInfo","PureComponent","EPOCH_FORMATTER","EpochUI","epoch","onNextEpoch","onFocusHex","_useState7","_useState8","transitioning","setTransitioning","unusedHexes","isReadyToAdvance","ready-to-advance","OverWorldScreen","onPopulationAttempt","leftPanelOpen","setLeftPanelOpen","_useState3","_useState4","activelyMutatingSpecies","setActivelyMutatingSpecies","open","preventDefault","handleStartMutate","useCallback","handleCommit","newPool","Error","_useState5","_useState6","setFocusedHex","handleFocusHex","OverWorldMap_OverWorldMap","evolution_PhylogeneticTree","maybeMutationScreen","evolution_MutationScreen","lib_default","ariaHideApp","onRequestClose","maybeRenderMutationModal","UI_EVENTS","click","contextmenu","dblclick","mousedown","mouseup","mousemove","touchstart","touchmove","touchend","keyup","keydown","keypress","wheel","ISketch","renderer","audioContext","elements","events","timeElapsed","frameCount","get","domElement","THREE","SketchSuccessComponent","frameId","lastTimestamp","loop","timestamp","millisElapsed","sketch","animate","console","error","handleWindowResize","updateRendererCanvasToMatchParent","resize","forEach","eventName","callback","eventsOnBody","sketchElementsWithKey","render","react","el","idx","_this3","destroy","dispose","parentElement","setSize","clientWidth","clientHeight","SketchComponent","_React$PureComponent2","_getPrototypeOf2","_this4","_len","args","_key","status","volumeEnabled","parse","localStorage","getItem","userVolume","handleContainerRef","AudioContextConstructor","AudioContext","webkitAudioContext","setContext","createGain","gain","setValueAtTime","connect","destination","handleVisibilityChange","alpha","preserveDrawingBuffer","antialias","appendChild","otherArgs","construct","sketchClass","remove","close","handleVolumeButtonClick","setItem","hidden","suspend","resume","_this$props","containerProps","errorElement","classnames","renderSketchOrStatus","renderVolumeButton","sketchComponent_SketchSuccessComponent","renderDefaultErrorElement","message","fa_index_esm","FullPageSketch","handleDivRef","div","exitFullscreen","sketchComponent_SketchComponent","webkitExitFullscreen","mozCancelFullScreen","lerp","lerp2","l","xStart","xStop","yStart","yStop","clamp","randRound","ix","floor","fx","mito","strings","drums","footsteps","build","blopBuffer","suckWaterBuffer","sourceElement","makeNodeOfAudioAsset","ctx","audio","autoplay","srcs","_srcs","createMediaElementSource","fpref","Inventory","capacity","carrier","water","sugar","validate","other","amountWater","amountSugar","spaceNeeded","spaceAvailable","space","change","emit","EventEmitter","on","off","newWater","newSugar","warn","hasInventory","obj","inventory","PARAMS_DEFAULT","isRealtime","environment","cellEnergyMax","tissueInventoryCapacity","rootTurnsPerTransfer","leafReactionRate","leafSugarPerReaction","cellGestationTurns","cellDiffusionWater","cellDiffusionSugar","soilDarknessBase","soilDiffusionWater","veinDiffusion","soilMaxWater","droop","fountainTurnsPerWater","fountainAppearanceRate","transportTurnsPerMove","sunlightReintroduction","sunlightDiffusion","maxResources","params","search","location","urlHashParams","updateParamsHash","nonDefaultParams","_keys","stringified","Temperature","Grad","grad3","F2","G2","G3","Noise","seed","perm","gradP","octaveNum","octaveFalloff","octaveMatrix2","xin","yin","x0","y0","x1","y1","x2","y2","gi0","gi1","gi2","t1","t2","dot2","sum","simplex2","newX","newY","zin","k1","i2","j2","k2","z0","z1","z2","x3","y3","z3","gi3","t3","dot3","simplex3","X","Y","n00","n01","n10","n11","u","fade","Z","n000","n001","n010","n011","n100","n101","n110","n111","w","DIRECTIONS","nw","sw","n","ne","se","DIRECTION_VALUES","StopStep","_Error","wrapNativeSuper","isInteractable","interact","StepStats","deleted","added","SEASON_NAMES","seasonDisplay","season","month","TIME_PER_YEAR","TIME_PER_SEASON","TIME_PER_MONTH","TIME_PER_DAY","World","player","gridEnvironment","gridCells","neighborCache","wipResult","cachedEntities","stepStats","temperatureScale","0","day","night","1","2","3","fruits","world","Cell","diffusionWater","diffusionSugar","turnsToBuild","Player","__","pos","fillFunction","Air","playerX","firstSoil","posFloat","distanceTo","Rock","Soil","Tissue","computeTileNeighbors","fillCachedEntities","tileEnvironment","step","tileCell","percent","xOrVec2","isValidPosition","cell","_x2","_y2","g","Fruit","oldTile","neighbors","tileNeighbors","_step3","neighbor","constructor","give","add","oldCell","oldEnvironmentTile","handleTileUpdated","maybeCell","cellAt","mapping","DIRECTION_VALUES_RAND","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step4","_iterator3","dir","newEntities","reverse","entities","entity","sDt","dtSinceLastStepped","shouldStep","updateTemperatures","computeSunlight","stepWeather","climate","turnsBetweenRainfall","rainDuration","dropletSizeScalar","randInt","waterPerDroplet","_this$temperatureScal","sunAmount","_dt","sunAngle","directionalBias","environmentTileAt","sunlight","tileUp","tileRight","tileLeft","upSunlight","sunlightCached","rightSunlight","leftSunlight","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step5","_iterator4","cells","temperatureFloat","nextTemperature","DeadCell","matureFruit","isMature","hasEnergy","energy","self","_callee2","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step6","row","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_iterator6","_step7","_context2","shuffle","array","temporaryValue","randomIndex","currentIndex","Tile","isObstacle","darkness","Infinity","timeMade","clone","getCurrentTemperature","Freezing","Cold","Mild","Hot","Scorching","fallAmount","stepDarkness","stepDiffusion","stepTemperature","stepGravity","minDarkness","_ref3","contrib","darknessFromNeighbor","canDiffuse","canPullResources","giver","diffusionAmount","lowerNeighbor","receiver","recieverType","giverType","allowPull","noiseCo2","_Tile","_co2","assertThisInitialized","computeCo2","floorCo2","scaleX","perlin3","stepDiffusionCheap","stepEvaporation","right","tryDiffuse","_Tile2","waterGravityPerTurn","esm_get","prototype","_this$world$environme","evaporationRate","evaporationBottom","evaporationHeightScalar","evaporationAmountScalar","_Tile3","_Tile4","Fountain","_Soil","turnsPerWater","cooldown","FreezeEffect","_CellEffect","_getPrototypeOf3","_this5","_len3","_key3","turnsToDie","percentFrozen","onFrozenChanged","temperature","die","age","CellEffect","index","effects","splice","stacks","_Tile5","_this6","droopY","effect","findEffectOfType","attachTo","setTileAt","tempo","from","isHungry","stepEatSugar","_neighbors","energeticNeighbors","stepEqualizeEnergy","stepDroop","equals","maybeRemoveCellAt","hunger","energyToSugarConversion","sugarToEat","gotEnergy","difference","rate","energyTransfer","averageTemperature","chanceToFreeze","addEffect","chanceToLoseWater","below","belowLeft","belowRight","above","aboveLeft","aboveRight","droopAmount","hasSupportBelow","_i2","_arr","springNeighborCells","reduce","GrowingCell","_Cell","completedCell","_this7","timeRemaining","timeToBuild","_Cell2","_this8","Leaf","_Cell3","_getPrototypeOf4","_this9","_len5","_key5","averageEfficiency","averageSpeed","sugarConverted","tilePairs","totalSugarProduced","numAir","_ref6","_ref5","oppositeTile","air","tissue","efficiency","co2","bestEfficiencyWater","waterToConvert","chance","Root","_Cell4","_getPrototypeOf5","_this10","_len7","_key7","activeNeighbors","totalSucked","stepWaterTransfer","doneOnce","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_iterator7","_ref9","_ref8","_Cell5","_this11","neededResources","committedResources","timeMatured","turnsToMature","handleGetResources","maxResourceIntake","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_step8","_iterator8","_ref12","wantedWater","wantedSugar","commitResources","oneTurnCommitMax","isFractional","Transport","_Tissue","_this12","cooldownWater","cooldownSugar","waterToTransport","sugarToTransport","turnsPerSugar","targetTile","getTarget","fromTile","getFrom","Vein","_Tissue2","_getPrototypeOf6","_this13","_len9","_key9","action","mapActions","baseSpeed","currentTile","actions","cb","mappedAction","actionSuccessful","attemptAction","maybeMoveWithTransports","attemptStill","attemptMove","attemptBuild","attemptDeconstruct","attemptDrop","attemptPickup","attemptMultiple","attemptInteract","isWalkable","verifyMove","cancelScheduledValues","linearRampToValueAtTime","currentTime","cellType","newTile","exponentialRampToValueAtTime","args1","args2","every","argsEq","existingCell","isMeaningfulBuild","force","matureCell","tryConstructingNewCell","refund","multiple","allSuccess","interactable","lazy","cache","spriteSize","spritesheetLoaded","SPRITESHEET","load","roguelikeSheet_transparentSrc","dispatchEvent","fruitTexture","fruitSrc","textureFromSpritesheet","backgroundColor","drawSpriteToCanvas","image","fillRect","texture","needsUpdate","magFilter","flipY","wrapS","wrapT","Renderer","scene","ResourceParticles","_Points","geometry","material","newGeometry","ResourceParticleMaterial","frustumCulled","BufferGeometry","Float32Array","BUFFER_SIZE","sizes","addAttribute","BufferAttribute","setDynamic","attributes","setXYZ","setX","setDrawRange","Points","uniforms","opacity","sizeGlobal","vertexShader","fragmentShader","depthTest","transparent","ShaderMaterial","InventoryRenderer","_Renderer","animationOffset","waters","sugars","wantedMeshes","sub","handleGiveResources","newParticle","WaterParticles","startFrame","SugarParticles","endFrame","resources","particles","resource","resourceArray","commit","fract","numWaters","numResources","vx","vy","now","goTowardsCenterStrength","playerY","mag2","avoidPlayerStrength","lengthSq","strength","updateNumParticles","simulateResourcePositions","commitParticles","Color","PlayerRenderer","mesh","Mesh","PlaneBufferGeometry","MeshBasicMaterial","depthWrite","side","DoubleSide","droopPosFloat","CellEffectsRenderer","tileRenderer","renderers","createEffectRenderer","update","FreezeEffectRenderer","newMesh","translate","COLD_BLUE","AnimationController","animation","timeStarted","TileMesh","_Mesh","materialMapping","TileRenderer","inventoryRenderer","originalColor","lastAudioValueTracker","pairsLines","Object3D","worldDomElement","growingRenderer","cellEffectsRenderer","temperatureColor","TEMPERATURE_COLORS","currentLerp","zIndex","matrixAutoUpdate","updateMatrix","Audio","audioListener","fruit","addWorldDOMElement","toFixed","lightAmount","updateVisibility","updateSize","updateColor","respondToEvents","getPercentMatured","targetScale","ONE","mat","colorIndex","AIR_COLORSCALE","startColorIndex","startColor","endColor","copy","lerpColorTemperature","newAudioValueTracker","setBuffer","dist","distanceToSquared","volume","setVolume","play","growPulseAnimation","tColor","targetLerp","_this$pairsLines","pairColor","getHex","pairs","arrowDir","Vector3","normalize","arrowHelper","makeLine","multiplyScalar","hasActiveNeighbors","_this$pairsLines2","lines","ArrowHelper","ease","easeCubic","setScalar","isArray","origin","line","Line","lineGeometry","LineBasicMaterial","quaternion","axis","radians","acos","setFromAxisAngle","removeWorldDOMElement","Float32BufferAttribute","materials","TransportRenderer","_TileRenderer","arrow","makeArrow","createRendererFor","object","WorldRenderer","deleteDeadEntityRenderers","createSelector","stats","deletedEntities","delete","created","getLastStepStats","getOrCreateRenderer","VignetteCapturer","pxPerTile","captureInterval","lastCaptureTime","renderTarget","rtBuffer","rtCanvas","picturesqueCells","_this$getBounds","getBounds","_this$getBounds2","minBounds","maxBounds","Scene","tileRenderers","cameraEncompassingBounds","setRenderTarget","clear","readRenderTargetPixels","imageData","createImageData","imageBuffer","data","putImageData","boundsWidth","boundsHeight","maxDimension","roiWidth","roiHeight","roiTopLeft","dest","img","toDataURL","tiles","subScalar","addScalar","center","largerDim","OrthographicCamera","WebGLRenderTarget","Uint8Array","ACTION_KEYMAP","KeyQ","KeyE","Space","MOVEMENT_KEYS","KeyW","KeyA","KeyS","KeyD","CELL_BAR_KEYS","Digit1","Digit2","Digit3","Digit4","Digit5","Instructions","renderCredit","href","rel","GameStack","handlePlay","instructionsOpen","Instructions_Instructions","TileDetails","_React$Component","tileInfo","inventoryInfo","cellInfo","growingCellInfo","rootInfo","leafInfo","airInfo","fountainInfo","energyInfo","temperatureInfo","Bar","_ref$color","_ref$left","bottom","borderRight","Text","_ref2$fontWeight","fontWeight","fontFamily","border","waterInfo","sugarInfo","cellEffects","descriptors","CellBarItem","hotkey","isSelected","getStyle","url","HTMLCanvasElement","backgroundImage","selected","HotkeyButton","getElementsByTagName","focus","ensureCanvasFocus","CellBar","bar","onIndexClicked","String","SeasonsTracker","yearDonePercent","BarMarker","SeasonBead","HUD","traitsPanelOpen","tutorialRef","isFinished","isMaxed","isMaxedEl","SeasonsTracker_SeasonsTracker","maybeRenderTraits","renderInventoryBar","renderInventory","ui_CellBar","cellBar","cellBarIndex","setCellBarIndex","waterPercent","sugarPercent","emptyPercent","waterStyles","sugarStyles","emptyStyles","Temperate","noiseWater","noiseRock","noiseHeight","soilLevel","perlin2","rockThreshold","isRock","heightScalar","simplexValue","emitWaterScalar","Desert","Rocky","ALL_ENVIRONMENTS","SceneObject","Animate","rafid","Component","TILE_HIGHLIGHT","edgesGeometry","lineSegments","TileHighlight","Animate_Animate","sceneObject_SceneObject","POINT_HIGHLIGHT","PointHighlight","Hover","highlightedTile","highlightedPosition","getHighlightPosition","TileDetails_TileDetails","tutorial_PointHighlight","maybeRenderTileHighlight","tileHighlight","WorldDOMElement","positionFn","renderFn","worldPosition","worldToScreen","Mito","_ISketch","attempt","onWinLoss","mouseDown","mouseButton","firstActionTakenYet","keyMap","Set","clientX","clientY","button","shiftKey","newZoom","zoom","updateProjectionMatrix","worldRenderer","vignetteCapturer","vignettes","worldDomElements","targetHex","settlingSpecies","lookAt","numDone","oneMoreLoaded","mitoBaseSrc","oncanplaythrough","mitoStringsSrc","mitoDrumsSrc","footstepsSrc","buildSoundSrc","loader","blopSrc","audioBuffer","xhr","suckWaterSrc","hookUpAudio","updateAmbientAudio","attachWindowEvents","worldDomElementComponents","HUD_HUD","GameStack_GameStack","Hover_Hover","yPos","drumVolume","stringsVolume","log","memory","geometries","textures","programs","calls","points","triangles","yes","no","traverse","isTimeForNewCapture","capture","gameResult","maybeGetGameResult","getHighlightVector","_this$world$player$po","screen","project","moveAction","keysToMovement","setAction","handleLeftClick","handleRightClick","worldStep","getAction","getHighlightedTile","updateHover","mouseNorm","getCameraNormCoordinates","Boolean","debug","logRenderInfo","h","aspect","isBuildCandidate","selectedCell","roundedHighlightVector","expansionTiles","Glow","FruitInfo","GameWonScreen","results","GameLostScreen","GameResultsScreen","_ref4","onDone","HexStore","hash","_Symbol$iterator","C","HexTile","rainfall","soilType","wind","OverWorld","storage","startTile","hookUpNeighbors","magnitude","noise","noise3D","randomHeight","maxDist","SimplexNoise","populateLevelInfo","_tile$cartesian2","overWorld_Symbol$iterator","actionPoints","hexes","AppReducerContext","reducer","populationAttempt","sourceHex","activePopulationAttempt","handleStartPopulationAttempt","handlePopulationAttemptSuccess","resetActionPoints","handleNextEpoch","result","activeGameResult","handleGetGameResult","handleGameResultDone","_action$attempt","oldSpecies","getMaxGenePool","AppStateProvider","stateDispatchTuple","useReducer","generateRectangle","newInitialAppState","Provider","AppComponent","handleMousePosition","mousePosition","handlePopulationAttempt","dispatch","handleWinLoss","handleResultsDone","otherArgsSelector","_this$context5","maybeRenderOverWorld","maybeRenderInGame","maybeRenderGameResult","src_overworld_OverWorldScreen","fullPageSketch_FullPageSketch","GameResultsScreen_GameResultsScreen","contextType","App","App_AppComponent","hostname","match","Experiment","visitors","trials","trial","environmentTiles","_Object$entries","entries","visitor","visit","ExperimentSuite","experiments","recordDataFor","runTests","environmentFn","suite","countAir","countSoil","countRock","countFountain","startAdjacentWaters","adjacentTiles","predicate","candidates","findBuildCandidateTiles","countWaters","timeEnd","divId","names","visitorNames","trace","getElementById","Plotly","newPlot","barmode","plotStackedBar","plotHistogram","layout","_loop","text","display","TestStats","script","ReactDOM","react_router_dom","react_router","path","f1","f2","f3","mockResults","tests_TestStats","exact","app_App","to","navigator","serviceWorker","ready","then","registration","unregister","module","exports","__webpack_require__"],"mappings":"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CA,IACA,EACA,IACA,IACA,IACA,IACA,GACA,EACA,GACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,EACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,KAUI4jB,GAAK,IAAO5qB,KAAK0O,KAAK,GAAK,GAC3Bmc,IAAM,EAAI7qB,KAAK0O,KAAK,IAAM,EAG1Boc,GAAK,EAAI,EAEFC,GAAb,WAoCE,SAAAA,IAAuD,IAA3CC,EAA2C5X,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAZ,WAAhBpT,KAAKkI,SAAuBxI,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAusB,GAAAvsB,KAlChDysB,KAAO,IAAItZ,MAAM,KAkC+BnT,KAjChD0sB,MAAQ,IAAIvZ,MAAM,KAiC8BnT,KA/BhD2sB,UAAY,EA+BoC3sB,KA9BhD4sB,cAAgB,GA8BgC5sB,KA5BhD6sB,cAAgB,CAAe,EAAdrrB,KAAK2S,IAAI,GAAuB,GAAd3S,KAAK4S,IAAI,GAAsB,EAAd5S,KAAK4S,IAAI,GAAsB,EAAd5S,KAAK2S,IAAI,IA6BnFnU,KAAKwsB,KAAKA,GArCd,OAAAtrB,OAAAmb,EAAA,EAAAnb,CAAAqrB,EAAA,EAAAzkB,IAAA,OAAApH,MAAA,SAYc8rB,GACNA,EAAO,GAAKA,EAAO,IAErBA,GAAQ,QAGVA,EAAOhrB,KAAKkmB,MAAM8E,IACP,MACTA,GAAQA,GAAQ,GAGlB,IAAK,IAAI3nB,EAAI,EAAGA,EAAI,IAAKA,IAAK,CAC5B,IAAIzD,OAAC,EAEHA,EADM,EAAJyD,EACE2D,GAAE3D,GAAa,IAAP2nB,EAERhkB,GAAE3D,GAAO2nB,GAAQ,EAAK,IAG5BxsB,KAAKysB,KAAK5nB,GAAK7E,KAAKysB,KAAK5nB,EAAI,KAAOzD,EACpCpB,KAAK0sB,MAAM7nB,GAAK7E,KAAK0sB,MAAM7nB,EAAI,KAAOsnB,GAAM/qB,EAAI,SAhCtDF,OAAAmb,EAAA,EAAAnb,CAAAqrB,EAAA,EAAAzkB,IAAA,WAAApH,MAAA,SAyCkBosB,EAAaC,GAC3B,IAUIrZ,EAAIE,EARFxQ,GAAK0pB,EAAMC,GAAOX,GACpBvnB,EAAIrD,KAAKkmB,MAAMoF,EAAM1pB,GACrB0N,EAAItP,KAAKkmB,MAAMqF,EAAM3pB,GACnB8B,GAAKL,EAAIiM,GAAKub,GAChBW,EAAKF,EAAMjoB,EAAIK,EACf+nB,EAAKF,EAAMjc,EAAI5L,EAIf8nB,EAAKC,GAEPvZ,EAAK,EACLE,EAAK,IAGLF,EAAK,EACLE,EAAK,GAKP,IAAMsZ,EAAKF,EAAKtZ,EAAK2Y,GACfc,EAAKF,EAAKrZ,EAAKyY,GACfe,EAAKJ,EAAK,EAAI,EAAIX,GAClBgB,EAAKJ,EAAK,EAAI,EAAIZ,GAExBxnB,GAAK,IACLiM,GAAK,IACL,IAAMwc,EAAMttB,KAAK0sB,MAAM7nB,EAAI7E,KAAKysB,KAAK3b,IAC/Byc,EAAMvtB,KAAK0sB,MAAM7nB,EAAI6O,EAAK1T,KAAKysB,KAAK3b,EAAI8C,IACxC4Z,EAAMxtB,KAAK0sB,MAAM7nB,EAAI,EAAI7E,KAAKysB,KAAK3b,EAAI,IAEzCyH,EAAK,GAAMyU,EAAKA,EAAKC,EAAKA,EAO1BQ,EAAK,GAAMP,EAAKA,EAAKC,EAAKA,EAO1BO,EAAK,GAAMN,EAAKA,EAAKC,EAAKA,EAS9B,OAAO,KAtBH9U,EAAK,EACF,GAELA,GAAMA,GACIA,EAAK+U,EAAIK,KAAKX,EAAIC,KAG1BQ,EAAK,EACF,GAELA,GAAMA,GACIA,EAAKF,EAAII,KAAKT,EAAIC,KAG1BO,EAAK,EACF,GAELA,GAAMA,GACIA,EAAKF,EAAIG,KAAKP,EAAIC,OA/FlC,CAAAvlB,IAAA,iBAAApH,MAAA,SAsGwBosB,EAAaC,GAKjC,IAL8G,IAAhEJ,EAAgE/X,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAApD5U,KAAK2sB,UAAWC,EAAoChY,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAApB5U,KAAK4sB,cAC3FgB,EAAM,EACNrvB,EAAIuuB,EACJpuB,EAAIquB,EACJrR,EAAS,EACJ7W,EAAI,EAAGA,EAAI8nB,EAAW9nB,IAAK,CAClC+oB,GAAO5tB,KAAK6tB,SAAStvB,EAAGG,GAAKgd,EAC7B,IAAMoS,EAAOvvB,EAAIyB,KAAK6sB,cAAc,GAAKnuB,EAAIsB,KAAK6sB,cAAc,GAC1DkB,EAAOxvB,EAAIyB,KAAK6sB,cAAc,GAAKnuB,EAAIsB,KAAK6sB,cAAc,GAChEtuB,EAAIuvB,EACJpvB,EAAIqvB,EACJrS,GAAUkR,EAEZ,OAAOgB,IAnHX,CAAA9lB,IAAA,WAAApH,MAAA,SAuHkBosB,EAAaC,EAAaiB,GACxC,IAeIta,EAAIE,EAAIqa,EACRC,EAAIC,EAAIC,EAbNhrB,GAAK0pB,EAAMC,EAAMiB,IA9HhB,EAAI,GA+HPnpB,EAAIrD,KAAKkmB,MAAMoF,EAAM1pB,GACrB0N,EAAItP,KAAKkmB,MAAMqF,EAAM3pB,GACrB4N,EAAIxP,KAAKkmB,MAAMsG,EAAM5qB,GAEnB8B,GAAKL,EAAIiM,EAAIE,GAAKsb,GAClBU,EAAKF,EAAMjoB,EAAIK,EACf+nB,EAAKF,EAAMjc,EAAI5L,EACfmpB,EAAKL,EAAMhd,EAAI9L,EAMjB8nB,GAAMC,EACJA,GAAMoB,GACR3a,EAAK,EACLE,EAAK,EACLqa,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,GACIpB,GAAMqB,GACf3a,EAAK,EACLE,EAAK,EACLqa,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,IAEL1a,EAAK,EACLE,EAAK,EACLqa,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,GAGHnB,EAAKoB,GACP3a,EAAK,EACLE,EAAK,EACLqa,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,GACIpB,EAAKqB,GACd3a,EAAK,EACLE,EAAK,EACLqa,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,IAEL1a,EAAK,EACLE,EAAK,EACLqa,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,GAOT,IAAMlB,EAAKF,EAAKtZ,EAAK4Y,GACfa,EAAKF,EAAKrZ,EAAK0Y,GACfgC,EAAKD,EAAKJ,EAAK3B,GAEjBc,EAAKJ,EAAKkB,EAAK,EAAI5B,GACnBe,EAAKJ,EAAKkB,EAAK,EAAI7B,GACnBiC,EAAKF,EAAKD,EAAK,EAAI9B,GAEnBkC,EAAKxB,EAAK,EAAI,GACdyB,EAAKxB,EAAK,EAAI,GACdyB,EAAKL,EAAK,EAAI,GAGlBxpB,GAAK,IACLiM,GAAK,IACLE,GAAK,IApFgD,IAqF7C0b,EAAgB1sB,KAAhB0sB,MAAOD,EAASzsB,KAATysB,KACXa,EAAMZ,EAAM7nB,EAAI4nB,EAAK3b,EAAI2b,EAAKzb,KAC9Buc,EAAMb,EAAM7nB,EAAI6O,EAAK+Y,EAAK3b,EAAI8C,EAAK6Y,EAAKzb,EAAIid,KAC5CT,EAAMd,EAAM7nB,EAAIqpB,EAAKzB,EAAK3b,EAAIqd,EAAK1B,EAAKzb,EAAIod,KAC5CO,EAAMjC,EAAM7nB,EAAI,EAAI4nB,EAAK3b,EAAI,EAAI2b,EAAKzb,EAAI,KAG1CuH,EAAK,GAAMyU,EAAKA,EAAKC,EAAKA,EAAKoB,EAAKA,EAOpCZ,EAAK,GAAMP,EAAKA,EAAKC,EAAKA,EAAKmB,EAAKA,EAOpCZ,EAAK,GAAMN,EAAKA,EAAKC,EAAKA,EAAKkB,EAAKA,EAOpCK,EAAK,GAAMJ,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,EASxC,OAAO,KA7BHnW,EAAK,EACF,GAELA,GAAMA,GACIA,EAAK+U,EAAIuB,KAAK7B,EAAIC,EAAIoB,KAG9BZ,EAAK,EACF,GAELA,GAAMA,GACIA,EAAKF,EAAIsB,KAAK3B,EAAIC,EAAImB,KAG9BZ,EAAK,EACF,GAELA,GAAMA,GACIA,EAAKF,EAAIqB,KAAKzB,EAAIC,EAAIkB,KAG9BK,EAAK,EACF,GAELA,GAAMA,GACIA,EAAKD,EAAIE,KAAKL,EAAIC,EAAIC,OA7OtC,CAAA5mB,IAAA,iBAAApH,MAAA,SAqPIosB,EACAC,EACAiB,GASA,IANA,IAFArB,EAEA/X,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAFY5U,KAAK2sB,UACjBC,EACAhY,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GADgB5U,KAAK4sB,cAEjBgB,EAAM,EACNrvB,EAAIuuB,EACJpuB,EAAIquB,EACJ7e,EAAI8f,EACJtS,EAAS,EACJ7W,EAAI,EAAGA,EAAI8nB,EAAW9nB,IAC7B+oB,GAAO5tB,KAAK8uB,SAASvwB,EAAGG,EAAGwP,GAAKwN,EAChCnd,GAAK,EACLG,GAAK,EACLwP,GAAK,EACLwN,GAAUkR,EAEZ,OAAOgB,IAvQX,CAAA9lB,IAAA,OAAApH,MAAA,SA4QcwE,GACV,OAAOA,EAAIA,EAAIA,GAAKA,GAAS,EAAJA,EAAQ,IAAM,MA7Q3C,CAAA4C,IAAA,OAAApH,MAAA,SAgRciB,EAAW8F,EAAWvC,GAChC,OAAQ,EAAIA,GAAKvD,EAAIuD,EAAIuC,IAjR7B,CAAAK,IAAA,UAAApH,MAAA,SAqRiBnC,EAAWG,GAExB,IAAIqwB,EAAIvtB,KAAKkmB,MAAMnpB,GACjBywB,EAAIxtB,KAAKkmB,MAAMhpB,GAEjBH,GAAQwwB,EACRrwB,GAAQswB,EAERD,GAAQ,IACRC,GAAQ,IAT2B,IAW3BtC,EAAgB1sB,KAAhB0sB,MAAOD,EAASzsB,KAATysB,KAEXwC,EAAMvC,EAAMqC,EAAItC,EAAKuC,IAAIrB,KAAKpvB,EAAGG,GACjCwwB,EAAMxC,EAAMqC,EAAItC,EAAKuC,EAAI,IAAIrB,KAAKpvB,EAAGG,EAAI,GACzCywB,EAAMzC,EAAMqC,EAAI,EAAItC,EAAKuC,IAAIrB,KAAKpvB,EAAI,EAAGG,GACzC0wB,EAAM1C,EAAMqC,EAAI,EAAItC,EAAKuC,EAAI,IAAIrB,KAAKpvB,EAAI,EAAGG,EAAI,GAGjD2wB,EAAIrvB,KAAKsvB,KAAK/wB,GAGlB,OAAOyB,KAAKgnB,KAAKhnB,KAAKgnB,KAAKiI,EAAKE,EAAKE,GAAIrvB,KAAKgnB,KAAKkI,EAAKE,EAAKC,GAAIrvB,KAAKsvB,KAAK5wB,MA3S/E,CAAAoJ,IAAA,UAAApH,MAAA,SA+SiBnC,EAAWG,EAAWwP,GAAW,IACtCwe,EAAgB1sB,KAAhB0sB,MAAOD,EAASzsB,KAATysB,KAEXsC,EAAIvtB,KAAKkmB,MAAMnpB,GACjBywB,EAAIxtB,KAAKkmB,MAAMhpB,GACf6wB,EAAI/tB,KAAKkmB,MAAMxZ,GAEjB3P,GAAQwwB,EACRrwB,GAAQswB,EACR9gB,GAAQqhB,EAOR,IAAIC,EAAO9C,GALXqC,GAAQ,KAKatC,GAJrBuC,GAAQ,KAIsBvC,EAH9B8C,GAAQ,OAGgCV,KAAKtwB,EAAGG,EAAGwP,GAC/CuhB,EAAO/C,EAAMqC,EAAItC,EAAKuC,EAAIvC,EAAK8C,EAAI,KAAKV,KAAKtwB,EAAGG,EAAGwP,EAAI,GACvDwhB,EAAOhD,EAAMqC,EAAItC,EAAKuC,EAAI,EAAIvC,EAAK8C,KAAKV,KAAKtwB,EAAGG,EAAI,EAAGwP,GACvDyhB,EAAOjD,EAAMqC,EAAItC,EAAKuC,EAAI,EAAIvC,EAAK8C,EAAI,KAAKV,KAAKtwB,EAAGG,EAAI,EAAGwP,EAAI,GAC/D0hB,EAAOlD,EAAMqC,EAAI,EAAItC,EAAKuC,EAAIvC,EAAK8C,KAAKV,KAAKtwB,EAAI,EAAGG,EAAGwP,GACvD2hB,EAAOnD,EAAMqC,EAAI,EAAItC,EAAKuC,EAAIvC,EAAK8C,EAAI,KAAKV,KAAKtwB,EAAI,EAAGG,EAAGwP,EAAI,GAC/D4hB,EAAOpD,EAAMqC,EAAI,EAAItC,EAAKuC,EAAI,EAAIvC,EAAK8C,KAAKV,KAAKtwB,EAAI,EAAGG,EAAI,EAAGwP,GAC/D6hB,EAAOrD,EAAMqC,EAAI,EAAItC,EAAKuC,EAAI,EAAIvC,EAAK8C,EAAI,KAAKV,KAAKtwB,EAAI,EAAGG,EAAI,EAAGwP,EAAI,GAGvEmhB,EAAIrvB,KAAKsvB,KAAK/wB,GACd6C,EAAIpB,KAAKsvB,KAAK5wB,GACdsxB,EAAIhwB,KAAKsvB,KAAKphB,GAGlB,OAAOlO,KAAKgnB,KACVhnB,KAAKgnB,KAAKhnB,KAAKgnB,KAAKwI,EAAMI,EAAMP,GAAIrvB,KAAKgnB,KAAKyI,EAAMI,EAAMR,GAAIW,GAC9DhwB,KAAKgnB,KAAKhnB,KAAKgnB,KAAK0I,EAAMI,EAAMT,GAAIrvB,KAAKgnB,KAAK2I,EAAMI,EAAMV,GAAIW,GAC9D5uB,OAjVNmrB,EAAA,GC5Ta0D,GAAa,CACxBC,GAAI,IAAIje,YAAS,GAAI,GACrB+d,EAAG,IAAI/d,YAAS,EAAG,GACnBke,GAAI,IAAIle,YAAS,EAAG,GACpBme,EAAG,IAAIne,WAAQ,GAAI,GAEnB7O,EAAG,IAAI6O,WAAQ,EAAG,GAClBoe,GAAI,IAAIpe,WAAQ,GAAK,GACrBxE,EAAG,IAAIwE,WAAQ,EAAI,GACnBqe,GAAI,IAAIre,WAAQ,EAAI,IAMTse,GADkBrvB,OAAOsC,KAAKysB,IACgBtoB,IAAI,SAACkM,GAAD,OAAOoc,GAAWpc,cCNpE2c,GAAb,SAAAC,GAAA,SAAAD,IAAA,OAAAtvB,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAwwB,GAAAtvB,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAsvB,GAAAzb,MAAA/U,KAAA4U,YAAA,OAAA1T,OAAAkb,EAAA,EAAAlb,CAAAsvB,EAAAC,GAAAD,EAAA,CAAAtvB,OAAAwvB,GAAA,EAAAxvB,CAA8Bqe,QCPvB,SAASoR,GAAkBljB,GAChC,MAAsC,oBAAvBA,EAAUmjB,mBJFf3E,uGKaL,IAAM4E,GACX,SAAAA,IAAwE,IAArDC,EAAqDlc,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAjC,GAAWmc,EAAsBnc,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAJ,GAAI1T,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA6wB,GAAA7wB,KAAA8wB,UAAA9wB,KAAA+wB,SAqB1E,IAAMC,GAAe,CAAC,SAAU,SAAU,OAAQ,UAC3C,SAASC,GAAc7tB,GAC5B,SAAA2J,OAAUikB,GAAa5tB,EAAE8tB,QAAzB,YAAAnkB,OAA2C3J,EAAE+tB,OAGxC,IAAMC,GAAgB,KAChBC,GAAkBD,GAAgB,EAClCE,GAAiBD,GAAkB,EACnCE,GAAeD,GAAiB,EAEhCE,GAAb,WAiBE,SAAAA,EAAmBnH,EAA0BzgB,GAAkB,IAAAxK,EAAAY,KAAAkB,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAwxB,GAAAxxB,KAAAqqB,cAAArqB,KAhBxDb,KAAe,EAgByCa,KAfxDoa,MAAgB,EAewCpa,KAd/CoI,MAAQ,GAcuCpI,KAb/CwO,OAAS,IAasCxO,KAZ/CyxB,YAY+C,EAAAzxB,KAX9C0xB,qBAW8C,EAAA1xB,KAV9C2xB,eAU8C,EAAA3xB,KAT9C4xB,mBAS8C,EAAA5xB,KAR9C6xB,eAQ8C,EAAA7xB,KAP/C4J,aAO+C,EAAA5J,KAN/CqF,YAM+C,EAAArF,KAkOvD8xB,oBAlOuD,EAAA9xB,KAoSvD+xB,UAAuB,IAAIlB,GApS4B7wB,KAgVvDgyB,iBAAmB,CACzBC,EAAG,CACDC,IAAK,GACLC,MAAO,IAETC,EAAG,CACDF,IAAK,GACLC,MAAO,IAETE,EAAG,CACDH,IAAK,GACLC,MAAO,IAETG,EAAG,CACDJ,IAAK,GACLC,MAAO,IA9VTnyB,KAAK6xB,UAAY,CACfU,OAAQ,GACRC,MAAOxyB,MAETA,KAAK4J,QAAUA,EACf5J,KAAKqF,OAASF,EAAUnF,KAAK4J,QAAQxE,OACrCqtB,GAAKC,eAAiBlsB,EAASxG,KAAKqF,OAAOpB,aAAcwnB,GAAOb,mBAAoB,GACpF6H,GAAKE,eAAiBnsB,EAASxG,KAAKqF,OAAOnB,aAAcunB,GAAOZ,mBAAoB,GACpF4H,GAAKG,aAAepxB,KAAKkmB,MAAMlhB,EAASxG,KAAKqF,OAAOlB,UAAWsnB,GAAOd,mBAAoB,KAC1F3qB,KAAKyxB,OAAS,IAAIoB,GAAO,IAAI5gB,WAAQjS,KAAKoI,MAAQ,EAAGpI,KAAKwO,OAAS,GAAIxO,MACvEA,KAAK0xB,gBAAkB,IAAIve,MAAMnT,KAAKoI,OAAO6Q,UAAK5Y,GAAWsH,IAAI,SAAC+E,EAAGnO,GAAJ,OAC/D,IAAI4U,MAAM/T,EAAKoP,QAAQyK,UAAK5Y,GAAWsH,IAAI,SAACmrB,EAAIp0B,GAC9C,IAEIgT,EAFEqhB,EAAM,IAAI9gB,WAAQ1T,EAAGG,GADyB4G,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAIpD,QAAAyY,EAAApT,EAA2B2kB,EAAYpR,KAAvCtT,OAAAC,cAAAN,GAAAwT,EAAApT,EAAAG,QAAAC,MAAAR,GAAA,EAA6C,KACrCJ,GAAI8tB,EADiCla,EAAApY,OACpBqyB,EAAK3zB,GAC5B,GAAS,MAAL8F,EAAW,CACbwM,EAAOxM,EACP,QARgD,MAAAc,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAcpD,OAHY,MAARkM,IACFA,EAAO,IAAIuhB,GAAIF,EAAK3zB,IAEfsS,MAKX,IAAMwhB,EAAUlzB,KAAKyxB,OAAOsB,IAAIx0B,EAC1B40B,EAAYnzB,KAAK0xB,gBAAgBwB,GAASrd,KAAK,SAAC3Q,GAAD,QAASA,aAAa+tB,MACvEE,IACFnzB,KAAKyxB,OAAO2B,SAAS10B,EAAIy0B,EAAUJ,IAAIr0B,GAIzCsB,KAAK2xB,UAAY,IAAIxe,MAAMnT,KAAKoI,OAAO6Q,UAAK5Y,GAAWsH,IAAI,SAAC+E,EAAGnO,GAAJ,OACzD,IAAI4U,MAAM/T,EAAKoP,QAAQyK,UAAK5Y,GAAWsH,IAAI,SAACmrB,EAAIp0B,GAC9C,IAAMq0B,EAAM,IAAI9gB,WAAQ1T,EAAGG,GAE3B,OAAIU,EAAKqyB,OAAOsB,IAAIM,WAAWN,GALpB,KAOL3zB,EAAKsyB,2BAA2B4B,KAClCl0B,EAAKsyB,gBAAgBnzB,GAAGG,GAAK,IAAI60B,GAAK,IAAIthB,WAAQ1T,EAAGG,GAAI,EAAGU,IAEvD,IAAIo0B,GAAOT,EAAK3zB,IAEhB,SAIbY,KAAK4xB,cAAgB,IAAIze,MAAMnT,KAAKoI,OAAO6Q,UAAK5Y,GAAWsH,IAAI,SAAC+E,EAAGnO,GAAJ,OAC7D,IAAI4U,MAAM/T,EAAKoP,QAAQyK,UAAK5Y,GAAWsH,IAAI,SAACmrB,EAAIp0B,GAC9C,OAAOU,EAAKq0B,qBAAqBl1B,EAAGG,OAGxCsB,KAAK0zB,qBAGL,IAAK,IAAIn1B,EAAI,EAAGA,EAAIyB,KAAKoI,MAAO7J,IAC9B,IAAK,IAAIG,EAAI,EAAGA,EAAIsB,KAAKwO,OAAQ9P,IAAK,CACpC,IAAMi1B,EAAkB3zB,KAAK0xB,gBAAgBnzB,GAAGG,GAChDi1B,GAAmBA,EAAgBC,KAAK,GAExC,IAAMC,EAAW7zB,KAAK2xB,UAAUpzB,GAAGG,GACnCm1B,GAAYA,EAASD,KAAK,IApFlC,OAAA1yB,OAAAmb,EAAA,EAAAnb,CAAAswB,EAAA,EAAA1pB,IAAA,SAAA2Z,IAAA,WAcI,OApC2BtiB,EAoCLa,KAAKb,KAhCtB,CACL+xB,OAJa1vB,KAAKkmB,MAAMvoB,EAAOkyB,IAK/ByC,QAJe30B,EAAOkyB,GAAmBA,GAKzCF,MAJY3vB,KAAKkmB,MAAOvoB,EAAOkyB,GAAmBC,IAAkB,GAHjE,IAAwBnyB,MAsB/B+B,OAAAmb,EAAA,EAAAnb,CAAAswB,EAAA,EAAA1pB,IAAA,SAAApH,MAAA,SA2FgBqzB,EAA2Br1B,GACvC,IAAIH,EASJ,GARIw1B,aAAmB9hB,YACrB1T,EAAIw1B,EAAQx1B,EACZG,EAAIq1B,EAAQr1B,IAEZH,EAAIw1B,EACJr1B,EAAIA,IAGDsB,KAAKg0B,gBAAgBz1B,EAAGG,GAC3B,OAAO,KAET,IAAMu1B,EAAOj0B,KAAK2xB,UAAUpzB,GAAGG,GAC/B,OAAY,MAARu1B,EACKA,EAEAj0B,KAAK0xB,gBAAgBnzB,GAAGG,KA5GrC,CAAAoJ,IAAA,QAAApH,MAAA,WAgHiB,IACLixB,EAA6B3xB,KAA7B2xB,UAAWvpB,EAAkBpI,KAAlBoI,MAAOoG,EAAWxO,KAAXwO,OAC1B,OAAOtN,OAAAia,GAAA,EAAAja,CAAA,GACHyE,OAAOC,SADXqS,GAAAtW,EAAAuW,KAAA,SAAAC,IAAA,IAAA+b,EAAAC,EAAAC,EAAA,OAAAnc,GAAAtW,EAAAyW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAxS,MAAA,OAEatH,EAAI,EAFjB,YAEoBA,EAAI6J,GAFxB,CAAAiQ,EAAAxS,KAAA,SAGenH,EAAI,EAHnB,YAGsBA,EAAI8P,GAH1B,CAAA6J,EAAAxS,KAAA,YAKiB,OADHuuB,EAAIzC,EAAUpzB,GAAGG,IAJ/B,CAAA2Z,EAAAxS,KAAA,QAMU,OANVwS,EAAAxS,KAAA,EAMgBuuB,EANhB,OAGkC11B,IAHlC2Z,EAAAxS,KAAA,gBAE+BtH,IAF/B8Z,EAAAxS,KAAA,iCAAAwS,EAAAI,SAAAN,QAlHJ,CAAArQ,IAAA,SAAApH,MAAA,SAgIgBnC,EAAWG,GACvB,OAAIsB,KAAKg0B,gBAAgBz1B,EAAGG,GACnBsB,KAAK2xB,UAAUpzB,GAAGG,GAElB,OApIb,CAAAoJ,IAAA,oBAAApH,MAAA,SAwI2BnC,EAAWG,GAClC,OAAIsB,KAAKg0B,gBAAgBz1B,EAAGG,GACnBsB,KAAK0xB,gBAAgBnzB,GAAGG,GAExB,OA5Ib,CAAAoJ,IAAA,YAAApH,MAAA,SAmJmBoI,EAAmB4I,GAAiB,IAC3CnT,EAASuK,EAATvK,EAAGG,EAAMoK,EAANpK,EACX,IAAKsB,KAAKg0B,gBAAgBz1B,EAAGG,GAC3B,MAAM,IAAI6gB,MAAJ,oBAAAxS,OAA8BxO,EAA9B,MAAAwO,OAAoCrO,EAApC,MAEJgT,aAAgB2iB,IAClBr0B,KAAK6xB,UAAUU,OAAO/yB,KAAKkS,GAE7B,IAAM4iB,EAAUt0B,KAAK6a,OAAOtc,EAAGG,GAE/B,GAAIsrB,GAAasK,GAAU,CAEzB,IAAMC,EAAYv0B,KAAKw0B,cAAc1rB,GAFZ6P,GAAA,EAAAC,GAAA,EAAAC,OAAAxY,EAAA,IAGzB,QAAAo0B,EAAA1b,EAAuBwb,EAAU9X,SAAjC9W,OAAAC,cAAA+S,GAAA8b,EAAA1b,EAAAlT,QAAAC,MAAA6S,GAAA,EAA2C,KAAhC+b,EAAgCD,EAAA/zB,MAIzC,GAHIspB,GAAa0K,IAAaA,aAAoBJ,EAAQK,aACxDL,EAAQpK,UAAU0K,KAAKF,EAASxK,UAAWoK,EAAQpK,UAAUnB,MAAOuL,EAAQpK,UAAUlB,OAExD,IAA5BsL,EAAQpK,UAAUnB,OAA2C,IAA5BuL,EAAQpK,UAAUlB,MAErD,OATqB,MAAAhjB,GAAA4S,GAAA,EAAAC,EAAA7S,EAAA,YAAA2S,GAAA,MAAAI,EAAA9S,QAAA8S,EAAA9S,SAAA,WAAA2S,EAAA,MAAAC,GAeO,IAA5Byb,EAAQpK,UAAUnB,OAA2C,IAA5BuL,EAAQpK,UAAUlB,QACrD5G,QAAQ2H,KAAK,OAAQuK,EAAQpK,UAAW,yBACxCoK,EAAQpK,UAAU2K,KAAKP,EAAQpK,UAAUnB,OAAQuL,EAAQpK,UAAUlB,QAIvE,IAAM8L,EAAU90B,KAAK2xB,UAAUpzB,GAAGG,GAKlC,GAJe,MAAXo2B,GACF90B,KAAK+xB,UAAUjB,QAAQtxB,KAAKs1B,GAG1BpjB,aAAgB+gB,GAElBzyB,KAAK2xB,UAAUpzB,GAAGG,GAAKgT,MAClB,CAEL1R,KAAK2xB,UAAUpzB,GAAGG,GAAK,KAEvB,IAAMq2B,EAAqB/0B,KAAK0xB,gBAAgBnzB,GAAGG,GACzB,MAAtBq2B,GACF/0B,KAAK+xB,UAAUjB,QAAQtxB,KAAKu1B,GAE9B/0B,KAAK0xB,gBAAgBnzB,GAAGG,GAAKgT,EAE/B1R,KAAK+xB,UAAUhB,MAAMvxB,KAAKkS,GAC1B1R,KAAKg1B,kBAAkBlsB,KArM3B,CAAAhB,IAAA,oBAAApH,MAAA,SAuM2BoI,GACvB,IAAMmsB,EAAYj1B,KAAKk1B,OAAOpsB,EAASvK,EAAGuK,EAASpK,GAMnD,OALIu2B,IACFj1B,KAAK2xB,UAAU7oB,EAASvK,GAAGuK,EAASpK,GAAK,KACzCsB,KAAK+xB,UAAUjB,QAAQtxB,KAAKy1B,IAE9Bj1B,KAAKg1B,kBAAkBlsB,GAChBmsB,IA9MX,CAAAntB,IAAA,kBAAApH,MAAA,SAgNyBnC,EAAWG,GAChC,QAAIH,GAAKyB,KAAKoI,OAAS7J,EAAI,GAAKG,GAAKsB,KAAKwO,QAAU9P,EAAI,KAjN5D,CAAAoJ,IAAA,gBAAApH,MAAA,SAwNuBqyB,GACnB,OAAO/yB,KAAK4xB,cAAcmB,EAAIx0B,GAAGw0B,EAAIr0B,KAzNzC,CAAAoJ,IAAA,uBAAApH,MAAA,SA4N+B0W,EAAYC,GAAY,IAAA4F,EAAAjd,KAC7Cm1B,EAAU,IAAInb,IAWpB,OATmBob,GAAsBp1B,KAAKoa,MAAQgb,GAAsBx1B,QACjE6iB,QAAQ,SAACrhB,GAClB,IAAM7C,EAAI6Y,EAAKhW,EAAE7C,EACXG,EAAI2Y,EAAKjW,EAAE1C,EACXgT,EAAOuL,EAAKpC,OAAOtc,EAAGG,GAChB,MAARgT,GACFyjB,EAAQhZ,IAAI/a,EAAGsQ,KAGZyjB,IAxOX,CAAArtB,IAAA,WAAApH,MAAA,WAqPI,GAA2B,MAAvBV,KAAK8xB,eACP,MAAM,IAAIvS,MAAM,oCAElB,OAAOvf,KAAK8xB,iBAxPhB,CAAAhqB,IAAA,oBAAApH,MAAA,SA2P4BqyB,GACxB/yB,KAAK4xB,cAAcmB,EAAIx0B,GAAGw0B,EAAIr0B,GAAKsB,KAAKyzB,qBAAqBV,EAAIx0B,EAAGw0B,EAAIr0B,GADlC,IAAA22B,GAAA,EAAAC,GAAA,EAAAC,OAAAl1B,EAAA,IAEtC,QAAAm1B,EAAAC,EAAkBlF,GAAlB5qB,OAAAC,cAAAyvB,GAAAG,EAAAC,EAAA5vB,QAAAC,MAAAuvB,GAAA,EAAoC,KAAzBK,EAAyBF,EAAA90B,MAC5BnC,EAAIw0B,EAAIx0B,EAAIm3B,EAAIn3B,EAChBG,EAAIq0B,EAAIr0B,EAAIg3B,EAAIh3B,EAClBsB,KAAKg0B,gBAAgBz1B,EAAGG,KAC1BsB,KAAK4xB,cAAcrzB,GAAGG,GAAKsB,KAAKyzB,qBAAqBl1B,EAAGG,KANtB,MAAAsH,GAAAsvB,GAAA,EAAAC,EAAAvvB,EAAA,YAAAqvB,GAAA,MAAAI,EAAAxvB,QAAAwvB,EAAAxvB,SAAA,WAAAqvB,EAAA,MAAAC,GAStCv1B,KAAK0zB,uBApQT,CAAA5rB,IAAA,qBAAApH,MAAA,WAuQI,IAAMi1B,EAAwB,GAO1Bp3B,EAAI,EACNG,EAAI,EACN,IAAKH,EAAI,EAAGA,EAAIyB,KAAKoI,MAAO7J,IAC1B,IAAKG,GAAKH,EAAIyB,KAAKoa,OAAS,EAAG1b,EAAIsB,KAAKwO,OAAQ9P,GAAK,EAEnDi3B,EAAYn2B,KAAKQ,KAAK6a,OAAOtc,EAAGG,IAGpC,IAAKH,EAAI,EAAGA,EAAIyB,KAAKoI,MAAO7J,IAC1B,IAAKG,GAAKH,EAAIyB,KAAKoa,MAAQ,GAAK,EAAG1b,EAAIsB,KAAKwO,OAAQ9P,GAAK,EAEvDi3B,EAAYn2B,KAAKQ,KAAK6a,OAAOtc,EAAGG,IAGhCsB,KAAKoa,MAAQ,EAAI,GACnBub,EAAYC,UAKdD,EAAYn2B,KAAKQ,KAAKyxB,QACtBzxB,KAAK8xB,eAAiB6D,IAnS1B,CAAA7tB,IAAA,OAAApH,MAAA,SAsTcyc,GACV,IAAM0Y,EAAW71B,KAAK61B,WActB,OAbA71B,KAAK+xB,UAAY,IAAIlB,GAErBgF,EAASpT,QAAQ,SAACqT,GF5VO,oBE6VPA,EF7VFlC,MAGb,SAAcxwB,EAAc+Z,GACjC,IAAM4Y,EAAM3yB,EAAE4yB,mBAAqB7Y,EACnC,GAAI/Z,EAAE6yB,WAAWF,GACf,IACE3yB,EAAEwwB,KAAKmC,GACP,MAAOtoB,GACP,KAAIA,aAAa+iB,IAGf,MAAM/iB,EANV,QASErK,EAAE4yB,mBAAqB,OAGzB5yB,EAAE4yB,mBAAqBD,EE4UnBnC,CAAKkC,EAAQ3Y,KAGjBnd,KAAKk2B,mBAAmB/Y,GACxBnd,KAAKm2B,gBAAgBhZ,GACrBnd,KAAKo2B,YAAYjZ,GACjBnd,KAAKoa,QACLpa,KAAKb,MAAQge,EACbnd,KAAK0zB,qBACE1zB,KAAK+xB,YArUhB,CAAAjqB,IAAA,mBAAApH,MAAA,WA0UI,OAAOV,KAAK+xB,YA1UhB,CAAAjqB,IAAA,cAAApH,MAAA,SA6UqByc,GAMjB,IAHGnd,KAAKb,KAAOa,KAAKqqB,YAAYgM,QAAQC,qBAAuB,KAC7Dt2B,KAAKqqB,YAAYgM,QAAQC,qBACzBt2B,KAAKqqB,YAAYgM,QAAQE,aAGzB,KAAOpZ,EAAK,GAAG,CACb,IAAMqZ,EAAoBh1B,KAAKmS,IAAIwJ,EAAI,GACjC5e,EAAIojB,QAAW8U,QAAQ,EAAGz2B,KAAKoI,MAAQ,GACvClD,EAAIlF,KAAK6a,OAAOtc,EAAG,GACrB2G,aAAa+tB,IACf/tB,EAAEglB,UAAU2K,IAAIrN,GAAUxnB,KAAKqqB,YAAYgM,QAAQK,gBAAkBF,GAAoB,GAE3FrZ,GAAM,KA5Vd,CAAArV,IAAA,wBAAApH,MAAA,WAqY0B,IACdwwB,EAAWlxB,KAAKkxB,OAAhBA,OADcyF,EAEC32B,KAAKgyB,iBAAiBd,GAArCgB,EAFcyE,EAEdzE,IAAKC,EAFSwE,EAETxE,MACb,OAAOxqB,GAAI3H,KAAK42B,UAAW,EAAG,EAAGzE,EAAOD,KAxY5C,CAAApqB,IAAA,kBAAApH,MAAA,SA2YyBm2B,GAMrB,IAHA,IAAMC,EAAW92B,KAAK82B,SAChBC,EAAkBv1B,KAAK4S,IAAI0iB,EAAWt1B,KAAK0S,GAAK,GAChD0iB,EAAY52B,KAAK42B,UACdl4B,EAAI,EAAGA,GAAmB,GAAdsB,KAAKwO,OAAc9P,IACtC,IAAK,IAAIH,EAAI,EAAGA,EAAIyB,KAAKoI,MAAO7J,IAAK,CACnC,IAAM2G,EAAIlF,KAAKg3B,kBAAkBz4B,EAAGG,GACpC,GAAIwG,aAAa+tB,GAAK,CACpB,IAAIgE,EAAW,EACf,GAAU,IAANv4B,EACFu4B,EAAW,MACN,CACL,IAAMC,EAASl3B,KAAK6a,OAAOtc,EAAGG,EAAI,GAC5By4B,EAAYn3B,KAAK6a,OAAOtc,EAAI,EAAGG,EAAI,GACnC04B,EAAWp3B,KAAK6a,OAAOtc,EAAI,EAAGG,EAAI,GAClC24B,EAAaH,aAAkBjE,GAAMiE,EAAOI,eAAiBV,EAAsB,MAAVM,EAAiB,EAAI,EAC9FK,EACJJ,aAAqBlE,GAAMkE,EAAUG,eAAiBV,EAAyB,MAAbO,EAAoB,EAAI,EACtFK,EACJJ,aAAoBnE,GAAMmE,EAASE,eAAiBV,EAAwB,MAAZQ,EAAmB,EAAI,EAOzFH,GAJEA,EAFEF,EAAkB,EAETQ,EAAgBR,EAAkBM,GAAc,EAAIN,GAEpDS,GAAgBT,EAAkBM,GAAc,IAAKN,KAGpD,EAAItL,GAAOF,oBACrB8L,EAAaE,EAAgBC,GAAgB,EAAK/L,GAAOF,kBAG/D0L,EAAWxL,GAAOH,uBAAyB2L,GAAY,EAAIxL,GAAOH,wBAElE2L,GAAYL,EACZ1xB,EAAEoyB,eAAiBL,MA/a7B,CAAAnvB,IAAA,qBAAApH,MAAA,SAqb4Bm2B,GAAa,IAAAY,GAAA,EAAAC,GAAA,EAAAC,OAAAt3B,EAAA,IACrC,QAAAu3B,EAAAC,EAAgB73B,KAAK83B,QAArBnyB,OAAAC,cAAA6xB,GAAAG,EAAAC,EAAAhyB,QAAAC,MAAA2xB,GAAA,EAA8B,KAAnBvyB,EAAmB0yB,EAAAl3B,MAC5BwE,EAAE6yB,iBAAmB7yB,EAAE8yB,iBAFY,MAAAhyB,GAAA0xB,GAAA,EAAAC,EAAA3xB,EAAA,YAAAyxB,GAAA,MAAAI,EAAA5xB,QAAA4xB,EAAA5xB,SAAA,WAAAyxB,EAAA,MAAAC,MArbzC,CAAA7vB,IAAA,qBAAApH,MAAA,WA6bI,GAAIV,KAAK6a,OAAO7a,KAAKyxB,OAAOsB,IAAIx0B,EAAGyB,KAAKyxB,OAAOsB,IAAIr0B,aAAcu5B,GAC/D,OAAO/2B,OAAAmL,EAAA,EAAAnL,CAAA,GACFlB,KAAK6xB,UADV,CAEE9b,uBAAwB,EACxBiO,OAAQ,SAGZ,GAAIhkB,KAAKb,KAAOiyB,GACd,OAAO,KAIT,IAAM8G,EAAcl4B,KAAK6xB,UAAUU,OAAOjrB,OAAO,SAAC/H,GAAD,OAAOA,EAAE44B,aAC1D,OAA2B,IAAvBD,EAAYt4B,OACPsB,OAAAmL,EAAA,EAAAnL,CAAA,GACFlB,KAAK6xB,UADV,CAEE9b,uBAAwB,EACxBiO,OAAQ,SAIL9iB,OAAAmL,EAAA,EAAAnL,CAAA,GACFlB,KAAK6xB,UADV,CAEE9b,uBAAwBmiB,EAAYt4B,OAAS4G,EAASxG,KAAKqF,OAAOd,oBAAqB,EAAG,KAC1Fyf,OAAQ,UArdd,CAAAlc,IAAA,iBAAApH,MAAA,WA6dIV,KAAK61B,WAAWpT,QAAQ,SAAChV,GACnBuc,GAAavc,KACDA,EAAEyc,UAAUlB,MACZvb,EAAEyc,UAAUnB,OAExBqP,GAAU3qB,IACGA,EAAE4qB,WAnezB,CAAAvwB,IAAA,mBAAApH,MAAA,WA0eI,IAAM43B,EAAOt4B,KACb,OAAOkB,OAAAia,GAAA,EAAAja,CAAA,GACHyE,OAAOC,SADXqS,GAAAtW,EAAAuW,KAAA,SAAAqgB,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAh0B,EAAA,OAAA+S,GAAAtW,EAAAyW,KAAA,SAAA+gB,GAAA,cAAAA,EAAA7gB,KAAA6gB,EAAAtzB,MAAA,OAAA2yB,GAAA,EAAAC,GAAA,EAAAC,OAAAr4B,EAAA84B,EAAA7gB,KAAA,EAAAqgB,EAEsBL,EAAK5G,gBAF3B/rB,OAAAC,YAAA,UAAA4yB,GAAAI,EAAAD,EAAA9yB,QAAAC,KAAA,CAAAqzB,EAAAtzB,KAAA,SAEegzB,EAFfD,EAAAl4B,MAAAo4B,GAAA,EAAAC,GAAA,EAAAC,OAAA34B,EAAA84B,EAAA7gB,KAAA,GAAA2gB,EAGsBJ,EAHtBlzB,OAAAC,YAAA,WAAAkzB,GAAAI,EAAAD,EAAApzB,QAAAC,KAAA,CAAAqzB,EAAAtzB,KAAA,SAIQ,OADSX,EAHjBg0B,EAAAx4B,MAAAy4B,EAAAtzB,KAAA,GAIcX,EAJd,QAAA4zB,GAAA,EAAAK,EAAAtzB,KAAA,iBAAAszB,EAAAtzB,KAAA,iBAAAszB,EAAA7gB,KAAA,GAAA6gB,EAAA5gB,GAAA4gB,EAAA,UAAAJ,GAAA,EAAAC,EAAAG,EAAA5gB,GAAA,QAAA4gB,EAAA7gB,KAAA,GAAA6gB,EAAA7gB,KAAA,GAAAwgB,GAAA,MAAAG,EAAAhzB,QAAAgzB,EAAAhzB,SAAA,WAAAkzB,EAAA7gB,KAAA,IAAAygB,EAAA,CAAAI,EAAAtzB,KAAA,eAAAmzB,EAAA,eAAAG,EAAA3gB,OAAA,mBAAA2gB,EAAA3gB,OAAA,YAAAggB,GAAA,EAAAW,EAAAtzB,KAAA,gBAAAszB,EAAAtzB,KAAA,iBAAAszB,EAAA7gB,KAAA,GAAA6gB,EAAA1L,GAAA0L,EAAA,SAAAV,GAAA,EAAAC,EAAAS,EAAA1L,GAAA,QAAA0L,EAAA7gB,KAAA,GAAA6gB,EAAA7gB,KAAA,GAAAkgB,GAAA,MAAAG,EAAA1yB,QAAA0yB,EAAA1yB,SAAA,WAAAkzB,EAAA7gB,KAAA,IAAAmgB,EAAA,CAAAU,EAAAtzB,KAAA,eAAA6yB,EAAA,eAAAS,EAAA3gB,OAAA,mBAAA2gB,EAAA3gB,OAAA,6BAAA2gB,EAAA1gB,SAAA8f,EAAA,gEA3eJ,CAAAzwB,IAAA,WAAA2Z,IAAA,WA0XI,OAAOzhB,KAAKb,KAAOqC,KAAK0S,GAAK,EAAIqd,KA1XrC,CAAAzpB,IAAA,aAAA2Z,IAAA,WA8XI,OAAQzhB,KAAK82B,UAAsB,EAAVt1B,KAAK0S,IAAW1S,KAAK0S,GAAK,MAAQ,UA9X/D,CAAApM,IAAA,YAAA2Z,IAAA,WAkYI,OAAQjgB,KAAKoN,KAA+B,GAA1BpN,KAAK4S,IAAIpU,KAAK82B,YAAmBt1B,KAAK0S,GAAK,GAAM,GAAM,OAlY7Esd,EAAA,GAufA,SAAS4H,GAAWC,GAKlB,IAJA,IACEC,EACAC,EAFEC,EAAeH,EAAMz5B,OAIlB,IAAM45B,GAEXD,EAAc/3B,KAAKkmB,MAAMlmB,KAAKkI,SAAW8vB,GAGzCF,EAAiBD,EAFjBG,GAAgB,GAGhBH,EAAMG,GAAgBH,EAAME,GAC5BF,EAAME,GAAeD,EAEvB,OAAOD,EAET,IAAMjE,GAAwB,CAC5BgE,GAAQ7I,GAAiBljB,SACzB+rB,GAAQ7I,GAAiBljB,SACzB+rB,GAAQ7I,GAAiBljB,SACzB+rB,GAAQ7I,GAAiBljB,SACzB+rB,GAAQ7I,GAAiBljB,UC3iBpB,SAAS+qB,GAAa3qB,GAC3B,MAAoC,kBAArBA,EAAU4qB,OAGpB,IAAeoB,GAAtB,WA+BE,SAAAA,EAAmB1G,EAA8BP,GAE/C,GAF8DtxB,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAy5B,GAAAz5B,KAAAwyB,QAAAxyB,KA5BzD05B,YAAa,EA4B2C15B,KA3BxD25B,SAAWC,IA2B6C55B,KA1BxD+3B,sBA0BwD,EAAA/3B,KAzBxDg2B,mBAAqB,EAyBmCh2B,KAR/C65B,cAQ+C,EAAA75B,KANxD+yB,SAMwD,EAC7D/yB,KAAK+yB,IAAMA,EAAI+G,QACF,MAATtH,EACF,MAAM,IAAIjT,MAAM,eAElBvf,KAAK65B,SAAWrH,EAAMrzB,KACtBa,KAAK+3B,iBAAmB/3B,KAAKwyB,MAAMuH,wBArCvC,OAAA74B,OAAAmb,EAAA,EAAAnb,CAAAu4B,EAAA,EAAA3xB,IAAA,cAAA2Z,IAAA,WAQI,ONlB2Bvc,EMkBLlF,KAAK+3B,mBNjBpB,EACA9L,GAAY+N,SACV90B,GAAK,GACP+mB,GAAYgO,KACV/0B,GAAK,GACP+mB,GAAYiO,KACVh1B,GAAK,GACP+mB,GAAYkO,IAEZlO,GAAYmO,UAVhB,IAAwBl1B,IMU/B,CAAA4C,IAAA,iBAAA2Z,IAAA,WAYI,OAAQzhB,KAAK20B,YAAoBjC,iBAZrC,CAAA5qB,IAAA,iBAAA2Z,IAAA,WAgBI,OAAQzhB,KAAK20B,YAAoBhC,iBAhBrC,CAAA7qB,IAAA,aAAA2Z,IAAA,WAoBI,OAAQzhB,KAAK20B,YAAoB0F,aApBrC,CAAAvyB,IAAA,MAAA2Z,IAAA,WA4BI,OAAOzhB,KAAKwyB,MAAMrzB,KAAOa,KAAK65B,aA5BlC34B,OAAAmb,EAAA,EAAAnb,CAAAu4B,EAAA,EAAA3xB,IAAA,cAAApH,MAAA,WA2CI,OAAOc,KAAK0O,KAAK1O,KAAKmS,IAAInS,KAAKgR,IAAI7K,GAAI,EAAI3H,KAAK25B,SAAU,EAAG,EAAG,EAAG,GAAI,GAAI,MA3C/E,CAAA7xB,IAAA,OAAApH,MAAA,SA+Ccyc,GAKV,IAAMoX,EAAYv0B,KAAKwyB,MAAMgC,cAAcx0B,KAAK+yB,KAChD/yB,KAAKs6B,aAAa/F,EAAWpX,GAC7Bnd,KAAKu6B,cAAchG,EAAWpX,GAC9Bnd,KAAKw6B,gBAAgBrd,GACrBnd,KAAKy6B,YAAYtd,KAxDrB,CAAArV,IAAA,kBAAApH,MAAA,SA2DkBm2B,GACd72B,KAAK+3B,iBAAmB/3B,KAAKwyB,MAAMuH,0BA5DvC,CAAAjyB,IAAA,eAAApH,MAAA,SA+De6zB,EAA+BsC,GAC1C,GAAI72B,gBAAgByyB,GAClBzyB,KAAK25B,SAAW,MACX,CACL,IAAIe,EAAc16B,KAAK25B,SADlBr0B,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAEL,QAAAoF,EAAAC,EAAoB6uB,EAApB5uB,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAA+B,KAAAq1B,EAAAl1B,EAAA/E,MAAjBwE,EAAiBhE,OAAAC,EAAA,EAAAD,CAAAy5B,EAAA,MACvBC,EAAUp5B,KAAKgR,IACnB,GACA7K,GAAI3H,KAAK+yB,IAAIr0B,EAAGsB,KAAKwyB,MAAMhkB,OAAS,EAAGxO,KAAKwyB,MAAMhkB,OAAQid,GAAOX,iBAAkB,IAE/E+P,EAAuB31B,aAAaouB,GAAOsG,IAAW10B,EAAEy0B,SAAWiB,EAEvEF,EADEx1B,aAAautB,GACD,EAEAjxB,KAAKmS,IAAI+mB,EAAaG,IAXnC,MAAA70B,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAcLxF,KAAK25B,SAAWe,KAhFtB,CAAA5yB,IAAA,gBAAApH,MAAA,SAoFgB6zB,EAA+BpX,GAC3C,GAAI6M,GAAahqB,MAAO,KAAA2Y,GAAA,EAAAC,GAAA,EAAAC,OAAAxY,EAAA,IACtB,QAAAyY,EAAAC,EAAmBwb,EAAU9X,SAA7B9W,OAAAC,cAAA+S,GAAAG,EAAAC,EAAAlT,QAAAC,MAAA6S,GAAA,EAAuC,KAA5BjH,EAA4BoH,EAAApY,MAChCV,KAAK86B,WAAWppB,KAIM,MAAvB1R,KAAK0yB,gBACHhhB,EAAKwY,UAAUnB,MAAQ/oB,KAAKkqB,UAAUnB,OACxC/oB,KAAKiE,aAAayN,EAAMyL,GAGD,MAAvBnd,KAAK2yB,gBACHjhB,EAAKwY,UAAUlB,MAAQhpB,KAAKkqB,UAAUlB,OACxChpB,KAAKkE,aAAawN,EAAMyL,KAbR,MAAAnX,GAAA4S,GAAA,EAAAC,EAAA7S,EAAA,YAAA2S,GAAA,MAAAI,EAAA9S,QAAA8S,EAAA9S,SAAA,WAAA2S,EAAA,MAAAC,OArF5B,CAAA/Q,IAAA,aAAApH,MAAA,SAyGagR,GACT,OAAOqpB,GAAiB/6B,KAAM0R,KA1GlC,CAAA5J,IAAA,eAAApH,MAAA,SA6Ges6B,EAAqB7d,GAChC,GAAI6M,GAAahqB,MAAO,CACtB,IAAMi7B,GAAmBD,EAAM9Q,UAAUnB,MAAQ/oB,KAAKkqB,UAAUnB,OAAS/oB,KAAK0yB,eAAiBvV,EAI/F6d,EAAM9Q,UAAU0K,KAAK50B,KAAKkqB,UAAW1C,GAAUyT,GAAkB,MAnHvE,CAAAnzB,IAAA,eAAApH,MAAA,SAwHes6B,EAAqB7d,GAChC,GAAI6M,GAAahqB,MAAO,CACtB,IAAMi7B,GAAmBD,EAAM9Q,UAAUlB,MAAQhpB,KAAKkqB,UAAUlB,OAAShpB,KAAK2yB,eAAiBxV,EAI/F6d,EAAM9Q,UAAU0K,KAAK50B,KAAKkqB,UAAW,EAAG1C,GAAUyT,OA9HxD,CAAAnzB,IAAA,cAAApH,MAAA,SAmIcyc,GACV,IAAMkd,EAAar6B,KAAKq6B,WAAald,EAC/B+d,EAAgBl7B,KAAKwyB,MAAM3X,OAAO7a,KAAK+yB,IAAIx0B,EAAGyB,KAAK+yB,IAAIr0B,EAAI,GAM7DsrB,GAAakR,IAAkBb,EAAa,GAAKU,GAAiBG,EAAel7B,OACnFA,KAAKkqB,UAAU0K,KAAKsG,EAAchR,UAAW1C,GAAU6S,GAAa,OA5I1EZ,EAAA,GAqJA,SAASsB,GAAiBI,EAAeH,GACvC,OACEhR,GAAamR,IACbnR,GAAagR,KAEZG,aAAoBH,EAAMrG,aACzBqG,aAAiBG,EAASxG,aAEzBwG,aAAoB1I,IAAQuI,aAAiBvI,IAZpD,SAAmB0I,EAAeC,EAAgCJ,EAAYK,GAC5E,OAAOF,aAAoBC,GAAgBJ,aAAiBK,EAaxDC,CAAUH,EAAU5H,GAAMyH,EAAO/H,KA/JjBwG,GACbh1B,YAAc,OADDg1B,GAEbY,WAAa,EAiKtB,IAAMkB,GAAW,IAAIhP,GACR0G,GAAb,SAAAuI,GAOE,SAAAvI,EAA0BF,EAAcP,GAAc,IAAApzB,EAAA,OAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAizB,IACpD7zB,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA+xB,GAAAnZ,KAAA9Z,KAAM+yB,EAAKP,KADyCO,MAAA3zB,EAH/Ck4B,eAAyB,EAGsBl4B,EAF/Cq8B,UAE+C,EAAAr8B,EAD/C8qB,UAAY,IAAItB,GAAU,GAAd1nB,OAAAw6B,GAAA,EAAAx6B,CAAA9B,IAGjBA,EAAKu6B,SAAW,EAChBv6B,EAAKq8B,KAAOr8B,EAAKu8B,aAHmCv8B,EAPxD,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAA+xB,EAAAuI,GAAAt6B,OAAAmb,EAAA,EAAAnb,CAAA+xB,EAAA,EAAAnrB,IAAA,aAAApH,MAAA,SAeayc,GAET,OAAOA,EAAK,IAjBhB,CAAArV,IAAA,aAAApH,MAAA,WAwBI,IAAMgG,EAAOiB,GAAI3H,KAAK+yB,IAAIr0B,EAAGsB,KAAKwyB,MAAMhkB,OAAS,EAAG,EAAGxO,KAAKwyB,MAAMnI,YAAYuR,SAAU,MAClFC,EAASl0B,GAAI3H,KAAK+yB,IAAIr0B,EAAGsB,KAAKwyB,MAAMhkB,OAAS,EAAG,EAAG,EAAG,GAEtDrP,EAAqB,MAAda,KAAKwyB,MAAgB,EAAIxyB,KAAKwyB,MAAMrzB,KAC3C0c,EAKA,IAJJ0f,GAASO,QACP,QAAU97B,KAAK+yB,IAAIx0B,EAAIyB,KAAKwyB,MAAMpqB,MAAQ,GAAKyzB,EAC/C,KAAO77B,KAAK+yB,IAAIr0B,EAAI,EACpBS,EAAO,IAAO,MAElB,OAAOqC,KAAKgR,IAAIhR,KAAKmS,IAAIjN,EAAOmV,EAAQ,GAAIra,KAAKmS,IAAI,GAAuC,IAAlC3T,KAAKwyB,MAAMnI,YAAYuR,aAlCrF,CAAA9zB,IAAA,cAAApH,MAAA,WAsCI,OAAOV,KAAKi3B,aAtChB,CAAAnvB,IAAA,OAAApH,MAAA,SAyCOyc,GAEHnd,KAAKy6B,YAAYtd,GACjBnd,KAAK+7B,mBAAmB5e,GACxBnd,KAAKg8B,gBAAgB7e,GACrBnd,KAAKw6B,gBAAgBrd,GACrBnd,KAAKy7B,KAAOz7B,KAAK27B,eA/CrB,CAAA7zB,IAAA,qBAAApH,MAAA,SAkDqByc,GAEjB,IAAM9O,EAAOrO,KAAKwyB,MAAM3X,OAAO7a,KAAK+yB,IAAIx0B,EAAI,EAAGyB,KAAK+yB,IAAIr0B,GAClDu9B,EAAQj8B,KAAKwyB,MAAM3X,OAAO7a,KAAK+yB,IAAIx0B,EAAI,EAAGyB,KAAK+yB,IAAIr0B,GAErD8C,KAAKkI,SAAW,IAClB1J,KAAKk8B,WAAW7tB,EAAM8O,GACtBnd,KAAKk8B,WAAWD,EAAO9e,KAEvBnd,KAAKk8B,WAAWD,EAAO9e,GACvBnd,KAAKk8B,WAAW7tB,EAAM8O,MA5D5B,CAAArV,IAAA,aAAApH,MAAA,SAgEawE,EAAgBiY,GAChB,MAALjY,GAAalF,KAAK86B,WAAW51B,IAC3BA,EAAEglB,UAAUnB,MAAQ/oB,KAAKkqB,UAAUnB,OACrC/oB,KAAKiE,aAAaiB,EAAGiY,KAnE7B,CAAArV,IAAA,kBAAApH,MAAA,SAwEkByc,GACV3b,KAAKkI,SAAW,IAAO1J,KAAKkqB,UAAUnB,MAAQ5L,GAChDnd,KAAKkqB,UAAU2K,KAAK,EAAG,KA1E7B,CAAA/sB,IAAA,MAAApH,MAAA,WA+EI,OAAOV,KAAKy7B,OA/EhB,CAAA3zB,IAAA,WAAApH,MAAA,WAmFI,OAAOV,KAAKs3B,mBAnFhBrE,EAAA,CAAyBwG,IAAZxG,GACJxuB,YAAc,MADVwuB,GAEJoH,WAAa,EAFTpH,GAGJP,eAAiB,GAoFnB,IAAMa,GAAb,SAAA4I,GASE,SAAA5I,EAAYR,GAA+C,IAAA9V,EAAjC8L,EAAiCnU,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAjB,EAAG4d,EAAc5d,UAAAhV,OAAA,EAAAgV,UAAA,QAAAvU,EAAA,OAAAa,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAuzB,IACzDtW,EAAA/b,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAqyB,GAAAzZ,KAAA9Z,KAAM+yB,EAAKP,KAPNtI,UAAY,IAAItB,GAAU6C,GAAOR,aAArB/pB,OAAAw6B,GAAA,EAAAx6B,CAAA+b,IAQjBA,EAAKiN,UAAU2K,IAAI9L,EAAO,GAF+B9L,EAT7D,OAAA/b,OAAAkb,EAAA,EAAAlb,CAAAqyB,EAAA4I,GAAAj7B,OAAAmb,EAAA,EAAAnb,CAAAqyB,EAAA,EAAAzrB,IAAA,aAAA2Z,IAAA,WAMI,OAAOzhB,KAAKwyB,MAAMnI,YAAY+R,wBANlCl7B,OAAAmb,EAAA,EAAAnb,CAAAqyB,EAAA,EAAAzrB,IAAA,aAAApH,MAAA,SAcayc,GAET,OAAOA,EAAK,KAhBhB,CAAArV,IAAA,OAAApH,MAAA,SAmBOyc,GACHjc,OAAAm7B,GAAA,EAAAn7B,QAAA2Y,EAAA,EAAA3Y,CAAAqyB,EAAA+I,WAAA,OAAAt8B,MAAA8Z,KAAA9Z,KAAWmd,GACXnd,KAAKg8B,gBAAgB7e,KArBzB,CAAArV,IAAA,kBAAApH,MAAA,SAwBkByc,GAAY,IAAAof,EACqBv8B,KAAKwyB,MAAMnI,YAAlDmS,EADkBD,EAClBC,gBAAiBC,EADCF,EACDE,kBACnBC,EAA0B/0B,GAAI3H,KAAK+yB,IAAIr0B,EAAGsB,KAAKwyB,MAAMhkB,OAAS,EAAGxO,KAAKwyB,MAAMhkB,OAASiuB,EAAmB,EAAG,GAC3GE,EAA0B38B,KAAKkqB,UAAUnB,MAC3CvnB,KAAKkI,SAAW8yB,EAAkBE,EAA0BC,EAA0Bxf,GACxFnd,KAAKkqB,UAAU2K,KAAK,EAAG,OA7B7BtB,EAAA,CAA0BkG,IAAblG,GACJ9uB,YAAc,OADV8uB,GAEJb,eAAiBjH,GAAOV,mBAgC1B,IAAMuI,GAAb,SAAAsJ,GAAA,SAAAtJ,IAAA,IAAA3P,EAAAT,EAAAhiB,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAszB,GAAA,QAAAzP,EAAAjP,UAAAhV,OAAAkkB,EAAA,IAAA3Q,MAAA0Q,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAAD,EAAAC,GAAAnP,UAAAmP,GAAA,OAAAb,EAAAhiB,OAAA0Y,EAAA,EAAA1Y,CAAAlB,MAAA2jB,EAAAziB,OAAA2Y,EAAA,EAAA3Y,CAAAoyB,IAAAxZ,KAAA/E,MAAA4O,EAAA,CAAA3jB,MAAA+M,OAAA+W,MACE4V,YAAa,EADfxW,EAAA,OAAAhiB,OAAAkb,EAAA,EAAAlb,CAAAoyB,EAAAsJ,GAAA17B,OAAAmb,EAAA,EAAAnb,CAAAoyB,EAAA,EAAAxrB,IAAA,aAAApH,MAAA,WAGiB,OAAO,MAHxB4yB,EAAA,CAA0BmG,IAAbnG,GAEJ7uB,YAAc,OAIhB,IAAMwzB,GAAb,SAAA4E,GAAA,SAAA5E,IAAA,OAAA/2B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAi4B,GAAA/2B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA+2B,GAAAljB,MAAA/U,KAAA4U,YAAA,OAAA1T,OAAAkb,EAAA,EAAAlb,CAAA+2B,EAAA4E,GAAA37B,OAAAmb,EAAA,EAAAnb,CAAA+2B,EAAA,EAAAnwB,IAAA,aAAApH,MAAA,WAEiB,OAAO,MAFxBu3B,EAAA,CAA8BwB,IAAjBxB,GACJxzB,YAAc,YAIhB,IAAMq4B,GAAb,SAAAC,GAIE,SAAAD,EAAY/J,GAA6E,IAAAnP,EAA/DmF,EAA+DnU,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAA/C,EAAG4d,EAA4C5d,UAAAhV,OAAA,EAAAgV,UAAA,QAAAvU,EAAvB28B,EAAuBpoB,UAAAhV,OAAA,EAAAgV,UAAA,QAAAvU,EAAA,OAAAa,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA88B,IACvFlZ,EAAA1iB,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA47B,GAAAhjB,KAAA9Z,KAAM+yB,EAAKhK,EAAOyJ,KADqEwK,gBAAApZ,EAFzF8V,YAAa,EAE4E9V,EADjFqZ,SAAW,EACsErZ,EAJ3F,OAAA1iB,OAAAkb,EAAA,EAAAlb,CAAA47B,EAAAC,GAAA77B,OAAAmb,EAAA,EAAAnb,CAAA47B,EAAA,EAAAh1B,IAAA,OAAApH,MAAA,SAOOyc,GACHjc,OAAAm7B,GAAA,EAAAn7B,QAAA2Y,EAAA,EAAA3Y,CAAA47B,EAAAR,WAAA,OAAAt8B,MAAA8Z,KAAA9Z,KAAWmd,GACPnd,KAAKi9B,SAAW,IAClBj9B,KAAKi9B,UAAY9f,GAEfnd,KAAKkqB,UAAUX,QAAU,GAAKvpB,KAAKi9B,UAAY,IAEjDj9B,KAAKkqB,UAAU2K,IAAI,EAAG,GACtB70B,KAAKi9B,SAAWj9B,KAAKg9B,mBAf3BF,EAAA,CAA8BvJ,IAAjBuJ,GACJr4B,YAAc,WAsBhB,IAuBMy4B,GAAb,SAAAC,GAAA,SAAAD,IAAA,IAAAE,EAAAC,EAAAn8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAk9B,GAAA,QAAAI,EAAA1oB,UAAAhV,OAAAkkB,EAAA,IAAA3Q,MAAAmqB,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAAzZ,EAAAyZ,GAAA3oB,UAAA2oB,GAAA,OAAAF,EAAAn8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,MAAAo9B,EAAAl8B,OAAA2Y,EAAA,EAAA3Y,CAAAg8B,IAAApjB,KAAA/E,MAAAqoB,EAAA,CAAAp9B,MAAA+M,OAAA+W,MAGkB0Z,WAAa,IAH/BH,EAISI,cAAgB,GAJzBJ,EAAA,OAAAn8B,OAAAkb,EAAA,EAAAlb,CAAAg8B,EAAAC,GAAAj8B,OAAAmb,EAAA,EAAAnb,CAAAg8B,EAAA,EAAAp1B,IAAA,WAAApH,MAAA,SAUWyc,GACPnd,KAAKy9B,eAAiB,GAAKz9B,KAAKw9B,WAAargB,EAC7Cnd,KAAK09B,oBAZT,CAAA51B,IAAA,OAAApH,MAAA,SAeOyc,GAUH,MATInd,KAAKi0B,KAAK0J,cAAgB1R,GAAYgO,KACxCj6B,KAAKy9B,eAAiB,EAAIz9B,KAAKw9B,WAAargB,EACnCnd,KAAKi0B,KAAK0J,cAAgB1R,GAAY+N,SAC/Ch6B,KAAKy9B,eAAiB,GAAKz9B,KAAKw9B,WAAargB,EAE7Cnd,KAAKy9B,eAAiB,GAAKz9B,KAAKw9B,WAAargB,EAE/Cnd,KAAK09B,kBAEC,IAAIlN,KAzBd,CAAA1oB,IAAA,kBAAApH,MAAA,WA6BQV,KAAKy9B,cAAgB,EACvBz9B,KAAKi0B,KAAK2J,MACD59B,KAAKy9B,cAAgB,GAC9Bz9B,KAAKwlB,WAhCX,CAAA1d,IAAA,kBAAA2Z,IAAA,WAOI,OAAOzhB,KAAKw9B,WAAax9B,KAAK69B,QAPlCX,EAAA,CAvBA,oBAAAY,IAAA58B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA89B,GAAA99B,KACU65B,cADV,EAAA75B,KAESi0B,UAFT,SAAA/yB,OAAAmb,EAAA,EAAAnb,CAAA48B,EAAA,EAAAh2B,IAAA,WAAApH,MAAA,SAOWuzB,GACPj0B,KAAKi0B,KAAOA,EACZj0B,KAAK65B,SAAW75B,KAAKi0B,KAAKzB,MAAMrzB,OATpC,CAAA2I,IAAA,SAAApH,MAAA,WAkBI,IAAMq9B,EAAQ/9B,KAAKi0B,KAAK+J,QAAQzyB,QAAQvL,MACxCA,KAAKi0B,KAAK+J,QAAQC,OAAOF,EAAO,KAnBpC,CAAAj2B,IAAA,MAAA2Z,IAAA,WAII,OAAOzhB,KAAKi0B,KAAKzB,MAAMrzB,KAAOa,KAAK65B,aAJvCiE,EAAA,IAuBaZ,GACJz4B,YAAc,SADVy4B,GAEJgB,QAAS,EAoCX,IAAMzL,GAAb,SAAA0L,GAgCE,SAAA1L,EAAYM,EAAcP,GAAc,IAAA4L,EAAA,OAAAl9B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAyyB,IACtC2L,EAAAl9B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAuxB,GAAA3Y,KAAA9Z,KAAM+yB,EAAKP,KA5BN6F,OAAiB5M,GAAOnB,cA2BS8T,EA1BjCzE,SAAW,EA0BsByE,EAzBjCpG,qBAyBiC,EAAAoG,EAtBjCC,OAAS,EAsBwBD,EArBjCta,KAAc,GAqBmBsa,EApBjCJ,QAAwB,GAsB7BI,EAAKrG,iBAAmB,GACxBqG,EAAKpG,gBAAkBoG,EAAKrG,iBAHUqG,EAhC1C,OAAAl9B,OAAAkb,EAAA,EAAAlb,CAAAuxB,EAAA0L,GAAAj9B,OAAAmb,EAAA,EAAAnb,CAAAuxB,EAAA,EAAA3qB,IAAA,QAAA2Z,IAAA,WAeI,OAAIzhB,KAAK+3B,kBAAoB,EAEpB,GACE/3B,KAAK+3B,kBAAoB,GAE3B,EAAI,EACF/3B,KAAK+3B,kBAAoB,GAC3B,EACE/3B,KAAK+3B,kBAAoB,GAE3B,IAGA,MA5Bb72B,OAAAmb,EAAA,EAAAnb,CAAAuxB,EAAA,EAAA3qB,IAAA,YAAApH,MAAA,SAsCY49B,IACQA,EAAO3J,YAAsCuJ,QAGe,MAAtEl+B,KAAKu+B,iBAAiBD,EAAO3J,gBAInC2J,EAAOE,SAASx+B,MAChBA,KAAKg+B,QAAQx+B,KAAK8+B,MA/CtB,CAAAx2B,IAAA,mBAAApH,MAAA,SAkDmBoK,GACf,OAAO9K,KAAKg+B,QAAQnoB,KAAK,SAACpI,GAAD,OAAOA,EAAEknB,cAAgB7pB,MAnDtD,CAAAhD,IAAA,WAAApH,MAAA,SAsDWyc,GAAY,IAAAkY,GAAA,EAAAC,GAAA,EAAAC,OAAAl1B,EAAA,IACnB,QAAAo0B,EAAAgB,EAAgBz1B,KAAKg+B,QAArBr4B,OAAAC,cAAAyvB,GAAAZ,EAAAgB,EAAA5vB,QAAAC,MAAAuvB,GAAA,EAA8B,KAAnB5nB,EAAmBgnB,EAAA/zB,MACxBiwB,GAAeljB,IACjBA,EAAEmjB,SAASzT,IAHI,MAAAnX,GAAAsvB,GAAA,EAAAC,EAAAvvB,EAAA,YAAAqvB,GAAA,MAAAI,EAAAxvB,QAAAwvB,EAAAxvB,SAAA,WAAAqvB,EAAA,MAAAC,MAtDvB,CAAAztB,IAAA,MAAApH,MAAA,WA+DIV,KAAKwyB,MAAMiM,UAAUz+B,KAAK+yB,IAAK,IAAIkF,GAASj4B,KAAK+yB,IAAK/yB,KAAKwyB,UA/D/D,CAAA1qB,IAAA,WAAApH,MAAA,WAoEI,OAAOV,KAAKq4B,OAAgC,IAAvB5M,GAAOnB,gBApEhC,CAAAxiB,IAAA,aAAApH,MAAA,SAwEayc,GACT,OAAOA,EAAK,IAzEhB,CAAArV,IAAA,OAAApH,MAAA,SA4EOyc,GAAY,IACPuhB,EAAU1+B,KAAV0+B,MACRx9B,OAAAm7B,GAAA,EAAAn7B,QAAA2Y,EAAA,EAAA3Y,CAAAuxB,EAAA6J,WAAA,OAAAt8B,MAAA8Z,KAAA9Z,KAAWmd,GACXnd,KAAKq4B,QAAU,EAAIqG,EAAQvhB,EAHZ,IAAAsa,GAAA,EAAAC,GAAA,EAAAC,OAAAt3B,EAAA,IAIf,QAAAm1B,EAAAqC,EAAqB73B,KAAKg+B,QAA1Br4B,OAAAC,cAAA6xB,GAAAjC,EAAAqC,EAAAhyB,QAAAC,MAAA2xB,GAAA,EAAmC,CAAAjC,EAAA90B,MAC1BkzB,KAAKzW,IALC,MAAAnX,GAAA0xB,GAAA,EAAAC,EAAA3xB,EAAA,YAAAyxB,GAAA,MAAAI,EAAA5xB,QAAA4xB,EAAA5xB,SAAA,WAAAyxB,EAAA,MAAAC,GAOf,IAAMnD,EAAgBx0B,KAAKwyB,MAAMgC,cAAcx0B,KAAK+yB,KAC9CwB,EAAYphB,MAAMwrB,KAAKnK,EAAc/X,UAO3C,GAJIzc,KAAK4+B,YACP5+B,KAAK6+B,aAAa7+B,MAGhBA,KAAK4+B,WAEP,QAAAl/B,EAAA,EAAAo/B,EAAmBvK,EAAnB70B,EAAAo/B,EAAAl/B,OAAAF,IAA8B,CAAzB,IAAMgS,EAAIotB,EAAAp/B,GAEb,GADAM,KAAK6+B,aAAantB,IACb1R,KAAK4+B,WACR,MAKN,GAAI5+B,KAAK4+B,WAAY,CACnB,IAAMG,EAAsBxK,EAAUjtB,OAAO,SAACpC,GAAD,OAAOkzB,GAAUlzB,KAC9DlF,KAAKg/B,mBAAmBD,EAAoBL,EAAOvhB,GAIrDnd,KAAKi/B,UAAUzK,EAAerX,GAE1Bnd,KAAKq+B,OAAS,IACZr+B,KAAK+yB,IAAIr0B,EAAIsB,KAAKwyB,MAAMhkB,OAAS,IAE/BxO,KAAKwyB,MAAMf,OAAOsB,IAAImM,OAAOl/B,KAAK+yB,OACpC/yB,KAAKwyB,MAAMf,OAAOsB,IAAIr0B,GAAK,GAE7BsB,KAAKwyB,MAAM2M,kBAAkBn/B,KAAK+yB,KAClC/yB,KAAK+yB,IAAIr0B,GAAK,EACdsB,KAAKq+B,QAAU,EACfr+B,KAAKwyB,MAAMiM,UAAUz+B,KAAK+yB,IAAK/yB,OAI/BA,KAAKq4B,QAAU,GACjBr4B,KAAK49B,QA3HX,CAAA91B,IAAA,eAAApH,MAAA,SA+HegR,GACX,GAAIsY,GAAatY,MAAWA,aAAgB2iB,IAAQ,CAClD,IAAM+K,EAAS3T,GAAOnB,cAAgBtqB,KAAKq4B,OAGrCgH,EAA0B74B,EAASxG,KAAKwyB,MAAMntB,OAAO3B,iBAAkB,EAAI+nB,GAAOnB,cAAe,EAAI,KACrGgV,EAAa99B,KAAKmS,IAAIyrB,EAASC,EAAyB3tB,EAAKwY,UAAUlB,OAE7E,GAAIoW,EAAS,KAAOE,EAAa,EAAG,CAClC5tB,EAAKwY,UAAU2K,IAAI,GAAIyK,GACvB,IAAMC,EAAYD,EAAaD,EAE/B,OADAr/B,KAAKq4B,QAAUkH,GACR,GAGX,OAAO,IA9IX,CAAAz3B,IAAA,qBAAApH,MAAA,SAoJqB6zB,EAAwBmK,EAAevhB,GAAY,IAAAqb,GAAA,EAAAC,GAAA,EAAAC,OAAAr4B,EAAA,IACpE,QAAAu3B,EAAAe,EAAuBpE,EAAvB5uB,OAAAC,cAAA4yB,GAAAZ,EAAAe,EAAA9yB,QAAAC,MAAA0yB,GAAA,EAAkC,KAAvB9D,EAAuBkD,EAAAl3B,MAChC,IAAIV,KAAK4+B,WAgBP,MAfA,IAAMY,EAAa9K,EAAS2D,OAASr4B,KAAKq4B,OAC1C,GAAImH,EAAa,GAAI,CAKnB,IAAMC,EAAO,KAAQf,EAAQvhB,EACvBuiB,EAAiBl+B,KAAKkmB,MAAM8X,EAAajY,GAAMkY,EAAM,EAAG,KAI9Dz/B,KAAKq4B,QAAUqH,EACfhL,EAAS2D,QAAUqH,IAf2C,MAAA15B,GAAAyyB,GAAA,EAAAC,EAAA1yB,EAAA,YAAAwyB,GAAA,MAAAG,EAAA1yB,QAAA0yB,EAAA1yB,SAAA,WAAAwyB,EAAA,MAAAC,MApJxE,CAAA5wB,IAAA,kBAAApH,MAAA,SA2KkByc,GACd,IAAMoX,EAAYv0B,KAAKwyB,MAAMgC,cAAcx0B,KAAK+yB,KAIhD,GAHA/yB,KAAKg4B,gBNriBF,SAAyB9yB,EAASqvB,EAA2BpX,GAClE,IAAMwgB,EAAcz4B,EAAE6yB,iBAClB4H,EAAqBhC,EAF6Dr4B,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAGtF,QAAAoF,EAAAC,EAAmB6uB,EAAU9X,SAA7B9W,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EACEq6B,GADqCl6B,EAAA/E,MACVq3B,iBAJyD,MAAA/xB,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAQtF,OAAOwhB,GAAK2W,EAFZgC,GAAuBpL,EAAUhyB,KAAO,EAEK,GAAM4a,GM6hB1B6a,CAAgBh4B,KAAMu0B,EAAWpX,GAGpDnd,KAAK+3B,kBAAoB,GAAI,CAC/B,IAAM6H,EAAiBp5B,EAASxG,KAAKwyB,MAAMntB,OAAOhB,aAAerE,KAAK29B,cAAgB1R,GAAYgO,KAAO,KAAQ,IAAO,EAAI,KAAO9c,EAC/H3b,KAAKkI,SAAWk2B,GAClB5/B,KAAK6/B,UAAU,IAAI3C,SAEhB,GAAIl9B,KAAK+3B,kBAAoB,GAAI,CACtC,IAAM+H,EAAoBt5B,EAASxG,KAAKwyB,MAAMntB,OAAOjB,aAAepE,KAAK29B,cAAgB1R,GAAYkO,IAAM,KAAQ,IAAO,EAAI,KAAOhd,EACjI3b,KAAKkI,SAAWo2B,GAAqB9V,GAAahqB,OACpDA,KAAKkqB,UAAU2K,IAAIrzB,KAAKgR,KAAK,EAAGxS,KAAKkqB,UAAUnB,OAAQ,MAxL/D,CAAAjhB,IAAA,YAAApH,MAAA,SA6LY8zB,EAAmCrX,GAC3C,IAAM4iB,EAAQvL,EAAc/S,IAAIwO,GAAW7sB,GACrC48B,EAAYxL,EAAc/S,IAAIwO,GAAWE,IACzC8P,EAAazL,EAAc/S,IAAIwO,GAAWK,IAE1CjiB,EAAOmmB,EAAc/S,IAAIwO,GAAWD,GACpCiM,EAAQzH,EAAc/S,IAAIwO,GAAWxiB,GAErCyyB,EAAQ1L,EAAc/S,IAAIwO,GAAWG,GACrC+P,EAAY3L,EAAc/S,IAAIwO,GAAWC,IACzCkQ,EAAa5L,EAAc/S,IAAIwO,GAAWI,IAE1CgQ,EAAc75B,EAASxG,KAAKwyB,MAAMntB,OAAOxB,oBAAqB4nB,GAAOP,MAAO,EAAI,KAAO/N,EAC7Fnd,KAAKq+B,QAAUgC,EACXrgC,KAAKq4B,OAAS5M,GAAOnB,cAAgB,IACvCtqB,KAAKq+B,QAAUgC,GAIjB,IADA,IAAIC,GAAkB,EACtBC,EAAA,EAAAC,EAAmB,CAACT,EAAOC,EAAWC,GAAtCM,EAAAC,EAAA5gC,OAAA2gC,IAAmD,CAA9C,IAAMtM,EAAIuM,EAAAD,GACb,GAAItM,aAAgBX,IAAQW,aAAgBV,GAE1C,YADAvzB,KAAKq+B,OAAS78B,KAAKmS,IAAI3T,KAAKq+B,OAAQ,IAE/B,GAAIpK,aAAgBxB,EAGzB,OAFAzyB,KAAKq+B,OAAS78B,KAAKmS,IAAI3T,KAAKq+B,OAAQpK,EAAKoK,aACzCiC,GAAkB,GAKtB,IAAMG,EAAsB,CAACN,EAAWD,EAAOE,EAAY/xB,EAAM4tB,EAAOj8B,MAAMsH,OAC5E,SAAC8oB,GAAD,OAAOA,aAAaqC,IAIjB6N,GAAkD,IAA/BG,EAAoB7gC,OAI1CI,KAAKq+B,OAASoC,EAAoBC,OAAO,SAAC9S,EAAKwC,GAAN,OAAYxC,EAAMwC,EAAEiO,QAAQ,GAAKoC,EAAoB7gC,OAH9FI,KAAKq+B,QAAU,MAjOrB5L,EAAA,CAA0BgH,IAAbhH,GACJhuB,YAAc,OADVguB,GAEJC,eAAiBjH,GAAOb,mBAFpB6H,GAGJE,eAAiBlH,GAAOZ,mBAHpB4H,GAIJG,aAAenH,GAAOd,mBAqOxB,IAAMgW,GAAb,SAAAC,GAIE,SAAAD,EAAY5N,EAAcP,EAAqBqO,GAAqB,IAAAC,EAAA,OAAA5/B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA2gC,IAClEG,EAAA5/B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAy/B,GAAA7mB,KAAA9Z,KAAM+yB,EAAKP,KADuDqO,gBAAAC,EAH7DpH,YAAa,EAGgDoH,EAF7DC,mBAE6D,EAAAD,EAD7DE,iBAC6D,EAElEF,EAAKC,cAAgBD,EAAKE,YAAeH,EAAclM,YAAoB/B,cAAgB,EAFzBkO,EAJtE,OAAA5/B,OAAAkb,EAAA,EAAAlb,CAAAy/B,EAAAC,GAAA1/B,OAAAmb,EAAA,EAAAnb,CAAAy/B,EAAA,EAAA74B,IAAA,OAAApH,MAAA,SAQOyc,GACHjc,OAAAm7B,GAAA,EAAAn7B,QAAA2Y,EAAA,EAAA3Y,CAAAy/B,EAAArE,WAAA,OAAAt8B,MAAA8Z,KAAA9Z,KAAWmd,GACXnd,KAAK+gC,eAAiB,EAAI/gC,KAAK0+B,MAAQvhB,EACnCnd,KAAK+gC,eAAiB,GACxB/gC,KAAKwyB,MAAMiM,UAAUz+B,KAAK6gC,cAAc9N,IAAK/yB,KAAK6gC,mBAZxDF,EAAA,CAAiClO,IAiBpBe,GAAb,SAAAyN,GAGE,SAAAzN,EAAYT,EAAcP,GAAc,IAAA0O,EAAA,OAAAhgC,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAwzB,IACtC0N,EAAAhgC,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAsyB,GAAA1Z,KAAA9Z,KAAM+yB,EAAKP,KAFNtI,eACiC,EAEtCgX,EAAKhX,UAAY,IAAItB,GACnBpnB,KAAKkmB,MAAMlhB,EAASgsB,EAAMntB,OAAO5B,cAAegoB,GAAOlB,wBAAyB,MADjErpB,OAAAw6B,GAAA,EAAAx6B,CAAAggC,IAFqBA,EAH1C,OAAAhgC,OAAAkb,EAAA,EAAAlb,CAAAsyB,EAAAyN,GAAAzN,EAAA,CAA4Bf,IAAfe,GACJ/uB,YAAc,SAmBhB,IAAM08B,GAAb,SAAAC,GAAA,SAAAD,IAAA,IAAAE,EAAAC,EAAApgC,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAmhC,GAAA,QAAAI,EAAA3sB,UAAAhV,OAAAkkB,EAAA,IAAA3Q,MAAAouB,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAA1d,EAAA0d,GAAA5sB,UAAA4sB,GAAA,OAAAF,EAAApgC,OAAA0Y,EAAA,EAAA1Y,CAAAlB,MAAAqhC,EAAAngC,OAAA2Y,EAAA,EAAA3Y,CAAAigC,IAAArnB,KAAA/E,MAAAssB,EAAA,CAAArhC,MAAA+M,OAAA+W,MAES4V,YAAa,EAFtB4H,EAGSG,kBAAoB,EAH7BH,EAISI,aAAe,EAJxBJ,EAKSK,eAAiB,EAL1BL,EAMSM,UAAuB,GANhCN,EAOSO,mBAAqB,EAP9BP,EAAA,OAAApgC,OAAAkb,EAAA,EAAAlb,CAAAigC,EAAAC,GAAAlgC,OAAAmb,EAAA,EAAAnb,CAAAigC,EAAA,EAAAr5B,IAAA,OAAApH,MAAA,SAScyc,GACVjc,OAAAm7B,GAAA,EAAAn7B,QAAA2Y,EAAA,EAAA3Y,CAAAigC,EAAA7E,WAAA,OAAAt8B,MAAA8Z,KAAA9Z,KAAWmd,GACX,IAAMoX,EAAYv0B,KAAKwyB,MAAMgC,cAAcx0B,KAAK+yB,KAChD/yB,KAAKyhC,kBAAoB,EACzBzhC,KAAK0hC,aAAe,EACpB1hC,KAAK2hC,eAAiB,EACtB,IAAIG,EAAS,EACb9hC,KAAK4hC,UAAY,GAPK,IAAA9I,GAAA,EAAAC,GAAA,EAAAC,OAAA34B,EAAA,IAStB,QAAAu4B,EAAAK,EAA0B1E,EAA1B5uB,OAAAC,cAAAkzB,GAAAF,EAAAK,EAAApzB,QAAAC,MAAAgzB,GAAA,EAAqC,KAAAiJ,EAAAnJ,EAAAl4B,MAAAshC,EAAA9gC,OAAAC,EAAA,EAAAD,CAAA6gC,EAAA,GAAzBrM,EAAyBsM,EAAA,GAApBtwB,EAAoBswB,EAAA,GAC7BC,EAAejiC,KAAKwyB,MAAM3X,OAAO7a,KAAK+yB,IAAIx0B,EAAIm3B,EAAIn3B,EAAGyB,KAAK+yB,IAAIr0B,EAAIg3B,EAAIh3B,GAC5E,GAAIgT,aAAgBuhB,IAAOgP,aAAwBzO,GAAQ,CACzDsO,GAAU,EACV9hC,KAAK4hC,UAAUpiC,KAAKk2B,GACpB,IAAMwM,EAAMxwB,EACNywB,EAASF,EAGTrhC,EAAQshC,EAAIjL,WAGZmL,EAAaF,EAAIG,MAEvBriC,KAAKyhC,mBAAqBW,EAC1BpiC,KAAK0hC,cAAgB9gC,EAErB,IAAM6pB,EAAmBjkB,EAASxG,KAAKwyB,MAAMntB,OAAO1B,eAAgB,IAAM,KAAO3D,KAAK0+B,MAQhF4D,EAAsB7W,GAAOf,qBAAuB0X,EACpDG,EAAiB/gC,KAAKmS,IAAIwuB,EAAOjY,UAAUnB,MAAOuZ,GAClDE,EAAU5hC,EAAQ6pB,EAAmB8X,EAAiBplB,EAAMmlB,EAClE,GAAI9gC,KAAKkI,SAAW84B,EAAQ,CAC1B,IAAMb,EAAiBY,EAAiBH,EACxCD,EAAOjY,UAAU2K,KAAK0N,EAAgBZ,GACtC3hC,KAAK2hC,gBAAkBA,EACvB3hC,KAAK6hC,oBAAsBF,KAzCX,MAAA37B,GAAA+yB,GAAA,EAAAC,EAAAhzB,EAAA,YAAA8yB,GAAA,MAAAG,EAAAhzB,QAAAgzB,EAAAhzB,SAAA,WAAA8yB,EAAA,MAAAC,GA6ClB8I,EAAS,IACX9hC,KAAKyhC,mBAAqBK,OAvDhCX,EAAA,CAA0B1O,IAAb0O,GACJ18B,YAAc,OA4DhB,IAAMg+B,GAAb,SAAAC,GAAA,SAAAD,IAAA,IAAAE,EAAAC,EAAA1hC,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAyiC,GAAA,QAAAI,EAAAjuB,UAAAhV,OAAAkkB,EAAA,IAAA3Q,MAAA0vB,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAAhf,EAAAgf,GAAAluB,UAAAkuB,GAAA,OAAAF,EAAA1hC,OAAA0Y,EAAA,EAAA1Y,CAAAlB,MAAA2iC,EAAAzhC,OAAA2Y,EAAA,EAAA3Y,CAAAuhC,IAAA3oB,KAAA/E,MAAA4tB,EAAA,CAAA3iC,MAAA+M,OAAA+W,MAES4V,YAAa,EAFtBkJ,EAGSG,gBAA6B,GAHtCH,EAIS1Y,UAAY,IAAItB,GAAU6C,GAAOlB,wBAArBrpB,OAAAw6B,GAAA,EAAAx6B,CAAA0hC,IAJrBA,EAKE3F,SAAW,EALb2F,EAMSI,YAAc,EANvBJ,EAAA,OAAA1hC,OAAAkb,EAAA,EAAAlb,CAAAuhC,EAAAC,GAAAxhC,OAAAmb,EAAA,EAAAnb,CAAAuhC,EAAA,EAAA36B,IAAA,OAAApH,MAAA,SAQcyc,GACVjc,OAAAm7B,GAAA,EAAAn7B,QAAA2Y,EAAA,EAAA3Y,CAAAuhC,EAAAnG,WAAA,OAAAt8B,MAAA8Z,KAAA9Z,KAAWmd,GACPnd,KAAKi9B,UAAY,IACnBj9B,KAAKijC,kBAAkB9lB,GACvBnd,KAAKi9B,UAAYz2B,EAASxG,KAAKwyB,MAAMntB,OAAOzB,eAAgB6nB,GAAOjB,qBAAsB,EAAI,MAE/FxqB,KAAKi9B,UAAY,EAAIj9B,KAAK0+B,MAAQvhB,IAdtC,CAAArV,IAAA,oBAAApH,MAAA,SAiB4Bm2B,GACxB72B,KAAK+iC,gBAAkB,GACvB,IAAMxO,EAAYv0B,KAAKwyB,MAAMgC,cAAcx0B,KAAK+yB,KAC5CmQ,GAAW,EAHsBC,GAAA,EAAAC,GAAA,EAAAC,OAAAhjC,EAAA,IAIrC,QAAA64B,EAAAoK,EAA0B/O,EAA1B5uB,OAAAC,cAAAu9B,GAAAjK,EAAAoK,EAAAz9B,QAAAC,MAAAq9B,GAAA,EAAqC,KAAAI,EAAArK,EAAAx4B,MAAA8iC,EAAAtiC,OAAAC,EAAA,EAAAD,CAAAqiC,EAAA,GAAzB7N,EAAyB8N,EAAA,GAApB9xB,EAAoB8xB,EAAA,GACnC,GACE9xB,aAAgB6hB,KAEhBvzB,KAAK+iC,gBAAgBvjC,KAAKk2B,IACrBwN,GAAU,KACLna,EAAUrX,EAAKwY,UAAU0K,KAAK50B,KAAKkqB,UAAW,EAAG,GAAjDnB,MACR/oB,KAAKgjC,aAAeja,EAChBA,EAAQ,IACVma,GAAW,KAbkB,MAAAl9B,GAAAo9B,GAAA,EAAAC,EAAAr9B,EAAA,YAAAm9B,GAAA,MAAAG,EAAAr9B,QAAAq9B,EAAAr9B,SAAA,WAAAm9B,EAAA,MAAAC,QAjBzCZ,EAAA,CAA0BhQ,IAAbgQ,GACJh+B,YAAc,OAqChB,IAAM4vB,GAAb,SAAAoP,GAaE,SAAApP,EAAYtB,EAAcP,GAAc,IAAAkR,EAAA,OAAAxiC,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAq0B,IACtCqP,EAAAxiC,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAmzB,GAAAva,KAAA9Z,KAAM+yB,EAAKP,KAZNkH,YAAa,EAWoBgK,EAVjCxZ,UAAY,IAAItB,GAAU,EAAd1nB,OAAAw6B,GAAA,EAAAx6B,CAAAwiC,IAUqBA,EATjCC,qBASiC,EAAAD,EARjCE,wBAQiC,EAAAF,EAPjCG,iBAOiC,EAAAH,EALjCI,mBAKiC,EAAAJ,EAQxCK,mBAAqB,WACK,MAApBL,EAAKG,aAAuBH,EAAKvL,aACnCuL,EAAKG,YAAcH,EAAKlR,MAAMrzB,KAC9BukC,EAAKE,mBAAmBha,IAAI,MAAO8Z,EAAKK,sBAT1CL,EAAKC,gBAA6F,EAA3EniC,KAAKwR,KAAKxM,EAASgsB,EAAMntB,OAAOb,qBAAsB,IAAK,EAAI,KAAO,GAC7Fk/B,EAAKE,mBAAqB,IAAIhb,GAAU8a,EAAKC,gBAAnBziC,OAAAw6B,GAAA,EAAAx6B,CAAAwiC,IAC1BA,EAAKE,mBAAmBja,GAAG,MAAO+Z,EAAKK,oBACvCL,EAAKI,cAAgBtiC,KAAKwR,KAAKxM,EAASgsB,EAAMntB,OAAOf,iBAAkB+sB,GAAkB,EAAI,EAAG,EAAI,MAL9DqS,EAb1C,OAAAxiC,OAAAkb,EAAA,EAAAlb,CAAAmzB,EAAAoP,GAAAviC,OAAAmb,EAAA,EAAAnb,CAAAmzB,EAAA,EAAAvsB,IAAA,mBAAA2Z,IAAA,WAUI,OAAOzhB,KAAK2jC,gBAAkB3jC,KAAK8jC,kBAVvC5iC,OAAAmb,EAAA,EAAAnb,CAAAmzB,EAAA,EAAAvsB,IAAA,OAAApH,MAAA,SA6BOyc,GACHjc,OAAAm7B,GAAA,EAAAn7B,QAAA2Y,EAAA,EAAA3Y,CAAAmzB,EAAAiI,WAAA,OAAAt8B,MAAA8Z,KAAA9Z,KAAWmd,GAGX,IAAM6mB,EAAoB,EAAI7mB,EAAKnd,KAAK0+B,MAClCnK,EAAYv0B,KAAKwyB,MAAMgC,cAAcx0B,KAAK+yB,KALjCkR,GAAA,EAAAC,GAAA,EAAAC,OAAA9jC,EAAA,IAMf,QAAA+jC,EAAAC,EAA2B9P,EAA3B5uB,OAAAC,cAAAq+B,GAAAG,EAAAC,EAAAx+B,QAAAC,MAAAm+B,GAAA,EAAsC,KAAAK,EAAAF,EAAA1jC,MAAxBg0B,EAAwBxzB,OAAAC,EAAA,EAAAD,CAAAojC,EAAA,MACpC,GAAIta,GAAa0K,IAAaA,aAAoBjC,MAAUiC,aAAoBL,GAAQ,CACtF,IAAMkQ,EAAc/iC,KAAKmS,IAAI3T,KAAK2jC,gBAAkB,EAAI3jC,KAAK4jC,mBAAmB7a,MAAOib,GACjFQ,EAAchjC,KAAKmS,IAAI3T,KAAK2jC,gBAAkB,EAAI3jC,KAAK4jC,mBAAmB5a,MAAOgb,GAEvFtP,EAASxK,UAAU0K,KAAK50B,KAAKkqB,UAAWqa,EAAaC,KAX1C,MAAAx+B,GAAAk+B,GAAA,EAAAC,EAAAn+B,EAAA,YAAAi+B,GAAA,MAAAI,EAAAp+B,QAAAo+B,EAAAp+B,SAAA,WAAAi+B,EAAA,MAAAC,GAcfnkC,KAAKykC,gBAAgBtnB,KA3CzB,CAAArV,IAAA,kBAAApH,MAAA,SA8CkByc,GACd,IAAMonB,EAAc/iC,KAAKmS,IAAI3T,KAAK2jC,gBAAkB,EAAI3jC,KAAK4jC,mBAAmB7a,MAAO/oB,KAAK0kC,iBAAmB,EAAIvnB,EAAKnd,KAAK0+B,OACvH8F,EAAchjC,KAAKmS,IAAI3T,KAAK2jC,gBAAkB,EAAI3jC,KAAK4jC,mBAAmB5a,MAAOhpB,KAAK0kC,iBAAmB,EAAIvnB,EAAKnd,KAAK0+B,OAC7H1+B,KAAKkqB,UAAU0K,KAAK50B,KAAK4jC,mBAAoBW,EAAaC,KAjD9D,CAAA18B,IAAA,oBAAApH,MAAA,WAqDI,IAAM+I,EAAIzJ,KAAK4jC,mBACf,OAAQn6B,EAAEuf,MAAQvf,EAAEsf,OAAStf,EAAEof,WAtDnC,CAAA/gB,IAAA,WAAApH,MAAA,WA2DI,OAAOV,KAAK4jC,mBAAmB7a,MAAQ/oB,KAAK4jC,mBAAmB5a,OAAShpB,KAAK2jC,gBAAkB,MA3DnGtP,EAAA,CAA2B5B,IA+D3B,SAASkS,GAAapmC,GACpB,OAAOA,EAAI,IAAM,EAhEN81B,GACJ5vB,YAAc,QADV4vB,GAOJzB,aAAe,EA4DjB,IAAMgS,GAAb,SAAAC,GAKE,SAAAD,EAAY7R,EAAcP,EAAqBkD,GAAc,IAAAoP,EAE3D,GAF2D5jC,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA4kC,IAC3DE,EAAA5jC,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA0jC,GAAA9qB,KAAA9Z,KAAM+yB,EAAKP,KADgDkD,MAAAoP,EAHtDC,cAAgB,EAGsCD,EAFtDE,cAAgB,EAIjBL,GAAajP,EAAIn3B,IAAMomC,GAAajP,EAAIh3B,GAC1C,MAAM,IAAI6gB,MAAM,uCAAyCmW,EAAIn3B,EAAI,KAAOm3B,EAAIh3B,GAHnB,OAAAomC,EAL/D,OAAA5jC,OAAAkb,EAAA,EAAAlb,CAAA0jC,EAAAC,GAAA3jC,OAAAmb,EAAA,EAAAnb,CAAA0jC,EAAA,EAAA98B,IAAA,OAAApH,MAAA,SAYOyc,GACHjc,OAAAm7B,GAAA,EAAAn7B,QAAA2Y,EAAA,EAAA3Y,CAAA0jC,EAAAtI,WAAA,OAAAt8B,MAAA8Z,KAAA9Z,KAAWmd,GAEXnd,KAAKq4B,QAAU,EAAIr4B,KAAK0+B,MAAQvhB,EAChC,IAAI8nB,EAAmB,EACnBC,EAAmB,EACvB,GAAIllC,KAAK+kC,eAAiB,EAAG,CAC3BE,IACA,IAAMjI,EAAgBx7B,KAAKkmB,MAAMlhB,EAASxG,KAAKwyB,MAAMntB,OAAOtB,qBAAsB,GAAI,EAAI,MAC1F/D,KAAK+kC,eAAiB/H,EAExB,GAAIh9B,KAAKglC,eAAiB,EAAG,CAC3BE,IACA,IAAMC,EAAgB3jC,KAAKkmB,MAAMlhB,EAASxG,KAAKwyB,MAAMntB,OAAOvB,qBAAsB,GAAI,EAAI,MAC1F9D,KAAKglC,eAAiBG,EAGxB,GAAIF,EAAmB,GAAKC,EAAmB,EAAG,CAChD,IAAME,EAAaplC,KAAKqlC,YACpBD,GACFplC,KAAKkqB,UAAU0K,KAAKwQ,EAAWlb,UAAW+a,EAAkBC,GAG9D,IAAMI,EAAWtlC,KAAKulC,UAClBD,GACFA,EAASpb,UAAU0K,KAAK50B,KAAKkqB,UAAW+a,EAAkBC,GAG9DllC,KAAK+kC,eAAiB,EAAI5nB,EAAKnd,KAAK0+B,MACpC1+B,KAAKglC,eAAiB,EAAI7nB,EAAKnd,KAAK0+B,QAzCxC,CAAA52B,IAAA,YAAApH,MAAA,WA6CI,IAAM0kC,EAAaplC,KAAKwyB,MAAM3X,OAAO7a,KAAK+yB,IAAIx0B,EAAIyB,KAAK01B,IAAIn3B,EAAGyB,KAAK+yB,IAAIr0B,EAAIsB,KAAK01B,IAAIh3B,GACpF,GAAI0mC,aAAsB3S,IAAQzI,GAAaob,GAC7C,OAAOA,IA/Cb,CAAAt9B,IAAA,UAAApH,MAAA,WAoDI,IAAM4kC,EAAWtlC,KAAKwyB,MAAM3X,OAAO7a,KAAK+yB,IAAIx0B,EAAIyB,KAAK01B,IAAIn3B,EAAGyB,KAAK+yB,IAAIr0B,EAAIsB,KAAK01B,IAAIh3B,GAClF,GAAI4mC,aAAoB7S,IAAQzI,GAAasb,GAC3C,OAAOA,MAtDbV,EAAA,CAA+BpR,IAAlBoR,GACJngC,YAAc,YA0DhB,IAAM+gC,GAAb,SAAAC,GAAA,SAAAD,IAAA,IAAAE,EAAAC,EAAAzkC,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAwlC,GAAA,QAAAI,EAAAhxB,UAAAhV,OAAAkkB,EAAA,IAAA3Q,MAAAyyB,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAA/hB,EAAA+hB,GAAAjxB,UAAAixB,GAAA,OAAAF,EAAAzkC,OAAA0Y,EAAA,EAAA1Y,CAAAlB,MAAA0lC,EAAAxkC,OAAA2Y,EAAA,EAAA3Y,CAAAskC,IAAA1rB,KAAA/E,MAAA2wB,EAAA,CAAA1lC,MAAA+M,OAAA+W,MASSoG,UAAY,IAAItB,GAAU,EAAd1nB,OAAAw6B,GAAA,EAAAx6B,CAAAykC,IATrBA,EAAA,OAAAzkC,OAAAkb,EAAA,EAAAlb,CAAAskC,EAAAC,GAAAvkC,OAAAmb,EAAA,EAAAnb,CAAAskC,EAAA,OAAA19B,IAAA,iBAAA2Z,IAAA,WAII,OAAOgK,GAAOT,gBAJlB,CAAAljB,IAAA,iBAAA2Z,IAAA,WAOI,OAAOgK,GAAOT,kBAPlBwa,EAAA,CAA0BhS,IAAbgS,GACJ/gC,YAAc,OCr3BhB,IAAMouB,GAAb,WAyBE,SAAAA,EAA0BO,EAA0BZ,GAAetxB,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA6yB,GAAA7yB,KAAAozB,WAAApzB,KAAAwyB,QAAAxyB,KAxB5DkqB,UAAY,IAAItB,GACrB6C,GAAOD,aACPxrB,KACAwB,KAAK0P,MAAMua,GAAOD,aAAe,GACjChqB,KAAK0P,MAAMua,GAAOD,aAAe,IAoB+BxrB,KAlB1D8lC,YAkB0D,EAAA9lC,KAjB1DshB,OAAS,IAAIoI,gBAiB6C1pB,KAhB3D+lC,gBAgB2D,EAAA/lC,KAZ3DgmC,eAY2D,EAAAhmC,KAX3Dg2B,mBAAqB,EAY1Bh2B,KAAKgmC,UAAYx/B,EAASgsB,EAAMntB,OAAOrB,UAAW,IAAM,KA1B5D,OAAA9C,OAAAmb,EAAA,EAAAnb,CAAA2xB,EAAA,EAAA/qB,IAAA,QAAA2Z,IAAA,WAiBI,IAAMvc,EAAIlF,KAAKimC,cACf,OAAOjmC,KAAKgmC,WAAa9gC,aAAautB,GAAOvtB,EAAEw5B,MAAQ,KAlB3D,CAAA52B,IAAA,MAAA2Z,IAAA,WAsBI,OAAOzhB,KAAKozB,SAAS0G,QAAQ5oB,YAtBjChQ,OAAAmb,EAAA,EAAAnb,CAAA2xB,EAAA,EAAA/qB,IAAA,aAAApH,MAAA,WA8BI,OAAO,IA9BX,CAAAoH,IAAA,YAAApH,MAAA,SAiCmBolC,GACI,MAAf9lC,KAAK8lC,OACP9lC,KAAK8lC,OAAS,CACZh7B,KAAM,WACNo7B,QAAS,CAAClmC,KAAK8lC,OAAQA,IAGzB9lC,KAAK8lC,OAASA,IAxCpB,CAAAh+B,IAAA,YAAApH,MAAA,WA6CI,OAAOV,KAAK8lC,SA7ChB,CAAAh+B,IAAA,SAAApH,MAAA,WAiDI,IAAMgR,EAAO1R,KAAKwyB,MAAM3X,OAAO7a,KAAK+yB,IAAIx0B,EAAGyB,KAAK+yB,IAAIr0B,GACpD,OAAIgT,aAAgB+gB,GACX/gB,EAAK2sB,OAEL,IArDb,CAAAv2B,IAAA,gBAAApH,MAAA,WA0DI,IAAM29B,EAASr+B,KAAKq+B,SACpB,GAAe,IAAXA,EAAc,CAChB,IAAMn5B,EAAIlF,KAAKozB,SAAS0G,QAExB,OADA50B,EAAExG,GAAK2/B,EACAn5B,EAET,OAAOlF,KAAKozB,WAhEhB,CAAAtrB,IAAA,cAAApH,MAAA,WAoEI,OAAOV,KAAKwyB,MAAM3X,OAAO7a,KAAK+yB,OApElC,CAAAjrB,IAAA,KAAApH,MAAA,SAuEY4P,EAAe61B,GACvBnmC,KAAKshB,OAAOqI,GAAGrZ,EAAO61B,KAxE1B,CAAAr+B,IAAA,OAAApH,MAAA,SA2Ecyc,GAIV,QAHoB9c,IAAhBL,KAAK8lC,SACP9lC,KAAK8lC,OAAS,CAAEh7B,KAAM,SAEpB9K,KAAK+lC,WAAY,CACnB,IAAMK,EAAepmC,KAAK+lC,WAAW/lC,KAAMA,KAAK8lC,QAE9C9lC,KAAK8lC,OADa,MAAhBM,EACYA,EAEA,CAAEt7B,KAAM,QAG1B,IAAMu7B,EAAmBrmC,KAAKsmC,cAActmC,KAAK8lC,OAAQ3oB,GACzDnd,KAAKumC,wBAAwBppB,GAOzBkpB,GACFrmC,KAAKshB,OAAOmI,KAAK,SAAUzpB,KAAK8lC,QAElC9lC,KAAK8lC,YAASzlC,IAlGlB,CAAAyH,IAAA,0BAAApH,MAAA,SAqGkCyc,GAC9B,IAAMzL,EAAO1R,KAAKimC,cACdv0B,aAAgBkzB,IAClB5kC,KAAKozB,SAASyB,IAAInjB,EAAKgkB,IAAIoE,QAAQhe,UAAuB,IAAb9b,KAAKY,MAAeuc,MAxGvE,CAAArV,IAAA,gBAAApH,MAAA,SA4GuBolC,EAAgB3oB,GACnC,OAAQ2oB,EAAOh7B,MACb,IAAK,OAEH,OAAO,EACT,IAAK,QACH,OAAO9K,KAAKwmC,aAAarpB,GAC3B,IAAK,OACH,OAAOnd,KAAKymC,YAAYX,EAAQ3oB,GAClC,IAAK,QACH,OAAOnd,KAAK0mC,aAAaZ,EAAQ3oB,GACnC,IAAK,cACH,OAAOnd,KAAK2mC,mBAAmBb,EAAQ3oB,GACzC,IAAK,OACH,OAAOnd,KAAK4mC,YAAYd,EAAQ3oB,GAClC,IAAK,SACH,OAAOnd,KAAK6mC,cAAcf,EAAQ3oB,GACpC,IAAK,WACH,OAAOnd,KAAK8mC,gBAAgBhB,EAAQ3oB,GACtC,IAAK,WACH,OAAOnd,KAAK+mC,gBAAgBjB,EAAQ3oB,MAhI5C,CAAArV,IAAA,aAAApH,MAAA,SAmIoBolC,EAAoB3oB,GACpC,IAAMzP,EAAS1N,KAAKozB,SACjB0G,QACAjF,IAAIiR,EAAOpQ,IAAIoE,QAAQhe,UAAU9b,KAAKY,MAAQuc,IAC9CjM,QACH,OAAOlR,KAAKgnC,WAAWt5B,KAxI3B,CAAA5F,IAAA,aAAApH,MAAA,SA2IoBqyB,GAIhB,GAHIA,aAAe0G,KACjB1G,EAAMA,EAAIA,MAEP/yB,KAAKwyB,MAAMwB,gBAAgBjB,EAAIx0B,EAAGw0B,EAAIr0B,GACzC,OAAO,EAET,IAAMgT,EAAO1R,KAAKwyB,MAAM3X,OAAOkY,EAAIx0B,EAAGw0B,EAAIr0B,GAC1C,OAAMgT,aAAgB+gB,IAAiB,MAAR/gB,IAAgBA,EAAKgoB,eAIhDhoB,aAAgB+gB,KAC4B,MAAvC/gB,EAAK6sB,iBAAiBrB,OAxJnC,CAAAp1B,IAAA,mBAAApH,MAAA,SA6J0BgR,GACtB,OAAY,MAARA,IAAiBA,EAAKgoB,eACpBhoB,aAAgB+gB,KAC4B,MAAvC/gB,EAAK6sB,iBAAiBrB,OAhKrC,CAAAp1B,IAAA,cAAApH,MAAA,SAwKqBolC,EAAoB3oB,GACrC,QAAInd,KAAKinC,WAAWnB,EAAQ3oB,KAU1B4K,GAAUnD,KAAKA,KAAKsiB,sBAAsB,GAC1Cnf,GAAUnD,KAAKA,KAAKlkB,MAAQ,GAC5BqnB,GAAUnD,KAAKA,KAAKuiB,wBAAwB,EAAGpf,GAAUnD,KAAKtI,QAAQ8qB,YAAc,KAEpFpnC,KAAKozB,SAASyB,IAAIiR,EAAOpQ,IAAIoE,QAAQhe,UAAU9b,KAAKY,MAAQuc,KAGrD,KA1Lb,CAAArV,IAAA,eAAApH,MAAA,SA+LsBm2B,GAElB,OAAO,IAjMX,CAAA/uB,IAAA,yBAAApH,MAAA,SA2MgDoI,EAAmBu+B,EAA0BvjB,GACzFhb,EAAWA,EAASgxB,QACpB,IAAMsL,EAAaplC,KAAKwyB,MAAM3X,OAAO/R,EAASvK,EAAGuK,EAASpK,GAC1D,GAAkB,MAAd0mC,KAKAA,aAAsB/Q,IAA1B,CAOA,KADE+Q,aAAsBiC,KAAeA,IAAqBzC,IAAaQ,aAAsBR,OAG5FQ,EAAW1L,YACZ15B,KAAKkqB,UAAUnB,OAPC,GAQhB/oB,KAAKkqB,UAAUlB,OAPC,EAQhB,CACAhpB,KAAKkqB,UAAU2K,KAVC,GACA,GAUhB,IAAMyS,EAAOpmC,OAAAokB,GAAA,EAAApkB,CAAOmmC,EAAP,CAAgBv+B,EAAU9I,KAAKwyB,OAA/BzlB,OAAA7L,OAAAmJ,EAAA,EAAAnJ,CAAyC4iB,KAMtD,OALAwjB,EAAQxjB,KAAOA,EACfkE,GAAMM,MAAM8e,YAAc,EAC1Bpf,GAAMpD,KAAKA,KAAKsiB,sBAAsB,GACtClf,GAAMpD,KAAKA,KAAKlkB,MAAQ,GACxBsnB,GAAMpD,KAAKA,KAAK2iB,6BAA6B,KAAQvf,GAAMpD,KAAKtI,QAAQ8qB,YAAc,IAC/EE,MAvOb,CAAAx/B,IAAA,SAAApH,MAAA,SA6OiB8mC,EAAYC,GAAY,IAAAroC,EAAAY,KACrC,cAAWwnC,WAAiBC,IAGf,MAATD,GAA0B,MAATC,IAGjBD,aAAiBv1B,YAAWw1B,aAAiBx1B,WACxCu1B,EAAMtI,OAAOuI,GAElBD,aAAiBr0B,OAASs0B,aAAiBt0B,MAC/Bq0B,EAAME,MAAM,SAACh7B,EAAGqxB,GAAJ,OAAc3+B,EAAKuoC,OAAOH,EAAMzJ,GAAQ0J,EAAM1J,WAD1E,MAvPJ,CAAAj2B,IAAA,oBAAApH,MAAA,SA6P4BolC,EAAqB8B,GAC7C,OAAIA,EAAajT,cAAgBmR,EAAOuB,WAInCrnC,KAAK2nC,OAAO7B,EAAOhiB,KAAM8jB,EAAa9jB,QAlQ/C,CAAAhc,IAAA,eAAApH,MAAA,SAyQsBolC,EAAqB3oB,GACvC,IAAMyqB,EAAe5nC,KAAKwyB,MAAM0C,OAAO4Q,EAAOh9B,SAASvK,EAAGunC,EAAOh9B,SAASpK,GAC1E,GAAoB,MAAhBkpC,IAAyB5nC,KAAK6nC,kBAAkB/B,EAAQ8B,GAE1D,OAAO,EAELA,GACF5nC,KAAK2mC,mBAAmB,CACtB77B,KAAM,cACNhC,SAAUg9B,EAAOh9B,SACjBg/B,OAAO,GACN3qB,GAEL,IAEM8W,EAFA8T,EAAa/nC,KAAKgoC,uBAAuBlC,EAAOh9B,SAAUg9B,EAAOuB,SAAUvB,EAAOhiB,MACxF,OAAkB,MAAdikB,KAGA9T,EADE6R,EAAOuB,SAASzU,aACX,IAAI+N,GAAYmF,EAAOh9B,SAAU9I,KAAKwyB,MAAOuV,GAE7CA,GAEJ1J,OAASr+B,KAAKq+B,SACnBr+B,KAAKwyB,MAAMiM,UAAUqH,EAAOh9B,SAAUmrB,IAC/B,KAhSb,CAAAnsB,IAAA,qBAAApH,MAAA,SAsS4BolC,EAA2BjP,GACnD,IAAKiP,EAAOh9B,SAASo2B,OAAOl/B,KAAK+yB,MAAQ+S,EAAOgC,MAAO,CACrD,IAAM7T,EAAOj0B,KAAKwyB,MAAM2M,kBAAkB2G,EAAOh9B,UACjD,GAAY,MAARmrB,EAAc,CAEhB,IAAMgU,EAAShU,EAAKoE,OAAS5M,GAAOnB,cAKpC,OAJAtqB,KAAKkqB,UAAU2K,IAAIoT,EAAQA,GACvBje,GAAaiK,IACfA,EAAK/J,UAAU0K,KAAK50B,KAAKkqB,UAAW+J,EAAK/J,UAAUnB,MAAOkL,EAAK/J,UAAUlB,QAEpE,GAGX,OAAO,IAnTX,CAAAlhB,IAAA,cAAApH,MAAA,SAsTqBolC,EAAoB3oB,GAErC,IAAM8oB,EAAcjmC,KAAKimC,cACzB,GAAIjc,GAAaic,GAAc,KAEvBld,EADyC+c,EAAvC/c,MACkB5L,EACpB6L,EAFyC8c,EAArB9c,MAEA7L,EAM1B,OAJA8oB,EAAY/b,UAAU0K,KAAK50B,KAAKkqB,UAAWlB,EAAOD,GAGlD/oB,KAAKkqB,UAAU0K,KAAKqR,EAAY/b,UAAWnB,EAAOC,IAC3C,EAEP,OAAO,IApUb,CAAAlhB,IAAA,gBAAApH,MAAA,SAwUuBolC,EAAsB3oB,GACzC,IAAM8W,EAAOj0B,KAAKimC,cACdjc,GAAaiK,IACHA,EAAK/J,UACb0K,KAAK50B,KAAKkqB,UAAW4b,EAAO/c,MAAQ5L,EAAI2oB,EAAO9c,MAAQ7L,GAE7D,OAAO,IA9UX,CAAArV,IAAA,kBAAApH,MAAA,SAiVyBwnC,EAA0B/qB,GAC/C,IAAIgrB,GAAa,EAD0C7iC,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAE3D,QAAAoF,EAAAC,EAAqBwiC,EAAShC,QAA9BvgC,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAuC,KAA5BwgC,EAA4BrgC,EAAA/E,MACrCynC,EAAanoC,KAAKsmC,cAAcR,EAAQ3oB,IAAOgrB,GAHU,MAAAniC,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAK3D,OAAO2iC,IAtVX,CAAArgC,IAAA,kBAAApH,MAAA,SAyVyBolC,EAAwB3oB,GAE7C,OADA2oB,EAAOsC,aAAaxX,SAASzT,IACtB,MA3VX0V,EAAA,GCZe,SAASwV,GAAQtoC,GAC9B,IAAIuoC,EACJ,OAAO,WAIL,YAHcjoC,IAAVioC,IACFA,EAAQvoC,KAEHuoC,+CCALC,GAAa,GACRC,IAAoB,EACzBC,GAAcJ,GAAK,kBACvB,IAAI1mB,kBAAsB+mB,KAAKC,KAA+B,WAC5DF,KAAcG,cAAc,CAAE99B,KAAM,WACpC09B,IAAoB,MAIXK,IAAe,IAAIlnB,kBAAsB+mB,KAAKI,MAErDR,GAA0C,GAEzC,SAASS,GAAuBxqC,EAAWG,GAAsC,IAA3BsqC,EAA2Bp0B,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAT,QAC7ErW,EAAIiD,KAAKkmB,MAAMnpB,GACfG,EAAI8C,KAAKkmB,MAAMhpB,GACf,IAAMoJ,EAAG,GAAAiF,OAAMxO,EAAN,KAAAwO,OAAWrO,GACpB,GAAkB,MAAd4pC,GAAMxgC,GAAc,KASbmhC,EAAT,WACE,IAAMC,EAAQT,KAAcS,MACtB5sB,EAAUlM,EAAOmM,WAAW,MAClCD,EAAQ/E,UAAYyxB,EACpB1sB,EAAQ6sB,SAAS,EAAG,EAAGZ,GAAY,IAGnCjsB,EAAQtD,UACNkwB,EAEAX,GAAahqC,EACbgqC,GAAa7pC,EACb6pC,GACAA,GAEA,EACA,EACAA,GACAA,IAEFa,EAAQC,aAAc,GA5BlBj5B,EAASuM,SAAS/a,cAAc,UACtCwO,EAAOhI,MAAQmgC,GACfn4B,EAAO5B,OAAS+5B,GAChB,IAAMa,EAAU,IAAIznB,WAAcvR,GAClCg5B,EAAQE,UAAY3nB,iBACpBynB,EAAQG,OAAQ,EAChBH,EAAQI,MAAQ7nB,kBAChBynB,EAAQK,MAAQ9nB,kBAwBZ6mB,GACFS,IAEAR,KAAc7rB,iBAAiB,SAAU,WACvCqsB,MAGJX,GAAMxgC,GAAOshC,EAEf,OAAOd,GAAMxgC,GC9DR,IAAe4hC,GACpB,SAAAA,EAAmBh8B,EAAkBi8B,EAAqB/hB,GAAa1mB,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA0pC,GAAA1pC,KAAA0N,SAAA1N,KAAA2pC,QAAA3pC,KAAA4nB,QCD5DgiB,GAAb,SAAAC,GAYE,SAAAD,EAAYne,GAAwB,IAAArsB,EAAA,OAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA4pC,IAClCxqC,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA0oC,GAAA9vB,KAAA9Z,QAXK8pC,cAU6B,EAAA1qC,EAT7B2qC,cAS6B,EAAA3qC,EAM5B2+B,MAAQ,EAJd3+B,EAAK0qC,SAAWF,EAAkBI,cAClC5qC,EAAK2qC,SAAW,IAAIE,GAAyBxe,GAC7CrsB,EAAK8qC,eAAgB,EAJa9qC,EAZtC,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAA0oC,EAAAC,GAAA3oC,OAAAmb,EAAA,EAAAnb,CAAA0oC,EAAA,OAAA9hC,IAAA,cAAApH,MAAA,WAKI,IAAMopC,EAAW,IAAIK,kBACfpyB,EAAY,IAAIqyB,aAA6C,EAAhCR,EAAkBS,aAC/CC,EAAQ,IAAIF,aAAaR,EAAkBS,aAGjD,OAFAP,EAASS,aAAa,WAAY,IAAIC,mBAAgBzyB,EAAW,GAAG0yB,YAAW,IAC/EX,EAASS,aAAa,OAAQ,IAAIC,mBAAgBF,EAAO,GAAGG,YAAW,IAChEX,MAVX5oC,OAAAmb,EAAA,EAAAnb,CAAA0oC,EAAA,EAAA9hC,IAAA,aAAApH,MAAA,WAoBIV,KAAK+9B,MAAQ,IApBjB,CAAAj2B,IAAA,SAAApH,MAAA,SAsBSnC,EAAWG,EAAWwP,EAAW3L,GACtCvC,KAAK8pC,SAASY,WAAW5hC,SAAS6hC,OAAO3qC,KAAK+9B,MAAOx/B,EAAGG,EAAGwP,GAC3DlO,KAAK8pC,SAASY,WAAWnoC,KAAKqoC,KAAK5qC,KAAK+9B,MAAOx7B,GAC/CvC,KAAK+9B,UAzBT,CAAAj2B,IAAA,WAAApH,MAAA,WA4BsBV,KAAK8pC,SAASY,WAAW5hC,SACjCugC,aAAc,EACVrpC,KAAK8pC,SAASY,WAAWnoC,KACjC8mC,aAAc,EACpBrpC,KAAK8pC,SAASe,aAAa,EAAG7qC,KAAK+9B,WAhCvC6L,EAAA,CAAuCkB,WAA1BlB,GACJS,YAAc,QA0CjBJ,eAGJ,SAAAA,EAAmBxe,GAAwB,IAAAxO,EAAA,OAAA/b,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAiqC,IACzChtB,EAAA/b,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA+oC,GAAAnwB,KAAA9Z,KAAM,CACJ+qC,SAAU,CACRC,QAAS,CAAEtqC,MAAO+qB,EAAOuf,SACzBC,WAAY,CAAEvqC,MAAO+qB,EAAOlpB,MAC5BH,MAAO,CAAE1B,MAAO+qB,EAAOrpB,OAEvBuF,IAAK,CAAEjH,MAAO+qB,EAAO9jB,MAEvBujC,gBACAC,kBACAC,WAAW,EACXC,aAAa,MAZ0B5f,SAAAxO,EAFpCtV,SAEoC,EAgBzCsV,EAAKtV,IAAM8jB,EAAO9jB,IAhBuBsV,6BAHNquB,mBAuBjCJ,GAAY,6PAWZC,GAAc,kXCnEPI,GAAb,SAAAC,GAyEE,SAAAD,EAAY79B,EAAmBi8B,EAAc/hB,GAAY,IAAAxoB,EAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAurC,IACvDnsC,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAqqC,GAAAzxB,KAAA9Z,KAAM0N,EAAQi8B,EAAO/hB,KALhB6jB,gBAAkB,EAIgCrsC,EAFlDssC,OAAoB,GAE8BtsC,EADlDusC,OAAoB,GAC8BvsC,EAejD2kC,mBAAqB,SAAC/I,GAE5B,IADA,IAAI4Q,EAAepqC,KAAKwR,KAAK5T,EAAKsO,OAAOqb,OAClC3pB,EAAKssC,OAAO9rC,OAASgsC,GAAc,CACxC,IAAMxqC,EAAI45B,EAAMlS,QAAQiK,IAAI+G,QAAQ+R,IAAIzsC,EAAKsO,OAAOob,QAAQiK,KAC5D3xB,EAAE7C,GAA6B,IAAvBiD,KAAKkI,SAAW,IACxBtI,EAAE1C,GAA6B,IAAvB8C,KAAKkI,SAAW,IACxBtK,EAAKssC,OAAOlsC,KAAK4B,GAInB,IADAwqC,EAAepqC,KAAKwR,KAAK5T,EAAKsO,OAAOsb,OAC9B5pB,EAAKusC,OAAO/rC,OAASgsC,GAAc,CACxC,IAAMxqC,EAAI45B,EAAMlS,QAAQiK,IAAI+G,QAAQ+R,IAAIzsC,EAAKsO,OAAOob,QAAQiK,KAC5D3xB,EAAE7C,GAA6B,IAAvBiD,KAAKkI,SAAW,IACxBtI,EAAE1C,GAA6B,IAAvB8C,KAAKkI,SAAW,IACxBtK,EAAKusC,OAAOnsC,KAAK4B,KA7BoChC,EAiCjD0sC,oBAAsB,WAC5B,IAAIF,EAAepqC,KAAKwR,KAAK5T,EAAKsO,OAAOqb,OACrC3pB,EAAKssC,OAAO9rC,OAASgsC,GACvBxsC,EAAKssC,OAAOzN,OAAO2N,EAAcxsC,EAAKssC,OAAO9rC,OAASgsC,GAGxDA,EAAepqC,KAAKwR,KAAK5T,EAAKsO,OAAOsb,OACjC5pB,EAAKusC,OAAO/rC,OAASgsC,GACvBxsC,EAAKusC,OAAO1N,OAAO2N,EAAcxsC,EAAKusC,OAAO/rC,OAASgsC,IAvCxDl+B,EAAOic,GAAG,MAAOvqB,EAAK2kC,oBACtBr2B,EAAOic,GAAG,OAAQvqB,EAAK0sC,qBAKvB,IAAK,IAAIjnC,EAAI,EAAGA,EAAIzF,EAAKsO,OAAOqb,MAAOlkB,IACrCzF,EAAKssC,OAAOlsC,KAAKusC,MAEnB,IAAK,IAAIlnC,EAAI,EAAGA,EAAIzF,EAAKsO,OAAOsb,MAAOnkB,IACrCzF,EAAKusC,OAAOnsC,KAAKusC,MAZoC,OAAA3sC,EAzE3D,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAAqqC,EAAAC,GAAAtqC,OAAAmb,EAAA,EAAAnb,CAAAqqC,EAAA,OAAAzjC,IAAA,aAAApH,MAAA,WA2CI6qC,EAAkBS,iBAAiBC,aACnCV,EAAkBW,iBAAiBD,eA5CvC,CAAAnkC,IAAA,WAAApH,MAAA,WAgDI6qC,EAAkBS,iBAAiBG,WACnCZ,EAAkBW,iBAAiBC,eAjDvCjrC,OAAAmb,EAAA,EAAAnb,CAAAqqC,EAAA,EAAAzjC,IAAA,qBAAApH,MAAA,SAsH6B0rC,MAtH7B,CAAAtkC,IAAA,kBAAApH,MAAA,SA+H0B2rC,EAA8BC,EAAkBC,GACtE,GAAIA,EAAc3sC,OAAS,EAAG,CAC5B,IAAK,IAAIiF,EAAI,EAAGA,EAAI0nC,EAAc3sC,OAAS,EAAGiF,IAAK,CACjD,IAAM2D,EAAI+jC,EAAc1nC,GACxBwnC,EAAUG,OAAOhkC,EAAEjK,EAAIyB,KAAK0N,OAAOob,QAAQiK,IAAIx0B,EAAGiK,EAAE9J,EAAIsB,KAAK0N,OAAOob,QAAQiK,IAAIr0B,EAAG,GAAI,GACvF4tC,GAAY,EAEd,IAAM9jC,EAAI+jC,EAAcA,EAAc3sC,OAAS,GACzC6sC,EAAQH,EACdD,EAAUG,OACRhkC,EAAEjK,EAAIyB,KAAK0N,OAAOob,QAAQiK,IAAIx0B,EAC9BiK,EAAE9J,EAAIsB,KAAK0N,OAAOob,QAAQiK,IAAIr0B,EAC9B,GACAiJ,GAAInG,KAAK0O,KAAKu8B,GAAQ,EAAG,EAAG,GAAK,OA5IzC,CAAA3kC,IAAA,4BAAApH,MAAA,WAoJI,IAFA,IAAMgsC,EAAY1sC,KAAK0rC,OAAO9rC,OACxB+sC,EAAeD,EAAY1sC,KAAK2rC,OAAO/rC,OACpCiF,EAAI,EAAGA,EAAI8nC,EAAc9nC,IAAK,CACrC,IAAM4E,EAAI5E,EAAI6nC,EAAY1sC,KAAK0rC,OAAO7mC,GAAK7E,KAAK2rC,OAAO9mC,EAAI6nC,GACvDE,EAAK,EACPC,EAAK,EACDzzB,EAAQta,EAAOguC,IAAM,IAAO9sC,KAAKyrC,gBACvCmB,GAAwB,IAAlBprC,KAAK2S,IAAIiF,GACf,IAAM2zB,EAA0B,GAAmB,GAAbtjC,EAAE7J,SACxCgtC,IAAOnjC,EAAElL,EAAIwuC,EACbF,IAAOpjC,EAAE/K,EAAIquC,EACb,IAAMtb,EAASzxB,KAAK4nB,KAAK4K,MAAMf,OAC/B,GAAIA,EAAOsB,IAAImM,OAAOl/B,KAAK0N,OAAOob,QAAQiK,KAAM,CAC9C,IAAMG,EAAUzB,EAAO2B,SAAS70B,EAAIkzB,EAAOsB,IAAIx0B,EACzCyuC,EAAUvb,EAAO2B,SAAS10B,EAAI+yB,EAAOsB,IAAIr0B,EACzCmS,EAAUpH,EAAElL,EAAI20B,EAChBniB,EAAUtH,EAAE/K,EAAIsuC,EAChBC,EAAOp8B,EAAUA,EAAUE,EAAUA,EACrCm8B,EAAsB1rC,KAAKgR,IAAIhR,KAAKmS,IAAIhM,GAAIslC,EAAM,EAAG,EAAG,GAAI,GAAI,GAAI,GAG1EL,GAFsB/7B,EAAUq8B,EAAsB,GAGtDL,GAFsB97B,EAAUm8B,EAAsB,GAIxD,IAAK,IAAIp8B,EAAI,EAAGA,EAAI67B,EAAc77B,IAAK,CACrC,IAAMoW,EAAIpW,EAAI47B,EAAY1sC,KAAK0rC,OAAO56B,GAAK9Q,KAAK2rC,OAAO76B,EAAI47B,GAC3D,GAAIjjC,IAAMyd,EACR,MAEF,IAAMpT,EAAKrK,EAAElL,EAAI2oB,EAAE3oB,EACbwV,EAAKtK,EAAE/K,EAAIwoB,EAAExoB,EACbyuC,EAAWr5B,EAAKA,EAAKC,EAAKA,EAChC,GAAIo5B,EAAW,EAAG,CAChB,IAAMC,EAAW,KAAQD,EACzBP,GAAM94B,EAAKs5B,EACXP,GAAM94B,EAAKq5B,GAGf3jC,EAAElL,GAAKquC,EACPnjC,EAAE/K,GAAKmuC,KAzLb,CAAA/kC,IAAA,SAAApH,MAAA,WA8LIV,KAAKqtC,mBAAmBrtC,KAAK0N,OAAOqb,OACpC/oB,KAAKqtC,mBAAmBrtC,KAAK0N,OAAOsb,OACpChpB,KAAKstC,4BACLttC,KAAKutC,gBAAgBhC,EAAkBS,iBAAkBhsC,KAAK0N,OAAOqb,MAAO/oB,KAAK0rC,QACjF1rC,KAAKutC,gBAAgBhC,EAAkBW,iBAAkBlsC,KAAK0N,OAAOsb,MAAOhpB,KAAK2rC,UAlMrF,CAAA7jC,IAAA,UAAApH,MAAA,WAuMIV,KAAK0N,OAAOkc,IAAI,MAAO5pB,KAAK+jC,oBAC5B/jC,KAAK0N,OAAOkc,IAAI,OAAQ5pB,KAAK8rC,yBAxMjCP,EAAA,CAAuC7B,IA4MvC,SAASqC,KACP,OAAO,IAAI95B,WAAgC,KAAvBzQ,KAAKkI,SAAW,IAAqC,KAAvBlI,KAAKkI,SAAW,KA7MvD6hC,GACJS,eAAiB3D,GACtB,kBACE,IAAIuB,GACF,CACExnC,MAAO,IAAIorC,SAAM,mBACjBjrC,KAAM,GACNyoC,QAAS,QAPNO,GAsBJW,eAAiB7D,GACtB,kBACE,IAAIuB,GACF,CACExnC,MAAO,IAAIorC,SAAM,UACjBjrC,KAAM,GACNyoC,QAAS,GACTrjC,IAAKohC,GAAuB,GAAI,GAAI,mBChCvC,IAAM0E,GAAb,SAAAjC,GAEE,SAAAiC,EAAY//B,EAAgBi8B,EAAc/hB,GAAY,IAAAxoB,EAAA,OAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAytC,IACpDruC,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAusC,GAAA3zB,KAAA9Z,KAAM0N,EAAQi8B,EAAO/hB,KAFhB8lB,UAC+C,EAEpDtuC,EAAKsuC,KAAO,IAAIC,QACd,IAAIC,uBAAoB,IAAM,KAE9B,IAAIC,qBAAkB,CACpBxC,aAAa,EACbyC,YAAY,EACZ1C,WAAW,EACXzjC,IAAKohC,GAAuB,GAAI,GAAI,eACpC3mC,MAAO,IAAIorC,SAAM,SACjBO,KAAMC,iBAGV/mB,GAAM7nB,EAAKsuC,KAAK5kC,SAAU1J,EAAKsO,OAAOqlB,IAAK,GAC3C3zB,EAAKsuC,KAAK5kC,SAASoF,EAAI,EACvB9O,EAAKuqC,MAAM9U,IAAIz1B,EAAKsuC,MAhBgCtuC,EAFxD,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAAusC,EAAAjC,GAAAtqC,OAAAmb,EAAA,EAAAnb,CAAAusC,EAAA,EAAA3lC,IAAA,SAAApH,MAAA,WAqBI,IAAMqyB,EAAM/yB,KAAK0N,OAAOugC,gBAAgBnU,QACxC/G,EAAIx0B,GAAmC,IAA9BiD,KAAK2S,IAAIrV,EAAOguC,IAAM,KAC/B/Z,EAAIr0B,GAAkC,IAA7B8C,KAAK4S,IAAItV,EAAOguC,IAAM,KAC/B7lB,GAAMjnB,KAAK0tC,KAAK5kC,SAAUiqB,EAAK,IAC/B/yB,KAAK0tC,KAAK5kC,SAASoF,EAAI,IAzB3B,CAAApG,IAAA,UAAApH,MAAA,WAyCIV,KAAK2pC,MAAMnkB,OAAOxlB,KAAK0tC,UAzC3BD,EAAA,CAAoC/D,aCF7B,IAAMwE,GAAb,SAAA1C,GAEE,SAAA0C,EAA4BC,GAAkC,IAAA/uC,EAAA,OAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAkuC,IAC5D9uC,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAgtC,GAAAp0B,KAAA9Z,KAAMmuC,EAAazgC,OAAQygC,EAAaxE,MAAOwE,EAAavmB,QADAumB,eAAA/uC,EADtDgvC,UAAoC,GACkBhvC,EAFhE,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAAgtC,EAAA1C,GAAAtqC,OAAAmb,EAAA,EAAAnb,CAAAgtC,EAAA,EAAApmC,IAAA,SAAApH,MAAA,WAQI,IAAIq9B,EACJ,IAAKA,EAAQ,EAAGA,EAAQ/9B,KAAK0N,OAAOswB,QAAQp+B,OAAQm+B,IAAS,CAC3D,IAAMO,EAASt+B,KAAK0N,OAAOswB,QAAQD,GAC7B5c,EAAWnhB,KAAKouC,UAAUrQ,GAChB,MAAZ5c,EACFnhB,KAAKouC,UAAUrQ,GAASsQ,GAAqB/P,EAAQt+B,KAAKmuC,cACjD7P,IAAWnd,EAASzT,SAE7ByT,EAASgC,UACTnjB,KAAKouC,UAAUrQ,GAASsQ,GAAqB/P,EAAQt+B,KAAKmuC,eAI9D,KAAOpQ,EAAQ/9B,KAAKouC,UAAUxuC,OAAQm+B,IAAS,CAC5B/9B,KAAKouC,UAAUrQ,GACvB5a,UAjBJ,IAAA7d,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAoBP,QAAAoF,EAAAC,EAAgB1F,KAAKouC,UAArBzoC,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAgC,CAAAG,EAAA/E,MAC5B4tC,UArBG,MAAAtoC,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,MANX,CAAAsC,IAAA,UAAApH,MAAA,WA+BY,IAAAiY,GAAA,EAAAC,GAAA,EAAAC,OAAAxY,EAAA,IACR,QAAAyY,EAAAC,EAAgB/Y,KAAKouC,UAArBzoC,OAAAC,cAAA+S,GAAAG,EAAAC,EAAAlT,QAAAC,MAAA6S,GAAA,EAAgC,CAAAG,EAAApY,MAC5ByiB,WAFI,MAAAnd,GAAA4S,GAAA,EAAAC,EAAA7S,EAAA,YAAA2S,GAAA,MAAAI,EAAA9S,QAAA8S,EAAA9S,SAAA,WAAA2S,EAAA,MAAAC,QA/BZq1B,EAAA,CAAyCxE,IAsCzC,SAAS2E,GAA2C/P,EAAW6P,GAC7D,GAAI7P,aAAkBpB,GACpB,OAAO,IAAIqR,GAAqBjQ,EAAQ6P,GAExC,MAAM,IAAI5uB,MAAM,kCAAoC+e,OAIlDiQ,eAeJ,SAAAA,EAAY7gC,EAA6BygC,GAA4B,IAAAlxB,EAAA,OAAA/b,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAuuC,IACnEtxB,EAAA/b,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAqtC,GAAAz0B,KAAA9Z,KAAM0N,EAAQygC,EAAaxE,MAAOwE,EAAavmB,QADoBumB,eAAAlxB,EAD7DywB,UAC6D,EAEnEzwB,EAAKywB,KAAOa,EAAqBC,UACjCL,EAAaT,KAAK7Y,IAAI5X,EAAKywB,MAC3BzwB,EAAKywB,KAAKn9B,MAAM4L,IAAI,IAAM,IAAM,GAJmCc,wEAQnE,IACM7Z,EAAIuE,GADY3H,KAAK0N,OAAO+vB,cACL,EAAG,EAAG,GAAK,GACxCz9B,KAAK0tC,KAAKn9B,MAAMhS,EAAIyoB,GAAKhnB,KAAK0tC,KAAKn9B,MAAMhS,EAAG6E,EAAG,IAC/CpD,KAAK0tC,KAAKn9B,MAAM7R,EAAIsoB,GAAKhnB,KAAK0tC,KAAKn9B,MAAM7R,EAAG0E,EAAG,sCAI/CpD,KAAKmuC,aAAaT,KAAKloB,OAAOxlB,KAAK0tC,aA9BJhE,IAA7B6E,GACGC,QAAU,WACf,IAAMpa,EAAI,IAAIwZ,uBAAoB,IAAM,KACxCxZ,EAAEqa,UAAU,EAAG,EAAG,GAClB,IAAM1E,EAAW,IAAI8D,qBAAkB,CACrClmC,IAAKohC,GAAuBvnC,KAAKkmB,MAAM,GAAK,IAAKlmB,KAAKkmB,MAAM,QAC5DqmB,KAAMC,cACN5rC,MAAOssC,GACPrD,aAAa,EACbL,QAAS,KAEX,OAAO,IAAI2C,QAAKvZ,EAAG2V,IAuBvB,OAAM2E,GAAY,IAAIlB,SAAM,WAAWxmB,KAAK,IAAIwmB,SAAM,GAAI,IClEpDmB,oDACJC,sBACAC,mEAEIltC,EAAcmrC,GAChB9sC,KAAK4uC,UAAYjtC,EACjB3B,KAAK6uC,YAAc/B,iCAGdA,GACL,GAAsB,MAAlB9sC,KAAK4uC,WAAyC,MAApB5uC,KAAK6uC,YAAqB,CACtD,IAAM1xB,EAAK2vB,EAAM9sC,KAAK6uC,YACR7uC,KAAK4uC,UAAUzxB,KAE3Bnd,KAAK4uC,eAAYvuC,EACjBL,KAAK6uC,iBAAcxuC,aAMdyuC,GAAb,SAAAC,GAEE,SAAAD,EAAmB3tB,GAAwB,IAAA/hB,EAgZxBsS,EAhZwB,OAAAxQ,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA8uC,IACzC1vC,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA4tC,GAAAh1B,KAAA9Z,KAAM8uC,EAAShF,UA+YEp4B,EA/YoByP,EAASzT,OAiZzCshC,KACJvtB,IAAI/P,EAAKijB,aACTmF,YApZwC3Y,WAAA/hB,EAF7C,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAA4tC,EAAAC,GAAAD,EAAA,CAA8BnB,SAAjBmB,GACJhF,SAAW,IAAI8D,uBAAoB,EAAG,GAMxC,IAAMqB,GAAb,SAAAzD,GAuBE,SAAAyD,EAAYvhC,EAAWi8B,EAAc/hB,GAAY,IAAA3K,EAAA/b,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAivC,IAC/ChyB,EAAA/b,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA+tC,GAAAn1B,KAAA9Z,KAAM0N,EAAQi8B,EAAO/hB,KAZhB8lB,UAW0C,EAAAzwB,EAVzCiyB,uBAUyC,EAAAjyB,EATzCkyB,mBASyC,EAAAlyB,EARzCqL,WAQyC,EAAArL,EAPzCmyB,sBAAwB,EAOiBnyB,EANzCoyB,WAAa,IAAIC,YAMwBryB,EALzCsyB,qBAKyC,EAAAtyB,EAJzCuyB,qBAIyC,EAAAvyB,EAHzCwyB,yBAGyC,EAAAxyB,EAFzC2xB,UAAY,IAAID,GAEyB1xB,EA0KzCyyB,iBAA0BT,EAAaU,mBAAmB1jB,GAAYiO,MA1K7Bjd,EA2KzC2yB,YAAc,EAzKhB3yB,EAAKvP,kBAAkBizB,IACzB1jB,EAAKuyB,gBAAkB,IAAIP,EAAahyB,EAAKvP,OAAOmzB,cAAe5jB,EAAK0sB,MAAO1sB,EAAK2K,MACpF3K,EAAKywB,KAAOzwB,EAAKuyB,gBAAgB9B,KACjCzwB,EAAKywB,KAAKn9B,MAAM4L,IAAI,IAAM,IAAM,IAEhCc,EAAKywB,KAAO,IAAIoB,GAAJ5tC,OAAAw6B,GAAA,EAAAx6B,CAAA+b,IAGdA,EAAKkyB,cAAiBlyB,EAAKywB,KAAK3D,SAA+B3nC,MAAM03B,QACjE9P,GAAa/M,EAAKvP,UACpBuP,EAAKiyB,kBAAoB,IAAI3D,GAAkBtuB,EAAKvP,OAAOwc,UAAWjN,EAAK0sB,MAAO1sB,EAAK2K,MACvF3K,EAAKiyB,kBAAkBzD,iBAAmBxuB,EAAKvP,OAAOqlB,IAAIx0B,EAAI0e,EAAKvP,OAAOqlB,IAAIr0B,GAAK,GAErFue,EAAK0sB,MAAM9U,IAAI5X,EAAKywB,MACpB,IAAMmC,EAAS5yB,EAAKvP,kBAAkB+kB,GAAO,EAAI,EAgBjD,GAfAxV,EAAKywB,KAAK5kC,SAASqT,IAAIc,EAAKvP,OAAOqlB,IAAIx0B,EAAG0e,EAAKvP,OAAOqlB,IAAIr0B,EAAGmxC,GACzD5yB,EAAKvP,kBAAkB+kB,GAEnBxV,EAAKvP,OAAOinB,YAAkC/B,cAClD3V,EAAKywB,KAAKn9B,MAAM4L,IAAI,IAAM,IAAM,GAGlCc,EAAKywB,KAAKoC,kBAAmB,EAE/B7yB,EAAKywB,KAAKqC,gBACN9yB,EAAKvP,kBAAkByzB,IAAQlkB,EAAKvP,kBAAkB+0B,MACxDxlB,EAAKqL,MAAQ,IAAI0nB,SAAM/yB,EAAK2K,KAAKqoB,eACjChzB,EAAKywB,KAAK7Y,IAAI5X,EAAKqL,QAGjBrL,EAAKvP,kBAAkB2mB,GAAO,CAChC,IAAM6b,EAAQjzB,EAAKvP,OACnBuP,EAAKsyB,gBAAkB3nB,EAAKuoB,mBAC1B,kBAAMlzB,EAAKvP,OAAOqlB,KAClB,WACE,OACErxB,EAAAC,EAAAC,cAAA,OAAKM,UAAU,mBACbR,EAAAC,EAAAC,cAAA,WACGsuC,EAAMtM,mBAAmB7a,MAAMqnB,QAAQ,GAD1C,IAC+CF,EAAMvM,gBAAkB,EADvE,UAGAjiC,EAAAC,EAAAC,cAAA,WACGsuC,EAAMtM,mBAAmB5a,MAAMonB,QAAQ,GAD1C,IAC+CF,EAAMvM,gBAAkB,EADvE,aA1CqC,OAmD3C1mB,EAAKvP,kBAAkB+kB,KACzBxV,EAAKwyB,oBAAsB,IAAIvB,GAAJhtC,OAAAw6B,GAAA,EAAAx6B,CAAA+b,KApDkBA,EAvBnD,OAAA/b,OAAAkb,EAAA,EAAAlb,CAAA+tC,EAAAzD,GAAAtqC,OAAAmb,EAAA,EAAAnb,CAAA+tC,EAAA,EAAAnnC,IAAA,QAAApH,MAAA,SA+EQnC,EAAWgE,GACf,OAAOf,KAAKkmB,MAAMnpB,EAAIgE,GAAQA,IAhFlC,CAAAuF,IAAA,SAAApH,MAAA,WAoFI,IAAM2vC,EAAcrwC,KAAK0N,OAAO2iC,cAChCrwC,KAAKswC,iBAAiBD,GACtBrwC,KAAKuwC,aACLvwC,KAAKwwC,YAAYH,GAGbrwC,KAAK0N,kBAAkB+kB,IACzBzyB,KAAK0tC,KAAK5kC,SAASqT,IAAInc,KAAK0N,OAAOqlB,IAAIx0B,EAAGyB,KAAK0N,OAAOqlB,IAAIr0B,EAAIsB,KAAK0N,OAAO2wB,OAAQ,GAGpFr+B,KAAKywC,kBAE2B,MAA5BzwC,KAAKyvC,qBACPzvC,KAAKyvC,oBAAoBnB,SAG3BtuC,KAAK4uC,UAAUN,OAAOxvC,EAAOguC,IAAM,OApGvC,CAAAhlC,IAAA,mBAAApH,MAAA,SAuGmB2vC,GAEXA,EAAc,GACQ,MAApBrwC,KAAK0tC,KAAKpjC,QACZtK,KAAK2pC,MAAM9U,IAAI70B,KAAK0tC,MAEQ,MAA1B1tC,KAAKkvC,mBAEPlvC,KAAKkvC,kBAAkBZ,UAEI,MAApBtuC,KAAK0tC,KAAKpjC,QACnBtK,KAAK2pC,MAAMnkB,OAAOxlB,KAAK0tC,QAlH7B,CAAA5lC,IAAA,aAAApH,MAAA,WAuHI,GAAIV,KAAK0N,kBAAkBizB,GAAa,CAEtC,IAAMv9B,EAAI,EAAIpD,KAAK0N,OAAOqzB,cAAgB/gC,KAAK0N,OAAOszB,YACtD/Z,GAAMjnB,KAAK0tC,KAAKn9B,MAAO,CAAEhS,EAAG6E,EAAG1E,EAAG0E,GAAK,SAGlC,GAAIpD,KAAK0N,kBAAkB2mB,GAAO,CACvC,IAAM9jB,EAAQ5I,GAAI3H,KAAK0N,OAAOgjC,oBAAqB,EAAG,EAAG,GAAK,GACxDC,EAAc,IAAI1+B,WAAQ1B,EAAOA,GACvC0W,GAAMjnB,KAAK0tC,KAAKn9B,MAAOogC,EAAa,SAEpC1pB,GAAMjnB,KAAK0tC,KAAKn9B,MAAO0+B,EAAa2B,IAAK,MAlI/C,CAAA9oC,IAAA,cAAApH,MAAA,SAsIc2vC,GACV,IAAMQ,EAAM7wC,KAAK0tC,KAAK3D,SACtB,GAAI/pC,KAAK0N,kBAAkBulB,GAAK,CAC9B,IAAM6d,EAAatvC,KAAKgR,IAAI,EAAG7K,GAAI3H,KAAK0N,OAAO20B,MAAO,EAAI,EAAG,MAAO,EAAG0O,GAAenxC,OAAS,IACzFoxC,EAAkBxvC,KAAKkmB,MAAMopB,GAC7BG,EAAaF,GAAeC,GAElC,GADAhxC,KAAKmvC,cAAgB8B,EAAWnX,QAC5BkX,IAAoBD,GAAenxC,OAAS,EAAG,CACjD,IAAMqlB,EAAQ6rB,EAAaE,EAErBE,EAAWH,GADKC,EAAkB,GAExChxC,KAAKmvC,cAAcnoB,KAAKkqB,EAAUjsB,IAGtC4rB,EAAIzuC,MAAM+uC,KAAKnxC,KAAKmvC,eAChB/W,GAAUp4B,KAAK0N,SACjBmjC,EAAIzuC,MAAM4kB,KAAK,IAAIwmB,SAAM,GAAI,EAAIxtC,KAAK0N,OAAO2qB,OAAS5M,GAAOnB,eAG/DumB,EAAIzuC,MAAQpC,KAAKoxC,qBAAqBP,EAAIzuC,OAC1CyuC,EAAIzuC,MAAQ,IAAIorC,SAAM,GAAGxmB,KAAK6pB,EAAIzuC,MAAOuF,GAAI0oC,EAAa,EAAG,EAAG,GAAK,MA1JzE,CAAAvoC,IAAA,kBAAApH,MAAA,WA+JI,GAAIV,KAAK0N,kBAAkByzB,IAAsB,MAAdnhC,KAAKsoB,MAAe,CACrD,IAAM+oB,EAAuBrxC,KAAK0N,OAAOm0B,mBACzC,GAAIwP,EAAuBrxC,KAAKovC,sBAAuB,CACrDpvC,KAAKsoB,MAAMgpB,UAAUrpB,IACrB,IAAMspB,EAAOvxC,KAAK0N,OAAOqlB,IAAIye,kBAAkBxxC,KAAK4nB,KAAK4K,MAAMf,OAAOsB,KAChE0e,EAASjwC,KAAKmS,IAAI,EAAG,GAAK,EAAI49B,EAAO,KAAOvxC,KAAK0N,OAAOi0B,eAAiB3hC,KAAK0N,OAAOi0B,eAC3F3hC,KAAKsoB,MAAMopB,UAAUD,GAGrBzxC,KAAKsoB,MAAMqpB,OACX3xC,KAAK4uC,UAAUzyB,IAAInc,KAAK4xC,qBAAsB9yC,EAAOguC,IAAM,KAE7D9sC,KAAKovC,sBAAwBiC,EAE/B,GAAIrxC,KAAK0N,kBAAkB+0B,IAAsB,MAAdziC,KAAKsoB,MAAe,CACrD,IAAM+oB,EAAuBrxC,KAAK0N,OAAOs1B,YACzC,GAAIqO,IAAyBrxC,KAAKovC,sBAAuB,CACvDpvC,KAAKsoB,MAAMgpB,UAAUppB,IAErB,IACMqpB,EAAOvxC,KAAK0N,OAAOqlB,IAAIye,kBAAkBxxC,KAAK4nB,KAAK4K,MAAMf,OAAOsB,KAChE0e,EAFa,EAEJjwC,KAAKmS,IAAI,EAAG,GAAK,EAAI49B,EAAO,KAC3CvxC,KAAKsoB,MAAMopB,UAAUD,GACI,MAArBzxC,KAAKsoB,MAAMvjB,QACb/E,KAAKsoB,MAAM7P,OAEbzY,KAAKsoB,MAAMqpB,OACX3xC,KAAK4uC,UAAUzyB,IAAInc,KAAK4xC,qBAAsB9yC,EAAOguC,IAAM,KAE7D9sC,KAAKovC,sBAAwBiC,EAE/BrxC,KAAK0tC,KAAKloB,OAAOxlB,KAAKqvC,cA9L1B,CAAAvnC,IAAA,uBAAApH,MAAA,SAmMuB0B,GAAc,IACzBu7B,EAAgB39B,KAAK0N,OAArBiwB,YACJkU,EAAS5C,EAAaU,mBAAmBhS,GACzCkU,IAAW7xC,KAAK0vC,mBAClB1vC,KAAK4vC,YAAc,GAErB,IAAMkC,EAAanU,IAAgB1R,GAAYiO,KAAO,EAAI,GAI1D,OAHAl6B,KAAK0vC,iBAAmBmC,EACxB7xC,KAAK4vC,YAAc5oB,GAAKhnB,KAAK4vC,YAAakC,EAAY,IACtD1vC,EAAM4kB,KAAKhnB,KAAK0vC,iBAAkB1vC,KAAK4vC,aAChCxtC,IA7MX,CAAA0F,IAAA,cAAApH,MAAA,WAgNgB,IAAAwiB,EAAAljB,KAEZ,GADAA,KAAK0tC,KAAK7Y,IAAI70B,KAAKqvC,YACFrvC,KAAK0N,OTyZfk0B,qBAAqBzuB,MSzZG,CAC7B,IAEsD4+B,EAFhDC,EAAYhyC,KAAK0N,kBAAkByzB,GAAO,SAAW,IAAIqM,SAAM,mBAAmByE,SAClFC,EAAQlyC,KAAK0N,OAAOk0B,UAC1B,GAAIsQ,EAAMtyC,SAAWI,KAAKqvC,WAAWhtC,SAASzC,QAE5CmyC,EAAA/xC,KAAKqvC,YAAW7pB,OAAhBzQ,MAAAg9B,EAAA7wC,OAAAmJ,EAAA,EAAAnJ,CAA0BlB,KAAKqvC,WAAWhtC,WAC1C6vC,EAAMzvB,QAAQ,SAACiT,GACb,IAAM91B,EAAwB,EAAf81B,EAAI91B,SAAe,IAC5BuyC,EAAW,IAAIC,WAAQ1c,EAAIn3B,EAAGm3B,EAAIh3B,EAAG,GAAG2zC,YACxCC,EAAcpvB,EAAKqvB,SAASJ,EAAUA,EAASrY,QAAQ0Y,gBAAgB5yC,EAAS,GAAIA,EAAQoyC,GAClG9uB,EAAKmsB,WAAWxa,IAAIyd,KAI1B,GAAItyC,KAAKyyC,mBAAmBzyC,KAAK0N,QAAS,CACxC,IAEsDglC,EAFhDtwC,EAAQpC,KAAK0N,kBAAkB+0B,GAAO,IAAI+K,SAAM,mBAAmByE,SAAW,SAC9EU,EAAQ3yC,KAAK0N,OAAOq1B,gBAC1B,GAAI4P,EAAM/yC,SAAWI,KAAKqvC,WAAWhtC,SAASzC,QAE5C8yC,EAAA1yC,KAAKqvC,YAAW7pB,OAAhBzQ,MAAA29B,EAAAxxC,OAAAmJ,EAAA,EAAAnJ,CAA0BlB,KAAKqvC,WAAWhtC,WAC1CswC,EAAMlwB,QAAQ,SAACiT,GACb,IAAM91B,EAAS81B,EAAI91B,SAAW,IACxBuyC,EAAW,IAAIC,WAAQ1c,EAAIn3B,EAAGm3B,EAAIh3B,EAAG,GAAG2zC,YACxCC,EACJpvB,EAAKxV,kBAAkB+0B,GACnBvf,EAAKqvB,SAASJ,EAAU,IAAIC,WAAWxyC,EAAQwC,GAC/C,IAAIwwC,eAAYT,EAAU,IAAIC,WAAQ,EAAG,EAAG,GAAIxyC,EAAQwC,GAC9D8gB,EAAKmsB,WAAWxa,IAAIyd,QA7O9B,CAAAxqC,IAAA,qBAAApH,MAAA,WAmPkC,IC/RTnB,ED+RSqkB,EAAA5jB,KAExB6yC,GCjSetzC,EDiSCuzC,KChSjB,SAAC5tC,GAAD,OAAe3F,EAAE,EAAI2F,KDiS1B,OAAO,SAACiY,GACN,IAAMjY,EAAIqiB,GAAMpK,EAHD,IAGmByG,EAAKlW,OAAegxB,OAAS,GAAI,EAAG,GAChEnuB,EAAQ5I,GAAIkrC,EAAK3tC,GAAI,EAAG,EAAG,EAAG,KAEpC,OADA0e,EAAK8pB,KAAKn9B,MAAMwiC,UAAUxiC,GACnBrL,GAAK,KA1PlB,CAAA4C,IAAA,qBAAApH,MAAA,SA+PIwE,GAIA,OAAOiO,MAAM6/B,QAAQ9tC,EAAE69B,mBAnQ3B,CAAAj7B,IAAA,WAAApH,MAAA,SA2QmBg1B,EAAcud,EAAiBrzC,EAAgBwC,GAE9D,IAAM8wC,EAAO,IAAIC,QAAKlE,EAAamE,aAAc,IAAIC,qBAAkB,CAAEjxC,MAAOA,KAGhF,GAFA8wC,EAAKpqC,SAASqoC,KAAK8B,GAEfvd,EAAIh3B,EAAI,OACVw0C,EAAKI,WAAWn3B,IAAI,EAAG,EAAG,EAAG,QACxB,GAAIuZ,EAAIh3B,GAAK,OAClBw0C,EAAKI,WAAWn3B,IAAI,EAAG,EAAG,EAAG,OACxB,CACL,IAAMo3B,EAAO,IAAInB,WAAQ1c,EAAIxnB,EAAG,GAAIwnB,EAAIn3B,GAAG8zC,YACrCmB,EAAUhyC,KAAKiyC,KAAK/d,EAAIh3B,GAC9Bw0C,EAAKI,WAAWI,iBAAiBH,EAAMC,GAMzC,OAJAN,EAAK3iC,MAAM4L,IAAI,EAAG3a,KAAKgR,IAAI,EAAG5S,GAAS,GACvCszC,EAAKpqC,SAASoF,EAAI,GAClBglC,EAAKnD,eACLmD,EAAKpD,kBAAmB,EACjBoD,IA7RX,CAAAprC,IAAA,UAAApH,MAAA,WAgSIV,KAAK2pC,MAAMnkB,OAAOxlB,KAAK0tC,MACK,MAAxB1tC,KAAKuvC,iBACPvvC,KAAK4nB,KAAK+rB,sBAAsB3zC,KAAKuvC,iBAET,MAA1BvvC,KAAKkvC,mBACPlvC,KAAKkvC,kBAAkB/rB,UAEO,MAA5BnjB,KAAKyvC,qBACPzvC,KAAKyvC,oBAAoBtsB,cAxS/B8rB,EAAA,CAAyDvF,IAA5CuF,GACYU,0CACpB1jB,GAAYmO,UAAY,IAAIoT,SAAM,2BAClCvhB,GAAYkO,IAAM,IAAIqT,SAAM,UAAUxmB,KAAK,IAAIwmB,SAAM,SAAU,qBAC/DvhB,GAAYiO,KAAO,IAAIsT,SAAM,0BAC7BvhB,GAAYgO,KAAO,IAAIuT,SAAM,aAAaxmB,KAAK,IAAIwmB,SAAM,SAAU,qBACnEvhB,GAAY+N,SAAW,IAAIwT,SAAM,kBANzByB,GASI2B,IAAM,IAAI3+B,WAAQ,EAAG,GATzBg9B,GAsQJmE,aAAgB,WACrB,IAAMhf,EAAI,IAAI+V,kBAEd,OADA/V,EAAEmW,aAAa,WAAY,IAAIqJ,0BAAuB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,IACnExf,EAHc,GAuClB,IAAM4a,GAAkB3G,GAAK,WAClC,IAAMwL,EAAY,IAAI75B,IA0FtB,OAzFA65B,EAAU13B,IACR8W,GACA,IAAI4a,qBAAkB,CACpBE,KAAMC,cACNF,YAAY,KAGhB+F,EAAU13B,IACRoX,GACA,IAAIsa,qBAAkB,CACpBlmC,IAAKohC,GAAuB,EAAG,IAG/BgF,KAAMC,cAEN5rC,MAAO,IAAIorC,SAAM,oBACjBM,YAAY,KAGhB+F,EAAU13B,IACR2gB,GACA,IAAI+Q,qBAAkB,CACpBlmC,IAAKohC,GAAuB,IAAS,OACrCgF,KAAMC,iBAGV6F,EAAU13B,IACRmX,GACA,IAAIua,qBAAkB,CACpBlmC,IAAKohC,GAAuB,GAAI,IAChCgF,KAAMC,cACN5rC,MAAO,IAAIorC,SAAM,sBAGrBqG,EAAU13B,IACR8b,GACA,IAAI4V,qBAAkB,CACpBlmC,IAAKohC,GAAuB,OAAU,QACtCgF,KAAMC,cACN5rC,MAAO,IAAIorC,SAAM,yBAGrBqG,EAAU13B,IACRqX,GACA,IAAIqa,qBAAkB,CACpBlmC,IAAKohC,GAAuB,EAAG,IAC/BgF,KAAMC,cACN5rC,MAAO,IAAIorC,SAAM,YAGrBqG,EAAU13B,IAAIyoB,GAAWiP,EAAUpyB,IAAI+R,KAMvCqgB,EAAU13B,IACRglB,GACA,IAAI0M,qBAAkB,CAEpBlmC,IAAKohC,GAAuB,GAAK,GAAI,MAErCgF,KAAMC,iBAGV6F,EAAU13B,IACRsmB,GACA,IAAIoL,qBAAkB,CAEpBlmC,IAAKohC,GAAuB,GAAK,GAAI,IAAM,IAC3CgF,KAAMC,iBAGV6F,EAAU13B,IACRkY,GACA,IAAIwZ,qBAAkB,CACpBlmC,IAAKkhC,GACLkF,KAAMC,cACN3C,aAAa,KAGjBwI,EAAU13B,IACRqpB,GACA,IAAIqI,qBAAkB,CACpBlmC,IAAKohC,GAAuBvnC,KAAKkmB,MAAM,MAAWlmB,KAAKkmB,MAAM,MAC7DqmB,KAAMC,iBAIH6F,IA6BT,IAAM9C,GAAiB,CAErB,IAAIvD,SAAM,qBACV,IAAIA,SAAM,sBACV,IAAIA,SAAM,uBEpdCsG,GAAb,SAAAC,GAEE,SAAAD,EAAYpmC,EAAmBi8B,EAAc/hB,GAAY,IAAAxoB,EAAA,OAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA8zC,IACvD10C,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA4yC,GAAAh6B,KAAA9Z,KAAM0N,EAAQi8B,EAAO/hB,KAFfosB,WACiD,EAEvD50C,EAAK40C,MAAQ50C,EAAK60C,UAAU70C,EAAKsO,OAAOgoB,KACxCt2B,EAAKsuC,KAAK7Y,IAAIz1B,EAAK40C,OAHoC50C,EAF3D,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAA4yC,EAAAC,GAAA7yC,OAAAmb,EAAA,EAAAnb,CAAA4yC,EAAA,EAAAhsC,IAAA,YAAApH,MAAA,SA+BoBg1B,GAChB,IAAM91B,EAAS81B,EAAI91B,SAAW,IACxBuyC,EAAW,IAAIC,WAAQ1c,EAAIn3B,EAAGm3B,EAAIh3B,EAAG,GAAG2zC,YACxCtf,EAAMof,EAASrY,QAAQ0Y,gBAAgB5yC,EAAS,GACtD,OAAO,IAAIgzC,eAAYT,EAAU,IAAIC,WAAQrf,EAAIx0B,EAAGw0B,EAAIr0B,EAAG,GAAIkB,EAAQ,SAAU,GAAK,QAnC1Fk0C,EAAA,CAAuC7E,ICMhC,SAASiF,GAAoCC,EAAWxK,EAAc/hB,GAC3E,GAAIusB,aAAkBthB,GACpB,OAAO,IAAI4a,GAAe0G,EAAQxK,EAAO/hB,GACpC,GAAIusB,aAAkBvP,GAC3B,OAAO,IAAIkP,GAAkBK,EAAQxK,EAAO/hB,GACvC,GAAIusB,aAAkB1a,GAC3B,OAAO,IAAIwV,GAAakF,EAAQxK,EAAO/hB,GAEvC,MAAM,IAAIrI,MAAJ,8BAAAxS,OAAwConC,IAI3C,IAAMC,GAAb,SAAA5I,GAEE,SAAA4I,EAAY1mC,EAAei8B,EAAc/hB,GAAY,IAAAxoB,EAAA,OAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAo0C,IACnDh1C,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAkzC,GAAAt6B,KAAA9Z,KAAM0N,EAAQi8B,EAAO/hB,KAFhBwmB,UAAY,IAAIp0B,IAC8B5a,EAiB7Ci1C,0BAA4BC,aAClC,SAACC,GAAD,OAAsBA,GACtB,SAACA,GACC,IAAMC,EAAkBD,EAAMzjB,QADrBxrB,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAGT,QAAAoF,EAAAC,EAAgB8uC,EAAhB7uC,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAiC,KAAtBmI,EAAsBhI,EAAA/E,MACzBygB,EAAW/hB,EAAKgvC,UAAU3sB,IAAIhU,GACpC,GAAgB,MAAZ0T,EACF,MAAM,IAAI5B,MAAJ,8BAAAxS,OAAwCU,EAAxC,MAER0T,EAASgC,UACT/jB,EAAKgvC,UAAUqG,OAAOhnC,IATf,MAAAzH,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,MAjBXmkC,EAAM9U,IAAI0W,GAAkBS,kBAC5BrC,EAAM9U,IAAI0W,GAAkBW,kBAHuB9sC,EAFvD,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAAkzC,EAAA5I,GAAAtqC,OAAAmb,EAAA,EAAAnb,CAAAkzC,EAAA,EAAAtsC,IAAA,sBAAApH,MAAA,SAQ6Bo1B,GACzB,IAAM3U,EAAWnhB,KAAKouC,UAAU3sB,IAAIqU,GACpC,GAAgB,MAAZ3U,EAAkB,CACpB,IAAMuzB,EAAUR,GAAkBpe,EAAQ91B,KAAK2pC,MAAO3pC,KAAK4nB,MAE3D,OADA5nB,KAAKouC,UAAUjyB,IAAI2Z,EAAQ4e,GACpBA,EAEP,OAAOvzB,IAfb,CAAArZ,IAAA,SAAApH,MAAA,WAmCiB,IAAAuc,EAAAjd,KACbA,KAAKq0C,0BAA0Br0C,KAAK0N,OAAOinC,oBAE3CpJ,GAAkBU,aAClBjsC,KAAK0N,OAAOmoB,WAAWpT,QAAQ,SAACqT,GACb7Y,EAAK23B,oBAAoB9e,GACjCwY,WAEX/C,GAAkBY,aA3CtB,CAAArkC,IAAA,UAAApH,MAAA,WA8CI,MAAM,IAAI6e,MAAM,+BA9CpB60B,EAAA,CAAmC1K,ICV7BmL,cAWJ,SAAAA,EAAmCjtB,GAAiF,IAA9DktB,EAA8DlgC,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAlD,EAAUmgC,EAAwCngC,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAtByc,GAAkB,GAAInwB,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA60C,GAAA70C,KAAA4nB,OAAA5nB,KAAA80C,YAAA90C,KAAA+0C,kBAAA/0C,KAF5Gg1C,gBAA0B,oEAMhC,OAAOh1C,KAAK4nB,KAAK4K,MAAMrzB,KAAOa,KAAKg1C,gBAAkBh1C,KAAK+0C,kDAGlD,IAAA31C,EAAAY,KACAi1C,EAAqCJ,EAArCI,aAAcC,EAAuBL,EAAvBK,SAAUC,EAAaN,EAAbM,SAChCn1C,KAAKg1C,gBAAkBh1C,KAAK4nB,KAAK4K,MAAMrzB,KAGvC,IAAMi2C,EAAmBjiC,MAAMwrB,KAAK3+B,KAAK4nB,KAAK4K,MAAMsF,SACjDxwB,OAAO,SAACpC,GAAD,OAAOA,EAAE6tB,IAAIr0B,EAAI,MAAQwG,aAAay7B,MANxC0U,EAQuBr1C,KAAKs1C,UAAUF,GARtCG,EAAAr0C,OAAAC,EAAA,EAAAD,CAAAm0C,EAAA,GAQDG,EARCD,EAAA,GAQUE,EARVF,EAAA,GAWF5L,EAAQ,IAAI+L,SACZC,EAAgBP,EAAiBztC,IAAI,SAACsP,GAC1C,IAAMkK,EAAW+yB,GAAkBj9B,EAAG0yB,EAAOvqC,EAAKwoB,MAElD,OADAzG,EAASmtB,SACFntB,IAIH9Q,EAASrQ,KAAK41C,yBAAyB,CAACJ,EAAWC,IACjDt0B,EAAanhB,KAAK4nB,KAAlBzG,SACRA,EAAS00B,gBAAgBZ,GACzB9zB,EAAS20B,OAAM,GAAM,GAAM,GAC3B30B,EAAS2B,OAAO6mB,EAAOt5B,GACvB8Q,EAAS00B,gBAAgB,MAGzB10B,EAAS40B,uBACPd,EACA,EACA,EACAA,EAAa7sC,MACb6sC,EAAazmC,OACb0mC,GAOF,IAHA,IAAM54B,EAAU64B,EAAS54B,WAAW,MAC9By5B,EAAuB15B,EAAQ25B,gBAAgBd,EAAS/sC,MAAO+sC,EAAS3mC,QACxE0nC,EAAcF,EAAUG,KACrBtxC,EAAI,EAAGA,EAAIqwC,EAASt1C,OAAQiF,IACnCqxC,EAAYrxC,GAAKqwC,EAASrwC,GAE5ByX,EAAQ85B,aAAaJ,EAAW,EAAG,GAEnC,IAAMK,EAAcZ,EAAUl3C,EAAIi3C,EAAUj3C,EACtC+3C,EAAeb,EAAU/2C,EAAI82C,EAAU92C,EACvC63C,EAAe/0C,KAAKgR,IAAI6jC,EAAaC,GAErCE,EAAW7uC,GAAI0uC,EAAa,EAAGE,EAAc,EAAG,MAChDE,EAAY9uC,GAAI2uC,EAAc,EAAGC,EAAc,EAAG,MAClDG,EAAa,IAAIzkC,WACrB,IAAMukC,EAAW,EACjB,IAAMC,EAAY,GAGdE,EAAOh6B,SAAS/a,cAAc,UACpC+0C,EAAKvuC,MAAQ5G,KAAKwR,KAAKqjC,EAAcr2C,KAAK80C,WAC1C6B,EAAKnoC,OAAShN,KAAKwR,KAAKsjC,EAAet2C,KAAK80C,WACxB6B,EAAKp6B,WAAW,MACxBvD,UACVm8B,EACAuB,EAAWn4C,EACXm4C,EAAWh4C,EACX83C,EACAC,EACA,EACA,EACAE,EAAKvuC,MACLuuC,EAAKnoC,QAGP,IAAMooC,EAAM,IAAIpgC,MAOhB,OANAogC,EAAIj0C,IAAMg0C,EAAKE,YACfl6B,SAAS/M,KAAKwV,YAAYwxB,GAE1BjB,EAAclzB,QAAQ,SAACvd,GACrBA,EAAEie,YAEGwzB,oCAGCG,GACR,IAAMnjC,EAAM,IAAI1B,WACVO,EAAM,IAAIP,WACA,MAAZ6kC,EAAM,KACRnjC,EAAIw9B,KAAK2F,EAAM,GAAG/jB,KAClBvgB,EAAI2+B,KAAK2F,EAAM,GAAG/jB,MALuB,IAAAztB,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAO3C,QAAAoF,EAAAC,EAAgBoxC,EAAhBnxC,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAuB,KAAZJ,EAAYO,EAAA/E,MACrBiT,EAAIA,IAAIzO,EAAE6tB,KACVvgB,EAAIA,IAAItN,EAAE6tB,MAT+B,MAAA/sB,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAc3C,OAFAmO,EAAIojC,UAAU,IACdvkC,EAAIwkC,UAAU,IACP,CAACrjC,EAAKnB,uDAGkD,IAAAlK,EAAApH,OAAAC,EAAA,EAAAD,CAAAT,EAAA,GAA/BkT,EAA+BrL,EAAA,GAA1BkK,EAA0BlK,EAAA,GACzD2uC,EAAStjC,EAAImmB,QAAQ9S,KAAKxU,EAAK,IAE/BpK,EAAQoK,EAAIjU,EAAIoV,EAAIpV,EACpBiQ,EAASgE,EAAI9T,EAAIiV,EAAIjV,EAIrBw4C,EAAY11C,KAAKgR,IAAIpK,EAAOoG,GAQlC,OAPe,IAAI2oC,sBACjBF,EAAO14C,EAAI24C,EAAY,EACvBD,EAAO14C,EAAI24C,EAAY,EACvBD,EAAOv4C,EAAIw4C,EAAY,EACvBD,EAAOv4C,EAAIw4C,EAAY,GACtB,IACD,cApIArC,GACGI,aAAe,IAAImC,qBAAkB,KAAM,MAD9CvC,GAEGK,SAAW,IAAImC,WAAWxC,GAAiBI,aAAa7sC,MAAQysC,GAAiBI,aAAazmC,OAAS,GAF1GqmC,GAGGM,SAAY,WACjB,IAAMl+B,EAAI0F,SAAS/a,cAAc,UAGjC,OAFAqV,EAAE7O,MAAQysC,GAAiBI,aAAa7sC,MACxC6O,EAAEzI,OAASqmC,GAAiBI,aAAazmC,OAClCyI,EAJU,GAsIN49B,UCpJFyC,GAA2C,CACtDC,KAAM,CACJzsC,KAAM,OACNke,MAAO,EACPD,MAAO,GAETyuB,KAAM,CACJ1sC,KAAM,OACNke,MAAO,EACPD,MAAO,GAET0uB,MAAO,CACL3sC,KAAM,SACNke,MAAO,EACPD,MAAO,IAIE2uB,GAA+C,CAC1DC,KAAM,CACJ7sC,KAAM,OACN4qB,IAAKzF,GAAWG,GAElBwnB,KAAM,CACJ9sC,KAAM,OACN4qB,IAAKzF,GAAWD,GAElB6nB,KAAM,CACJ/sC,KAAM,OACN4qB,IAAKzF,GAAW7sB,GAElB00C,KAAM,CACJhtC,KAAM,OACN4qB,IAAKzF,GAAWxiB,IAIPsqC,GAAwC,CACnDC,OAAQ,EACRC,OAAQ,EACRC,OAAQ,EACRC,OAAQ,EACRC,OAAQ,GCtCGC,IDyCYn3C,OAAOsC,KAAKk0C,IAAe/vC,IAAI,SAACG,GAAD,OAAS4vC,GAAc5vC,KCzC/E,SAAA6R,GAAA,SAAA0+B,IAAA,OAAAn3C,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAq4C,GAAAn3C,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAm3C,GAAAtjC,MAAA/U,KAAA4U,YAAA,OAAA1T,OAAAkb,EAAA,EAAAlb,CAAAm3C,EAAA1+B,GAAAzY,OAAAmb,EAAA,EAAAnb,CAAAm3C,EAAA,EAAAvwC,IAAA,SAAApH,MAAA,WACW,IAAAtB,EAAAY,KACP,OACE+iB,EAAA,qBAAK7gB,UAAU,qBACb6gB,EAAA,qBAAK7gB,UAAU,+BACb6gB,EAAA,qBAAK7gB,UAAU,MAAMiF,QAAS,kBAAM/H,EAAK4C,MAAM2vC,SAA/C,cAGA5uB,EAAA,gCACAA,EAAA,qBAAK7gB,UAAU,cAAciF,QAAS,kBAAM/H,EAAK4C,MAAM2vC,SAAvD,QAGA5uB,EAAA,uBACEA,EAAA,wBACEA,EAAA,kGACAA,EAAA,wFACAA,EAAA,qHACAA,EAAA,wBACEA,EAAA,2FAEFA,EAAA,sFACAA,EAAA,+CACAA,EAAA,yHACAA,EAAA,oFACAA,EAAA,0FACAA,EAAA,gEAGJA,EAAA,+BACAA,EAAA,4CACqB0I,GAAOD,aAD5B,iMAKAzI,EAAA,gDACAA,EAAA,iLAE+C0I,GAAOR,aAFtD,kDAGOQ,GAAON,sBAHd,WAKApI,EAAA,+CACAA,EAAA,qeAOAA,EAAA,iCACAA,EAAA,gKAEkC,EAAI0I,GAAOV,oBAAoBqlB,QAAQ,GAFzE,0HAKArtB,EAAA,iCACAA,EAAA,+NAIAA,EAAA,oCACAA,EAAA,sXAMAA,EAAA,iCACAA,EAAA,+KAE+C0I,GAAOnB,cAFtD,WAIAvH,EAAA,kCACAA,EAAA,qHAC8F,IAC3F0I,GAAOlB,wBAFV,eAIAxH,EAAA,iCACAA,EAAA,2PAKAA,EAAA,kCACAA,EAAA,6MAE8E,KAC1E,EAAI0I,GAAOhB,kBAAkB2lB,QAAQ,GAHzC,yNAOArtB,EAAA,qCACAA,EAAA,qKAIAA,EAAA,qCACAA,EAAA,qOAIC/iB,KAAKs4C,mBApGhB,CAAAxwC,IAAA,eAAApH,MAAA,WA0GI,OACEqiB,EAAA,cAAAA,EAAA,cACEA,EAAA,uCACAA,EAAA,gCACS,IACPA,EAAA,mBAAGw1B,KAAK,sCAAsC7qC,OAAO,SAAS8qC,IAAI,uBAAlE,+BAIFz1B,EAAA,wDACiC,IAC/BA,EAAA,mBAAGw1B,KAAK,uCAAuC7qC,OAAO,SAAS8qC,IAAI,uBAAnE,yBAEK,IAJP,IAKGz1B,EAAA,mBAAGw1B,KAAK,mDAAR,gBALH,KAOAx1B,EAAA,uCACgB,IACdA,EAAA,mBAAGw1B,KAAK,qCAAqC7qC,OAAO,SAAS8qC,IAAI,uBAAjE,oBAIFz1B,EAAA,4CACqB,IACnBA,EAAA,mBAAGw1B,KAAK,mBAAmB7qC,OAAO,SAAS8qC,IAAI,uBAA/C,qBAIFz1B,EAAA,qCACc,IACZA,EAAA,mBAAGw1B,KAAK,0EAAR,6BAxIVF,EAAA,CAAkCh6C,kBCCrBo6C,GAAb,SAAA9+B,GAAA,SAAA8+B,IAAA,IAAA90B,EAAAvkB,EAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAy4C,GAAA,QAAA50B,EAAAjP,UAAAhV,OAAAkkB,EAAA,IAAA3Q,MAAA0Q,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAAD,EAAAC,GAAAnP,UAAAmP,GAAA,OAAA3kB,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,MAAA2jB,EAAAziB,OAAA2Y,EAAA,EAAA3Y,CAAAu3C,IAAA3+B,KAAA/E,MAAA4O,EAAA,CAAA3jB,MAAA+M,OAAA+W,MACE40B,WAAa,WACXt5C,EAAK4C,MAAM4lB,KAAK+wB,kBAAmB,GAFvCv5C,EAAA,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAAu3C,EAAA9+B,GAAAzY,OAAAmb,EAAA,EAAAnb,CAAAu3C,EAAA,EAAA3wC,IAAA,SAAApH,MAAA,WAKI,OAAIV,KAAKgC,MAAM4lB,KAAK+wB,iBACX51B,EAAA,cAAC61B,GAAD,CAAcjH,KAAM3xC,KAAK04C,aAEzB,SARbD,EAAA,CAA+Bp6C,iBCMlBw6C,WAAb,SAAAC,GAAA,SAAAD,IAAA,OAAA33C,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA64C,GAAA33C,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA23C,GAAA9jC,MAAA/U,KAAA4U,YAAA,OAAA1T,OAAAkb,EAAA,EAAAlb,CAAA23C,EAAAC,GAAA53C,OAAAmb,EAAA,EAAAnb,CAAA23C,EAAA,EAAA/wC,IAAA,SAAApH,MAAA,WACkB,IACNgR,EAAS1R,KAAKgC,MAAd0P,KACR,OAAKA,EAIHqR,EAAA,qBAAK7gB,UAAU,cACZlC,KAAK+4C,SAASrnC,GACd1R,KAAKg5C,cAActnC,GACnB1R,KAAKi5C,SAASvnC,GACd1R,KAAKk5C,gBAAgBxnC,GACrB1R,KAAKm5C,SAASznC,GACd1R,KAAKo5C,SAAS1nC,GACd1R,KAAKq5C,QAAQ3nC,GACb1R,KAAKs5C,aAAa5nC,IAXd,OAJb,CAAA5J,IAAA,WAAApH,MAAA,SAmBmBgR,GACf,OAAOA,aAAgB+wB,GACrB1f,EAAA,qBAAK7gB,UAAU,aACb6gB,EAAA,yBAAMrR,EAAKsxB,YAAX,qBACAjgB,EAAA,yBAAMrR,EAAKurB,SAASmT,QAAQ,GAA5B,kCAGA,OA1BR,CAAAtoC,IAAA,WAAApH,MAAA,SA4BmBgR,GACf,OAAOA,aAAgByvB,GACrBpe,EAAA,qBAAK7gB,UAAU,aACb6gB,EAAA,yBAAMrR,EAAKmwB,mBAAX,oBACA9e,EAAA,0BAAO,GAAKrR,EAAKgwB,aAAejW,GAAOhB,mBAAmB2lB,QAAQ,GAAlE,wBACArtB,EAAA,0BAAO,EAAIrR,EAAK+vB,mBAAmB2O,QAAQ,GAA3C,sBAEA,OAnCR,CAAAtoC,IAAA,UAAApH,MAAA,SAqCkBgR,GACd,GAAIA,aAAgBuhB,GAClB,OACElQ,EAAA,qBAAK7gB,UAAU,YACb6gB,EAAA,0CAA4B,IAAlBrR,EAAKulB,YAAkBmZ,QAAQ,GAAzC,KACArtB,EAAA,0CAAuB,IAAbrR,EAAK2wB,OAAa+N,QAAQ,GAApC,QA1CV,CAAAtoC,IAAA,eAAApH,MAAA,SAgDuBgR,GACnB,GAAIA,aAAgBorB,GAClB,OACE/Z,EAAA,qBAAK7gB,UAAU,iBACb6gB,EAAA,yBAAMrR,EAAKsrB,cAAX,uBApDV,CAAAl1B,IAAA,WAAApH,MAAA,SA0DmBgR,GACf,IAAM6nC,EAAanhB,GAAU1mB,GAC3BqR,EAAA,sBAAM7gB,UAAU,eAAhB,gBAAmCwP,EAAK2mB,OAAS5M,GAAOnB,cAAiB,KAAK8lB,QAAQ,GAAtF,KACE,KACJ,OACErtB,EAAA,qBAAK7gB,UAAU,aACb6gB,EAAA,qBAAK7gB,UAAU,kBAAmBwP,EAAKijB,YAAkClwB,aACxEzE,KAAKw5C,gBAAgB9nC,GACrB6nC,KAlET,CAAAzxC,IAAA,kBAAApH,MAAA,SAuE0BgR,GACtB,SAAS+nC,EAATh5C,GAA0E,IAAAi5C,EAAAj5C,EAA3D2B,aAA2D,IAAAs3C,EAAnD,QAAmDA,EAAAC,EAAAl5C,EAA1C4N,YAA0C,IAAAsrC,EAAnC,EAAmCA,EAAAvnC,EAAA3R,EAAb2H,aAAa,IAAAgK,EAAL,EAAKA,EACxE,OACE2Q,EAAA,qBAAK5U,MAAO,CACVrF,SAAU,WACVyF,KAAM,EACNF,OACAjG,MAAO,EACPwxC,OAAQ,EACRC,YAAW,GAAA9sC,OAAK3E,EAAL,aAAA2E,OAAsB3K,MAIvC,SAAS03C,EAATxxC,GAA8J,IAA9IjG,EAA8IiG,EAA9IjG,SAA8I03C,EAAAzxC,EAApI0xC,kBAAoI,IAAAD,EAAvH,SAAuHA,EAA7G1rC,EAA6G/F,EAA7G+F,KAC/C,OACE0U,EAAA,qBAAK5U,MAAO,CACVrF,SAAU,WACVuF,OACAjG,MAAK,GAAA2E,OAAM,GAAN,KACL2K,UAAW,SACXzB,SAAU,GACV+jC,WAAYA,EACZC,WAAY,UACV53C,GAGR,OACE0gB,EAAA,qBAAK7gB,UAAU,yBAEb6gB,EAAA,qBAAK5U,MAAO,CAAE/F,MAAO,IAAKoG,OAAQ,SAAU0rC,OAAQ,iBAAkBpxC,SAAU,aAC9Eia,EAAA,cAAC02B,EAAD,CAAKprC,KAAI,GAAAtB,OAAK,GAAL,KAAwB3K,MAAM,cACvC2gB,EAAA,cAAC+2B,EAAD,CAAMzrC,KAAM,EAAG2rC,WAAYtoC,EAAKisB,cAAgB1R,GAAYgO,KAAO,OAAS,UAAWhO,GAAYgO,MACnGlX,EAAA,cAAC02B,EAAD,CAAKprC,KAAI,GAAAtB,OAAK,GAAL,KAAwB3K,MAAM,WACvC2gB,EAAA,cAAC+2B,EAAD,CAAMzrC,KAAI,GAAAtB,OAAK,GAAL,KAAwBitC,WAAYtoC,EAAKisB,cAAgB1R,GAAYiO,KAAO,OAAS,UAAWjO,GAAYiO,MACtHnX,EAAA,cAAC+2B,EAAD,CAAMzrC,KAAI,GAAAtB,OAAK,GAAL,KAAwBitC,WAAYtoC,EAAKisB,cAAgB1R,GAAYkO,IAAM,OAAS,UAAWlO,GAAYkO,KACrHpX,EAAA,cAAC02B,EAAD,CAAKprC,KAAI,GAAAtB,OAAK2E,EAAKqmB,iBAAmB,IAAM,IAAnC,KAA2C31B,MAAM,QAAQgG,MAAO,IACzE2a,EAAA,qBAAK5U,MAAO,CACVrF,SAAU,WACVuF,KAAI,GAAAtB,OAAK2E,EAAKqmB,iBAAmB,IAAM,IAAnC,KACJjpB,UAAW,mBACXP,IAAK,SACLmJ,UAAW,SACXzB,SAAU,GACV+jC,WAAY,OACZC,WAAY,UACVvoC,EAAKqmB,iBAAiBqY,QAAQ,GATlC,cA3GV,CAAAtoC,IAAA,gBAAApH,MAAA,SA0HwBgR,GACpB,GAAIsY,GAAatY,GAAO,CACtB,IAAMyoC,EACJzoC,EAAKwY,UAAUnB,MAAQ,EACrBhG,EAAA,qBAAK7gB,UAAU,uBAAf,gBAAyCwP,EAAKwY,UAAUnB,MAAMqnB,QAAQ,IACpE,KACAgK,EACJ1oC,EAAKwY,UAAUlB,MAAQ,EACrBjG,EAAA,qBAAK7gB,UAAU,uBAAf,SAA4CwP,EAAKwY,UAAUlB,MAAMonB,QAAQ,IACvE,KACN,OACErtB,EAAA,qBAAK7gB,UAAU,kBACZi4C,EACAC,MAvIX,CAAAtyC,IAAA,WAAApH,MAAA,SA4ImBgR,GACf,GAAIA,aAAgB+gB,GAClB,OACE1P,EAAA,cAAAA,EAAA,cACiB,IAAdrR,EAAK2sB,OAAe,EAAItb,EAAA,qBAAK7gB,UAAU,cAA4B,IAAdwP,EAAK2sB,QAAc+R,QAAQ,GAAxD,WAA2E,KACnGpwC,KAAKq6C,YAAY3oC,MAjJ5B,CAAA5J,IAAA,cAAApH,MAAA,SAuJsBuzB,GAAY,IACtB+J,EAAY/J,EAAZ+J,QACR,GAAIA,EAAQp+B,OAAS,EAAG,CACtB,IAAM06C,EAActc,EAAQr2B,IAAI,SAAC8F,GAC/B,IAAMlG,EAAQkG,EAAEknB,YAAwClwB,YACxD,OAAIgJ,aAAayvB,GACf,GAAAnwB,QAA6B,IAAlBU,EAAEgwB,eAAqB2S,QAAQ,GAA1C,MAAArjC,OAAiDxF,GAE1CA,IAERyB,KAAK,MACR,OACE+Z,EAAA,qBAAK7gB,UAAU,aACZo4C,GAIL,OAAO,OAxKb,CAAAxyC,IAAA,kBAAApH,MAAA,SA4K0BgR,GACtB,GAAIA,aAAgBivB,GAClB,OACE5d,EAAA,qBAAK7gB,UAAU,sBACX,IAAOwP,EAAKqvB,cAAgBrvB,EAAKsvB,YAAe,KAAKoP,QAAQ,GADjE,gBA/KRyI,EAAA,CAAiCx6C,qBC4BjC,SAASk8C,GAATjyC,GAAiG,IAA1EwC,EAA0ExC,EAA1EwC,KAAM0vC,EAAoElyC,EAApEkyC,OAAQC,EAA4DnyC,EAA5DmyC,WAAYtzC,EAAgDmB,EAAhDnB,QAASqhC,EAAuClgC,EAAvCkgC,kBAClDr6B,EAA6B9P,UAAc,WAC/C,IAAM0rC,EAAWiF,KAAkBvtB,IAAI3W,GACjCo+B,EAAQa,EAASpiC,IAAKuhC,MACtB9mC,EAAQ2nC,EAAS3nC,MAAMs4C,WACvBC,EACS,MAATzR,EACEA,aAAiB0R,mBAAqBpS,EACjCU,EAAM2N,YACJ3N,aAAiB1yB,MACnB0yB,EAAMvmC,IAEN,GAGF,GAIX,MAAO,CACLk4C,gBAFmB,OAAA9tC,OAAU4tC,EAAV,uBAAA5tC,OAAmC3K,EAAnC,MAAA2K,OAA6C3K,EAA7C,OAIpB,CAAComC,EAAmB19B,IACvB,OACEiY,EAAA,qBAAK7gB,UAAWC,IAAW,gBAAiB,CAAE24C,SAAUL,KACtD13B,EAAA,qBAAK7gB,UAAU,qBAAqBiF,QAASA,EAASgH,MAAOA,GAC1DrD,EAAKrG,aAERse,EAAA,cAACg4B,GAAD,CAAcP,OAAQA,EAAQrzC,QAASA,KAe7C,SAAS4zC,GAATpgB,GAA4E,IAApD6f,EAAoD7f,EAApD6f,OAAQrzC,EAA4CwzB,EAA5CxzB,QAAY8G,EAAgC/M,OAAAuB,EAAA,EAAAvB,CAAAy5B,EAAA,sBAK1E,OACE5X,EAAA,oBAAA7hB,OAAAe,OAAA,CAAKC,UAAU,sCAAsCiF,QALnC,SAACsG,GACnBtG,GAAWA,EAAQsG,GAZvB,SAA2BA,GACzBA,EAAEyR,iBACavC,SAASq+B,qBAAqB,UAAU,GAChDC,QAULC,CAAkBztC,KAG6DQ,GAC7E8U,EAAA,sBAAM7gB,UAAU,0BAA0Bs4C,IAKjCW,OAjFf,SAAA16C,GAA+D,IAA5C26C,EAA4C36C,EAA5C26C,IAAKrd,EAAuCt9B,EAAvCs9B,MAAOsd,EAAgC56C,EAAhC46C,eAC7B,OACEt4B,EAAA,qBAAK7gB,UAAU,YACZk5C,EAAIzzC,IAAI,SAAC0/B,EAAUxiC,GAAX,OACPke,EAAA,cAACw3B,GAAD,CACEzyC,IAAKjD,EACL21C,OAAQc,OAAOz2C,EAAI,GACnBiG,KAAMu8B,EACNoT,WAAY1c,IAAUl5B,EACtBsC,QAAS,kBAAMk0C,EAAex2C,IAC9B2jC,kBAAmBA,uBCrBd,SAAS+S,GAAT96C,GAA6E,IAAnDtB,EAAmDsB,EAAnDtB,KAAM+xB,EAA6CzwB,EAA7CywB,OACvCsqB,EAAkBr8C,EAAOiyB,GAC/B,OAAQrO,EAAA,qBAAK7gB,UAAU,mBACrB6gB,EAAA,qBAAK7gB,UAAU,aACb6gB,EAAA,qBAAK7gB,UAAU,cACf6gB,EAAA,qBAAK7gB,UAAU,OACb6gB,EAAA,cAAC04B,GAAD,CAAW3nB,QAAS,MACpB/Q,EAAA,cAAC04B,GAAD,CAAW3nB,QAAS,KACpB/Q,EAAA,cAAC04B,GAAD,CAAW3nB,QAAS,MACpB/Q,EAAA,cAAC24B,GAAD,CAAY5nB,QAAS0nB,KAEvBz4B,EAAA,qBAAK7gB,UAAU,eAEjB6gB,EAAA,qBAAK7gB,UAAU,kBACZ+uB,GAAcC,KAKrB,SAASuqB,GAATnzC,GAAsD,IAAjCwrB,EAAiCxrB,EAAjCwrB,QACb3lB,EAAQ,CACZE,KAAI,GAAAtB,QAAgB,IAAV+mB,GAAesc,QAAQ,GAA7B,MAEN,OAAOrtB,EAAA,qBAAK7gB,UAAU,aAAaiM,MAAOA,IAG5C,SAASutC,GAAT/gB,GAAuD,IAAjC7G,EAAiC6G,EAAjC7G,QACd3lB,EAAQ,CACZE,KAAI,GAAAtB,QAAgB,IAAV+mB,GAAesc,QAAQ,GAA7B,MAEN,OAAOrtB,EAAA,qBAAK7gB,UAAU,cAAciM,MAAOA,ICbtC,IAAMwtC,GAAb,SAAA7C,GAAA,SAAA6C,IAAA,IAAAh4B,EAAAvkB,EAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA27C,GAAA,QAAA93B,EAAAjP,UAAAhV,OAAAkkB,EAAA,IAAA3Q,MAAA0Q,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAAD,EAAAC,GAAAnP,UAAAmP,GAAA,OAAA3kB,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,MAAA2jB,EAAAziB,OAAA2Y,EAAA,EAAA3Y,CAAAy6C,IAAA7hC,KAAA/E,MAAA4O,EAAA,CAAA3jB,MAAA+M,OAAA+W,MACEzJ,MAAkB,CAChBuhC,iBAAiB,GAFrBx8C,EAAA,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAAy6C,EAAA7C,GAAA53C,OAAAmb,EAAA,EAAAnb,CAAAy6C,EAAA,EAAA7zC,IAAA,qBAAApH,MAAA,WAsBI,OAAgC,MAAzBV,KAAK4nB,KAAKi0B,aAA6B77C,KAAK4nB,KAAKi0B,YAAYC,eAtBxE,CAAAh0C,IAAA,SAAApH,MAAA,WAyBkB,IAAAuc,EAAAjd,KACR+7C,EAAU/7C,KAAKkqB,UAAU6xB,UACzBC,EAAYj5B,EAAA,qBAAK7gB,UAAS,uBAAA6K,OAAyBgvC,EAAU,YAAc,KAA/D,SAClB,OACEh5B,EAAA,cAAAA,EAAA,cACEA,EAAA,cAACk5B,GAAD,CAAgB98C,KAAMa,KAAKwyB,MAAMrzB,KAAM+xB,OAAQlxB,KAAKwyB,MAAMtB,SACzDlxB,KAAKk8C,oBACNn5B,EAAA,qBAAK7gB,UAAWgkB,IAAW,iBAAkB,CAAEN,QAAQ,KACpDo2B,EACDj5B,EAAA,qBAAK7gB,UAAU,4BACZlC,KAAKm8C,qBACLn8C,KAAKo8C,mBAERr5B,EAAA,cAACs5B,GAAD,CACEjB,IAAKp7C,KAAK4nB,KAAK00B,QACfve,MAAO/9B,KAAK4nB,KAAK20B,aACjBlB,eAAgB,SAACx2C,GAAD,OAAOoY,EAAK2K,KAAK40B,gBAAgB33C,UAzC7D,CAAAiD,IAAA,oBAAApH,MAAA,WAiDI,GAAIV,KAAKqa,MAAMuhC,kBrDiCWv2C,EqDjCsBrF,KAAKwyB,MAAMntB,OrDkCtD9B,EAAYkJ,KAAK,SAAClF,GAAD,OAA2B,IAAjBlC,EAAOkC,MqDjCrC,OACEwb,EAAA,qBAAK7gB,UAAU,mBACb6gB,EAAA,cAACna,EAAD,CAAcvD,OAAQrF,KAAKwyB,MAAMntB,UrD8BpC,IAAuBA,IqDlF9B,CAAAyC,IAAA,kBAAApH,MAAA,WA2DI,OACEqiB,EAAA,qBAAK7gB,UAAU,4BACb6gB,EAAA,sBAAM7gB,UAAU,wBAAuB6gB,EAAA,cAAC9f,EAAD,CAAerC,MAAO,GAAKF,MAAOV,KAAKkqB,UAAUnB,QAAxF,UADF,OAGEhG,EAAA,sBAAM7gB,UAAU,wBAAuB6gB,EAAA,cAAC9f,EAAD,CAAerC,MAAO,GAAKF,MAAOV,KAAKkqB,UAAUlB,QAAxF,aA/DR,CAAAlhB,IAAA,qBAAApH,MAAA,WAqEI,IAAM+7C,EAAez8C,KAAKkqB,UAAUnB,MAAQ0C,GAAOD,aAC7CkxB,EAAe18C,KAAKkqB,UAAUlB,MAAQyC,GAAOD,aAC7CmxB,EAAe,GAAK38C,KAAKkqB,UAAUnB,MAAQ/oB,KAAKkqB,UAAUlB,OAASyC,GAAOD,aAC1EoxB,EAAmC,CACvCx0C,MAAK,GAAA2E,OAAoB,IAAf0vC,EAAL,MAEDI,EAAmC,CACvCz0C,MAAK,GAAA2E,OAAoB,IAAf2vC,EAAL,MAEDI,EAAmC,CACvC10C,MAAK,GAAA2E,OAAoB,IAAf4vC,EAAL,MASP,OANE55B,EAAA,qBAAK7gB,UAAU,sBACb6gB,EAAA,qBAAK5U,MAAOyuC,EAAa16C,UAAU,6BACnC6gB,EAAA,qBAAK5U,MAAO0uC,EAAa36C,UAAU,6BACnC6gB,EAAA,qBAAK5U,MAAO2uC,EAAa56C,UAAU,gCArF3C,CAAA4F,IAAA,OAAA2Z,IAAA,WAMI,OAAOzhB,KAAKgC,MAAM4lB,OANtB,CAAA9f,IAAA,QAAA2Z,IAAA,WAUI,OAAOzhB,KAAK4nB,KAAK4K,QAVrB,CAAA1qB,IAAA,SAAA2Z,IAAA,WAcI,OAAOzhB,KAAKwyB,MAAMf,SAdtB,CAAA3pB,IAAA,YAAA2Z,IAAA,WAkBI,OAAOzhB,KAAKyxB,OAAOvH,cAlBvByxB,EAAA,CAAyBt9C,sBCCZ0+C,GAAY,WACvB,IAAMC,EAAa,IAAIzwB,GACjB0wB,EAAY,IAAI1wB,GAChB2wB,EAAc,IAAI3wB,GAiDxB,MA/CiC,CAC/B8J,QAAS,CACPC,qBAAsB,IACtBC,aAAc,GACdG,gBAAiB,GAEnB8F,gBAAiB,KACjBC,kBAAmB,GACnBb,SAAU,MACVQ,oBAAqB,KACrBnjB,KAAM,CACJ,SAAC8Z,EAAKP,GAAU,IACNj0B,EAASw0B,EAATx0B,EAAGG,EAAMq0B,EAANr0B,EACLy+C,EACJ3qB,EAAMhkB,OAAS,EAAK,GAAK0uC,EAAYE,QAAQ,EAAG7+C,EAAI,GAAK,GAAM,EAAI,GAAK2+C,EAAYE,QAAQ,GAAI7+C,EAAI,GAAK,IACrG8+C,EAAgB11C,GAAIjJ,EAAI8zB,EAAMhkB,OAAS,EAAG,EAAGgkB,EAAMhkB,OAAS,GAAI,GAAK,IACrE8uC,EAASL,EAAUpvB,SAAStvB,EAAI,EAAGG,EAAI,GAAK2+C,EAClD,GAAI3+C,EAAIy+C,EAAW,CACjB,GAAIG,EAEF,OADa,IAAIhqB,GAAKP,EAAKP,GAG3B,IAAM+qB,EAAe/7C,KAAKoF,IAAIe,GAAIjJ,EAAI8zB,EAAMhkB,OAAS,EAAG,EAAGgkB,EAAMhkB,OAAS,EAAG,GAAK,GAAI,GAGhFgvC,EAAeR,EAAWnvB,SAFV,GAEmBtvB,EAFnB,GAEsCG,GAAqB,GAC3EqqB,EAAQvnB,KAAK0P,MACjB1P,KAAKgR,IACH,EACAhR,KAAKmS,IAEH,GACA6pC,EAAe,GAAM,GAAKD,EAAe,KAI/C,GAAIA,EAAeC,EAAe,EAAI/xB,GAAOL,uBAAwB,CACnE,IAAMqyB,EAAkBj8C,KAAKmS,IAAI4pC,EAAeC,EAAc,GAC9D,OAAO,IAAI1gB,GAAS/J,EAAKhK,EAAOyJ,EAAOhxB,KAAK0P,MAAMua,GAAON,sBAAwBsyB,IAEjF,OAAO,IAAIlqB,GAAKR,EAAKhK,EAAOyJ,QAU7BkrB,GAAS,WACpB,IAAMR,EAAc,IAAI3wB,GAClB0wB,EAAY,IAAI1wB,GA8BtB,MA5BuB,CACrB8J,QAAS,CACPE,aAAc,IACdD,qBAAsB,KACtBI,gBAAiB,GAEnB8F,gBAAiB,KACjBC,kBAAmB,GACnBL,oBAAqB,IACrBR,SAAU,IACV3iB,KAAM,CACJ,SAAC8Z,EAAKP,GAAU,IACNj0B,EAASw0B,EAATx0B,EAAGG,EAAMq0B,EAANr0B,EACLy+C,EACJ3qB,EAAMhkB,OAAS,EAAK,GAAK0uC,EAAYE,QAAQ,EAAG7+C,EAAI,IAAM,GAAM,EAAI,EAAI2+C,EAAYE,QAAQ,GAAI7+C,EAAI,IAAM,IAEtG8+C,EAAgB11C,GAAIjJ,EAAG8zB,EAAMhkB,OAAS,EAAGgkB,EAAMhkB,QAAS,IAAM,IAC9D8uC,EAASL,EAAUpvB,SAAStvB,EAAI,EAAGG,EAAI,GAAK2+C,EAClD,GAAI3+C,EAAIy+C,EAAW,CACjB,GAAIG,EACF,OAAO,IAAIhqB,GAAKP,EAAKP,GAEvB,IAAMzJ,EAAQvnB,KAAKkmB,MAAMlmB,KAAKgR,IAAI,EAAG7K,GAAIjJ,EAAkB,IAAf8zB,EAAMhkB,OAAegkB,EAAMhkB,OAAQ,EAAG,KAClF,OAAO,IAAI+kB,GAAKR,EAAKhK,EAAOyJ,QAQzBmrB,GAAQ,WACnB,IAAMV,EAAY,IAAI1wB,GAChB2wB,EAAc,IAAI3wB,GAiCxB,MA/BuB,CACrB8J,QAAS,CACPC,qBAAsB,KACtBC,aAAc,IACdG,gBAAiB,GAEnB0F,oBAAqB,GACrBK,kBAAmB,GACnBD,gBAAiB,KACjBZ,SAAU,EACV3iB,KAAM,CACJ,SAAC8Z,EAAKP,GAAU,IACNj0B,EAASw0B,EAATx0B,EAAGG,EAAMq0B,EAANr0B,EACLy+C,EACW,IAAf3qB,EAAMhkB,OACL,GAAK0uC,EAAYE,QAAQ,EAAG7+C,EAAI,GAAK,GAAM,EAC5C,GAAK2+C,EAAYE,QAAQ,GAAI7+C,EAAI,GAAK,IACtCoJ,GAAIpJ,EAAG,EAAGi0B,EAAMpqB,MAAO,IAAK,IAGxBi1C,EADJ3+C,EAAK,GAAKw+C,EAAYE,QAAQ,EAAG7+C,EAAI,IAAM,GAAM,EAAI,GAAK2+C,EAAYE,QAAQ,GAAI7+C,EAAI,IAAM,IAC7C,GAAfi0B,EAAMhkB,QAAgB,GAAK,IAE7D,OADeyuC,EAAUpvB,SAAStvB,EAAI,GAAIG,EAAI,IAAM2+C,EAErC,IAAI/pB,GAAKP,EAAKP,GAElB9zB,EAAIy+C,EACN,IAAI5pB,GAAKR,EAAK,EAAGP,QADnB,MASForB,GAAmB,CAC9Bb,aACAW,UACAC,UCnJWE,ICDkBx/C,YDC/B,SAAAsb,GAAA,SAAAkkC,IAAA,OAAA38C,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA69C,GAAA38C,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA28C,GAAA9oC,MAAA/U,KAAA4U,YAAA,OAAA1T,OAAAkb,EAAA,EAAAlb,CAAA28C,EAAAlkC,GAAAzY,OAAAmb,EAAA,EAAAnb,CAAA28C,EAAA,EAAA/1C,IAAA,SAAApH,MAAA,WAYI,OAAO,OAZX,CAAAoH,IAAA,oBAAApH,MAAA,WAgBIV,KAAKgC,MAAMsI,OAAOuqB,IAAI70B,KAAKgC,MAAMmyC,UAhBrC,CAAArsC,IAAA,uBAAApH,MAAA,WAoBIV,KAAKgC,MAAMsI,OAAOkb,OAAOxlB,KAAKgC,MAAMmyC,YApBxC0J,EAAA,CAAiCx/C,kBEJpBy/C,GAAb,SAAAhF,GAAA,SAAAgF,IAAA,IAAAn6B,EAAAvkB,EAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA89C,GAAA,QAAAj6B,EAAAjP,UAAAhV,OAAAkkB,EAAA,IAAA3Q,MAAA0Q,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAAD,EAAAC,GAAAnP,UAAAmP,GAAA,OAAA3kB,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,MAAA2jB,EAAAziB,OAAA2Y,EAAA,EAAA3Y,CAAA48C,IAAAhkC,KAAA/E,MAAA4O,EAAA,CAAA3jB,MAAA+M,OAAA+W,MAGUi6B,WAHV,EAAA3+C,EAIU+iB,QAAU,SAAChjB,GACjBC,EAAK4C,MAAML,EAAExC,EAAO,MALxBC,EAAA,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAA48C,EAAAhF,GAAA53C,OAAAmb,EAAA,EAAAnb,CAAA48C,EAAA,EAAAh2C,IAAA,SAAApH,MAAA,WAQI,OAAO,OARX,CAAAoH,IAAA,oBAAApH,MAAA,WAWIV,KAAK+9C,MAAQj/C,EAAOyC,aAAavB,KAAKmiB,WAX1C,CAAAra,IAAA,uBAAApH,MAAA,WAcQV,KAAK+9C,OACPj/C,EAAOe,gBAAgBG,KAAK+9C,WAflCD,EAAA,CAA6Bz/C,IAAM2/C,WCItBC,GAAiB5V,GAAK,WACjC,IAAMyB,EAAW,IAAInoB,uBAA0B,EAAG,GAC5Cu8B,EAAgB,IAAIv8B,iBAAoBmoB,EAAU,GAClDC,EAAW,IAAIpoB,qBAAwB,CAC3Cvf,MAAO,SACPipC,aAAa,EACbL,QAAS,MAELmT,EAAe,IAAIx8B,gBAAmBu8B,EAAenU,GAE3D,OADAoU,EAAar1C,SAASoF,EAAI,GACnBiwC,IAuBMC,8MAbLjK,OAAS8J,KAAiBnkB,gFACzB,IAAA7c,EAAAjd,KAGP,OAFAA,KAAKm0C,OAAOrrC,SAASvK,EAAIyB,KAAKgC,MAAMzD,EACpCyB,KAAKm0C,OAAOrrC,SAASpK,EAAIsB,KAAKgC,MAAMtD,EAElCqkB,EAAA,cAAAA,EAAA,cACEA,EAAA,cAACs7B,GAAD,CAAS18C,EAAG,SAACuD,GAAD,OAAO+X,EAAKk3B,OAAO5jC,MAAMwiC,UAA8B,IAApBvxC,KAAK4S,IAAQ,IAAJlP,GAAkB,QAC1E6d,EAAA,cAACu7B,GAAD,CAAanK,OAAQn0C,KAAKm0C,OAAQ7pC,OAAQtK,KAAKgC,MAAM2nC,gBARjCtrC,iBCpBfkgD,GAAkBlW,GAAK,WAClC,IAAMyB,EAAW,IAAInoB,wBAA2B,GAAK,IAC/CooB,EAAW,IAAIpoB,qBAAwB,CAC3Cvf,MAAO,SACPipC,aAAa,EACbL,QAAS,IACT+C,KAAMpsB,gBAEF+rB,EAAO,IAAI/rB,QAAWmoB,EAAUC,GAEtC,OADA2D,EAAK5kC,SAASoF,EAAI,GACXw/B,IA6BM8Q,8MAbLrK,OAASoK,KAAkBzkB,gFAIjC,OAFA95B,KAAKm0C,OAAOrrC,SAASvK,EAAIyB,KAAKgC,MAAMzD,EACpCyB,KAAKm0C,OAAOrrC,SAASpK,EAAIsB,KAAKgC,MAAMtD,EAElCqkB,EAAA,cAAAA,EAAA,cAEEA,EAAA,cAACu7B,GAAD,CAAanK,OAAQn0C,KAAKm0C,OAAQ7pC,OAAQtK,KAAKgC,MAAM2nC,gBARhCtrC,iBCnBhBogD,GAAb,SAAA3F,GAAA,SAAA2F,IAAA,OAAAv9C,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAy+C,GAAAv9C,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAu9C,GAAA1pC,MAAA/U,KAAA4U,YAAA,OAAA1T,OAAAkb,EAAA,EAAAlb,CAAAu9C,EAAA3F,GAAA53C,OAAAmb,EAAA,EAAAnb,CAAAu9C,EAAA,EAAA32C,IAAA,SAAApH,MAAA,WAIkB,IACNg+C,EAAoB1+C,KAAKgC,MAAM4lB,KAA/B82B,gBACFC,EAAsB3+C,KAAKgC,MAAM4lB,KAAKg3B,uBAC5C,OACE77B,EAAA,cAAAA,EAAA,cACEA,EAAA,cAAC87B,GAAD,CAAantC,KAAMgtC,IACnB37B,EAAA,cAAC+7B,GAAD,CAAgBvgD,EAAGogD,EAAoBpgD,EAAGG,EAAGigD,EAAoBjgD,EAAGirC,MAAO3pC,KAAK2pC,QAC/E3pC,KAAK++C,yBAAyBL,MAXvC,CAAA52C,IAAA,2BAAApH,MAAA,SAiBkCgR,GAC9B,GAAIA,EACF,OAAOqR,EAAA,cAACi8B,GAAD,CAAezgD,EAAGmT,EAAKqhB,IAAIx0B,EAAGG,EAAGgT,EAAKqhB,IAAIr0B,EAAGirC,MAAO3pC,KAAK2pC,UAnBtE,CAAA7hC,IAAA,QAAA2Z,IAAA,WAEI,OAAOzhB,KAAKgC,MAAM4lB,KAAK+hB,UAF3B8U,EAAA,CAA2BpgD,aCgBd4gD,GAAb,WACE,SAAAA,EAAmBr3B,EAAmBs3B,EAAkCC,GAA8Bj+C,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAi/C,GAAAj/C,KAAA4nB,OAAA5nB,KAAAk/C,aAAAl/C,KAAAm/C,WADxG,OAAAj+C,OAAAmb,EAAA,EAAAnb,CAAA+9C,EAAA,EAAAn3C,IAAA,SAAApH,MAAA,WAII,IAAM0+C,EAAgBp/C,KAAKk/C,aACrBztC,EAAgBzR,KAAK4nB,KAAKy3B,cAAcD,GAGxCjxC,EAA6B,CACjCE,KAHWoD,EAAclT,EAIzBgQ,IAHUkD,EAAc/S,GAK1B,OAAOqkB,EAAA,qBAAK5U,MAAOA,GAAQnO,KAAKm/C,gBAZpCF,EAAA,GAgBaK,GAAb,SAAAC,GA8EE,SAAAD,EACEn+B,EACA7E,EACAkjC,EACOC,GACP,IAAArgD,EAAA,OAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAs/C,IACAlgD,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAAo+C,GAAAxlC,KAAA9Z,KAAMmhB,EAAU7E,KADhBmjC,YAAArgD,EAjFcozB,WAiFd,EAAApzB,EAhFKuqC,MAAQ,IAAI+L,SAgFjBt2C,EA/EMiR,OAAS,IAAI8mC,sBAAmB,EAAG,EAAG,EAAG,GAAI,IAAK,KA+ExD/3C,EA9EKk9C,QAA+B,CAAC9oB,GAAQ2N,GAAMsB,GAAMmC,GAAWvQ,IA8EpEj1B,EA7EKm9C,aAAe,EA6EpBn9C,EA5EKy8C,YAAwC,KA4E7Cz8C,EA3EKwO,MAAQ,IAAI+T,WA2EjBviB,EA1EKsgD,WAAY,EA0EjBtgD,EAzEKugD,aAAe,EAyEpBvgD,EAxEKu5C,kBAAmB,EAwExBv5C,EAvEMwgD,qBAAsB,EAuE5BxgD,EAtEK6wC,cAAgB,IAAItuB,iBAsEzBviB,EArEMygD,OAAS,IAAIC,IAqEnB1gD,EApEKs/C,qBAoEL,EAAAt/C,EAlEKkiB,OAAS,CACdhB,YAAa,SAAChQ,GAEZ,OADAA,EAAM4O,kBACC,GAETwB,UAAW,SAACpQ,GACVlR,EAAKwO,MAAMrP,EAAI+R,EAAMyvC,QACrB3gD,EAAKwO,MAAMlP,EAAI4R,EAAM0vC,SAEvB3/B,MAAO,aAIPG,UAAW,SAAClQ,GACVlR,EAAKugD,YAAcrvC,EAAM2vC,OACzB7gD,EAAKsgD,WAAY,GAEnBj/B,QAAS,WACPrhB,EAAKsgD,WAAY,GAEnB3+B,QAAS,SAACzQ,GACRlR,EAAKwgD,qBAAsB,EAC3B,IAAMxkC,EAAO9K,EAAM8K,KACnBhc,EAAKygD,OAAOhrB,IAAIzZ,GACX9K,EAAM0K,QACT5b,EAAK2b,cAAcK,IAGvB0F,MAAO,SAACxQ,GACNlR,EAAKygD,OAAOpL,OAAOnkC,EAAM8K,OAE3B6F,MAAO,SAACxT,GACN,GAAIA,EAAEyyC,SAAU,CAEd,IAAM3kC,IAAU9N,EAAE+N,OAAS/N,EAAEgO,QAAU,IAAM,GAMvC0kC,EALW/gD,EAAKiR,OAAO+vC,KACd5+C,KAAKoF,IAAI,EAAG2U,GAK3Bnc,EAAKiR,OAAO+vC,KAAOD,EACnB/gD,EAAKiR,OAAOgwC,8BAER5yC,EAAE+N,OAAS/N,EAAEgO,OAAS,EACxBrc,EAAKo9C,gBAAgBp9C,EAAKm9C,aAAe,GAEzCn9C,EAAKo9C,gBAAgBp9C,EAAKm9C,aAAe,KAmB/Cn9C,EATMkhD,mBASN,EAAAlhD,EARMmhD,iBAAmB,IAAI1L,GAAJ3zC,OAAAw6B,GAAA,EAAAx6B,CAAA9B,IAQzBA,EAPMohD,UAAiC,GAOvCphD,EA0BF2b,cAAgB,SAACK,GACF,UAATA,EAIAhc,EAAKu5C,iBACM,WAATv9B,IACFhc,EAAKu5C,kBAAmB,GAKD,MAAvBZ,GAAc38B,KAChBhc,EAAKm9C,aAAexE,GAAc38B,IAXlChc,EAAKu5C,kBAAoBv5C,EAAKu5C,kBA5BhCv5C,EA8KMqhD,iBAAmB,IAAIX,IA5K7B1gD,EAAKozB,MAAQ,IAAIhB,GAAMguB,EAAQkB,UAAUprC,KAAK+U,YAAcm1B,EAAQmB,iBAEpEvhD,EAAKiR,OAAOvH,SAASoF,EAAI,GACzB9O,EAAKiR,OAAOuwC,OAAO,IAAIj/B,WAAc,EAAG,EAAG,IAC3CviB,EAAKiR,OAAOvH,SAASvK,EAAIa,EAAKozB,MAAMf,OAAOsB,IAAIx0B,EAC/Ca,EAAKiR,OAAOvH,SAASpK,EAAIU,EAAKozB,MAAMf,OAAOsB,IAAIr0B,EAC/CU,EAAKiR,OAAO+vC,KAAO,IACnBhhD,EAAKiR,OAAOwkB,IAAIz1B,EAAK6wC,eAErB7wC,EAAKkhD,cAAgB,IAAIlM,GAAch1C,EAAKozB,MAAOpzB,EAAKuqC,MAAnCzoC,OAAAw6B,GAAA,EAAAx6B,CAAA9B,IrCxFlB,SAAqBipB,GAC1B,IAAIw4B,EAAU,EACd,SAASC,IAES,MADhBD,IAEEj5B,GAAKU,MAAM8e,YAAc,EACzBvf,GAAQS,MAAM8e,YAAc,EAC5Btf,GAAMQ,MAAM8e,YAAc,EAC1Bxf,GAAKhD,KAAKE,QAAQuD,EAAIzD,MACtBiD,GAAQjD,KAAKE,QAAQuD,EAAIzD,MACzBkD,GAAMlD,KAAKE,QAAQuD,EAAIzD,QAG3BgD,GAAOQ,GAAqBC,EAAK04B,OAC5Bz4B,MAAM04B,iBAAmBF,EAC9Bl5B,GAAKhD,KAAKA,KAAKlkB,MAAQ,IAEvBmnB,GAAUO,GAAqBC,EAAK44B,OAC5B34B,MAAM04B,iBAAmBF,EACjCj5B,GAAQjD,KAAKA,KAAKlkB,MAAQ,GAE1BonB,GAAQM,GAAqBC,EAAK64B,OAC5B54B,MAAM04B,iBAAmBF,EAC/Bh5B,GAAMlD,KAAKA,KAAKlkB,MAAQ,GAExBqnB,GAAYK,GAAqBC,EAAK84B,OAC5Bv8B,KAAKA,KAAKlkB,MAAQ,EAC5BqnB,GAAUnD,KAAKE,QAAQuD,EAAIzD,OAE3BoD,GAAQI,GAAqBC,EAAK+4B,OAC5Bx8B,KAAKA,KAAKlkB,MAAQ,EACxBsnB,GAAMpD,KAAKE,QAAQuD,EAAIzD,MAEvB,IAAMy8B,EAAS,IAAI1/B,eAEnB0/B,EAAO3Y,KACL4Y,KACA,SAACC,GACCt5B,GAAas5B,GAEf,SAACC,KAGD,SAACx7C,MAIHq7C,EAAO3Y,KACL+Y,KACA,SAACF,GACCr5B,GAAkBq5B,GAEpB,SAACC,KAGD,SAACx7C,MqCmCD07C,CAAYtiD,EAAKgiB,cACjBhiB,EAAKuiD,qBACLviD,EAAKwiD,qBACJpjD,OAAeopB,KAAhB1mB,OAAAw6B,GAAA,EAAAx6B,CAAA9B,GACCZ,OAAemjB,MAAQA,GAjBxBviB,EAnFJ,OAAA8B,OAAAkb,EAAA,EAAAlb,CAAAo+C,EAAAC,GAAAr+C,OAAAmb,EAAA,EAAAnb,CAAAo+C,EAAA,EAAAx3C,IAAA,eAAA2Z,IAAA,WAuEI,OAAOzhB,KAAKs8C,QAAQt8C,KAAKu8C,kBAvE7Br7C,OAAAmb,EAAA,EAAAnb,CAAAo+C,EAAA,EAAAx3C,IAAA,qBAAApH,MAAA,WAuG+B,IAAAuc,EAAAjd,KAC3BxB,OAAOoe,iBAAiB,OAAQ,WAC9BK,EAAK4iC,OAAO/J,YAzGlB,CAAAhuC,IAAA,kBAAApH,MAAA,SA8HyBmE,GACrB7E,KAAKu8C,cAAiB13C,EAAI7E,KAAKs8C,QAAQ18C,OAAUI,KAAKs8C,QAAQ18C,QAAUI,KAAKs8C,QAAQ18C,SA/HzF,CAAAkI,IAAA,SAAApH,MAAA,WAmII,IAAMmhD,EAA2C,GADnCv8C,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAEd,QAAAoF,EAAAC,EAAgB1F,KAAKygD,iBAArB96C,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAuC,KAA5BmI,EAA4BhI,EAAA/E,MACrCmhD,EAA0BriD,KAAKiO,EAAEqV,WAHrB,MAAA9c,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAKd,OACEud,EAAA,cAAAA,EAAA,cACEA,EAAA,cAAC++B,GAAD,CAAKl6B,KAAM5nB,OACX+iB,EAAA,cAACg/B,GAAD,CAAWn6B,KAAM5nB,OAGjB+iB,EAAA,cAACi/B,GAAD,CAAOp6B,KAAM5nB,OACb+iB,EAAA,qBAAK7gB,UAAU,wBAAwB2/C,MA9I/C,CAAA/5C,IAAA,qBAAApH,MAAA,WAoJI,IAAMuhD,EAAOjiD,KAAKwyB,MAAMf,OAAOsB,IAAIr0B,EAC7BwjD,EAAav6C,GAAIs6C,EAAMjiD,KAAKwyB,MAAMhkB,OAAS,EAAGxO,KAAKwyB,MAAMhkB,OAAQ,EAAG,IACpE2zC,EAAgBx6C,GAAIs6C,EAAMjiD,KAAKwyB,MAAMhkB,OAAS,EAAG,EAAG,EAAG,IAC7DsZ,GAAMlD,KAAKA,KAAKlkB,MAAQc,KAAKgR,IAAI,EAAG0vC,GACpCr6B,GAAQjD,KAAKA,KAAKlkB,MAAQc,KAAKgR,IAAI,EAAG2vC,KAxJ1C,CAAAr6C,IAAA,gBAAApH,MAAA,WA4JI0hB,QAAQggC,IAAR,yBAAAr1C,OAC2B/M,KAAKmhB,SAAS7L,KAAK+sC,OAAOC,WADrD,0BAAAv1C,OAEkB/M,KAAKmhB,SAAS7L,KAAK+sC,OAAOE,SAF5C,0BAAAx1C,OAGkB/M,KAAKmhB,SAAS7L,KAAKktC,SAAU5iD,OAH/C,sBAAAmN,OAIc/M,KAAKmhB,SAAS7L,KAAKwN,OAAO2/B,MAJxC,sBAAA11C,OAKc/M,KAAKmhB,SAAS7L,KAAKwN,OAAO6vB,MALxC,uBAAA5lC,OAMe/M,KAAKmhB,SAAS7L,KAAKwN,OAAO4/B,OANzC,qBAAA31C,OAOa/M,KAAKmhB,SAAS7L,KAAKwN,OAAO6/B,UAPvC,SA5JJ,CAAA76C,IAAA,YAAApH,MAAA,WA0KI,IAAIkiD,EAAM,EACRC,EAAK,EACP7iD,KAAK2pC,MAAMmZ,SAAS,SAACjvC,GACfA,EAAEi8B,iBACJ8S,IAEAC,MAGJzgC,QAAQggC,IAAI,wBAAyBQ,EAAK,OAAQC,GAGlD,IAAMz/C,EAAI,IAAI4W,IACdha,KAAK2pC,MAAMmZ,SAAS,SAACjvC,GACnB,IAAM7C,EAAI5N,EAAEqe,IAAI5N,EAAEtM,MAAQsM,EAAE8gB,YAAYptB,OAAS,GACjDnE,EAAE+Y,IAAItI,EAAEtM,MAAQsM,EAAE8gB,YAAYptB,KAAMyJ,GACpCA,EAAExR,KAAKqU,KAETuO,QAAQggC,IAAIh/C,KA5LhB,CAAA0E,IAAA,YAAApH,MAAA,SA+LmByc,GACf,GAAKnd,KAAK4/C,sBAAuB5/C,KAAK24C,iBAAtC,CAQA,GAFA34C,KAAKwyB,MAAMoB,KAAKzW,GAEZnd,KAAKugD,iBAAiBwC,sBAAuB,CAC/C,IAAM3hD,EAAIpB,KAAKugD,iBAAiByC,UAChChjD,KAAKwgD,UAAUhhD,KAAK4B,GAGlBpB,KAAK67C,aACP77C,KAAK67C,YAAY1hC,SAAS,CAAEhb,KAAMa,KAAKwyB,MAAMrzB,OAG/C,IAAM8jD,EAAajjD,KAAKwyB,MAAM0wB,qBACZ,MAAdD,GACFjjD,KAAKy/C,UAAUwD,GAGjBjjD,KAAK2hD,wBAtNT,CAAA75C,IAAA,2BAAApH,MAAA,SAyNmCq/C,EAAiBC,GAChD,OAAO,IAAIr+B,WAAeo+B,EAAU//C,KAAKoQ,OAAOhI,MAAS,EAAI,GAAK43C,EAAUhgD,KAAKoQ,OAAO5B,OAAU,EAAI,KA1N1G,CAAA1G,IAAA,qBAAApH,MAAA,WA6N4E,IAAhDq/C,EAAgDnrC,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAtC5U,KAAK4N,MAAMrP,EAAGyhD,EAAwBprC,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAd5U,KAAK4N,MAAMlP,EAC/Dmd,EAAS,IAAI5J,WAAQ8tC,EAAU//C,KAAKoQ,OAAOhI,MAAQ,EAAG43C,EAAUhgD,KAAKoQ,OAAO5B,OAAS,GAG3F,OADAqN,EAAOC,UAAU,KACVD,IAjOX,CAAA/T,IAAA,uBAAApH,MAAA,WAoO8E,IAAhDq/C,EAAgDnrC,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAtC5U,KAAK4N,MAAMrP,EAAGyhD,EAAwBprC,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAd5U,KAAK4N,MAAMlP,EACjEmd,EAAS7b,KAAKmjD,mBAAmBpD,EAASC,GAD0BoD,EAEzDpjD,KAAKwyB,MAAMf,OAAO2B,SAA3B70B,EAFkE6kD,EAElE7kD,EAAGG,EAF+D0kD,EAE/D1kD,EAIX,OAFAmd,EAAOtd,GAAKA,EACZsd,EAAOnd,GAAKA,EACLmd,IA1OX,CAAA/T,IAAA,qBAAApH,MAAA,WA6O6E,IAAhDq/C,EAAgDnrC,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAtC5U,KAAK4N,MAAMrP,EAAGyhD,EAAwBprC,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAd5U,KAAK4N,MAAMlP,EAChE8J,EAAIxI,KAAK4+C,qBAAqBmB,EAASC,GAC7Cx3C,EAAE0I,QAEF,IAAMQ,EAAO1R,KAAKwyB,MAAM3X,OAAOrS,EAAEjK,EAAGiK,EAAE9J,GACtC,GAAY,MAARgT,GAAgBA,EAAK2+B,cAAgB,EACvC,OAAO3+B,IAnPb,CAAA5J,IAAA,gBAAApH,MAAA,SAuPgB8xB,GACZ,IAAM6wB,EAAS,IAAIjR,WAAQ5f,EAAMj0B,EAAGi0B,EAAM9zB,EAAG,GAM7C,OALA2kD,EAAOC,QAAQtjD,KAAKqQ,QAEpBgzC,EAAO9kD,EAAIiD,KAAK0P,OAAO,GAAMmyC,EAAO9kD,EAAI,GAAKyB,KAAKoQ,OAAOhI,OACzDi7C,EAAO3kD,EAAI8C,KAAK0P,OAAO,GAAMmyC,EAAO3kD,EAAI,GAAKsB,KAAKoQ,OAAO5B,QAElD60C,IA9PX,CAAAv7C,IAAA,qBAAApH,MAAA,SAkQqBw+C,EAAiCC,GAClD,IAAM1xC,EAAI,IAAIwxC,GAAgBj/C,KAAMk/C,EAAYC,GAEhD,OADAn/C,KAAKygD,iBAAiB5rB,IAAIpnB,GACnBA,IArQX,CAAA3F,IAAA,wBAAApH,MAAA,SAwQwB6uC,GACpBvvC,KAAKygD,iBAAiBhM,OAAOlF,KAzQjC,CAAAznC,IAAA,UAAApH,MAAA,SA0RiBuhB,GACb,IAAIjiB,KAAK24C,iBAAT,CAMA34C,KAAKoQ,OAAO6qC,QAGZ,IAAI99B,EAAK3b,KAAKmS,IAAI,EAAIsO,EAAgB,GAAI,IAC1C,GAAIwJ,GAAOrB,WAAY,CACrB,IAAMm5B,EAAavjD,KAAKwjD,eAAexjD,KAAK6/C,QACxC0D,GACFvjD,KAAKwyB,MAAMf,OAAOgyB,UAAUF,GAHT,IAAA5qC,GAAA,EAAAC,GAAA,EAAAC,OAAAxY,EAAA,IAKrB,QAAAyY,EAAAC,EAAkB/Y,KAAK6/C,OAAvBl6C,OAAAC,cAAA+S,GAAAG,EAAAC,EAAAlT,QAAAC,MAAA6S,GAAA,EAA+B,KAApB7Q,EAAoBgR,EAAApY,MACzB42C,GAAcxvC,IAChB9H,KAAKwyB,MAAMf,OAAOgyB,UAAUnM,GAAcxvC,KAPzB,MAAA9B,GAAA4S,GAAA,EAAAC,EAAA7S,EAAA,YAAA2S,GAAA,MAAAI,EAAA9S,QAAA8S,EAAA9S,SAAA,WAAA2S,EAAA,MAAAC,GAUjB7Y,KAAK0/C,YAEkB,IAArB1/C,KAAK2/C,YACP3/C,KAAK0jD,kBACyB,IAArB1jD,KAAK2/C,aACd3/C,KAAK2jD,oBAGT3jD,KAAK4jD,UAAUzmC,QAC2B,MAAjCnd,KAAKwyB,MAAMf,OAAOoyB,aAC3B7jD,KAAK4jD,UAAUzmC,GAEjBnd,KAAKsgD,cAAchS,SAEnBtuC,KAAK0+C,gBAAkB1+C,KAAK8jD,qBACA,MAAxB9jD,KAAK0+C,iBACN1+C,KAAKsgD,cAAc1L,oBAAoB50C,KAAK0+C,iBAAkCqF,cAGjF,IAAMC,EAAYhkD,KAAKikD,yBAAyBjkD,KAAK4N,MAAMrP,EAAGyB,KAAK4N,MAAMlP,GACnEgP,EAAS,IAAIiU,WACjB3hB,KAAKwyB,MAAMf,OAAO2B,SAAS70B,EAAIylD,EAAUzlD,EAAI,EAC7CyB,KAAKwyB,MAAMf,OAAO2B,SAAS10B,EAAIslD,EAAUtlD,EAAI,GAE/CuoB,GAAMjnB,KAAKqQ,OAAOvH,SAAU4E,EAAQ,IAEpC1N,KAAKmhB,SAAS2B,OAAO9iB,KAAK2pC,MAAO3pC,KAAKqQ,QAClC6zC,QAAQhgC,iBAAM1lB,OAAOmtB,SAASD,QAAQy4B,QAAUnkD,KAAKwhB,WAAa,MAAQ,GAE5ExhB,KAAKokD,mBA5UX,CAAAt8C,IAAA,iBAAApH,MAAA,SA+UwB8C,GACpB,IAAMkyB,EAAM,IAAIzjB,WAD0CojB,GAAA,EAAAC,GAAA,EAAAC,OAAAl1B,EAAA,IAE1D,QAAAo0B,EAAAgB,EAAkBjyB,EAAlBmC,OAAAC,cAAAyvB,GAAAZ,EAAAgB,EAAA5vB,QAAAC,MAAAuvB,GAAA,EAAwB,KAAbvtB,EAAa2sB,EAAA/zB,MAClBg3C,GAAc5vC,IAChB4tB,EAAIb,IAAI6iB,GAAc5vC,GAAK4tB,MAJ2B,MAAA1vB,GAAAsvB,GAAA,EAAAC,EAAAvvB,EAAA,YAAAqvB,GAAA,MAAAI,EAAAxvB,QAAAwvB,EAAAxvB,SAAA,WAAAqvB,EAAA,MAAAC,GAO1D,OAAc,IAAVG,EAAIn3B,GAAqB,IAAVm3B,EAAIh3B,EACd,KAEA,CACLoM,KAAM,OACN4qB,SA3VR,CAAA5tB,IAAA,SAAApH,MAAA,SAgWgBsvB,EAAWq0B,GACvB,IAAMC,EAASD,EAAIr0B,EAGnBhwB,KAAKqQ,OAAOhC,MADS,GACci2C,EACnCtkD,KAAKqQ,OAAO4rB,MAFS,GAEcqoB,EACnCtkD,KAAKqQ,OAAO9B,KAHS,GAIrBvO,KAAKqQ,OAAOupC,OAJS,GAOrB55C,KAAKqQ,OAAOgwC,2BA1WhB,CAAAv4C,IAAA,mBAAApH,MAAA,WA8WI,IAAMgR,EAAO1R,KAAK8jD,qBAClB,GAAY,MAARpyC,EAAc,CAChB,GAAIA,aAAgB2iB,GAClB,OAEFr0B,KAAKwyB,MAAMf,OAAOgyB,UAAU,CAC1B34C,KAAM,cACNhC,SAAU4I,EAAKqhB,SArXvB,CAAAjrB,IAAA,kBAAApH,MAAA,WA4XIV,KAAK4/C,qBAAsB,EAC3B,IAAMlyC,EAAS1N,KAAK8jD,qBACpB,GAAc,MAAVp2C,EAIJ,GAAIijB,GAAejjB,GAAnB,CACE,IAAMo4B,EAAyB,CAC7Bh7B,KAAM,WACNs9B,aAAc16B,GAEhB1N,KAAKwyB,MAAMf,OAAOgyB,UAAU3d,QAK9B,GAAI9lC,KAAKwyB,MAAMf,OAAO8yB,iBAAiB72C,GAAS,CAC9C,IAAMoW,EAAc,GACpB,GAAI9jB,KAAKwkD,eAAiB5f,GAAW,CACnC,IACM6f,EADkBzkD,KAAKmjD,qBACkBrnC,UAAU,GAAG5K,QAC5D4S,EAAKtkB,KAAKilD,GAEZ,IAAM3e,EAAsB,CAC1Bh7B,KAAM,QACNu8B,SAAUrnC,KAAKwkD,aACf17C,SAAU4E,EAAOqlB,IAAI+G,QACrBhW,QAEF9jB,KAAKwyB,MAAMf,OAAOgyB,UAAU3d,QAzZlCwZ,EAAA,CAA0Bp+B,IAAbo+B,GACJhgD,GAAK,OADDggD,GA4ZJoF,eAA2C,CAAClxB,GAAQiP,GAAM+C,IAGpD8Z,iBChcf,SAASqF,KACP,OACE5hC,EAAA,qBAAK7gB,UAAU,QACb6gB,EAAA,4BAUN,SAAS6hC,GAATnkD,GAAgD,IAA3ByvC,EAA2BzvC,EAA3ByvC,MACnB,OACEntB,EAAA,qBAAK7gB,UAAU,cACb6gB,EAAA,qBAAK7gB,UAAU,gBACZguC,EAAM/X,WAAapV,EAAA,cAAC4hC,GAAD,MAAW,KAC/B5hC,EAAA,qBAAKrgB,IAAI,GAAGC,IAAKmmC,QAElBoH,EAAM/X,WACLpV,EAAA,cAAAA,EAAA,cACEA,EAAA,sBAAM7gB,UAAU,wBAAhB,WADF,UACiEguC,EAAMrM,YADvE,+BAIE9gB,EAAA,sBAAM7gB,UAAU,6BAAyD,IAA5BguC,EAAMQ,qBAA2BN,QAAQ,GAAtF,cAVN,aAYaF,EAAMrW,SAZnB,KAiBJ,SAASgrB,GAATv8C,GAA4D,IAAnCw8C,EAAmCx8C,EAAnCw8C,QACjB5sB,EAAc4sB,EAAQvyB,OAAOjrB,OAAO,SAAC/H,GAAD,OAAOA,EAAE44B,aACnD,OACEpV,EAAA,cAAAA,EAAA,cACEA,EAAA,qBAAK7gB,UAAU,6BACb6gB,EAAA,cAACnW,EAAD,CAAWrK,KAAK,WAElBwgB,EAAA,+BAASmV,EAAYt4B,QAAU,EAAI,UAAY,WAA/C,KACAmjB,EAAA,wBAAKmV,EAAYt4B,OAAjB,4BACAmjB,EAAA,sCACAA,EAAA,qBAAK7gB,UAAU,cACZ4iD,EAAQvyB,OAAO5qB,IAAI,SAACpI,GAAD,OAClBwjB,EAAA,cAAC6hC,GAAD,CAAW1U,MAAO3wC,QAO5B,SAASwlD,GAATpqB,GAA6D,IAAnCmqB,EAAmCnqB,EAAnCmqB,QACxB,OACE/hC,EAAA,cAAAA,EAAA,cACEA,EAAA,qCACAA,EAAA,+CAAyBkO,GAAc6zB,EAAQtyB,MAAMtB,QAArD,MAKS,SAAS8zB,GAATC,GAAwE,IAA3CC,EAA2CD,EAA3CC,OAAQJ,EAAmCG,EAAnCH,QAClD,OACE/hC,EAAA,qBAAK7gB,UAAS,uBAAA6K,OAAyB+3C,EAAQ9gC,SAC7CjB,EAAA,qBAAK7gB,UAAU,wBACO,QAAnB4iD,EAAQ9gC,OACPjB,EAAA,cAAC8hC,GAAD,CAAeK,OAAQA,EAAQJ,QAASA,IAEtC/hC,EAAA,cAACgiC,GAAD,CAAgBG,OAAQA,EAAQJ,QAASA,IAE7C/hC,EAAA,wBAAQ7gB,UAAU,cAAciF,QAAS+9C,GAAzC,gDCnDJv/C,OAAOC,SA3BEu/C,GAAb,oBAAAA,IAAAjkD,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAmlD,GAAAnlD,KACE82C,MAAkC,GADpC,OAAA51C,OAAAmb,EAAA,EAAAnb,CAAAikD,EAAA,EAAAr9C,IAAA,OAAApH,MAAA,SAGemE,EAAWiM,GACtB,SAAA/D,OAAUlI,EAAV,KAAAkI,OAAe+D,KAJnB,CAAAhJ,IAAA,MAAApH,MAAA,SAOMmE,EAAWiM,GACb,OAAO9Q,KAAK82C,MAAM92C,KAAKolD,KAAKvgD,EAAGiM,MARnC,CAAAhJ,IAAA,MAAApH,MAAA,SAWMmE,EAAWiM,EAAWY,GACxB1R,KAAK82C,MAAM92C,KAAKolD,KAAKvgD,EAAGiM,IAAMY,IAZlC,CAAA5J,IAAA,kBAAApH,MAAA,WAeoB,IAAA4E,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAChB,QAAAoF,EAAAC,EAAmB1F,KAAnB2F,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAyB,KAAdoM,EAAcjM,EAAA/E,MACfmE,EAAS6M,EAAT7M,EAAGiM,EAAMY,EAANZ,EACXY,EAAK6iB,UAAU,GAAKv0B,KAAKyhB,IAAI5c,EAAI,EAAGiM,GACpCY,EAAK6iB,UAAU,GAAKv0B,KAAKyhB,IAAI5c,EAAGiM,EAAI,GACpCY,EAAK6iB,UAAU,GAAKv0B,KAAKyhB,IAAI5c,EAAI,EAAGiM,EAAI,GACxCY,EAAK6iB,UAAU,GAAKv0B,KAAKyhB,IAAI5c,EAAI,EAAGiM,GACpCY,EAAK6iB,UAAU,GAAKv0B,KAAKyhB,IAAI5c,EAAGiM,EAAI,GACpCY,EAAK6iB,UAAU,GAAKv0B,KAAKyhB,IAAI5c,EAAI,EAAGiM,EAAI,IAR1B,MAAA9K,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,MAfpB,CAAAsC,IAAAu9C,GAAA3kD,MAAAuX,GAAAtW,EAAAuW,KAAA,SAAAxX,IAAA,IAAAoH,EAAA,OAAAmQ,GAAAtW,EAAAyW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAxS,MAAA,OAAAwS,EAAAE,GAAAN,GAAAtW,EAAA6B,KA4BsBxD,KAAK82C,OA5B3B,WAAAz+B,EAAAoV,GAAApV,EAAAE,MAAAzS,KAAA,CAAAuS,EAAAxS,KAAA,QA6BM,OADSiC,EA5BfuQ,EAAAoV,GAAA/sB,MAAA2X,EAAAxS,KAAA,EA6BY7F,KAAK82C,MAAMhvC,GA7BvB,OAAAuQ,EAAAxS,KAAA,gCAAAwS,EAAAI,SAAA/X,EAAAV,WAAAmlD,EAAA,GCAMG,GAAI9jD,KAAK0O,KAAK,GAAK,EAEZq1C,GAAb,WA8CE,SAAAA,EAAmB1gD,EAAkBiM,GAAY5P,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAulD,GAAAvlD,KAAA6E,IAAA7E,KAAA8Q,IAAA9Q,KA9BjDu0B,UAAuB,IAAIphB,MAAM,GA8BenT,KA7BhDsV,KAAkB,CAChB9G,OAAQ,EACRg3C,SAAU,SACVC,SAAU,UACV9nB,YAAa,YACb+nB,KAAM,MACNpuC,SAAS,GAvBb,OAAApW,OAAAmb,EAAA,EAAAnb,CAAAqkD,EAAA,EAAAz9C,IAAA,IAAA2Z,IAAA,WA2BI,QAASzhB,KAAK6E,EAAI7E,KAAK8Q,KA3B3B,CAAAhJ,IAAA,YAAA2Z,IAAA,WA8BI,OAAOjgB,KAAKC,IAAIzB,KAAK6E,GAAKrD,KAAKC,IAAIzB,KAAK8Q,GAAKtP,KAAKC,IAAIzB,KAAKgR,KA9B/D,CAAAlJ,IAAA,YAAA2Z,IAAA,WAgCkB,IACN5c,EAAS7E,KAAT6E,EAAGiM,EAAM9Q,KAAN8Q,EAQX,MAAO,CACLvS,EAAG,IAAMsG,EACTnG,EAAG,EAAI4mD,GAAIx0C,EAAIw0C,GAAIzgD,OA3CzB0gD,EAAA,MCgGI5/C,OAAOC,SA9FE+/C,GAAb,WA4EE,SAAAA,EAAoBC,GAAoB1kD,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA2lD,GAAA3lD,KAAA4lD,UAAA5lD,KAFhC6lD,eAE+B,EAErCD,EAAQE,kBAGR,IAAMhP,EAAQ3jC,MAAMwrB,KAAKinB,GACzB5lD,KAAK6lD,UAAY/O,EAAMxvC,OAAO,SAACpC,GAAD,OAAyB,IAAlBA,EAAEoQ,KAAK9G,SAAchH,KAAK,SAACimB,EAAIC,GAAL,OAAYD,EAAGs4B,UAAYr4B,EAAGq4B,YAAW,GACxG/lD,KAAK6lD,UAAUvwC,KAAKgC,SAAU,EAnFlC,OAAApW,OAAAmb,EAAA,EAAAnb,CAAAykD,EAAA,OAAA79C,IAAA,eAAApH,MAAA,SAC8BgR,EAAes0C,GAAqB,IAAAr0C,EAC7CD,EAAKE,UAAdrT,EADsDoT,EACtDpT,EAAGG,EADmDiT,EACnDjT,EACP8P,EAAS,EAWb,OAVAA,GAAqD,GAA1Cw3C,EAAMC,QAAQ1nD,EAAI,GAAIG,EAAI,GAAI,GAAK,IAC9C8P,GAAiD,EAAvCw3C,EAAMC,QAAQ1nD,EAAI,GAAIG,EAAI,GAAI,OACxC8P,GAA+C,IAArCw3C,EAAMC,QAAQ1nD,EAAI,EAAGG,EAAI,EAAG,OACtC8P,GAAU,GAEVA,GAA4B,KAAlBhN,KAAKC,IAAI/C,EAAIA,IACV,GAAK8P,IAAW,IAC3BA,EAAS,GAEXA,EAAShN,KAAK0P,MAAM1P,KAAKgR,IAAIhR,KAAKmS,IAAInF,EAAQ,IAAK,MAbvD,CAAA1G,IAAA,oBAAApH,MAAA,SAiBmCgR,EAAes0C,GAAqB,IAC3D1wC,EAAS5D,EAAT4D,KACRA,EAAK9G,OAASm3C,EAAUO,aAAax0C,EAAMs0C,GAE3C1wC,EAAK+U,YAAc/U,EAAK9G,OAAS,EAAIuuC,KAAcznC,EAAK9G,OAAS,EAAImvC,KAAUD,OArBnF,CAAA51C,IAAA,oBAAApH,MAAA,WA+BI,IAPwD,IAAjCylD,EAAiCvxC,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAf,GACnCgxC,EAAU,IAAIT,GACda,EAAQ,IAAII,KAKTvhD,GAAKshD,EAASthD,GAAKshD,EAASthD,IACnC,IAAK,IAAIiM,GAAKq1C,EAASr1C,GAAKq1C,EAASr1C,IAAK,CACxC,IAAIE,IAAMnM,EAAIiM,GACd,KAAItP,KAAKC,IAAIuP,GAAKm1C,GAAlB,CAGA,IAAMz0C,EAAO,IAAI6zC,GAAQ1gD,EAAGiM,GAC5B60C,EAAUU,kBAAkB30C,EAAMs0C,GAClCJ,EAAQzpC,IAAItX,EAAGiM,EAAGY,IAGtB,OAAO,IAAIi0C,EAAUC,KA1CzB,CAAA99C,IAAA,oBAAApH,MAAA,WAsDI,IAT2E,IAApD0H,EAAoDwM,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAApC,GAAIpG,EAAgCoG,UAAAhV,OAAA,QAAAS,IAAAuU,UAAA,GAAAA,UAAA,GAAf,GACtDgxC,EAAU,IAAIT,GACda,EAAQ,IAAII,KAKZD,EAAU3kD,KAAKgR,IAAIpK,EAAQ,EAAGoG,EAAS,GAEpC3J,GAAKshD,EAASthD,GAAKshD,EAASthD,IACnC,IAAK,IAAIiM,GAAKq1C,EAASr1C,GAAKq1C,EAASr1C,IAAK,CACxC,IAAIE,IAAMnM,EAAIiM,GACd,KAAItP,KAAKC,IAAIuP,GAAKm1C,GAAlB,CAGA,IAAMz0C,EAAO,IAAI6zC,GAAQ1gD,EAAGiM,GALYw1C,EAMvB50C,EAAKE,UAAdrT,EANgC+nD,EAMhC/nD,EAAGG,EAN6B4nD,EAM7B5nD,EACPH,GAAK6J,EAAQ,GAAK7J,EAAI6J,EAAQ,GAAK1J,GAAK8P,EAAS,GAAK9P,EAAI8P,EAAS,IAIvEm3C,EAAUU,kBAAkB30C,EAAMs0C,GAClCJ,EAAQzpC,IAAItX,EAAGiM,EAAGY,KAItB,OAAO,IAAIi0C,EAAUC,OAvEzB1kD,OAAAmb,EAAA,EAAAnb,CAAAykD,EAAA,EAAA79C,IAAA,eAAApH,MAAA,WAuFI,OAAOV,KAAK6lD,YAvFhB,CAAA/9C,IAAA,SAAApH,MAAA,SA0FgBmE,EAAWiM,GACvB,OAAO9Q,KAAK4lD,QAAQnkC,IAAI5c,EAAGiM,KA3F/B,CAAAhJ,IAAAy+C,GAAA7lD,MAAAuX,GAAAtW,EAAAuW,KAAA,SAAAxX,IAAA,IAAA4E,EAAAC,EAAAC,EAAAE,EAAAD,EAAAiM,EAAA,OAAAuG,GAAAtW,EAAAyW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAxS,MAAA,OAAAP,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAAgY,EAAAC,KAAA,EAAA5S,EA+FuB1F,KAAK4lD,QA/F5BjgD,OAAAC,YAAA,UAAAN,GAAAG,EAAAC,EAAAG,QAAAC,KAAA,CAAAuS,EAAAxS,KAAA,SAgGM,OADS6L,EA/FfjM,EAAA/E,MAAA2X,EAAAxS,KAAA,EAgGY6L,EAhGZ,OAAApM,GAAA,EAAA+S,EAAAxS,KAAA,gBAAAwS,EAAAxS,KAAA,iBAAAwS,EAAAC,KAAA,GAAAD,EAAAE,GAAAF,EAAA,SAAA9S,GAAA,EAAAC,EAAA6S,EAAAE,GAAA,QAAAF,EAAAC,KAAA,GAAAD,EAAAC,KAAA,GAAAhT,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAoS,EAAAC,KAAA,IAAA/S,EAAA,CAAA8S,EAAAxS,KAAA,eAAAL,EAAA,eAAA6S,EAAAG,OAAA,mBAAAH,EAAAG,OAAA,6BAAAH,EAAAI,SAAA/X,EAAAV,KAAA,gCAAA8H,IAAA,oBAAApH,MAAA,WAoGsB,IAAAiY,GAAA,EAAAC,GAAA,EAAAC,OAAAxY,EAAA,IAClB,QAAAyY,EAAAC,EAAmB/Y,KAAK4lD,QAAxBjgD,OAAAC,cAAA+S,GAAAG,EAAAC,EAAAlT,QAAAC,MAAA6S,GAAA,EAAiC,KAAtBjH,EAAsBoH,EAAApY,MAC3BgR,EAAK4D,KAAKC,QACZ7D,EAAK4D,KAAKC,MAAMixC,aAAe,IAHjB,MAAAxgD,GAAA4S,GAAA,EAAAC,EAAA7S,EAAA,YAAA2S,GAAA,MAAAI,EAAA9S,QAAA8S,EAAA9S,SAAA,WAAA2S,EAAA,MAAAC,MApGtB,CAAA/Q,IAAA,cAAApH,MAAA,WA6GI,IAAM+lD,EAAQ,GADFpxB,GAAA,EAAAC,GAAA,EAAAC,OAAAl1B,EAAA,IAEZ,QAAAo0B,EAAAgB,EAAmBz1B,KAAK4lD,QAAxBjgD,OAAAC,cAAAyvB,GAAAZ,EAAAgB,EAAA5vB,QAAAC,MAAAuvB,GAAA,EAAiC,KAAtB3jB,EAAsB+iB,EAAA/zB,MAC3BgR,EAAK4D,KAAKC,OAAS7D,EAAK4D,KAAKC,MAAMixC,aAAe,GACpDC,EAAMjnD,KAAKkS,IAJH,MAAA1L,GAAAsvB,GAAA,EAAAC,EAAAvvB,EAAA,YAAAqvB,GAAA,MAAAI,EAAAxvB,QAAAwvB,EAAAxvB,SAAA,WAAAqvB,EAAA,MAAAC,GAOZ,OAAOkxB,IAnHX,CAAA3+C,IAAA,iBAAApH,MAAA,SAsHiBkJ,GACb,IAAIE,EAAO,EADoB2tB,GAAA,EAAAC,GAAA,EAAAC,OAAAt3B,EAAA,IAE/B,QAAAm1B,EAAAqC,EAAmB73B,KAAK4lD,QAAxBjgD,OAAAC,cAAA6xB,GAAAjC,EAAAqC,EAAAhyB,QAAAC,MAAA2xB,GAAA,EAAiC,KACvBliB,EADuBigB,EAAA90B,MACR4U,KAAfC,MACJA,GAASA,EAAM3L,UAAYA,IAC7BE,GAAQyL,EAAMQ,yBALa,MAAA/P,GAAA0xB,GAAA,EAAAC,EAAA3xB,EAAA,YAAAyxB,GAAA,MAAAI,EAAA5xB,QAAA4xB,EAAA5xB,SAAA,WAAAyxB,EAAA,MAAAC,GAQ/B,OAAO7tB,MA9HX67C,EAAA,GCEae,GAAoBroD,IAAMC,cAAqC,MAMrE,SAASqoD,GAAQtsC,EAAiByrB,GACvC,OAAQA,EAAOh7B,MACb,IAAK,eACH,OAAO5J,OAAAmL,EAAA,EAAAnL,CAAA,GACFmZ,GAMP,IAAK,2BACH,OA+BN,SAAsCA,EAAiByrB,GACrD,IAAM8gB,EAAoB9gB,EAAO8gB,kBACzBlG,EAAyBkG,EAAzBlG,UAAWmG,EAAcD,EAAdC,UAEnB,IAAKnG,EAAUprC,KAAKgC,QAClB,OAAO+C,EAET,GAAiB,MAAbwsC,GAA6C,MAAxBA,EAAUvxC,KAAKC,OAAiBsxC,EAAUvxC,KAAKC,MAAMixC,aAAe,EAC3F,OAAOnsC,EAGT,OAAOnZ,OAAAmL,EAAA,EAAAnL,CAAA,GACFmZ,EADL,CAEEysC,wBAAyBhhB,EAAO8gB,oBA5CvBG,CAA6B1sC,EAAOyrB,GAC7C,IAAK,6BACH,OAAOkhB,GAA+B3sC,EAAOyrB,GAC/C,IAAK,cACH,OAmGN,SAAyBzrB,EAAiByrB,GAGxCzrB,EAAMO,UAAUqsC,oBAHuD,IAAAtuC,GAAA,EAAAC,GAAA,EAAAC,OAAAxY,EAAA,IAKvE,QAAAyY,EAAAC,EAAsBlE,GAAQwF,EAAMtK,aAApCpK,OAAAC,cAAA+S,GAAAG,EAAAC,EAAAlT,QAAAC,MAAA6S,GAAA,EAAkD,KAAvC/O,EAAuCkP,EAAApY,MAChDkJ,EAAQG,mBAAqBH,EAAQQ,qBANgC,MAAApE,GAAA4S,GAAA,EAAAC,EAAA7S,EAAA,YAAA2S,GAAA,MAAAI,EAAA9S,QAAA8S,EAAA9S,SAAA,WAAA2S,EAAA,MAAAC,GAQvE,OAAO3X,OAAAmL,EAAA,EAAAnL,CAAA,GACFmZ,EADL,CAEE0D,MAAO1D,EAAM0D,MAAQ,IA7GZmpC,CAAgB7sC,GACzB,IAAK,kBACH,OAoHN,SAA6BA,EAAiByrB,GAC5C,GAAqC,MAAjCzrB,EAAMysC,wBACR,MAAM,IAAIvnC,MAAM,kEAEW,QAAzBumB,EAAOqhB,OAAOnjC,SAChB3J,EAAQ2sC,GAA+B3sC,EAAO,CAC5CvP,KAAM,6BACN00C,QAASnlC,EAAMysC,wBACfhC,QAAShf,EAAOqhB,UAGpB,OAAOjmD,OAAAmL,EAAA,EAAAnL,CAAA,GACFmZ,EADL,CAEE+sC,iBAAkBthB,EAAOqhB,SAjIhBE,CAAoBhtC,EAAOyrB,GACpC,IAAK,mBACH,OAuIN,SAA8BzrB,EAAiByrB,GAC7C,OAAO5kC,OAAAmL,EAAA,EAAAnL,CAAA,GACFmZ,EADL,CAEEysC,6BAAyBzmD,EACzB+mD,sBAAkB/mD,IA3ITinD,CAAqBjtC,IAqDlC,SAAS2sC,GAA+B3sC,EAAiByrB,GAA8C,IAAAyhB,EACvCzhB,EAAtD0Z,eAD6F,IAAA+H,EACnFltC,EAAMysC,wBAD6ES,EACnDzC,EAAYhf,EAAZgf,QAC1CpE,EAA0ClB,EAA1CkB,UAAWmG,EAA+BrH,EAA/BqH,UAAWlG,EAAoBnB,EAApBmB,gBAEb,MAAbkG,IACFA,EAAUvxC,KAAKC,MAAOixC,cAAgB,GAIxC,IAAIgB,OAAkCnnD,EACV,MAAxBqgD,EAAUprC,KAAKC,QACjBiyC,EAAa9G,EAAUprC,KAAKC,MAAM3L,SAEpC82C,EAAUprC,KAAKC,MAAQ,CACrB3L,QAAS+2C,EACT5qC,uBAAwB+uC,EAAQ/uC,uBAChCywC,aAAc,GAEhB7F,EAAgBv2C,oBAAsBiQ,EAAMO,UAAU6sC,eAAe9G,GACjE6G,IAEFA,EAAWp9C,oBAAsBiQ,EAAMO,UAAU6sC,eAAeD,IArBmC,IAAAliD,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAyBrG,QAAAoF,EAAAC,EAAgBg7C,EAAUnsB,UAA1B5uB,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAqC,CAAAG,EAAA/E,MACjC4U,KAAKgC,SAAU,GA1BkF,MAAAtR,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAmCrG,OAAOtE,OAAAmL,EAAA,EAAAnL,CAAA,GAAKmZ,GC/GC,SAASqtC,GAATjnD,GAA+D,IAAnC4B,EAAmC5B,EAAnC4B,SACnCslD,EAAqBtpD,IAAMupD,WAAWjB,GAQvC,WACL,IAAM/rC,EAAY+qC,GAAUkC,kBAAkB,IAAK,IAC7C93C,EAAc4E,GAAe,oBAQnC,MAAO,CACLiG,YACA7K,cACAgO,MAAO,GArB4C+pC,IACrD,OACEpmD,EAAAC,EAAAC,cAAC8kD,GAAkBqB,SAAnB,CAA4BrnD,MAAOinD,GAChCtlD,OCGD2lD,eAIJ,SAAAA,EAAYhmD,EAAWsa,GAAc,IAAAld,EAAA,OAAA8B,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAgoD,IACnC5oD,EAAA8B,OAAA0Y,EAAA,EAAA1Y,CAAAlB,KAAAkB,OAAA2Y,EAAA,EAAA3Y,CAAA8mD,GAAAluC,KAAA9Z,KAAMgC,EAAOsa,KAHfA,aAEqC,EAAAld,EAOrC6oD,oBAAsB,SAACx6C,GACrBrO,EAAK+a,SAAS,CACZ+tC,cAAe,CAAE3pD,EAAGkP,EAAEsyC,QAASrhD,EAAG+O,EAAEuyC,YATH5gD,EAkCrC+oD,wBAA0B,SAACzH,EAAoBC,EAA0BkG,GACvE,IAAMD,EAAuC,CAC3CjG,kBACAkG,YACAnG,cAGF0H,EAP+FlnD,OAAAC,EAAA,EAAAD,CAM1E9B,EAAKkd,QANqE,OAOtF,CACPxR,KAAM,2BACN87C,uBA3CiCxnD,EA+CrC8nD,gBAAkB,YAEhBkB,EAFsBlnD,OAAAC,EAAA,EAAAD,CACD9B,EAAKkd,QADJ,OAEb,CAAExR,KAAM,iBAjDkB1L,EAoDrCipD,cAAgB,SAAClB,IAEfiB,EAFsClnD,OAAAC,EAAA,EAAAD,CACjB9B,EAAKkd,QADY,OAE7B,CACPxR,KAAM,kBACNq8C,YAxDiC/nD,EA4DrCkpD,kBAAoB,YAElBF,EAFwBlnD,OAAAC,EAAA,EAAAD,CACH9B,EAAKkd,QADF,OAEf,CACPxR,KAAM,sBA/D2B1L,EA8F7BmpD,kBAAoBjU,aAC1B,SAAClxC,GAAD,OAAiBA,EAAE0jD,yBACnB,SAACA,GAAD,MAA6B,CAACA,EAAyB1nD,EAAKipD,iBA9F5DjpD,EAAKib,MAAQ,CACX6tC,cAAe,CAAE3pD,EAAGC,OAAOC,WAAa,EAAGC,EAAGF,OAAOG,YAAc,IAHlCS,mFAcnCud,SAASC,iBAAiB,YAAa5c,KAAKioD,qBAD1B,IAAAO,EAAAtnD,OAAAC,EAAA,EAAAD,CAGQlB,KAAKsc,QAHb,GAGXjC,EAHWmuC,EAAA,IAKlBJ,EALkBI,EAAA,IAKT,CACP19C,KAAM,6BACN00C,QAAS,CACPmB,gBAAiBtmC,EAAMtK,YACvB2wC,UAAWrmC,EAAMO,UAAUoB,gBAE7B8oC,QAAS,CACP9gC,OAAQ,MAAOjO,uBAAwB,EAAGwc,OAAQ,GAAIC,MAAO,uDAMjE7V,SAASE,oBAAoB,YAAa7c,KAAKioD,sDAqC/C,OACEvmD,EAAAC,EAAAC,cAACxD,EAAqB2pD,SAAtB,CAA+BrnD,MAAOV,KAAKqa,MAAM6tC,eAC/CxmD,EAAAC,EAAAC,cAAA,OAAKM,UAAU,OACZlC,KAAKyoD,uBACLzoD,KAAK0oD,oBACL1oD,KAAK2oD,yEAMS,IACdtuC,EADcnZ,OAAAC,EAAA,EAAAD,CACJlB,KAAKsc,QADD,MAErB,GAAqC,MAAjCjC,EAAMysC,wBACR,OACEplD,EAAAC,EAAAC,cAACgnD,GAAD,CACE7qC,MAAO1D,EAAM0D,MACbnD,UAAWP,EAAMO,UACjB7K,YAAasK,EAAMtK,YACnB2O,oBAAqB1e,KAAKmoD,wBAC1BnqC,YAAahe,KAAKknD,8DAWN,IACX7sC,EADWnZ,OAAAC,EAAA,EAAAD,CACDlB,KAAKsc,QADJ,MAElB,GAAqC,MAAjCjC,EAAMysC,yBAA6D,MAA1BzsC,EAAM+sC,iBACjD,OAAO1lD,EAAAC,EAAAC,cAACinD,GAAD,CAAgBtjC,YAAa+5B,GAAMj6B,UAAWrlB,KAAKuoD,kBAAkBluC,qDAIxD,IACfA,EADenZ,OAAAC,EAAA,EAAAD,CACLlB,KAAKsc,QADA,MAEtB,GAA8B,MAA1BjC,EAAM+sC,iBACR,OAAO1lD,EAAAC,EAAAC,cAACknD,GAAD,CAAmBhE,QAASzqC,EAAM+sC,iBAAkBlC,OAAQllD,KAAKsoD,2BAjHnDjqD,IAAMuf,eAA3BoqC,GACGe,YAAcrC,GAqHvB,IAMesC,GANH,kBACVtnD,EAAAC,EAAAC,cAAC8lD,GAAD,KACEhmD,EAAAC,EAAAC,cAACqnD,GAAD,eC7HgB/E,QACW,cAA7B1lD,OAAOmtB,SAASu9B,UAEe,UAA7B1qD,OAAOmtB,SAASu9B,UAEhB1qD,OAAOmtB,SAASu9B,SAASC,MAAM,+DCU7BC,cAEJ,SAAAA,EAAmBC,GAAqBnoD,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAAopD,GAAAppD,KAAAqpD,WAAArpD,KADxCspD,OAAkB,6DAEJ92B,GACZ,IAAM+2B,EAjBV,SAAe/2B,EAAc62B,GAG3B,IAFA,IAAMvS,EAAQ3jC,MAAMwrB,KAAKnM,EAAMg3B,oBACzB1E,EAAiB,GACvBplD,EAAA,EAAA+pD,EAA8BvoD,OAAOwoD,QAAQL,GAA7C3pD,EAAA+pD,EAAA7pD,OAAAF,IAAwD,KAAAi7B,EAAA8uB,EAAA/pD,GAAA4I,EAAApH,OAAAC,EAAA,EAAAD,CAAAy5B,EAAA,GAA5CpzB,EAA4Ce,EAAA,GAChD6+C,GAASwC,EADuCrhD,EAAA,IAC/BwuC,EAAOtkB,GAC9BsyB,EAAQv9C,GAAQ4/C,EAElB,OAAOrC,EAUS8E,CAAMp3B,EAAOxyB,KAAKqpD,UAChCrpD,KAAKspD,OAAO9pD,KAAK+pD,0CAGjB,OAAOroD,OAAOsC,KAAKxD,KAAKqpD,mBAItBQ,cACJ,SAAAA,EAAmBC,GAA4B5oD,OAAA6V,EAAA,EAAA7V,CAAAlB,KAAA6pD,GAAA7pD,KAAA8pD,wEAEjCt3B,GAAc,IAAAltB,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAC1B,QAAAoF,EAAAC,EAAgB1F,KAAK8pD,YAArBnkD,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAkC,CAAAG,EAAA/E,MAC9BqpD,cAAcv3B,IAFQ,MAAAxsB,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,aAO9B,SAASwkD,GAASC,EAAkC3qD,GAClD8iB,QAAQggC,IAAI,WAmCZ,IAlCA,IAAM8H,EAAQ,IAAIL,GAAgB,CAChC,IAAIT,GAAW,CACbe,SAAU,SAACjlD,GAAD,OAAOA,EAAEoC,OAAO,SAACoK,GAAD,OAAUA,EAAKijB,cAAgB1B,KAAKrzB,UAEhE,IAAIwpD,GAAW,CACbgB,UAAW,SAACllD,GAAD,OAAOA,EAAEoC,OAAO,SAACoK,GAAD,OAAUA,EAAKijB,cAAgBpB,KAAM3zB,UAElE,IAAIwpD,GAAW,CACbiB,UAAW,SAACnlD,GAAD,OAAOA,EAAEoC,OAAO,SAACoK,GAAD,OAAUA,EAAKijB,cAAgBrB,KAAM1zB,UAElE,IAAIwpD,GAAW,CACbkB,cAAe,SAACplD,GAAD,OAAOA,EAAEoC,OAAO,SAACoK,GAAD,OAAUA,EAAKijB,cAAgBmI,KAAUl9B,UAE1E,IAAIwpD,GAAW,CACbpc,QAAS,SAACtgC,EAAGsjB,GAAJ,OAAUA,EAAEyB,OAAOsB,IAAIr0B,KAElC,IAAI0qD,GAAW,CACbmB,oBAAqB,SAAC79C,EAAGsjB,GACvB,IAAMw6B,ECjEP,SAAiCh4B,EAAci4B,GACpD,IAAkDvlD,EAC5CwlD,EAAwB,IAAI5K,IAFuDx6C,GAAA,EAAAC,GAAA,EAAAC,OAAAnF,EAAA,IAGzF,QAAAoF,EAAAC,EAAqB8sB,EAAMqD,WAA3BlwB,OAAAC,cAAAN,GAAAG,EAAAC,EAAAG,QAAAC,MAAAR,GAAA,EAAuC,KAA5BwwB,EAA4BrwB,EAAA/E,MACrC,GAAIo1B,aAAkB2D,KAH0Bv0B,EAGF4wB,EAHQtD,EAAMf,OAAOuV,WAAW9hC,IAGvB,KAAAyT,GAAA,EAAAC,GAAA,EAAAC,OAAAxY,EAAA,IACrD,QAAAyY,EAAAC,EAA2ByZ,EAAMgC,cAAcsB,EAAO/C,KAAtDptB,OAAAC,cAAA+S,GAAAG,EAAAC,EAAAlT,QAAAC,MAAA6S,GAAA,EAA4D,KAAAgiB,EAAA7hB,EAAApY,MAA9Cg0B,EAA8CxzB,OAAAC,EAAA,EAAAD,CAAAy5B,EAAA,MACpDjG,aAAoBlB,IAAYkB,EAASgF,aAC5B,MAAb+wB,EACFC,EAAW71B,IAAIH,GACN+1B,EAAU/1B,IACnBg2B,EAAW71B,IAAIH,KANgC,MAAA1uB,GAAA4S,GAAA,EAAAC,EAAA7S,EAAA,YAAA2S,GAAA,MAAAI,EAAA9S,QAAA8S,EAAA9S,SAAA,WAAA2S,EAAA,MAAAC,MAJgC,MAAA7S,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAI,EAAAO,QAAAP,EAAAO,SAAA,WAAAV,EAAA,MAAAC,GAgBzF,OAAOklD,EDiDqBC,CAAwB36B,EAAG,SAAC9qB,GAAD,OAAOA,aAAaquB,KACjExK,EAAQ,EAFiBpQ,GAAA,EAAAC,GAAA,EAAAC,OAAAxY,EAAA,IAG7B,QAAAyY,EAAAC,EAAgByxC,EAAhB7kD,OAAAC,cAAA+S,GAAAG,EAAAC,EAAAlT,QAAAC,MAAA6S,GAAA,EAA+B,KAApBzT,EAAoB4T,EAAApY,MACzBspB,GAAa9kB,KACf6jB,GAAS7jB,EAAEglB,UAAUnB,QALI,MAAA/iB,GAAA4S,GAAA,EAAAC,EAAA7S,EAAA,YAAA2S,GAAA,MAAAI,EAAA9S,QAAA8S,EAAA9S,SAAA,WAAA2S,EAAA,MAAAC,GAQ7B,OAAOkQ,KAGX,IAAIqgC,GAAW,CACbwB,YAAa,SAAC1lD,GACZ,OAAOA,EAAEw7B,OAAO,SAAC1Q,EAAGte,GAAJ,OAAase,GAAKhG,GAAatY,GAAQA,EAAKwY,UAAUnB,MAAQ,IAAI,QAI/ElkB,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAC3Bud,QAAQjjB,KAAK,SAAW0F,GACxB,IAAM2tB,EAAQ,IAAIhB,GAAMy4B,IAAiBt1C,MACzCu1C,EAAMH,cAAcv3B,GACpBpQ,QAAQyoC,QAAQ,SAAWhmD,IAU/B,SAAwBilD,EAA2BgB,GACjD,IAAM3U,EAAO,GACP4U,EAAQjB,EAAYniD,IAAI,SAAC8F,GAAD,OAAOA,EAAEu9C,eAAehiD,KAAK,MAC3D,IAAK,IAAMia,KAAO8nC,EAAO,CAIvB,IAHA,IAAMxjD,EAAOwjD,EAAM9nC,GACb1kB,EAAI,GACJG,EAAI,GACDmG,EAAI,EAAGA,EAAIilD,EAAY,GAAGR,OAAO1pD,OAAQiF,IAAK,CACrDtG,EAAEiB,KAAKqF,GAEP,IAAM4I,EAAIq8C,EAAY7mC,GAChBsmC,EAAQ97C,EAAE67C,OAAOzkD,GACjBnE,EAAQ6oD,EAAMhiD,GACpB7I,EAAEc,KAAKkB,GAET,IAAMuqD,EAA2B,CAC/B1sD,IACAG,IACA6I,OACAuD,KAAM,OAERqrC,EAAK32C,KAAKyrD,GAEZ,IAEMtkC,EAAMhK,SAAS/a,cAAc,OACxB+a,SAASuuC,eAAeJ,GAChC1lC,YAAYuB,GACfnoB,OAAO2sD,OAAOC,QAAQzkC,EAAKwvB,EALG,CAAEkV,QAAS,UA9BzCC,CAAepB,EAAMJ,YAAYz8C,MAAM,EAAG,GAAI/N,GA3CgB,IAAA+1B,GAAA,EAAAC,GAAA,EAAAC,OAAAl1B,EAAA,IA6C9D,QAAAo0B,EAAAgB,EAAgBy0B,EAAMJ,YAAtBnkD,OAAAC,cAAAyvB,GAAAZ,EAAAgB,EAAA5vB,QAAAC,MAAAuvB,GAAA,EAAmC,CACjCk2B,GADiC92B,EAAA/zB,MAChBpB,IA9C2C,MAAA0G,GAAAsvB,GAAA,EAAAC,EAAAvvB,EAAA,YAAAqvB,GAAA,MAAAI,EAAAxvB,QAAAwvB,EAAAxvB,SAAA,WAAAqvB,EAAA,MAAAC,IAiFhE,SAASg2B,GAAchX,EAAmBuW,GACxC,IAAM3U,EAAO,GACPqV,EAA0B,GAFuB/zB,GAAA,EAAAC,GAAA,EAAAC,OAAAt3B,EAAA,IAIvD,IAJuD,IAIvDm1B,EAJuDi2B,EAAA,eAI5ClkD,EAJ4CiuB,EAAA90B,MAKjDuqD,EAA2B,CAC7B1sD,EAAGg2C,EAAM+U,OAAO3hD,IAAI,SAACzC,GAAD,OAAOA,EAAEqC,KAC7BuD,KAAM,YACNvD,KAAMA,GAER4uC,EAAK32C,KAAKyrD,GAEVO,EAAOrjD,MAAQ,CACbujD,KAAMnkD,IATVswB,EAAmB0c,EAAMyW,eAAzBrlD,OAAAC,cAAA6xB,GAAAjC,EAAAqC,EAAAhyB,QAAAC,MAAA2xB,GAAA,EAAyC,KACnCwzB,EADmCQ,KAJc,MAAAzlD,GAAA0xB,GAAA,EAAAC,EAAA3xB,EAAA,YAAAyxB,GAAA,MAAAI,EAAA5xB,QAAA4xB,EAAA5xB,SAAA,WAAAyxB,EAAA,MAAAC,GAgBvD,IAAMhR,EAAMhK,SAAS/a,cAAc,OACxB+a,SAASuuC,eAAeJ,GAChC1lC,YAAYuB,GACfA,EAAIxY,MAAMK,OAAS,QACnBmY,EAAIxY,MAAM/F,MAAQ,QAClBue,EAAIxY,MAAMw9C,QAAU,eACpBntD,OAAO2sD,OAAOC,QAAQzkC,EAAKwvB,EAAMqV,GAgCpBI,OA7Bf,WAaE,OAZAvtD,IAAMiD,UAAU,WACd,IAAIuqD,EAASlvC,SAAS/a,cAAc,UACpCiqD,EAAOlpD,IAAM,2CACbkpD,EAAOjvC,iBAAiB,OAAQ,WAC9BotC,GAASjN,GAAW,aACpBiN,GAASrM,GAAO,SAChBqM,GAAStM,GAAQ,YAGnB/gC,SAAS/M,KAAKwV,YAAYymC,IACzB,IAGDnqD,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,yBACAF,EAAAC,EAAAC,cAAA,OAAKtC,GAAG,aACNoC,EAAAC,EAAAC,cAAA,wBAEFF,EAAAC,EAAAC,cAAA,OAAKtC,GAAG,SACNoC,EAAAC,EAAAC,cAAA,oBAEFF,EAAAC,EAAAC,cAAA,OAAKtC,GAAG,UACNoC,EAAAC,EAAAC,cAAA,uBExKRkqD,IAAShpC,OACPphB,EAAAC,EAAAC,cAACmqD,EAAA,EAAD,KACErqD,EAAAC,EAAAC,cAACoqD,EAAA,EAAD,KACEtqD,EAAAC,EAAAC,cAACoqD,EAAA,EAAD,CAAOC,KAAK,aACVvqD,EAAAC,EAAAC,cCLD,WACL,IAAM4wB,EAAQ,IAAIhB,GAAMurB,KAAapoC,MACrC6d,EAAMrzB,KAAO,IACb,IAAM+sD,EAAK,IAAI73B,GAAM,IAAIpiB,WAAQ,EAAG,GAAIugB,GACxC05B,EAAGtoB,mBAAmB/O,IAAI,GAAI,IAC9Bq3B,EAAGroB,YAAc,IAEjBrR,EAAMrzB,KAAO,IACb,IAAMgtD,EAAK,IAAI93B,GAAM,IAAIpiB,WAAQ,EAAG,GAAIugB,GACxC25B,EAAGvoB,mBAAmB/O,IAAI,GAAI,IAE9BrC,EAAMrzB,KAAO,KACb,IAAMitD,EAAK,IAAI/3B,GAAM,IAAIpiB,WAAQ,EAAG,GAAIugB,GACxC45B,EAAGxoB,mBAAmB/O,IAAI,GAAI,IAC9B,IAAMw3B,EAA0B,CAC9BroC,OAAQ,MACRuO,OAAQ,CAAC25B,EAAIC,EAAIC,GACjBr2C,uBAAwB,EACxByc,SAEF,OAAO9wB,EAAAC,EAAAC,cAACknD,GAAD,CAAmBhE,QAASuH,EAAanH,OAAQ,gBDflD,OAEFxjD,EAAAC,EAAAC,cAACoqD,EAAA,EAAD,CAAOC,KAAK,eACVvqD,EAAAC,EAAAC,cAAC0qD,GAAD,OAEF5qD,EAAAC,EAAAC,cAACoqD,EAAA,EAAD,CAAOO,OAAK,EAACN,KAAK,KAChBvqD,EAAAC,EAAAC,cAAC4qD,GAAD,OAEF9qD,EAAAC,EAAAC,cAACoqD,EAAA,EAAD,CAAOC,KAAK,KACVvqD,EAAAC,EAAAC,cAACoqD,EAAA,EAAD,CAAUS,GAAG,SAKnB9vC,SAASuuC,eAAe,SHmGpB,kBAAmBwB,WACrBA,UAAUC,cAAcC,MAAMC,KAAK,SAACC,GAClCA,EAAaC,mCKjInBC,EAAAC,QAAiBC,EAAA1kD,EAAuB,oDCAxCwkD,EAAAC,QAAA,+rCCAAD,EAAAC,QAAA,y1DCAAD,EAAAC,QAAiBC,EAAA1kD,EAAuB,0DCAxCwkD,EAAAC,QAAiBC,EAAA1kD,EAAuB,6DCAxCwkD,EAAAC,QAAiBC,EAAA1kD,EAAuB,2DCAxCwkD,EAAAC,QAAiBC,EAAA1kD,EAAuB,0DCAxCwkD,EAAAC,QAAiBC,EAAA1kD,EAAuB,sDCAxCwkD,EAAAC,QAAiBC,EAAA1kD,EAAuB,4ECAxCwkD,EAAAC,QAAiBC,EAAA1kD,EAAuB,0DCAxCwkD,EAAAC,QAAiBC,EAAA1kD,EAAuB","file":"static/js/main.1d66b553.chunk.js","sourcesContent":["import React, { useContext } from \"react\";\r\n\r\nexport const MousePositionContext = React.createContext({\r\n  x: window.innerWidth / 2,\r\n  y: window.innerHeight / 2\r\n});\r\n\r\nfunction useMousePosition() {\r\n  return useContext(MousePositionContext);\r\n}\r\n\r\nexport default useMousePosition;\r\n","\r\nexport type TickerCallback = (time: number) => boolean | void;\r\nclass TickerClass {\r\n  private tickerId = 1;\r\n\r\n  private tickers: Record<number, TickerCallback> = {};\r\n\r\n  private _time = 0;\r\n\r\n  get now() {\r\n    return this._time;\r\n  }\r\n\r\n  tickerLoop = (time: number) => {\r\n    this._time = time;\r\n    const toDelete: number[] = [];\r\n    for (const id in this.tickers) {\r\n      const f = this.tickers[id];\r\n      const shouldDelete = f(time);\r\n      if (shouldDelete === true) {\r\n        toDelete.push(Number(id));\r\n      }\r\n    }\r\n    for (const id of toDelete) {\r\n      this.removeAnimation(id);\r\n    }\r\n    requestAnimationFrame(this.tickerLoop);\r\n  }\r\n\r\n  /**\r\n   * Return true to kill the ticker.\r\n   */\r\n  public addAnimation(fn: TickerCallback) {\r\n    const id = this.tickerId++;\r\n    this.tickers[id] = fn;\r\n    return id;\r\n  }\r\n\r\n  public removeAnimation(id: number) {\r\n    return delete this.tickers[id];\r\n  }\r\n\r\n  public start() {\r\n    requestAnimationFrame(this.tickerLoop);\r\n  }\r\n}\r\n\r\nconst Ticker = new TickerClass();\r\nTicker.start();\r\n\r\nexport default Ticker;\r\n","import React from \"react\";\r\nimport Ticker from \"global/ticker\";\r\n\r\ninterface DynamicNumberProps {\r\n  value: number;\r\n  speed?: number;\r\n  formatter?: Intl.NumberFormat;\r\n}\r\n\r\nconst NUMBER_FORMATTER = new Intl.NumberFormat(undefined, {\r\n  maximumFractionDigits: 2,\r\n  useGrouping: true\r\n});\r\n\r\nfunction DynamicNumber({\r\n  value,\r\n  speed = 0.1,\r\n  formatter = NUMBER_FORMATTER\r\n}: DynamicNumberProps) {\r\n  const [v, setV] = React.useState(value);\r\n\r\n  React.useEffect(() => {\r\n    const id = Ticker.addAnimation(() => {\r\n      setV(v => {\r\n        if (Math.abs(v - value) < 5e-3) {\r\n          Ticker.removeAnimation(id);\r\n          return value;\r\n        } else {\r\n          return v * (1 - speed) + value * speed;\r\n        }\r\n      });\r\n    });\r\n    return () => {\r\n      Ticker.removeAnimation(id);\r\n    };\r\n  }, [value, speed]);\r\n\r\n  return <>{formatter.format(v)}</>;\r\n}\r\n\r\nexport default DynamicNumber;\r\n","import React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport \"./Button.scss\";\r\n\r\nexport function Button(props: JSX.IntrinsicElements[\"button\"] & { color?: \"purple\" | \"green\" }) {\r\n  return <button {...props} className={classNames(\"button\", props.className, props.color || \"purple\")}>{props.children}</button>;\r\n}\r\n","import classNames from \"classnames\";\r\nimport React from \"react\";\r\n\r\nimport characterSrc from \"assets/images/character.png\";\r\n\r\nimport \"./Character.scss\";\r\n\r\nfunction Character(props: JSX.IntrinsicElements[\"img\"] & { size?: \"xs\" | \"small\" | \"medium\" | \"large\" }) {\r\n  const { size, ...otherProps } = props;\r\n  return (\r\n    <img\r\n      className={classNames(\"character\", size)}\r\n      alt=\"\"\r\n      src={characterSrc}\r\n      {...otherProps}\r\n    />\r\n  );\r\n}\r\n\r\nexport default Character;\r\n","import React from \"react\";\r\nimport { GiDna1 } from \"react-icons/gi\";\r\n\r\nimport \"./MP.scss\";\r\nimport classNames from \"classnames\";\r\nimport DynamicNumber from \"./DynamicNumber\";\r\n\r\nexport type MPProps = JSX.IntrinsicElements[\"div\"] & {\r\n  amount: number;\r\n  total?: number;\r\n}\r\n\r\nconst MP_NUMBER_FORMATTER = new Intl.NumberFormat(undefined, {\r\n  maximumFractionDigits: 0,\r\n  useGrouping: true,\r\n});\r\n\r\nfunction MP({ amount, total, ...props }: MPProps) {\r\n  return (\r\n    <div {...props} className={classNames(\"mp\", props.className)}>\r\n      <DynamicNumber speed={0.3} formatter={MP_NUMBER_FORMATTER} value={amount} />\r\n      {total != null ? <>/{total}</> : null}\r\n      <GiDna1 className=\"mp-icon\" />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MP;\r\n","function capitalize(s: String) {\r\n  return s.substr(0, 1).toLocaleUpperCase() + s.substr(1);\r\n}\r\n\r\nexport default capitalize;\r\n","import capitalize from \"../common/capitalize\";\r\nimport { DNATuple, Gene } from \"./gene\";\r\n\r\nexport type TraitValue = -3 | -2 | -1 | 0 | 1 | 2 | 3;\r\n\r\nexport type Traits = {\r\n  /**\r\n   * How fast the cell walks across this tile. Higher is faster.\r\n   */\r\n  walkSpeed: TraitValue;\r\n  /**\r\n   * How slower the cell consumes energy. Higher is lower energy usage\r\n   * for the same behavior.\r\n   */\r\n  energyEfficiency: TraitValue;\r\n  /**\r\n   * How well this cell photosynthesizes. Higher is faster photosynthesis.\r\n   */\r\n  photosynthesis: TraitValue;\r\n  /**\r\n   * How well this cell absorbs nutrients and water from roots. Higher is\r\n   * faster absorption rate.\r\n   */\r\n  rootAbsorption: TraitValue;\r\n  /**\r\n   * How many resources this cell can carry.\r\n   */\r\n  carryCapacity: TraitValue;\r\n  /**\r\n   * Whether this cell actively transports water. Higher means faster\r\n   * water transport.\r\n   */\r\n  activeTransportWater: TraitValue;\r\n  /**\r\n   * Whether this cell actively transports sugar. Higher means faster\r\n   * sugar transport.\r\n   */\r\n  activeTransportSugar: TraitValue;\r\n  /**\r\n   * How stable this cell is against gravity, weight, and wind forces.\r\n   * Higher is more stable.\r\n   */\r\n  structuralStability: TraitValue;\r\n  /**\r\n   * How easily this cell passively diffuses water. Higher means faster diffusion.\r\n   */\r\n  diffuseWater: TraitValue;\r\n  /**\r\n   * How easily this cell passively diffuses sugar. Higher means faster diffusion.\r\n   */\r\n  diffuseSugar: TraitValue;\r\n  /**\r\n   * How quickly this cell builds.\r\n   */\r\n  buildTime: TraitValue;\r\n  /**\r\n   * How well this cell still works at high temperatures.\r\n   */\r\n  heatTolerant: TraitValue;\r\n  /**\r\n   * How well this cell still works at low temperatures.\r\n   */\r\n  coldTolerant: TraitValue;\r\n  /**\r\n   * How many resources a seed needs to be considered \"matured\". Lower is less resources.\r\n   */\r\n  fruitNeededResources: TraitValue;\r\n  /**\r\n   * How quickly a seed finishes growing. Higher is faster growth.\r\n   */\r\n  fruitGrowthSpeed: TraitValue;\r\n  /**\r\n   * How many mutation points a seed gives. Higher is more mutation.\r\n   */\r\n  fruitMutationPoints: TraitValue;\r\n};\r\n\r\nexport type TraitDiff = Partial<Traits> & {\r\n  [traitName: string]: TraitValue;\r\n};\r\n\r\nexport type TraitType = keyof Traits;\r\n\r\nexport function emptyTraits(): Traits {\r\n  return {\r\n    carryCapacity: 0,\r\n    energyEfficiency: 0,\r\n    photosynthesis: 0,\r\n    rootAbsorption: 0,\r\n    structuralStability: 0,\r\n    activeTransportSugar: 0,\r\n    activeTransportWater: 0,\r\n    walkSpeed: 0,\r\n    diffuseWater: 0,\r\n    diffuseSugar: 0,\r\n    buildTime: 0,\r\n    heatTolerant: 0,\r\n    coldTolerant: 0,\r\n    fruitGrowthSpeed: 0,\r\n    fruitMutationPoints: 0,\r\n    fruitNeededResources: 0,\r\n  };\r\n}\r\n\r\nexport function isInteresting(traits: Traits) {\r\n  return TRAIT_TYPES.some((name) => traits[name] !== 0);\r\n}\r\n\r\nexport const TRAIT_TYPES = Object.keys(emptyTraits()) as TraitType[];\r\n\r\nexport function displayName(trait: TraitType) {\r\n  const splits = trait.split(/([A-Z])+/g);\r\n  let displayName = capitalize(splits[0]);\r\n  for (let i = 1; i < splits.length; i += 2) {\r\n    displayName += \" \" + splits[i] + splits[i + 1];\r\n  }\r\n  return displayName;\r\n}\r\n\r\n/**\r\n * Mutates source.\r\n * @param source source\r\n * @param modifier modifier\r\n */\r\nexport function addTraits(source: TraitDiff, modifier: TraitDiff) {\r\n  for (const traitType in modifier) {\r\n    source[traitType] = clampToTraitValue((source[traitType] || 0) + modifier[traitType]!);\r\n  }\r\n}\r\n\r\nexport function clampToTraitValue(t: number): TraitValue {\r\n  return (t < -3 ? -3 : t > 3 ? 3 : t) as TraitValue;\r\n}\r\n\r\nexport function getTraits(genes: Gene[]): Traits {\r\n  const traits: Traits = emptyTraits();\r\n  for (const gene of genes) {\r\n    const traitDiff = getTraitInfluence(gene);\r\n    addTraits(traits, traitDiff);\r\n  }\r\n  return traits;\r\n}\r\n\r\nexport function getTraitInfluence(gene: Gene): TraitDiff {\r\n  const traitDiff: TraitDiff = {};\r\n  const traitTypePlus = dnaPairToTraitType(gene[0]);\r\n  if (traitTypePlus != null) {\r\n    traitDiff[traitTypePlus] = 1;\r\n  }\r\n\r\n  const traitTypeMinus = dnaPairToTraitType(gene[1]);\r\n  if (traitTypeMinus != null) {\r\n    traitDiff[traitTypeMinus] = -1;\r\n  }\r\n  return traitDiff;\r\n}\r\n\r\nexport function dnaPairToTraitType(dnaTuple: DNATuple): TraitType | undefined {\r\n  switch (dnaTuple) {\r\n    case \"AA\":\r\n      return \"walkSpeed\";\r\n    case \"AC\":\r\n      return \"energyEfficiency\";\r\n    case \"AG\":\r\n      return \"photosynthesis\";\r\n    case \"AT\":\r\n      return \"rootAbsorption\";\r\n\r\n    case \"CA\":\r\n      return \"carryCapacity\";\r\n    case \"CC\":\r\n      return \"activeTransportSugar\";\r\n    case \"CG\":\r\n      return \"activeTransportWater\";\r\n    case \"CT\":\r\n      return \"structuralStability\";\r\n\r\n    case \"GA\":\r\n      return \"diffuseSugar\";\r\n    case \"GC\":\r\n      return \"diffuseWater\";\r\n    case \"GG\":\r\n      return \"buildTime\";\r\n    case \"GT\":\r\n      return \"heatTolerant\";\r\n\r\n    case \"TA\":\r\n      return \"coldTolerant\";\r\n    case \"TC\":\r\n      return \"fruitGrowthSpeed\";\r\n    case \"TG\":\r\n      return \"fruitMutationPoints\";\r\n    case \"TT\":\r\n      return \"fruitNeededResources\";\r\n  }\r\n}\r\n\r\n/**\r\n * Use to easily modify a base value by a trait amount.\r\n *\r\n * Exponent > 1 means base goes up with trait.\r\n * Exponent < 1 means base goes down with trait.\r\n */\r\nexport function traitMod(val: TraitValue, base: number, exponent: number) {\r\n  return base * Math.pow(exponent, val);\r\n}\r\n","import React, { useState } from \"react\";\r\n\r\nimport \"./Expand.scss\";\r\nimport classNames from \"classnames\";\r\n\r\ninterface ExpandProps {\r\n  className?: string;\r\n  children: React.ReactNode;\r\n  shrunkElements: React.ReactNode;\r\n}\r\n\r\nfunction Expand({ className, children, shrunkElements }: ExpandProps) {\r\n  const [expanded, setExpanded] = useState(false);\r\n\r\n  const handleExpandClick = () => {\r\n    setExpanded(!expanded);\r\n  };\r\n\r\n  return (\r\n    <div className={classNames(className, \"expand\")}>\r\n      <div className=\"expand-button\" onClick={handleExpandClick}>\r\n        {shrunkElements}\r\n        <div className=\"expand-caret\">{expanded ? \"▼\" : \"▶\"}</div>\r\n      </div>\r\n      {expanded ? <div>{children}</div> : null}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Expand;\r\n","import React from \"react\";\r\nimport classNames from \"classnames\";\r\n\r\nimport { Traits, TRAIT_TYPES, displayName } from \"./traits\";\r\nimport Expand from \"../common/Expand\";\r\n\r\nimport \"./TraitDisplay.scss\";\r\n\r\nfunction TraitDisplay({ traits }: { traits: Traits }) {\r\n  const nonzeroTraits = TRAIT_TYPES.filter((name) => traits[name] !== 0);\r\n  nonzeroTraits.sort((a, b) => traits[b] - traits[a]);\r\n  const nonzeroTraitEl = nonzeroTraits.length > 0 ? (\r\n    <div className=\"interesting-traits\">{nonzeroTraits.map((trait) => (\r\n      <div className={classNames(\"trait\", { green: traits[trait] > 0, red: traits[trait] < 0 })} key={trait}>\r\n        {displayName(trait)}: {traits[trait]}\r\n      </div>\r\n    ))}</div>\r\n  ) : (\r\n      <div className=\"no-interesting-traits\">All traits are zero.</div>\r\n    );\r\n\r\n  const zeroTraits = TRAIT_TYPES.filter((name) => traits[name] === 0);\r\n  const zeroTraitEl = (\r\n    <div className=\"zero-traits\">\r\n      {zeroTraits.map((trait) => (\r\n        <div className=\"trait\" key={trait}>\r\n          {displayName(trait)}: {traits[trait]}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n  return (\r\n    <div className=\"trait-display\">\r\n      {nonzeroTraitEl}\r\n      <Expand shrunkElements={<div className=\"expand-toggle\">Show All</div>}>\r\n        {zeroTraitEl}\r\n      </Expand>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TraitDisplay;\r\n","import React from \"react\";\r\nimport { Gene } from \"./gene\";\r\nimport { dnaPairToTraitType } from \"./traits\";\r\n\r\nimport \"./GeneDisplay.scss\";\r\n\r\nfunction GeneComponent({ gene, onClick }: { gene: Gene, onClick: (position: number) => void }) {\r\n  return (\r\n    <div className=\"gene\">\r\n      <div className=\"gene-number\">\r\n        <span className=\"tuple-plus\" title={dnaPairToTraitType(gene[0]) + \" +1\"}>\r\n          <span className=\"dna\" onClick={() => onClick(0)}>{gene[0][0]}</span>\r\n          <span className=\"dna\" onClick={() => onClick(1)}>{gene[0][1]}</span>\r\n        </span>\r\n        <span className=\"tuple-minus\" title={dnaPairToTraitType(gene[1]) + \" -1\"}>\r\n          <span className=\"dna\" onClick={() => onClick(2)}>{gene[1][0]}</span>\r\n          <span className=\"dna\" onClick={() => onClick(3)}>{gene[1][1]}</span>\r\n        </span>\r\n      </div>\r\n      <div className=\"gene-visual\"><img alt=\"\" src=\"https://media2.giphy.com/media/YlmI36YAWe7KScC7hK/giphy.gif\" width=\"44px\" /></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport interface GeneDisplayProps {\r\n  genes: Gene[];\r\n  onClick: (gene: Gene, position: number) => void;\r\n}\r\n\r\nfunction GeneDisplay({ genes, onClick }: GeneDisplayProps) {\r\n  const geneContent = genes.length > 0 ? (\r\n    <div className=\"genes-container\">\r\n      {genes.map((gene, i) => (\r\n        <GeneComponent key={i} gene={gene} onClick={(p) => onClick(gene, p)} />\r\n      ))}\r\n    </div>\r\n  ) : (\r\n      <div className=\"genes-empty\">\r\n        No genes.\r\n      </div>\r\n    );\r\n  return (\r\n    <div className=\"gene-display\">\r\n      {geneContent}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default GeneDisplay;\r\n","import React from \"react\";\r\nimport TraitDisplay from \"./TraitDisplay\";\r\nimport { getTraits } from \"./traits\";\r\nimport GeneDisplay, { GeneDisplayProps } from \"./GeneDisplay\";\r\n\r\nimport \"./GenesToTraits.scss\";\r\n\r\nimport { Gene } from \"./gene\";\r\n\r\nexport interface GenesToTraitsProps {\r\n  genes: Gene[];\r\n  onClick: GeneDisplayProps[\"onClick\"];\r\n}\r\n\r\nfunction GenesToTraits({ genes, onClick }: GenesToTraitsProps) {\r\n  const traits = React.useMemo(() => {\r\n    return getTraits(genes);\r\n  }, [genes]);\r\n\r\n  return (\r\n    <div className=\"genes-to-traits\">\r\n      <div className=\"genes-details\">\r\n        <h3>Genes</h3>\r\n        <GeneDisplay genes={genes} onClick={onClick} />\r\n      </div>\r\n      <div className=\"arrow\">⇒</div>\r\n      <div className=\"traits-details\">\r\n        <h3>Traits</h3>\r\n        <TraitDisplay traits={traits} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default GenesToTraits;\r\n","import { Gene, DNATuple, DNA } from \"./gene\";\r\n\r\nexport function mutateRandomNewGene(): Gene {\r\n  const tuplePlus = randomDNATuple();\r\n  const tupleMinus = randomDNATuple();\r\n  return [tuplePlus, tupleMinus];\r\n}\r\n\r\nexport function mutateSwapDNA(gene1: Gene, position1: number, gene2: Gene, position2: number): [Gene, Gene] {\r\n  const gene1Str = gene1.join(\"\");\r\n  const gene2Str = gene2.join(\"\");\r\n  const dnaPosition1 = gene1Str.charAt(position1);\r\n  const dnaPosition2 = gene2Str.charAt(position2);\r\n\r\n  const newGeneStr1 = gene1Str.substr(0, position1) + dnaPosition2 + gene1Str.substr(position1 + 1);\r\n  const newGeneStr2 = gene2Str.substr(0, position2) + dnaPosition1 + gene2Str.substr(position2 + 1);\r\n\r\n  const newGene1 = strToGene(newGeneStr1);\r\n  const newGene2 = strToGene(newGeneStr2);\r\n  return [newGene1, newGene2];\r\n}\r\n\r\nexport function mutatePosition(gene: Gene, position: number): Gene {\r\n  const geneStr = gene.join(\"\");\r\n  const newGeneStr = geneStr.substr(0, position) + randomNewDNA(geneStr.charAt(position) as DNA) + geneStr.substr(position + 1);\r\n  const newGene = strToGene(newGeneStr);\r\n  return newGene;\r\n}\r\n\r\nfunction strToGene(str: string): Gene {\r\n  return [str.substr(0, 2), str.substr(2)] as Gene;\r\n}\r\n\r\nfunction randomDNATuple(): DNATuple {\r\n  const dna1 = randomDNA();\r\n  const dna2 = randomDNA();\r\n  return (dna1 + dna2) as DNATuple;\r\n}\r\n\r\nfunction randomNewDNA(old: DNA) {\r\n  let d: DNA;\r\n  do {\r\n    d = randomDNA();\r\n  } while (d === old);\r\n  return d;\r\n}\r\n\r\nfunction randomDNA(): DNA {\r\n  const r = Math.random();\r\n  if (r < 0.25) {\r\n    return \"A\";\r\n  } else if (r < 0.5) {\r\n    return \"C\";\r\n  } else if (r < 0.75) {\r\n    return \"G\";\r\n  } else {\r\n    return \"T\";\r\n  }\r\n}\r\n","import classNames from \"classnames\";\r\nimport React from \"react\";\r\nimport uuid from \"uuid\";\r\nimport { Button } from \"../common/Button\";\r\nimport Character from \"../common/Character\";\r\nimport MP from \"../common/MP\";\r\nimport { Gene } from \"./gene\";\r\nimport GenesToTraits from \"./GenesToTraits\";\r\nimport { mutatePosition, mutateRandomNewGene, mutateSwapDNA } from \"./mutation\";\r\nimport \"./MutationScreen.scss\";\r\nimport { Species } from \"./species\";\r\n\r\n\r\n\r\nfunction MutationScreen({ species, onCommit }: { species: Species, onCommit: (newSpecies: Species, newPool: number) => void }) {\r\n  // const [pool, setPool] = React.useState(species.freeMutationPoints);\r\n  const pool = species.freeMutationPoints;\r\n  const setPool = (arg: number | ((p: number) => number)) => {\r\n    if (typeof arg === \"number\") {\r\n      species.freeMutationPoints = arg;\r\n    } else {\r\n      species.freeMutationPoints = arg(pool);\r\n    }\r\n  };\r\n\r\n  const [newSpecies, setNewSpecies] = React.useState<Species>({\r\n    id: uuid(),\r\n    descendants: [],\r\n    freeMutationPoints: 0,\r\n    totalMutationPoints: 0,\r\n    genes: [...species.genes],\r\n    name: \"New species\",\r\n    parent: species,\r\n  });\r\n\r\n  type ClickModeSwap = {\r\n    type: \"swap\";\r\n    p1?: { gene: Gene; position: number; };\r\n  }\r\n  type ClickModeReroll = {\r\n    type: \"reroll\";\r\n  }\r\n  type ClickMode = ClickModeSwap | ClickModeReroll | undefined;\r\n  const [clickMode, setClickMode] = React.useState<ClickMode>();\r\n  const isSwapping = clickMode && clickMode.type === \"swap\";\r\n  const isRerolling = clickMode && clickMode.type === \"reroll\";\r\n\r\n  const newGeneCost = newSpecies.genes.length + 1;\r\n\r\n  const handleNewGene = () => {\r\n    setPool(p => p - newGeneCost);\r\n    setNewSpecies((species) => ({\r\n      ...species,\r\n      genes: [...species.genes, mutateRandomNewGene()],\r\n    }));\r\n  };\r\n\r\n  const startSwapClickMode = () => {\r\n    if (isSwapping) {\r\n      setClickMode(undefined);\r\n    } else {\r\n      setClickMode({ type: \"swap\" });\r\n    }\r\n  };\r\n\r\n  const startRerollClickMode = () => {\r\n    if (isRerolling) {\r\n      setClickMode(undefined);\r\n    } else {\r\n      setClickMode({ type: \"reroll\" });\r\n    }\r\n  };\r\n\r\n  function reroll(gene: Gene, position: number) {\r\n    setPool(p => p - 1);\r\n    setNewSpecies((species) => {\r\n      const geneIndex = species.genes.indexOf(gene);\r\n      const newGene = mutatePosition(gene, position);\r\n      const newGenes = [...species.genes.slice(0, geneIndex), newGene, ...species.genes.slice(geneIndex + 1)];\r\n      return {\r\n        ...species,\r\n        genes: newGenes,\r\n      };\r\n    });\r\n    setClickMode(undefined);\r\n  }\r\n\r\n  function swap(gene1: Gene, position1: number, gene2: Gene, position2: number) {\r\n    setPool(p => p - 2);\r\n    setNewSpecies((species) => {\r\n      const geneIndex1 = species.genes.indexOf(gene1);\r\n      const geneIndex2 = species.genes.indexOf(gene2);\r\n\r\n      const newGenes = [...species.genes];\r\n\r\n      const [newGene1, newGene2] = mutateSwapDNA(gene1, position1, gene2, position2);\r\n      newGenes[geneIndex1] = newGene1;\r\n      newGenes[geneIndex2] = newGene2;\r\n\r\n      return {\r\n        ...species,\r\n        genes: newGenes\r\n      };\r\n    });\r\n    setClickMode(undefined);\r\n  }\r\n\r\n  const handleGeneClick = (gene: Gene, position: number) => {\r\n    if (clickMode) {\r\n      if (clickMode.type === \"reroll\") {\r\n        reroll(gene, position);\r\n      } else if (clickMode.type === \"swap\") {\r\n        if (clickMode.p1 == null) {\r\n          clickMode.p1 = { gene, position };\r\n        } else {\r\n          swap(clickMode.p1.gene, clickMode.p1.position, gene, position);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleNewSpeciesName = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setNewSpecies(s => ({\r\n      ...s,\r\n      name: e.target.value,\r\n    }));\r\n  }\r\n\r\n  const handleCommit = () => {\r\n    onCommit(newSpecies, pool);\r\n  };\r\n\r\n  const isGenesChanged = React.useMemo(() => {\r\n    const genes1 = species.genes;\r\n    const genes2 = newSpecies.genes;\r\n\r\n    const isDifferentLengths = genes1.length !== genes2.length;\r\n    return isDifferentLengths || genes1.some((_, i) => genes1[i] !== genes2[i]);\r\n  }, [newSpecies.genes, species.genes]);\r\n\r\n  return (\r\n    <div className={classNames(\"mutation-screen\", { \"click-mode-active\": clickMode != null })}>\r\n      <div className=\"mutation-screen-content\">\r\n        <h1><Character size=\"medium\" /><span className=\"name\">{species.name}</span></h1>\r\n\r\n        <div className=\"buttons\">\r\n          <MP className=\"pool\" amount={pool} total={species.totalMutationPoints} />\r\n          <Button\r\n            onClick={handleNewGene}\r\n            disabled={pool < newGeneCost}\r\n          >\r\n            New Gene (<MP amount={newGeneCost} />)\r\n          </Button>\r\n\r\n          <Button\r\n            className={classNames({ \"is-cancel\": isSwapping })}\r\n            onClick={startSwapClickMode}\r\n            disabled={(!isSwapping && pool < 2) || newSpecies.genes.length === 0}\r\n          >\r\n            {isSwapping ? \"Cancel\" : <>Swap DNA (<MP amount={2} />)</>}\r\n          </Button>\r\n\r\n          <Button\r\n            className={classNames({ \"is-cancel\": isRerolling })}\r\n            onClick={startRerollClickMode}\r\n            disabled={(!isRerolling && pool < 1) || newSpecies.genes.length === 0}\r\n          >\r\n            {isRerolling ? \"Cancel\" : <>Re-roll DNA (<MP amount={1} />)</>}\r\n          </Button>\r\n        </div>\r\n\r\n        <GenesToTraits genes={newSpecies.genes} onClick={handleGeneClick} />\r\n        {isGenesChanged ? (\r\n          <>\r\n            <div className=\"arrow\">⇓</div>\r\n            <h1><Character size=\"medium\" /><input type=\"text\" className=\"name\" value={newSpecies.name} onChange={handleNewSpeciesName} /></h1>\r\n            <Button className=\"commit\" color=\"green\" onClick={handleCommit}>Commit</Button>\r\n          </>\r\n        ) : null}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MutationScreen;\r\n","import React from \"react\";\r\n// import useMouse from \"@rooks/use-mouse\";\r\nimport useBoundingclientrectRef from '@rooks/use-boundingclientrect-ref';\r\n\r\nimport \"./LookAtMouse.scss\";\r\nimport classNames from \"classnames\";\r\nimport useMousePosition from \"./useMousePosition\";\r\n\r\ninterface LookAtMouseProps {\r\n  zScale?: number;\r\n}\r\n\r\nfunction LookAtMouse(props: JSX.IntrinsicElements[\"div\"] & LookAtMouseProps) {\r\n  const mouse = useMousePosition();\r\n  const [ref, size] = useBoundingclientrectRef() as any;\r\n  const { children, className, zScale = 5, ...restProps } = props;\r\n\r\n  const z = window.innerWidth * zScale;\r\n\r\n  const style = React.useMemo(() => {\r\n    if (size != null) {\r\n      const midX = size.left + size.width / 2;\r\n      const midY = size.top + size.height / 2;\r\n\r\n      const ox = mouse.x - midX;\r\n      const oy = mouse.y - midY;\r\n      // const rotY = Math.atan((ox * 2) / clientRect.width);\r\n      // const rotX = Math.atan(-(oy * 2) / clientRect.height);\r\n\r\n      const rotY = Math.atan((ox * 2) / z);\r\n      const rotX = Math.atan(-(oy * 2) / z);\r\n      const s: React.CSSProperties = {\r\n        transform: `perspective(525px) rotateX(${rotX}rad) rotateY(${rotY}rad)`\r\n      };\r\n      return s;\r\n    } else {\r\n      return {};\r\n    }\r\n  }, [mouse.x, mouse.y, size, z]);\r\n\r\n  return (\r\n    <div ref={ref} className={classNames(\"look-at-mouse\", className)} {...restProps}>\r\n      <div className=\"look-at-mouse-transform\" style={style}>{children}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LookAtMouse;\r\n","import React from \"react\";\r\n\r\nimport { Species } from \"./species\";\r\nimport { GeneDisplayProps } from \"./GeneDisplay\";\r\nimport { Button } from \"../common/Button\";\r\nimport GenesToTraits from \"./GenesToTraits\";\r\n\r\nimport \"./SpeciesPopoverDetails.scss\";\r\n\r\nexport interface SpeciesPopoverDetailsProps {\r\n  species: Species;\r\n  onMutate: (species: Species) => void;\r\n  onClick: GeneDisplayProps[\"onClick\"];\r\n}\r\n\r\nfunction SpeciesPopoverDetails({ species, onClick, onMutate }: SpeciesPopoverDetailsProps) {\r\n  return (\r\n    <div className=\"species-details\">\r\n      <GenesToTraits genes={species.genes} onClick={onClick} />\r\n      {species.freeMutationPoints > 0 ? <div className=\"suggestion\">{species.freeMutationPoints} Mutation Points available. Use them!</div> : null}\r\n      <Button onClick={() => onMutate(species)}>Mutate</Button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SpeciesPopoverDetails;\r\n","import LookAtMouse from \"common/LookAtMouse\";\r\nimport React from \"react\";\r\nimport Popover from \"react-popover\";\r\nimport Character from \"../common/Character\";\r\nimport MP from \"../common/MP\";\r\nimport { Species } from \"./species\";\r\nimport \"./SpeciesNode.scss\";\r\nimport SpeciesPopoverDetails from \"./SpeciesPopoverDetails\";\r\n\r\n\r\nexport interface SpeciesNodeProps {\r\n  species: Species;\r\n  onMutate: (m: Species) => void;\r\n}\r\n\r\nfunction SpeciesNode({ species, onMutate }: SpeciesNodeProps) {\r\n  const handleOnMutate = (s: Species) => {\r\n    setPopoverIsOpen(false);\r\n    onMutate(s);\r\n  };\r\n\r\n  const [popoverIsOpen, setPopoverIsOpen] = React.useState(false);\r\n\r\n  const descendants = species.descendants.length > 0\r\n    ? (\r\n      <div className=\"descendants-container\">\r\n        {species.descendants.map((s, i) => <SpeciesNode key={i} species={s} onMutate={handleOnMutate} />)}\r\n      </div>\r\n    ) : null;\r\n  const popoverBody = (\r\n    <div className=\"species-detail-popover\">\r\n      <SpeciesPopoverDetails species={species} onMutate={handleOnMutate} onClick={() => { }} />\r\n    </div>\r\n  );\r\n  return (\r\n    <div className=\"species-node\">\r\n      {descendants}\r\n      <Popover isOpen={popoverIsOpen} preferPlace=\"right\" onOuterAction={() => setPopoverIsOpen(false)} body={popoverBody}>\r\n        <LookAtMouse zScale={5}>\r\n          <div className=\"species-info\" onClick={() => setPopoverIsOpen(!popoverIsOpen)}>\r\n            <div className=\"species-info-name\">{species.name}</div>\r\n            <div className=\"species-info-animation\">\r\n              <Character size=\"small\" />\r\n            </div>\r\n            <MP amount={species.freeMutationPoints} total={species.totalMutationPoints} />\r\n          </div>\r\n        </LookAtMouse>\r\n      </Popover>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SpeciesNode;\r\n","import React from \"react\";\r\n\r\nimport \"./PhylogeneticTree.scss\";\r\nimport { Species } from \"./species\";\r\nimport SpeciesNode from \"./SpeciesNode\";\r\n\r\ninterface PhylogeneticTreeProps {\r\n  rootSpecies: Species;\r\n  onMutate: (s: Species) => void;\r\n}\r\n\r\nfunction PhylogeneticTree({ rootSpecies, onMutate }: PhylogeneticTreeProps) {\r\n  return (\r\n    <div className=\"phylogenetic-tree\">\r\n      <div className=\"title\">Phylogenetic Tree</div>\r\n      <div className=\"tree-nodes\">\r\n        <SpeciesNode species={rootSpecies} onMutate={onMutate} />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default PhylogeneticTree;\r\n","import { poissonDisc } from \"math/poissonDisc\";\r\nimport { Vector2 } from \"three\";\r\nimport { HexTile } from \"./hexTile\";\r\nimport { CameraState } from \"./map/OverWorldMap\";\r\n\r\n/**\r\n * Tiled hexes are not square - they are rectangular, where\r\n * the pointy-to-pointy direction is length 1 and the edge-to-edge\r\n * direction is length sqrt(3) / 2. Since we have flat-topped\r\n * hexes, the Y gets the squish factor.\r\n */\r\nexport const Y_SQUISH_FACTOR = Math.sqrt(3) / 2;\r\n\r\nexport function getClickedHexCoords(\r\n  canvas: HTMLCanvasElement,\r\n  camera: CameraState,\r\n  event: React.MouseEvent\r\n) {\r\n  const { scale, dX, dY } = camera;\r\n  const cX = canvas.width / 2 + dX;\r\n  const cY = canvas.height / 2 + dY;\r\n\r\n  const e = event.nativeEvent;\r\n  const pxX = e.offsetX;\r\n  const pxY = e.offsetY;\r\n  const x = (pxX - cX) / scale;\r\n  const y = (pxY - cY) / scale;\r\n  // we now have a fractional cartesian coordinates\r\n  // now we flip the equations:\r\n\r\n  // x = 1.5i\r\n  // i = x / 1.5\r\n\r\n  // y = 2Cj + Ci\r\n  // j = (y - Ci) / (2 * C)\r\n\r\n  const i = x / 1.5;\r\n  const j = (y - Y_SQUISH_FACTOR * i) / (2 * Y_SQUISH_FACTOR);\r\n  const k = -(i + j);\r\n\r\n  return roundCubeCoordinates(i, j, k);\r\n}\r\n\r\nexport function roundCubeCoordinates(i: number, j: number, k: number) {\r\n  var rx = Math.round(i);\r\n  var ry = Math.round(j);\r\n  var rz = Math.round(k);\r\n\r\n  var x_diff = Math.abs(rx - i);\r\n  var y_diff = Math.abs(ry - j);\r\n  var z_diff = Math.abs(rz - k);\r\n\r\n  if (x_diff > y_diff && x_diff > z_diff) {\r\n    rx = -ry - rz;\r\n  } else if (y_diff > z_diff) {\r\n    ry = -rx - rz;\r\n  } else {\r\n    rz = -rx - ry;\r\n  }\r\n  return { i: rx, j: ry, k: rz };\r\n}\r\n\r\nexport function pixelPosition(tile: HexTile, camera: CameraState) {\r\n  const { dX, dY, scale } = camera;\r\n  const { x, y } = tile.cartesian;\r\n\r\n  const cX = window.innerWidth / 2 + dX;\r\n  const cY = window.innerHeight / 2 + dY;\r\n  return [cX + x * scale, cY + y * scale];\r\n}\r\n\r\n/**\r\n * Get the camera state that would center the camera on hex with the given scale.\r\n */\r\nexport function getCameraPositionCenteredOn(hex: HexTile, scale: number) {\r\n  const { x, y } = hex.cartesian;\r\n  const cX = window.innerWidth / 2 - x * scale;\r\n  const cY = window.innerHeight / 2 - y * scale;\r\n\r\n  const dX = cX - window.innerWidth / 2;\r\n  const dY = cY - window.innerHeight / 2;\r\n\r\n  return [dX, dY];\r\n}\r\n\r\nexport const randomPointInHexagon = (() => {\r\n  const vectors = [\r\n    new Vector2(-1, 0),\r\n    new Vector2(0.5, Y_SQUISH_FACTOR),\r\n    new Vector2(0.5, -Y_SQUISH_FACTOR)\r\n  ];\r\n\r\n  return (scale: number) => {\r\n    // adapted from https://stackoverflow.com/a/3241819\r\n    const vIndex = Math.floor(Math.random() * 3);\r\n    const [v1, v2] = [vectors[vIndex], vectors[(vIndex + 1) % 3]];\r\n    const [v1Scale, v2Scale] = [Math.random(), Math.random()]\r\n    const [x, y] = [\r\n      v1Scale * v1.x + v2Scale * v2.x,\r\n      v1Scale * v1.y + v2Scale * v2.y\r\n    ];\r\n    return new Vector2(x * scale, y * scale);\r\n  };\r\n})();\r\n\r\nexport const generateNaturalRandomHexagonPoints = (radius: number) => {\r\n  const width = 2;\r\n  const height = Y_SQUISH_FACTOR * width;\r\n  // const areaAvailable = width * height;\r\n  // const radius = areaAvailable / maxPoints * 0.5; // technically you could get pretty close with .8; but do 0.5 for some more leeway\r\n  const samples = poissonDisc({ width, height, radius, max: 10000 });\r\n  return samples\r\n    .map((s) => { s.x -= width / 2; s.y -= height / 2; return s; })\r\n    .filter((s) => isPointInHexagon(s.x, s.y));\r\n}\r\n\r\n/**\r\n * Return true if the point is inside a radius 1 hexagon (width 2, height sqrt(3))\r\n */\r\nexport const isPointInHexagon = (() => {\r\n  const RADIUS = 1;\r\n  const HALF_HEIGHT = RADIUS * Y_SQUISH_FACTOR;\r\n  // based on http://www.playchilla.com/how-to-check-if-a-point-is-inside-a-hexagon\r\n  return (x: number, y: number) => {\r\n    // transform the test point locally and to quadrant 2\r\n    const q2x = Math.abs(x);\r\n    const q2y = Math.abs(y);\r\n    // bounding test (since q2 is in quadrant 2 only 2 tests are needed)\r\n    if (q2x > RADIUS || q2y > HALF_HEIGHT) {\r\n      return false;\r\n    }\r\n    // dot product can be reduced to this due to the hexagon symmetry\r\n    // return HALF_HEIGHT * RADIUS * q2x - RADIUS * q2y >= 0;\r\n    return RADIUS * HALF_HEIGHT - HALF_HEIGHT * q2x - 0.5 * q2y >= 0;\r\n  }\r\n})();\r\n\r\n","import { Vector2 } from \"three\";\r\n\r\n// https://github.com/beaugunderson/poisson-disc-sampler/blob/master/poisson-disc-sampler.js\r\nexport function poissonDisc({\r\n  width = 1,\r\n  height = 1,\r\n  radius = 0.1,\r\n  max = 1000,\r\n  rng = Math.random,\r\n}): Vector2[] {\r\n  // maximum number of samples before rejection\r\n  var k = 30;\r\n  var radius2 = radius * radius;\r\n  var R = 3 * radius2;\r\n  var cellSize = radius * Math.SQRT1_2;\r\n\r\n  var gridWidth = Math.ceil(width / cellSize);\r\n  var gridHeight = Math.ceil(height / cellSize);\r\n\r\n  var grid = new Array(gridWidth * gridHeight);\r\n\r\n  var queue: number[][] = [];\r\n  var queueSize = 0;\r\n\r\n  var sampleSize = 0;\r\n\r\n  rng = rng || Math.random;\r\n\r\n  function far(x: number, y: number) {\r\n    var i = x / cellSize | 0;\r\n    var j = y / cellSize | 0;\r\n\r\n    var i0 = Math.max(i - 2, 0);\r\n    var j0 = Math.max(j - 2, 0);\r\n    var i1 = Math.min(i + 3, gridWidth);\r\n    var j1 = Math.min(j + 3, gridHeight);\r\n\r\n    for (j = j0; j < j1; ++j) {\r\n      var o = j * gridWidth;\r\n\r\n      for (i = i0; i < i1; ++i) {\r\n        var s;\r\n\r\n        if ((s = grid[o + i])) {\r\n          var dx = s[0] - x,\r\n            dy = s[1] - y;\r\n\r\n          if (dx * dx + dy * dy < radius2) {\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  function sample(x: number, y: number) {\r\n    const s = [x, y];\r\n\r\n    queue.push(s);\r\n\r\n    grid[gridWidth * (y / cellSize | 0) + (x / cellSize | 0)] = s;\r\n\r\n    sampleSize++;\r\n    queueSize++;\r\n\r\n    return s;\r\n  }\r\n\r\n  const sampler = function () {\r\n    if (!sampleSize) {\r\n      return sample(rng() * width, rng() * height);\r\n    }\r\n\r\n    // Pick a random existing sample and remove it from the queue.\r\n    while (queueSize) {\r\n      var i = rng() * queueSize | 0;\r\n      var s = queue[i];\r\n\r\n      // Make a new candidate between [radius, 2 * radius] from the existing\r\n      // sample.\r\n      for (var j = 0; j < k; ++j) {\r\n        var a = 2 * Math.PI * rng();\r\n        var r = Math.sqrt(rng() * R + radius2);\r\n        var x = s[0] + r * Math.cos(a);\r\n        var y = s[1] + r * Math.sin(a);\r\n\r\n        // Reject candidates that are outside the allowed extent,\r\n        // or closer than 2 * radius to any existing sample.\r\n        if (x >= 0 && x < width && y >= 0 && y < height && far(x, y)) {\r\n          return sample(x, y);\r\n        }\r\n      }\r\n\r\n      queue[i] = queue[--queueSize];\r\n      queue.length = queueSize;\r\n    }\r\n  };\r\n\r\n  const samples: Vector2[] = [];\r\n  for (let i = 0; i < max; i++) {\r\n    const sample = sampler();\r\n    // we can't get any more\r\n    if (sample == null) {\r\n      break;\r\n    }\r\n    samples.push(new Vector2(sample[0], sample[1]));\r\n  }\r\n  return samples;\r\n};\r\n","import uuid from \"uuid\";\r\nimport { Gene } from \"./gene\";\r\n\r\nexport interface Species {\r\n  id: string;\r\n  name: string;\r\n  genes: Gene[];\r\n  // cells: Cell[];\r\n  freeMutationPoints: number;\r\n  totalMutationPoints: number;\r\n  descendants: Species[];\r\n  parent?: Species;\r\n}\r\n\r\nexport function newBaseSpecies(name = \"newBaseSpecies\"): Species {\r\n  return {\r\n    id: uuid(),\r\n    name,\r\n    // genes: [mutateRandomNewGene(), mutateRandomNewGene(), mutateRandomNewGene()],\r\n    genes: [],\r\n    freeMutationPoints: 0,\r\n    totalMutationPoints: 0,\r\n    descendants: [],\r\n  };\r\n}\r\n\r\nexport function lineage(species: Species): Species[] {\r\n  const arr = [];\r\n  arr.push(species);\r\n  for (const s of species.descendants) {\r\n    arr.push(...lineage(s));\r\n  }\r\n  return arr;\r\n}\r\n\r\nexport interface Cell {\r\n  genes: Gene[];\r\n}\r\n","import { lineage, Species } from \"evolution/species\";\r\nimport React from \"react\";\r\nimport Dropdown, { Option } from 'react-dropdown';\r\nimport { Button } from \"../../common/Button\";\r\nimport Expand from \"../../common/Expand\";\r\nimport MP from \"../../common/MP\";\r\nimport { HexTile } from \"../hexTile\";\r\nimport \"./HexTileInfo.scss\";\r\n\r\n\r\n\r\ninterface HexTileInfoProps {\r\n  tile: HexTile;\r\n  onClickPlay: (level: HexTile, species: Species) => void;\r\n  rootSpecies: Species;\r\n}\r\n\r\nfunction HexTileInfo({ tile, onClickPlay, rootSpecies }: HexTileInfoProps) {\r\n  const allSpecies = React.useMemo(() => lineage(rootSpecies), [rootSpecies]);\r\n\r\n  const [selectedSpecies, setSelectedSpecies] = React.useState(allSpecies[0].id);\r\n\r\n  const handleClickPlay = () => {\r\n    onClickPlay(tile, allSpecies.find((s) => s.id === selectedSpecies)!);\r\n  };\r\n\r\n  const { height, flora } = tile.info;\r\n\r\n  const options: Option[] = allSpecies.map((s) => ({\r\n    value: s.id,\r\n    label: s.name,\r\n  }));\r\n\r\n  const handleDropdownChange = (option: Option) => {\r\n    setSelectedSpecies(option.value);\r\n  };\r\n\r\n  const playButtonElement =\r\n    (height === -1 || flora != null) ? null : (\r\n      <div className=\"play-selector\">\r\n        <Dropdown options={options} value={selectedSpecies} onChange={handleDropdownChange} />\r\n        <Button color=\"green\" className=\"play-button\" onClick={handleClickPlay}>\r\n          Populate\r\n        </Button>\r\n      </div>\r\n    );\r\n\r\n  const header = flora != null ? (\r\n    <h1>Inhabited by {flora.species.name}<small><MP amount={flora.mutationPointsPerEpoch} /> per epoch</small></h1>\r\n  ) : tile.info.height === -1 ? (\r\n    <h1>Deep Water</h1>\r\n  ) : (\r\n        <h1>Uninhabited</h1>\r\n      );\r\n\r\n\r\n  const expand =\r\n    tile.info.height === -1 ? null : (\r\n      <Expand shrunkElements={<div className=\"details\">Details</div>}>\r\n        <pre style={{ fontSize: \"12px\" }}>{JSON.stringify(tile.info, null, 4)}</pre>\r\n      </Expand>\r\n    );\r\n\r\n  return (\r\n    <div className=\"hex-tile-info-container\">\r\n      {header}\r\n      {expand}\r\n      {playButtonElement}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default HexTileInfo;\r\n","export function sleep(time: number) {\r\n  return new Promise(r => {\r\n    setTimeout(r, time);\r\n  });\r\n}\r\n","import testVignetteUrl from \"assets/images/test-vignette.png\";\r\nimport { sleep } from \"common/promise\";\r\nimport { scaleLinear } from \"d3-scale\";\r\nimport { Species } from \"evolution/species\";\r\nimport { generateNaturalRandomHexagonPoints, pixelPosition } from \"overworld/hexMath\";\r\nimport { HexTile } from \"overworld/hexTile\";\r\nimport { Vector2 } from \"three\";\r\nimport { CameraState } from \"./OverWorldMap\";\r\n\r\n\r\nconst testVignette = new Image();\r\ntestVignette.src = testVignetteUrl;\r\n\r\nconst COLOR_SCALE_HEIGHT = scaleLinear<string, string>()\r\n  .domain([-1, 0, 1, 5, 6])\r\n  .range([\"rgb(0, 60, 255)\", \"lightblue\", \"yellow\", \"orange\"]);\r\n\r\nexport default class HexTileSprite {\r\n  private vignettePositions?: Vector2[];\r\n  constructor(public tile: HexTile) { }\r\n\r\n  draw(c: CanvasRenderingContext2D, camera: CameraState) {\r\n    const { scale } = camera;\r\n    const [px, py] = pixelPosition(this.tile, camera);\r\n\r\n    if (this.tile.info.visible) {\r\n      c.fillStyle = COLOR_SCALE_HEIGHT(this.tile.info.height);\r\n      c.fillStyle = COLOR_SCALE_HEIGHT(this.tile.info.height);\r\n      drawHex(c, px, py, scale);\r\n      c.font = `${12 * scale / 48}px serif`;\r\n      c.textAlign = \"center\";\r\n      c.textBaseline = \"middle\";\r\n      c.fillStyle = \"#666\";\r\n      c.fillText(this.tile.info.height + \"\", px, py, scale);\r\n      // draw vignettes\r\n      if (this.tile.info.flora != null) {\r\n        this.updateVignettes(c, this.tile.info.flora.species, px, py, scale);\r\n      }\r\n    } else {\r\n      c.strokeStyle = \"rgb(112, 112, 112)\";\r\n      drawHex(c, px, py, scale, false);\r\n    }\r\n  }\r\n\r\n  updateVignettes(c: CanvasRenderingContext2D, species: Species, px: number, py: number, scale: number) {\r\n    if (this.vignettePositions == null) {\r\n      const positions = generateNaturalRandomHexagonPoints(0.2).sort((a, b) => a.y - b.y);\r\n      this.vignettePositions = [];\r\n      const vignettePositions = this.vignettePositions;\r\n      (async function () {\r\n        for (const p of positions) {\r\n          vignettePositions.push(p);\r\n          await sleep(300);\r\n        }\r\n      })();\r\n    }\r\n    const sizeScale = scale / 48 / 2;\r\n    for (const p of this.vignettePositions) {\r\n      c.drawImage(\r\n        testVignette,\r\n        px + p.x * scale - testVignette.width / 2 * sizeScale,\r\n        py + p.y * scale - testVignette.height * sizeScale,\r\n        testVignette.width * sizeScale,\r\n        testVignette.height * sizeScale,\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n// class AnimatedVignetteSprites {\r\n//   public spritePositions: Vector2[] = [];\r\n//   constructor(public image: CanvasImageSource) {\r\n//     stagger(10 times, 30ms delay, (i, delay) => {\r\n//       const randomPosition = randomPointInHex();\r\n//       const s = new Sprite(image, randomPosition);\r\n//       s.animate(over 1000 ms, (t) => { s.opacity = t / 1000 })\r\n//       return s;\r\n//     })\r\n//   }\r\n\r\n//   draw() {\r\n//     draw all sprites\r\n//   }\r\n// }\r\n\r\nfunction drawHex(c: CanvasRenderingContext2D, x: number, y: number, r: number, fill = true) {\r\n  c.beginPath();\r\n  c.moveTo(x + r, y);\r\n  for (let i = 1; i < 6; i++) {\r\n    const angle = (i / 6) * Math.PI * 2;\r\n    c.lineTo(x + Math.cos(angle) * r, y + Math.sin(angle) * r);\r\n  }\r\n  c.closePath();\r\n  if (fill) {\r\n    c.fill();\r\n  }\r\n  c.stroke();\r\n}\r\n","import React from \"react\";\r\n\r\nimport { CameraState } from \"./OverWorldMap\";\r\nimport { HexTile } from \"../hexTile\";\r\nimport { pixelPosition } from \"../hexMath\";\r\n\r\nimport \"./OverWorldPopover.scss\";\r\n\r\ninterface OverWorldPopoverProps {\r\n  camera: CameraState;\r\n  tile: HexTile;\r\n  children: React.ReactNode;\r\n}\r\n\r\nfunction OverWorldPopover({ tile, camera, children }: OverWorldPopoverProps) {\r\n  const [px, py] = pixelPosition(tile, camera);\r\n  // this element is put in the center\r\n  const container: React.CSSProperties = {\r\n    left: px + camera.scale * 0.5,\r\n    top: py,\r\n  };\r\n  return (\r\n    <div className=\"overworld-popover\" style={container}>\r\n      <div className=\"overworld-popover-positioner\">{children}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OverWorldPopover;\r\n","import Ticker from \"global/ticker\";\r\nimport React from \"react\";\r\nimport { Vector2 } from \"three\";\r\nimport { Species } from \"../../evolution/species\";\r\nimport { getCameraPositionCenteredOn, getClickedHexCoords } from \"../hexMath\";\r\nimport { HexTile } from \"../hexTile\";\r\nimport { OverWorld } from \"../overWorld\";\r\nimport HexTileInfo from \"./HexTileInfo\";\r\nimport HexTileSprite from \"./hexTileSprite\";\r\nimport \"./OverWorldMap.scss\";\r\nimport OverWorldPopover from \"./OverWorldPopover\";\r\n\r\ninterface OverWorldMapProps {\r\n  rootSpecies: Species;\r\n  overWorld: OverWorld;\r\n  onPlayLevel: (level: HexTile, species: Species) => void;\r\n  // TODO turn this into a trigger, or global state\r\n  focusedHex?: HexTile;\r\n}\r\n\r\nexport interface CameraState {\r\n  scale: number;\r\n  dX: number;\r\n  dY: number;\r\n}\r\n\r\ninterface OverWorldMapState {\r\n  cameraState: CameraState;\r\n  pressedKeys: { [code: string]: boolean };\r\n  highlightedHex?: HexTile;\r\n  frame: number;\r\n}\r\n\r\nexport class OverWorldMap extends React.PureComponent<OverWorldMapProps, OverWorldMapState> {\r\n\r\n  private hexTileSprites: Map<HexTile, HexTileSprite> = new Map();\r\n\r\n  constructor(props: OverWorldMapProps) {\r\n    super(props);\r\n    const scale = 96;\r\n    const [dX, dY] = getCameraPositionCenteredOn(props.overWorld.getStartTile(), scale);\r\n    this.state = {\r\n      cameraState: { scale, dX, dY },\r\n      pressedKeys: {},\r\n      frame: 0,\r\n    };\r\n    for (const tile of props.overWorld) {\r\n      const sprite = new HexTileSprite(tile);\r\n      this.hexTileSprites.set(tile, sprite);\r\n    }\r\n  }\r\n\r\n  private canvas: HTMLCanvasElement | null = null;\r\n  private rafId?: number;\r\n\r\n  private handleCanvasRef = (ref: HTMLCanvasElement | null) => {\r\n    this.canvas = ref;\r\n    if (ref != null) {\r\n      Ticker.addAnimation(() => {\r\n        this.setState({ frame: this.state.frame + 1 });\r\n        return this.canvas == null;\r\n      });\r\n      this.handleResize();\r\n    }\r\n  };\r\n\r\n  private handleCanvasClick = (e: React.MouseEvent) => {\r\n    if (this.canvas != null) {\r\n      if (this.state.highlightedHex != null) {\r\n        this.setState({ highlightedHex: undefined });\r\n      } else {\r\n        const coords = getClickedHexCoords(this.canvas, this.state.cameraState, e);\r\n        const level = this.props.overWorld.tileAt(coords.i, coords.j);\r\n        if (level != null && level.info.visible) {\r\n          this.setState({ highlightedHex: level });\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private onPlayLevel = (level: HexTile, species: Species) => {\r\n    this.props.onPlayLevel(level, species);\r\n  };\r\n\r\n  private handleKeyDown = (e: KeyboardEvent) => {\r\n    if (!e.repeat) {\r\n      const newPressedKeys = { ...this.state.pressedKeys, [e.code]: true };\r\n      this.setState({\r\n        pressedKeys: newPressedKeys,\r\n      });\r\n    }\r\n  };\r\n\r\n  private handleKeyUp = (e: KeyboardEvent) => {\r\n    const newPressedKeys = { ...this.state.pressedKeys };\r\n    delete newPressedKeys[e.code];\r\n    this.setState({\r\n      pressedKeys: newPressedKeys,\r\n    });\r\n  };\r\n\r\n  private handleWheel = (e: WheelEvent) => {\r\n    const delta = -(e.deltaX + e.deltaY) / 125 / 10;\r\n    const scalar = Math.pow(2, delta);\r\n\r\n    const scale = this.state.cameraState.scale * scalar;\r\n    this.setState({\r\n      cameraState: {\r\n        ...this.state.cameraState,\r\n        scale\r\n      }\r\n    });\r\n  };\r\n\r\n  private handleResize = () => {\r\n    if (this.canvas != null) {\r\n      this.canvas.width = window.innerWidth;\r\n      this.canvas.height = window.innerHeight;\r\n      this.drawMap();\r\n    }\r\n  };\r\n\r\n  private updateCamera = () => {\r\n    const panSpeed = 20;\r\n    let offset = new Vector2();\r\n    for (const key in this.state.pressedKeys) {\r\n      if (key === \"KeyW\" || key === \"ArrowUp\") {\r\n        offset.y += panSpeed;\r\n      } else if (key === \"KeyS\" || key === \"ArrowDown\") {\r\n        offset.y -= panSpeed;\r\n      } else if (key === \"KeyA\" || key === \"ArrowLeft\") {\r\n        offset.x += panSpeed;\r\n      } else if (key === \"KeyD\" || key === \"ArrowRight\") {\r\n        offset.x -= panSpeed;\r\n      }\r\n    }\r\n    offset.setLength(panSpeed);\r\n\r\n    if (offset.x !== 0 || offset.y !== 0) {\r\n      const cameraState = this.state.cameraState;\r\n\r\n      this.setState({\r\n        cameraState: {\r\n          ...cameraState,\r\n          dX: cameraState.dX + offset.x,\r\n          dY: cameraState.dY + offset.y,\r\n        },\r\n      });\r\n    }\r\n  };\r\n\r\n  private drawMap() {\r\n    if (this.canvas != null) {\r\n      const context = this.canvas.getContext(\"2d\")!;\r\n      context.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      for (const sprite of this.hexTileSprites.values()) {\r\n        sprite.draw(context, this.state.cameraState);\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"keydown\", this.handleKeyDown);\r\n    document.addEventListener(\"keyup\", this.handleKeyUp);\r\n    document.addEventListener(\"wheel\", this.handleWheel);\r\n    window.addEventListener(\"resize\", this.handleResize);\r\n    this.rafId = Ticker.addAnimation(this.updateCamera);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.handleKeyDown);\r\n    document.removeEventListener(\"keyup\", this.handleKeyUp);\r\n    document.removeEventListener(\"wheel\", this.handleWheel);\r\n    window.removeEventListener(\"resize\", this.handleResize);\r\n    Ticker.removeAnimation(this.rafId!);\r\n  }\r\n\r\n  componentDidUpdate(prevProps: OverWorldMapProps) {\r\n    if (prevProps.focusedHex !== this.props.focusedHex && this.props.focusedHex != null) {\r\n      this.focusHex(this.props.focusedHex);\r\n    }\r\n    this.drawMap();\r\n  }\r\n\r\n  focusHex(hex: HexTile) {\r\n    let tStart = 0;\r\n    Ticker.addAnimation((t) => {\r\n      if (tStart === 0) {\r\n        tStart = t;\r\n      }\r\n      const dt = t - tStart;\r\n      const [targetX, targetY] = getCameraPositionCenteredOn(hex, this.state.cameraState.scale);\r\n      const dX = this.state.cameraState.dX * 0.5 + targetX * 0.5;\r\n      const dY = this.state.cameraState.dY * 0.5 + targetY * 0.5;\r\n      this.setState({\r\n        cameraState: {\r\n          ...this.state.cameraState,\r\n          dX,\r\n          dY,\r\n        }\r\n      });\r\n      return dt > 1000 ||\r\n        (Math.abs(targetX - dX) < 1e-2 && Math.abs(targetY - dY) < 1e-2);\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"overworld-map-container\">\r\n        <canvas tabIndex={-1} ref={this.handleCanvasRef} onClick={this.handleCanvasClick} />\r\n        {this.maybeRenderHexPopover()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  maybeRenderHexPopover() {\r\n    if (this.state.highlightedHex != null) {\r\n      return (\r\n        <OverWorldPopover camera={this.state.cameraState} tile={this.state.highlightedHex}>\r\n          <HexTileInfo rootSpecies={this.props.rootSpecies} tile={this.state.highlightedHex} onClickPlay={this.onPlayLevel} />\r\n        </OverWorldPopover>\r\n      );\r\n    }\r\n  }\r\n}\r\n","import classNames from \"classnames\";\r\nimport DynamicNumber from \"common/DynamicNumber\";\r\nimport MutationScreen from \"evolution/MutationScreen\";\r\nimport PhylogeneticTree from \"evolution/PhylogeneticTree\";\r\nimport { Species } from \"evolution/species\";\r\nimport React, { useCallback, useEffect, useState } from \"react\";\r\nimport { GiFamilyTree, GiSandsOfTime } from \"react-icons/gi\";\r\nimport Modal from \"react-modal\";\r\nimport { HexTile } from \"./hexTile\";\r\nimport { OverWorldMap } from \"./map/OverWorldMap\";\r\nimport { OverWorld } from \"./overWorld\";\r\nimport \"./OverWorldScreen.scss\";\r\n\r\n\r\nexport interface OverWorldScreenProps {\r\n  rootSpecies: Species;\r\n  epoch: number;\r\n  overWorld: OverWorld;\r\n  onPopulationAttempt: (level: HexTile, species: Species) => void;\r\n  onNextEpoch: () => void;\r\n}\r\n\r\nconst OverWorldScreen = ({ rootSpecies, epoch, overWorld, onPopulationAttempt: onPlayLevel, onNextEpoch }: OverWorldScreenProps) => {\r\n  const [leftPanelOpen, setLeftPanelOpen] = useState(false);\r\n  const [activelyMutatingSpecies, setActivelyMutatingSpecies] = useState<Species | undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    function handleKeyDown(e: KeyboardEvent) {\r\n      if (e.code === \"Tab\") {\r\n        setLeftPanelOpen((open) => !open);\r\n        e.preventDefault();\r\n      }\r\n    }\r\n    document.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleKeyDown);\r\n    }\r\n  }, []);\r\n\r\n  const handleStartMutate = useCallback((s: Species) => {\r\n    setActivelyMutatingSpecies(s);\r\n  }, []);\r\n\r\n  const handleCommit = useCallback((newSpecies: Species, newPool: number) => {\r\n    if (activelyMutatingSpecies == null) {\r\n      throw new Error(\"created new species with no actively mutating one!\");\r\n    }\r\n    activelyMutatingSpecies.descendants.push(newSpecies);\r\n    // eslint-disable-next-line react/no-direct-mutation-state\r\n    activelyMutatingSpecies.freeMutationPoints = newPool;\r\n    newSpecies.parent = activelyMutatingSpecies;\r\n    setActivelyMutatingSpecies(undefined);\r\n  }, [activelyMutatingSpecies]);\r\n\r\n  function maybeRenderMutationModal() {\r\n    const maybeMutationScreen = activelyMutatingSpecies != null ? (\r\n      <MutationScreen species={activelyMutatingSpecies} onCommit={handleCommit} />\r\n    ) : null;\r\n    return (\r\n      <Modal\r\n        ariaHideApp={false}\r\n        isOpen={activelyMutatingSpecies != null}\r\n        onRequestClose={() => setActivelyMutatingSpecies(undefined)}\r\n        className=\"mutation-screen-portal\"\r\n      >\r\n        {maybeMutationScreen}\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  function maybeRenderPhylogeneticTreePanel() {\r\n    return (\r\n      <div className={classNames(\"panel-left\", { open: leftPanelOpen })}>\r\n        {leftPanelOpen ? (\r\n          <PhylogeneticTree onMutate={handleStartMutate} rootSpecies={rootSpecies} />\r\n        ) : null}\r\n        <button\r\n          className=\"panel-left-handle\"\r\n          onClick={() => setLeftPanelOpen((open) => !open)}>\r\n          <GiFamilyTree className=\"icon\" />\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const [focusedHex, setFocusedHex] = useState<HexTile | undefined>(undefined);\r\n  const handleFocusHex = useCallback((hex: HexTile) => {\r\n    setFocusedHex(hex);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"overworld-screen\">\r\n      <OverWorldMap focusedHex={focusedHex} overWorld={overWorld} rootSpecies={rootSpecies} onPlayLevel={onPlayLevel} />\r\n      {maybeRenderPhylogeneticTreePanel()}\r\n      {maybeRenderMutationModal()}\r\n      <EpochUI epoch={epoch} onNextEpoch={onNextEpoch} onFocusHex={handleFocusHex} overWorld={overWorld} />\r\n    </div>\r\n  )\r\n};\r\n\r\nexport interface EpochUIProps {\r\n  epoch: number;\r\n  overWorld: OverWorld;\r\n  onNextEpoch: () => void;\r\n  onFocusHex: (hex: HexTile) => void;\r\n}\r\n\r\nconst EPOCH_FORMATTER = new Intl.NumberFormat(undefined, { useGrouping: true, maximumFractionDigits: 0 });\r\nfunction EpochUI({ epoch, overWorld, onNextEpoch, onFocusHex }: EpochUIProps) {\r\n  const [transitioning, setTransitioning] = useState(false);\r\n  const unusedHexes = overWorld.unusedHexes();\r\n  const isReadyToAdvance = unusedHexes.length === 0;\r\n  const handleNextEpoch = () => {\r\n    setTransitioning(true);\r\n    setTimeout(() => setTransitioning(false), 5000);\r\n    onNextEpoch();\r\n  };\r\n  return (\r\n    <div className={classNames(\"epoch-display\", { \"ready-to-advance\": isReadyToAdvance, transitioning })}>\r\n      <span className=\"number\">\r\n        <DynamicNumber formatter={EPOCH_FORMATTER} value={epoch * 1e6} speed={0.08} /> Years\r\n      </span>\r\n      {unusedHexes.length > 0 ?\r\n        <div onClick={() => onFocusHex(unusedHexes[0])}>{unusedHexes.length} hexes unused</div>\r\n        : null}\r\n      <button className=\"button-next-epoch\" onClick={handleNextEpoch} disabled={transitioning}>\r\n        {/* {isReadyToAdvance ? <GiSandsOfTime className=\"icon\" /> : `${unusedHexes.length} hexes unused`} */}\r\n        <GiSandsOfTime className=\"icon\" />\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OverWorldScreen;\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\n\r\nexport const UI_EVENTS = {\r\n  click: true,\r\n  contextmenu: true,\r\n  dblclick: true,\r\n  mousedown: true,\r\n  mouseup: true,\r\n  mousemove: true,\r\n  touchstart: true,\r\n  touchmove: true,\r\n  touchend: true,\r\n  keyup: true,\r\n  keydown: true,\r\n  keypress: true,\r\n  wheel: true,\r\n};\r\n\r\nexport type UIEventReciever = {\r\n  [E in keyof typeof UI_EVENTS]?: (this: HTMLElement, ev: GlobalEventHandlersEventMap[E]) => void;\r\n  // [E in keyof typeof UI_EVENTS]?: (ev: Event) => void;\r\n};\r\n\r\nexport abstract class ISketch {\r\n  static id?: string;\r\n\r\n  public elements?: JSX.Element[];\r\n  public events?: UIEventReciever;\r\n  /**\r\n   * milliseconds since sketch started running.\r\n   */\r\n  public timeElapsed = 0;\r\n\r\n  public frameCount = 0;\r\n\r\n  constructor(public renderer: THREE.WebGLRenderer, public audioContext: SketchAudioContext) {}\r\n\r\n  /**\r\n   * height / width\r\n   */\r\n  get aspectRatio() {\r\n    return this.renderer.domElement.height / this.renderer.domElement.width;\r\n  }\r\n\r\n  get resolution() {\r\n    return new THREE.Vector2(this.renderer.domElement.width, this.renderer.domElement.height);\r\n  }\r\n\r\n  get canvas() {\r\n    return this.renderer.domElement;\r\n  }\r\n\r\n  abstract animate(millisElapsed: number): void;\r\n\r\n  render?(): React.ReactElement;\r\n\r\n  resize?(width: number, height: number): void;\r\n\r\n  destroy?(): void;\r\n}\r\n\r\nexport interface SketchConstructor {\r\n  new (renderer: THREE.WebGLRenderer, audioContext: SketchAudioContext, ...otherArgs: any[]): ISketch;\r\n\r\n  id?: string;\r\n}\r\n\r\nexport interface SketchAudioContext extends AudioContext {\r\n  gain: GainNode;\r\n}\r\n","import classnames from \"classnames\";\r\nimport * as React from \"react\";\r\nimport * as THREE from \"three\";\r\n\r\nimport { ISketch, SketchAudioContext, SketchConstructor, UI_EVENTS } from \"./sketch\";\r\n\r\nimport { FaVolumeOff, FaVolumeUp } from \"react-icons/fa\";\r\nimport Ticker from \"global/ticker\";\r\n\r\nexport interface ISketchComponentProps extends React.DOMAttributes<HTMLDivElement> {\r\n  eventsOnBody?: boolean;\r\n  errorElement?: JSX.Element;\r\n  sketchClass: SketchConstructor;\r\n  otherArgs?: any[];\r\n}\r\n\r\nexport interface SketchSuccess {\r\n  type: \"success\";\r\n  sketch: ISketch;\r\n}\r\n\r\nexport interface SketchError {\r\n  type: \"error\";\r\n  error: Error;\r\n}\r\n\r\nexport interface SketchLoading {\r\n  type: \"loading\";\r\n}\r\n\r\nexport type SketchStatus = SketchSuccess | SketchError | SketchLoading;\r\n\r\n// Expects sketch to be setup but not init. SketchSuccessComponent is responsible for:\r\n//      firing resize events\r\n//      attaching ui event listeners\r\n//      keeping focus on the canvas\r\ninterface SketchSuccessComponentProps {\r\n  sketch: ISketch;\r\n  eventsOnBody?: boolean;\r\n}\r\nclass SketchSuccessComponent extends React.PureComponent<SketchSuccessComponentProps, { frameCount: number }> {\r\n  private frameId?: number;\r\n  private lastTimestamp = 0;\r\n  private stop = false;\r\n\r\n  constructor(props: SketchSuccessComponentProps) {\r\n    super(props);\r\n    this.state = {\r\n      frameCount: props.sketch.frameCount,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener(\"resize\", this.handleWindowResize);\r\n    this.handleWindowResize();\r\n\r\n    // canvas setup\r\n    const canvas = this.props.sketch.renderer.domElement;\r\n    canvas.tabIndex = 1;\r\n    (Object.keys(UI_EVENTS) as Array<keyof typeof UI_EVENTS>).forEach((eventName) => {\r\n      if (this.props.sketch.events != null) {\r\n        const callback = this.props.sketch.events[eventName] as EventListener;\r\n        if (callback != null) {\r\n          if (this.props.eventsOnBody) {\r\n            document.body.addEventListener(eventName, callback);\r\n          } else {\r\n            canvas.addEventListener(eventName, callback);\r\n          }\r\n        }\r\n      }\r\n    });\r\n    // prevent scrolling the viewport\r\n    // $canvas.on(\"touchmove\", (event) => {\r\n    //     event.preventDefault();\r\n    // });\r\n\r\n    this.frameId = Ticker.addAnimation(this.loop);\r\n  }\r\n\r\n  render() {\r\n    const sketchElementsWithKey: React.ReactElement[] = [];\r\n    if (this.props.sketch.render != null) {\r\n      sketchElementsWithKey.push(this.props.sketch.render());\r\n    }\r\n    if (this.props.sketch.elements != null) {\r\n      sketchElementsWithKey.push(...this.props.sketch.elements);\r\n    }\r\n    return (\r\n      <div className=\"sketch-elements\">\r\n        {sketchElementsWithKey.map((el, idx) => React.cloneElement(el, { key: idx }))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.stop = true;\r\n\r\n    if (this.props.sketch.destroy) {\r\n      this.props.sketch.destroy();\r\n    }\r\n    if (this.frameId != null) {\r\n      Ticker.removeAnimation(this.frameId);\r\n    }\r\n    this.props.sketch.renderer.dispose();\r\n    window.removeEventListener(\"resize\", this.handleWindowResize);\r\n\r\n    const canvas = this.props.sketch.canvas;\r\n    (Object.keys(UI_EVENTS) as Array<keyof typeof UI_EVENTS>).forEach((eventName) => {\r\n      if (this.props.sketch.events != null) {\r\n        const callback = this.props.sketch.events[eventName] as EventListener;\r\n        if (callback != null) {\r\n          if (this.props.eventsOnBody) {\r\n            document.body.removeEventListener(eventName, callback);\r\n          } else {\r\n            canvas.removeEventListener(eventName, callback);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private loop = (timestamp: number) => {\r\n    const millisElapsed = timestamp - this.lastTimestamp;\r\n    this.lastTimestamp = timestamp;\r\n    this.props.sketch.frameCount++;\r\n    this.props.sketch.timeElapsed = timestamp;\r\n    try {\r\n      this.props.sketch.animate(millisElapsed);\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n\r\n    // careful - sketch.animate() might have triggered a whole React update loop\r\n    // and made this component unmount.\r\n    if (!this.stop) {\r\n      // force new render()\r\n      this.setState({\r\n        frameCount: this.props.sketch.frameCount,\r\n      });\r\n    } else {\r\n      Ticker.removeAnimation(this.frameId!);\r\n    }\r\n  };\r\n\r\n  private handleWindowResize = () => {\r\n    const { renderer } = this.props.sketch;\r\n    this.updateRendererCanvasToMatchParent(renderer);\r\n    if (this.props.sketch.resize != null) {\r\n      this.props.sketch.resize(renderer.domElement.width, renderer.domElement.height);\r\n    }\r\n  };\r\n\r\n  private updateRendererCanvasToMatchParent(renderer: THREE.WebGLRenderer) {\r\n    const parent = renderer.domElement.parentElement;\r\n    if (parent != null) {\r\n      renderer.setSize(parent.clientWidth, parent.clientHeight);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface ISketchComponentState {\r\n  status: SketchStatus;\r\n  volumeEnabled: boolean;\r\n}\r\n\r\nexport class SketchComponent extends React.PureComponent<ISketchComponentProps, ISketchComponentState> {\r\n  public state: ISketchComponentState = {\r\n    status: { type: \"loading\" },\r\n    volumeEnabled: JSON.parse(window.localStorage.getItem(\"sketch-volumeEnabled\") || \"true\"),\r\n  };\r\n\r\n  // private renderer?: THREE.WebGLRenderer;\r\n  private audioContext?: SketchAudioContext;\r\n  private userVolume?: GainNode;\r\n\r\n  private handleContainerRef = (ref: HTMLDivElement | null) => {\r\n    if (ref != null) {\r\n      try {\r\n        // create dependencies, setup sketch, and move to success state\r\n        // we are responsible for live-updating the global user volume.\r\n        const AudioContextConstructor: typeof AudioContext =\r\n          (window as any).AudioContext || (window as any).webkitAudioContext;\r\n        const audioContext = (this.audioContext = new AudioContextConstructor() as SketchAudioContext);\r\n        (THREE.AudioContext as any).setContext(audioContext);\r\n        this.userVolume = audioContext.createGain();\r\n        this.userVolume.gain.setValueAtTime(0.8, 0);\r\n        this.userVolume.connect(audioContext.destination);\r\n        const audioContextGain = (audioContext.gain = audioContext.createGain());\r\n        audioContextGain.connect(this.userVolume);\r\n        document.addEventListener(\"visibilitychange\", this.handleVisibilityChange);\r\n\r\n        const renderer = new THREE.WebGLRenderer({\r\n          alpha: true,\r\n          preserveDrawingBuffer: true,\r\n          antialias: true,\r\n        });\r\n        ref.appendChild(renderer.domElement);\r\n\r\n        const otherArgs = this.props.otherArgs || [];\r\n        const sketch = new this.props.sketchClass(renderer, this.audioContext, ...otherArgs);\r\n        this.setState({ status: { type: \"success\", sketch: sketch } });\r\n      } catch (e) {\r\n        this.setState({ status: { type: \"error\", error: e } });\r\n        console.error(e);\r\n      }\r\n    } else {\r\n      if (this.state.status.type === \"success\") {\r\n        this.state.status.sketch.canvas.remove();\r\n      }\r\n      document.removeEventListener(\"visibilitychange\", this.handleVisibilityChange);\r\n      if (this.audioContext != null) {\r\n        this.audioContext.close();\r\n      }\r\n      this.setState({ status: { type: \"loading\" } });\r\n    }\r\n  };\r\n\r\n  public render() {\r\n    if (this.userVolume != null && this.audioContext != null) {\r\n      // this.userVolume.gain.value = this.state.volumeEnabled ? 1 : 0;\r\n      if (this.state.volumeEnabled && this.audioContext.state === \"suspended\") {\r\n        this.audioContext.resume();\r\n      } else if (!this.state.volumeEnabled && this.audioContext.state === \"running\") {\r\n        this.audioContext.suspend();\r\n      }\r\n    }\r\n\r\n    const { sketchClass, otherArgs, eventsOnBody, errorElement, ...containerProps } = this.props;\r\n    const className = classnames(\"sketch-component\", this.state.status.type);\r\n    return (\r\n      <div {...containerProps} id={this.props.sketchClass.id} className={className} ref={this.handleContainerRef}>\r\n        {this.renderSketchOrStatus()}\r\n        {this.renderVolumeButton()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderSketchOrStatus() {\r\n    const { status } = this.state;\r\n    if (status.type === \"success\") {\r\n      // key on id to not destroy and re-create the component somehow\r\n      return (\r\n        <SketchSuccessComponent\r\n          key={this.props.sketchClass.id}\r\n          sketch={status.sketch}\r\n          eventsOnBody={this.props.eventsOnBody}\r\n        />\r\n      );\r\n    } else if (status.type === \"error\") {\r\n      const errorElement = this.props.errorElement || this.renderDefaultErrorElement(status.error.message);\r\n      return errorElement;\r\n    } else if (status.type === \"loading\") {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private renderDefaultErrorElement(message: string) {\r\n    return (\r\n      <p className=\"sketch-error\">\r\n        Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.\r\n        <pre>{message}</pre>\r\n      </p>\r\n    );\r\n  }\r\n\r\n  private renderVolumeButton() {\r\n    const { volumeEnabled } = this.state;\r\n    return (\r\n      <button className=\"user-volume\" onClick={this.handleVolumeButtonClick}>\r\n        {volumeEnabled ? <FaVolumeUp /> : <FaVolumeOff />}\r\n      </button>\r\n    );\r\n  }\r\n\r\n  private handleVolumeButtonClick = () => {\r\n    const volumeEnabled = !this.state.volumeEnabled;\r\n    this.setState({ volumeEnabled });\r\n    window.localStorage.setItem(\"sketch-volumeEnabled\", JSON.stringify(volumeEnabled));\r\n  };\r\n\r\n  private handleVisibilityChange = () => {\r\n    if (this.audioContext != null) {\r\n      if (document.hidden) {\r\n        this.audioContext.suspend();\r\n      } else if (this.state.volumeEnabled) {\r\n        this.audioContext.resume();\r\n      }\r\n    }\r\n  };\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { SketchConstructor } from \"./sketch\";\r\nimport { SketchComponent } from \"./sketchComponent\";\r\n\r\nexport interface ISketchRouteProps {\r\n  sketchClass: SketchConstructor;\r\n  otherArgs?: any[];\r\n}\r\n\r\nexport class FullPageSketch extends React.PureComponent<ISketchRouteProps, {}> {\r\n  public render() {\r\n    return (\r\n      <div className=\"full-page-sketch\" ref={this.handleDivRef}>\r\n        <SketchComponent sketchClass={this.props.sketchClass} otherArgs={this.props.otherArgs} />\r\n      </div>\r\n    );\r\n  }\r\n  private handleDivRef = (div: HTMLDivElement | null) => {\r\n    if (div != null) {\r\n      // this.requestFullscreen(div);\r\n    } else {\r\n      this.exitFullscreen();\r\n    }\r\n  };\r\n\r\n  private exitFullscreen() {\r\n    if (document.webkitExitFullscreen) {\r\n      document.webkitExitFullscreen();\r\n    } else if (document.mozCancelFullScreen) {\r\n      document.mozCancelFullScreen();\r\n    }\r\n  }\r\n}\r\n","export function lerp(a: number, b: number, x: number) {\r\n  return a + (b - a) * x;\r\n}\r\n\r\nexport function lerp2(v: { x: number; y: number }, t: { x: number; y: number }, l: number) {\r\n  v.x = v.x * (1 - l) + t.x * l;\r\n  v.y = v.y * (1 - l) + t.y * l;\r\n}\r\n\r\nexport function map(x: number, xStart: number, xStop: number, yStart: number, yStop: number) {\r\n  return lerp(yStart, yStop, (x - xStart) / (xStop - xStart));\r\n}\r\n\r\nexport function clamp(x: number, min: number, max: number) {\r\n  return x < min ? min : x > max ? max : x;\r\n}\r\n\r\nexport function sampleArray<T>(a: T[]) {\r\n  return a[Math.floor(Math.random() * a.length)];\r\n}\r\n\r\nexport function triangleWaveApprox(t: number) {\r\n  return (8 / (Math.PI * Math.PI)) * (Math.sin(t) - (1 / 9) * Math.sin(3 * t) + (1 / 25) * Math.sin(5 * t));\r\n}\r\n\r\n/**\r\n * Get a random integer between floor(x) and ceil(x) such that, over many iterations,\r\n * randRound(x) gives an average of x.\r\n */\r\nexport function randRound(x: number) {\r\n  const ix = Math.floor(x);\r\n  const fx = x - ix;\r\n  return ix + (Math.random() < fx ? 1 : 0);\r\n}\r\n\r\n// mod account for negatives\r\nexport function mod(t: number, m: number) {\r\n  return ((t % m) + m) % m;\r\n}\r\n\r\n// perfect triangle wave that goes from [0, 1, 0] in x = [0, 1, 2]\r\nexport function mirroredRepeat(x: number) {\r\n  return (1 - (Math.abs(mod(x * 2, 4) - 2) - 1)) / 2;\r\n}\r\n\r\nexport function logistic(x: number) {\r\n  if (x < -6) {\r\n    return 0;\r\n  } else if (x > 6) {\r\n    return 1;\r\n  }\r\n  return 1 / (1 + Math.exp(-x));\r\n}\r\n","import * as THREE from \"three\";\r\n\r\nimport devlog from \"../../common/devlog\";\r\nimport { SketchAudioContext } from \"../sketch\";\r\n\r\nimport mitoBaseSrc from \"assets/audio/mito-base.mp3\";\r\nimport mitoStringsSrc from \"assets/audio/mito-strings.mp3\";\r\nimport mitoDrumsSrc from \"assets/audio/mito-drums.mp3\";\r\nimport footstepsSrc from \"assets/audio/footsteps.wav\";\r\nimport buildSoundSrc from \"assets/audio/build.wav\";\r\nimport blopSrc from \"assets/audio/Blop-Mark_DiAngelo-79054334.mp3\";\r\nimport suckWaterSrc from \"assets/audio/suckwater.wav\";\r\n\r\nfunction sourceElement(src: string) {\r\n  const type = src.substr(src.length - 3);\r\n  const source = document.createElement(\"source\");\r\n  source.src = src;\r\n  source.type = `audio/${type}`;\r\n  return source;\r\n}\r\nfunction makeNodeOfAudioAsset(ctx: SketchAudioContext, ...srcs: string[]): Unit {\r\n  const audio = document.createElement(\"audio\");\r\n  audio.autoplay = true;\r\n  audio.loop = true;\r\n  for (const src of srcs) {\r\n    audio.appendChild(sourceElement(src));\r\n  }\r\n  // audio.appendChild(sourceElement(assetName, \"mp3\"));\r\n  // audio.appendChild(sourceElement(assetName, \"wav\"));\r\n  const source = ctx.createMediaElementSource(audio);\r\n  const gain = ctx.createGain();\r\n  source.connect(gain);\r\n  return { audio, gain };\r\n}\r\n\r\ninterface Unit {\r\n  gain: GainNode;\r\n  audio: HTMLAudioElement;\r\n}\r\n\r\nexport let mito: Unit;\r\nexport let strings: Unit;\r\nexport let drums: Unit;\r\n\r\nexport let footsteps: Unit;\r\nexport let build: Unit;\r\n\r\nexport let blopBuffer: THREE.AudioBuffer;\r\nexport let suckWaterBuffer: THREE.AudioBuffer;\r\n\r\nexport function hookUpAudio(ctx: SketchAudioContext) {\r\n  let numDone = 0;\r\n  function oneMoreLoaded() {\r\n    numDone++;\r\n    if (numDone === 3) {\r\n      mito.audio.currentTime = 0;\r\n      strings.audio.currentTime = 0;\r\n      drums.audio.currentTime = 0;\r\n      mito.gain.connect(ctx.gain);\r\n      strings.gain.connect(ctx.gain);\r\n      drums.gain.connect(ctx.gain);\r\n    }\r\n  }\r\n  mito = makeNodeOfAudioAsset(ctx, mitoBaseSrc);\r\n  mito.audio.oncanplaythrough = oneMoreLoaded;\r\n  mito.gain.gain.value = 0.5;\r\n\r\n  strings = makeNodeOfAudioAsset(ctx, mitoStringsSrc);\r\n  strings.audio.oncanplaythrough = oneMoreLoaded;\r\n  strings.gain.gain.value = 0.0;\r\n\r\n  drums = makeNodeOfAudioAsset(ctx, mitoDrumsSrc);\r\n  drums.audio.oncanplaythrough = oneMoreLoaded;\r\n  drums.gain.gain.value = 0.0;\r\n\r\n  footsteps = makeNodeOfAudioAsset(ctx, footstepsSrc);\r\n  footsteps.gain.gain.value = 0;\r\n  footsteps.gain.connect(ctx.gain);\r\n\r\n  build = makeNodeOfAudioAsset(ctx, buildSoundSrc);\r\n  build.gain.gain.value = 0;\r\n  build.gain.connect(ctx.gain);\r\n\r\n  const loader = new THREE.AudioLoader();\r\n\r\n  loader.load(\r\n    blopSrc,\r\n    (audioBuffer: THREE.AudioBuffer) => {\r\n      blopBuffer = audioBuffer;\r\n    },\r\n    (xhr: ProgressEvent) => {\r\n      // devlog((xhr.loaded / xhr.total * 100) + '% loaded');\r\n    },\r\n    (err: any) => {\r\n      devlog(\"An error happened\");\r\n    }\r\n  );\r\n  loader.load(\r\n    suckWaterSrc,\r\n    (audioBuffer: THREE.AudioBuffer) => {\r\n      suckWaterBuffer = audioBuffer;\r\n    },\r\n    (xhr: ProgressEvent) => {\r\n      // devlog((xhr.loaded / xhr.total * 100) + '% loaded');\r\n    },\r\n    (err: any) => {\r\n      devlog(\"An error happened\");\r\n    }\r\n  );\r\n}\r\n","import { EventEmitter } from \"events\";\r\nimport { Vector2 } from \"three\";\r\n\r\n// floating point rounding error fix\r\n// without: 0.8 - 0.1 = 0.7000000000000001\r\n// with: fpref(0.8 - 0.1) = 0.7\r\nfunction fpref(x: number) {\r\n  return Math.round(x * 1e12) / 1e12;\r\n}\r\n\r\ninterface HasPosition {\r\n  pos: Vector2;\r\n}\r\n\r\nexport class Inventory {\r\n  constructor(\r\n    public capacity: number,\r\n    public carrier: HasPosition,\r\n    public water: number = 0,\r\n    public sugar: number = 0\r\n  ) {\r\n    this.validate();\r\n  }\r\n\r\n  // public exchange(other: Inventory, giveWater: number, giveSugar: number, getWater: number, getSugar: number) {\r\n  //     giveWater = Math.min(giveWater, this.water);\r\n  //     giveSugar = Math.min(giveSugar, this.sugar);\r\n  //     getWater = Math.min(getWater, other.water);\r\n  //     getSugar = Math.min(getWater, other.sugar);\r\n\r\n  //     // positive = give this amount\r\n  //     // negative = other gives this amount\r\n  //     const wantedExchangedWater = giveWater - getWater;\r\n  //     const wantedExchangedSugar = giveSugar - getSugar;\r\n\r\n  //     const mySpace = fpref(this.space() + wantedExchangedSugar + wantedExchangedWater);\r\n  //     const otherSpace = fpref(other.space() - wantedExchangedSugar - wantedExchangedWater);\r\n\r\n  //     // const mySpace = fpref(this.capacity + giveWater + giveSugar - this.water - this.sugar);\r\n\r\n  //     // const otherSpace = fpref(other.capacity - other.water - other.sugar)\r\n\r\n  //     // const mySpaceNeeded = fpref(getWater + getSugar);\r\n  //     // const otherSpaceNeeded = fpref(giveWater + giveSugar);\r\n\r\n  //     // if (mySpace < mySpaceNeeded) {\r\n  //     //     // e.g. space = 2, needed = 4\r\n  //     //     // only get half\r\n  //     //     const weightedRatio = mySpace / mySpaceNeeded;\r\n  //     //     getWater = getWater * mySpace / mySpaceNeeded;\r\n  //     //     getSugar = getSugar * mySpace / mySpaceNeeded;\r\n  //     // }\r\n\r\n  //     // if (otherSpace < otherSpaceNeeded) {\r\n  //     //     giveWater = giveWater / otherSpace;\r\n  //     //     giveSugar = giveSugar / otherSpace;\r\n  //     // }\r\n  // }\r\n\r\n  public isEmpty() {\r\n    return this.water === 0 && this.sugar === 0;\r\n  }\r\n\r\n  public give(other: Inventory, amountWater: number, amountSugar: number) {\r\n    if (other === this) {\r\n      throw new Error(\"shouldn't give to self\");\r\n    }\r\n    // special case - don't emit events or anything since nothing actually changed\r\n    if (amountWater === 0 && amountSugar === 0) {\r\n      return { water: 0, sugar: 0 };\r\n    }\r\n    // to check:\r\n    // 1) we have enough water and sugar\r\n    //      if we don't, cap water and sugar to the amount available\r\n    // 2) other has enough space\r\n    //      if it doesn't, scale down to the amount that is available\r\n    let water = Math.min(amountWater, this.water);\r\n    let sugar = Math.min(amountSugar, this.sugar);\r\n    const spaceNeeded = fpref(water + sugar);\r\n    const spaceAvailable = other.space();\r\n    if (spaceNeeded > spaceAvailable) {\r\n      // scale down the amount to give\r\n      // give less than capacity\r\n      water = Math.floor((water / spaceNeeded) * spaceAvailable);\r\n      sugar = Math.floor((sugar / spaceNeeded) * spaceAvailable);\r\n    }\r\n    this.change(-water, -sugar);\r\n    other.change(water, sugar);\r\n    if (this.events) {\r\n      this.events.emit(\"give\", other, water, sugar);\r\n    }\r\n    if (other.events) {\r\n      other.events.emit(\"get\", this, water, sugar);\r\n    }\r\n    return { water, sugar };\r\n  }\r\n\r\n  private events?: EventEmitter;\r\n  public on(name: \"give\" | \"get\", fn: (other: Inventory, water: number, sugar: number) => void) {\r\n    this.events = this.events || new EventEmitter();\r\n    this.events.on(name, fn);\r\n  }\r\n  public off(name: \"give\" | \"get\", fn: (...args: any[]) => any) {\r\n    this.events = this.events || new EventEmitter();\r\n    this.events.off(name, fn);\r\n  }\r\n\r\n  public add(water: number, sugar: number) {\r\n    const spaceNeeded = fpref(water + sugar);\r\n    const spaceAvailable = this.space();\r\n    if (spaceNeeded > spaceAvailable) {\r\n      // scale down the amount to give\r\n      water = (water / spaceNeeded) * spaceAvailable;\r\n      sugar = (sugar / spaceNeeded) * spaceAvailable;\r\n    }\r\n    this.change(water, sugar);\r\n  }\r\n\r\n  private change(water: number, sugar: number) {\r\n    const newWater = fpref(this.water + water);\r\n    const newSugar = fpref(this.sugar + sugar);\r\n    this.validate(newWater, newSugar);\r\n    this.water = newWater;\r\n    this.sugar = newSugar;\r\n\r\n    // fixup if needed\r\n    if (this.water < 0) {\r\n      this.water = 0;\r\n    }\r\n    if (this.sugar < 0) {\r\n      this.sugar = 0;\r\n    }\r\n    if (this.water + this.sugar > this.capacity) {\r\n      if (this.water > this.sugar) {\r\n        this.water = this.capacity - this.sugar;\r\n      } else {\r\n        this.sugar = this.capacity - this.water;\r\n      }\r\n    }\r\n  }\r\n\r\n  public space() {\r\n    const { capacity, water, sugar } = this;\r\n    return fpref(capacity - water - sugar);\r\n  }\r\n\r\n  public isMaxed() {\r\n    return this.space() < 1;\r\n  }\r\n\r\n  validate(water: number = this.water, sugar: number = this.sugar) {\r\n    const { capacity } = this;\r\n    if (water < 0) {\r\n      console.warn(`water < 0: ${water}`);\r\n      // throw new Error(`water < 0: ${water}`);\r\n    }\r\n    if (sugar < 0) {\r\n      console.warn(`sugar < 0: ${sugar}`);\r\n      // throw new Error(`sugar < 0: ${sugar}`);\r\n    }\r\n    if (water + sugar > capacity) {\r\n      console.warn(`bad inventory: ${water} water + ${sugar} > ${capacity} max`);\r\n      // throw new Error(`bad inventory: ${water} water + ${sugar} > ${capacity} max`);\r\n    }\r\n  }\r\n}\r\n\r\nexport interface HasInventory {\r\n  inventory: Inventory;\r\n}\r\n\r\nexport function hasInventory<T>(obj?: T): obj is HasInventory & T {\r\n  return obj != null && (obj as any).inventory instanceof Inventory;\r\n}\r\n","import { parse, stringify } from \"query-string\";\r\nimport { ALL_ENVIRONMENTS } from \"./game/environment\";\r\n\r\nconst PARAMS_DEFAULT = {\r\n  isRealtime: true,\r\n  environment: \"Temperate\" as keyof typeof ALL_ENVIRONMENTS,\r\n  cellEnergyMax: 6750,\r\n  tissueInventoryCapacity: 6,\r\n  rootTurnsPerTransfer: 40,\r\n  leafReactionRate: 0.01,\r\n  leafSugarPerReaction: 1,\r\n  cellGestationTurns: 20,\r\n  cellDiffusionWater: 0.002,\r\n  cellDiffusionSugar: 0.002,\r\n  soilDarknessBase: 0.2,\r\n  soilDiffusionWater: 0.001,\r\n  veinDiffusion: 0.5,\r\n  soilMaxWater: 20,\r\n  droop: 0.03,\r\n  fountainTurnsPerWater: 11,\r\n  fountainAppearanceRate: 1.5,\r\n  transportTurnsPerMove: 5,\r\n  sunlightReintroduction: 0.15,\r\n  sunlightDiffusion: 0.0,\r\n  maxResources: 100,\r\n};\r\n\r\ntype Params = typeof PARAMS_DEFAULT;\r\n\r\nexport const params = { ...PARAMS_DEFAULT };\r\n\r\nconst search = parse(window.location.search);\r\nif (search.params != null) {\r\n  const urlHashParams: object = JSON.parse(search.params as string);\r\n  Object.assign(params, urlHashParams);\r\n}\r\n\r\nexport function updateParamsHash() {\r\n  const nonDefaultParams: Partial<Params> = {};\r\n  const keys = Object.keys(PARAMS_DEFAULT) as Array<keyof Params>;\r\n  for (const key of keys) {\r\n    const k = params[key];\r\n    if (k !== PARAMS_DEFAULT[key]) {\r\n      nonDefaultParams[key] = k as any;\r\n    }\r\n  }\r\n  if (Object.keys(nonDefaultParams).length > 0) {\r\n    const stringified = stringify({\r\n      ...(parse(window.location.search)),\r\n      params: JSON.stringify(nonDefaultParams),\r\n    });\r\n    window.location.search = stringified;\r\n  } else {\r\n  }\r\n}\r\nupdateParamsHash();\r\n","import { lerp } from \"math\";\r\nimport { Cell, Tile } from \"./tile\";\r\n\r\nexport enum Temperature {\r\n  Scorching = \"Scorching\",\r\n  Hot = \"Hot\",\r\n  Mild = \"Mild\",\r\n  Cold = \"Cold\",\r\n  Freezing = \"Freezing\",\r\n}\r\n\r\nexport function temperatureFor(t: number) {\r\n  if (t <= 0) {\r\n    return Temperature.Freezing;\r\n  } else if (t <= 32) {\r\n    return Temperature.Cold;\r\n  } else if (t <= 64) {\r\n    return Temperature.Mild;\r\n  } else if (t <= 96) {\r\n    return Temperature.Hot;\r\n  } else {\r\n    return Temperature.Scorching;\r\n  }\r\n}\r\n\r\nexport function nextTemperature(t: Cell, neighbors: Map<any, Tile>, dt: number): number {\r\n  const temperature = t.temperatureFloat;\r\n  let averageTemperature = temperature;\r\n  for (const tile of neighbors.values()) {\r\n    averageTemperature += tile.temperatureFloat;\r\n  }\r\n  averageTemperature /= (neighbors.size + 1);\r\n  // TODO maybe overshoot issues?\r\n  return lerp(temperature, averageTemperature, 0.2 * dt);\r\n}\r\n","// copy-pasted from https://raw.githubusercontent.com/josephg/noisejs/master/perlin.js\r\n// tslint:disable\r\n\r\n/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nclass Grad {\r\n  constructor(public x: number, public y: number, public z: number) {}\r\n\r\n  dot2(x: number, y: number) {\r\n    return this.x * x + this.y * y;\r\n  }\r\n\r\n  dot3(x: number, y: number, z: number) {\r\n    return this.x * x + this.y * y + this.z * z;\r\n  }\r\n}\r\n\r\nconst grad3 = [\r\n  new Grad(1, 1, 0),\r\n  new Grad(-1, 1, 0),\r\n  new Grad(1, -1, 0),\r\n  new Grad(-1, -1, 0),\r\n  new Grad(1, 0, 1),\r\n  new Grad(-1, 0, 1),\r\n  new Grad(1, 0, -1),\r\n  new Grad(-1, 0, -1),\r\n  new Grad(0, 1, 1),\r\n  new Grad(0, -1, 1),\r\n  new Grad(0, 1, -1),\r\n  new Grad(0, -1, -1),\r\n];\r\n\r\nconst p = [\r\n  151,\r\n  160,\r\n  137,\r\n  91,\r\n  90,\r\n  15,\r\n  131,\r\n  13,\r\n  201,\r\n  95,\r\n  96,\r\n  53,\r\n  194,\r\n  233,\r\n  7,\r\n  225,\r\n  140,\r\n  36,\r\n  103,\r\n  30,\r\n  69,\r\n  142,\r\n  8,\r\n  99,\r\n  37,\r\n  240,\r\n  21,\r\n  10,\r\n  23,\r\n  190,\r\n  6,\r\n  148,\r\n  247,\r\n  120,\r\n  234,\r\n  75,\r\n  0,\r\n  26,\r\n  197,\r\n  62,\r\n  94,\r\n  252,\r\n  219,\r\n  203,\r\n  117,\r\n  35,\r\n  11,\r\n  32,\r\n  57,\r\n  177,\r\n  33,\r\n  88,\r\n  237,\r\n  149,\r\n  56,\r\n  87,\r\n  174,\r\n  20,\r\n  125,\r\n  136,\r\n  171,\r\n  168,\r\n  68,\r\n  175,\r\n  74,\r\n  165,\r\n  71,\r\n  134,\r\n  139,\r\n  48,\r\n  27,\r\n  166,\r\n  77,\r\n  146,\r\n  158,\r\n  231,\r\n  83,\r\n  111,\r\n  229,\r\n  122,\r\n  60,\r\n  211,\r\n  133,\r\n  230,\r\n  220,\r\n  105,\r\n  92,\r\n  41,\r\n  55,\r\n  46,\r\n  245,\r\n  40,\r\n  244,\r\n  102,\r\n  143,\r\n  54,\r\n  65,\r\n  25,\r\n  63,\r\n  161,\r\n  1,\r\n  216,\r\n  80,\r\n  73,\r\n  209,\r\n  76,\r\n  132,\r\n  187,\r\n  208,\r\n  89,\r\n  18,\r\n  169,\r\n  200,\r\n  196,\r\n  135,\r\n  130,\r\n  116,\r\n  188,\r\n  159,\r\n  86,\r\n  164,\r\n  100,\r\n  109,\r\n  198,\r\n  173,\r\n  186,\r\n  3,\r\n  64,\r\n  52,\r\n  217,\r\n  226,\r\n  250,\r\n  124,\r\n  123,\r\n  5,\r\n  202,\r\n  38,\r\n  147,\r\n  118,\r\n  126,\r\n  255,\r\n  82,\r\n  85,\r\n  212,\r\n  207,\r\n  206,\r\n  59,\r\n  227,\r\n  47,\r\n  16,\r\n  58,\r\n  17,\r\n  182,\r\n  189,\r\n  28,\r\n  42,\r\n  223,\r\n  183,\r\n  170,\r\n  213,\r\n  119,\r\n  248,\r\n  152,\r\n  2,\r\n  44,\r\n  154,\r\n  163,\r\n  70,\r\n  221,\r\n  153,\r\n  101,\r\n  155,\r\n  167,\r\n  43,\r\n  172,\r\n  9,\r\n  129,\r\n  22,\r\n  39,\r\n  253,\r\n  19,\r\n  98,\r\n  108,\r\n  110,\r\n  79,\r\n  113,\r\n  224,\r\n  232,\r\n  178,\r\n  185,\r\n  112,\r\n  104,\r\n  218,\r\n  246,\r\n  97,\r\n  228,\r\n  251,\r\n  34,\r\n  242,\r\n  193,\r\n  238,\r\n  210,\r\n  144,\r\n  12,\r\n  191,\r\n  179,\r\n  162,\r\n  241,\r\n  81,\r\n  51,\r\n  145,\r\n  235,\r\n  249,\r\n  14,\r\n  239,\r\n  107,\r\n  49,\r\n  192,\r\n  214,\r\n  31,\r\n  181,\r\n  199,\r\n  106,\r\n  157,\r\n  184,\r\n  84,\r\n  204,\r\n  176,\r\n  115,\r\n  121,\r\n  50,\r\n  45,\r\n  127,\r\n  4,\r\n  150,\r\n  254,\r\n  138,\r\n  236,\r\n  205,\r\n  93,\r\n  222,\r\n  114,\r\n  67,\r\n  29,\r\n  24,\r\n  72,\r\n  243,\r\n  141,\r\n  128,\r\n  195,\r\n  78,\r\n  66,\r\n  215,\r\n  61,\r\n  156,\r\n  180,\r\n];\r\n\r\n/*\r\nfor(const i=0; i<256; i++) {\r\nperm[i] = perm[i + 256] = p[i];\r\ngradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nconst F2 = 0.5 * (Math.sqrt(3) - 1);\r\nconst G2 = (3 - Math.sqrt(3)) / 6;\r\n\r\nconst F3 = 1 / 3;\r\nconst G3 = 1 / 6;\r\n\r\nexport class Noise {\r\n  // To remove the need for index wrapping, double the permutation table length\r\n  public perm = new Array(512);\r\n  public gradP = new Array(512);\r\n\r\n  public octaveNum = 6;\r\n  public octaveFalloff = 0.5;\r\n  // rotate by 1 radians (~57 deg), scale by 2\r\n  public octaveMatrix2 = [Math.cos(1) * 2, -Math.sin(1) * 2, Math.sin(1) * 2, Math.cos(1) * 2];\r\n\r\n  // This isn't a very good seeding function, but it works ok. It supports 2^16\r\n  // different seed values. Write something better if you need more seeds.\r\n  public seed(seed: number) {\r\n    if (seed > 0 && seed < 1) {\r\n      // Scale the seed out\r\n      seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n      seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n      let v;\r\n      if (i & 1) {\r\n        v = p[i] ^ (seed & 255);\r\n      } else {\r\n        v = p[i] ^ ((seed >> 8) & 255);\r\n      }\r\n\r\n      this.perm[i] = this.perm[i + 256] = v;\r\n      this.gradP[i] = this.gradP[i + 256] = grad3[v % 12];\r\n    }\r\n  }\r\n\r\n  constructor(seed: number = Math.random() * 2147483647) {\r\n    this.seed(seed);\r\n  }\r\n\r\n  // 2D simplex noise\r\n  public simplex2(xin: number, yin: number) {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin + yin) * F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin + s);\r\n    let j = Math.floor(yin + s);\r\n    const t = (i + j) * G2;\r\n    let x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin - j + t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0 > y0) {\r\n      // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n      i1 = 1;\r\n      j1 = 0;\r\n    } else {\r\n      // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n      i1 = 0;\r\n      j1 = 1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    const y1 = y0 - j1 + G2;\r\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    const y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    const gi0 = this.gradP[i + this.perm[j]];\r\n    const gi1 = this.gradP[i + i1 + this.perm[j + j1]];\r\n    const gi2 = this.gradP[i + 1 + this.perm[j + 1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\r\n    if (t0 < 0) {\r\n      n0 = 0;\r\n    } else {\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * gi0.dot2(x0, y0); // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\r\n    if (t1 < 0) {\r\n      n1 = 0;\r\n    } else {\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\r\n    if (t2 < 0) {\r\n      n2 = 0;\r\n    } else {\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n  }\r\n\r\n  public octaveSimplex2(xin: number, yin: number, octaveNum = this.octaveNum, octaveFalloff = this.octaveFalloff) {\r\n    let sum = 0;\r\n    let x = xin;\r\n    let y = yin;\r\n    let scalar = 1;\r\n    for (let i = 0; i < octaveNum; i++) {\r\n      sum += this.simplex2(x, y) * scalar;\r\n      const newX = x * this.octaveMatrix2[0] + y * this.octaveMatrix2[1];\r\n      const newY = x * this.octaveMatrix2[2] + y * this.octaveMatrix2[3];\r\n      x = newX;\r\n      y = newY;\r\n      scalar *= octaveFalloff;\r\n    }\r\n    return sum;\r\n  }\r\n\r\n  // 3D simplex noise\r\n  public simplex3(xin: number, yin: number, zin: number) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin + yin + zin) * F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin + s);\r\n    let j = Math.floor(yin + s);\r\n    let k = Math.floor(zin + s);\r\n\r\n    const t = (i + j + k) * G3;\r\n    const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\r\n    const y0 = yin - j + t;\r\n    const z0 = zin - k + t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n      if (y0 >= z0) {\r\n        i1 = 1;\r\n        j1 = 0;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 1;\r\n        k2 = 0;\r\n      } else if (x0 >= z0) {\r\n        i1 = 1;\r\n        j1 = 0;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 0;\r\n        k2 = 1;\r\n      } else {\r\n        i1 = 0;\r\n        j1 = 0;\r\n        k1 = 1;\r\n        i2 = 1;\r\n        j2 = 0;\r\n        k2 = 1;\r\n      }\r\n    } else {\r\n      if (y0 < z0) {\r\n        i1 = 0;\r\n        j1 = 0;\r\n        k1 = 1;\r\n        i2 = 0;\r\n        j2 = 1;\r\n        k2 = 1;\r\n      } else if (x0 < z0) {\r\n        i1 = 0;\r\n        j1 = 1;\r\n        k1 = 0;\r\n        i2 = 0;\r\n        j2 = 1;\r\n        k2 = 1;\r\n      } else {\r\n        i1 = 0;\r\n        j1 = 1;\r\n        k1 = 0;\r\n        i2 = 1;\r\n        j2 = 1;\r\n        k2 = 0;\r\n      }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    const x1 = x0 - i1 + G3; // Offsets for second corner\r\n    const y1 = y0 - j1 + G3;\r\n    const z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    const { gradP, perm } = this;\r\n    let gi0 = gradP[i + perm[j + perm[k]]];\r\n    let gi1 = gradP[i + i1 + perm[j + j1 + perm[k + k1]]];\r\n    let gi2 = gradP[i + i2 + perm[j + j2 + perm[k + k2]]];\r\n    let gi3 = gradP[i + 1 + perm[j + 1 + perm[k + 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\r\n    if (t0 < 0) {\r\n      n0 = 0;\r\n    } else {\r\n      t0 *= t0;\r\n      n0 = t0 * t0 * gi0.dot3(x0, y0, z0); // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\r\n    if (t1 < 0) {\r\n      n1 = 0;\r\n    } else {\r\n      t1 *= t1;\r\n      n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\r\n    if (t2 < 0) {\r\n      n2 = 0;\r\n    } else {\r\n      t2 *= t2;\r\n      n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\r\n    if (t3 < 0) {\r\n      n3 = 0;\r\n    } else {\r\n      t3 *= t3;\r\n      n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n  }\r\n\r\n  public octaveSimplex3(\r\n    xin: number,\r\n    yin: number,\r\n    zin: number,\r\n    octaveNum = this.octaveNum,\r\n    octaveFalloff = this.octaveFalloff\r\n  ) {\r\n    let sum = 0;\r\n    let x = xin;\r\n    let y = yin;\r\n    let z = zin;\r\n    let scalar = 1;\r\n    for (let i = 0; i < octaveNum; i++) {\r\n      sum += this.simplex3(x, y, z) * scalar;\r\n      x *= 2;\r\n      y *= 2;\r\n      z *= 2;\r\n      scalar *= octaveFalloff;\r\n    }\r\n    return sum;\r\n  }\r\n\r\n  // ##### Perlin noise stuff\r\n\r\n  public fade(t: number) {\r\n    return t * t * t * (t * (t * 6 - 15) + 10);\r\n  }\r\n\r\n  public lerp(a: number, b: number, t: number) {\r\n    return (1 - t) * a + t * b;\r\n  }\r\n\r\n  // 2D Perlin Noise\r\n  public perlin2(x: number, y: number) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x),\r\n      Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X;\r\n    y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255;\r\n    Y = Y & 255;\r\n\r\n    const { gradP, perm } = this;\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X + perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X + perm[Y + 1]].dot2(x, y - 1);\r\n    let n10 = gradP[X + 1 + perm[Y]].dot2(x - 1, y);\r\n    let n11 = gradP[X + 1 + perm[Y + 1]].dot2(x - 1, y - 1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = this.fade(x);\r\n\r\n    // Interpolate the four results\r\n    return this.lerp(this.lerp(n00, n10, u), this.lerp(n01, n11, u), this.fade(y));\r\n  }\r\n\r\n  // 3D Perlin Noise\r\n  public perlin3(x: number, y: number, z: number) {\r\n    const { gradP, perm } = this;\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x),\r\n      Y = Math.floor(y),\r\n      Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X;\r\n    y = y - Y;\r\n    z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255;\r\n    Y = Y & 255;\r\n    Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X + perm[Y + perm[Z]]].dot3(x, y, z);\r\n    let n001 = gradP[X + perm[Y + perm[Z + 1]]].dot3(x, y, z - 1);\r\n    let n010 = gradP[X + perm[Y + 1 + perm[Z]]].dot3(x, y - 1, z);\r\n    let n011 = gradP[X + perm[Y + 1 + perm[Z + 1]]].dot3(x, y - 1, z - 1);\r\n    let n100 = gradP[X + 1 + perm[Y + perm[Z]]].dot3(x - 1, y, z);\r\n    let n101 = gradP[X + 1 + perm[Y + perm[Z + 1]]].dot3(x - 1, y, z - 1);\r\n    let n110 = gradP[X + 1 + perm[Y + 1 + perm[Z]]].dot3(x - 1, y - 1, z);\r\n    let n111 = gradP[X + 1 + perm[Y + 1 + perm[Z + 1]]].dot3(x - 1, y - 1, z - 1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = this.fade(x);\r\n    let v = this.fade(y);\r\n    let w = this.fade(z);\r\n\r\n    // Interpolate\r\n    return this.lerp(\r\n      this.lerp(this.lerp(n000, n100, u), this.lerp(n001, n101, u), w),\r\n      this.lerp(this.lerp(n010, n110, u), this.lerp(n011, n111, u), w),\r\n      v\r\n    );\r\n  }\r\n}\r\n","import { Vector2 } from \"three\";\r\n\r\nexport const DIRECTIONS = {\r\n  nw: new Vector2(-1, -1),\r\n  w: new Vector2(-1, 0),\r\n  sw: new Vector2(-1, +1),\r\n  n: new Vector2(0, -1),\r\n  // new Vector2( 0,  0),\r\n  s: new Vector2(0, +1),\r\n  ne: new Vector2(+1, -1),\r\n  e: new Vector2(+1, 0),\r\n  se: new Vector2(+1, +1),\r\n};\r\n\r\nexport type Directions = keyof typeof DIRECTIONS;\r\n\r\nexport const DIRECTION_NAMES = Object.keys(DIRECTIONS) as Directions[];\r\nexport const DIRECTION_VALUES: Vector2[] = DIRECTION_NAMES.map((o) => DIRECTIONS[o]);\r\n","import { Player } from \"./player\";\r\nimport { Tile } from \"./tile\";\r\n\r\nexport type Entity = Tile | Player;\r\n\r\nexport interface Steppable {\r\n  dtSinceLastStepped: number;\r\n  shouldStep(dt: number): boolean;\r\n  step(dt: number): void;\r\n}\r\n\r\nexport class StopStep extends Error { }\r\n\r\nexport function isSteppable(obj: any): obj is Steppable {\r\n  return typeof obj.step === \"function\";\r\n}\r\n\r\nexport function step(s: Steppable, dt: number) {\r\n  const sDt = s.dtSinceLastStepped + dt;\r\n  if (s.shouldStep(sDt)) {\r\n    try {\r\n      s.step(sDt);\r\n    } catch (e) {\r\n      if (e instanceof StopStep) {\r\n        // no-op for exiting early\r\n      } else {\r\n        throw e;\r\n      }\r\n    } finally {\r\n      s.dtSinceLastStepped = 0;\r\n    }\r\n  } else {\r\n    s.dtSinceLastStepped = sDt;\r\n  }\r\n}\r\n","export interface Interactable {\r\n  interact(dt: number): void;\r\n}\r\n\r\nexport function isInteractable<T>(e: T): e is Interactable & T {\r\n  return typeof (e as any).interact === \"function\";\r\n}\r\n","import { map, randRound } from \"math\";\r\nimport * as THREE from \"three\";\r\nimport { Vector2 } from \"three\";\r\nimport { GameResult } from \"..\";\r\nimport devlog from \"../../../common/devlog\";\r\nimport { Species } from \"../../../evolution/species\";\r\nimport { getTraits, traitMod, Traits } from \"../../../evolution/traits\";\r\nimport { DIRECTION_VALUES } from \"../directions\";\r\nimport { hasInventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\nimport { Entity, isSteppable, step } from \"./entity\";\r\nimport { Environment } from \"./environment\";\r\nimport { Player } from \"./player\";\r\nimport { Air, Cell, DeadCell, Fruit, hasEnergy, Rock, Soil, Tile, Tissue } from \"./tile\";\r\n\r\n\r\nexport class StepStats {\r\n  constructor(public deleted: Entity[] = [], public added: Entity[] = []) { }\r\n}\r\n\r\nexport interface Season {\r\n  percent: number;\r\n  season: 0 | 1 | 2 | 3;\r\n  month: number;\r\n}\r\n\r\nexport function seasonFromTime(time: number): Season {\r\n  const season = Math.floor(time / TIME_PER_SEASON) as Season[\"season\"];\r\n  const percent = (time % TIME_PER_SEASON) / TIME_PER_SEASON; // percent done with this season\r\n  const month = Math.floor((time % TIME_PER_SEASON) / TIME_PER_MONTH) + 1;\r\n  return {\r\n    season,\r\n    percent,\r\n    month,\r\n  };\r\n}\r\n\r\n\r\nconst SEASON_NAMES = [\"Spring\", \"Summer\", \"Fall\", \"Winter\"];\r\nexport function seasonDisplay(s: Season) {\r\n  return `${SEASON_NAMES[s.season]}, Month ${s.month}`;\r\n}\r\n\r\nexport const TIME_PER_YEAR = 30 * 60 * 15; // 30 fps * 60 seconds/minute * 15 minutes\r\nexport const TIME_PER_SEASON = TIME_PER_YEAR / 4;\r\nexport const TIME_PER_MONTH = TIME_PER_SEASON / 3;\r\nexport const TIME_PER_DAY = TIME_PER_MONTH / 3;\r\n\r\nexport class World {\r\n  public time: number = 0;\r\n  public frame: number = 0;\r\n  public readonly width = 50;\r\n  public readonly height = 100;\r\n  public readonly player: Player;\r\n  private readonly gridEnvironment: Tile[][];\r\n  private readonly gridCells: Array<Array<Cell | null>>;\r\n  private readonly neighborCache: Array<Array<Map<Vector2, Tile>>>;\r\n  private readonly wipResult: Omit<GameResult, \"status\" | \"mutationPointsPerEpoch\">;\r\n  public readonly species: Species;\r\n  public readonly traits: Traits;\r\n\r\n  get season(): Season {\r\n    return seasonFromTime(this.time);\r\n  }\r\n\r\n  constructor(public environment: Environment, species: Species) {\r\n    this.wipResult = {\r\n      fruits: [],\r\n      world: this,\r\n    };\r\n    this.species = species;\r\n    this.traits = getTraits(this.species.genes);\r\n    Cell.diffusionWater = traitMod(this.traits.diffuseWater, params.cellDiffusionWater, 2);\r\n    Cell.diffusionSugar = traitMod(this.traits.diffuseSugar, params.cellDiffusionSugar, 2);\r\n    Cell.turnsToBuild = Math.floor(traitMod(this.traits.buildTime, params.cellGestationTurns, 1 / 2));\r\n    this.player = new Player(new Vector2(this.width / 2, this.height / 2), this);\r\n    this.gridEnvironment = new Array(this.width).fill(undefined).map((_, x) =>\r\n      new Array(this.height).fill(undefined).map((__, y) => {\r\n        const pos = new Vector2(x, y);\r\n\r\n        let tile: Tile | undefined;\r\n        for (const fillFunction of environment.fill) {\r\n          const t = fillFunction(pos, this);\r\n          if (t != null) {\r\n            tile = t;\r\n            break;\r\n          }\r\n        }\r\n        if (tile == null) {\r\n          tile = new Air(pos, this);\r\n        }\r\n        return tile;\r\n      })\r\n    );\r\n\r\n    // always drop player on the Soil Air interface\r\n    const playerX = this.player.pos.x;\r\n    const firstSoil = this.gridEnvironment[playerX].find((t) => !(t instanceof Air));\r\n    if (firstSoil) {\r\n      this.player.posFloat.y = firstSoil.pos.y;\r\n    }\r\n\r\n    const radius = 2.5;\r\n    this.gridCells = new Array(this.width).fill(undefined).map((_, x) =>\r\n      new Array(this.height).fill(undefined).map((__, y) => {\r\n        const pos = new Vector2(x, y);\r\n        // add a \"seed\" of tissue around the player\r\n        if (this.player.pos.distanceTo(pos) < radius) {\r\n          // prevent Rocks underneath the seed\r\n          if (this.gridEnvironment instanceof Rock) {\r\n            this.gridEnvironment[x][y] = new Soil(new Vector2(x, y), 0, this);\r\n          }\r\n          return new Tissue(pos, this);\r\n        } else {\r\n          return null;\r\n        }\r\n      })\r\n    );\r\n    this.neighborCache = new Array(this.width).fill(undefined).map((_, x) =>\r\n      new Array(this.height).fill(undefined).map((__, y) => {\r\n        return this.computeTileNeighbors(x, y);\r\n      })\r\n    );\r\n    this.fillCachedEntities();\r\n\r\n    // step all tiles first with 0 timestep to trigger any initial state\r\n    for (let x = 0; x < this.width; x++) {\r\n      for (let y = 0; y < this.height; y++) {\r\n        const tileEnvironment = this.gridEnvironment[x][y];\r\n        tileEnvironment && tileEnvironment.step(0);\r\n\r\n        const tileCell = this.gridCells[x][y];\r\n        tileCell && tileCell.step(0);\r\n      }\r\n    }\r\n  }\r\n\r\n  public tileAt(v: Vector2): Tile | null;\r\n  public tileAt(x: number, y: number): Tile | null;\r\n  public tileAt(xOrVec2: number | Vector2, y?: number): Tile | null {\r\n    let x: number;\r\n    if (xOrVec2 instanceof Vector2) {\r\n      x = xOrVec2.x;\r\n      y = xOrVec2.y;\r\n    } else {\r\n      x = xOrVec2;\r\n      y = y!;\r\n    }\r\n\r\n    if (!this.isValidPosition(x, y)) {\r\n      return null;\r\n    }\r\n    const cell = this.gridCells[x][y];\r\n    if (cell != null) {\r\n      return cell;\r\n    } else {\r\n      return this.gridEnvironment[x][y];\r\n    }\r\n  }\r\n\r\n  public cells() {\r\n    const { gridCells, width, height } = this;\r\n    return {\r\n      *[Symbol.iterator]() {\r\n        for (let x = 0; x < width; x++) {\r\n          for (let y = 0; y < height; y++) {\r\n            const g = gridCells[x][y];\r\n            if (g != null) {\r\n              yield g;\r\n            }\r\n          }\r\n        }\r\n      },\r\n    };\r\n  }\r\n\r\n  public cellAt(x: number, y: number): Cell | null {\r\n    if (this.isValidPosition(x, y)) {\r\n      return this.gridCells[x][y];\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  public environmentTileAt(x: number, y: number): Tile | null {\r\n    if (this.isValidPosition(x, y)) {\r\n      return this.gridEnvironment[x][y];\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Rules for replacement:\r\n  // if tile is environment, clear out the gridCell and set the gridEnvironment.\r\n  // if tile is cell, set gridCell, leave gridEnvironment alone.\r\n  public setTileAt(position: Vector2, tile: Tile): any {\r\n    const { x, y } = position;\r\n    if (!this.isValidPosition(x, y)) {\r\n      throw new Error(`invalid position ${x}, ${y} `);\r\n    }\r\n    if (tile instanceof Fruit) {\r\n      this.wipResult.fruits.push(tile);\r\n    }\r\n    const oldTile = this.tileAt(x, y)!;\r\n    // if replacing a tile with inventory, try giving resources to neighbors of the same type\r\n    if (hasInventory(oldTile)) {\r\n      // one mechanic - push water to nearby tiles\r\n      const neighbors = this.tileNeighbors(position);\r\n      for (const neighbor of neighbors.values()) {\r\n        if (hasInventory(neighbor) && neighbor instanceof oldTile.constructor) {\r\n          oldTile.inventory.give(neighbor.inventory, oldTile.inventory.water, oldTile.inventory.sugar);\r\n        }\r\n        if (oldTile.inventory.water === 0 && oldTile.inventory.sugar === 0) {\r\n          // we're all done\r\n          break;\r\n        }\r\n      }\r\n      // if (hasInventory(tile)) {\r\n      //   oldTile.inventory.give(tile.inventory, oldTile.inventory.water, oldTile.inventory.sugar);\r\n      // }\r\n      if (oldTile.inventory.water !== 0 || oldTile.inventory.sugar !== 0) {\r\n        console.warn(\"lost\", oldTile.inventory, \"resources to building\");\r\n        oldTile.inventory.add(-oldTile.inventory.water, -oldTile.inventory.sugar);\r\n      }\r\n    }\r\n\r\n    const oldCell = this.gridCells[x][y];\r\n    if (oldCell != null) {\r\n      this.stepStats.deleted.push(oldCell);\r\n    }\r\n\r\n    if (tile instanceof Cell) {\r\n      // set gridCell only\r\n      this.gridCells[x][y] = tile;\r\n    } else {\r\n      // hackhack - we should call .die() on gridCells[x][y] but we already have with the oldTile code above\r\n      this.gridCells[x][y] = null;\r\n\r\n      const oldEnvironmentTile = this.gridEnvironment[x][y];\r\n      if (oldEnvironmentTile != null) {\r\n        this.stepStats.deleted.push(oldEnvironmentTile);\r\n      }\r\n      this.gridEnvironment[x][y] = tile;\r\n    }\r\n    this.stepStats.added.push(tile);\r\n    this.handleTileUpdated(position);\r\n  }\r\n  public maybeRemoveCellAt(position: Vector2): Cell | null {\r\n    const maybeCell = this.cellAt(position.x, position.y);\r\n    if (maybeCell) {\r\n      this.gridCells[position.x][position.y] = null;\r\n      this.stepStats.deleted.push(maybeCell);\r\n    }\r\n    this.handleTileUpdated(position);\r\n    return maybeCell;\r\n  }\r\n  public isValidPosition(x: number, y: number) {\r\n    if (x >= this.width || x < 0 || y >= this.height || y < 0) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  public tileNeighbors(pos: Vector2) {\r\n    return this.neighborCache[pos.x][pos.y];\r\n  }\r\n\r\n  private computeTileNeighbors(px: number, py: number) {\r\n    const mapping = new Map<Vector2, Tile>();\r\n    // randomize the neighbor array to reduce aliasing\r\n    const directions = DIRECTION_VALUES_RAND[this.frame % DIRECTION_VALUES_RAND.length];\r\n    directions.forEach((v) => {\r\n      const x = px + v.x;\r\n      const y = py + v.y;\r\n      const tile = this.tileAt(x, y);\r\n      if (tile != null) {\r\n        mapping.set(v, tile);\r\n      }\r\n    });\r\n    return mapping;\r\n  }\r\n  // only use for rendering\r\n  // private cachedRenderableEntities?: Entity[];\r\n  // public renderableEntities() {\r\n  //     if (this.cachedRenderableEntities == null) {\r\n  //         throw new Error(\"accessed renderable entities before filling\");\r\n  //     }\r\n  //     return this.cachedRenderableEntities;\r\n  // }\r\n\r\n  private cachedEntities?: Entity[];\r\n  public entities() {\r\n    if (this.cachedEntities == null) {\r\n      throw new Error(\"accessed entities before filling\");\r\n    }\r\n    return this.cachedEntities;\r\n  }\r\n\r\n  private handleTileUpdated(pos: Vector2) {\r\n    this.neighborCache[pos.x][pos.y] = this.computeTileNeighbors(pos.x, pos.y);\r\n    for (const dir of DIRECTION_VALUES) {\r\n      const x = pos.x + dir.x;\r\n      const y = pos.y + dir.y;\r\n      if (this.isValidPosition(x, y)) {\r\n        this.neighborCache[x][y] = this.computeTileNeighbors(x, y);\r\n      }\r\n    }\r\n    this.fillCachedEntities();\r\n  }\r\n  private fillCachedEntities() {\r\n    const newEntities: Entity[] = [];\r\n    // we do this super hacky thing for performance where we only run every other entity in\r\n    // a checkerboard pattern.\r\n    //\r\n    // also, entities can interact with other entities, there is no lock-step buffer state,\r\n    // which means you can get weird artifacts like \"water suddenly moves 20 squares\".\r\n    // to combat this we alternatingly reverse the tile iteration order.\r\n    let x = 0,\r\n      y = 0;\r\n    for (x = 0; x < this.width; x++) {\r\n      for (y = (x + this.frame) % 2; y < this.height; y += 2) {\r\n        // checkerboard\r\n        newEntities.push(this.tileAt(x, y)!);\r\n      }\r\n    }\r\n    for (x = 0; x < this.width; x++) {\r\n      for (y = (x + this.frame + 1) % 2; y < this.height; y += 2) {\r\n        // opposite checkerboard\r\n        newEntities.push(this.tileAt(x, y)!);\r\n      }\r\n    }\r\n    if (this.frame % 4 < 2) {\r\n      newEntities.reverse();\r\n    }\r\n    // add player at the end - this is important since Player is currently the only thing\r\n    // that modifies tiles. You can get into situations where tiles that should be dead\r\n    // are still left-over in the entities cache.\r\n    newEntities.push(this.player);\r\n    this.cachedEntities = newEntities;\r\n\r\n    // update renderable entities\r\n    // (() => {\r\n    //     const entities: Entity[] = [this.player];\r\n    //     for (x = 0; x < width; x++) {\r\n    //         for (y = 0; y < height; y++) {\r\n    //             entities.push(this.gridEnvironment[x][y]);\r\n    //             const cellMaybe = this.gridCells[x][y];\r\n    //             if (cellMaybe != null) {\r\n    //                 entities.push(cellMaybe);\r\n    //             }\r\n    //         }\r\n    //     }\r\n    //     this.cachedRenderableEntities = entities;\r\n    // })();\r\n  }\r\n  // iterate through all the actions\r\n  private stepStats: StepStats = new StepStats();\r\n  public step(dt: number): StepStats {\r\n    const entities = this.entities();\r\n    this.stepStats = new StepStats();\r\n    // dear god\r\n    entities.forEach((entity) => {\r\n      if (isSteppable(entity)) {\r\n        step(entity, dt);\r\n      }\r\n    });\r\n    this.updateTemperatures(dt);\r\n    this.computeSunlight(dt);\r\n    this.stepWeather(dt);\r\n    this.frame++;\r\n    this.time += dt;\r\n    this.fillCachedEntities();\r\n    return this.stepStats;\r\n    // this.checkResources();\r\n  }\r\n\r\n  public getLastStepStats() {\r\n    return this.stepStats;\r\n  }\r\n\r\n  public stepWeather(dt: number) {\r\n    // offset first rain event by 200 turns\r\n    const isRaining =\r\n      (this.time + this.environment.climate.turnsBetweenRainfall - 200) %\r\n      this.environment.climate.turnsBetweenRainfall <\r\n      this.environment.climate.rainDuration;\r\n    if (isRaining) {\r\n      // add multiple random droplets\r\n      while (dt > 0) {\r\n        const dropletSizeScalar = Math.min(dt, 1);\r\n        const x = THREE.Math.randInt(0, this.width - 1);\r\n        const t = this.tileAt(x, 0);\r\n        if (t instanceof Air) {\r\n          t.inventory.add(randRound(this.environment.climate.waterPerDroplet * dropletSizeScalar), 0);\r\n        }\r\n        dt -= 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  private temperatureScale = {\r\n    0: {\r\n      day: 60,\r\n      night: 40,\r\n    },\r\n    1: {\r\n      day: 80,\r\n      night: 60,\r\n    },\r\n    2: {\r\n      day: 65,\r\n      night: 31,\r\n    },\r\n    3: {\r\n      day: 40,\r\n      night: 0,\r\n    },\r\n  };\r\n\r\n  /**\r\n   * 0 to 1, where\r\n   * 0 to 0.5: daytime\r\n   * 0.5 to 1: nighttime\r\n   */\r\n  get sunAngle() {\r\n    return this.time * Math.PI * 2 / TIME_PER_DAY;\r\n  }\r\n\r\n  get dayOrNight() {\r\n    return (this.sunAngle % (Math.PI * 2)) < Math.PI ? \"day\" : \"night\";\r\n  }\r\n\r\n  get sunAmount() {\r\n    return (Math.atan(Math.sin(this.sunAngle) * 12) / (Math.PI / 2)) * 0.5 + 0.5;\r\n  }\r\n\r\n  getCurrentTemperature() {\r\n    const { season } = this.season;\r\n    const { day, night } = this.temperatureScale[season];\r\n    return map(this.sunAmount, 0, 1, night, day);\r\n  }\r\n\r\n  public computeSunlight(_dt: number) {\r\n    // sunlight is special - we step downards from the top; neighbors don't affect the calculation so\r\n    // we don't have buffering problems\r\n    const sunAngle = this.sunAngle;\r\n    const directionalBias = Math.sin(sunAngle + Math.PI / 2);\r\n    const sunAmount = this.sunAmount;\r\n    for (let y = 0; y <= this.height * 0.6; y++) {\r\n      for (let x = 0; x < this.width; x++) {\r\n        const t = this.environmentTileAt(x, y);\r\n        if (t instanceof Air) {\r\n          let sunlight = 0;\r\n          if (y === 0) {\r\n            sunlight = 1;\r\n          } else {\r\n            const tileUp = this.tileAt(x, y - 1);\r\n            const tileRight = this.tileAt(x + 1, y - 1);\r\n            const tileLeft = this.tileAt(x - 1, y - 1);\r\n            const upSunlight = tileUp instanceof Air ? tileUp.sunlightCached / sunAmount : tileUp == null ? 1 : 0;\r\n            const rightSunlight =\r\n              tileRight instanceof Air ? tileRight.sunlightCached / sunAmount : tileRight == null ? 1 : 0;\r\n            const leftSunlight =\r\n              tileLeft instanceof Air ? tileLeft.sunlightCached / sunAmount : tileLeft == null ? 1 : 0;\r\n            if (directionalBias > 0) {\r\n              // positive light travels to the right\r\n              sunlight = rightSunlight * directionalBias + upSunlight * (1 - directionalBias);\r\n            } else {\r\n              sunlight = leftSunlight * -directionalBias + upSunlight * (1 - -directionalBias);\r\n            }\r\n            sunlight =\r\n              sunlight * (1 - params.sunlightDiffusion) +\r\n              ((upSunlight + rightSunlight + leftSunlight) / 3) * params.sunlightDiffusion;\r\n          }\r\n          // have at least a bit\r\n          sunlight = params.sunlightReintroduction + sunlight * (1 - params.sunlightReintroduction);\r\n\r\n          sunlight *= sunAmount;\r\n          t.sunlightCached = sunlight;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public updateTemperatures(_dt: number) {\r\n    for (const t of this.cells()) {\r\n      t.temperatureFloat = t.nextTemperature;\r\n    }\r\n  }\r\n\r\n  public maybeGetGameResult(): GameResult | null {\r\n    // you lose if you're standing on a dead cell\r\n    if (this.tileAt(this.player.pos.x, this.player.pos.y) instanceof DeadCell) {\r\n      return {\r\n        ...this.wipResult,\r\n        mutationPointsPerEpoch: 0,\r\n        status: \"lost\",\r\n      };\r\n    }\r\n    if (this.time < TIME_PER_YEAR) {\r\n      return null;\r\n    }\r\n    // at the end of the year, we make a decision:\r\n    // you lose if you haven't made a single mature fruit\r\n    const matureFruit = this.wipResult.fruits.filter((f) => f.isMature());\r\n    if (matureFruit.length === 0) {\r\n      return {\r\n        ...this.wipResult,\r\n        mutationPointsPerEpoch: 0,\r\n        status: \"lost\",\r\n      };\r\n    }\r\n    // you win if there's a seed with full capacity\r\n    return {\r\n      ...this.wipResult,\r\n      mutationPointsPerEpoch: matureFruit.length * traitMod(this.traits.fruitMutationPoints, 1, 1.5),\r\n      status: \"won\",\r\n    };\r\n  }\r\n\r\n  public checkResources() {\r\n    let totalSugar = 0;\r\n    let totalWater = 0;\r\n    let totalEnergy = 0;\r\n    this.entities().forEach((e) => {\r\n      if (hasInventory(e)) {\r\n        totalSugar += e.inventory.sugar;\r\n        totalWater += e.inventory.water;\r\n      }\r\n      if (hasEnergy(e)) {\r\n        totalEnergy += e.energy;\r\n      }\r\n    });\r\n    devlog(\"sugar\", totalSugar, \"water\", totalWater, \"energy\", totalEnergy);\r\n  }\r\n\r\n  public environmentTiles() {\r\n    const self = this;\r\n    return {\r\n      *[Symbol.iterator]() {\r\n        for (const row of self.gridEnvironment) {\r\n          for (const t of row) {\r\n            yield t;\r\n          }\r\n        }\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nfunction shuffle<T>(array: T[]) {\r\n  let currentIndex = array.length,\r\n    temporaryValue,\r\n    randomIndex;\r\n  // While there remain elements to shuffle...\r\n  while (0 !== currentIndex) {\r\n    // Pick a remaining element...\r\n    randomIndex = Math.floor(Math.random() * currentIndex);\r\n    currentIndex -= 1;\r\n    // And swap it with the current element.\r\n    temporaryValue = array[currentIndex];\r\n    array[currentIndex] = array[randomIndex];\r\n    array[randomIndex] = temporaryValue;\r\n  }\r\n  return array;\r\n}\r\nconst DIRECTION_VALUES_RAND = [\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n  shuffle(DIRECTION_VALUES.slice()),\r\n];\r\n","import { Vector2 } from \"three\";\r\nimport { Noise } from \"../../../common/perlin\";\r\nimport { traitMod } from \"../../../evolution/traits\";\r\nimport { clamp, map, randRound } from \"../../../math/index\";\r\nimport { Constructor } from \"../constructor\";\r\nimport { DIRECTIONS } from \"../directions\";\r\nimport { hasInventory, HasInventory, Inventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\nimport { Steppable, StopStep } from \"./entity\";\r\nimport { Interactable, isInteractable } from \"./interactable\";\r\nimport { nextTemperature, Temperature, temperatureFor } from \"./temperature\";\r\nimport { TIME_PER_SEASON, World } from \"./world\";\r\n\r\nexport interface HasEnergy {\r\n  energy: number;\r\n}\r\n\r\nexport function hasEnergy<T>(e: T): e is HasEnergy & T {\r\n  return typeof (e as any).energy === \"number\";\r\n}\r\n\r\nexport abstract class Tile implements Steppable {\r\n  static displayName = \"Tile\";\r\n  static fallAmount = 0;\r\n  public isObstacle = false;\r\n  public darkness = Infinity;\r\n  public temperatureFloat: number;\r\n  public dtSinceLastStepped = 0;\r\n  get temperature(): Temperature {\r\n    return temperatureFor(this.temperatureFloat);\r\n  }\r\n\r\n  get diffusionWater(): number {\r\n    return (this.constructor as any).diffusionWater;\r\n  }\r\n\r\n  get diffusionSugar(): number {\r\n    return (this.constructor as any).diffusionSugar;\r\n  }\r\n\r\n  get fallAmount(): number {\r\n    return (this.constructor as any).fallAmount;\r\n  }\r\n\r\n  public readonly timeMade: number;\r\n\r\n  public pos: Vector2;\r\n\r\n  public get age() {\r\n    return this.world.time - this.timeMade;\r\n  }\r\n\r\n  public constructor(pos: Vector2, public readonly world: World) {\r\n    this.pos = pos.clone();\r\n    if (world == null) {\r\n      throw new Error(\"null world!\");\r\n    }\r\n    this.timeMade = world.time;\r\n    this.temperatureFloat = this.world.getCurrentTemperature();\r\n  }\r\n\r\n  abstract shouldStep(dt: number): boolean;\r\n\r\n  public lightAmount() {\r\n    return Math.sqrt(Math.min(Math.max(map(1 - this.darkness, 0, 1, 0, 1), 0), 1));\r\n  }\r\n\r\n  // test tiles diffusing water around on same-type tiles\r\n  public step(dt: number) {\r\n    // const cellHere = this.world.cellAt(this.pos.x, this.pos.y) != null;\r\n    // if (cellHere) {\r\n    //   console.error(\"stepping environmental tile even when a cell is on-top:\", cellHere);\r\n    // }\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    this.stepDarkness(neighbors, dt);\r\n    this.stepDiffusion(neighbors, dt);\r\n    this.stepTemperature(dt);\r\n    this.stepGravity(dt);\r\n  }\r\n\r\n  stepTemperature(_dt: number) {\r\n    this.temperatureFloat = this.world.getCurrentTemperature();\r\n  }\r\n\r\n  stepDarkness(neighbors: Map<Vector2, Tile>, _dt: number) {\r\n    if (this instanceof Cell) {\r\n      this.darkness = 0;\r\n    } else {\r\n      let minDarkness = this.darkness;\r\n      for (const [, t] of neighbors) {\r\n        const contrib = Math.max(\r\n          0.2,\r\n          map(this.pos.y, this.world.height / 2, this.world.height, params.soilDarknessBase, 1)\r\n        );\r\n        const darknessFromNeighbor = t instanceof Rock ? Infinity : t.darkness + contrib;\r\n        if (t instanceof Cell) {\r\n          minDarkness = 0;\r\n        } else {\r\n          minDarkness = Math.min(minDarkness, darknessFromNeighbor);\r\n        }\r\n      }\r\n      this.darkness = minDarkness;\r\n    }\r\n  }\r\n\r\n  stepDiffusion(neighbors: Map<Vector2, Tile>, dt: number) {\r\n    if (hasInventory(this)) {\r\n      for (const tile of neighbors.values()) {\r\n        if (!this.canDiffuse(tile)) {\r\n          continue;\r\n        }\r\n        // take water from neighbors that have more water than you\r\n        if (this.diffusionWater != null) {\r\n          if (tile.inventory.water > this.inventory.water) {\r\n            this.diffuseWater(tile, dt);\r\n          }\r\n        }\r\n        if (this.diffusionSugar != null) {\r\n          if (tile.inventory.sugar > this.inventory.sugar) {\r\n            this.diffuseSugar(tile, dt);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  canDiffuse(tile: Tile): tile is Tile & HasInventory {\r\n    return canPullResources(this, tile);\r\n  }\r\n\r\n  diffuseWater(giver: HasInventory, dt: number) {\r\n    if (hasInventory(this)) {\r\n      const diffusionAmount = (giver.inventory.water - this.inventory.water) * this.diffusionWater * dt;\r\n      // if (params.soilDiffusionType === \"continuous\") {\r\n      //   giver.inventory.give(this.inventory, diffusionAmount, 0);\r\n      // } else {\r\n      giver.inventory.give(this.inventory, randRound(diffusionAmount), 0);\r\n      // }\r\n    }\r\n  }\r\n\r\n  diffuseSugar(giver: HasInventory, dt: number) {\r\n    if (hasInventory(this)) {\r\n      const diffusionAmount = (giver.inventory.sugar - this.inventory.sugar) * this.diffusionSugar * dt;\r\n      // if (params.soilDiffusionType === \"continuous\") {\r\n      //   giver.inventory.give(this.inventory, 0, diffusionAmount);\r\n      // } else {\r\n      giver.inventory.give(this.inventory, 0, randRound(diffusionAmount));\r\n      // }\r\n    }\r\n  }\r\n\r\n  stepGravity(dt: number) {\r\n    const fallAmount = this.fallAmount * dt;\r\n    const lowerNeighbor = this.world.tileAt(this.pos.x, this.pos.y + 1);\r\n    // if (fallAmount > 0 && this.age % Math.floor(1 / fallAmount) < 1) {\r\n    //   if (hasInventory(lowerNeighbor) && canPullResources(lowerNeighbor, this)) {\r\n    //     this.inventory.give(lowerNeighbor.inventory, 1, 0);\r\n    //   }\r\n    // }\r\n    if (hasInventory(lowerNeighbor) && fallAmount > 0 && canPullResources(lowerNeighbor, this)) {\r\n      this.inventory.give(lowerNeighbor.inventory, randRound(fallAmount), 0);\r\n    }\r\n  }\r\n}\r\n\r\nfunction allowPull(receiver: any, recieverType: Constructor<any>, giver: any, giverType: Constructor<any>) {\r\n  return receiver instanceof recieverType && giver instanceof giverType;\r\n}\r\n\r\nfunction canPullResources(receiver: any, giver: any): giver is HasInventory {\r\n  return (\r\n    hasInventory(receiver) &&\r\n    hasInventory(giver) &&\r\n    // allow ancestors and children to exchange resources with each other (e.g. Soil and Fountain)\r\n    (receiver instanceof giver.constructor ||\r\n      giver instanceof receiver.constructor ||\r\n      // allow all Cells to give to each other\r\n      (receiver instanceof Cell && giver instanceof Cell) ||\r\n      // allow air to give to soil\r\n      allowPull(receiver, Soil, giver, Air))\r\n  );\r\n}\r\n\r\nconst noiseCo2 = new Noise();\r\nexport class Air extends Tile {\r\n  static displayName = \"Air\";\r\n  static fallAmount = 1;\r\n  static diffusionWater = 0.1;\r\n  public sunlightCached: number = 1;\r\n  public _co2: number;\r\n  public inventory = new Inventory(20, this);\r\n  public constructor(public pos: Vector2, world: World) {\r\n    super(pos, world);\r\n    this.darkness = 0;\r\n    this._co2 = this.computeCo2();\r\n  }\r\n\r\n  // Air always steps every 3 tiles, otherwise rainfall and diffusion go much slower\r\n  // than intended\r\n  shouldStep(dt: number) {\r\n    // if (!this.inventory.isEmpty()) {\r\n    return dt > 3;\r\n    // } else {\r\n    //   return super.shouldStep(dt);\r\n    // }\r\n  }\r\n\r\n  private computeCo2() {\r\n    const base = map(this.pos.y, this.world.height / 2, 0, this.world.environment.floorCo2, 1.15);\r\n    const scaleX = map(this.pos.y, this.world.height / 2, 0, 4, 9);\r\n    // const offset = noiseCo2.perlin3(94.2321 - this.pos.x / scaleX, 3221 - this.pos.y / 2.5, world.time / 5 + 93.1) * 0.2;\r\n    const time = this.world == null ? 0 : this.world.time;\r\n    const offset =\r\n      noiseCo2.perlin3(\r\n        94.231 + (this.pos.x - this.world.width / 2) / scaleX,\r\n        2312 + this.pos.y / 8,\r\n        time / 1000 + 93.1\r\n      ) * 0.25;\r\n    return Math.max(Math.min(base + offset, 1), Math.min(0.4, this.world.environment.floorCo2 * 0.75));\r\n  }\r\n\r\n  public lightAmount() {\r\n    return this.sunlight();\r\n  }\r\n\r\n  step(dt: number) {\r\n    // we do NOT call super, to avoid stepping darkness and diffusion.\r\n    this.stepGravity(dt);\r\n    this.stepDiffusionCheap(dt);\r\n    this.stepEvaporation(dt);\r\n    this.stepTemperature(dt);\r\n    this._co2 = this.computeCo2();\r\n  }\r\n\r\n  stepDiffusionCheap(dt: number) {\r\n    // only take water from left and right\r\n    const left = this.world.tileAt(this.pos.x - 1, this.pos.y);\r\n    const right = this.world.tileAt(this.pos.x + 1, this.pos.y);\r\n    // randomize order to remove directional bias\r\n    if (Math.random() < 0.5) {\r\n      this.tryDiffuse(left, dt);\r\n      this.tryDiffuse(right, dt);\r\n    } else {\r\n      this.tryDiffuse(right, dt);\r\n      this.tryDiffuse(left, dt);\r\n    }\r\n  }\r\n\r\n  tryDiffuse(t: Tile | null, dt: number) {\r\n    if (t != null && this.canDiffuse(t)) {\r\n      if (t.inventory.water > this.inventory.water) {\r\n        this.diffuseWater(t, dt);\r\n      }\r\n    }\r\n  }\r\n\r\n  stepEvaporation(dt: number) {\r\n    if (Math.random() < 0.01 * this.inventory.water * dt) {\r\n      this.inventory.add(-1, 0);\r\n    }\r\n  }\r\n\r\n  public co2() {\r\n    return this._co2;\r\n  }\r\n\r\n  public sunlight() {\r\n    return this.sunlightCached;\r\n  }\r\n}\r\n\r\nexport class Soil extends Tile implements HasInventory {\r\n  static displayName = \"Soil\";\r\n  static diffusionWater = params.soilDiffusionWater;\r\n  public inventory = new Inventory(params.soilMaxWater, this);\r\n  // static fallAmount = params.waterGravityPerTurn;\r\n  get fallAmount() {\r\n    return this.world.environment.waterGravityPerTurn;\r\n  }\r\n\r\n  constructor(pos: Vector2, water: number = 0, world: World) {\r\n    super(pos, world);\r\n    this.inventory.add(water, 0);\r\n  }\r\n\r\n  shouldStep(dt: number) {\r\n    // test this out\r\n    return dt > 10;\r\n  }\r\n\r\n  step(dt: number) {\r\n    super.step(dt);\r\n    this.stepEvaporation(dt);\r\n  }\r\n\r\n  stepEvaporation(dt: number) {\r\n    const { evaporationRate, evaporationBottom } = this.world.environment;\r\n    const evaporationHeightScalar = map(this.pos.y, this.world.height / 2, this.world.height * evaporationBottom, 1, 0);\r\n    const evaporationAmountScalar = this.inventory.water;\r\n    if (Math.random() < evaporationRate * evaporationHeightScalar * evaporationAmountScalar * dt) {\r\n      this.inventory.add(-1, 0);\r\n    }\r\n  }\r\n}\r\n\r\nexport class Rock extends Tile {\r\n  isObstacle = true;\r\n  static displayName = \"Rock\";\r\n  shouldStep() { return false; }\r\n}\r\n\r\nexport class DeadCell extends Tile {\r\n  static displayName = \"Dead Cell\";\r\n  shouldStep() { return false; }\r\n}\r\n\r\nexport class Fountain extends Soil {\r\n  static displayName = \"Fountain\";\r\n  isObstacle = true;\r\n  private cooldown = 0;\r\n  constructor(pos: Vector2, water: number = 0, world: World, public turnsPerWater: number) {\r\n    super(pos, water, world);\r\n  }\r\n  step(dt: number) {\r\n    super.step(dt);\r\n    if (this.cooldown > 0) {\r\n      this.cooldown -= dt;\r\n    }\r\n    if (this.inventory.space() > 1 && this.cooldown <= 0) {\r\n      // just constantly give yourself water\r\n      this.inventory.add(1, 0);\r\n      this.cooldown = this.turnsPerWater;\r\n    }\r\n  }\r\n}\r\n\r\ninterface CellEffectConstructor extends Constructor<CellEffect> {\r\n  stacks?: boolean;\r\n}\r\nexport abstract class CellEffect {\r\n  private timeMade!: number;\r\n  public cell!: Cell;\r\n  get age() {\r\n    return this.cell.world.time - this.timeMade;\r\n  }\r\n\r\n  attachTo(cell: Cell) {\r\n    this.cell = cell;\r\n    this.timeMade = this.cell.world.time;\r\n  }\r\n\r\n  /**\r\n   * Return whether to step the next behavior in the chain\r\n   */\r\n  abstract step(dt: number): void;\r\n\r\n  remove() {\r\n    const index = this.cell.effects.indexOf(this);\r\n    this.cell.effects.splice(index, 1);\r\n  }\r\n}\r\n\r\nexport class FreezeEffect extends CellEffect implements Interactable {\r\n  static displayName = \"Frozen\";\r\n  static stacks = false;\r\n  public readonly turnsToDie = 2000;\r\n  public percentFrozen = 0.5;\r\n\r\n  get turnsUntilDeath() {\r\n    return this.turnsToDie - this.age;\r\n  }\r\n\r\n  interact(dt: number) {\r\n    this.percentFrozen -= 20 / this.turnsToDie * dt;\r\n    this.onFrozenChanged();\r\n  }\r\n\r\n  step(dt: number) {\r\n    if (this.cell.temperature === Temperature.Cold) {\r\n      this.percentFrozen += 1 / this.turnsToDie * dt;\r\n    } else if (this.cell.temperature === Temperature.Freezing) {\r\n      this.percentFrozen += 10 / this.turnsToDie * dt;\r\n    } else {\r\n      this.percentFrozen -= 10 / this.turnsToDie * dt;\r\n    }\r\n    this.onFrozenChanged();\r\n\r\n    throw new StopStep();\r\n  }\r\n\r\n  onFrozenChanged() {\r\n    if (this.percentFrozen > 1) {\r\n      this.cell.die();\r\n    } else if (this.percentFrozen < 0) {\r\n      this.remove();\r\n    }\r\n\r\n  }\r\n}\r\n\r\nexport class Cell extends Tile implements HasEnergy, Interactable {\r\n  static displayName = \"Cell\";\r\n  static diffusionWater = params.cellDiffusionWater;\r\n  static diffusionSugar = params.cellDiffusionSugar;\r\n  static turnsToBuild = params.cellGestationTurns;\r\n  public energy: number = params.cellEnergyMax;\r\n  public darkness = 0;\r\n  public nextTemperature: number;\r\n  // offset [-0.5, 0.5] means you're still \"inside\" this cell, going out of it will break you\r\n  // public offset = new Vector2();\r\n  public droopY = 0;\r\n  public args: any[] = [];\r\n  public effects: CellEffect[] = [];\r\n\r\n  get tempo() {\r\n    if (this.temperatureFloat <= 0) {\r\n      // 50% slower - 1 / 2;\r\n      return 1 / 2;\r\n    } else if (this.temperatureFloat <= 32) {\r\n      // 33% slower - 2 / (2 / 3) = 3\r\n      return 2 / 3;\r\n    } else if (this.temperatureFloat <= 64) {\r\n      return 1;\r\n    } else if (this.temperatureFloat <= 96) {\r\n      // 50% faster\r\n      return 1.5;\r\n    } else {\r\n      // 100% faster\r\n      return 2;\r\n    }\r\n  }\r\n\r\n  constructor(pos: Vector2, world: World) {\r\n    super(pos, world);\r\n    this.temperatureFloat = 48;\r\n    this.nextTemperature = this.temperatureFloat;\r\n  }\r\n\r\n  addEffect(effect: CellEffect) {\r\n    const stacks = (effect.constructor as CellEffectConstructor).stacks;\r\n    if (!stacks) {\r\n      // exit early if we found another one and we don't stack\r\n      if (this.findEffectOfType(effect.constructor as CellEffectConstructor) != null) {\r\n        return;\r\n      }\r\n    }\r\n    effect.attachTo(this);\r\n    this.effects.push(effect);\r\n  }\r\n\r\n  findEffectOfType(type: CellEffectConstructor) {\r\n    return this.effects.find((e) => e.constructor === type);\r\n  }\r\n\r\n  interact(dt: number) {\r\n    for (const e of this.effects) {\r\n      if (isInteractable(e)) {\r\n        e.interact(dt);\r\n      }\r\n    }\r\n  }\r\n\r\n  die() {\r\n    this.world.setTileAt(this.pos, new DeadCell(this.pos, this.world));\r\n  }\r\n\r\n  isHungry() {\r\n    // eat below 95% energy\r\n    return this.energy < params.cellEnergyMax * 0.95;\r\n  }\r\n\r\n  // Step cells every 3 frames\r\n  shouldStep(dt: number) {\r\n    return dt > 3;\r\n  }\r\n\r\n  step(dt: number) {\r\n    const { tempo } = this;\r\n    super.step(dt);\r\n    this.energy -= 1 * tempo * dt;\r\n    for (const effect of this.effects) {\r\n      effect.step(dt);\r\n    }\r\n    const tileNeighbors = this.world.tileNeighbors(this.pos);\r\n    const neighbors = Array.from(tileNeighbors.values());\r\n\r\n    // eat from self\r\n    if (this.isHungry()) {\r\n      this.stepEatSugar(this);\r\n    }\r\n    // eat from neighbor's sugars\r\n    if (this.isHungry()) {\r\n      // const neighborsAndSelf = [this, ...neighbors];\r\n      for (const tile of neighbors) {\r\n        this.stepEatSugar(tile);\r\n        if (!this.isHungry()) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    // still hungry; take neighbor's energy\r\n    if (this.isHungry()) {\r\n      const energeticNeighbors = (neighbors.filter((t) => hasEnergy(t)) as any) as HasEnergy[];\r\n      this.stepEqualizeEnergy(energeticNeighbors, tempo, dt);\r\n    }\r\n\r\n    // this.stepStress(tileNeighbors);\r\n    this.stepDroop(tileNeighbors, dt);\r\n    // TODO scale droop by dt\r\n    if (this.droopY > 0.5) {\r\n      if (this.pos.y < this.world.height - 1) {\r\n        // make the player ride the train!\r\n        if (this.world.player.pos.equals(this.pos)) {\r\n          this.world.player.pos.y += 1;\r\n        }\r\n        this.world.maybeRemoveCellAt(this.pos);\r\n        this.pos.y += 1;\r\n        this.droopY -= 1;\r\n        this.world.setTileAt(this.pos, this);\r\n      }\r\n    }\r\n\r\n    if (this.energy <= 0) {\r\n      this.die();\r\n    }\r\n  }\r\n\r\n  stepEatSugar(tile: Tile) {\r\n    if (hasInventory(tile) && !(tile instanceof Fruit)) {\r\n      const hunger = params.cellEnergyMax - this.energy;\r\n      // if this number goes up, we become less energy efficient\r\n      // if this number goes down, we are more energy efficient\r\n      const energyToSugarConversion = traitMod(this.world.traits.energyEfficiency, 1 / params.cellEnergyMax, 1 / 1.5);\r\n      const sugarToEat = Math.min(hunger * energyToSugarConversion, tile.inventory.sugar);\r\n      // eat if we're hungry\r\n      if (hunger > 100 && sugarToEat > 0) {\r\n        tile.inventory.add(0, -sugarToEat);\r\n        const gotEnergy = sugarToEat / energyToSugarConversion;\r\n        this.energy += gotEnergy;\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Take energy from neighbors who have more than you\r\n   */\r\n  stepEqualizeEnergy(neighbors: HasEnergy[], tempo: number, dt: number) {\r\n    for (const neighbor of neighbors) {\r\n      if (this.isHungry()) {\r\n        const difference = neighbor.energy - this.energy;\r\n        if (difference > 20) {\r\n          // safe method but lower upper bound on equalization rate\r\n          // energyTransfer = Math.floor((neighbor.energy - this.energy) / energeticNeighbors.length);\r\n\r\n          // this may be unstable w/o double buffering\r\n          const rate = 0.125 * tempo * dt;\r\n          const energyTransfer = Math.floor(difference * clamp(rate, 0, 0.5));\r\n          // if (rate > 0.5) {\r\n          //   console.warn(\"energy transfer rate wants to be unstable\", rate);\r\n          // }\r\n          this.energy += energyTransfer;\r\n          neighbor.energy -= energyTransfer;\r\n        }\r\n      } else {\r\n        break; // we're all full, eat no more\r\n      }\r\n    }\r\n  }\r\n\r\n  stepTemperature(dt: number) {\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    this.nextTemperature = nextTemperature(this, neighbors, dt);\r\n\r\n    // if we're cold, try to naturally heat ourselves\r\n    if (this.temperatureFloat <= 32) {\r\n      const chanceToFreeze = traitMod(this.world.traits.coldTolerant, (this.temperature === Temperature.Cold ? 0.001 : 0.01), 1 / 1.5) * dt;\r\n      if (Math.random() < chanceToFreeze) {\r\n        this.addEffect(new FreezeEffect());\r\n      }\r\n    } else if (this.temperatureFloat >= 64) {\r\n      const chanceToLoseWater = traitMod(this.world.traits.heatTolerant, (this.temperature === Temperature.Hot ? 0.001 : 0.01), 1 / 1.5) * dt;\r\n      if (Math.random() < chanceToLoseWater && hasInventory(this)) {\r\n        this.inventory.add(Math.max(-1, this.inventory.water), 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  stepDroop(tileNeighbors: Map<Vector2, Tile>, dt: number) {\r\n    const below = tileNeighbors.get(DIRECTIONS.s)!;\r\n    const belowLeft = tileNeighbors.get(DIRECTIONS.sw)!;\r\n    const belowRight = tileNeighbors.get(DIRECTIONS.se)!;\r\n\r\n    const left = tileNeighbors.get(DIRECTIONS.w)!;\r\n    const right = tileNeighbors.get(DIRECTIONS.e)!;\r\n\r\n    const above = tileNeighbors.get(DIRECTIONS.n)!;\r\n    const aboveLeft = tileNeighbors.get(DIRECTIONS.nw)!;\r\n    const aboveRight = tileNeighbors.get(DIRECTIONS.ne)!;\r\n\r\n    const droopAmount = traitMod(this.world.traits.structuralStability, params.droop, 1 / 1.5) * dt;\r\n    this.droopY += droopAmount;\r\n    if (this.energy < params.cellEnergyMax / 2) {\r\n      this.droopY += droopAmount;\r\n    }\r\n\r\n    let hasSupportBelow = false;\r\n    for (const cell of [below, belowLeft, belowRight]) {\r\n      if (cell instanceof Rock || cell instanceof Soil) {\r\n        this.droopY = Math.min(this.droopY, 0);\r\n        return;\r\n      } else if (cell instanceof Cell) {\r\n        this.droopY = Math.min(this.droopY, cell.droopY);\r\n        hasSupportBelow = true;\r\n        return;\r\n      }\r\n    }\r\n\r\n    const springNeighborCells = [aboveLeft, above, aboveRight, left, right, this].filter(\r\n      (n) => n instanceof Cell\r\n    ) as Cell[];\r\n\r\n    // special case - if there's no support and nothing below me, just start freefalling\r\n    if (!hasSupportBelow && springNeighborCells.length === 1) {\r\n      this.droopY += 1;\r\n    } else {\r\n      // TODO tighten springs scaled by dt\r\n      this.droopY = springNeighborCells.reduce((sum, n) => sum + n.droopY, 0) / springNeighborCells.length;\r\n    }\r\n  }\r\n}\r\n\r\nexport class GrowingCell extends Cell {\r\n  public isObstacle = true;\r\n  public timeRemaining: number;\r\n  public timeToBuild: number;\r\n  constructor(pos: Vector2, world: World, public completedCell: Cell) {\r\n    super(pos, world);\r\n    this.timeRemaining = this.timeToBuild = (completedCell.constructor as any).turnsToBuild || 0;\r\n  }\r\n  step(dt: number) {\r\n    super.step(dt);\r\n    this.timeRemaining -= 1 * this.tempo * dt;\r\n    if (this.timeRemaining <= 0) {\r\n      this.world.setTileAt(this.completedCell.pos, this.completedCell);\r\n    }\r\n  }\r\n}\r\n\r\nexport class Tissue extends Cell implements HasInventory {\r\n  static displayName = \"Tissue\";\r\n  public inventory: Inventory;\r\n  constructor(pos: Vector2, world: World) {\r\n    super(pos, world);\r\n    this.inventory = new Inventory(\r\n      Math.floor(traitMod(world.traits.carryCapacity, params.tissueInventoryCapacity, 1.5)),\r\n      this\r\n    );\r\n  }\r\n}\r\n\r\ninterface IHasTilePairs {\r\n  tilePairs: Vector2[];\r\n}\r\n\r\nexport function hasTilePairs(t: any): t is IHasTilePairs {\r\n  return t.tilePairs instanceof Array;\r\n}\r\n\r\nexport class Leaf extends Cell {\r\n  static displayName = \"Leaf\";\r\n  public isObstacle = false;\r\n  public averageEfficiency = 0;\r\n  public averageSpeed = 0;\r\n  public sugarConverted = 0;\r\n  public tilePairs: Vector2[] = []; // implied that the opposite direction is connected\r\n  public totalSugarProduced = 0;\r\n\r\n  public step(dt: number) {\r\n    super.step(dt);\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    this.averageEfficiency = 0;\r\n    this.averageSpeed = 0;\r\n    this.sugarConverted = 0;\r\n    let numAir = 0;\r\n    this.tilePairs = [];\r\n\r\n    for (const [dir, tile] of neighbors) {\r\n      const oppositeTile = this.world.tileAt(this.pos.x - dir.x, this.pos.y - dir.y);\r\n      if (tile instanceof Air && oppositeTile instanceof Tissue) {\r\n        numAir += 1;\r\n        this.tilePairs.push(dir);\r\n        const air = tile;\r\n        const tissue = oppositeTile;\r\n\r\n        // do the reaction slower in dark places\r\n        const speed = air.sunlight();\r\n\r\n        // gives much less sugar lower down\r\n        const efficiency = air.co2();\r\n\r\n        this.averageEfficiency += efficiency;\r\n        this.averageSpeed += speed;\r\n\r\n        const leafReactionRate = traitMod(this.world.traits.photosynthesis, 0.01, 1.5) * this.tempo;\r\n\r\n        // in prime conditions:\r\n        //      our rate of conversion is speed * params.leafReactionRate\r\n        //      we get 1 sugar at 1/efficiencyRatio (> 1) water\r\n        // if we have less than 1/efficiencyRatio water\r\n        //      our rate of conversion scales down proportionally\r\n        //      on conversion, we use up all the available water and get the corresponding amount of sugar\r\n        const bestEfficiencyWater = params.leafSugarPerReaction / efficiency;\r\n        const waterToConvert = Math.min(tissue.inventory.water, bestEfficiencyWater);\r\n        const chance = (speed * leafReactionRate * waterToConvert * dt) / bestEfficiencyWater;\r\n        if (Math.random() < chance) {\r\n          const sugarConverted = waterToConvert * efficiency;\r\n          tissue.inventory.add(-waterToConvert, sugarConverted);\r\n          this.sugarConverted += sugarConverted;\r\n          this.totalSugarProduced += sugarConverted;\r\n        }\r\n      }\r\n    }\r\n    if (numAir > 0) {\r\n      this.averageEfficiency /= numAir;\r\n      // this.averageSpeed /= numAir;\r\n    }\r\n  }\r\n}\r\n\r\nexport class Root extends Cell {\r\n  static displayName = \"Root\";\r\n  public isObstacle = false;\r\n  public activeNeighbors: Vector2[] = [];\r\n  public inventory = new Inventory(params.tissueInventoryCapacity, this);\r\n  cooldown = 0;\r\n  public totalSucked = 0;\r\n\r\n  public step(dt: number) {\r\n    super.step(dt);\r\n    if (this.cooldown <= 0) {\r\n      this.stepWaterTransfer(dt);\r\n      this.cooldown += traitMod(this.world.traits.rootAbsorption, params.rootTurnsPerTransfer, 1 / 1.5);\r\n    }\r\n    this.cooldown -= 1 * this.tempo * dt;\r\n  }\r\n\r\n  private stepWaterTransfer(_dt: number) {\r\n    this.activeNeighbors = [];\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    let doneOnce = false;\r\n    for (const [dir, tile] of neighbors) {\r\n      if (\r\n        tile instanceof Soil\r\n      ) {\r\n        this.activeNeighbors.push(dir);\r\n        if (!doneOnce) {\r\n          const { water } = tile.inventory.give(this.inventory, 1, 0);\r\n          this.totalSucked += water;\r\n          if (water > 0) {\r\n            doneOnce = true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport class Fruit extends Cell {\r\n  static displayName = \"Fruit\";\r\n  public isObstacle = true;\r\n  public inventory = new Inventory(8, this);\r\n  public neededResources: number;\r\n  public committedResources: Inventory;// = new Inventory(Fruit.neededResources, this);\r\n  public timeMatured?: number;\r\n  static turnsToBuild = 0;\r\n  public turnsToMature: number; // = TIME_PER_SEASON / 3 * 2; // takes two months to mature\r\n  get oneTurnCommitMax() {\r\n    return this.neededResources / this.turnsToMature;\r\n  }\r\n\r\n  constructor(pos: Vector2, world: World) {\r\n    super(pos, world);\r\n    this.neededResources = Math.ceil(traitMod(world.traits.fruitNeededResources, 100, 1 / 1.5) / 2) * 2;\r\n    this.committedResources = new Inventory(this.neededResources, this);\r\n    this.committedResources.on(\"get\", this.handleGetResources);\r\n    this.turnsToMature = Math.ceil(traitMod(world.traits.fruitGrowthSpeed, TIME_PER_SEASON / 3 * 2, 1 / 1.5));\r\n  }\r\n\r\n  handleGetResources = () => {\r\n    if (this.timeMatured == null && this.isMature()) {\r\n      this.timeMatured = this.world.time;\r\n      this.committedResources.off(\"get\", this.handleGetResources);\r\n    }\r\n  };\r\n\r\n  // aggressively take the inventory from neighbors\r\n  step(dt: number) {\r\n    super.step(dt);\r\n    // how fast Fruit takes resources from surrounding tiles and puts it onto itself\r\n    // to be committed\r\n    const maxResourceIntake = 1 * dt * this.tempo;\r\n    const neighbors = this.world.tileNeighbors(this.pos);\r\n    for (const [, neighbor] of neighbors) {\r\n      if (hasInventory(neighbor) && neighbor instanceof Cell && !(neighbor instanceof Fruit)) {\r\n        const wantedWater = Math.min(this.neededResources / 2 - this.committedResources.water, maxResourceIntake);\r\n        const wantedSugar = Math.min(this.neededResources / 2 - this.committedResources.sugar, maxResourceIntake);\r\n\r\n        neighbor.inventory.give(this.inventory, wantedWater, wantedSugar);\r\n      }\r\n    }\r\n    this.commitResources(dt);\r\n  }\r\n\r\n  commitResources(dt: number) {\r\n    const wantedWater = Math.min(this.neededResources / 2 - this.committedResources.water, this.oneTurnCommitMax / 2 * dt * this.tempo);\r\n    const wantedSugar = Math.min(this.neededResources / 2 - this.committedResources.sugar, this.oneTurnCommitMax / 2 * dt * this.tempo);\r\n    this.inventory.give(this.committedResources, wantedWater, wantedSugar);\r\n  }\r\n\r\n  getPercentMatured() {\r\n    const r = this.committedResources;\r\n    return (r.sugar + r.water) / r.capacity;\r\n  }\r\n\r\n  isMature() {\r\n    // add 1 buffer for fp errors\r\n    return this.committedResources.water + this.committedResources.sugar >= this.neededResources - 1;\r\n  }\r\n}\r\n\r\nfunction isFractional(x: number) {\r\n  return x % 1 !== 0;\r\n}\r\n\r\nexport class Transport extends Tissue {\r\n  static displayName = \"Transport\";\r\n  public cooldownWater = 0;\r\n  public cooldownSugar = 0;\r\n\r\n  constructor(pos: Vector2, world: World, public dir: Vector2) {\r\n    super(pos, world);\r\n    if (isFractional(dir.x) || isFractional(dir.y)) {\r\n      throw new Error(\"build transport with fractional dir \" + dir.x + \", \" + dir.y);\r\n    }\r\n  }\r\n\r\n  step(dt: number) {\r\n    super.step(dt);\r\n    // transport hungers at double speed\r\n    this.energy -= 1 * this.tempo * dt;\r\n    let waterToTransport = 0;\r\n    let sugarToTransport = 0;\r\n    if (this.cooldownWater <= 0) {\r\n      waterToTransport++;\r\n      const turnsPerWater = Math.floor(traitMod(this.world.traits.activeTransportWater, 20, 1 / 1.5));\r\n      this.cooldownWater += turnsPerWater;\r\n    }\r\n    if (this.cooldownSugar <= 0) {\r\n      sugarToTransport++;\r\n      const turnsPerSugar = Math.floor(traitMod(this.world.traits.activeTransportSugar, 20, 1 / 1.5));\r\n      this.cooldownSugar += turnsPerSugar;\r\n    }\r\n\r\n    if (waterToTransport > 0 || sugarToTransport > 0) {\r\n      const targetTile = this.getTarget();\r\n      if (targetTile) {\r\n        this.inventory.give(targetTile.inventory, waterToTransport, sugarToTransport);\r\n      }\r\n\r\n      const fromTile = this.getFrom();\r\n      if (fromTile) {\r\n        fromTile.inventory.give(this.inventory, waterToTransport, sugarToTransport);\r\n      }\r\n    }\r\n    this.cooldownWater -= 1 * dt * this.tempo;\r\n    this.cooldownSugar -= 1 * dt * this.tempo;\r\n  }\r\n\r\n  public getTarget() {\r\n    const targetTile = this.world.tileAt(this.pos.x + this.dir.x, this.pos.y + this.dir.y);\r\n    if (targetTile instanceof Cell && hasInventory(targetTile)) {\r\n      return targetTile;\r\n    }\r\n  }\r\n\r\n  public getFrom() {\r\n    const fromTile = this.world.tileAt(this.pos.x - this.dir.x, this.pos.y - this.dir.y);\r\n    if (fromTile instanceof Cell && hasInventory(fromTile)) {\r\n      return fromTile;\r\n    }\r\n  }\r\n}\r\n\r\nexport class Vein extends Tissue {\r\n  static displayName = \"Vein\";\r\n  // static diffusionWater = 0;\r\n  static get diffusionWater() {\r\n    return params.veinDiffusion;\r\n  }\r\n  static get diffusionSugar() {\r\n    return params.veinDiffusion;\r\n  }\r\n  public inventory = new Inventory(8, this);\r\n  // diffusionNeighbors(neighbors: Map<Vector2, Tile>) {\r\n  //     return super.diffusionNeighbors(neighbors).filter((t) => t instanceof Vein);\r\n  // }\r\n}\r\n","import { EventEmitter } from \"events\";\r\nimport { Vector2 } from \"three\";\r\nimport { traitMod } from \"../../../evolution/traits\";\r\nimport { Action, ActionBuild, ActionDeconstruct, ActionDrop, ActionInteract, ActionMove, ActionMultiple, ActionPickup } from \"../action\";\r\nimport { build, footsteps } from \"../audio\";\r\nimport { Constructor } from \"../constructor\";\r\nimport { hasInventory, Inventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\nimport { Steppable } from \"./entity\";\r\nimport { Cell, FreezeEffect, Fruit, GrowingCell, Tile, Transport } from \"./tile\";\r\nimport { World } from \"./world\";\r\n\r\nexport class Player implements Steppable {\r\n  public inventory = new Inventory(\r\n    params.maxResources,\r\n    this,\r\n    Math.round(params.maxResources / 3),\r\n    Math.round(params.maxResources / 3)\r\n  );\r\n  private action?: Action;\r\n  private events = new EventEmitter();\r\n  public mapActions?: (player: Player, action: Action) => Action | undefined;\r\n  // public speed: number;\r\n  // public dropWater = false;\r\n  // public dropSugar = false;\r\n  public baseSpeed: number;\r\n  public dtSinceLastStepped = 0;\r\n\r\n  public get speed() {\r\n    const t = this.currentTile();\r\n    return this.baseSpeed * (t instanceof Cell ? t.tempo : 1);\r\n  }\r\n\r\n  get pos() {\r\n    return this.posFloat.clone().round();\r\n  }\r\n\r\n  public constructor(public posFloat: Vector2, public world: World) {\r\n    this.baseSpeed = traitMod(world.traits.walkSpeed, 0.15, 1.5);\r\n  }\r\n\r\n  shouldStep() {\r\n    return true;\r\n  }\r\n\r\n  public setAction(action: Action) {\r\n    if (this.action != null) {\r\n      this.action = {\r\n        type: \"multiple\",\r\n        actions: [this.action, action],\r\n      };\r\n    } else {\r\n      this.action = action;\r\n    }\r\n  }\r\n\r\n  public getAction() {\r\n    return this.action;\r\n  }\r\n\r\n  public droopY() {\r\n    const tile = this.world.tileAt(this.pos.x, this.pos.y);\r\n    if (tile instanceof Cell) {\r\n      return tile.droopY;\r\n    } else {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  public droopPosFloat() {\r\n    const droopY = this.droopY();\r\n    if (droopY !== 0) {\r\n      const t = this.posFloat.clone();\r\n      t.y += droopY;\r\n      return t;\r\n    }\r\n    return this.posFloat;\r\n  }\r\n\r\n  public currentTile() {\r\n    return this.world.tileAt(this.pos)!;\r\n  }\r\n\r\n  public on(event: string, cb: (...args: any[]) => void) {\r\n    this.events.on(event, cb);\r\n  }\r\n\r\n  public step(dt: number) {\r\n    if (this.action === undefined) {\r\n      this.action = { type: \"none\" };\r\n    }\r\n    if (this.mapActions) {\r\n      const mappedAction = this.mapActions(this, this.action);\r\n      if (mappedAction != null) {\r\n        this.action = mappedAction;\r\n      } else {\r\n        this.action = { type: \"none\" };\r\n      }\r\n    }\r\n    const actionSuccessful = this.attemptAction(this.action, dt);\r\n    this.maybeMoveWithTransports(dt);\r\n    // if (this.dropWater) {\r\n    //   this.attemptAction(ACTION_KEYMAP.q);\r\n    // }\r\n    // if (this.dropSugar) {\r\n    //   this.attemptAction(ACTION_KEYMAP.e);\r\n    // }\r\n    if (actionSuccessful) {\r\n      this.events.emit(\"action\", this.action);\r\n    }\r\n    this.action = undefined;\r\n  }\r\n\r\n  private maybeMoveWithTransports(dt: number) {\r\n    const tile = this.currentTile();\r\n    if (tile instanceof Transport) {\r\n      this.posFloat.add(tile.dir.clone().setLength(this.speed * 0.15 * dt));\r\n    }\r\n  }\r\n\r\n  public attemptAction(action: Action, dt: number): boolean {\r\n    switch (action.type) {\r\n      case \"none\":\r\n        // literally do nothing\r\n        return true;\r\n      case \"still\":\r\n        return this.attemptStill(dt);\r\n      case \"move\":\r\n        return this.attemptMove(action, dt);\r\n      case \"build\":\r\n        return this.attemptBuild(action, dt);\r\n      case \"deconstruct\":\r\n        return this.attemptDeconstruct(action, dt);\r\n      case \"drop\":\r\n        return this.attemptDrop(action, dt);\r\n      case \"pickup\":\r\n        return this.attemptPickup(action, dt);\r\n      case \"multiple\":\r\n        return this.attemptMultiple(action, dt);\r\n      case \"interact\":\r\n        return this.attemptInteract(action, dt);\r\n    }\r\n  }\r\n  public verifyMove(action: ActionMove, dt: number) {\r\n    const target = this.posFloat\r\n      .clone()\r\n      .add(action.dir.clone().setLength(this.speed * dt))\r\n      .round();\r\n    return this.isWalkable(target);\r\n  }\r\n\r\n  public isWalkable(pos: Tile | Vector2) {\r\n    if (pos instanceof Tile) {\r\n      pos = pos.pos;\r\n    }\r\n    if (!this.world.isValidPosition(pos.x, pos.y)) {\r\n      return false;\r\n    }\r\n    const tile = this.world.tileAt(pos.x, pos.y);\r\n    if (!(tile instanceof Cell) || tile == null || tile.isObstacle) {\r\n      // can't move!\r\n      return false;\r\n    }\r\n    if (tile instanceof Cell) {\r\n      return tile.findEffectOfType(FreezeEffect) == null;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public isBuildCandidate(tile: Tile | null): tile is Tile {\r\n    if (tile != null && !tile.isObstacle) {\r\n      if (tile instanceof Cell) {\r\n        return tile.findEffectOfType(FreezeEffect) == null;\r\n      }\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptMove(action: ActionMove, dt: number) {\r\n    if (this.verifyMove(action, dt)) {\r\n      // const t = this.currentTile();\r\n      // if (t instanceof Cell) {\r\n      //   if (t.temperature < 40) {\r\n      //     t.nextTemperature += 0.2;\r\n      //   }\r\n      //   else if (t.temperature > 60) {\r\n      //     t.nextTemperature -= 0.2;\r\n      //   }\r\n      // }\r\n      footsteps.gain.gain.cancelScheduledValues(0);\r\n      footsteps.gain.gain.value = 0.5;\r\n      footsteps.gain.gain.linearRampToValueAtTime(0, footsteps.gain.context.currentTime + 0.05);\r\n      // do the move\r\n      this.posFloat.add(action.dir.clone().setLength(this.speed * dt));\r\n      // this._pos = this.posFloat.clone().round();\r\n      // this.autopickup();\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n  public attemptStill(_dt: number) {\r\n    // this.autopickup();\r\n    return true;\r\n  }\r\n  // private autopickup() {\r\n  //   // autopickup resources in the position as possible\r\n  //   const cell = this.currentTile();\r\n  //   if (hasInventory(cell)) {\r\n  //     const inv = cell.inventory;\r\n  //     inv.give(this.inventory, this.suckWater ? inv.water : 0, this.suckSugar ? inv.sugar : 0);\r\n  //   }\r\n  // }\r\n  public tryConstructingNewCell<T extends Cell>(position: Vector2, cellType: Constructor<T>, args: any[]) {\r\n    position = position.clone();\r\n    const targetTile = this.world.tileAt(position.x, position.y);\r\n    if (targetTile == null) {\r\n      // out of bounds/out of map\r\n      return;\r\n    }\r\n    // disallow building over a seed\r\n    if (targetTile instanceof Fruit) {\r\n      return;\r\n    }\r\n    const waterCost = 1;\r\n    const sugarCost = 1;\r\n    const tileAlreadyExists =\r\n      targetTile instanceof cellType && !((cellType as any) === Transport && targetTile instanceof Transport);\r\n    if (\r\n      !tileAlreadyExists &&\r\n      !targetTile.isObstacle &&\r\n      this.inventory.water >= waterCost &&\r\n      this.inventory.sugar >= sugarCost\r\n    ) {\r\n      this.inventory.add(-waterCost, -sugarCost);\r\n      const newTile = new cellType(position, this.world, ...args);\r\n      newTile.args = args;\r\n      build.audio.currentTime = 0;\r\n      build.gain.gain.cancelScheduledValues(0);\r\n      build.gain.gain.value = 0.2;\r\n      build.gain.gain.exponentialRampToValueAtTime(0.0001, build.gain.context.currentTime + 0.5);\r\n      return newTile;\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  private argsEq(args1: any, args2: any) {\r\n    if (typeof args1 !== typeof args2) {\r\n      return false;\r\n    }\r\n    if (args1 == null && args2 == null) {\r\n      return true;\r\n    }\r\n    if (args1 instanceof Vector2 && args2 instanceof Vector2) {\r\n      return args1.equals(args2);\r\n    }\r\n    if (args1 instanceof Array && args2 instanceof Array) {\r\n      const allEq = args1.every((_, index) => this.argsEq(args1[index], args2[index]));\r\n      return allEq;\r\n    }\r\n  }\r\n\r\n  private isMeaningfulBuild(action: ActionBuild, existingCell: Cell) {\r\n    if (existingCell.constructor !== action.cellType) {\r\n      return true;\r\n    }\r\n\r\n    if (!this.argsEq(action.args, existingCell.args)) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public attemptBuild(action: ActionBuild, dt: number) {\r\n    const existingCell = this.world.cellAt(action.position.x, action.position.y);\r\n    if (existingCell != null && !this.isMeaningfulBuild(action, existingCell)) {\r\n      // already built, whatever.\r\n      return true;\r\n    }\r\n    if (existingCell) {\r\n      this.attemptDeconstruct({\r\n        type: \"deconstruct\",\r\n        position: action.position,\r\n        force: true,\r\n      }, dt);\r\n    }\r\n    const matureCell = this.tryConstructingNewCell(action.position, action.cellType, action.args);\r\n    if (matureCell != null) {\r\n      let cell: Cell;\r\n      if (action.cellType.turnsToBuild) {\r\n        cell = new GrowingCell(action.position, this.world, matureCell);\r\n      } else {\r\n        cell = matureCell;\r\n      }\r\n      cell.droopY = this.droopY();\r\n      this.world.setTileAt(action.position, cell);\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptDeconstruct(action: ActionDeconstruct, _dt: number): boolean {\r\n    if (!action.position.equals(this.pos) || action.force) {\r\n      const cell = this.world.maybeRemoveCellAt(action.position);\r\n      if (cell != null) {\r\n        // refund the resources back\r\n        const refund = cell.energy / params.cellEnergyMax;\r\n        this.inventory.add(refund, refund);\r\n        if (hasInventory(cell)) {\r\n          cell.inventory.give(this.inventory, cell.inventory.water, cell.inventory.sugar);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public attemptDrop(action: ActionDrop, dt: number) {\r\n    // drop as much as you can onto the current tile\r\n    const currentTile = this.currentTile();\r\n    if (hasInventory(currentTile)) {\r\n      const { water: waterRate, sugar: sugarRate } = action;\r\n      const water = waterRate * dt;\r\n      const sugar = sugarRate * dt;\r\n      // first, pick up the opposite of what you can from the tile to try and make space\r\n      currentTile.inventory.give(this.inventory, sugar, water);\r\n\r\n      // give as much as you can\r\n      this.inventory.give(currentTile.inventory, water, sugar);\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  public attemptPickup(action: ActionPickup, dt: number) {\r\n    const cell = this.currentTile();\r\n    if (hasInventory(cell)) {\r\n      const inv = cell.inventory;\r\n      inv.give(this.inventory, action.water * dt, action.sugar * dt);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public attemptMultiple(multiple: ActionMultiple, dt: number) {\r\n    let allSuccess = true;\r\n    for (const action of multiple.actions) {\r\n      allSuccess = this.attemptAction(action, dt) && allSuccess;\r\n    }\r\n    return allSuccess;\r\n  }\r\n\r\n  public attemptInteract(action: ActionInteract, dt: number) {\r\n    action.interactable.interact(dt);\r\n    return true;\r\n  }\r\n}\r\n","export default function lazy<T>(fn: () => T): () => T {\r\n  let cache: T;\r\n  return () => {\r\n    if (cache === undefined) {\r\n      cache = fn();\r\n    }\r\n    return cache;\r\n  };\r\n}\r\n","import * as THREE from \"three\";\r\nimport lazy from \"../../common/lazy\";\r\n\r\nimport roguelikeSheet_transparentSrc from \"assets/images/roguelikeSheet_transparent.png\";\r\nimport fruitSrc from \"assets/images/fruit.png\";\r\n\r\nconst spriteSize = 16; // 16x16 sprites\r\nexport let spritesheetLoaded = false;\r\nconst SPRITESHEET = lazy(() =>\r\n  new THREE.TextureLoader().load(roguelikeSheet_transparentSrc, () => {\r\n    SPRITESHEET().dispatchEvent({ type: \"update\" });\r\n    spritesheetLoaded = true;\r\n  })\r\n);\r\n\r\nexport const fruitTexture = new THREE.TextureLoader().load(fruitSrc);\r\n\r\nconst cache: { [key: string]: THREE.Texture } = {};\r\n// x, y are spritesheet coordinates, starting top-left and going down/right\r\nexport function textureFromSpritesheet(x: number, y: number, backgroundColor = \"white\") {\r\n  x = Math.floor(x);\r\n  y = Math.floor(y);\r\n  const key = `${x},${y}`;\r\n  if (cache[key] == null) {\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = spriteSize;\r\n    canvas.height = spriteSize;\r\n    const texture = new THREE.Texture(canvas);\r\n    texture.magFilter = THREE.NearestFilter;\r\n    texture.flipY = true;\r\n    texture.wrapS = THREE.RepeatWrapping;\r\n    texture.wrapT = THREE.RepeatWrapping;\r\n    function drawSpriteToCanvas() {\r\n      const image = SPRITESHEET().image;\r\n      const context = canvas.getContext(\"2d\")!;\r\n      context.fillStyle = backgroundColor;\r\n      context.fillRect(0, 0, spriteSize, 16);\r\n      // context.fillStyle = \"white\";\r\n      // flip the image vertically\r\n      context.drawImage(\r\n        image,\r\n        // sx, sy, sWidth, sHeight\r\n        spriteSize * x,\r\n        spriteSize * y,\r\n        spriteSize,\r\n        spriteSize,\r\n        // dx, dy, dWidth, dHeight\r\n        0,\r\n        0,\r\n        spriteSize,\r\n        spriteSize\r\n      );\r\n      texture.needsUpdate = true;\r\n      // devlog(\"updated spritesheet for\", x, y);\r\n    }\r\n    if (spritesheetLoaded) {\r\n      drawSpriteToCanvas();\r\n    } else {\r\n      SPRITESHEET().addEventListener(\"update\", () => {\r\n        drawSpriteToCanvas();\r\n      });\r\n    }\r\n    cache[key] = texture;\r\n  }\r\n  return cache[key];\r\n}\r\n","import { Scene } from \"three\";\r\nimport { Mito } from \"../index\";\r\nexport abstract class Renderer<T> {\r\n  constructor(public target: T, public scene: Scene, public mito: Mito) {}\r\n  abstract update(): void;\r\n  abstract destroy(): void;\r\n}\r\n","import { BufferAttribute, BufferGeometry, Color, Points, ShaderMaterial, Texture } from \"three\";\r\n\r\nexport class ResourceParticles extends Points {\r\n  static BUFFER_SIZE = 100000;\r\n  public geometry!: BufferGeometry;\r\n  public material!: ResourceParticleMaterial;\r\n  static newGeometry() {\r\n    const geometry = new BufferGeometry();\r\n    const positions = new Float32Array(ResourceParticles.BUFFER_SIZE * 3);\r\n    const sizes = new Float32Array(ResourceParticles.BUFFER_SIZE);\r\n    geometry.addAttribute(\"position\", new BufferAttribute(positions, 3).setDynamic(true));\r\n    geometry.addAttribute(\"size\", new BufferAttribute(sizes, 1).setDynamic(true));\r\n    return geometry;\r\n  }\r\n  constructor(params: MaterialParams) {\r\n    super();\r\n    this.geometry = ResourceParticles.newGeometry();\r\n    this.material = new ResourceParticleMaterial(params);\r\n    this.frustumCulled = false;\r\n  }\r\n  private index = 0;\r\n  startFrame() {\r\n    this.index = 0;\r\n  }\r\n  commit(x: number, y: number, z: number, size: number) {\r\n    this.geometry.attributes.position.setXYZ(this.index, x, y, z);\r\n    this.geometry.attributes.size.setX(this.index, size);\r\n    this.index++;\r\n  }\r\n  endFrame() {\r\n    const positions = this.geometry.attributes.position as BufferAttribute;\r\n    positions.needsUpdate = true;\r\n    const sizes = this.geometry.attributes.size as BufferAttribute;\r\n    sizes.needsUpdate = true;\r\n    this.geometry.setDrawRange(0, this.index);\r\n  }\r\n}\r\n\r\nexport interface MaterialParams {\r\n  opacity: number;\r\n  color: Color;\r\n  size: number;\r\n  map?: Texture;\r\n}\r\n\r\nclass ResourceParticleMaterial extends ShaderMaterial {\r\n  public map: Texture | undefined;\r\n\r\n  constructor(public params: MaterialParams) {\r\n    super({\r\n      uniforms: {\r\n        opacity: { value: params.opacity },\r\n        sizeGlobal: { value: params.size },\r\n        color: { value: params.color },\r\n        // you have to put it here too\r\n        map: { value: params.map },\r\n      },\r\n      vertexShader,\r\n      fragmentShader,\r\n      depthTest: false,\r\n      transparent: true,\r\n    } as any);\r\n\r\n    // OH MY GOD you can do this. You have to do this *AFTER* the super call!\r\n    this.map = params.map;\r\n  }\r\n}\r\n\r\nconst vertexShader = `\r\nattribute float size;\r\nuniform float sizeGlobal;\r\n\r\nvoid main() {\r\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\r\n    gl_Position = projectionMatrix * mvPosition;\r\n}\r\n`;\r\n\r\nconst fragmentShader = `\r\nuniform vec3 color;\r\nuniform sampler2D texture;\r\nuniform float opacity;\r\n\r\n#ifdef USE_MAP\r\n  uniform mat3 uvTransform;\r\n  uniform sampler2D map;\r\n#endif\r\n\r\nvoid main() {\r\n    gl_FragColor = vec4( color, opacity );\r\n\r\n    #ifdef USE_MAP\r\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\r\n        gl_FragColor *= mapTexelToLinear( mapTexel );\r\n    #endif\r\n}\r\n`;\r\n","import Ticker from \"global/ticker\";\r\nimport { Color, Scene, Vector2 } from \"three\";\r\nimport lazy from \"../../../common/lazy\";\r\nimport { map } from \"../../../math\";\r\nimport { Mito } from \"../index\";\r\nimport { Inventory } from \"../inventory\";\r\nimport { textureFromSpritesheet } from \"../spritesheet\";\r\nimport { Renderer } from \"./Renderer\";\r\nimport { ResourceParticles } from \"./resourceParticles\";\r\n\r\n\r\n// we represent Resources as dots of certain colors.\r\nexport class InventoryRenderer extends Renderer<Inventory> {\r\n  static WaterParticles = lazy(\r\n    () =>\r\n      new ResourceParticles(\r\n        {\r\n          color: new Color(\"rgb(9, 12, 255)\"),\r\n          size: 45,\r\n          opacity: 0.75,\r\n        }\r\n        // new PointsMaterial({\r\n        //     // map: textureFromSpritesheet(0, 1),\r\n        //     transparent: true,\r\n        //     opacity: 0.75,\r\n        //     // color: new Color(\"rgb(12, 41, 255)\"),\r\n        //     // color: new Color(\"rgb(29, 42, 255)\"),\r\n        //     color: new Color(\"rgb(9, 12, 255)\"),\r\n        //     size: .12,\r\n        //     side: DoubleSide,\r\n        // })\r\n      )\r\n  );\r\n\r\n  static SugarParticles = lazy(\r\n    () =>\r\n      new ResourceParticles(\r\n        {\r\n          color: new Color(\"yellow\"),\r\n          size: 85,\r\n          opacity: 0.9,\r\n          map: textureFromSpritesheet(42, 12, \"transparent\"),\r\n        }\r\n        // new PointsMaterial({\r\n        //     map: textureFromSpritesheet(42, 12, \"transparent\"),\r\n        //     transparent: true,\r\n        //     opacity: 0.9,\r\n        //     color: \"yellow\",\r\n        //     size: .12,\r\n        //     side: DoubleSide,\r\n        // })\r\n      )\r\n  );\r\n\r\n  static startFrame() {\r\n    InventoryRenderer.WaterParticles().startFrame();\r\n    InventoryRenderer.SugarParticles().startFrame();\r\n  }\r\n\r\n  static endFrame() {\r\n    InventoryRenderer.WaterParticles().endFrame();\r\n    InventoryRenderer.SugarParticles().endFrame();\r\n  }\r\n  // static geometry = new PlaneBufferGeometry(1, 1);\r\n  // static waterMaterial = new MeshBasicMaterial({\r\n  //     // map: textureFromSpritesheet(0, 1),\r\n  //     transparent: true,\r\n  //     opacity: 0.75,\r\n  //     // color: new Color(\"rgb(12, 41, 255)\"),\r\n  //     // color: new Color(\"rgb(29, 42, 255)\"),\r\n  //     color: new Color(\"rgb(9, 12, 255)\"),\r\n  //     side: DoubleSide,\r\n  // });\r\n  // static sugarMaterial = lazy(() => new MeshBasicMaterial({\r\n  //     map: textureFromSpritesheet(42, 12, \"transparent\"),\r\n  //     transparent: true,\r\n  //     opacity: 0.9,\r\n  //     color: \"yellow\",\r\n  //     // color: new Color(\"yellow\"),\r\n  //     side: DoubleSide,\r\n  // }));\r\n  public animationOffset = 0;\r\n  // public object = new Object3D();\r\n  public waters: Vector2[] = [];\r\n  public sugars: Vector2[] = [];\r\n  constructor(target: Inventory, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    target.on(\"get\", this.handleGetResources);\r\n    target.on(\"give\", this.handleGiveResources);\r\n    // this.object.name = \"InventoryRenderer Object\";\r\n    // this.object.position.z = 1;\r\n    // this.object.updateMatrix();\r\n    // this.object.matrixAutoUpdate = false;\r\n    for (let i = 0; i < this.target.water; i++) {\r\n      this.waters.push(newParticle());\r\n    }\r\n    for (let i = 0; i < this.target.sugar; i++) {\r\n      this.sugars.push(newParticle());\r\n    }\r\n  }\r\n  private handleGetResources = (giver: Inventory) => {\r\n    let wantedMeshes = Math.ceil(this.target.water);\r\n    while (this.waters.length < wantedMeshes) {\r\n      const v = giver.carrier.pos.clone().sub(this.target.carrier.pos);\r\n      v.x += (Math.random() - 0.5) * 0.1;\r\n      v.y += (Math.random() - 0.5) * 0.1;\r\n      this.waters.push(v);\r\n    }\r\n\r\n    wantedMeshes = Math.ceil(this.target.sugar);\r\n    while (this.sugars.length < wantedMeshes) {\r\n      const v = giver.carrier.pos.clone().sub(this.target.carrier.pos);\r\n      v.x += (Math.random() - 0.5) * 0.1;\r\n      v.y += (Math.random() - 0.5) * 0.1;\r\n      this.sugars.push(v);\r\n    }\r\n  };\r\n\r\n  private handleGiveResources = () => {\r\n    let wantedMeshes = Math.ceil(this.target.water);\r\n    if (this.waters.length > wantedMeshes) {\r\n      this.waters.splice(wantedMeshes, this.waters.length - wantedMeshes);\r\n    }\r\n\r\n    wantedMeshes = Math.ceil(this.target.sugar);\r\n    if (this.sugars.length > wantedMeshes) {\r\n      this.sugars.splice(wantedMeshes, this.sugars.length - wantedMeshes);\r\n    }\r\n  };\r\n\r\n  private updateNumParticles(resources: number) {\r\n    // while (resourceArray.length < wantedMeshes) {\r\n    //     this.newParticle(resourceArray);\r\n    // }\r\n    // if (resourceArray.length > wantedMeshes) {\r\n    //     resourceArray.splice(wantedMeshes, resourceArray.length - wantedMeshes);\r\n    // }\r\n  }\r\n\r\n  private commitParticles(particles: ResourceParticles, resource: number, resourceArray: Vector2[]) {\r\n    if (resourceArray.length > 0) {\r\n      for (let i = 0; i < resourceArray.length - 1; i++) {\r\n        const p = resourceArray[i];\r\n        particles.commit(p.x + this.target.carrier.pos.x, p.y + this.target.carrier.pos.y, 10, 1);\r\n        resource -= 1;\r\n      }\r\n      const p = resourceArray[resourceArray.length - 1];\r\n      const fract = resource;\r\n      particles.commit(\r\n        p.x + this.target.carrier.pos.x,\r\n        p.y + this.target.carrier.pos.y,\r\n        10,\r\n        map(Math.sqrt(fract), 0, 1, 0.2, 1)\r\n      );\r\n    }\r\n  }\r\n\r\n  private simulateResourcePositions() {\r\n    const numWaters = this.waters.length;\r\n    const numResources = numWaters + this.sugars.length;\r\n    for (let i = 0; i < numResources; i++) {\r\n      const r = i < numWaters ? this.waters[i] : this.sugars[i - numWaters];\r\n      let vx = 0,\r\n        vy = 0;\r\n      const angle = Ticker.now / 3000 + this.animationOffset;\r\n      vx += Math.cos(angle) * 0.02;\r\n      const goTowardsCenterStrength = 0.1 + r.length() * 0.1;\r\n      vx += -r.x * goTowardsCenterStrength;\r\n      vy += -r.y * goTowardsCenterStrength;\r\n      const player = this.mito.world.player;\r\n      if (player.pos.equals(this.target.carrier.pos)) {\r\n        const playerX = player.posFloat.x - player.pos.x;\r\n        const playerY = player.posFloat.y - player.pos.y;\r\n        const offsetX = r.x - playerX;\r\n        const offsetY = r.y - playerY;\r\n        const mag2 = offsetX * offsetX + offsetY * offsetY;\r\n        const avoidPlayerStrength = Math.max(Math.min(map(mag2, 0, 1, 3, -5), 3), 0);\r\n        const accelerationX = offsetX * avoidPlayerStrength * 0.2;\r\n        const accelerationY = offsetY * avoidPlayerStrength * 0.2;\r\n        vx += accelerationX;\r\n        vy += accelerationY;\r\n      }\r\n      for (let j = 0; j < numResources; j++) {\r\n        const l = j < numWaters ? this.waters[j] : this.sugars[j - numWaters];\r\n        if (r === l) {\r\n          break;\r\n        }\r\n        const dx = r.x - l.x;\r\n        const dy = r.y - l.y;\r\n        const lengthSq = dx * dx + dy * dy;\r\n        if (lengthSq > 0) {\r\n          const strength = 0.003 / lengthSq;\r\n          vx += dx * strength;\r\n          vy += dy * strength;\r\n        }\r\n      }\r\n      r.x += vx;\r\n      r.y += vy;\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.updateNumParticles(this.target.water);\r\n    this.updateNumParticles(this.target.sugar);\r\n    this.simulateResourcePositions();\r\n    this.commitParticles(InventoryRenderer.WaterParticles(), this.target.water, this.waters);\r\n    this.commitParticles(InventoryRenderer.SugarParticles(), this.target.sugar, this.sugars);\r\n  }\r\n\r\n  destroy() {\r\n    // no-op\r\n    this.target.off(\"get\", this.handleGetResources);\r\n    this.target.off(\"give\", this.handleGiveResources);\r\n  }\r\n}\r\n\r\nfunction newParticle() {\r\n  return new Vector2((Math.random() - 0.5) * 0.01, (Math.random() - 0.5) * 0.01);\r\n}\r\n","import Ticker from \"global/ticker\";\r\nimport { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry, Scene } from \"three\";\r\nimport { lerp2 } from \"../../../math\";\r\nimport { Player } from \"../game\";\r\nimport { Mito } from \"../index\";\r\nimport { textureFromSpritesheet } from \"../spritesheet\";\r\nimport { Renderer } from \"./Renderer\";\r\n\r\n\r\nexport class PlayerRenderer extends Renderer<Player> {\r\n  public mesh: Mesh;\r\n  constructor(target: Player, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    this.mesh = new Mesh(\r\n      new PlaneBufferGeometry(0.75, 0.75),\r\n      // new THREE.CircleBufferGeometry(0.5, 20),\r\n      new MeshBasicMaterial({\r\n        transparent: true,\r\n        depthWrite: false,\r\n        depthTest: false,\r\n        map: textureFromSpritesheet(29, 12, \"transparent\"),\r\n        color: new Color(\"white\"),\r\n        side: DoubleSide,\r\n      })\r\n    );\r\n    lerp2(this.mesh.position, this.target.pos, 1);\r\n    this.mesh.position.z = 2;\r\n    this.scene.add(this.mesh);\r\n  }\r\n  update() {\r\n    const pos = this.target.droopPosFloat().clone();\r\n    pos.x += Math.cos(Ticker.now / 1000) * 0.04;\r\n    pos.y += Math.sin(Ticker.now / 400) * 0.08;\r\n    lerp2(this.mesh.position, pos, 0.5);\r\n    this.mesh.position.z = 2;\r\n    // for (const [key, keyMesh] of MOVEMENT_KEY_MESHES) {\r\n    //   const action = MOVEMENT_KEYS[key];\r\n    //   const x = this.target.pos.x + action.dir.x;\r\n    //   const y = this.target.pos.y + action.dir.y;\r\n    //   if (this.target.isBuildCandidate(this.mito.world.tileAt(x, y)) && this.mito.uiState.type === \"main\") {\r\n    //     this.scene.add(keyMesh);\r\n    //     keyMesh.position.x = x;\r\n    //     keyMesh.position.y = y;\r\n    //     keyMesh.position.z = 2;\r\n    //   } else {\r\n    //     this.scene.remove(keyMesh);\r\n    //   }\r\n    // }\r\n  }\r\n  destroy() {\r\n    this.scene.remove(this.mesh);\r\n  }\r\n}\r\n","import { lerp, map } from \"math\";\r\nimport { Color, DoubleSide, Mesh, MeshBasicMaterial, PlaneBufferGeometry } from \"three\";\r\nimport { Cell, CellEffect, FreezeEffect } from \"../game/tile\";\r\nimport { textureFromSpritesheet } from \"../spritesheet\";\r\nimport { Renderer } from \"./Renderer\";\r\nimport { TileRenderer } from \"./TileRenderer\";\r\n\r\nexport class CellEffectsRenderer extends Renderer<Cell> {\r\n  private renderers: Renderer<CellEffect>[] = [];\r\n  constructor(public readonly tileRenderer: TileRenderer<Cell>) {\r\n    super(tileRenderer.target, tileRenderer.scene, tileRenderer.mito);\r\n  }\r\n\r\n  update() {\r\n    // account for if target has more effects\r\n    let index;\r\n    for (index = 0; index < this.target.effects.length; index++) {\r\n      const effect = this.target.effects[index];\r\n      const renderer = this.renderers[index];\r\n      if (renderer == null) {\r\n        this.renderers[index] = createEffectRenderer(effect, this.tileRenderer);\r\n      } else if (effect !== renderer.target) {\r\n        // delete and add new renderer\r\n        renderer.destroy();\r\n        this.renderers[index] = createEffectRenderer(effect, this.tileRenderer);\r\n      }\r\n    }\r\n    // delete extraneous effects\r\n    for (; index < this.renderers.length; index++) {\r\n      const renderer = this.renderers[index];\r\n      renderer.destroy();\r\n    }\r\n\r\n    for (const r of this.renderers) {\r\n      r.update();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    for (const r of this.renderers) {\r\n      r.destroy();\r\n    }\r\n  }\r\n}\r\n\r\nfunction createEffectRenderer<T extends CellEffect>(effect: T, tileRenderer: TileRenderer): Renderer<CellEffect> {\r\n  if (effect instanceof FreezeEffect) {\r\n    return new FreezeEffectRenderer(effect, tileRenderer);\r\n  } else {\r\n    throw new Error(\"effect renderer not defined for\" + effect);\r\n  }\r\n}\r\n\r\nclass FreezeEffectRenderer extends Renderer<FreezeEffect> {\r\n  static newMesh = () => {\r\n    const g = new PlaneBufferGeometry(0.75, 0.75);\r\n    g.translate(0, 0, 1);\r\n    const material = new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(Math.floor(23 / 16), Math.floor(22 / 16)),\r\n      side: DoubleSide,\r\n      color: COLD_BLUE,\r\n      transparent: true,\r\n      opacity: 0.5,\r\n    });\r\n    return new Mesh(g, material);\r\n  };\r\n\r\n  private mesh: Mesh;\r\n  constructor(target: FreezeEffect, public tileRenderer: TileRenderer) {\r\n    super(target, tileRenderer.scene, tileRenderer.mito);\r\n    this.mesh = FreezeEffectRenderer.newMesh();\r\n    tileRenderer.mesh.add(this.mesh);\r\n    this.mesh.scale.set(0.01, 0.01, 1);\r\n  }\r\n\r\n  update() {\r\n    const percentFrozen = this.target.percentFrozen;\r\n    const s = map(percentFrozen, 0, 1, 0.2, 1);\r\n    this.mesh.scale.x = lerp(this.mesh.scale.x, s, 0.2);\r\n    this.mesh.scale.y = lerp(this.mesh.scale.y, s, 0.2);\r\n  }\r\n\r\n  destroy() {\r\n    this.tileRenderer.mesh.remove(this.mesh);\r\n  }\r\n}\r\n\r\nconst COLD_BLUE = new Color(\"#1E90FF\").lerp(new Color(0), 0.5);\r\n","import { easeCubic } from \"d3-ease\";\r\nimport Ticker from \"global/ticker\";\r\nimport { reversed } from \"math/easing\";\r\nimport React from \"react\";\r\nimport { ArrowHelper, Audio, BufferGeometry, Color, DoubleSide, Float32BufferAttribute, Line, LineBasicMaterial, Mesh, MeshBasicMaterial, Object3D, PlaneBufferGeometry, Scene, Vector2, Vector3 } from \"three\";\r\nimport lazy from \"../../../common/lazy\";\r\nimport { clamp, lerp, lerp2, map } from \"../../../math/index\";\r\nimport { blopBuffer, suckWaterBuffer } from \"../audio\";\r\nimport { Constructor } from \"../constructor\";\r\nimport { Temperature } from \"../game/temperature\";\r\nimport { Air, Cell, DeadCell, Fountain, Fruit, GrowingCell, hasEnergy, hasTilePairs, Leaf, Rock, Root, Soil, Tile, Tissue, Transport, Vein } from \"../game/tile\";\r\nimport { Mito, WorldDOMElement } from \"../index\";\r\nimport { hasInventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\nimport { fruitTexture, textureFromSpritesheet } from \"../spritesheet\";\r\nimport { CellEffectsRenderer } from \"./CellEffectsRenderer\";\r\nimport { InventoryRenderer } from \"./InventoryRenderer\";\r\nimport { Renderer } from \"./Renderer\";\r\n\r\ntype Animation = (dt: number) => boolean;\r\n\r\nclass AnimationController {\r\n  animation?: Animation;\r\n  timeStarted?: number;\r\n\r\n  set(a: Animation, now: number) {\r\n    this.animation = a;\r\n    this.timeStarted = now;\r\n  }\r\n\r\n  update(now: number) {\r\n    if (this.animation != null && this.timeStarted != null) {\r\n      const dt = now - this.timeStarted;\r\n      const ended = this.animation(dt);\r\n      if (ended) {\r\n        this.animation = undefined;\r\n        this.timeStarted = undefined;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport class TileMesh extends Mesh {\r\n  static geometry = new PlaneBufferGeometry(1, 1);\r\n  constructor(public renderer: TileRenderer) {\r\n    super(TileMesh.geometry, getMaterial(renderer.target) as MeshBasicMaterial);\r\n  }\r\n}\r\n\r\nexport class TileRenderer<T extends Tile = Tile> extends Renderer<T> {\r\n  public static readonly TEMPERATURE_COLORS = {\r\n    [Temperature.Scorching]: new Color(\"orange\"),\r\n    [Temperature.Hot]: new Color(\"orange\").lerp(new Color(\"white\"), 0.5),\r\n    [Temperature.Mild]: new Color(\"white\"),\r\n    [Temperature.Cold]: new Color(\"lightblue\").lerp(new Color(\"white\"), 0.5),\r\n    [Temperature.Freezing]: new Color(\"lightblue\"),\r\n  } as Record<Temperature, Color>;\r\n\r\n  private static ONE = new Vector2(1, 1);\r\n\r\n  // public object = new Object3D();\r\n  public mesh: TileMesh;\r\n  private inventoryRenderer?: InventoryRenderer;\r\n  private originalColor: Color;\r\n  private audio?: Audio;\r\n  private lastAudioValueTracker = 0;\r\n  private pairsLines = new Object3D();\r\n  private worldDomElement?: WorldDOMElement;\r\n  private growingRenderer?: TileRenderer;\r\n  private cellEffectsRenderer?: CellEffectsRenderer;\r\n  private animation = new AnimationController();\r\n\r\n  constructor(target: T, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    if (this.target instanceof GrowingCell) {\r\n      this.growingRenderer = new TileRenderer(this.target.completedCell, this.scene, this.mito);\r\n      this.mesh = this.growingRenderer.mesh;\r\n      this.mesh.scale.set(0.01, 0.01, 1);\r\n    } else {\r\n      this.mesh = new TileMesh(this);\r\n    }\r\n    // this.object.name = \"TileRenderer Object\";\r\n    this.originalColor = (this.mesh.material as MeshBasicMaterial).color.clone();\r\n    if (hasInventory(this.target)) {\r\n      this.inventoryRenderer = new InventoryRenderer(this.target.inventory, this.scene, this.mito);\r\n      this.inventoryRenderer.animationOffset = (this.target.pos.x + this.target.pos.y) / 2;\r\n    }\r\n    this.scene.add(this.mesh);\r\n    const zIndex = this.target instanceof Cell ? 1 : 0;\r\n    this.mesh.position.set(this.target.pos.x, this.target.pos.y, zIndex);\r\n    if (this.target instanceof Cell) {\r\n      // if it takes no turns to build, start it off small just for show\r\n      if (!(this.target.constructor as Constructor<Cell>).turnsToBuild) {\r\n        this.mesh.scale.set(0.01, 0.01, 1);\r\n      }\r\n    } else {\r\n      this.mesh.matrixAutoUpdate = false;\r\n    }\r\n    this.mesh.updateMatrix();\r\n    if (this.target instanceof Leaf || this.target instanceof Root) {\r\n      this.audio = new Audio(this.mito.audioListener);\r\n      this.mesh.add(this.audio);\r\n    }\r\n\r\n    if (this.target instanceof Fruit) {\r\n      const fruit = this.target;\r\n      this.worldDomElement = mito.addWorldDOMElement(\r\n        () => this.target.pos,\r\n        () => {\r\n          return (\r\n            <div className=\"fruit-indicator\">\r\n              <div>\r\n                {fruit.committedResources.water.toFixed(1)}/{fruit.neededResources / 2} water\r\n              </div>\r\n              <div>\r\n                {fruit.committedResources.sugar.toFixed(1)}/{fruit.neededResources / 2} sugar\r\n              </div>\r\n            </div>\r\n          );\r\n        }\r\n      );\r\n    }\r\n\r\n    if (this.target instanceof Cell) {\r\n      this.cellEffectsRenderer = new CellEffectsRenderer(this as unknown as TileRenderer<Cell>);\r\n    }\r\n  }\r\n\r\n  steps(x: number, size: number) {\r\n    return Math.floor(x / size) * size;\r\n  }\r\n\r\n  update() {\r\n    const lightAmount = this.target.lightAmount();\r\n    this.updateVisibility(lightAmount);\r\n    this.updateSize();\r\n    this.updateColor(lightAmount);\r\n\r\n    // match position\r\n    if (this.target instanceof Cell) {\r\n      this.mesh.position.set(this.target.pos.x, this.target.pos.y + this.target.droopY, 1);\r\n    }\r\n\r\n    this.respondToEvents();\r\n\r\n    if (this.cellEffectsRenderer != null) {\r\n      this.cellEffectsRenderer.update();\r\n    }\r\n\r\n    this.animation.update(Ticker.now / 1000);\r\n  }\r\n\r\n  updateVisibility(lightAmount: number) {\r\n    // visibility\r\n    if (lightAmount > 0) {\r\n      if (this.mesh.parent == null) {\r\n        this.scene.add(this.mesh);\r\n      }\r\n      if (this.inventoryRenderer != null) {\r\n        // will not render without an update\r\n        this.inventoryRenderer.update();\r\n      }\r\n    } else if (this.mesh.parent != null) {\r\n      this.scene.remove(this.mesh);\r\n    }\r\n  }\r\n\r\n  updateSize() {\r\n    if (this.target instanceof GrowingCell) {\r\n      // const s = this.steps(1.001 - this.target.timeRemaining / params.cellGestationTurns, 0.05);\r\n      const s = 1 - this.target.timeRemaining / this.target.timeToBuild;\r\n      lerp2(this.mesh.scale, { x: s, y: s }, 0.5);\r\n      // this.mesh.scale.x = s;\r\n      // this.mesh.scale.y = s;\r\n    } else if (this.target instanceof Fruit) {\r\n      const scale = map(this.target.getPercentMatured(), 0, 1, 0.2, 1);\r\n      const targetScale = new Vector2(scale, scale);\r\n      lerp2(this.mesh.scale, targetScale, 0.1);\r\n    } else {\r\n      lerp2(this.mesh.scale, TileRenderer.ONE, 0.1);\r\n    }\r\n  }\r\n\r\n  updateColor(lightAmount: number) {\r\n    const mat = this.mesh.material as MeshBasicMaterial;\r\n    if (this.target instanceof Air) {\r\n      const colorIndex = Math.max(0, map(this.target.co2(), 1 / 6, 1.001, 0, AIR_COLORSCALE.length - 1));\r\n      const startColorIndex = Math.floor(colorIndex);\r\n      const startColor = AIR_COLORSCALE[startColorIndex];\r\n      this.originalColor = startColor.clone();\r\n      if (startColorIndex !== AIR_COLORSCALE.length - 1) {\r\n        const alpha = colorIndex - startColorIndex;\r\n        const endColorIndex = startColorIndex + 1;\r\n        const endColor = AIR_COLORSCALE[endColorIndex];\r\n        this.originalColor.lerp(endColor, alpha);\r\n      }\r\n    }\r\n    mat.color.copy(this.originalColor);\r\n    if (hasEnergy(this.target)) {\r\n      mat.color.lerp(new Color(0), 1 - this.target.energy / params.cellEnergyMax);\r\n    }\r\n\r\n    mat.color = this.lerpColorTemperature(mat.color);\r\n    mat.color = new Color(0).lerp(mat.color, map(lightAmount, 0, 1, 0.2, 1));\r\n  }\r\n\r\n  respondToEvents() {\r\n    // audio\r\n    if (this.target instanceof Leaf && this.audio != null) {\r\n      const newAudioValueTracker = this.target.totalSugarProduced;\r\n      if (newAudioValueTracker > this.lastAudioValueTracker) {\r\n        this.audio.setBuffer(blopBuffer);\r\n        const dist = this.target.pos.distanceToSquared(this.mito.world.player.pos);\r\n        const volume = Math.min(1, 1 / (1 + dist / 25)) * this.target.sugarConverted * this.target.sugarConverted;\r\n        this.audio.setVolume(volume);\r\n        // this.audio.setRefDistance(2);\r\n        // play blop sound\r\n        this.audio.play();\r\n        this.animation.set(this.growPulseAnimation(), Ticker.now / 1000);\r\n      }\r\n      this.lastAudioValueTracker = newAudioValueTracker;\r\n    }\r\n    if (this.target instanceof Root && this.audio != null) {\r\n      const newAudioValueTracker = this.target.totalSucked;\r\n      if (newAudioValueTracker !== this.lastAudioValueTracker) {\r\n        this.audio.setBuffer(suckWaterBuffer);\r\n        // const baseVolume = this.target.waterTransferAmount / (2 + this.target.waterTransferAmount);\r\n        const baseVolume = 1;\r\n        const dist = this.target.pos.distanceToSquared(this.mito.world.player.pos);\r\n        const volume = Math.min(1, 1 / (1 + dist / 25)) * baseVolume;\r\n        this.audio.setVolume(volume);\r\n        if (this.audio.source != null) {\r\n          this.audio.stop();\r\n        }\r\n        this.audio.play();\r\n        this.animation.set(this.growPulseAnimation(), Ticker.now / 1000);\r\n      }\r\n      this.lastAudioValueTracker = newAudioValueTracker;\r\n    }\r\n    this.mesh.remove(this.pairsLines);\r\n  }\r\n\r\n  private temperatureColor: Color = TileRenderer.TEMPERATURE_COLORS[Temperature.Mild];\r\n  private currentLerp = 0;\r\n  lerpColorTemperature(color: Color) {\r\n    const { temperature } = this.target;\r\n    let tColor = TileRenderer.TEMPERATURE_COLORS[temperature];\r\n    if (tColor !== this.temperatureColor) {\r\n      this.currentLerp = 0;\r\n    }\r\n    const targetLerp = temperature === Temperature.Mild ? 0 : 0.5;\r\n    this.temperatureColor = tColor;\r\n    this.currentLerp = lerp(this.currentLerp, targetLerp, 0.1);\r\n    color.lerp(this.temperatureColor, this.currentLerp);\r\n    return color;\r\n  }\r\n\r\n  updateHover() {\r\n    this.mesh.add(this.pairsLines);\r\n    if (hasTilePairs(this.target)) {\r\n      const pairColor = this.target instanceof Leaf ? 0xffc90e : new Color(\"rgb(9, 12, 255)\").getHex();\r\n      const pairs = this.target.tilePairs;\r\n      if (pairs.length !== this.pairsLines.children.length) {\r\n        // redo pairs\r\n        this.pairsLines.remove(...this.pairsLines.children);\r\n        pairs.forEach((dir) => {\r\n          const length = dir.length() * 2 - 0.25;\r\n          const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\r\n          const arrowHelper = this.makeLine(arrowDir, arrowDir.clone().multiplyScalar(-length / 2), length, pairColor);\r\n          this.pairsLines.add(arrowHelper);\r\n        });\r\n      }\r\n    }\r\n    if (this.hasActiveNeighbors(this.target)) {\r\n      const color = this.target instanceof Root ? new Color(\"rgb(9, 12, 255)\").getHex() : 0xffffff;\r\n      const lines = this.target.activeNeighbors;\r\n      if (lines.length !== this.pairsLines.children.length) {\r\n        // redo pairs\r\n        this.pairsLines.remove(...this.pairsLines.children);\r\n        lines.forEach((dir) => {\r\n          const length = dir.length() - 0.25;\r\n          const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\r\n          const arrowHelper =\r\n            this.target instanceof Root\r\n              ? this.makeLine(arrowDir, new Vector3(), length, color)\r\n              : new ArrowHelper(arrowDir, new Vector3(0, 0, 5), length, color);\r\n          this.pairsLines.add(arrowHelper);\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  growPulseAnimation(): Animation {\r\n    const duration = 0.5;\r\n    const ease = reversed(easeCubic);\r\n    return (dt) => {\r\n      const t = clamp(dt / duration * ((this.target as any).tempo || 1), 0, 1);\r\n      const scale = map(ease(t), 0, 1, 1, 1.3);\r\n      this.mesh.scale.setScalar(scale);\r\n      return t >= 1;\r\n    };\r\n  }\r\n\r\n  hasActiveNeighbors(\r\n    t: any\r\n  ): t is {\r\n    activeNeighbors: Vector2[];\r\n  } {\r\n    return Array.isArray(t.activeNeighbors);\r\n  }\r\n\r\n  static lineGeometry = (() => {\r\n    const g = new BufferGeometry();\r\n    g.addAttribute(\"position\", new Float32BufferAttribute([0, 0, 0, 0, 1, 0], 3));\r\n    return g;\r\n  })();\r\n  private makeLine(dir: Vector3, origin: Vector3, length: number, color: number) {\r\n    // copied from https://github.com/mrdoob/js/blob/master/src/helpers/ArrowHelper.js\r\n    const line = new Line(TileRenderer.lineGeometry, new LineBasicMaterial({ color: color }));\r\n    line.position.copy(origin);\r\n    // dir is assumed to be normalized\r\n    if (dir.y > 0.99999) {\r\n      line.quaternion.set(0, 0, 0, 1);\r\n    } else if (dir.y < -0.99999) {\r\n      line.quaternion.set(1, 0, 0, 0);\r\n    } else {\r\n      const axis = new Vector3(dir.z, 0, -dir.x).normalize();\r\n      const radians = Math.acos(dir.y);\r\n      line.quaternion.setFromAxisAngle(axis, radians);\r\n    }\r\n    line.scale.set(1, Math.max(0, length), 1);\r\n    line.position.z = 0.1;\r\n    line.updateMatrix();\r\n    line.matrixAutoUpdate = false;\r\n    return line;\r\n  }\r\n  destroy() {\r\n    this.scene.remove(this.mesh);\r\n    if (this.worldDomElement != null) {\r\n      this.mito.removeWorldDOMElement(this.worldDomElement);\r\n    }\r\n    if (this.inventoryRenderer != null) {\r\n      this.inventoryRenderer.destroy();\r\n    }\r\n    if (this.cellEffectsRenderer != null) {\r\n      this.cellEffectsRenderer.destroy();\r\n    }\r\n  }\r\n}\r\n\r\nexport const materialMapping = lazy(() => {\r\n  const materials = new Map<Constructor<Tile>, MeshBasicMaterial>();\r\n  materials.set(\r\n    Air,\r\n    new MeshBasicMaterial({\r\n      side: DoubleSide,\r\n      depthWrite: false,\r\n    })\r\n  );\r\n  materials.set(\r\n    Soil,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(8, 11),\r\n      // map: textureFromSpritesheet(41, 26),\r\n      // map: textureFromSpritesheet(679 / 16, 438 / 16),\r\n      side: DoubleSide,\r\n      // color: new Color(0xcccccc),\r\n      color: new Color(\"rgb(112, 89, 44)\"),\r\n      depthWrite: false,\r\n    })\r\n  );\r\n  materials.set(\r\n    Fountain,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(56 / 16, 38 / 16),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n  materials.set(\r\n    Rock,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(26, 20),\r\n      side: DoubleSide,\r\n      color: new Color(\"rgb(63, 77, 84)\"),\r\n    })\r\n  );\r\n  materials.set(\r\n    DeadCell,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(137 / 16, 374 / 16),\r\n      side: DoubleSide,\r\n      color: new Color(\"rgb(128, 128, 128)\"),\r\n    })\r\n  );\r\n  materials.set(\r\n    Tissue,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(6, 31),\r\n      side: DoubleSide,\r\n      color: new Color(0x30ae25),\r\n    })\r\n  );\r\n  materials.set(Transport, materials.get(Tissue)!);\r\n  // materialMapping.set(Transport, new MeshBasicMaterial({\r\n  //     map: arrowUpMaterial(),\r\n  //     side: DoubleSide,\r\n  //     color: new Color(\"rgb(42, 138, 25)\"),\r\n  // }));\r\n  materials.set(\r\n    Leaf,\r\n    new MeshBasicMaterial({\r\n      // map: textureFromSpritesheet(9, 31),\r\n      map: textureFromSpritesheet(55 / 16, 280 / 16),\r\n      // map: textureFromSpritesheet(16, 10),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n  materials.set(\r\n    Root,\r\n    new MeshBasicMaterial({\r\n      // map: textureFromSpritesheet(0, 31),\r\n      map: textureFromSpritesheet(59 / 16, 327 / 16),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n  materials.set(\r\n    Fruit,\r\n    new MeshBasicMaterial({\r\n      map: fruitTexture,\r\n      side: DoubleSide,\r\n      transparent: true,\r\n    })\r\n  );\r\n  materials.set(\r\n    Vein,\r\n    new MeshBasicMaterial({\r\n      map: textureFromSpritesheet(Math.floor(184 / 16), Math.floor(152 / 16)),\r\n      side: DoubleSide,\r\n    })\r\n  );\r\n\r\n  return materials;\r\n});\r\n\r\nfunction getMaterial(tile: Tile) {\r\n  // careful - creates a new instance per tile\r\n  return materialMapping()\r\n    .get(tile.constructor as Constructor<Tile>)!\r\n    .clone();\r\n}\r\n\r\n// const AIR_COLORSCALE = [\r\n//     new Color(\"rgb(91, 117, 154)\"),\r\n//     new Color(\"rgb(158, 179, 196)\"),\r\n//     new Color(\"hsv(35, 7%, 99%)\"),\r\n// ];\r\n// const AIR_COLORSCALE = [\r\n//     new Color(\"hsl(14, 81%, 52%)\"),\r\n//     new Color(\"hsl(34, 61%, 72%)\"),\r\n//     new Color(\"hsl(61, 54%, 87%)\"),\r\n//     new Color(\"hsl(67, 35%, 99%)\"),\r\n//     new Color(\"hsl(213, 63%, 52%)\"),\r\n//     // new Color(\"hsl(37, 35%, 99%)\"),\r\n// ];\r\n// const AIR_COLORSCALE = [\r\n//     new Color(\"hsl(34, 61%, 56%)\"),\r\n//     new Color(\"hsl(67, 31%, 55%)\"),\r\n//     new Color(\"hsl(213, 63%, 58%)\"),\r\n//     // new Color(\"hsl(37, 35%, 99%)\"),\r\n// ];\r\nconst AIR_COLORSCALE = [\r\n  // new Color(\"hsl(67, 31%, 55%)\"),\r\n  new Color(\"hsl(67, 31%, 25%)\"),\r\n  new Color(\"hsl(180, 31%, 76%)\"),\r\n  new Color(\"hsl(213, 63%, 58%)\"),\r\n];\r\n// const AIR_COLORSCALE = [\r\n//     new Color(\"rgb(146, 215, 255)\"),\r\n//     new Color(\"rgb(53, 125, 210)\"),\r\n//     new Color(\"rgb(56, 117, 154)\"),\r\n// ];\r\n","export function mirrored(f: (t: number) => number) {\r\n  // https://bl.ocks.org/mbostock/3145795\r\n  return (t: number) => t < .5 ? f(2 * t) : f(2 - 2 * t);\r\n}\r\n\r\nexport function reversed(f: (t: number) => number) {\r\n  return (t: number) => f(1 - t);\r\n}\r\n","import { ArrowHelper, Object3D, Scene, Vector2, Vector3 } from \"three\";\r\n\r\nimport Mito from \"..\";\r\nimport { Transport } from \"../game/tile\";\r\nimport { TileRenderer } from \"./TileRenderer\";\r\n\r\nexport class TransportRenderer extends TileRenderer<Transport> {\r\n  private arrow?: Object3D;\r\n  constructor(target: Transport, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    this.arrow = this.makeArrow(this.target.dir);\r\n    this.mesh.add(this.arrow);\r\n  }\r\n\r\n  // update() {\r\n  //     super.update();\r\n  //     const from = this.target.getFrom();\r\n  //     if (from == null && this.fromArrow != null) {\r\n  //         this.mesh.remove(this.fromArrow);\r\n  //         this.fromArrow = undefined;\r\n  //     }\r\n  //     if (from != null && this.fromArrow == null) {\r\n  //         this.fromArrow = this.makeArrow(this.target.dir, this.target.dir.clone().multiplyScalar(-1));\r\n  //         this.mesh.add(this.fromArrow);\r\n  //     }\r\n\r\n  //     const to = this.target.getTarget();\r\n  //     if (to == null && this.toArrow != null) {\r\n  //         this.mesh.remove(this.toArrow);\r\n  //         this.toArrow = undefined;\r\n  //     }\r\n  //     if (to != null && this.toArrow == null) {\r\n  //         this.toArrow = this.makeArrow(this.target.dir, this.target.dir.clone().multiplyScalar(0));\r\n  //         this.mesh.add(this.toArrow);\r\n  //     }\r\n  // }\r\n\r\n  private makeArrow(dir: Vector2) {\r\n    const length = dir.length() - 0.25;\r\n    const arrowDir = new Vector3(dir.x, dir.y, 0).normalize();\r\n    const pos = arrowDir.clone().multiplyScalar(-length / 2);\r\n    return new ArrowHelper(arrowDir, new Vector3(pos.x, pos.y, 1), length, 0xffffff, 0.1, 0.1);\r\n  }\r\n}\r\n","import { createSelector } from \"reselect\";\r\nimport { Scene } from \"three\";\r\nimport Mito from \"..\";\r\nimport { Entity, Player, StepStats, World } from \"../game\";\r\nimport { Tile, Transport } from \"../game/tile\";\r\nimport { InventoryRenderer } from \"./InventoryRenderer\";\r\nimport { PlayerRenderer } from \"./PlayerRenderer\";\r\nimport { Renderer } from \"./Renderer\";\r\nimport { TileRenderer } from \"./TileRenderer\";\r\nimport { TransportRenderer } from \"./TransportRenderer\";\r\n\r\n\r\nexport function createRendererFor<E extends Entity>(object: E, scene: Scene, mito: Mito): Renderer<Entity> {\r\n  if (object instanceof Player) {\r\n    return new PlayerRenderer(object, scene, mito);\r\n  } else if (object instanceof Transport) {\r\n    return new TransportRenderer(object, scene, mito);\r\n  } else if (object instanceof Tile) {\r\n    return new TileRenderer(object, scene, mito);\r\n  } else {\r\n    throw new Error(`Couldn't find renderer for ${object}`);\r\n  }\r\n}\r\n\r\nexport class WorldRenderer extends Renderer<World> {\r\n  public renderers = new Map<Entity, Renderer<Entity>>();\r\n  constructor(target: World, scene: Scene, mito: Mito) {\r\n    super(target, scene, mito);\r\n    scene.add(InventoryRenderer.WaterParticles());\r\n    scene.add(InventoryRenderer.SugarParticles());\r\n  }\r\n\r\n  public getOrCreateRenderer(entity: Entity) {\r\n    const renderer = this.renderers.get(entity);\r\n    if (renderer == null) {\r\n      const created = createRendererFor(entity, this.scene, this.mito);\r\n      this.renderers.set(entity, created);\r\n      return created;\r\n    } else {\r\n      return renderer;\r\n    }\r\n  }\r\n\r\n  private deleteDeadEntityRenderers = createSelector(\r\n    (stats: StepStats) => stats,\r\n    (stats) => {\r\n      const deletedEntities = stats.deleted;\r\n\r\n      for (const e of deletedEntities) {\r\n        const renderer = this.renderers.get(e);\r\n        if (renderer == null) {\r\n          throw new Error(`Couldn't find renderer for ${e}!`);\r\n        }\r\n        renderer.destroy();\r\n        this.renderers.delete(e);\r\n      }\r\n    }\r\n  );\r\n\r\n  update(): void {\r\n    this.deleteDeadEntityRenderers(this.target.getLastStepStats());\r\n\r\n    InventoryRenderer.startFrame();\r\n    this.target.entities().forEach((entity) => {\r\n      const renderer = this.getOrCreateRenderer(entity);\r\n      renderer.update();\r\n    });\r\n    InventoryRenderer.endFrame();\r\n  }\r\n  destroy(): void {\r\n    throw new Error(\"Method not implemented.\");\r\n  }\r\n}\r\n","import { map } from \"math\";\r\nimport Mito from \"sketches/mito\";\r\nimport { TIME_PER_SEASON } from \"sketches/mito/game\";\r\nimport { GrowingCell, Tile } from \"sketches/mito/game/tile\";\r\nimport { createRendererFor } from \"sketches/mito/renderers/WorldRenderer\";\r\nimport { OrthographicCamera, Scene, Vector2, WebGLRenderTarget } from \"three\";\r\n\r\n/**\r\n * A Vignette is a visual snapshot of a plant at a specific stage of growth. It's actually\r\n * just an image.\r\n *\r\n * You can control:\r\n *   How big the vignette is.\r\n */\r\nclass VignetteCapturer {\r\n  static renderTarget = new WebGLRenderTarget(1024, 1024);\r\n  static rtBuffer = new Uint8Array(VignetteCapturer.renderTarget.width * VignetteCapturer.renderTarget.height * 4);\r\n  static rtCanvas = (() => {\r\n    const c = document.createElement(\"canvas\");\r\n    c.width = VignetteCapturer.renderTarget.width;\r\n    c.height = VignetteCapturer.renderTarget.height;\r\n    return c;\r\n  })();\r\n  private lastCaptureTime: number = 0;\r\n\r\n  public constructor(public readonly mito: Mito, public pxPerTile = 4, public captureInterval = TIME_PER_SEASON / 27) {\r\n  }\r\n\r\n  isTimeForNewCapture() {\r\n    return this.mito.world.time - this.lastCaptureTime > this.captureInterval;\r\n  }\r\n\r\n  capture() {\r\n    const { renderTarget, rtBuffer, rtCanvas } = VignetteCapturer;\r\n    this.lastCaptureTime = this.mito.world.time;\r\n\r\n    // Cells that form the vignette:\r\n    const picturesqueCells = Array.from(this.mito.world.cells())\r\n      .filter((t) => t.pos.y < 50 && !(t instanceof GrowingCell));\r\n\r\n    const [minBounds, maxBounds] = this.getBounds(picturesqueCells);\r\n\r\n    // add all renderers to a scene\r\n    const scene = new Scene();\r\n    const tileRenderers = picturesqueCells.map((c) => {\r\n      const renderer = createRendererFor(c, scene, this.mito);\r\n      renderer.update();\r\n      return renderer;\r\n    });\r\n\r\n    // webgl render to a renderTarget\r\n    const camera = this.cameraEncompassingBounds([minBounds, maxBounds]);\r\n    const { renderer } = this.mito;\r\n    renderer.setRenderTarget(renderTarget);\r\n    renderer.clear(true, true, true);\r\n    renderer.render(scene, camera);\r\n    renderer.setRenderTarget(null);\r\n\r\n    // buffer will now contain [r1, g1, b1, a1, r2, g2, b2, a2, ...]\r\n    renderer.readRenderTargetPixels(\r\n      renderTarget,\r\n      0,\r\n      0,\r\n      renderTarget.width,\r\n      renderTarget.height,\r\n      rtBuffer\r\n    );\r\n\r\n    // copy buffer pixels into the full resolution canvas\r\n    const context = rtCanvas.getContext('2d')!;\r\n    const imageData: ImageData = context.createImageData(rtCanvas.width, rtCanvas.height);\r\n    const imageBuffer = imageData.data;\r\n    for (let i = 0; i < rtBuffer.length; i++) {\r\n      imageBuffer[i] = rtBuffer[i];\r\n    }\r\n    context.putImageData(imageData, 0, 0);\r\n\r\n    const boundsWidth = maxBounds.x - minBounds.x;\r\n    const boundsHeight = maxBounds.y - minBounds.y;\r\n    const maxDimension = Math.max(boundsWidth, boundsHeight);\r\n\r\n    const roiWidth = map(boundsWidth, 0, maxDimension, 0, 1024);\r\n    const roiHeight = map(boundsHeight, 0, maxDimension, 0, 1024);\r\n    const roiTopLeft = new Vector2(\r\n      512 - roiWidth / 2,\r\n      512 - roiHeight / 2\r\n    );\r\n\r\n    const dest = document.createElement(\"canvas\");\r\n    dest.width = Math.ceil(boundsWidth * this.pxPerTile);\r\n    dest.height = Math.ceil(boundsHeight * this.pxPerTile);\r\n    const destContext = dest.getContext('2d')!;\r\n    destContext.drawImage(\r\n      rtCanvas,\r\n      roiTopLeft.x,\r\n      roiTopLeft.y,\r\n      roiWidth,\r\n      roiHeight,\r\n      0,\r\n      0,\r\n      dest.width,\r\n      dest.height\r\n    );\r\n\r\n    const img = new Image();\r\n    img.src = dest.toDataURL();\r\n    document.body.appendChild(img);\r\n\r\n    tileRenderers.forEach((t) => {\r\n      t.destroy();\r\n    });\r\n    return dest;\r\n  }\r\n\r\n  getBounds(tiles: Tile[]): [Vector2, Vector2] {\r\n    const min = new Vector2();\r\n    const max = new Vector2();\r\n    if (tiles[0] != null) {\r\n      min.copy(tiles[0].pos);\r\n      max.copy(tiles[0].pos);\r\n    }\r\n    for (const t of tiles) {\r\n      min.min(t.pos);\r\n      max.max(t.pos);\r\n    }\r\n    // .pos is the center; pad to the edges of each tile\r\n    min.subScalar(0.5);\r\n    max.addScalar(0.5);\r\n    return [min, max];\r\n  }\r\n\r\n  private cameraEncompassingBounds([min, max]: [Vector2, Vector2]) {\r\n    const center = min.clone().lerp(max, 0.5);\r\n\r\n    const width = max.x - min.x;\r\n    const height = max.y - min.y;\r\n\r\n    // now that we know the bounding box, we want the camera to fit that bounding\r\n    // box perfectly while maintaining the aspect ratio of the renderTarget.\r\n    const largerDim = Math.max(width, height);\r\n    const camera = new OrthographicCamera(\r\n      center.x - largerDim / 2,\r\n      center.x + largerDim / 2,\r\n      center.y + largerDim / 2,\r\n      center.y - largerDim / 2,\r\n      -100,\r\n      100);\r\n    return camera;\r\n  }\r\n}\r\n\r\nexport default VignetteCapturer;\r\n","import { Action, ActionMove } from \"./action\";\r\nimport { DIRECTIONS } from \"./directions\";\r\n\r\nexport const ACTION_KEYMAP: { [key: string]: Action } = {\r\n  KeyQ: {\r\n    type: \"drop\",\r\n    sugar: 0,\r\n    water: 1, // hack hack we can assume max 100 water, it's fine\r\n  },\r\n  KeyE: {\r\n    type: \"drop\",\r\n    sugar: 1,\r\n    water: 0, // hack hack we can assume max 100 water, it's fine\r\n  },\r\n  Space: {\r\n    type: \"pickup\",\r\n    sugar: 1,\r\n    water: 1,\r\n  },\r\n};\r\n\r\nexport const MOVEMENT_KEYS: { [key: string]: ActionMove } = {\r\n  KeyW: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.n,\r\n  },\r\n  KeyA: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.w,\r\n  },\r\n  KeyS: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.s,\r\n  },\r\n  KeyD: {\r\n    type: \"move\",\r\n    dir: DIRECTIONS.e,\r\n  },\r\n};\r\n\r\nexport const CELL_BAR_KEYS: Record<string, number> = {\r\n  Digit1: 0,\r\n  Digit2: 1,\r\n  Digit3: 2,\r\n  Digit4: 3,\r\n  Digit5: 4,\r\n};\r\n\r\nexport const MOVEMENTS = Object.keys(MOVEMENT_KEYS).map((key) => MOVEMENT_KEYS[key]);\r\n","import * as React from \"react\";\r\n\r\nimport { params } from \"../params\";\r\n\r\ninterface InstructionsProps {\r\n  play: () => void;\r\n}\r\nexport class Instructions extends React.PureComponent<InstructionsProps, {}> {\r\n  render() {\r\n    return (\r\n      <div className=\"mito-instructions\">\r\n        <div className=\"mito-instructions-container\">\r\n          <div className=\"esc\" onClick={() => this.props.play()}>\r\n            Back (Esc)\r\n          </div>\r\n          <h1>Mito</h1>\r\n          <div className=\"play-button\" onClick={() => this.props.play()}>\r\n            Play\r\n          </div>\r\n          <p>\r\n            <ol>\r\n              <li>Build Tissue to expand your reach (press t and walk into empty space).</li>\r\n              <li>Build Roots (press r) underground to suck up adjacent water.</li>\r\n              <li>Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar.</li>\r\n              <li>\r\n                <b>Win the game by building and loading the Fruit with 1000 sugar.</b>\r\n              </li>\r\n              <li>Click around to see the different properties of each tile.</li>\r\n              <li>Build leaves early.</li>\r\n              <li>Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air.</li>\r\n              <li>Explore underground for water reservoires and Fountains.</li>\r\n              <li>Build transports (capital T) to carry water back up the plant.</li>\r\n              <li>You can scroll out infinitely far.</li>\r\n            </ol>\r\n          </p>\r\n          <h3>You</h3>\r\n          <p>\r\n            You can carry max {params.maxResources} resources, and you automatically suck in any resources you're\r\n            standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil\r\n            below and air above.\r\n          </p>\r\n          <h3>Soil and Underground</h3>\r\n          <p>\r\n            Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a\r\n            permanent source of water. Soil holds up to {params.soilMaxWater} water at a time. Fountains emit one water\r\n            per {params.fountainTurnsPerWater} turns.\r\n          </p>\r\n          <h3>Air and Aboveground</h3>\r\n          <p>\r\n            Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which\r\n            reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you\r\n            build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make\r\n            sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun,\r\n            which gently sways left to right.\r\n          </p>\r\n          <h3>Water</h3>\r\n          <p>\r\n            Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2\r\n            required) at about 1 unit per {(1 / params.soilDiffusionWater).toFixed(0)} turns. Obtain water in the ground\r\n            through Roots. Leaves require water to photosynthesize. You require water to build.\r\n          </p>\r\n          <h3>Sugar</h3>\r\n          <p>\r\n            Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by\r\n            putting water next to leaves. Cells require sugar to survive. You require sugar to build.\r\n          </p>\r\n          <h3>Building</h3>\r\n          <p>\r\n            Build Tissue, Leaves, Roots, and The Fruit by toggling \"build mode\" on and walking into Air or Soil. Build\r\n            Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue\r\n            over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they're not properly\r\n            supported underneath them.\r\n          </p>\r\n          <h3>Cells</h3>\r\n          <p>\r\n            All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their\r\n            neighbors. Each cell consumes 1 sugar every {params.cellEnergyMax} turns.\r\n          </p>\r\n          <h3>Tissue</h3>\r\n          <p>\r\n            Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to{\" \"}\r\n            {params.tissueInventoryCapacity} resources.\r\n          </p>\r\n          <h3>Roots</h3>\r\n          <p>\r\n            Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the\r\n            Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is\r\n            called a Pairing.\r\n          </p>\r\n          <h3>Leaves</h3>\r\n          <p>\r\n            When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction\r\n            Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per{\" \"}\r\n            {(1 / params.leafReactionRate).toFixed(0)} turns per pair. Leaf efficiency is heavily influenced by co2 and\r\n            sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize.\r\n            Leaves higher up produce sugar faster.\r\n          </p>\r\n          <h3>Transport</h3>\r\n          <p>\r\n            Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you.\r\n            Transport hungers at double speed.\r\n          </p>\r\n          <h3>The Fruit</h3>\r\n          <p>\r\n            You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to\r\n            1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity.\r\n          </p>\r\n          {this.renderCredit()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  renderCredit() {\r\n    return (\r\n      <>\r\n        <h2>Attribution</h2>\r\n        <p>\r\n          Tiles:{\" \"}\r\n          <a href=\"http://kenney.nl/assets?s=roguelike\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n            Kenney.nl Roguelike Assets\r\n          </a>\r\n        </p>\r\n        <p>\r\n          Pop sound when leaves convert:{\" \"}\r\n          <a href=\"http://soundbible.com/2067-Blop.html\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n            Blop by Mark DiAngelo\r\n          </a>{\" \"}\r\n          (<a href=\"https://creativecommons.org/licenses/by/3.0/us/\">CC BY 3.0 US</a>)\r\n        </p>\r\n        <p>\r\n          Perlin noise:{\" \"}\r\n          <a href=\"https://github.com/josephg/noisejs\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n            josephg/noisejs\r\n          </a>\r\n        </p>\r\n        <p>\r\n          Part of 7drl 2018:{\" \"}\r\n          <a href=\"http://7drl.org/\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n            http://7drl.org/\r\n          </a>\r\n        </p>\r\n        <p>\r\n          Fruit icon:{\" \"}\r\n          <a href=\"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm\">Designed by Freepik</a>\r\n        </p>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport Mito from \"../index\";\r\nimport { Instructions } from \"./Instructions\";\r\n\r\nexport interface GameStackProps {\r\n  mito: Mito;\r\n}\r\nexport class GameStack extends React.PureComponent<GameStackProps> {\r\n  handlePlay = () => {\r\n    this.props.mito.instructionsOpen = false;\r\n  };\r\n  public render() {\r\n    if (this.props.mito.instructionsOpen) {\r\n      return <Instructions play={this.handlePlay} />;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","/* eslint-disable jsx-a11y/accessible-emoji */\r\nimport * as React from \"react\";\r\nimport { Constructor } from \"../constructor\";\r\nimport { Temperature } from \"../game/temperature\";\r\nimport { Air, Cell, CellEffect, Fountain, FreezeEffect, GrowingCell, hasEnergy, Leaf, Root, Tile } from \"../game/tile\";\r\nimport { hasInventory } from \"../inventory\";\r\nimport { params } from \"../params\";\r\nimport \"./TileDetails.scss\";\r\n\r\n\r\ninterface TileDetailsProps {\r\n  tile?: Tile;\r\n}\r\n\r\nexport class TileDetails extends React.Component<TileDetailsProps> {\r\n  public render() {\r\n    const { tile } = this.props;\r\n    if (!tile) {\r\n      return null;\r\n    }\r\n    return (\r\n      <div className=\"tile-hover\">\r\n        {this.tileInfo(tile)}\r\n        {this.inventoryInfo(tile)}\r\n        {this.cellInfo(tile)}\r\n        {this.growingCellInfo(tile)}\r\n        {this.rootInfo(tile)}\r\n        {this.leafInfo(tile)}\r\n        {this.airInfo(tile)}\r\n        {this.fountainInfo(tile)}\r\n      </div>\r\n    );\r\n  }\r\n  private rootInfo(tile: Tile) {\r\n    return tile instanceof Root ? (\r\n      <div className=\"info-root\">\r\n        <div>{tile.totalSucked} water collected.</div>\r\n        <div>{tile.cooldown.toFixed(0)} turns until next water suck.</div>\r\n        {/* <div>{tile.waterTransferAmount.toFixed(0)} water transfer per round.</div> */}\r\n      </div>\r\n    ) : null;\r\n  }\r\n  private leafInfo(tile: Tile) {\r\n    return tile instanceof Leaf ? (\r\n      <div className=\"info-leaf\">\r\n        <div>{tile.totalSugarProduced} sugar produced.</div>\r\n        <div>{(1 / (tile.averageSpeed * params.leafReactionRate)).toFixed(0)} turns per reaction.</div>\r\n        <div>{(1 / tile.averageEfficiency).toFixed(2)} water per sugar.</div>\r\n      </div>\r\n    ) : null;\r\n  }\r\n  private airInfo(tile: Tile) {\r\n    if (tile instanceof Air) {\r\n      return (\r\n        <div className=\"info-air\">\r\n          <div>☀️ {(tile.sunlight() * 100).toFixed(0)}%</div>\r\n          <div>☁️ {(tile.co2() * 100).toFixed(0)}%</div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private fountainInfo(tile: Tile) {\r\n    if (tile instanceof Fountain) {\r\n      return (\r\n        <div className=\"info-fountain\">\r\n          <div>{tile.turnsPerWater} turns per water</div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  private tileInfo(tile: Tile) {\r\n    const energyInfo = hasEnergy(tile) ? (\r\n      <span className=\"info-energy\">💚{((tile.energy / params.cellEnergyMax) * 100).toFixed(0)}%</span>\r\n    ) : null;\r\n    return (\r\n      <div className=\"info-tile\">\r\n        <div className=\"info-tile-name\">{(tile.constructor as Constructor<Tile>).displayName}</div>\r\n        {this.temperatureInfo(tile)}\r\n        {energyInfo}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private temperatureInfo(tile: Tile) {\r\n    function Bar({ color = \"black\", left = 0 as number | string, width = 3 }) {\r\n      return (\r\n        <div style={{\r\n          position: \"absolute\",\r\n          top: -1,\r\n          left,\r\n          width: 1,\r\n          bottom: 0,\r\n          borderRight: `${width}px solid ${color}`\r\n        }} />\r\n      );\r\n    }\r\n    function Text({ children, fontWeight = \"normal\", left }: { children: React.ReactNode, fontWeight: React.CSSProperties[\"fontWeight\"], left: number | string }) {\r\n      return (\r\n        <div style={{\r\n          position: \"absolute\",\r\n          left,\r\n          width: `${(32 / 100) * 100}%`,\r\n          textAlign: \"center\",\r\n          fontSize: 12,\r\n          fontWeight: fontWeight,\r\n          fontFamily: \"Arial\",\r\n        }}>{children}</div>\r\n      );\r\n    }\r\n    return (\r\n      <div className=\"info-tile-temperature\">\r\n        {/* {tile.temperature} ({tile.temperatureFloat.toFixed(0)} °F) */}\r\n        <div style={{ width: 200, height: \"1.15em\", border: \"1px solid grey\", position: \"relative\" }}>\r\n          <Bar left={`${32 / 100 * 100}%`} color=\"lightblue\" />\r\n          <Text left={0} fontWeight={tile.temperature === Temperature.Cold ? \"bold\" : \"normal\"}>{Temperature.Cold}</Text>\r\n          <Bar left={`${64 / 100 * 100}%`} color=\"orange\" />\r\n          <Text left={`${32 / 100 * 100}%`} fontWeight={tile.temperature === Temperature.Mild ? \"bold\" : \"normal\"}>{Temperature.Mild}</Text>\r\n          <Text left={`${64 / 100 * 100}%`} fontWeight={tile.temperature === Temperature.Hot ? \"bold\" : \"normal\"}>{Temperature.Hot}</Text>\r\n          <Bar left={`${tile.temperatureFloat / 100 * 100}%`} color=\"black\" width={3}></Bar>\r\n          <div style={{\r\n            position: \"absolute\",\r\n            left: `${tile.temperatureFloat / 100 * 100}%`,\r\n            transform: \"translateX(-50%)\",\r\n            top: \"-1.5em\",\r\n            textAlign: \"center\",\r\n            fontSize: 12,\r\n            fontWeight: \"bold\",\r\n            fontFamily: \"Arial\",\r\n          }}>{tile.temperatureFloat.toFixed(0)} °F</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private inventoryInfo(tile: Tile) {\r\n    if (hasInventory(tile)) {\r\n      const waterInfo =\r\n        tile.inventory.water > 0 ? (\r\n          <div className=\"info-inventory-item\">💧 {tile.inventory.water.toFixed(2)}</div>\r\n        ) : null;\r\n      const sugarInfo =\r\n        tile.inventory.sugar > 0 ? (\r\n          <div className=\"info-inventory-item\">Sugar {tile.inventory.sugar.toFixed(2)}</div>\r\n        ) : null;\r\n      return (\r\n        <div className=\"info-inventory\">\r\n          {waterInfo}\r\n          {sugarInfo}\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n  private cellInfo(tile: Tile) {\r\n    if (tile instanceof Cell) {\r\n      return (\r\n        <>\r\n          {tile.droopY * 200 > 1 ? <div className=\"info-cell\">{(tile.droopY * 200).toFixed(0)}% droop</div> : null}\r\n          {this.cellEffects(tile)}\r\n        </>\r\n      );\r\n    }\r\n  }\r\n\r\n  private cellEffects(cell: Cell) {\r\n    const { effects } = cell;\r\n    if (effects.length > 0) {\r\n      const descriptors = effects.map((e) => {\r\n        const name = (e.constructor as Constructor<CellEffect>).displayName;\r\n        if (e instanceof FreezeEffect) {\r\n          return `${(e.percentFrozen * 100).toFixed(0)}% ${name}`;\r\n        } else {\r\n          return name\r\n        }\r\n      }).join(', ');\r\n      return (\r\n        <div className=\"info-cell\">\r\n          {descriptors}\r\n        </div>\r\n      );\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private growingCellInfo(tile: Tile) {\r\n    if (tile instanceof GrowingCell) {\r\n      return (\r\n        <div className=\"info-growing-cell\">\r\n          {(100 - (tile.timeRemaining / tile.timeToBuild) * 100).toFixed(0)}% mature\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { Constructor } from \"../constructor\";\r\nimport { Cell } from \"../game/tile\";\r\nimport { materialMapping } from \"../renderers/TileRenderer\";\r\n\r\nimport \"./CellBar.scss\";\r\nimport classNames from \"classnames\";\r\nimport { spritesheetLoaded } from \"../spritesheet\";\r\n\r\nexport interface CellBarProps {\r\n  bar: Constructor<Cell>[];\r\n  index: number;\r\n  onIndexClicked: (index: number) => void;\r\n}\r\n\r\nfunction CellBar({ bar, index, onIndexClicked }: CellBarProps) {\r\n  return (\r\n    <div className=\"cell-bar\">\r\n      {bar.map((cellType, i) => (\r\n        <CellBarItem\r\n          key={i}\r\n          hotkey={String(i + 1)}\r\n          type={cellType}\r\n          isSelected={index === i}\r\n          onClick={() => onIndexClicked(i)}\r\n          spritesheetLoaded={spritesheetLoaded}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport interface CellBarItemProps {\r\n  children?: React.ReactNode;\r\n  type: Constructor<Cell>;\r\n  isSelected: boolean;\r\n  onClick: () => void;\r\n  spritesheetLoaded: boolean;\r\n  hotkey: string;\r\n}\r\n\r\nfunction CellBarItem({ type, hotkey, isSelected, onClick, spritesheetLoaded }: CellBarItemProps) {\r\n  const style: React.CSSProperties = React.useMemo(() => {\r\n    const material = materialMapping().get(type)!;\r\n    const image = material.map!.image;\r\n    const color = material.color.getStyle();\r\n    const url = (() => {\r\n      if (image != null) {\r\n        if (image instanceof HTMLCanvasElement && spritesheetLoaded) {\r\n          return image.toDataURL();\r\n        } else if (image instanceof Image) {\r\n          return image.src;\r\n        } else {\r\n          return \"\";\r\n        }\r\n      } else {\r\n        return \"\";\r\n      }\r\n    })();\r\n    const backgroundImage = `url(${url}), linear-gradient(${color}, ${color})`;\r\n    return {\r\n      backgroundImage,\r\n    };\r\n  }, [spritesheetLoaded, type]);\r\n  return (\r\n    <div className={classNames(\"cell-bar-item\", { selected: isSelected })}>\r\n      <div className=\"cell-bar-item-icon\" onClick={onClick} style={style}>\r\n        {type.displayName}\r\n      </div>\r\n      <HotkeyButton hotkey={hotkey} onClick={onClick} />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ensureCanvasFocus(e: React.SyntheticEvent<any>) {\r\n  e.preventDefault();\r\n  const canvas = document.getElementsByTagName(\"canvas\")[0];\r\n  canvas.focus();\r\n}\r\n\r\ninterface HotkeyButtonProps extends React.HTMLProps<HTMLDivElement> {\r\n  hotkey: string;\r\n}\r\n\r\nfunction HotkeyButton({ hotkey, onClick, ...restProps }: HotkeyButtonProps) {\r\n  const handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    onClick && onClick(e);\r\n    ensureCanvasFocus(e);\r\n  };\r\n  return (\r\n    <div className=\"mito-hud-button mito-hud-build-item\" onClick={handleClick} {...restProps}>\r\n      <span className=\"mito-hud-button-hotkey\">{hotkey}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CellBar;\r\n","import * as React from \"react\";\r\n\r\nimport { TIME_PER_YEAR, Season, seasonDisplay } from \"../game\";\r\nimport \"./SeasonsTracker.scss\";\r\n\r\nexport default function SeasonsTracker({ time, season }: { time: number; season: Season; }) {\r\n  const yearDonePercent = time / TIME_PER_YEAR;\r\n  return (<div className=\"seasons-tracker\">\r\n    <div className=\"container\">\r\n      <div className=\"end-brace\" />\r\n      <div className=\"bar\">\r\n        <BarMarker percent={0.25} />\r\n        <BarMarker percent={0.5} />\r\n        <BarMarker percent={0.75} />\r\n        <SeasonBead percent={yearDonePercent} />\r\n      </div>\r\n      <div className=\"end-brace\" />\r\n    </div>\r\n    <div className=\"season-display\">\r\n      {seasonDisplay(season)}\r\n    </div>\r\n  </div>);\r\n}\r\n\r\nfunction BarMarker({ percent }: { percent: number; }) {\r\n  const style = {\r\n    left: `${(percent * 100).toFixed(2)}%`,\r\n  };\r\n  return <div className=\"bar-marker\" style={style} />;\r\n}\r\n\r\nfunction SeasonBead({ percent }: { percent: number; }) {\r\n  const style = {\r\n    left: `${(percent * 100).toFixed(2)}%`,\r\n  };\r\n  return <div className=\"season-bead\" style={style} />;\r\n}\r\n","import classnames from \"classnames\";\r\nimport * as React from \"react\";\r\n\r\nimport Mito from \"../index\";\r\nimport { params } from \"../params\";\r\nimport CellBar from \"./CellBar\";\r\n\r\nimport TraitDisplay from \"../../../evolution/TraitDisplay\";\r\nimport DynamicNumber from \"common/DynamicNumber\";\r\nimport { isInteresting } from \"evolution/traits\";\r\nimport \"./HUD.scss\";\r\n\r\nimport SeasonsTracker from \"./SeasonsTracker\";\r\n\r\nexport interface HUDProps {\r\n  mito: Mito;\r\n}\r\n\r\nexport interface HUDState {\r\n  traitsPanelOpen: boolean;\r\n}\r\n\r\nexport class HUD extends React.Component<HUDProps, HUDState> {\r\n  state: HUDState = {\r\n    traitsPanelOpen: true,\r\n  };\r\n\r\n  get mito() {\r\n    return this.props.mito;\r\n  }\r\n\r\n  get world() {\r\n    return this.mito.world;\r\n  }\r\n\r\n  get player() {\r\n    return this.world.player;\r\n  }\r\n\r\n  get inventory() {\r\n    return this.player.inventory;\r\n  }\r\n\r\n  private isTutorialFinished() {\r\n    return this.mito.tutorialRef == null ? true : this.mito.tutorialRef.isFinished();\r\n  }\r\n\r\n  public render() {\r\n    const isMaxed = this.inventory.isMaxed();\r\n    const isMaxedEl = <div className={`mito-inventory-maxed${isMaxed ? \" is-maxed\" : \"\"}`}>maxed</div>;\r\n    return (\r\n      <>\r\n        <SeasonsTracker time={this.world.time} season={this.world.season} />\r\n        {this.maybeRenderTraits()}\r\n        <div className={classnames(\"mito-inventory\", { hidden: false })}>\r\n          {isMaxedEl}\r\n          <div className=\"mito-inventory-container\">\r\n            {this.renderInventoryBar()}\r\n            {this.renderInventory()}\r\n          </div>\r\n          <CellBar\r\n            bar={this.mito.cellBar}\r\n            index={this.mito.cellBarIndex}\r\n            onIndexClicked={(i) => this.mito.setCellBarIndex(i)}\r\n          />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  maybeRenderTraits() {\r\n    if (this.state.traitsPanelOpen && isInteresting(this.world.traits)) {\r\n      return (\r\n        <div className=\"hud-panel-right\">\r\n          <TraitDisplay traits={this.world.traits} />\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n\r\n  renderInventory() {\r\n    return (\r\n      <div className=\"mito-inventory-indicator\">\r\n        <span className=\"mito-inventory-water\"><DynamicNumber speed={0.5} value={this.inventory.water} /> water</span>\r\n        &nbsp;\r\n        <span className=\"mito-inventory-sugar\"><DynamicNumber speed={0.5} value={this.inventory.sugar} /> sugar</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderInventoryBar() {\r\n    const waterPercent = this.inventory.water / params.maxResources;\r\n    const sugarPercent = this.inventory.sugar / params.maxResources;\r\n    const emptyPercent = 1 - (this.inventory.water + this.inventory.sugar) / params.maxResources;\r\n    const waterStyles: React.CSSProperties = {\r\n      width: `${waterPercent * 100}%`,\r\n    };\r\n    const sugarStyles: React.CSSProperties = {\r\n      width: `${sugarPercent * 100}%`,\r\n    };\r\n    const emptyStyles: React.CSSProperties = {\r\n      width: `${emptyPercent * 100}%`,\r\n    };\r\n    const inventoryBar = (\r\n      <div className=\"mito-inventory-bar\">\r\n        <div style={waterStyles} className=\"mito-inventory-bar-water\"></div>\r\n        <div style={sugarStyles} className=\"mito-inventory-bar-sugar\"></div>\r\n        <div style={emptyStyles} className=\"mito-inventory-bar-empty\"></div>\r\n      </div>\r\n    );\r\n    return inventoryBar;\r\n  }\r\n}\r\n","import { Vector2 } from \"three\";\r\n\r\nimport { Noise } from \"../../../common/perlin\";\r\nimport { map } from \"../../../math\";\r\nimport { params } from \"../params\";\r\nimport { Fountain, Rock, Soil, Tile } from \"./tile\";\r\nimport { World } from \"./world\";\r\n\r\nexport interface Environment {\r\n  climate: {\r\n    turnsBetweenRainfall: number;\r\n    rainDuration: number;\r\n    waterPerDroplet: number;\r\n  };\r\n  waterGravityPerTurn: number;\r\n  evaporationRate: number;\r\n  evaporationBottom: number;\r\n  floorCo2: number;\r\n  fill: FillFunction[];\r\n}\r\n\r\nexport type FillFunction = (pos: Vector2, world: World) => Tile | undefined;\r\n\r\nexport const Temperate = () => {\r\n  const noiseWater = new Noise();\r\n  const noiseRock = new Noise();\r\n  const noiseHeight = new Noise();\r\n\r\n  const environment: Environment = {\r\n    climate: {\r\n      turnsBetweenRainfall: 800,\r\n      rainDuration: 50,\r\n      waterPerDroplet: 2,\r\n    },\r\n    evaporationRate: 0.0002,\r\n    evaporationBottom: 0.6,\r\n    floorCo2: 0.3333,\r\n    waterGravityPerTurn: 0.005,\r\n    fill: [\r\n      (pos, world) => {\r\n        const { x, y } = pos;\r\n        const soilLevel =\r\n          world.height / 2 - (4 * (noiseHeight.perlin2(0, x / 5) + 1)) / 2 - 16 * noiseHeight.perlin2(10, x / 20 + 10);\r\n        const rockThreshold = map(y - world.height / 2, 0, world.height / 2, -0.7, 0.3);\r\n        const isRock = noiseRock.simplex2(x / 5, y / 5) < rockThreshold;\r\n        if (y > soilLevel) {\r\n          if (isRock) {\r\n            const rock = new Rock(pos, world);\r\n            return rock;\r\n          } else {\r\n            const heightScalar = Math.pow(map(y - world.height / 2, 0, world.height / 2, 0.5, 1), 2);\r\n            const simplexScalar = 0.2;\r\n            // this 0.1 factor makes a *huge* difference\r\n            const simplexValue = noiseWater.simplex2(x * simplexScalar, y * simplexScalar) + 0.2;\r\n            const water = Math.round(\r\n              Math.max(\r\n                1,\r\n                Math.min(\r\n                  // should be soil_max_water, isn't cuz of dependency cycles messing up instantiation\r\n                  20,\r\n                  simplexValue > 0.4 ? 20 * heightScalar : 0\r\n                )\r\n              )\r\n            );\r\n            if (heightScalar * simplexValue > 1 / params.fountainAppearanceRate) {\r\n              const emitWaterScalar = Math.min(heightScalar * simplexValue, 1);\r\n              return new Fountain(pos, water, world, Math.round(params.fountainTurnsPerWater / emitWaterScalar));\r\n            } else {\r\n              return new Soil(pos, water, world);\r\n            }\r\n          }\r\n        }\r\n      },\r\n    ],\r\n  };\r\n  return environment;\r\n};\r\n\r\nexport const Desert = () => {\r\n  const noiseHeight = new Noise();\r\n  const noiseRock = new Noise();\r\n\r\n  const e: Environment = {\r\n    climate: {\r\n      rainDuration: 220,\r\n      turnsBetweenRainfall: 3300,\r\n      waterPerDroplet: 8,\r\n    },\r\n    evaporationRate: 0.002,\r\n    evaporationBottom: 0.7,\r\n    waterGravityPerTurn: 0.02,\r\n    floorCo2: 0.95,\r\n    fill: [\r\n      (pos, world) => {\r\n        const { x, y } = pos;\r\n        const soilLevel =\r\n          world.height / 2 - (2 * (noiseHeight.perlin2(0, x / 20) + 1)) / 2 - 3 * noiseHeight.perlin2(10, x / 100 + 10);\r\n\r\n        const rockThreshold = map(y, world.height / 2, world.height, -0.8, -0.4);\r\n        const isRock = noiseRock.simplex2(x / 4, y / 4) < rockThreshold;\r\n        if (y > soilLevel) {\r\n          if (isRock) {\r\n            return new Rock(pos, world);\r\n          }\r\n          const water = Math.floor(Math.max(0, map(y, world.height * 0.75, world.height, 1, 9)));\r\n          return new Soil(pos, water, world);\r\n        }\r\n      },\r\n    ],\r\n  };\r\n  return e;\r\n};\r\n\r\nexport const Rocky = () => {\r\n  const noiseRock = new Noise();\r\n  const noiseHeight = new Noise();\r\n\r\n  const e: Environment = {\r\n    climate: {\r\n      turnsBetweenRainfall: 2500,\r\n      rainDuration: 120,\r\n      waterPerDroplet: 3,\r\n    },\r\n    waterGravityPerTurn: 0.1,\r\n    evaporationBottom: 0.6,\r\n    evaporationRate: 0.001,\r\n    floorCo2: 1,\r\n    fill: [\r\n      (pos, world) => {\r\n        const { x, y } = pos;\r\n        const soilLevel =\r\n          world.height * 0.55 -\r\n          (4 * (noiseHeight.perlin2(0, x / 5) + 1)) / 2 -\r\n          16 * noiseHeight.perlin2(10, x / 20 + 10) -\r\n          map(x, 0, world.width, 10, -10);\r\n        const rockLevel =\r\n          y - (6 * (noiseHeight.perlin2(0, x / 25) + 1)) / 2 - 20 * noiseHeight.perlin2(10, x / 150 + 10);\r\n        const rockThreshold = rockLevel < world.height * 0.5 ? -1 : -0.15;\r\n        const isRock = noiseRock.simplex2(x / 10, y / 10) < rockThreshold;\r\n        if (isRock) {\r\n          const rock = new Rock(pos, world);\r\n          return rock;\r\n        } else if (y > soilLevel) {\r\n          return new Soil(pos, 3, world);\r\n        }\r\n      },\r\n    ],\r\n  };\r\n  return e;\r\n};\r\n\r\nexport const ALL_ENVIRONMENTS = {\r\n  Temperate,\r\n  Desert,\r\n  Rocky,\r\n};\r\n","import * as React from \"react\";\r\n\r\ninterface SceneObjectProps {\r\n  object: THREE.Object3D;\r\n  parent: THREE.Object3D;\r\n  // children?: SceneObject[];\r\n}\r\nexport class SceneObject extends React.PureComponent<SceneObjectProps, {}> {\r\n  // render() {\r\n  //     if (this.props.children) {\r\n  //         return <>\r\n  //             {\r\n  //                 this.props.children.map((child) => React.cloneElement(child, { parent: this.props.object }))\r\n  //             }\r\n  //         </>;\r\n  //     }\r\n  // }\r\n\r\n  render() {\r\n    return null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.parent.add(this.props.object);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.parent.remove(this.props.object);\r\n  }\r\n}\r\n","import * as dat from \"dat.gui\";\r\nimport * as React from \"react\";\r\n\r\nimport { ALL_ENVIRONMENTS } from \"../game/environment\";\r\nimport { params, updateParamsHash } from \"../params\";\r\n\r\nexport class ParamsGUI extends React.Component {\r\n  private gui: dat.GUI;\r\n  constructor(props: any) {\r\n    super(props);\r\n    const gui = new dat.GUI({\r\n      closed: true,\r\n      width: 450,\r\n    });\r\n    gui\r\n      .add(params, \"environment\", Object.keys(ALL_ENVIRONMENTS))\r\n      .onChange(() => setTimeout(() => window.location.reload(), 100));\r\n    gui.add(params, \"droop\", 0, 0.5, 0.01);\r\n    gui.add(params, \"fountainTurnsPerWater\", 1, 100, 1);\r\n    gui.add(params, \"isRealtime\");\r\n    gui.add(params, \"leafReactionRate\", 0, 0.2, 0.0001);\r\n    gui.add(params, \"leafSugarPerReaction\", 0, 1, 0.01);\r\n    gui.add(params, \"rootTurnsPerTransfer\", 1, 100, 1);\r\n    gui.add(params, \"soilDarknessBase\", 0, 1, 0.01);\r\n    gui.add(params, \"soilDiffusionType\", [\"discrete\", \"continuous\"]);\r\n    gui.add(params, \"sunlightReintroduction\", 0, 1, 0.01);\r\n    gui.add(params, \"sunlightDiffusion\", 0, 1, 0.01);\r\n    gui.add(params, \"transportTurnsPerMove\", 1, 50, 1);\r\n    gui.add(params, \"veinDiffusion\", 0, 0.85, 0.0001);\r\n    const f = gui.addFolder(\"Needs Page Refresh\");\r\n    f.add(params, \"cellGestationTurns\", 0, 100, 1);\r\n    f.add(params, \"cellDiffusionSugar\", 0, 0.85, 0.0001);\r\n    f.add(params, \"cellDiffusionWater\", 0, 0.85, 0.0001);\r\n    f.add(params, \"cellEnergyMax\", 400, 10000, 100);\r\n    f.add(params, \"fountainAppearanceRate\", 1, 5, 0.1);\r\n    f.add(params, \"maxResources\", 10, 1000, 1);\r\n    f.add(params, \"soilDiffusionWater\", 0, 0.25, 0.00001);\r\n    f.add(params, \"soilMaxWater\", 1, 100, 1);\r\n    f.add(params, \"tissueInventoryCapacity\", 1, 100, 1);\r\n\r\n    for (const c of gui.__controllers.concat(f.__controllers)) {\r\n      c.onFinishChange(updateParamsHash);\r\n    }\r\n\r\n    this.gui = gui;\r\n  }\r\n\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport Ticker from \"global/ticker\";\r\n\r\nexport class Animate extends React.Component<{\r\n  a: (time: number) => void;\r\n}> {\r\n  private rafid?: number;\r\n  private animate = (time: number) => {\r\n    this.props.a(time / 1000);\r\n  };\r\n  render() {\r\n    return null;\r\n  }\r\n  componentDidMount() {\r\n    this.rafid = Ticker.addAnimation(this.animate);\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.rafid) {\r\n      Ticker.removeAnimation(this.rafid);\r\n    }\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\n\r\nimport lazy from \"../../../common/lazy\";\r\nimport { SceneObject } from \"./sceneObject\";\r\nimport { Animate } from \"./Animate\";\r\n\r\nexport const TILE_HIGHLIGHT = lazy(() => {\r\n  const geometry = new THREE.PlaneBufferGeometry(1, 1);\r\n  const edgesGeometry = new THREE.EdgesGeometry(geometry, 1); // or WireframeGeometry( geometry )\r\n  const material = new THREE.LineBasicMaterial({\r\n    color: 0xffffff,\r\n    transparent: true,\r\n    opacity: 0.75,\r\n  });\r\n  const lineSegments = new THREE.LineSegments(edgesGeometry, material);\r\n  lineSegments.position.z = 10;\r\n  return lineSegments;\r\n});\r\n\r\nexport interface TileHighlightProps {\r\n  x: number;\r\n  y: number;\r\n  scene: THREE.Scene;\r\n}\r\n\r\nclass TileHighlight extends React.PureComponent<TileHighlightProps, {}> {\r\n  private object = TILE_HIGHLIGHT().clone();\r\n  render() {\r\n    this.object.position.x = this.props.x;\r\n    this.object.position.y = this.props.y;\r\n    return (\r\n      <>\r\n        <Animate a={(t) => this.object.scale.setScalar(Math.sin(t * 3.7) * 0.04 + 0.94)} />\r\n        <SceneObject object={this.object} parent={this.props.scene} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default TileHighlight;\r\n","import * as React from \"react\";\r\nimport * as THREE from \"three\";\r\n\r\nimport lazy from \"../../../common/lazy\";\r\nimport { SceneObject } from \"./sceneObject\";\r\n\r\nexport const POINT_HIGHLIGHT = lazy(() => {\r\n  const geometry = new THREE.CircleBufferGeometry(0.1, 20);\r\n  const material = new THREE.MeshBasicMaterial({\r\n    color: 0xffffff,\r\n    transparent: true,\r\n    opacity: 0.75,\r\n    side: THREE.DoubleSide,\r\n  });\r\n  const mesh = new THREE.Mesh(geometry, material);\r\n  mesh.position.z = 10;\r\n  return mesh;\r\n  // const edgesGeometry = new THREE.EdgesGeometry(geometry, 1); // or WireframeGeometry( geometry )\r\n  // const material = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.75 });\r\n  // const lineSegments = new THREE.LineSegments(edgesGeometry, material);\r\n  // lineSegments.position.z = 10;\r\n  // return lineSegments;\r\n});\r\n\r\nexport interface PointHighlightProps {\r\n  x: number;\r\n  y: number;\r\n  z?: number;\r\n  scene: THREE.Scene;\r\n}\r\n\r\nclass PointHighlight extends React.PureComponent<PointHighlightProps, {}> {\r\n  private object = POINT_HIGHLIGHT().clone();\r\n  render() {\r\n    this.object.position.x = this.props.x;\r\n    this.object.position.y = this.props.y;\r\n    return (\r\n      <>\r\n        {/* <Animate a={((t) => this.object.scale.setScalar(Math.sin(t * 3.7) * 0.04 + 0.94))} /> */}\r\n        <SceneObject object={this.object} parent={this.props.scene} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default PointHighlight;\r\n","import * as React from \"react\";\r\n\r\nimport Mito from \"..\";\r\nimport { Tile } from \"../game/tile\";\r\nimport TileHighlight from \"../tutorial/tileHighlight\";\r\nimport { TileDetails } from \"./TileDetails\";\r\nimport PointHighlight from \"../tutorial/PointHighlight\";\r\n\r\ninterface HoverProps {\r\n  mito: Mito;\r\n}\r\n\r\nexport class Hover extends React.Component<HoverProps> {\r\n  get scene() {\r\n    return this.props.mito.scene;\r\n  }\r\n  public render() {\r\n    const { highlightedTile } = this.props.mito;\r\n    const highlightedPosition = this.props.mito.getHighlightPosition();\r\n    return (\r\n      <>\r\n        <TileDetails tile={highlightedTile} />\r\n        <PointHighlight x={highlightedPosition.x} y={highlightedPosition.y} scene={this.scene} />\r\n        {this.maybeRenderTileHighlight(highlightedTile)}\r\n        {/* {this.maybeRenderPath()} */}\r\n      </>\r\n    );\r\n  }\r\n\r\n  public maybeRenderTileHighlight(tile?: Tile) {\r\n    if (tile) {\r\n      return <TileHighlight x={tile.pos.x} y={tile.pos.y} scene={this.scene} />;\r\n    }\r\n  }\r\n\r\n  // public maybeRenderPath() {\r\n  //   const { autoplace, hoveredTile, scene, world } = this.props.mito;\r\n  //   if (hoveredTile) {\r\n  //     if (autoplace != null && Mito.expansionTiles.indexOf(autoplace) !== -1) {\r\n  //       return <PathHighlight tile={hoveredTile} scene={scene} world={world} walkable=\"non-obstacles\" />;\r\n  //     }\r\n  //     if (autoplace === Transport) {\r\n  //       return <PathHighlight tile={hoveredTile} scene={scene} world={world} walkable=\"tissue\" />;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n\r\n// class PathHighlight extends React.PureComponent<{ world: World, tile: Tile, scene: THREE.Scene, walkable: \"tissue\" | \"non-obstacles\" }> {\r\n//   render() {\r\n//     const path = this.props.walkable === \"non-obstacles\"\r\n//       ? findPositionsThroughNonObstacles(this.props.world, this.props.tile.pos)\r\n//       : findPositionsThroughTissue(this.props.world, this.props.tile.pos);\r\n//     return <>\r\n//       {path.map(([x, y]) => <TileHighlight x={x} y={y} scene={this.props.scene} />)}\r\n//     </>;\r\n//   }\r\n// }\r\n","import { PopulationAttempt } from \"app\";\r\nimport VignetteCapturer from \"common/vignette\";\r\nimport { parse } from \"query-string\";\r\nimport * as React from \"react\";\r\nimport * as THREE from \"three\";\r\nimport { OrthographicCamera, Scene, Vector2, Vector3, WebGLRenderer } from \"three\";\r\nimport { lerp2, map } from \"../../math/index\";\r\nimport { ISketch, SketchAudioContext } from \"../sketch\";\r\nimport { ActionBuild, ActionInteract, ActionMove } from \"./action\";\r\nimport { drums, hookUpAudio, strings } from \"./audio\";\r\nimport { Constructor } from \"./constructor\";\r\nimport { World } from \"./game\";\r\nimport { isInteractable } from \"./game/interactable\";\r\nimport { Cell, Fruit, Leaf, Root, Tile, Tissue, Transport, Vein } from \"./game/tile\";\r\nimport { ACTION_KEYMAP, CELL_BAR_KEYS, MOVEMENT_KEYS } from \"./keymap\";\r\nimport { params } from \"./params\";\r\nimport { TileRenderer } from \"./renderers/TileRenderer\";\r\nimport { WorldRenderer } from \"./renderers/WorldRenderer\";\r\nimport { NewPlayerTutorial } from \"./tutorial\";\r\nimport { GameStack, Hover, HUD } from \"./ui\";\r\n\r\nexport interface GameResult {\r\n  status: \"won\" | \"lost\";\r\n  fruits: Fruit[];\r\n  mutationPointsPerEpoch: number;\r\n  world: World;\r\n}\r\n\r\nexport class WorldDOMElement {\r\n  constructor(public mito: Mito, public positionFn: () => Vector2, public renderFn: () => JSX.Element) { }\r\n\r\n  render() {\r\n    const worldPosition = this.positionFn();\r\n    const pixelPosition = this.mito.worldToScreen(worldPosition);\r\n    const left = pixelPosition.x;\r\n    const top = pixelPosition.y;\r\n    const style: React.CSSProperties = {\r\n      left,\r\n      top,\r\n    };\r\n    return <div style={style}>{this.renderFn()}</div>;\r\n  }\r\n}\r\n\r\nexport class Mito extends ISketch {\r\n  static id = \"mito\";\r\n  public readonly world: World;\r\n  public scene = new Scene();\r\n  private camera = new OrthographicCamera(0, 0, 0, 0, -100, 100);\r\n  public cellBar: Constructor<Cell>[] = [Tissue, Leaf, Root, Transport, Fruit];\r\n  public cellBarIndex = 0;\r\n  public tutorialRef: NewPlayerTutorial | null = null;\r\n  public mouse = new THREE.Vector2();\r\n  public mouseDown = false;\r\n  public mouseButton = -1;\r\n  public instructionsOpen = false;\r\n  private firstActionTakenYet = false;\r\n  public audioListener = new THREE.AudioListener();\r\n  private keyMap = new Set<string>();\r\n  public highlightedTile?: Tile;\r\n\r\n  public events = {\r\n    contextmenu: (event: MouseEvent) => {\r\n      event.preventDefault();\r\n      return false;\r\n    },\r\n    mousemove: (event: MouseEvent) => {\r\n      this.mouse.x = event.clientX!;\r\n      this.mouse.y = event.clientY!;\r\n    },\r\n    click: () => {\r\n      // left-click\r\n      // this.handleClick(event.clientX!, event.clientY!);\r\n    },\r\n    mousedown: (event: MouseEvent) => {\r\n      this.mouseButton = event.button;\r\n      this.mouseDown = true;\r\n    },\r\n    mouseup: () => {\r\n      this.mouseDown = false;\r\n    },\r\n    keydown: (event: KeyboardEvent) => {\r\n      this.firstActionTakenYet = true;\r\n      const code = event.code;\r\n      this.keyMap.add(code);\r\n      if (!event.repeat) {\r\n        this.handleKeyDown(code);\r\n      }\r\n    },\r\n    keyup: (event: KeyboardEvent) => {\r\n      this.keyMap.delete(event.code);\r\n    },\r\n    wheel: (e: WheelEvent) => {\r\n      if (e.shiftKey) {\r\n        // on my mouse, one scroll is + or - 125\r\n        const delta = -(e.deltaX + e.deltaY) / 125 / 20;\r\n        const currZoom = this.camera.zoom;\r\n        const scalar = Math.pow(2, delta);\r\n        // console.log(currZoom);\r\n        // zoom of 2 is zooming in\r\n        // const newZoom = Math.min(Math.max(currZoom * scalar, 1), 2.5);\r\n        const newZoom = currZoom * scalar;\r\n        this.camera.zoom = newZoom;\r\n        this.camera.updateProjectionMatrix();\r\n      } else {\r\n        if (e.deltaX + e.deltaY < 0) {\r\n          this.setCellBarIndex(this.cellBarIndex - 1);\r\n        } else {\r\n          this.setCellBarIndex(this.cellBarIndex + 1);\r\n        }\r\n      }\r\n    },\r\n  };\r\n\r\n  get selectedCell() {\r\n    return this.cellBar[this.cellBarIndex];\r\n  }\r\n\r\n  private worldRenderer: WorldRenderer;\r\n  private vignetteCapturer = new VignetteCapturer(this);\r\n  private vignettes: HTMLCanvasElement[] = [];\r\n\r\n  constructor(\r\n    renderer: WebGLRenderer,\r\n    context: SketchAudioContext,\r\n    attempt: PopulationAttempt,\r\n    public onWinLoss: (result: GameResult) => void\r\n  ) {\r\n    super(renderer, context);\r\n    this.world = new World(attempt.targetHex.info.environment!, attempt.settlingSpecies);\r\n\r\n    this.camera.position.z = 10;\r\n    this.camera.lookAt(new THREE.Vector3(0, 0, 0));\r\n    this.camera.position.x = this.world.player.pos.x;\r\n    this.camera.position.y = this.world.player.pos.y;\r\n    this.camera.zoom = 1.5;\r\n    this.camera.add(this.audioListener);\r\n\r\n    this.worldRenderer = new WorldRenderer(this.world, this.scene, this);\r\n\r\n    hookUpAudio(this.audioContext);\r\n    this.updateAmbientAudio();\r\n    this.attachWindowEvents();\r\n    (window as any).mito = this;\r\n    (window as any).THREE = THREE;\r\n  }\r\n\r\n  private attachWindowEvents() {\r\n    window.addEventListener(\"blur\", () => {\r\n      this.keyMap.clear();\r\n    });\r\n  }\r\n\r\n  handleKeyDown = (code: string) => {\r\n    if (code === \"Slash\") {\r\n      this.instructionsOpen = !this.instructionsOpen;\r\n      return;\r\n    }\r\n    if (this.instructionsOpen) {\r\n      if (code === \"Escape\") {\r\n        this.instructionsOpen = false;\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (CELL_BAR_KEYS[code] != null) {\r\n      this.cellBarIndex = CELL_BAR_KEYS[code];\r\n    }\r\n  };\r\n\r\n  public setCellBarIndex(i: number) {\r\n    this.cellBarIndex = ((i % this.cellBar.length) + this.cellBar.length) % this.cellBar.length;\r\n  }\r\n\r\n  public render() {\r\n    const worldDomElementComponents: JSX.Element[] = [];\r\n    for (const e of this.worldDomElements) {\r\n      worldDomElementComponents.push(e.render());\r\n    }\r\n    return (\r\n      <>\r\n        <HUD mito={this} />\r\n        <GameStack mito={this} />\r\n        {/* <NewPlayerTutorial ref={(ref) => this.tutorialRef = ref } mito={this} />, */}\r\n        {/* <ParamsGUI /> */}\r\n        <Hover mito={this} />\r\n        <div className=\"world-dom-components\">{worldDomElementComponents}</div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  public updateAmbientAudio() {\r\n    const yPos = this.world.player.pos.y;\r\n    const drumVolume = map(yPos, this.world.height / 2, this.world.height, 0, 0.5);\r\n    const stringsVolume = map(yPos, this.world.height / 2, 0, 0, 0.5);\r\n    drums.gain.gain.value = Math.max(0, drumVolume);\r\n    strings.gain.gain.value = Math.max(0, stringsVolume);\r\n  }\r\n\r\n  public logRenderInfo() {\r\n    console.log(\r\n      `Geometries in memory: ${this.renderer.info.memory.geometries}\r\nTextures in memory: ${this.renderer.info.memory.textures}\r\nNumber of Programs: ${this.renderer.info.programs!.length}\r\n# Render Calls: ${this.renderer.info.render.calls}\r\n# Render Lines: ${this.renderer.info.render.lines}\r\n# Render Points: ${this.renderer.info.render.points}\r\n# Render Tris: ${this.renderer.info.render.triangles}\r\n`\r\n    );\r\n  }\r\n\r\n  public perfDebug() {\r\n    // count how many have autoUpdate enabled\r\n    let yes = 0,\r\n      no = 0;\r\n    this.scene.traverse((o) => {\r\n      if (o.matrixAutoUpdate) {\r\n        yes++;\r\n      } else {\r\n        no++;\r\n      }\r\n    });\r\n    console.log(\"matrixAutoUpdate: yes\", yes, \", no\", no);\r\n\r\n    // count how many vertices of each type there are\r\n    const s = new Map();\r\n    this.scene.traverse((o) => {\r\n      const k = s.get(o.name || o.constructor.name) || [];\r\n      s.set(o.name || o.constructor.name, k);\r\n      k.push(o);\r\n    });\r\n    console.log(s);\r\n  }\r\n\r\n  public worldStep(dt: number) {\r\n    if (!this.firstActionTakenYet || this.instructionsOpen) {\r\n      return;\r\n    }\r\n\r\n    // this.world.player.dropWater = this.keyMap.has(\"q\");\r\n    // this.world.player.dropSugar = this.keyMap.has(\"e\");\r\n    this.world.step(dt);\r\n\r\n    if (this.vignetteCapturer.isTimeForNewCapture()) {\r\n      const v = this.vignetteCapturer.capture();\r\n      this.vignettes.push(v);\r\n    }\r\n\r\n    if (this.tutorialRef) {\r\n      this.tutorialRef.setState({ time: this.world.time });\r\n    }\r\n\r\n    const gameResult = this.world.maybeGetGameResult();\r\n    if (gameResult != null) {\r\n      this.onWinLoss(gameResult);\r\n    }\r\n\r\n    this.updateAmbientAudio();\r\n  }\r\n\r\n  private getCameraNormCoordinates(clientX: number, clientY: number) {\r\n    return new THREE.Vector2((clientX / this.canvas.width) * 2 - 1, (-clientY / this.canvas.height) * 2 + 1);\r\n  }\r\n\r\n  public getHighlightVector(clientX = this.mouse.x, clientY = this.mouse.y) {\r\n    const offset = new Vector2(clientX - this.canvas.width / 2, clientY - this.canvas.height / 2);\r\n\r\n    offset.setLength(0.75);\r\n    return offset;\r\n  }\r\n\r\n  public getHighlightPosition(clientX = this.mouse.x, clientY = this.mouse.y) {\r\n    const offset = this.getHighlightVector(clientX, clientY);\r\n    const { x, y } = this.world.player.posFloat;\r\n\r\n    offset.x += x;\r\n    offset.y += y;\r\n    return offset;\r\n  }\r\n\r\n  private getHighlightedTile(clientX = this.mouse.x, clientY = this.mouse.y) {\r\n    const p = this.getHighlightPosition(clientX, clientY);\r\n    p.round();\r\n\r\n    const tile = this.world.tileAt(p.x, p.y);\r\n    if (tile != null && tile.lightAmount() > 0) {\r\n      return tile;\r\n    }\r\n  }\r\n\r\n  worldToScreen(world: Vector2) {\r\n    const screen = new Vector3(world.x, world.y, 0);\r\n    screen.project(this.camera); // `camera` is a THREE.PerspectiveCamera\r\n\r\n    screen.x = Math.round((0.5 + screen.x / 2) * this.canvas.width);\r\n    screen.y = Math.round((0.5 - screen.y / 2) * this.canvas.height);\r\n\r\n    return screen;\r\n  }\r\n\r\n  private worldDomElements = new Set<WorldDOMElement>();\r\n  addWorldDOMElement(positionFn: () => THREE.Vector2, renderFn: () => JSX.Element): WorldDOMElement {\r\n    const e = new WorldDOMElement(this, positionFn, renderFn);\r\n    this.worldDomElements.add(e);\r\n    return e;\r\n  }\r\n\r\n  removeWorldDOMElement(worldDomElement: WorldDOMElement) {\r\n    this.worldDomElements.delete(worldDomElement);\r\n  }\r\n\r\n  // private getTileAtScreenPosition(clientX: number, clientY: number) {\r\n  //   const cameraNorm = this.getCameraNormCoordinates(clientX, clientY);\r\n  //   this.raycaster.setFromCamera(cameraNorm, this.camera);\r\n\r\n  //   const { x, y } = this.raycaster.ray.origin;\r\n  //   const ix = Math.round(x);\r\n  //   const iy = Math.round(y);\r\n  //   const tile = this.world.tileAt(ix, iy);\r\n  //   if (tile != null && tile.lightAmount() > 0) {\r\n  //     return tile;\r\n  //   }\r\n  //   // }\r\n  // }\r\n\r\n  public animate(millisElapsed: number) {\r\n    if (this.instructionsOpen) {\r\n      return;\r\n    }\r\n    // if (document.activeElement !== this.canvas && !document.querySelector(\".dg.ac\")!.contains(document.activeElement)) {\r\n    //     this.canvas.focus();\r\n    // }\r\n    this.canvas.focus();\r\n    // const dt = millisElapsed / 1000;\r\n    // TODO make this seconds instead of frames\r\n    let dt = Math.min(1 * millisElapsed / 30, 10);\r\n    if (params.isRealtime) {\r\n      const moveAction = this.keysToMovement(this.keyMap);\r\n      if (moveAction) {\r\n        this.world.player.setAction(moveAction);\r\n      }\r\n      for (const key of this.keyMap) {\r\n        if (ACTION_KEYMAP[key]) {\r\n          this.world.player.setAction(ACTION_KEYMAP[key]);\r\n        }\r\n      }\r\n      if (this.mouseDown) {\r\n        // left\r\n        if (this.mouseButton === 0) {\r\n          this.handleLeftClick();\r\n        } else if (this.mouseButton === 2) {\r\n          this.handleRightClick();\r\n        }\r\n      }\r\n      this.worldStep(dt);\r\n    } else if (this.world.player.getAction() != null) {\r\n      this.worldStep(dt);\r\n    }\r\n    this.worldRenderer.update();\r\n\r\n    this.highlightedTile = this.getHighlightedTile();\r\n    if (this.highlightedTile != null) {\r\n      (this.worldRenderer.getOrCreateRenderer(this.highlightedTile) as TileRenderer).updateHover();\r\n    }\r\n\r\n    const mouseNorm = this.getCameraNormCoordinates(this.mouse.x, this.mouse.y);\r\n    const target = new THREE.Vector2(\r\n      this.world.player.posFloat.x + mouseNorm.x / 2,\r\n      this.world.player.posFloat.y - mouseNorm.y / 2\r\n    );\r\n    lerp2(this.camera.position, target, 0.3);\r\n\r\n    this.renderer.render(this.scene, this.camera);\r\n    if (Boolean(parse(window.location.search).debug) && this.frameCount % 100 === 0) {\r\n      // this.perfDebug();\r\n      this.logRenderInfo();\r\n    }\r\n  }\r\n  public keysToMovement(keys: Set<string>): ActionMove | null {\r\n    const dir = new Vector2();\r\n    for (const key of keys) {\r\n      if (MOVEMENT_KEYS[key]) {\r\n        dir.add(MOVEMENT_KEYS[key].dir);\r\n      }\r\n    }\r\n    if (dir.x === 0 && dir.y === 0) {\r\n      return null;\r\n    } else {\r\n      return {\r\n        type: \"move\",\r\n        dir,\r\n      };\r\n    }\r\n  }\r\n\r\n  public resize(w: number, h: number) {\r\n    const aspect = h / w;\r\n    // at zoom 1, we see 12 pixels up and 12 pixels down\r\n    const cameraHeight = 12;\r\n    this.camera.left = -cameraHeight / aspect;\r\n    this.camera.right = cameraHeight / aspect;\r\n    this.camera.top = -cameraHeight;\r\n    this.camera.bottom = cameraHeight;\r\n    // this.camera.position.z = 1;\r\n    // this.camera.lookAt(new Vector3(0, 0, 0));\r\n    this.camera.updateProjectionMatrix();\r\n  }\r\n\r\n  public handleRightClick() {\r\n    const tile = this.getHighlightedTile();\r\n    if (tile != null) {\r\n      if (tile instanceof Fruit) {\r\n        return; // disallow deleting fruit\r\n      }\r\n      this.world.player.setAction({\r\n        type: \"deconstruct\",\r\n        position: tile.pos,\r\n      });\r\n    }\r\n    // }\r\n  }\r\n\r\n  public handleLeftClick() {\r\n    this.firstActionTakenYet = true;\r\n    const target = this.getHighlightedTile();\r\n    if (target == null) {\r\n      return;\r\n    }\r\n\r\n    if (isInteractable(target)) {\r\n      const action: ActionInteract = {\r\n        type: \"interact\",\r\n        interactable: target,\r\n      };\r\n      this.world.player.setAction(action);\r\n      return;\r\n    }\r\n\r\n    // clicking a build candidate will try to build with the currently selected cell\r\n    if (this.world.player.isBuildCandidate(target)) {\r\n      const args: any[] = [];\r\n      if (this.selectedCell === Transport) {\r\n        const highlightVector = this.getHighlightVector();\r\n        const roundedHighlightVector = highlightVector.setLength(1).round();\r\n        args.push(roundedHighlightVector);\r\n      }\r\n      const action: ActionBuild = {\r\n        type: \"build\",\r\n        cellType: this.selectedCell,\r\n        position: target.pos.clone(),\r\n        args,\r\n      };\r\n      this.world.player.setAction(action);\r\n    }\r\n  }\r\n  static expansionTiles: Array<Constructor<Cell>> = [Tissue, Root, Vein];\r\n}\r\n\r\nexport default Mito;\r\n","import fruitSrc from \"assets/images/fruit.png\";\r\nimport * as React from \"react\";\r\nimport { GameResult } from \"..\";\r\nimport Character from \"../../../common/Character\";\r\nimport { Fruit } from \"../game/tile\";\r\nimport { seasonDisplay } from \"../game/world\";\r\nimport \"./GameResultsScreen.scss\";\r\n\r\n\r\n\r\n\r\nfunction Glow() {\r\n  return (\r\n    <div className=\"glow\">\r\n      <span />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface GameResultsScreenProps {\r\n  onDone: () => void;\r\n  results: GameResult;\r\n}\r\n\r\nfunction FruitInfo({ fruit }: { fruit: Fruit }) {\r\n  return (\r\n    <div className=\"fruit-info\">\r\n      <div className=\"fruit-visual\">\r\n        {fruit.isMature() ? <Glow /> : null}\r\n        <img alt=\"\" src={fruitSrc} />\r\n      </div>\r\n      {fruit.isMature() ? (\r\n        <>\r\n          <span className=\"matured-info success\">Matured</span>&nbsp;at {fruit.timeMatured}, Mutation Points earned: 1\r\n        </>\r\n      ) : (\r\n          <span className=\"matured-info in-progress\">{(fruit.getPercentMatured() * 100).toFixed(0)}% maturity</span>\r\n        )}\r\n      , started {fruit.timeMade}.\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction GameWonScreen({ results }: GameResultsScreenProps) {\r\n  const matureFruit = results.fruits.filter((f) => f.isMature());\r\n  return (\r\n    <>\r\n      <div className=\"character-party-container\">\r\n        <Character size=\"large\" />\r\n      </div>\r\n      <h1>You {matureFruit.length >= 3 ? \"thrived\" : \"survived\"}!</h1>\r\n      <h2>{matureFruit.length} Mutation Points earned.</h2>\r\n      <h5>Fruit Made</h5>\r\n      <div className=\"fruit-list\">\r\n        {results.fruits.map((f) => (\r\n          <FruitInfo fruit={f} />\r\n        ))}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction GameLostScreen({ results }: GameResultsScreenProps) {\r\n  return (\r\n    <>\r\n      <h1>You died!</h1>\r\n      <div>You survived until {seasonDisplay(results.world.season)}!</div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default function GameResultsScreen({ onDone, results }: GameResultsScreenProps) {\r\n  return (\r\n    <div className={`game-results-screen ${results.status}`}>\r\n      <div className=\"game-results-content\">\r\n        {results.status === \"won\" ? (\r\n          <GameWonScreen onDone={onDone} results={results} />\r\n        ) : (\r\n            <GameLostScreen onDone={onDone} results={results} />\r\n          )}\r\n        <button className=\"done-button\" onClick={onDone}>\r\n          Continue →\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { HexTile } from \"./hexTile\";\r\n\r\nexport class HexStore {\r\n  tiles: { [k: string]: HexTile } = {};\r\n\r\n  private hash(i: number, j: number) {\r\n    return `${i},${j}`;\r\n  }\r\n\r\n  get(i: number, j: number) {\r\n    return this.tiles[this.hash(i, j)];\r\n  }\r\n\r\n  set(i: number, j: number, tile: HexTile) {\r\n    this.tiles[this.hash(i, j)] = tile;\r\n  }\r\n\r\n  hookUpNeighbors() {\r\n    for (const tile of this) {\r\n      const { i, j } = tile;\r\n      tile.neighbors[0] = this.get(i + 1, j);\r\n      tile.neighbors[1] = this.get(i, j + 1);\r\n      tile.neighbors[2] = this.get(i - 1, j + 1);\r\n      tile.neighbors[3] = this.get(i - 1, j);\r\n      tile.neighbors[4] = this.get(i, j - 1);\r\n      tile.neighbors[5] = this.get(i + 1, j - 1);\r\n    }\r\n  }\r\n\r\n  *[Symbol.iterator]() {\r\n    for (const key in this.tiles) {\r\n      yield this.tiles[key];\r\n    }\r\n  }\r\n}\r\n","import { LevelInfo } from \"./levelInfo\";\r\n\r\nconst C = Math.sqrt(3) / 2;\r\n\r\nexport class HexTile {\r\n  /**\r\n   * store neighbors at angles [30, 90, 150, 210, 270, 330]\r\n   *\r\n   * 30: (1, 0, -1)\r\n   *\r\n   * 90: (0, 1, -1)\r\n   *\r\n   * 150: (-1, 1, 0)\r\n   *\r\n   * 210: (-1, 0, 1)\r\n   *\r\n   * 270: (0, -1, 1)\r\n   *\r\n   * 330: (1, -1, 0)\r\n   */\r\n  neighbors: HexTile[] = new Array(6);\r\n  info: LevelInfo = {\r\n    height: 0,\r\n    rainfall: \"medium\",\r\n    soilType: \"average\",\r\n    temperature: \"temperate\",\r\n    wind: \"low\",\r\n    visible: false,\r\n  };\r\n\r\n  get k() {\r\n    return -(this.i + this.j);\r\n  }\r\n  get magnitude() {\r\n    return Math.abs(this.i) + Math.abs(this.j) + Math.abs(this.k);\r\n  }\r\n  get cartesian() {\r\n    const { i, j } = this;\r\n    // simplified version:\r\n    // x = i - 0.5j - 0.5*-(i + j)\r\n    // x = i - 0.5j + 0.5i + 0.5j\r\n    // x = 1.5i\r\n    // y = Cj - C*-(i + j)\r\n    // y = Cj + Ci + Cj\r\n    // y = 2Cj + Ci\r\n    return {\r\n      x: 1.5 * i,\r\n      y: 2 * C * j + C * i,\r\n    };\r\n  }\r\n  constructor(public i: number, public j: number) { }\r\n}\r\n","import { Species } from \"evolution/species\";\r\nimport SimplexNoise from \"simplex-noise\";\r\nimport { Desert, Rocky, Temperate } from \"../sketches/mito/game/environment\";\r\nimport { HexStore } from \"./hexStore\";\r\nimport { HexTile } from \"./hexTile\";\r\n\r\nexport class OverWorld {\r\n  private static randomHeight(tile: HexTile, noise: SimplexNoise) {\r\n    const { x, y } = tile.cartesian;\r\n    let height = 0;\r\n    height += (noise.noise3D(x / 24, y / 24, 0) - 0.2) * 6;\r\n    height += noise.noise3D(x / 24, y / 24, 1.453) * 6;\r\n    height += noise.noise3D(x / 6, y / 6, 1.453) * 1.5;\r\n    height += 1;\r\n    // info.height += 4 - Math.abs(tile.magnitude * tile.magnitude) * 0.02;\r\n    height -= Math.abs(y * y) * 0.025;\r\n    if (height < 0 && height >= -1) {\r\n      height = 0;\r\n    }\r\n    height = Math.round(Math.max(Math.min(height, 6), -1));\r\n    return height;\r\n  }\r\n\r\n  private static populateLevelInfo(tile: HexTile, noise: SimplexNoise) {\r\n    const { info } = tile;\r\n    info.height = OverWorld.randomHeight(tile, noise);\r\n\r\n    info.environment = info.height < 2 ? Temperate() : info.height < 4 ? Rocky() : Desert();\r\n  }\r\n\r\n  static generateFilledHex(maxDist: number = 20): OverWorld {\r\n    const storage = new HexStore();\r\n    const noise = new SimplexNoise();\r\n    // the rule is: i + j + k = 0\r\n    // abs(i) <= maxDist\r\n    // abs(j) <= maxDist\r\n    // abs(k) <= maxDist\r\n    for (let i = -maxDist; i <= maxDist; i++) {\r\n      for (let j = -maxDist; j <= maxDist; j++) {\r\n        let k = -(i + j);\r\n        if (Math.abs(k) > maxDist) {\r\n          continue;\r\n        }\r\n        const tile = new HexTile(i, j);\r\n        OverWorld.populateLevelInfo(tile, noise);\r\n        storage.set(i, j, tile);\r\n      }\r\n    }\r\n    return new OverWorld(storage);\r\n  }\r\n\r\n  static generateRectangle(width: number = 50, height: number = 25): OverWorld {\r\n    const storage = new HexStore();\r\n    const noise = new SimplexNoise();\r\n    // the rule is: i + j + k = 0\r\n    // abs(i) <= maxDist\r\n    // abs(j) <= maxDist\r\n    // abs(k) <= maxDist\r\n    const maxDist = Math.max(width / 2, height / 2);\r\n\r\n    for (let i = -maxDist; i <= maxDist; i++) {\r\n      for (let j = -maxDist; j <= maxDist; j++) {\r\n        let k = -(i + j);\r\n        if (Math.abs(k) > maxDist) {\r\n          continue;\r\n        }\r\n        const tile = new HexTile(i, j);\r\n        const { x, y } = tile.cartesian;\r\n        if (x < -width / 2 || x > width / 2 || y < -height / 2 || y > height / 2) {\r\n          continue;\r\n        }\r\n\r\n        OverWorld.populateLevelInfo(tile, noise);\r\n        storage.set(i, j, tile);\r\n      }\r\n    }\r\n\r\n    return new OverWorld(storage);\r\n  }\r\n\r\n  private startTile: HexTile;\r\n\r\n  constructor(private storage: HexStore) {\r\n    // hook up neighbors\r\n    storage.hookUpNeighbors();\r\n\r\n    // make an initial tile visible\r\n    const tiles = Array.from(storage);\r\n    this.startTile = tiles.filter((t) => t.info.height === 0).sort((t1, t2) => t1.magnitude - t2.magnitude)[0];\r\n    this.startTile.info.visible = true;\r\n  }\r\n\r\n  public getStartTile() {\r\n    return this.startTile;\r\n  }\r\n\r\n  public tileAt(i: number, j: number) {\r\n    return this.storage.get(i, j);\r\n  }\r\n\r\n  *[Symbol.iterator]() {\r\n    for (const tile of this.storage) {\r\n      yield tile;\r\n    }\r\n  }\r\n\r\n  resetActionPoints() {\r\n    for (const tile of this.storage) {\r\n      if (tile.info.flora) {\r\n        tile.info.flora.actionPoints = 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  unusedHexes() {\r\n    const hexes = [];\r\n    for (const tile of this.storage) {\r\n      if (tile.info.flora && tile.info.flora.actionPoints > 0) {\r\n        hexes.push(tile);\r\n      }\r\n    }\r\n    return hexes;\r\n  }\r\n\r\n  getMaxGenePool(species: Species) {\r\n    let pool = 0;\r\n    for (const tile of this.storage) {\r\n      const { flora } = tile.info;\r\n      if (flora && flora.species === species) {\r\n        pool += flora.mutationPointsPerEpoch;\r\n      }\r\n    }\r\n    return pool;\r\n  }\r\n}\r\n","import { lineage, Species } from \"evolution/species\";\r\nimport { HexTile } from \"overworld/hexTile\";\r\nimport React, { useContext } from \"react\";\r\nimport { GameResult } from \"sketches/mito\";\r\nimport { AppState, PopulationAttempt } from \"./state\";\r\n\r\ntype AppReducerContextType = [AppState, React.Dispatch<AppActions>];\r\n\r\nexport const AppReducerContext = React.createContext<AppReducerContextType>(null!);\r\n\r\nexport function useAppReducer(): AppReducerContextType {\r\n  return useContext(AppReducerContext);\r\n}\r\n\r\nexport function reducer(state: AppState, action: AppActions): AppState {\r\n  switch (action.type) {\r\n    case \"AANewSpecies\":\r\n      return {\r\n        ...state,\r\n        // species: {\r\n        //   ...state.species,\r\n        //   [action.species.id]: action.species,\r\n        // },\r\n      };\r\n    case \"AAStartPopulationAttempt\":\r\n      return handleStartPopulationAttempt(state, action);\r\n    case \"AAPopulationAttemptSuccess\":\r\n      return handlePopulationAttemptSuccess(state, action);\r\n    case \"AANextEpoch\":\r\n      return handleNextEpoch(state, action);\r\n    case \"AAGetGameResult\":\r\n      return handleGetGameResult(state, action);\r\n    case \"AAGameResultDone\":\r\n      return handleGameResultDone(state, action);\r\n  }\r\n}\r\n\r\nexport type AppActions =\r\n  | AANewSpecies\r\n  | AAStartPopulationAttempt\r\n  | AAPopulationAttemptSuccess\r\n  | AANextEpoch\r\n  | AAGetGameResult\r\n  | AAGameResultDone\r\n  ;\r\n\r\nexport interface AANewSpecies {\r\n  type: \"AANewSpecies\";\r\n  species: Species;\r\n}\r\n\r\nexport interface AAStartPopulationAttempt {\r\n  type: \"AAStartPopulationAttempt\";\r\n  populationAttempt: PopulationAttempt;\r\n}\r\n\r\nfunction handleStartPopulationAttempt(state: AppState, action: AAStartPopulationAttempt): AppState {\r\n  const populationAttempt = action.populationAttempt;\r\n  const { targetHex, sourceHex } = populationAttempt;\r\n\r\n  if (!targetHex.info.visible) {\r\n    return state;\r\n  }\r\n  if (sourceHex != null && sourceHex.info.flora != null && sourceHex.info.flora.actionPoints < 1) {\r\n    return state;\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    activePopulationAttempt: action.populationAttempt,\r\n  };\r\n}\r\n\r\nexport interface AAFinishLevel {\r\n  type: \"AAFinishLevel\";\r\n  level: HexTile;\r\n  species: Species;\r\n  result: GameResult;\r\n}\r\n\r\nexport interface AAPopulationAttemptSuccess {\r\n  type: \"AAPopulationAttemptSuccess\";\r\n  attempt?: PopulationAttempt;\r\n  results: GameResult;\r\n}\r\n\r\nfunction handlePopulationAttemptSuccess(state: AppState, action: AAPopulationAttemptSuccess): AppState {\r\n  const { attempt = state.activePopulationAttempt!, results } = action;\r\n  const { targetHex, sourceHex, settlingSpecies } = attempt;\r\n  // use the action point\r\n  if (sourceHex != null) {\r\n    sourceHex.info.flora!.actionPoints -= 1;\r\n  }\r\n\r\n  // populate target hex\r\n  let oldSpecies: Species | undefined = undefined;\r\n  if (targetHex.info.flora != null) {\r\n    oldSpecies = targetHex.info.flora.species;\r\n  }\r\n  targetHex.info.flora = {\r\n    species: settlingSpecies,\r\n    mutationPointsPerEpoch: results.mutationPointsPerEpoch,\r\n    actionPoints: 0,\r\n  };\r\n  settlingSpecies.totalMutationPoints = state.overWorld.getMaxGenePool(settlingSpecies);\r\n  if (oldSpecies) {\r\n    // update old species mutation point pool cache\r\n    oldSpecies.totalMutationPoints = state.overWorld.getMaxGenePool(oldSpecies);\r\n  }\r\n\r\n  // bump visibility\r\n  for (const n of targetHex.neighbors) {\r\n    n.info.visible = true;\r\n  }\r\n\r\n  // things we changed:\r\n  // sourceHex\r\n  // targetHex\r\n  // oldSpecies\r\n  // settlingSpecies\r\n  // targetHex.neighbors\r\n  return { ...state };\r\n}\r\n\r\nexport interface AANextEpoch {\r\n  type: \"AANextEpoch\";\r\n}\r\n\r\nfunction handleNextEpoch(state: AppState, action: AANextEpoch): AppState {\r\n  // +1 epoch:\r\n  // reset action points of all habited tiles to 1\r\n  state.overWorld.resetActionPoints();\r\n  // reset all species pools to max\r\n  for (const species of lineage(state.rootSpecies)) {\r\n    species.freeMutationPoints = species.totalMutationPoints;\r\n  }\r\n  return {\r\n    ...state,\r\n    epoch: state.epoch + 1,\r\n  };\r\n}\r\n\r\nexport interface AAGetGameResult {\r\n  type: \"AAGetGameResult\";\r\n  result: GameResult;\r\n}\r\n\r\nfunction handleGetGameResult(state: AppState, action: AAGetGameResult): AppState {\r\n  if (state.activePopulationAttempt == null) {\r\n    throw new Error(\"activePopulationAttempt shouldn't be null during handleWinLoss\");\r\n  }\r\n  if (action.result.status === \"won\") {\r\n    state = handlePopulationAttemptSuccess(state, {\r\n      type: \"AAPopulationAttemptSuccess\",\r\n      attempt: state.activePopulationAttempt,\r\n      results: action.result,\r\n    });\r\n  }\r\n  return {\r\n    ...state,\r\n    activeGameResult: action.result,\r\n  };\r\n}\r\n\r\nexport interface AAGameResultDone {\r\n  type: \"AAGameResultDone\";\r\n}\r\n\r\nfunction handleGameResultDone(state: AppState, action: AAGameResultDone): AppState {\r\n  return {\r\n    ...state,\r\n    activePopulationAttempt: undefined,\r\n    activeGameResult: undefined,\r\n  };\r\n}\r\n","import { newBaseSpecies } from \"evolution/species\";\r\nimport { OverWorld } from \"overworld/overWorld\";\r\nimport React from \"react\";\r\nimport { AppReducerContext, reducer } from \"./reducer\";\r\nimport { AppState } from \"./state\";\r\n\r\nexport interface AppStateProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport default function AppStateProvider({ children }: AppStateProviderProps) {\r\n  const stateDispatchTuple = React.useReducer(reducer, newInitialAppState());\r\n  return (\r\n    <AppReducerContext.Provider value={stateDispatchTuple}>\r\n      {children}\r\n    </AppReducerContext.Provider>\r\n  );\r\n}\r\n\r\nexport function newInitialAppState(): AppState {\r\n  const overWorld = OverWorld.generateRectangle(100, 50);\r\n  const rootSpecies = newBaseSpecies(\"plantum originus\");\r\n  // const activeLevel = overWorld.getStartTile();\r\n  // rootSpecies.freeMutationPoints = 25;\r\n  // const s3 = newBaseSpecies(\"s3\");\r\n  // s3.descendants = [newBaseSpecies(\"ya\"), newBaseSpecies(\"no\"), newBaseSpecies(\"whoa\")];\r\n  // let s: Species;\r\n  // rootSpecies.descendants = [s = newBaseSpecies(\"foo\"), newBaseSpecies(\"bar\"), s3];\r\n  // s.descendants = [newBaseSpecies(\"1\"), newBaseSpecies(\"2\")]\r\n  return {\r\n    overWorld,\r\n    rootSpecies,\r\n    epoch: 0,\r\n  };\r\n}\r\n","import { MousePositionContext } from \"common/useMousePosition\";\r\nimport OverWorldScreen from \"overworld/OverWorldScreen\";\r\nimport React from \"react\";\r\nimport { createSelector } from \"reselect\";\r\nimport { Species } from \"../evolution/species\";\r\nimport { HexTile } from \"../overworld/hexTile\";\r\nimport { FullPageSketch } from \"../sketches/fullPageSketch\";\r\nimport Mito, { GameResult } from \"../sketches/mito\";\r\nimport GameResultsScreen from \"../sketches/mito/ui/GameResultsScreen\";\r\nimport AppStateProvider from \"./AppStateProvider\";\r\nimport { AppReducerContext } from \"./reducer\";\r\nimport { AppState, PopulationAttempt } from \"./state\";\r\n\r\ninterface AppComponentState {\r\n  mousePosition: { x: number, y: number };\r\n}\r\n\r\nclass AppComponent extends React.PureComponent<{}, AppComponentState> {\r\n  static contextType = AppReducerContext;\r\n  context!: React.ContextType<typeof AppReducerContext>;\r\n\r\n  constructor(props: {}, context: any) {\r\n    super(props, context);\r\n    this.state = {\r\n      mousePosition: { x: window.innerWidth / 2, y: window.innerHeight / 2 },\r\n    };\r\n  }\r\n\r\n  handleMousePosition = (e: MouseEvent) => {\r\n    this.setState({\r\n      mousePosition: { x: e.clientX, y: e.clientY },\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener(\"mousemove\", this.handleMousePosition);\r\n\r\n    const [state, dispatch] = this.context;\r\n    // test give first level for free\r\n    dispatch({\r\n      type: \"AAPopulationAttemptSuccess\",\r\n      attempt: {\r\n        settlingSpecies: state.rootSpecies,\r\n        targetHex: state.overWorld.getStartTile(),\r\n      },\r\n      results: {\r\n        status: \"won\", mutationPointsPerEpoch: 1, fruits: [], world: null!\r\n      }\r\n    });\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"mousemove\", this.handleMousePosition);\r\n  }\r\n\r\n  handlePopulationAttempt = (targetHex: HexTile, settlingSpecies: Species, sourceHex?: HexTile) => {\r\n    const populationAttempt: PopulationAttempt = {\r\n      settlingSpecies,\r\n      sourceHex,\r\n      targetHex,\r\n    };\r\n    const [, dispatch] = this.context;\r\n    dispatch({\r\n      type: \"AAStartPopulationAttempt\",\r\n      populationAttempt,\r\n    });\r\n  };\r\n\r\n  handleNextEpoch = () => {\r\n    const [, dispatch] = this.context;\r\n    dispatch({ type: \"AANextEpoch\" });\r\n  }\r\n\r\n  handleWinLoss = (result: GameResult) => {\r\n    const [, dispatch] = this.context;\r\n    dispatch({\r\n      type: \"AAGetGameResult\",\r\n      result,\r\n    });\r\n  };\r\n\r\n  handleResultsDone = () => {\r\n    const [, dispatch] = this.context;\r\n    dispatch({\r\n      type: \"AAGameResultDone\",\r\n    });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <MousePositionContext.Provider value={this.state.mousePosition}>\r\n        <div className=\"App\">\r\n          {this.maybeRenderOverWorld()}\r\n          {this.maybeRenderInGame()}\r\n          {this.maybeRenderGameResult()}\r\n        </div>\r\n      </MousePositionContext.Provider>\r\n    );\r\n  }\r\n\r\n  maybeRenderOverWorld() {\r\n    const [state,] = this.context;\r\n    if (state.activePopulationAttempt == null) {\r\n      return (\r\n        <OverWorldScreen\r\n          epoch={state.epoch}\r\n          overWorld={state.overWorld}\r\n          rootSpecies={state.rootSpecies}\r\n          onPopulationAttempt={this.handlePopulationAttempt}\r\n          onNextEpoch={this.handleNextEpoch}\r\n        />\r\n      );\r\n    }\r\n  }\r\n\r\n  private otherArgsSelector = createSelector(\r\n    (s: AppState) => s.activePopulationAttempt,\r\n    (activePopulationAttempt) => [activePopulationAttempt, this.handleWinLoss]\r\n  );\r\n\r\n  maybeRenderInGame() {\r\n    const [state,] = this.context;\r\n    if (state.activePopulationAttempt != null && state.activeGameResult == null) {\r\n      return <FullPageSketch sketchClass={Mito} otherArgs={this.otherArgsSelector(state)} />;\r\n    }\r\n  }\r\n\r\n  maybeRenderGameResult() {\r\n    const [state,] = this.context;\r\n    if (state.activeGameResult != null) {\r\n      return <GameResultsScreen results={state.activeGameResult} onDone={this.handleResultsDone} />;\r\n    }\r\n  }\r\n}\r\n\r\nconst App = () => (\r\n  <AppStateProvider>\r\n    <AppComponent />\r\n  </AppStateProvider>\r\n);\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL((process as { env: { [key: string]: string } }).env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (response.status === 404 || (contentType != null && contentType.indexOf(\"javascript\") === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\"No internet connection found. App is running in offline mode.\");\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\r\nimport { World } from \"../sketches/mito/game\";\r\nimport { Temperate, Environment, Rocky, Desert } from \"../sketches/mito/game/environment\";\r\nimport { Tile, Air, Soil, Rock, Fountain } from \"../sketches/mito/game/tile\";\r\nimport { hasInventory } from \"../sketches/mito/inventory\";\r\nimport { PlotData, Layout } from \"plotly.js\";\r\nimport { findBuildCandidateTiles } from \"../sketches/mito/game/worldUtils\";\r\nimport { newBaseSpecies } from \"../evolution/species\";\r\n\r\ntype Visitor = (tiles: Tile[], world: World) => number;\r\ninterface Visitors {\r\n  [name: string]: Visitor;\r\n}\r\n\r\nfunction visit(world: World, visitors: Visitors): Trial {\r\n  const tiles = Array.from(world.environmentTiles());\r\n  const results: Trial = {};\r\n  for (const [name, visitor] of Object.entries(visitors)) {\r\n    const result = visitor(tiles, world);\r\n    results[name] = result;\r\n  }\r\n  return results;\r\n}\r\n\r\ninterface Trial {\r\n  [key: string]: number;\r\n}\r\nclass Experiment {\r\n  trials: Trial[] = [];\r\n  constructor(public visitors: Visitors) { }\r\n  recordDataFor(world: World) {\r\n    const trial = visit(world, this.visitors);\r\n    this.trials.push(trial);\r\n  }\r\n  visitorNames() {\r\n    return Object.keys(this.visitors);\r\n  }\r\n}\r\n\r\nclass ExperimentSuite {\r\n  constructor(public experiments: Experiment[]) { }\r\n\r\n  recordDataFor(world: World) {\r\n    for (const e of this.experiments) {\r\n      e.recordDataFor(world);\r\n    }\r\n  }\r\n}\r\n\r\nfunction runTests(environmentFn: () => Environment, id: string) {\r\n  console.log(\"running\");\r\n  const suite = new ExperimentSuite([\r\n    new Experiment({\r\n      countAir: (t) => t.filter((tile) => tile.constructor === Air).length,\r\n    }),\r\n    new Experiment({\r\n      countSoil: (t) => t.filter((tile) => tile.constructor === Soil).length,\r\n    }),\r\n    new Experiment({\r\n      countRock: (t) => t.filter((tile) => tile.constructor === Rock).length,\r\n    }),\r\n    new Experiment({\r\n      countFountain: (t) => t.filter((tile) => tile.constructor === Fountain).length,\r\n    }),\r\n    new Experiment({\r\n      playerY: (_, w) => w.player.pos.y,\r\n    }),\r\n    new Experiment({\r\n      startAdjacentWaters: (_, w) => {\r\n        const adjacentTiles = findBuildCandidateTiles(w, (t) => t instanceof Soil);\r\n        let water = 0;\r\n        for (const t of adjacentTiles) {\r\n          if (hasInventory(t)) {\r\n            water += t.inventory.water;\r\n          }\r\n        }\r\n        return water;\r\n      },\r\n    }),\r\n    new Experiment({\r\n      countWaters: (t) => {\r\n        return t.reduce((w, tile) => w + (hasInventory(tile) ? tile.inventory.water : 0), 0);\r\n      },\r\n    }),\r\n  ]);\r\n  for (let i = 0; i < 20; i++) {\r\n    console.time(\"trial \" + i);\r\n    const world = new World(environmentFn(), newBaseSpecies());\r\n    suite.recordDataFor(world);\r\n    console.timeEnd(\"trial \" + i);\r\n  }\r\n\r\n  plotStackedBar(suite.experiments.slice(0, 4), id);\r\n\r\n  for (const e of suite.experiments) {\r\n    plotHistogram(e, id);\r\n  }\r\n}\r\n\r\nfunction plotStackedBar(experiments: Experiment[], divId: string) {\r\n  const data = [];\r\n  const names = experiments.map((e) => e.visitorNames().join(\"\"));\r\n  for (const idx in names) {\r\n    const name = names[idx];\r\n    const x = [];\r\n    const y = [];\r\n    for (let i = 0; i < experiments[0].trials.length; i++) {\r\n      x.push(i);\r\n\r\n      const e = experiments[idx];\r\n      const trial = e.trials[i];\r\n      const value = trial[name];\r\n      y.push(value);\r\n    }\r\n    const trace: Partial<PlotData> = {\r\n      x,\r\n      y,\r\n      name,\r\n      type: \"bar\",\r\n    };\r\n    data.push(trace);\r\n  }\r\n  var layout: Partial<Layout> = { barmode: \"stack\" };\r\n\r\n  const div = document.createElement(\"div\");\r\n  const el = document.getElementById(divId)!;\r\n  el.appendChild(div);\r\n  window.Plotly.newPlot(div, data, layout);\r\n}\r\n\r\nfunction plotHistogram(stats: Experiment, divId: string) {\r\n  const data = [];\r\n  const layout: Partial<Layout> = {};\r\n\r\n  for (const name of stats.visitorNames()) {\r\n    var trace: Partial<PlotData> = {\r\n      x: stats.trials.map((t) => t[name]),\r\n      type: \"histogram\",\r\n      name: name,\r\n    };\r\n    data.push(trace);\r\n\r\n    layout.title = {\r\n      text: name,\r\n    };\r\n  }\r\n  const div = document.createElement(\"div\");\r\n  const el = document.getElementById(divId)!;\r\n  el.appendChild(div);\r\n  div.style.height = \"240px\";\r\n  div.style.width = \"320px\";\r\n  div.style.display = \"inline-block\";\r\n  window.Plotly.newPlot(div, data, layout);\r\n}\r\n\r\nfunction TestStats() {\r\n  React.useEffect(() => {\r\n    var script = document.createElement(\"script\");\r\n    script.src = \"https://cdn.plot.ly/plotly-latest.min.js\";\r\n    script.addEventListener(\"load\", function () {\r\n      runTests(Temperate, \"temperate\");\r\n      runTests(Rocky, \"rocky\");\r\n      runTests(Desert, \"desert\");\r\n    });\r\n\r\n    document.body.appendChild(script);\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <h1>Experiments</h1>\r\n      <div id=\"temperate\">\r\n        <h2>Temperate</h2>\r\n      </div>\r\n      <div id=\"rocky\">\r\n        <h2>Rocky</h2>\r\n      </div>\r\n      <div id=\"desert\">\r\n        <h2>Desert</h2>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TestStats;\r\n","import { World } from \".\";\r\n\r\nimport { Tile, Tissue } from \"./tile\";\r\n\r\nexport function findBuildCandidateTiles(world: World, predicate?: (tile: Tile) => boolean) {\r\n  const entityPredicate: (tile: Tile) => boolean = (t) => world.player.isWalkable(t);\r\n  const candidates: Set<Tile> = new Set();\r\n  for (const entity of world.entities()) {\r\n    if (entity instanceof Tile && entityPredicate(entity)) {\r\n      for (const [, neighbor] of world.tileNeighbors(entity.pos)) {\r\n        if (!(neighbor instanceof Tissue) && !neighbor.isObstacle) {\r\n          if (predicate == null) {\r\n            candidates.add(neighbor);\r\n          } else if (predicate(neighbor)) {\r\n            candidates.add(neighbor);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return candidates;\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport 'react-dropdown/style.css';\r\nimport { HashRouter, Redirect, Route, Switch } from \"react-router-dom\";\r\nimport App from \"./app/App\";\r\nimport \"./index.scss\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nimport TestStats from \"./tests/TestStats\";\r\nimport { TestWinScreen } from \"./tests/TestWinScreen\";\r\n\r\nReactDOM.render(\r\n  <HashRouter>\r\n    <Switch>\r\n      <Route path=\"/test-win\">\r\n        <TestWinScreen />\r\n      </Route>\r\n      <Route path=\"/test-stats\">\r\n        <TestStats />\r\n      </Route>\r\n      <Route exact path=\"/\">\r\n        <App />\r\n      </Route>\r\n      <Route path=\"*\">\r\n        <Redirect to=\"/\" />\r\n      </Route>\r\n    </Switch>\r\n  </HashRouter>,\r\n\r\n  document.getElementById(\"root\")\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","import React from \"react\";\r\nimport { Vector2 } from \"three\";\r\nimport { newBaseSpecies } from \"../evolution/species\";\r\nimport { GameResult } from \"../sketches/mito\";\r\nimport { World } from \"../sketches/mito/game\";\r\nimport { Temperate } from \"../sketches/mito/game/environment\";\r\nimport { Fruit } from \"../sketches/mito/game/tile\";\r\nimport GameResultsScreen from \"../sketches/mito/ui/GameResultsScreen\";\r\n\r\nexport function TestWinScreen() {\r\n  const world = new World(Temperate(), newBaseSpecies());\r\n  world.time = 150;\r\n  const f1 = new Fruit(new Vector2(0, 0), world);\r\n  f1.committedResources.add(50, 50);\r\n  f1.timeMatured = 250;\r\n\r\n  world.time = 479;\r\n  const f2 = new Fruit(new Vector2(0, 0), world);\r\n  f2.committedResources.add(25, 15);\r\n\r\n  world.time = 1296;\r\n  const f3 = new Fruit(new Vector2(0, 0), world);\r\n  f3.committedResources.add(50, 50);\r\n  const mockResults: GameResult = {\r\n    status: \"won\",\r\n    fruits: [f1, f2, f3],\r\n    mutationPointsPerEpoch: 2,\r\n    world,\r\n  };\r\n  return <GameResultsScreen results={mockResults} onDone={() => { }} />;\r\n}\r\n","module.exports = __webpack_public_path__ + \"static/media/fruit.e136487f.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAACC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KD0UqkwAAAM1JREFUKBVjYBgowIjL4v50+/8wucKZB7GqwxCEadJSkYfpZbh25yGYjW4IimaQRpimSbL8cM15jz+C2SBDkA1ggqtAYiBrBAmj82FK4TbDbF2qowSWe/vxLUwNgzC/MJgdfeUe2Asw27HajKwRpAudDzMVq2aYJCGaepr5JSH+hfkRZjOMD5OHicMDDCSAHmgwRSAaPbBAYhjOBpmehQhokBowH91WkDiKzSABWAqztHUEccHg+OH9YBoWRVBhTM0wCZghID66JpgaimgAWfxCZhIsrg0AAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAFJklEQVRIS62We2xTVRzHv+e2ty0bfa223VMjMEjWTXyuBmOIsCiYIGCMRpYoiSYIGjSOmGE0gCSogcnDR0biwIQoCmqmLg4msP2xBLYYQmCj4GOKjLmue/Tlut3b3mPOvbT3di2tiTt/9fZ3ft/+fp/z7e9cgv+wpt4nFD7A9Bkl+bbn3SDshqriA/hDyJmTX7B7JSVn25XCZkOQ6YjdKyla2sEfzl0d25u1Qi0zzyflFJJKrv+VQZKLaYaguBs0le4DFteUQppWFS9wfujIzS1ZEKQEaa+5k9RGHhG7V1CcPZFiVrOoBPuqpuTn1/qNuPDQ3dCdU+PskJK5GS2roiqzo2230R19elnw7YUC6p8cJ2L34xQtP8pMtWJZGXZ13kFPBubKAkvMUTQOJABJpfBBtQFdgQI5XmcLYfmjg2nYMhhuPeaha0qikKZFtEcd+PqPsTSGa+c58ExFFJFoHB3RIuxceym7IO2x9BFvuJoJPuscg5MXcWCoGK3XxnG4JiZXtP6CCUxwc+kwAiKPowEH3n26nyRzszC0fH8maFl1KmiFw12IZYnr6IuK2HVZYbi1UkCN3Yjjo0WwOubgvrgfdfbQD6Q2/ETSGWnl0nPmhq5J+56OUbMcX2oN45fYNJqv8fLzhnIB1UWFOBUoTDFcZgltIQ9GmjIEaY/lC+INr2MtP1UcAp+I45uwC8cHRrFrnmKbRp9Bbnl9RRDBSYq2sENmmMxNa5n2WPzEG3YzwRfcAbh5EbsGS9F6fQKt90zKgqt7FYZvlg/BL/Jo8TuTDOXcTIY9ls9PBy3rToessDsLsFS6AV9UwHs+heEbCwR47Ca0jtlhsZvwgOTHcluYdVafnWGPZVtX1La9Y0xhyHx2ZVLAx38qgi9XCPAUFSLp0+XWEBPcTrzhHdkYniLecJ1sG/cECiHiSKgEx34fxUcLFdtsumSUW95YMYbxGPBt2Il31sgM5dyZDIeJN1zMBF90j8AlMyzDsZ9HcGKFiFW9JllUYXgDIyKPT/2uJEM5NwtDc/OZkHUD86G1yISH8TcuRwQ0XVVaZqvlfg5t43bMtRpRiwDqbMGDxBt5KTvDXuuezoi14aebDB+zhXA1No39A4oPN98u4AYpQTyujDPGeJkt0kRqQ1syGfZaL5La0F2s5eddo7Dp4zg4UY6vfgvgiEexTf15xTY6HYd6xwi+DLmxY/VFQm/mZrTMvmCCz7lGYdfHsX+oGMfPj0Bv06VaZoKvlg7LMbbYfzkVzHYFnO4op4yh2WbEEoxgU7+UNm2a79XjZNCKArMBkxEhtyDtMTdX91o2SII6/xoqRTT9qjB8/U4Be/8ygiY0t0TD0C3Hl3z0VftKqTSl3iGckcN3ixWGzDqE50BFNX6lcTh3y/MbnZTXMItHJOjNXApTYlKCrkB9ziuYrULtrZe3Qs+HZTQtwcCBCmpLMwWInoDGVYaEI6CaO4dU7S+jUiyRaokzcZjJMFeFGT8wv9FFeZvKJIPZPxJ0hWpcilFwc9RzYI7gDOrz7FfoOVCWZhNi5EA1rx7EQEA1viQ8ARVVhtARQOPL2a9wwVsuqp+r9RmFrkBlkohR6LTMpik4oxpn1bKqU9Nm1k+5ijHU2saogzStsZGBg5TLlzqS9t+efYaV29w0jdEUBWe6tc+oCBBl+MiLxgGi3hCY/Qq105Z9rm6uoJqXYuUtXGO7mfv7Nl7PPb6q9mbOw5zTZmueebhoZzHVMpnJiCYAol4xuJJP8P9W+C+xZd+qpRkU/AAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/mito-base.28ee2cbb.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-strings.9f30639c.mp3\";","module.exports = __webpack_public_path__ + \"static/media/mito-drums.1c82b4f4.mp3\";","module.exports = __webpack_public_path__ + \"static/media/footsteps.636605b0.wav\";","module.exports = __webpack_public_path__ + \"static/media/build.a2067d20.wav\";","module.exports = __webpack_public_path__ + \"static/media/Blop-Mark_DiAngelo-79054334.627c0e8b.mp3\";","module.exports = __webpack_public_path__ + \"static/media/suckwater.b0fe81fa.wav\";","module.exports = __webpack_public_path__ + \"static/media/roguelikeSheet_transparent.3c15bcea.png\";"],"sourceRoot":""}