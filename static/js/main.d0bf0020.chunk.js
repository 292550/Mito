(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{33:function(e,t,n){e.exports=n(67)},39:function(e,t,n){},67:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(28),o=n.n(a),s=(n(39),n(2)),l=n(3),u=n(6),c=n(4),h=n(5),d=n(12),p=n.n(d),v=n(29),f=n(32),m=n(13),y=n(1),g={click:!0,contextmenu:!0,dblclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,touchstart:!0,touchmove:!0,touchend:!0,keyup:!0,keydown:!0,keypress:!0,wheel:!0},w=function(){function e(t,n){Object(s.a)(this,e),this.renderer=t,this.audioContext=n,this.elements=void 0,this.events=void 0,this.timeElapsed=0,this.frameCount=0}return Object(l.a)(e,[{key:"aspectRatio",get:function(){return this.renderer.domElement.height/this.renderer.domElement.width}},{key:"resolution",get:function(){return new y.E(this.renderer.domElement.width,this.renderer.domElement.height)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),e}();w.id=void 0;var b,k,E,O,j,x,A,C=n(26),T=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).frameId=void 0,n.lastTimestamp=0,n.loop=function(e){var t=e-n.lastTimestamp;n.lastTimestamp=e,n.props.sketch.frameCount++,n.props.sketch.timeElapsed=e;try{n.props.sketch.animate(t)}catch(i){console.error(i)}n.setState({frameCount:n.props.sketch.frameCount}),n.frameId=requestAnimationFrame(n.loop)},n.handleWindowResize=function(){var e=n.props.sketch.renderer;n.updateRendererCanvasToMatchParent(e),null!=n.props.sketch.resize&&n.props.sketch.resize(e.domElement.width,e.domElement.height)},n.state={frameCount:e.sketch.frameCount},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.updateRendererCanvasToMatchParent(this.props.sketch.renderer),window.addEventListener("resize",this.handleWindowResize);var t=this.props.sketch.renderer.domElement;t.tabIndex=1,Object.keys(g).forEach(function(n){if(null!=e.props.sketch.events){var i=e.props.sketch.events[n];null!=i&&(e.props.eventsOnBody?document.body.addEventListener(n,i):t.addEventListener(n,i))}}),this.props.sketch.init(),this.frameId=requestAnimationFrame(this.loop)}},{key:"render",value:function(){var e=[];return null!=this.props.sketch.render&&e.push(this.props.sketch.render()),null!=this.props.sketch.elements&&e.push.apply(e,Object(m.a)(this.props.sketch.elements)),i.createElement("div",{className:"sketch-elements"},e.map(function(e,t){return i.cloneElement(e,{key:t})}))}},{key:"componentWillUnmount",value:function(){var e=this;this.props.sketch.destroy&&this.props.sketch.destroy(),null!=this.frameId&&cancelAnimationFrame(this.frameId),this.props.sketch.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize);var t=this.props.sketch.canvas;Object.keys(g).forEach(function(n){if(null!=e.props.sketch.events){var i=e.props.sketch.events[n];null!=i&&(e.props.eventsOnBody?document.body.removeEventListener(n,i):t.removeEventListener(n,i))}})}},{key:"updateRendererCanvasToMatchParent",value:function(e){var t=e.domElement.parentElement;null!=t&&e.setSize(t.clientWidth,t.clientHeight)}}]),t}(i.Component),M=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).state={status:{type:"loading"},volumeEnabled:JSON.parse(window.localStorage.getItem("sketch-volumeEnabled")||"true")},n.audioContext=void 0,n.userVolume=void 0,n.handleContainerRef=function(e){if(null!=e)try{var t=window.AudioContext||window.webkitAudioContext,i=n.audioContext=new t;y.c.setContext(i),n.userVolume=i.createGain(),n.userVolume.gain.setValueAtTime(.8,0),n.userVolume.connect(i.destination),(i.gain=i.createGain()).connect(n.userVolume),document.addEventListener("visibilitychange",n.handleVisibilityChange);var r=new y.G({alpha:!0,preserveDrawingBuffer:!0,antialias:!0});e.appendChild(r.domElement);var a=new n.props.sketchClass(r,n.audioContext);n.setState({status:{type:"success",sketch:a}})}catch(o){n.setState({status:{type:"error",error:o}}),console.error(o)}else document.removeEventListener("visibilitychange",n.handleVisibilityChange),null!=n.audioContext&&n.audioContext.close()},n.handleVolumeButtonClick=function(){var e=!n.state.volumeEnabled;n.setState({volumeEnabled:e}),window.localStorage.setItem("sketch-volumeEnabled",JSON.stringify(e))},n.handleVisibilityChange=function(){null!=n.audioContext&&(document.hidden?n.audioContext.suspend():n.state.volumeEnabled&&n.audioContext.resume())},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){null!=this.userVolume&&null!=this.audioContext&&(this.state.volumeEnabled&&"suspended"===this.audioContext.state?this.audioContext.resume():this.state.volumeEnabled||"running"!==this.audioContext.state||this.audioContext.suspend());var e=this.props,t=(e.sketchClass,Object(f.a)(e,["sketchClass"])),n=p()("sketch-component",this.state.status.type);return i.createElement("div",Object.assign({},t,{id:this.props.sketchClass.id,className:n,ref:this.handleContainerRef}),this.renderSketchOrStatus(),this.renderVolumeButton())}},{key:"renderSketchOrStatus",value:function(){var e=this.state.status;return"success"===e.type?i.createElement(T,{key:this.props.sketchClass.id,sketch:e.sketch,eventsOnBody:this.props.eventsOnBody}):"error"===e.type?this.props.errorElement||this.renderDefaultErrorElement(e.error.message):"loading"===e.type?null:void 0}},{key:"renderDefaultErrorElement",value:function(e){return i.createElement("p",{className:"sketch-error"},"Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.",i.createElement("pre",null,e))}},{key:"renderVolumeButton",value:function(){var e=this.state.volumeEnabled;return i.createElement("button",{className:"user-volume",onClick:this.handleVolumeButtonClick},e?i.createElement(C.b,null):i.createElement(C.a,null))}}]),t}(i.Component),S=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).handleDivRef=function(e){null!=e||n.exitFullscreen()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.isKiosk,t=!!Object(v.parse)(window.location.search).presentationMode,n=p()("full-page-sketch",{"presentation-mode":t,"kiosk-mode":e});return i.createElement("div",{className:n,ref:this.handleDivRef},i.createElement(M,{sketchClass:this.props.sketchClass}))}},{key:"exitFullscreen",value:function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}}]),t}(i.Component);function R(e,t,n,i,r){return function(e,t,n){return e+(t-e)*n}(i,r,(e-t)/(n-t))}function P(e,t){var n=document.createElement("source");return n.src="/assets/audio/".concat(e,".").concat(t),n.type="audio/".concat(t),n}function N(e,t){var n=document.createElement("audio");n.autoplay=!0,n.loop=!0,n.appendChild(P(t,"ogg")),n.appendChild(P(t,"mp3")),n.appendChild(P(t,"wav"));var i=e.createMediaElementSource(n),r=e.createGain();return i.connect(r),{audio:n,gain:r}}var F=n(30),B=n(21);function D(e){return Math.round(1e12*e)/1e12}var W=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(s.a)(this,e),this.capacity=t,this.carrier=n,this.water=i,this.sugar=r,this.events=void 0,this.validate()}return Object(l.a)(e,[{key:"give",value:function(e,t,n){if(e===this)throw new Error("shouldn't give to self");var i=Math.min(t,this.water),r=Math.min(n,this.sugar),a=D(i+r),o=e.space();return a>o&&(i=Math.floor(i/a*o),r=Math.floor(r/a*o)),this.change(-i,-r),e.change(i,r),this.events&&this.events.emit("give",e,i,r),e.events&&e.events.emit("get",this,i,r),{water:i,sugar:r}}},{key:"on",value:function(e,t){this.events=this.events||new B.EventEmitter,this.events.on(e,t)}},{key:"add",value:function(e,t){var n=D(e+t),i=this.space();n>i&&(e=e/n*i,t=t/n*i),this.change(e,t)}},{key:"change",value:function(e,t){var n=D(this.water+e),i=D(this.sugar+t);this.validate(n,i),this.water=n,this.sugar=i,this.water<0&&(this.water=0),this.sugar<0&&(this.sugar=0),this.water+this.sugar>this.capacity&&(this.water>this.sugar?this.water=this.capacity-this.sugar:this.sugar=this.capacity-this.water)}},{key:"space",value:function(){return D(this.capacity-this.water-this.sugar)}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.water,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sugar,n=this.capacity;e<0&&console.warn("water < 0: ".concat(e)),t<0&&console.warn("sugar < 0: ".concat(t)),e+t>n&&console.warn("bad inventory: ".concat(e," water + ").concat(t," > ").concat(n," max"))}}]),e}();function I(e){return null!=e&&e.inventory instanceof W}var z={nw:new y.E(-1,-1),w:new y.E(-1,0),sw:new y.E(-1,1),n:new y.E(0,-1),s:new y.E(0,1),ne:new y.E(1,-1),e:new y.E(1,0),se:new y.E(1,1)},Y=Object.keys(z).map(function(e){return z[e]}),L=n(9),U=n(10),V=n(7),q=function(){function e(t,n,i){Object(s.a)(this,e),this.x=t,this.y=n,this.z=i}return Object(l.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,n){return this.x*e+this.y*t+this.z*n}}]),e}(),G=[new q(1,1,0),new q(-1,1,0),new q(1,-1,0),new q(-1,-1,0),new q(1,0,1),new q(-1,0,1),new q(1,0,-1),new q(-1,0,-1),new q(0,1,1),new q(0,-1,1),new q(0,1,-1),new q(0,-1,-1)],_=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],H=.5*(Math.sqrt(3)-1),X=(3-Math.sqrt(3))/6,Z=1/6,J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2147483647*Math.random();Object(s.a)(this,e),this.perm=new Array(512),this.gradP=new Array(512),this.octaveNum=6,this.octaveFalloff=.5,this.octaveMatrix2=[2*Math.cos(1),2*-Math.sin(1),2*Math.sin(1),2*Math.cos(1)],this.seed(t)}return Object(l.a)(e,[{key:"seed",value:function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?_[t]^255&e:_[t]^e>>8&255,this.perm[t]=this.perm[t+256]=n,this.gradP[t]=this.gradP[t+256]=G[n%12]}}}]),Object(l.a)(e,[{key:"simplex2",value:function(e,t){var n,i,r=(e+t)*H,a=Math.floor(e+r),o=Math.floor(t+r),s=(a+o)*X,l=e-a+s,u=t-o+s;l>u?(n=1,i=0):(n=0,i=1);var c=l-n+X,h=u-i+X,d=l-1+2*X,p=u-1+2*X;a&=255,o&=255;var v=this.gradP[a+this.perm[o]],f=this.gradP[a+n+this.perm[o+i]],m=this.gradP[a+1+this.perm[o+1]],y=.5-l*l-u*u,g=.5-c*c-h*h,w=.5-d*d-p*p;return 70*((y<0?0:(y*=y)*y*v.dot2(l,u))+(g<0?0:(g*=g)*g*f.dot2(c,h))+(w<0?0:(w*=w)*w*m.dot2(d,p)))}},{key:"octaveSimplex2",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.octaveNum,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveFalloff,r=0,a=e,o=t,s=1,l=0;l<n;l++){r+=this.simplex2(a,o)*s;var u=a*this.octaveMatrix2[0]+o*this.octaveMatrix2[1],c=a*this.octaveMatrix2[2]+o*this.octaveMatrix2[3];a=u,o=c,s*=i}return r}},{key:"simplex3",value:function(e,t,n){var i,r,a,o,s,l,u=(e+t+n)*(1/3),c=Math.floor(e+u),h=Math.floor(t+u),d=Math.floor(n+u),p=(c+h+d)*Z,v=e-c+p,f=t-h+p,m=n-d+p;v>=f?f>=m?(i=1,r=0,a=0,o=1,s=1,l=0):v>=m?(i=1,r=0,a=0,o=1,s=0,l=1):(i=0,r=0,a=1,o=1,s=0,l=1):f<m?(i=0,r=0,a=1,o=0,s=1,l=1):v<m?(i=0,r=1,a=0,o=0,s=1,l=1):(i=0,r=1,a=0,o=1,s=1,l=0);var y=v-i+Z,g=f-r+Z,w=m-a+Z,b=v-o+2*Z,k=f-s+2*Z,E=m-l+2*Z,O=v-1+.5,j=f-1+.5,x=m-1+.5;c&=255,h&=255,d&=255;var A=this.gradP,C=this.perm,T=A[c+C[h+C[d]]],M=A[c+i+C[h+r+C[d+a]]],S=A[c+o+C[h+s+C[d+l]]],R=A[c+1+C[h+1+C[d+1]]],P=.6-v*v-f*f-m*m,N=.6-y*y-g*g-w*w,F=.6-b*b-k*k-E*E,B=.6-O*O-j*j-x*x;return 32*((P<0?0:(P*=P)*P*T.dot3(v,f,m))+(N<0?0:(N*=N)*N*M.dot3(y,g,w))+(F<0?0:(F*=F)*F*S.dot3(b,k,E))+(B<0?0:(B*=B)*B*R.dot3(O,j,x)))}},{key:"octaveSimplex3",value:function(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveNum,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.octaveFalloff,a=0,o=e,s=t,l=n,u=1,c=0;c<i;c++)a+=this.simplex3(o,s,l)*u,o*=2,s*=2,l*=2,u*=r;return a}},{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,n){return(1-n)*e+n*t}},{key:"perlin2",value:function(e,t){var n=Math.floor(e),i=Math.floor(t);e-=n,t-=i,n&=255,i&=255;var r=this.gradP,a=this.perm,o=r[n+a[i]].dot2(e,t),s=r[n+a[i+1]].dot2(e,t-1),l=r[n+1+a[i]].dot2(e-1,t),u=r[n+1+a[i+1]].dot2(e-1,t-1),c=this.fade(e);return this.lerp(this.lerp(o,l,c),this.lerp(s,u,c),this.fade(t))}},{key:"perlin3",value:function(e,t,n){var i=this.gradP,r=this.perm,a=Math.floor(e),o=Math.floor(t),s=Math.floor(n);e-=a,t-=o,n-=s;var l=i[(a&=255)+r[(o&=255)+r[s&=255]]].dot3(e,t,n),u=i[a+r[o+r[s+1]]].dot3(e,t,n-1),c=i[a+r[o+1+r[s]]].dot3(e,t-1,n),h=i[a+r[o+1+r[s+1]]].dot3(e,t-1,n-1),d=i[a+1+r[o+r[s]]].dot3(e-1,t,n),p=i[a+1+r[o+r[s+1]]].dot3(e-1,t,n-1),v=i[a+1+r[o+1+r[s]]].dot3(e-1,t-1,n),f=i[a+1+r[o+1+r[s+1]]].dot3(e-1,t-1,n-1),m=this.fade(e),y=this.fade(t),g=this.fade(n);return this.lerp(this.lerp(this.lerp(l,d,m),this.lerp(u,p,m),g),this.lerp(this.lerp(c,v,m),this.lerp(h,f,m),g),y)}}]),e}(),Q=n(15),K={isRealtime:!0,environment:"Temperate",cellEnergyMax:2e4,tissueInventoryCapacity:10,rootTurnsPerTransfer:20,leafReactionRate:.015,leafSugarPerReaction:1,cellGestationTurns:0,cellDiffusionWater:0,cellDiffusionSugar:0,soilDarknessBase:.2,soilDiffusionType:"discrete",soilDiffusionWater:.001,veinDiffusion:.5,soilMaxWater:20,droop:.03,fountainTurnsPerWater:11,fountainAppearanceRate:1.5,transportTurnsPerMove:5,sunlightReintroduction:.15,sunlightDiffusion:0,maxResources:100},$=Object(Q.a)({},K);if(window.location.hash.length>0){var ee=JSON.parse(decodeURI(window.location.hash.substr(1)));Object.assign($,ee)}function te(){for(var e={},t=0,n=Object.keys(K);t<n.length;t++){var i=n[t],r=$[i];r!==K[i]&&(e[i]=r)}Object.keys(e).length>0?window.location.hash=encodeURI(JSON.stringify(e)):window.location.hash=""}function ne(e){return"number"===typeof e.energy}te();var ie=function(){function e(t,n){if(Object(s.a)(this,e),this.world=n,this.isObstacle=!1,this.darkness=1/0,this.pos=void 0,this.pos=t.clone(),null==n)throw new Error("null world!")}return Object(l.a)(e,[{key:"diffusionWater",get:function(){return this.constructor.diffusionWater}},{key:"diffusionSugar",get:function(){return this.constructor.diffusionSugar}},{key:"fallAmount",get:function(){return this.constructor.fallAmount}}]),Object(l.a)(e,[{key:"lightAmount",value:function(){return Math.sqrt(Math.min(Math.max(R(1-this.darkness,0,1,0,1),0),1))}},{key:"step",value:function(){var e=this.world.tileNeighbors(this.pos);this.stepDarkness(e),this.stepDiffusion(e),this.stepGravity()}},{key:"stepDarkness",value:function(e){if(this instanceof he)this.darkness=0;else{var t=this.darkness,n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=Object(V.a)(s,2)[1],u=Math.max(.2,R(this.pos.y,Ot/2,Ot,$.soilDarknessBase,1)),c=l instanceof le?1/0:l.darkness+u;t=l instanceof he?0:Math.min(t,c)}}catch(d){i=!0,r=d}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}this.darkness=t;var h=null!=this.world.cellAt(this.pos.x,this.pos.y);h&&console.error("stepping environmental tile even when a cell is on-top:",h)}}},{key:"stepDiffusion",value:function(e){if(I(this)){var t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,s=Object(V.a)(o,2),l=s[0],u=s[1];this.canDiffuse(l,u)&&(null!=this.diffusionWater&&u.inventory.water>this.inventory.water&&this.diffuseWater(u),null!=this.diffusionSugar&&u.inventory.sugar>this.inventory.sugar&&this.diffuseSugar(u))}}catch(c){n=!0,i=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}}},{key:"canDiffuse",value:function(e,t){return re(this,t)}},{key:"diffuseWater",value:function(e){if(I(this))if("continuous"===$.soilDiffusionType){var t=(e.inventory.water-this.inventory.water)*this.diffusionWater;e.inventory.give(this.inventory,t,0)}else{var n=e.inventory.water-this.inventory.water,i=Math.min(n,1);Math.random()<n*this.diffusionWater*i&&e.inventory.give(this.inventory,1,0)}}},{key:"diffuseSugar",value:function(e){if(I(this)){var t=(e.inventory.sugar-this.inventory.sugar)*this.diffusionSugar;e.inventory.give(this.inventory,0,t)}}},{key:"stepGravity",value:function(){var e=this.fallAmount,t=this.world.tileAt(this.pos.x,this.pos.y+1);e>0&&this.world.time%Math.floor(1/e)<1&&I(t)&&re(t,this)&&this.inventory.give(t.inventory,1,0)}}]),e}();function re(e,t){return I(e)&&I(t)&&(e instanceof t.constructor||t instanceof e.constructor||e instanceof he&&t instanceof he||function(e,t,n,i){return e instanceof t&&n instanceof i}(e,se,t,oe))}ie.displayName="Tile",ie.fallAmount=0;var ae=new J,oe=function(e){function t(e,n){var i;return Object(s.a)(this,t),(i=Object(u.a)(this,Object(c.a)(t).call(this,e,n))).pos=e,i.sunlightCached=1,i._co2=void 0,i.inventory=new W(20,Object(L.a)(i)),i.darkness=0,i._co2=i.computeCo2(),i}return Object(h.a)(t,e),Object(l.a)(t,[{key:"computeCo2",value:function(){var e=R(this.pos.y,Ot/2,0,this.world.environment.floorCo2,1.15),t=R(this.pos.y,Ot/2,0,4,9),n=null==this.world?0:this.world.time,i=.25*ae.perlin3(94.231+(this.pos.x-Et/2)/t,2312+this.pos.y/8,n/1e3+93.1);return Math.max(Math.min(e+i,1),Math.min(.4,.75*this.world.environment.floorCo2))}},{key:"lightAmount",value:function(){return this.sunlight()}},{key:"step",value:function(){this.stepGravity(),this.stepDiffusion(this.world.tileNeighbors(this.pos)),this._co2=this.computeCo2()}},{key:"canDiffuse",value:function(e,n){return e!==z.s&&e!==z.sw&&e!==z.se&&Object(U.a)(Object(c.a)(t.prototype),"canDiffuse",this).call(this,e,n)}},{key:"co2",value:function(){return this._co2}},{key:"sunlight",value:function(){return this.sunlightCached}}]),t}(ie);oe.displayName="Air",oe.fallAmount=1,oe.diffusionWater=.1;var se=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e,r))).inventory=new W($.soilMaxWater,Object(L.a)(n)),n.inventory.add(i,0),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"fallAmount",get:function(){return this.world.environment.waterGravityPerTurn}}]),Object(l.a)(t,[{key:"step",value:function(){Object(U.a)(Object(c.a)(t.prototype),"step",this).call(this),this.stepEvaporation()}},{key:"stepEvaporation",value:function(){var e=this.world.environment,t=e.evaporationRate,n=e.evaporationBottom,i=R(this.pos.y,Ot/2,Ot*n,1,0),r=this.inventory.water;Math.random()<t*i*r&&this.inventory.add(-1,0)}}]),t}(ie);se.displayName="Soil",se.diffusionWater=$.soilDiffusionWater;var le=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).isObstacle=!0,n}return Object(h.a)(t,e),t}(ie);le.displayName="Rock";var ue=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),t}(ie);ue.displayName="Dead Cell";var ce=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e,i,r))).turnsPerWater=a,n.isObstacle=!0,n.cooldown=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(U.a)(Object(c.a)(t.prototype),"step",this).call(this),this.cooldown>0&&this.cooldown--,this.inventory.space()>1&&this.cooldown<=0&&(this.inventory.add(1,0),this.cooldown=this.turnsPerWater)}}]),t}(se);ce.displayName="Fountain";var he=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).energy=$.cellEnergyMax,n.darkness=0,n.droopY=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(U.a)(Object(c.a)(t.prototype),"step",this).call(this),this.energy-=1;var e=this.world.tileNeighbors(this.pos),n=Array.from(e.values()),i=[].concat(Object(m.a)(n),[this]),r=!0,a=!1,o=void 0;try{for(var s,l=i[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value;if(I(u)&&!(u instanceof me)){if(!(this.energy<$.cellEnergyMax))break;var h=$.cellEnergyMax-this.energy,d=Math.min(h/$.cellEnergyMax,u.inventory.sugar);u.inventory.add(0,-d);var p=d*$.cellEnergyMax;this.energy+=p}}}catch(O){a=!0,o=O}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}if(this.energy<$.cellEnergyMax){var v=i.filter(function(e){return ne(e)}),f=!0,y=!1,g=void 0;try{for(var w,b=v[Symbol.iterator]();!(f=(w=b.next()).done);f=!0){var k=w.value;if(!(this.energy<$.cellEnergyMax))break;var E=0;if(k.energy>this.energy){if(E=Math.floor(.25*(k.energy-this.energy)),k.energy-E<0)throw new Error("cell energy diffusion: taking more energy than available");if(this.energy+E>$.cellEnergyMax)throw new Error("cell energy diffusion: taking more energy than i can carry");this.energy+=E,k.energy-=E}}}catch(O){y=!0,g=O}finally{try{f||null==b.return||b.return()}finally{if(y)throw g}}}this.stepDroop(e),this.droopY>.5&&(this.world.player.pos.equals(this.pos)&&(this.world.player.pos.y+=1),this.world.maybeRemoveCellAt(this.pos),this.pos.y<Ot-1&&(this.pos.y+=1),this.droopY-=1,this.world.setTileAt(this.pos,this)),this.energy<=0&&this.world.setTileAt(this.pos,new ue(this.pos,this.world))}},{key:"stepDroop",value:function(e){var n=e.get(z.s),i=e.get(z.sw),r=e.get(z.se),a=e.get(z.w),o=e.get(z.e),s=e.get(z.n),l=e.get(z.nw),u=e.get(z.ne);this.droopY+=$.droop,this.energy<$.cellEnergyMax/2&&(this.droopY+=$.droop);for(var c=!1,h=0,d=[n,i,r];h<d.length;h++){var p=d[h];if(p instanceof le||p instanceof se)return void(this.droopY=Math.min(this.droopY,0));if(p instanceof t)return this.droopY=Math.min(this.droopY,p.droopY),void(c=!0)}var v=[l,s,u,a,o,this].filter(function(e){return e instanceof t});c||1!==v.length?this.droopY=v.reduce(function(e,t){return e+t.droopY},0)/v.length:this.droopY+=1}}]),t}(ie);he.displayName="Cell",he.diffusionWater=$.cellDiffusionWater,he.diffusionSugar=$.cellDiffusionSugar,he.turnsToBuild=$.cellGestationTurns;var de=function(e){function t(e,n,i){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n))).completedCell=i,r.isObstacle=!0,r.timeRemaining=void 0,r.timeToBuild=void 0,r.timeRemaining=r.timeToBuild=i.constructor.turnsToBuild||0,r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(U.a)(Object(c.a)(t.prototype),"step",this).call(this),this.timeRemaining--,this.timeRemaining<=0&&this.world.setTileAt(this.completedCell.pos,this.completedCell)}}]),t}(he),pe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).inventory=new W($.tissueInventoryCapacity,Object(L.a)(n)),n}return Object(h.a)(t,e),t}(he);pe.displayName="Tissue";var ve=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).isObstacle=!0,n.averageEfficiency=0,n.averageSpeed=0,n.didConvert=!1,n.sugarConverted=0,n.tilePairs=[],n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(U.a)(Object(c.a)(t.prototype),"step",this).call(this),this.didConvert=!1;var e=this.world.tileNeighbors(this.pos);this.averageEfficiency=0,this.averageSpeed=0,this.sugarConverted=0;var n=0;this.tilePairs=[];var i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value,u=Object(V.a)(l,2),h=u[0],d=u[1],p=this.world.tileAt(this.pos.x-h.x,this.pos.y-h.y);if(d instanceof oe&&p instanceof pe){n+=1,this.tilePairs.push(h);var v=d,f=p,m=v.sunlight(),y=v.co2();this.averageEfficiency+=y,this.averageSpeed+=m;var g=$.leafSugarPerReaction/y,w=Math.min(f.inventory.water,g),b=m*$.leafReactionRate*w/g;if(Math.random()<b){this.didConvert=!0;var k=w*y;f.inventory.add(-w,k),this.sugarConverted+=k}}}}catch(E){r=!0,a=E}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}n>0&&(this.averageEfficiency/=n)}}]),t}(he);ve.displayName="Leaf";var fe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).waterTransferAmount=0,n.activeNeighbors=[],n.inventory=new W(20,Object(L.a)(n)),n.cooldown=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(U.a)(Object(c.a)(t.prototype),"step",this).call(this),this.cooldown<=0&&(this.stepWaterTransfer(),this.cooldown+=$.rootTurnsPerTransfer),this.cooldown-=1}},{key:"stepWaterTransfer",value:function(){this.waterTransferAmount=0,this.activeNeighbors=[];var e=this.world.tileNeighbors(this.pos),t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,s=Object(V.a)(o,2),l=s[0],u=s[1];if(u instanceof se){this.activeNeighbors.push(l);var c=u.inventory.give(this.inventory,1,0).water;this.waterTransferAmount+=c+1e-4*Math.random()}}}catch(h){n=!0,i=h}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}}]),t}(he);fe.displayName="Root";var me=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).isObstacle=!0,n.inventory=new W(t.sugarToWin+100,Object(L.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(U.a)(Object(c.a)(t.prototype),"step",this).call(this);var e=this.world.tileNeighbors(this.pos),n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=Object(V.a)(s,2)[1];I(l)&&l.inventory.give(this.inventory,0,l.inventory.sugar)}}catch(u){i=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}}]),t}(he);me.displayName="Fruit",me.sugarToWin=200;var ye=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).dir=void 0,n.cooldown=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){if(this.energy-=1,Object(U.a)(Object(c.a)(t.prototype),"step",this).call(this),this.cooldown<=0){this.cooldown+=$.transportTurnsPerMove;var e=this.getTarget();e&&this.inventory.give(e.inventory,1,1);var n=this.getFrom();n&&n.inventory.give(this.inventory,1,1)}this.cooldown-=1}},{key:"getTarget",value:function(){var e=this.world.tileAt(this.pos.x+this.dir.x,this.pos.y+this.dir.y);if(e instanceof he&&I(e))return e}},{key:"getFrom",value:function(){var e=this.world.tileAt(this.pos.x-this.dir.x,this.pos.y-this.dir.y);if(e instanceof he&&I(e))return e}}]),t}(pe);ye.displayName="Transport";var ge=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).inventory=new W(8,Object(L.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"diffusionWater",get:function(){return $.veinDiffusion}},{key:"diffusionSugar",get:function(){return $.veinDiffusion}}]),t}(pe);ge.displayName="Vein";var we={j:{type:"drop",sugar:0,water:10},k:{type:"drop",sugar:10,water:0},".":{type:"still"}},be={w:{type:"move",dir:z.n},a:{type:"move",dir:z.w},s:{type:"move",dir:z.s},d:{type:"move",dir:z.e},q:{type:"move",dir:z.nw},e:{type:"move",dir:z.ne},z:{type:"move",dir:z.sw},c:{type:"move",dir:z.se}},ke=Object.keys(be).map(function(e){return be[e]}),Ee={u:pe,l:ve,o:fe,p:ye,i:me},Oe=function(){function e(t,n){Object(s.a)(this,e),this.pos=t,this.world=n,this.inventory=new W($.maxResources,this,Math.round($.maxResources/3),Math.round($.maxResources/3)),this.action=void 0,this.events=new B.EventEmitter,this.actionQueue=[],this.mapActions=void 0}return Object(l.a)(e,[{key:"setActions",value:function(e){this.actionQueue=e}},{key:"setAction",value:function(e){this.action=e,this.actionQueue=[]}},{key:"getAction",value:function(){return this.action}},{key:"droopY",value:function(){var e=this.world.tileAt(this.pos.x,this.pos.y);return e instanceof he?e.droopY:0}},{key:"droopPos",value:function(){var e=this.droopY();if(0!==e){var t=this.pos.clone();return t.y+=e,t}return this.pos}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"step",value:function(){if(void 0===this.action&&(this.action=this.actionQueue.shift()||{type:"none"}),this.mapActions){var e=this.mapActions(this,this.action);if(Array.isArray(e)){var t,n=Object(F.a)(e),i=n[0],r=n.slice(1);this.action=i,(t=this.actionQueue).unshift.apply(t,Object(m.a)(r))}else this.action=null!=e?e:{type:"none"}}this.attemptAction(this.action)&&this.events.emit("action",this.action),this.action=void 0}},{key:"attemptAction",value:function(e){switch(e.type){case"none":return!0;case"still":return this.attemptStill();case"move":return this.attemptMove(e);case"build":return this.attemptBuild(e);case"build-transport":return this.attemptBuildTransport(e);case"deconstruct":return this.attemptDeconstruct(e);case"drop":return this.attemptDrop(e);case"multiple":return this.attemptMultiple(e)}}},{key:"verifyMove",value:function(e){var t=this.pos.clone().add(e.dir);return this.isWalkable(t)}},{key:"isWalkable",value:function(e){if(e instanceof ie&&(e=e.pos),!this.world.isValidPosition(e.x,e.y))return!1;var t=this.world.tileAt(e.x,e.y);return t instanceof he&&null!=t&&!t.isObstacle}},{key:"isBuildCandidate",value:function(e){if(null==e||this.isWalkable(e)||e.isObstacle)return!1;var t=e.pos.clone().sub(this.pos);return null!=ke.find(function(e){return e.dir.equals(t)})}},{key:"attemptMove",value:function(e){return!!this.verifyMove(e)&&(O.audio.currentTime=.05*Math.random(),O.gain.gain.cancelScheduledValues(0),O.gain.gain.value=1,O.gain.gain.linearRampToValueAtTime(0,O.gain.context.currentTime+.05),this.pos.add(e.dir),this.autopickup(),!0)}},{key:"attemptStill",value:function(){return this.autopickup(),!0}},{key:"autopickup",value:function(){var e=this.currentTile();if(I(e)){var t=e.inventory;t.give(this.inventory,t.water,t.sugar)}}},{key:"tryConstructingNewCell",value:function(e,t){e=e.clone();var n=this.world.tileAt(e.x,e.y);if(null!=n&&(null==this.world.fruit||t!==me)&&!(n instanceof me)){if(!(n instanceof t&&!(t===ye&&n instanceof ye))&&!n.isObstacle&&this.inventory.water>=1&&this.inventory.sugar>=1){this.inventory.add(-1,-1);var i=new t(e,this.world);return j.audio.currentTime=0,j.gain.gain.cancelScheduledValues(0),j.gain.gain.value=.2,j.gain.gain.exponentialRampToValueAtTime(1e-4,j.gain.context.currentTime+.5),i}}}},{key:"attemptBuild",value:function(e){var t=this.world.cellAt(e.position.x,e.position.y);if(null!=t&&t.constructor===e.cellType)return!0;t&&this.attemptDeconstruct({type:"deconstruct",position:e.position,force:!0});var n,i=this.tryConstructingNewCell(e.position,e.cellType);return null!=i&&((n=e.cellType.turnsToBuild?new de(e.position,this.world,i):i).droopY=this.droopY(),this.world.setTileAt(e.position,n),this.isWalkable(n)&&this.attemptMove({type:"move",dir:e.position.clone().sub(this.pos)}),!0)}},{key:"attemptBuildTransport",value:function(e){if(null==e.dir)return console.error("null dir",e),!0;this.world.cellAt(e.position.x,e.position.y)&&this.attemptDeconstruct({type:"deconstruct",position:e.position,force:!0});var t=this.tryConstructingNewCell(e.position,e.cellType);return null!=t&&(t.dir=e.dir,this.world.setTileAt(e.position,t),this.attemptMove({type:"move",dir:e.dir}),!0)}},{key:"attemptDeconstruct",value:function(e){if(!e.position.equals(this.pos)||e.force){var t=this.world.maybeRemoveCellAt(e.position);if(null!=t){var n=t.energy/$.cellEnergyMax;return this.inventory.add(n,n),I(t)&&t.inventory.give(this.inventory,t.inventory.water,t.inventory.sugar),!0}}return!1}},{key:"attemptDrop",value:function(e){var t=this.currentTile();if(I(t)){var n=e.water,i=e.sugar;return t.inventory.give(this.inventory,i,n),this.inventory.give(t.inventory,n,i),!0}return!1}},{key:"attemptMultiple",value:function(e){var t=!0,n=!0,i=!1,r=void 0;try{for(var a,o=e.actions[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t=this.attemptAction(s)&&t}}catch(l){i=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return t}}]),e}(),je=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(s.a)(this,e),this.deleted=t,this.added=n},xe=function(){function e(t){var n=this;Object(s.a)(this,e),this.environment=t,this.time=0,this.player=new Oe(new y.E(Et/2,Ot/2),this),this.fruit=void 0,this.gridEnvironment=void 0,this.gridCells=void 0,this.neighborCache=void 0,this.cachedEntities=void 0,this.stepStats=new je,this.gridEnvironment=new Array(Et).fill(void 0).map(function(e,i){return new Array(Ot).fill(void 0).map(function(e,r){var a,o=new y.E(i,r),s=!0,l=!1,u=void 0;try{for(var c,h=t.fill[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=(0,c.value)(o,n);if(null!=d){a=d;break}}}catch(p){l=!0,u=p}finally{try{s||null==h.return||h.return()}finally{if(l)throw u}}return null==a&&(a=new oe(o,n)),a})});var i=this.player.pos.x,r=this.gridEnvironment[i].find(function(e){return!(e instanceof oe)});r&&(this.player.pos.y=r.pos.y);this.gridCells=new Array(Et).fill(void 0).map(function(e,t){return new Array(Ot).fill(void 0).map(function(e,i){var r=new y.E(t,i);return n.player.pos.distanceTo(r)<2.5?(n.gridEnvironment instanceof le&&(n.gridEnvironment[t][i]=new se(new y.E(t,i),0,n)),new pe(r,n)):null})}),this.neighborCache=new Array(Et).fill(void 0).map(function(e,t){return new Array(Ot).fill(void 0).map(function(e,i){return n.computeTileNeighbors(t,i)})}),this.fillCachedEntities()}return Object(l.a)(e,[{key:"tileAt",value:function(e,t){var n;if(e instanceof y.E?(n=e.x,t=e.y):(n=e,t=t),!this.isValidPosition(n,t))return null;var i=this.gridCells[n][t];return null!=i?i:this.gridEnvironment[n][t]}},{key:"cellAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridCells[e][t]:null}},{key:"environmentTileAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridEnvironment[e][t]:null}},{key:"setTileAt",value:function(e,t){var n=e.x,i=e.y;if(!this.isValidPosition(n,i))throw new Error("invalid position ".concat(n,", ").concat(i," "));t instanceof me&&(null==this.fruit?this.fruit=t:console.warn("made multiple Fruit!"));var r=this.tileAt(n,i);I(r)&&(I(t)&&r.inventory.give(t.inventory,r.inventory.water,r.inventory.sugar),0===r.inventory.water&&0===r.inventory.sugar||(console.warn("lost",r.inventory,"resources to building"),r.inventory.add(-r.inventory.water,-r.inventory.sugar)));var a=this.gridCells[n][i];if(null!=a&&this.stepStats.deleted.push(a),t instanceof he)this.gridCells[n][i]=t;else{this.gridCells[n][i]=null;var o=this.gridEnvironment[n][i];null!=o&&this.stepStats.deleted.push(o),this.gridEnvironment[n][i]=t}this.stepStats.added.push(t),this.handleTileUpdated(e)}},{key:"maybeRemoveCellAt",value:function(e){var t=this.cellAt(e.x,e.y);return t&&(this.gridCells[e.x][e.y]=null,t===this.fruit&&(this.fruit=void 0),this.stepStats.deleted.push(t)),this.handleTileUpdated(e),t}},{key:"isValidPosition",value:function(e,t){return!(e>=Et||e<0||t>=Ot||t<0)}},{key:"tileNeighbors",value:function(e){return this.neighborCache[e.x][e.y]}},{key:"computeTileNeighbors",value:function(e,t){var n=this,i=new Map;return Ce[this.time%Ce.length].forEach(function(r){var a=e+r.x,o=t+r.y,s=n.tileAt(a,o);null!=s&&i.set(r,s)}),i}},{key:"entities",value:function(){if(null==this.cachedEntities)throw new Error("accessed entities before filling");return this.cachedEntities}},{key:"handleTileUpdated",value:function(e){this.neighborCache[e.x][e.y]=this.computeTileNeighbors(e.x,e.y);var t=!0,n=!1,i=void 0;try{for(var r,a=Y[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,s=e.x+o.x,l=e.y+o.y;this.isValidPosition(s,l)&&(this.neighborCache[s][l]=this.computeTileNeighbors(s,l))}}catch(u){n=!0,i=u}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}this.fillCachedEntities()}},{key:"fillCachedEntities",value:function(){var e=[],t=0,n=0;for(t=0;t<Et;t++)for(n=(t+this.time)%2;n<Ot;n+=2)e.push(this.tileAt(t,n));for(t=0;t<Et;t++)for(n=(t+this.time+1)%2;n<Ot;n+=2)e.push(this.tileAt(t,n));this.time%4<2&&e.reverse(),e.push(this.player),this.cachedEntities=e}},{key:"step",value:function(){var e=this.entities();return this.stepStats=new je,e.forEach(function(e){"function"===typeof e.step&&e.step()}),this.computeSunlight(),this.stepWeather(),this.time++,this.fillCachedEntities(),this.stepStats}},{key:"stepWeather",value:function(){if((this.time+this.environment.climate.turnsBetweenRainfall-200)%this.environment.climate.turnsBetweenRainfall<this.environment.climate.rainDuration){var e=y.p.randInt(0,Et-1),t=this.tileAt(e,0);t instanceof oe&&t.inventory.add(this.environment.climate.waterPerDroplet,0)}}},{key:"computeSunlight",value:function(){for(var e=this.time*Math.PI*2/1e3,t=Math.sin(e+Math.PI/2),n=Math.atan(12*Math.sin(e))/(Math.PI/2)*.5+.5,i=0;i<=.6*Ot;i++)for(var r=0;r<Et;r++){var a=this.environmentTileAt(r,i);if(a instanceof oe){var o=0;if(0===i)o=1;else{var s=this.tileAt(r,i-1),l=this.tileAt(r+1,i-1),u=this.tileAt(r-1,i-1),c=s instanceof oe?s.sunlightCached/n:null==s?1:0,h=l instanceof oe?l.sunlightCached/n:null==l?1:0,d=u instanceof oe?u.sunlightCached/n:null==u?1:0;o=(o=t>0?h*t+c*(1-t):d*-t+c*(1- -t))*(1-$.sunlightDiffusion)+(c+h+d)/3*$.sunlightDiffusion}o=$.sunlightReintroduction+o*(1-$.sunlightReintroduction),o*=n,a.sunlightCached=o}}}},{key:"checkWinLoss",value:function(){return null!=this.fruit&&this.fruit.inventory.sugar>me.sugarToWin?"win":this.tileAt(this.player.pos.x,this.player.pos.y)instanceof ue?"lose":null}},{key:"checkResources",value:function(){this.entities().forEach(function(e){I(e)&&(e.inventory.sugar,e.inventory.water),ne(e)&&e.energy})}}]),e}();function Ae(e){for(var t,n,i=e.length;0!==i;)n=Math.floor(Math.random()*i),t=e[i-=1],e[i]=e[n],e[n]=t;return e}var Ce=[Ae(Y.slice()),Ae(Y.slice()),Ae(Y.slice()),Ae(Y.slice()),Ae(Y.slice())];function Te(e){var t;return function(){return void 0===t&&(t=e()),t}}var Me=Te(function(){var e=new J,t=new J,n=new J;return{climate:{turnsBetweenRainfall:800,rainDuration:50,waterPerDroplet:2},evaporationRate:2e-4,evaporationBottom:.6,floorCo2:.5,waterGravityPerTurn:.001,fill:[function(i,r){var a=i.x,o=i.y,s=Ot/2-4*(n.perlin2(0,a/5)+1)/2-16*n.perlin2(10,a/20+10),l=R(o-Ot/2,0,Ot/2,-.7,.3),u=t.simplex2(a/5,o/5)<l;if(o>s){if(u)return new le(i,r);var c=Math.pow(R(o-Ot/2,0,Ot/2,.5,1),2),h=e.simplex2(.2*a,.2*o)+.2,d=Math.round(Math.max(1,Math.min(20,h>.4?20*c:0)));if(c*h>1/$.fountainAppearanceRate){var p=Math.min(c*h,1);return new ce(i,d,r,Math.round($.fountainTurnsPerWater/p))}return new se(i,d,r)}}]}}),Se=Te(function(){var e=new J,t=new J;return{climate:{rainDuration:220,turnsBetweenRainfall:3e3,waterPerDroplet:8},evaporationRate:.002,evaporationBottom:.7,waterGravityPerTurn:.02,floorCo2:.95,fill:[function(n,i){var r=n.x,a=n.y,o=Ot/2-2*(e.perlin2(0,r/20)+1)/2-3*e.perlin2(10,r/100+10),s=R(a,Ot/2,Ot,-.8,-.4),l=t.simplex2(r/4,a/4)<s;if(a>o){if(l)return new le(n,i);var u=Math.floor(Math.max(0,R(a,.75*Ot,Ot,1,9)));return new se(n,u,i)}}]}}),Re=Te(function(){var e=new J,t=new J;return{climate:{turnsBetweenRainfall:1200,rainDuration:120,waterPerDroplet:3},waterGravityPerTurn:.1,evaporationBottom:.6,evaporationRate:.001,floorCo2:1,fill:[function(n,i){var r=n.x,a=n.y,o=.55*Ot-4*(t.perlin2(0,r/5)+1)/2-16*t.perlin2(10,r/20+10)-R(r,0,Et,10,-10),s=a-6*(t.perlin2(0,r/25)+1)/2-20*t.perlin2(10,r/150+10)<.5*Ot?-1:-.15;return e.simplex2(r/10,a/10)<s?new le(n,i):a>o?new se(n,3,i):void 0}]}}),Pe={Temperate:Me,Desert:Se,Rocky:Re},Ne=n(22);function Fe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Ie(function(t,n,i){var r=e.tileAt(t,n);null!=r&&e.player.isWalkable(r)&&i.setWalkableAt(t,n,!0)});i.setWalkableAt(t.x,t.y,!0);var r=We(i,e.player.pos,t);return e.tileAt(t)instanceof he||n?r:(r.pop(),r)}function Be(e,t){return We(Ie(function(t,n,i){var r=e.tileAt(t,n);(r instanceof pe||!(r instanceof he)&&!r.isObstacle)&&i.setWalkableAt(t,n,!0)}),e.player.pos,t)}function De(e){for(var t=[],n=0;n<e.length-1;n++){var i=Object(V.a)(e[n],2),r=i[0],a=i[1],o=Object(V.a)(e[n+1],2),s=ze(r,a,o[0],o[1]);if(null==s)throw new Error("couldn't find corresponding movement action");t.push(s)}return t}function We(e,t,n){return new Ne.AStarFinder({diagonalMovement:Ne.DiagonalMovement.Always}).findPath(t.x,t.y,n.x,n.y,e)}function Ie(e){for(var t=new Ne.Grid(Et,Ot),n=0;n<Et;n++)for(var i=0;i<Ot;i++)t.setWalkableAt(n,i,!1);for(var r=0;r<Et;r++)for(var a=0;a<Ot;a++)e(r,a,t);return t}function ze(e,t,n,i){var r=n-e,a=i-t;return ke.find(function(e){var t=e.dir;return t.x===r&&t.y===a})}var Ye=16,Le=!1,Ue=Te(function(){return(new y.D).load("assets/images/roguelikeSheet_transparent.png",function(){Ue().dispatchEvent({type:"update"}),Le=!0})}),Ve=(new y.D).load("assets/images/fruit.png"),qe={};function Ge(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";e=Math.floor(e),t=Math.floor(t);var i="".concat(e,",").concat(t);if(null==qe[i]){var r=function(){var i=Ue().image,r=a.getContext("2d");r.fillStyle=n,r.fillRect(0,0,Ye,16),r.drawImage(i,Ye*e,Ye*t,Ye,Ye,0,0,Ye,Ye),o.needsUpdate=!0},a=document.createElement("canvas");a.width=Ye,a.height=Ye;var o=new y.C(a);o.magFilter=y.s,o.flipY=!0,o.wrapS=y.z,o.wrapT=y.z,Le?r():Ue().addEventListener("update",function(){r()}),qe[i]=o}return qe[i]}var _e=function e(t,n,i){Object(s.a)(this,e),this.target=t,this.scene=n,this.mito=i},He=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this))).geometry=void 0,n.material=void 0,n.index=0,n.geometry=t.newGeometry(),n.material=new Xe(e),n.frustumCulled=!1,n}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"newGeometry",value:function(){var e=new y.g,n=new Float32Array(3*t.BUFFER_SIZE),i=new Float32Array(t.BUFFER_SIZE);return e.addAttribute("position",new y.f(n,3).setDynamic(!0)),e.addAttribute("size",new y.f(i,1).setDynamic(!0)),e}}]),Object(l.a)(t,[{key:"startFrame",value:function(){this.index=0}},{key:"commit",value:function(e,t,n,i){this.geometry.attributes.position.setXYZ(this.index,e,t,n),this.geometry.attributes.size.setX(this.index,i),this.index++}},{key:"endFrame",value:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.setDrawRange(0,this.index)}}]),t}(y.x);He.BUFFER_SIZE=1e5;var Xe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,{uniforms:{opacity:{value:e.opacity},sizeGlobal:{value:e.size},color:{value:e.color},map:{value:e.map}},vertexShader:Ze,fragmentShader:Je,depthTest:!1,transparent:!0}))).params=e,n.map=void 0,n.map=e.map,n}return Object(h.a)(t,e),t}(y.B),Ze="\nattribute float size;\nuniform float sizeGlobal;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",Je="\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\n#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n\nvoid main() {\n    gl_FragColor = vec4( color, opacity );\n\n    #ifdef USE_MAP\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\n        gl_FragColor *= mapTexelToLinear( mapTexel );\n    #endif\n}\n",Qe=function(e){function t(e,n,i){var r;Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n,i))).animationOffset=0,r.waters=[],r.sugars=[],r.handleGetResources=function(e){for(var t=Math.ceil(r.target.water);r.waters.length<t;){var n=e.carrier.pos.clone().sub(r.target.carrier.pos);n.x+=.1*(Math.random()-.5),n.y+=.1*(Math.random()-.5),r.waters.push(n)}for(t=Math.ceil(r.target.sugar);r.sugars.length<t;){var i=e.carrier.pos.clone().sub(r.target.carrier.pos);i.x+=.1*(Math.random()-.5),i.y+=.1*(Math.random()-.5),r.sugars.push(i)}},r.handleGiveResources=function(){var e=Math.ceil(r.target.water);r.waters.length>e&&r.waters.splice(e,r.waters.length-e),e=Math.ceil(r.target.sugar),r.sugars.length>e&&r.sugars.splice(e,r.sugars.length-e)},e.on("get",r.handleGetResources),e.on("give",r.handleGiveResources);for(var a=0;a<r.target.water;a++)r.waters.push(Ke());for(var o=0;o<r.target.sugar;o++)r.sugars.push(Ke());return r}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"startFrame",value:function(){t.WaterParticles().startFrame(),t.SugarParticles().startFrame()}},{key:"endFrame",value:function(){t.WaterParticles().endFrame(),t.SugarParticles().endFrame()}}]),Object(l.a)(t,[{key:"updateNumParticles",value:function(e){}},{key:"commitParticles",value:function(e,t,n){if(n.length>0){for(var i=0;i<n.length-1;i++){var r=n[i];e.commit(r.x+this.target.carrier.pos.x,r.y+this.target.carrier.pos.y,10,1),t-=1}var a=n[n.length-1],o=t;e.commit(a.x+this.target.carrier.pos.x,a.y+this.target.carrier.pos.y,10,o)}}},{key:"simulateResourcePositions",value:function(){var e=this.waters.concat(this.sugars),t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,s=0,l=0,u=performance.now()/3e3+this.animationOffset;s+=.02*Math.cos(u);var c=.1+.1*o.length();if(s+=-o.x*c,l+=-o.y*c,this.mito.world.player.pos.equals(this.target.carrier.pos)){var h=Math.max(Math.min(R(o.lengthSq(),0,1,3,-5),3),0),d=o.clone().multiplyScalar(.2*h);s+=d.x,l+=d.y}var p=!0,v=!1,f=void 0;try{for(var m,y=e[Symbol.iterator]();!(p=(m=y.next()).done);p=!0){var g=m.value;if(o===g)break;var w=o.x-g.x,b=o.y-g.y,k=w*w+b*b;if(k>0){var E=.003/k;s+=w*E,l+=b*E}}}catch(O){v=!0,f=O}finally{try{p||null==y.return||y.return()}finally{if(v)throw f}}o.x+=s,o.y+=l}}catch(O){n=!0,i=O}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"update",value:function(){this.updateNumParticles(this.target.water),this.updateNumParticles(this.target.sugar),this.simulateResourcePositions(),this.commitParticles(t.WaterParticles(),this.target.water,this.waters),this.commitParticles(t.SugarParticles(),this.target.sugar,this.sugars)}},{key:"destroy",value:function(){}}]),t}(_e);function Ke(){return new y.E(.01*(Math.random()-.5),.01*(Math.random()-.5))}Qe.WaterParticles=Te(function(){return new He({color:new y.i("rgb(9, 12, 255)"),size:45,opacity:.75})}),Qe.SugarParticles=Te(function(){return new He({color:new y.i("yellow"),size:85,opacity:.9,map:Ge(42,12,"transparent")})});var $e=new y.w(1,1);function et(e){var t=document.createElement("canvas");t.width=64,t.height=64;var n=t.getContext("2d");n.font="".concat(32,"px monospace"),n.textAlign="center",n.textBaseline="middle",n.fillStyle="white",n.fillText(e,32,32);var i=new y.h(t);i.flipY=!0;var r=new y.r({map:i,transparent:!0,side:y.j});return new y.q($e,r)}$e.rotateX(Math.PI);var tt=new Map;for(var nt in be)tt.set(nt,et(nt));var it=function(e){function t(e,n,i){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n,i))).mesh=void 0,r.mesh=new y.q(new y.v(1,1),new y.r({transparent:!0,depthWrite:!1,depthTest:!1,map:Ge(29,12,"transparent"),color:new y.i("white"),side:y.j})),jt(r.mesh.position,r.target.pos,1),r.mesh.position.z=2,r.scene.add(r.mesh),r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"update",value:function(){jt(this.mesh.position,this.target.droopPos(),.5),this.mesh.position.z=2;var e=!0,t=!1,n=void 0;try{for(var i,r=tt[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var a=i.value,o=Object(V.a)(a,2),s=o[0],l=o[1],u=be[s],c=this.target.pos.x+u.dir.x,h=this.target.pos.y+u.dir.y;this.target.isBuildCandidate(this.mito.world.tileAt(c,h))&&"main"===this.mito.uiState.type?(this.scene.add(l),l.position.x=c,l.position.y=h,l.position.z=2):this.scene.remove(l)}}catch(d){t=!0,n=d}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(_e),rt=function(e){function t(e){var n,i;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,t.geometry,(i=e.target,ot().get(i.constructor).clone())))).renderer=e,n}return Object(h.a)(t,e),t}(y.q);rt.geometry=new y.v(1,1);var at=function(e){function t(e,n,i){var r;Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n,i))).mesh=void 0,r.inventoryRenderer=void 0,r.originalColor=void 0,r.audio=void 0,r.lastAudioValueTracker=0,r.pairsLines=[],r.growingRenderer=void 0,r.target instanceof de?(r.growingRenderer=new t(r.target.completedCell,r.scene,r.mito),r.mesh=r.growingRenderer.mesh):r.mesh=new rt(Object(L.a)(r)),r.originalColor=r.mesh.material.color.clone(),I(r.target)&&(r.inventoryRenderer=new Qe(r.target.inventory,r.scene,r.mito),r.inventoryRenderer.animationOffset=(r.target.pos.x+r.target.pos.y)/2),r.scene.add(r.mesh);var a=r.target instanceof he?1:0;return r.mesh.position.set(r.target.pos.x,r.target.pos.y,a),r.target instanceof he?r.target.constructor.turnsToBuild||r.mesh.scale.set(.01,.01,1):r.mesh.matrixAutoUpdate=!1,r.mesh.updateMatrix(),(r.target instanceof ve||r.target instanceof fe)&&(r.audio=new y.b(r.mito.audioListener),r.mesh.add(r.audio)),r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"steps",value:function(e,t){return Math.floor(e/t)*t}},{key:"update",value:function(){var e=this;if(this.target instanceof de){var t=R(1.001-this.target.timeRemaining/this.target.timeToBuild,0,1,.2,1);jt(this.mesh.scale,{x:t,y:t},.1)}else jt(this.mesh.scale,new y.E(1,1),.1);var n=this.target.lightAmount(),i=this.mesh.material;if(this.target instanceof oe){var r=Math.max(0,R(this.target.co2(),1/6,1.001,0,st.length-1)),a=Math.floor(r),o=st[a];if(this.originalColor=o.clone(),a!==st.length-1){var s=r-a,l=st[a+1];this.originalColor.lerp(l,s)}}if(i.color=new y.i(0).lerp(this.originalColor,R(n,0,1,.2,1)),this.target instanceof he&&this.mesh.position.set(this.target.pos.x,this.target.pos.y+this.target.droopY,1),ne(this.target)&&i.color.lerp(new y.i(0),1-this.target.energy/$.cellEnergyMax),null!=this.inventoryRenderer&&n>0&&this.inventoryRenderer.update(),this.target instanceof ve&&null!=this.audio){var u=this.target.didConvert?1:0;if(u!==this.lastAudioValueTracker&&u>0){this.audio.setBuffer(x);var c=this.target.pos.distanceToSquared(this.mito.world.player.pos),h=Math.min(1,1/(1+c/25))*this.target.sugarConverted*this.target.sugarConverted;this.audio.setVolume(h),this.audio.play()}this.lastAudioValueTracker=u}if(this.target instanceof fe&&null!=this.audio){var d=this.target.waterTransferAmount;if(d!==this.lastAudioValueTracker){this.audio.setBuffer(A);var p=this.target.waterTransferAmount/(2+this.target.waterTransferAmount),v=this.target.pos.distanceToSquared(this.mito.world.player.pos),f=Math.min(1,1/(1+v/25))*p;this.audio.setVolume(f),null!=this.audio.source&&this.audio.stop(),this.audio.play()}this.lastAudioValueTracker=d}if(this.target.tilePairs instanceof Array){var m=this.target instanceof ve?16763150:new y.i("rgb(9, 12, 255)").getHex(),g=this.target.tilePairs;g.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=g.map(function(t){var n=2*t.length()-.25,i=new y.F(t.x,t.y,0).normalize(),r=e.makeLine(i,i.clone().multiplyScalar(-n/2),n,m);return e.mesh.add(r),r}))}if(this.hasActiveNeighbors(this.target)){var w=this.target instanceof fe?new y.i("rgb(9, 12, 255)").getHex():16777215,b=this.target.activeNeighbors;b.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=b.map(function(t){var n=t.length()-.25,i=new y.F(t.x,t.y,0).normalize(),r=e.target instanceof fe?e.makeLine(i,new y.F,n,w):new y.a(i,new y.F(0,0,5),n,w);return e.mesh.add(r),r}))}}},{key:"hasActiveNeighbors",value:function(e){return Array.isArray(e.activeNeighbors)}},{key:"makeLine",value:function(e,n,i,r){var a=new y.m(t.lineGeometry,new y.n({color:r}));if(a.position.copy(n),e.y>.99999)a.quaternion.set(0,0,0,1);else if(e.y<-.99999)a.quaternion.set(1,0,0,0);else{var o=new y.F(e.z,0,-e.x).normalize(),s=Math.acos(e.y);a.quaternion.setFromAxisAngle(o,s)}return a.scale.set(1,Math.max(0,i),1),a.position.z=.1,a.updateMatrix(),a.matrixAutoUpdate=!1,a}},{key:"destroy",value:function(){this.scene.remove(this.mesh),null!=this.inventoryRenderer&&this.inventoryRenderer.destroy()}}]),t}(_e);at.lineGeometry=function(){var e=new y.g;return e.addAttribute("position",new y.l([0,0,0,0,1,0],3)),e}();var ot=Te(function(){var e=new Map;return e.set(oe,new y.r({side:y.j,depthWrite:!1})),e.set(se,new y.r({map:Ge(8,11),side:y.j,color:new y.i("rgb(112, 89, 44)"),depthWrite:!1})),e.set(ce,new y.r({map:Ge(3.5,2.375),side:y.j})),e.set(le,new y.r({map:Ge(26,20),side:y.j,color:new y.i("rgb(63, 77, 84)")})),e.set(ue,new y.r({map:Ge(8.5625,23.375),side:y.j,color:new y.i("rgb(128, 128, 128)")})),e.set(pe,new y.r({map:Ge(6,31),side:y.j,color:new y.i(3190309)})),e.set(ye,e.get(pe)),e.set(ve,new y.r({map:Ge(55/16,17.5),side:y.j})),e.set(fe,new y.r({map:Ge(59/16,327/16),side:y.j})),e.set(me,new y.r({map:Ve,side:y.j,transparent:!0})),e.set(ge,new y.r({map:Ge(Math.floor(11.5),Math.floor(9.5)),side:y.j})),e});var st=[new y.i("hsl(67, 31%, 25%)"),new y.i("hsl(180, 31%, 76%)"),new y.i("hsl(213, 63%, 58%)")],lt=function(e){function t(e,n,i){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n,i))).arrow=void 0,r.arrow=r.makeArrow(r.target.dir),r.mesh.add(r.arrow),r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"makeArrow",value:function(e){var t=e.length()-.25,n=new y.F(e.x,e.y,0).normalize(),i=n.clone().multiplyScalar(-t/2);return new y.a(n,new y.F(i.x,i.y,1),t,16777215,.1,.1)}}]),t}(at),ut=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.props.parent.add(this.props.object)}},{key:"componentWillUnmount",value:function(){this.props.parent.remove(this.props.object)}}]),t}(i.PureComponent),ct=Te(function(){var e=new y.v(1,1),t=new y.k(e,1),n=new y.n({color:16777215,transparent:!0,opacity:.75}),i=new y.o(t,n);return i.position.z=10,i}),ht=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).object=ct().clone(),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return this.object.position.x=this.props.x,this.object.position.y=this.props.y,i.createElement(i.Fragment,null,i.createElement(dt,{a:function(t){return e.object.scale.setScalar(.04*Math.sin(3.7*t)+.94)}}),i.createElement(ut,{object:this.object,parent:this.props.scene}))}}]),t}(i.PureComponent),dt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).rafid=void 0,n.animate=function(e){n.props.a(e/1e3),n.rafid=requestAnimationFrame(n.animate)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.rafid=requestAnimationFrame(this.animate)}},{key:"componentWillUnmount",value:function(){this.rafid&&cancelAnimationFrame(this.rafid)}}]),t}(i.Component),pt=ht;i.PureComponent;var vt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return i.createElement("div",{className:"mito-instructions"},i.createElement("div",{className:"mito-instructions-container"},i.createElement("div",{className:"esc",onClick:function(){return e.props.play()}},"Back (Esc)"),i.createElement("h1",null,"Mito"),i.createElement("div",{className:"play-button",onClick:function(){return e.props.play()}},"Play"),i.createElement("p",null,i.createElement("ol",null,i.createElement("li",null,"Build Tissue to expand your reach (press t and walk into empty space)."),i.createElement("li",null,"Build Roots (press r) underground to suck up adjacent water."),i.createElement("li",null,"Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar."),i.createElement("li",null,i.createElement("b",null,"Win the game by building and loading the Fruit with 1000 sugar.")),i.createElement("li",null,"Click around to see the different properties of each tile."),i.createElement("li",null,"Build leaves early."),i.createElement("li",null,"Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air."),i.createElement("li",null,"Explore underground for water reservoires and Fountains."),i.createElement("li",null,"Build transports (capital T) to carry water back up the plant."),i.createElement("li",null,"You can scroll out infinitely far."))),i.createElement("h3",null,"You"),i.createElement("p",null,"You can carry max ",$.maxResources," resources, and you automatically suck in any resources you're standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil below and air above."),i.createElement("h3",null,"Soil and Underground"),i.createElement("p",null,"Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a permanent source of water. Soil holds up to ",$.soilMaxWater," water at a time. Fountains emit one water per ",$.fountainTurnsPerWater," turns."),i.createElement("h3",null,"Air and Aboveground"),i.createElement("p",null,"Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun, which gently sways left to right."),i.createElement("h3",null,"Water"),i.createElement("p",null,"Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2 required) at about 1 unit per ",(1/$.soilDiffusionWater).toFixed(0)," turns. Obtain water in the ground through Roots. Leaves require water to photosynthesize. You require water to build."),i.createElement("h3",null,"Sugar"),i.createElement("p",null,"Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by putting water next to leaves. Cells require sugar to survive. You require sugar to build."),i.createElement("h3",null,"Building"),i.createElement("p",null,'Build Tissue, Leaves, Roots, and The Fruit by toggling "build mode" on and walking into Air or Soil. Build Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they\'re not properly supported underneath them.'),i.createElement("h3",null,"Cells"),i.createElement("p",null,"All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their neighbors. Each cell consumes 1 sugar every ",$.cellEnergyMax," turns."),i.createElement("h3",null,"Tissue"),i.createElement("p",null,"Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to ",$.tissueInventoryCapacity," resources."),i.createElement("h3",null,"Roots"),i.createElement("p",null,"Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is called a Pairing."),i.createElement("h3",null,"Leaves"),i.createElement("p",null,"When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per ",(1/$.leafReactionRate).toFixed(0)," turns per pair. Leaf efficiency is heavily influenced by co2 and sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize. Leaves higher up produce sugar faster."),i.createElement("h3",null,"Transport"),i.createElement("p",null,"Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you. Transport hungers at double speed."),i.createElement("h3",null,"The Fruit"),i.createElement("p",null,"You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to 1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity."),this.renderCredit()))}},{key:"renderCredit",value:function(){return i.createElement(i.Fragment,null,i.createElement("h2",null,"Attribution"),i.createElement("p",null,"Tiles: ",i.createElement("a",{href:"http://kenney.nl/assets?s=roguelike",target:"_blank",rel:"noopener noreferrer"},"Kenney.nl Roguelike Assets")),i.createElement("p",null,"Pop sound when leaves convert: ",i.createElement("a",{href:"http://soundbible.com/2067-Blop.html",target:"_blank",rel:"noopener noreferrer"},"Blop by Mark DiAngelo")," (",i.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/us/"},"CC BY 3.0 US"),")"),i.createElement("p",null,"Perlin noise: ",i.createElement("a",{href:"https://github.com/josephg/noisejs",target:"_blank",rel:"noopener noreferrer"},"josephg/noisejs")),i.createElement("p",null,"Part of 7drl 2018: ",i.createElement("a",{href:"http://7drl.org/",target:"_blank",rel:"noopener noreferrer"},"http://7drl.org/")),i.createElement("p",null,"Fruit icon: ",i.createElement("a",{href:"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm"},"Designed by Freepik")))}}]),t}(i.PureComponent),ft=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).handlePlay=function(){n.props.mito.gameState="main"},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e={width:"100%",height:"100%",position:"absolute",background:"rgba(255, 255, 255, 0.95)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px"};return"main"===this.props.state?null:"win"===this.props.state?i.createElement("div",{className:"screen-win",style:e},"You won!"):"lose"===this.props.state?i.createElement("div",{className:"screen-lose",style:e},"You lost!"):"instructions"===this.props.state?i.createElement(vt,{play:this.handlePlay}):void 0}}]),t}(i.PureComponent),mt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.tile;return e?i.createElement("div",{className:"tile-hover"},this.tileInfo(e),this.inventoryInfo(e),this.cellInfo(e),this.growingCellInfo(e),this.rootInfo(e),this.leafInfo(e),this.airInfo(e),this.fountainInfo(e)):null}},{key:"rootInfo",value:function(e){return e instanceof fe?i.createElement("div",{className:"info-root"},i.createElement("div",null,e.cooldown," turns until next water suck"),i.createElement("div",null,e.waterTransferAmount.toFixed(0)," water transfer per round")):null}},{key:"leafInfo",value:function(e){return e instanceof ve?i.createElement("div",{className:"info-leaf"},i.createElement("div",null,(1/(e.averageSpeed*$.leafReactionRate)).toFixed(0)," turns per reaction"),i.createElement("div",null,(1/e.averageEfficiency).toFixed(2)," water per sugar")):null}},{key:"airInfo",value:function(e){if(e instanceof oe)return i.createElement("div",{className:"info-air"},i.createElement("div",null,"\u2600\ufe0f ",(100*e.sunlight()).toFixed(0),"%"),i.createElement("div",null,"\u2601\ufe0f ",(100*e.co2()).toFixed(0),"%"))}},{key:"fountainInfo",value:function(e){if(e instanceof ce)return i.createElement("div",{className:"info-fountain"},i.createElement("div",null,e.turnsPerWater," turns per water"))}},{key:"tileInfo",value:function(e){var t=ne(e)?i.createElement("span",{className:"info-energy"},"\ud83d\udc9a",(e.energy/$.cellEnergyMax*100).toFixed(0),"%"):null;return i.createElement("div",{className:"info-tile"},i.createElement("div",{className:"info-tile-name"},e.constructor.displayName),t)}},{key:"inventoryInfo",value:function(e){if(I(e)){var t=e.inventory.water>0?i.createElement("div",{className:"info-inventory-item"},"\ud83d\udca7 ",e.inventory.water.toFixed(2)):null,n=e.inventory.sugar>0?i.createElement("div",{className:"info-inventory-item"},"Sugar ",e.inventory.sugar.toFixed(2)):null;return i.createElement("div",{className:"info-inventory"},t,n)}}},{key:"cellInfo",value:function(e){if(e instanceof he&&200*e.droopY>1)return i.createElement("div",{className:"info-cell"},(200*e.droopY).toFixed(0),"% droop")}},{key:"growingCellInfo",value:function(e){if(e instanceof de)return i.createElement("div",{className:"info-growing-cell"},(100-e.timeRemaining/e.timeToBuild*100).toFixed(0),"% mature")}}]),t}(i.Component),yt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.water+this.props.sugar>$.maxResources-1,t=i.createElement("div",{className:"mito-inventory-maxed".concat(e?" is-maxed":"")},"maxed");return i.createElement(i.Fragment,null,i.createElement("div",{className:p()("mito-hud",{hidden:!this.props.isTutorialFinished})},this.renderFruitUI(),this.renderAllBuildButtons(),this.renderSecondEls(),this.renderDPad()),i.createElement("div",{className:p()("mito-inventory",{hidden:!1})},t,i.createElement("div",{className:"mito-inventory-container"},this.renderInventoryBar(),this.renderInventory())),this.renderUIState(),this.renderAutoplacePopup())}},{key:"ensureCanvasFocus",value:function(e){e.preventDefault(),document.getElementsByTagName("canvas")[0].focus()}},{key:"renderButton",value:function(e,t,n){var r=this;return i.createElement("div",Object.assign({key:e,className:"mito-hud-button mito-hud-build-item",onClick:function(t){r.props.onTryActionKey(e),r.ensureCanvasFocus(t)}},n),i.createElement("span",{className:"mito-hud-button-hotkey"},e),t)}},{key:"renderBuildButton",value:function(e,t){var n,i=Ee[e];n=i===pe?"Build ".concat(i.displayName):i===ve||i===fe?"Build ".concat(i.displayName):i===me?"Build ".concat(i.displayName):i===ye?"Lay ".concat(i.displayName):"Build ".concat(i.displayName);var r=Object(Q.a)({},(t||{style:{}}).style);return this.props.autoplace===i&&(r.fontWeight="bold",r.textDecoration="underline",r.color="rgb(45, 220, 40)",this.props.water<1&&(n+=" (need water!)",r.color="red"),this.props.sugar<1&&(n+=" (need sugar!)",r.color="red")),this.renderButton(e," - "+n,Object(Q.a)({},t,{style:r}))}},{key:"renderInventory",value:function(){return i.createElement("div",{className:"mito-inventory-indicator"},i.createElement("span",{className:"mito-inventory-water"},this.props.water.toFixed(2)," water"),"\xa0",i.createElement("span",{className:"mito-inventory-sugar"},this.props.sugar.toFixed(2)," sugar"))}},{key:"renderInventoryBar",value:function(){var e=this.props.water/$.maxResources,t=this.props.sugar/$.maxResources,n=1-(this.props.water+this.props.sugar)/$.maxResources,r={width:"".concat(100*e,"%")},a={width:"".concat(100*t,"%")},o={width:"".concat(100*n,"%")};return i.createElement("div",{className:"mito-inventory-bar"},i.createElement("div",{style:r,className:"mito-inventory-bar-water"}),i.createElement("div",{style:a,className:"mito-inventory-bar-sugar"}),i.createElement("div",{style:o,className:"mito-inventory-bar-empty"}))}},{key:"renderAllBuildButtons",value:function(){var e=[];for(var t in Ee)if("F"!==t){var n=this.renderBuildButton(t);null!=n&&e.push(n)}return null==this.props.world.fruit&&Ee.F&&e.push(this.renderBuildButton("F")),i.createElement("div",{className:"mito-hud-section mito-hud-section-build"},e)}},{key:"renderSecondEls",value:function(){return i.createElement("div",{className:"mito-hud-section mito-hud-section-actions"},this.renderButton("1"," - Drop water"),this.renderButton("2"," - Drop sugar"),this.renderButton("."," - Wait a turn"),this.renderButton("?"," - Instructions"))}},{key:"renderDPad",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var a,o="qwea.dzsc".split("")[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;e.push(this.renderButton(s,null,{style:{}}))}}catch(l){n=!0,r=l}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return i.createElement("div",{className:"mito-hud-section d-pad"},e)}},{key:"renderFruitUI",value:function(){var e=this.props.world;if(null!=e.fruit)return i.createElement("div",{className:"mito-hud-section"},"You bear Fruit! ",e.fruit.inventory.sugar.toFixed(2)," of ",me.sugarToWin," sugar!")}},{key:"renderUIState",value:function(){if("expanding"===this.props.uiState.type){var e=[];for(var t in Ee){var n=Ee[t];if((n!==me||null==this.props.world.fruit)&&n!==ye){var r=this.renderButton(t,n.displayName);null!=r&&e.push(r)}}return e.push(this.renderButton("Esc",null)),i.createElement("div",{className:"ui-popup ui-popup-bottom"},i.createElement("div",{className:"connector-line"}),i.createElement("span",{className:"popup-title"},"Build"),i.createElement("div",{className:"popup-content popup-row"},e))}}},{key:"renderAutoplacePopup",value:function(){if(this.props.autoplace){var e={left:this.props.mouseX,top:this.props.mouseY};return i.createElement("div",{className:"popup-autoplace ui-popup",style:e},i.createElement("div",{className:"popup-content popup-text"},"Building ",this.props.autoplace.displayName,this.renderButton("Esc",null)))}}}]),t}(i.PureComponent),gt=n(31),wt=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).gui=void 0;var i=new gt.a({closed:!0,width:450});i.add($,"environment",Object.keys(Pe)).onChange(function(){return setTimeout(function(){return window.location.reload()},100)}),i.add($,"droop",0,.5,.01),i.add($,"fountainTurnsPerWater",1,100,1),i.add($,"isRealtime"),i.add($,"leafReactionRate",0,.2,1e-4),i.add($,"leafSugarPerReaction",0,1,.01),i.add($,"rootTurnsPerTransfer",1,100,1),i.add($,"soilDarknessBase",0,1,.01),i.add($,"soilDiffusionType",["discrete","continuous"]),i.add($,"sunlightReintroduction",0,1,.01),i.add($,"sunlightDiffusion",0,1,.01),i.add($,"transportTurnsPerMove",1,50,1),i.add($,"veinDiffusion",0,.85,1e-4);var r=i.addFolder("Needs Page Refresh");r.add($,"cellGestationTurns",0,100,1),r.add($,"cellDiffusionSugar",0,.85,1e-4),r.add($,"cellDiffusionWater",0,.85,1e-4),r.add($,"cellEnergyMax",400,1e4,100),r.add($,"fountainAppearanceRate",1,5,.1),r.add($,"maxResources",10,1e3,1),r.add($,"soilDiffusionWater",0,.25,1e-5),r.add($,"soilMaxWater",1,100,1),r.add($,"tissueInventoryCapacity",1,100,1);var a=!0,o=!1,l=void 0;try{for(var h,d=i.__controllers.concat(r.__controllers)[Symbol.iterator]();!(a=(h=d.next()).done);a=!0){h.value.onFinishChange(te)}}catch(p){o=!0,l=p}finally{try{a||null==d.return||d.return()}finally{if(o)throw l}}return n.gui=i,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return null}}]),t}(i.Component),bt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.mito.hoveredTile;return i.createElement(i.Fragment,null,i.createElement(mt,{tile:e}),this.maybeRenderHoveredTileHighlight(e),this.maybeRenderPath())}},{key:"maybeRenderHoveredTileHighlight",value:function(e){if(e)return i.createElement(pt,{x:e.pos.x,y:e.pos.y,scene:this.scene})}},{key:"maybeRenderPath",value:function(){var e=this.props.mito,t=e.autoplace,n=e.hoveredTile,r=e.scene,a=e.world;if(n){if(null!=t&&-1!==At.expansionTiles.indexOf(t))return i.createElement(kt,{tile:n,scene:r,world:a,walkable:"non-obstacles"});if(t===ye)return i.createElement(kt,{tile:n,scene:r,world:a,walkable:"tissue"})}}},{key:"scene",get:function(){return this.props.mito.scene}}]),t}(i.Component),kt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t="non-obstacles"===this.props.walkable?Be(this.props.world,this.props.tile.pos):Fe(this.props.world,this.props.tile.pos);return i.createElement(i.Fragment,null,t.map(function(t){var n=Object(V.a)(t,2),r=n[0],a=n[1];return i.createElement(pt,{x:r,y:a,scene:e.props.scene})}))}}]),t}(i.PureComponent);var Et=50,Ot=100;function jt(e,t,n){e.x=e.x*(1-n)+t.x*n,e.y=e.y*(1-n)+t.y*n}var xt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).world=new xe((Pe[$.environment]||Me)()),n.scene=new y.A,n.camera=new y.u(0,0,0,0,-100,100),n.renderers=new Map,n.autoplace=void 0,n.tutorialRef=null,n.mouse=new y.E,n.hoveredTile=void 0,n.raycaster=new y.y,n.gameState="main",n.firstActionTakenYet=!1,n.audioListener=new y.d,n.keyMap=new Set,n.uiState={type:"main"},n.events={contextmenu:function(e){if("main"===n.uiState.type){var t=n.getTileAtScreenPosition(e.clientX,e.clientY);null!=t&&n.world.player.setAction({type:"deconstruct",position:t.pos})}return!1},mousemove:function(e){n.mouse.x=e.clientX,n.mouse.y=e.clientY},click:function(e){n.handleClick(e.clientX,e.clientY)},keydown:function(e){n.firstActionTakenYet=!0;var t=e.key;n.keyMap.add(t),n.tryAction(t)},keyup:function(e){n.keyMap.delete(e.key)},wheel:function(e){var t=-(e.deltaX+e.deltaY)/125/20,i=n.camera.zoom*Math.pow(2,t);n.camera.zoom=i,n.camera.updateProjectionMatrix()}},n.tryAction=function(e){if("?"!==e){if("expanding"===n.uiState.type){if("Escape"===e)return void n.resetUIState();if(e in Ee&&(Ee[e]!==me||null==n.world.fruit)){var t={type:"build",cellType:Ee[e],position:n.uiState.target};return n.world.player.setAction(t),void n.resetUIState()}if(we[e])return void n.resetUIState()}if("instructions"!==n.gameState){null!=n.autoplace&&"Escape"===e&&(n.autoplace=void 0);var i=we[e]||be[e];null!=i?n.world.player.setAction(i):e in Ee&&(n.autoplace===Ee[e]||Ee[e]===me&&null!=n.world.fruit?n.autoplace=void 0:n.autoplace=Ee[e])}else"Escape"===e&&(n.gameState="main")}else n.gameState="instructions"===n.gameState?"main":"instructions"},n.expandingTileHighlight=new y.q(new y.v(1,1),new y.r({color:"white",side:y.j,transparent:!0,opacity:.5})),n.mapActions=function(e,t){if(null!=t){if("none"===t.type)return t;if(n.resetUIState(),"still"===t.type&&(n.autoplace===ge||n.autoplace===pe))return{type:"build",cellType:n.autoplace,position:e.pos};if("move"!==t.type)return t;var i=n.world.tileAt(e.pos.x+t.dir.x,e.pos.y+t.dir.y),r=e.currentTile();if(null!=n.autoplace){if(n.autoplace===ye){if(null==t.dir)throw new Error("bad dir");return{type:"build-transport",cellType:ye,position:n.world.player.pos,dir:t.dir}}if(n.autoplace!==ge||r instanceof ge){if(e.verifyMove(t))return t;var a={type:"build",cellType:n.autoplace,position:e.pos.clone().add(t.dir)};return n.autoplace!==pe&&n.autoplace!==fe&&(n.autoplace=void 0),a}return{type:"multiple",actions:[{type:"build",cellType:ge,position:e.pos},t]}}return e.isBuildCandidate(i)?void(null!=n.tutorialRef&&n.tutorialRef.tutorialRef):t}},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.createElement(i.Fragment,null,i.createElement(yt,{autoplace:this.autoplace,mouseX:this.mouse.x,mouseY:this.mouse.y,uiState:this.uiState,isTutorialFinished:null==this.tutorialRef||this.tutorialRef.isFinished(),sugar:this.world.player.inventory.sugar,water:this.world.player.inventory.water,onTryActionKey:this.tryAction,world:this.world}),i.createElement(ft,{mito:this,state:this.gameState}),i.createElement(wt,null),i.createElement(bt,{mito:this}))}},{key:"enterUIStateExpanding",value:function(e){var t="main"===this.uiState.type?this.camera.zoom:this.uiState.originalZoom;this.uiState={type:"expanding",originalZoom:t,target:e}}},{key:"resetUIState",value:function(){"expanding"===this.uiState.type&&(this.camera.zoom=this.uiState.originalZoom,this.camera.updateProjectionMatrix(),this.uiState={type:"main"})}},{key:"init",value:function(){window.mito=this,function(e){var t=0;function n(){3===++t&&(b.audio.currentTime=0,k.audio.currentTime=0,E.audio.currentTime=0,b.gain.connect(e.gain),k.gain.connect(e.gain),E.gain.connect(e.gain))}(b=N(e,"mito-base")).audio.oncanplaythrough=n,b.gain.gain.value=.5,(k=N(e,"mito-strings")).audio.oncanplaythrough=n,k.gain.gain.value=0,(E=N(e,"mito-drums")).audio.oncanplaythrough=n,E.gain.gain.value=0,(O=N(e,"footsteps")).gain.gain.value=0,O.gain.connect(e.gain),(j=N(e,"build")).gain.gain.value=0,j.gain.connect(e.gain);var i=new y.e;i.load("assets/audio/Blop-Mark_DiAngelo-79054334.mp3",function(e){x=e},function(e){e.loaded,e.total},function(e){}),i.load("assets/audio/suckwater.wav",function(e){A=e},function(e){e.loaded,e.total},function(e){})}(this.audioContext),this.camera.zoom=1.5,this.camera.add(this.audioListener),this.resize(this.canvas.width,this.canvas.height),this.scene.add(Qe.WaterParticles()),this.scene.add(Qe.SugarParticles());for(var e=0;e<5;e++)this.world.step();this.camera.position.z=10,this.camera.lookAt(new y.F(0,0,0)),this.camera.position.x=this.world.player.pos.x,this.camera.position.y=this.world.player.pos.y,this.updateAmbientAudio(),this.world.player.mapActions=this.mapActions}},{key:"getOrCreateRenderer",value:function(e){var t=this.renderers.get(e);if(null==t){var n=function(e,t,n){if(e instanceof Oe)return new it(e,t,n);if(e instanceof ye)return new lt(e,t,n);if(e instanceof ie)return new at(e,t,n);throw new Error("Couldn't find renderer for ".concat(e))}(e,this.scene,this);return this.renderers.set(e,n),n}return t}},{key:"updateAmbientAudio",value:function(){var e=this.world.player.pos.y,t=R(e,Ot/2,Ot,0,.5),n=R(e,Ot/2,0,0,.5);E.gain.gain.value=Math.max(0,t),k.gain.gain.value=Math.max(0,n)}},{key:"logRenderInfo",value:function(){"Geometries in memory: ".concat(this.renderer.info.memory.geometries,"\nTextures in memory: ").concat(this.renderer.info.memory.textures,"\n# Render Calls: ").concat(this.renderer.info.render.calls,"\n# Render Lines: ").concat(this.renderer.info.render.lines,"\n# Render Points: ").concat(this.renderer.info.render.points,"\n# Render Tris: ").concat(this.renderer.info.render.triangles,"\n")}},{key:"perfDebug",value:function(){var e=0,t=0;this.scene.traverse(function(n){n.matrixAutoUpdate?e++:t++}),console.log("yes",e,"no",t);var n=new Map;this.scene.traverse(function(e){var t=n.get(e.name||e.constructor.name)||[];n.set(e.name||e.constructor.name,t),t.push(e)}),console.log(n)}},{key:"worldStepAndDeleteOldRenderers",value:function(){if(this.firstActionTakenYet){var e=this.world.step();this.tutorialRef&&this.tutorialRef.setState({time:this.world.time}),this.gameState=this.world.checkWinLoss()||this.gameState;var t=e.deleted,n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=this.renderers.get(s);if(null==l)throw new Error("Couldn't find renderer for ".concat(s,"!"));l.destroy(),this.renderers.delete(s)}}catch(u){i=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}this.updateAmbientAudio()}}},{key:"getCameraNormCoordinates",value:function(e,t){return new y.E(e/this.canvas.width*2-1,-t/this.canvas.height*2+1)}},{key:"getTileAtScreenPosition",value:function(e,t){var n=this.getCameraNormCoordinates(e,t);this.raycaster.setFromCamera(n,this.camera);var i=this.raycaster.ray.origin,r=i.x,a=i.y,o=Math.round(r),s=Math.round(a),l=this.world.tileAt(o,s);if(null!=l&&l.lightAmount()>0)return l}},{key:"animate",value:function(){var e=this,t=this.world;if(this.canvas.focus(),"main"===this.gameState){if($.isRealtime){if(this.frameCount%3===0){if(null==this.world.player.getAction()){var n=this.keysToMovement(this.keyMap);n&&this.world.player.setAction(n)}this.worldStepAndDeleteOldRenderers()}}else null!=t.player.getAction()&&this.worldStepAndDeleteOldRenderers();Qe.startFrame(),this.world.entities().forEach(function(t){e.getOrCreateRenderer(t).update()}),Qe.endFrame()}"expanding"===this.uiState.type&&(this.world.player.isBuildCandidate(this.world.tileAt(this.uiState.target))||this.resetUIState());var i=this.getCameraNormCoordinates(this.mouse.x,this.mouse.y);if("main"===this.uiState.type){this.scene.remove(this.expandingTileHighlight);var r=new y.E(this.world.player.pos.x+i.x/2,this.world.player.pos.y-i.y/2);jt(this.camera.position,r,.3)}else{this.scene.add(this.expandingTileHighlight),this.expandingTileHighlight.position.set(this.uiState.target.x,this.uiState.target.y,1);var a=new y.E(this.uiState.target.x,this.uiState.target.y);jt(this.camera.position,a,.3)}this.renderer.render(this.scene,this.camera),this.hoveredTile=this.getTileAtScreenPosition(this.mouse.x,this.mouse.y)}},{key:"keysToMovement",value:function(e){var t=new y.E,n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;be[s]&&t.add(be[s].dir)}}catch(l){i=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return 0===t.x&&0===t.y?null:{type:"move",dir:t}}},{key:"resize",value:function(e,t){var n=t/e;this.camera.left=-12/n,this.camera.right=12/n,this.camera.top=-12,this.camera.bottom=12,this.camera.updateProjectionMatrix()}},{key:"handleClick",value:function(e,n){this.firstActionTakenYet=!0;var i=this.getTileAtScreenPosition(e,n);if("expanding"===this.uiState.type&&(null!=i&&this.uiState.target.equals(i.pos)||this.resetUIState()),i)if(i.pos.equals(this.world.player.pos))this.world.player.setAction({type:"still"});else{var r,a=ze(this.world.player.pos.x,this.world.player.pos.y,i.pos.x,i.pos.y);if(a)return this.world.player.isBuildCandidate(i)?void this.enterUIStateExpanding(i.pos):void this.world.player.setAction(a);r=this.autoplace&&-1!==t.expansionTiles.indexOf(this.autoplace)?De(Be(this.world,i.pos)):De(Fe(this.world,i.pos,null!=this.autoplace)),this.world.player.setActions(r)}}}]),t}(w);xt.originalFn=y.t.prototype.updateMatrixWorld,xt.expansionTiles=[pe,fe,ge];var At=xt,Ct=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(S,{sketchClass:At}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(Ct,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[33,1,2]]]);
//# sourceMappingURL=main.d0bf0020.chunk.js.map