(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{34:function(e,t,n){e.exports=n(58)},40:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(29),o=n.n(a),s=(n(40),n(2)),l=n(3),u=n(6),c=n(4),h=n(5),d=n(33),p=n(30),v=n(12),f=n(14),m=n.n(f),y=n(1),g={click:!0,contextmenu:!0,dblclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,touchstart:!0,touchmove:!0,touchend:!0,keyup:!0,keydown:!0,keypress:!0,wheel:!0},w=function(){function e(t,n){Object(s.a)(this,e),this.renderer=t,this.audioContext=n,this.elements=void 0,this.events=void 0,this.timeElapsed=0,this.frameCount=0}return Object(l.a)(e,[{key:"aspectRatio",get:function(){return this.renderer.domElement.height/this.renderer.domElement.width}},{key:"resolution",get:function(){return new y.E(this.renderer.domElement.width,this.renderer.domElement.height)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),e}();w.id=void 0;var b,k,O,E,j,x,A,C=n(27),M=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).frameId=void 0,n.lastTimestamp=0,n.loop=function(e){var t=e-n.lastTimestamp;n.lastTimestamp=e,n.props.sketch.frameCount++,n.props.sketch.timeElapsed=e;try{n.props.sketch.animate(t)}catch(r){console.error(r)}n.setState({frameCount:n.props.sketch.frameCount}),n.frameId=requestAnimationFrame(n.loop)},n.handleWindowResize=function(){var e=n.props.sketch.renderer;n.updateRendererCanvasToMatchParent(e),null!=n.props.sketch.resize&&n.props.sketch.resize(e.domElement.width,e.domElement.height)},n.state={frameCount:e.sketch.frameCount},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.updateRendererCanvasToMatchParent(this.props.sketch.renderer),window.addEventListener("resize",this.handleWindowResize);var t=this.props.sketch.renderer.domElement;t.tabIndex=1,Object.keys(g).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.addEventListener(n,r):t.addEventListener(n,r))}}),this.frameId=requestAnimationFrame(this.loop)}},{key:"render",value:function(){var e=[];return null!=this.props.sketch.render&&e.push(this.props.sketch.render()),null!=this.props.sketch.elements&&e.push.apply(e,Object(v.a)(this.props.sketch.elements)),r.createElement("div",{className:"sketch-elements"},e.map(function(e,t){return r.cloneElement(e,{key:t})}))}},{key:"componentWillUnmount",value:function(){var e=this;this.props.sketch.destroy&&this.props.sketch.destroy(),null!=this.frameId&&cancelAnimationFrame(this.frameId),this.props.sketch.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize);var t=this.props.sketch.canvas;Object.keys(g).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.removeEventListener(n,r):t.removeEventListener(n,r))}})}},{key:"updateRendererCanvasToMatchParent",value:function(e){var t=e.domElement.parentElement;null!=t&&e.setSize(t.clientWidth,t.clientHeight)}}]),t}(r.Component),T=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).state={status:{type:"loading"},volumeEnabled:JSON.parse(window.localStorage.getItem("sketch-volumeEnabled")||"true")},n.audioContext=void 0,n.userVolume=void 0,n.handleContainerRef=function(e){if(null!=e)try{var t=window.AudioContext||window.webkitAudioContext,r=n.audioContext=new t;y.c.setContext(r),n.userVolume=r.createGain(),n.userVolume.gain.setValueAtTime(.8,0),n.userVolume.connect(r.destination),(r.gain=r.createGain()).connect(n.userVolume),document.addEventListener("visibilitychange",n.handleVisibilityChange);var i=new y.G({alpha:!0,preserveDrawingBuffer:!0,antialias:!0});e.appendChild(i.domElement);var a=n.props.otherArgs||[],o=Object(p.a)(n.props.sketchClass,[i,n.audioContext].concat(Object(v.a)(a)));n.setState({status:{type:"success",sketch:o}})}catch(s){n.setState({status:{type:"error",error:s}}),console.error(s)}else document.removeEventListener("visibilitychange",n.handleVisibilityChange),null!=n.audioContext&&n.audioContext.close()},n.handleVolumeButtonClick=function(){var e=!n.state.volumeEnabled;n.setState({volumeEnabled:e}),window.localStorage.setItem("sketch-volumeEnabled",JSON.stringify(e))},n.handleVisibilityChange=function(){null!=n.audioContext&&(document.hidden?n.audioContext.suspend():n.state.volumeEnabled&&n.audioContext.resume())},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){null!=this.userVolume&&null!=this.audioContext&&(this.state.volumeEnabled&&"suspended"===this.audioContext.state?this.audioContext.resume():this.state.volumeEnabled||"running"!==this.audioContext.state||this.audioContext.suspend());var e=this.props,t=(e.sketchClass,Object(d.a)(e,["sketchClass"])),n=m()("sketch-component",this.state.status.type);return r.createElement("div",Object.assign({},t,{id:this.props.sketchClass.id,className:n,ref:this.handleContainerRef}),this.renderSketchOrStatus(),this.renderVolumeButton())}},{key:"renderSketchOrStatus",value:function(){var e=this.state.status;return"success"===e.type?r.createElement(M,{key:this.props.sketchClass.id,sketch:e.sketch,eventsOnBody:this.props.eventsOnBody}):"error"===e.type?this.props.errorElement||this.renderDefaultErrorElement(e.error.message):"loading"===e.type?null:void 0}},{key:"renderDefaultErrorElement",value:function(e){return r.createElement("p",{className:"sketch-error"},"Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.",r.createElement("pre",null,e))}},{key:"renderVolumeButton",value:function(){var e=this.state.volumeEnabled;return r.createElement("button",{className:"user-volume",onClick:this.handleVolumeButtonClick},e?r.createElement(C.b,null):r.createElement(C.a,null))}}]),t}(r.Component),S=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).handleDivRef=function(e){null!=e||n.exitFullscreen()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:"full-page-sketch",ref:this.handleDivRef},r.createElement(T,{sketchClass:this.props.sketchClass,otherArgs:this.props.otherArgs}))}},{key:"exitFullscreen",value:function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}}]),t}(r.Component),R=n(9);function P(e,t,n,r,i){return function(e,t,n){return e+(t-e)*n}(r,i,(e-t)/(n-t))}function N(e,t){var n=document.createElement("source");return n.src="/assets/audio/".concat(e,".").concat(t),n.type="audio/".concat(t),n}function F(e,t){var n=document.createElement("audio");n.autoplay=!0,n.loop=!0,n.appendChild(N(t,"ogg")),n.appendChild(N(t,"mp3")),n.appendChild(N(t,"wav"));var r=e.createMediaElementSource(n),i=e.createGain();return r.connect(i),{audio:n,gain:i}}var B=n(31),W=n(22);function D(e){return Math.round(1e12*e)/1e12}var I=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(s.a)(this,e),this.capacity=t,this.carrier=n,this.water=r,this.sugar=i,this.events=void 0,this.validate()}return Object(l.a)(e,[{key:"give",value:function(e,t,n){if(e===this)throw new Error("shouldn't give to self");var r=Math.min(t,this.water),i=Math.min(n,this.sugar),a=D(r+i),o=e.space();return a>o&&(r=Math.floor(r/a*o),i=Math.floor(i/a*o)),this.change(-r,-i),e.change(r,i),this.events&&this.events.emit("give",e,r,i),e.events&&e.events.emit("get",this,r,i),{water:r,sugar:i}}},{key:"on",value:function(e,t){this.events=this.events||new W.EventEmitter,this.events.on(e,t)}},{key:"add",value:function(e,t){var n=D(e+t),r=this.space();n>r&&(e=e/n*r,t=t/n*r),this.change(e,t)}},{key:"change",value:function(e,t){var n=D(this.water+e),r=D(this.sugar+t);this.validate(n,r),this.water=n,this.sugar=r,this.water<0&&(this.water=0),this.sugar<0&&(this.sugar=0),this.water+this.sugar>this.capacity&&(this.water>this.sugar?this.water=this.capacity-this.sugar:this.sugar=this.capacity-this.water)}},{key:"space",value:function(){return D(this.capacity-this.water-this.sugar)}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.water,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sugar,n=this.capacity;e<0&&console.warn("water < 0: ".concat(e)),t<0&&console.warn("sugar < 0: ".concat(t)),e+t>n&&console.warn("bad inventory: ".concat(e," water + ").concat(t," > ").concat(n," max"))}}]),e}();function L(e){return null!=e&&e.inventory instanceof I}var z={nw:new y.E(-1,-1),w:new y.E(-1,0),sw:new y.E(-1,1),n:new y.E(0,-1),s:new y.E(0,1),ne:new y.E(1,-1),e:new y.E(1,0),se:new y.E(1,1)},Y=Object.keys(z).map(function(e){return z[e]}),V=n(10),U=n(7),q=function(){function e(t,n,r){Object(s.a)(this,e),this.x=t,this.y=n,this.z=r}return Object(l.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,n){return this.x*e+this.y*t+this.z*n}}]),e}(),G=[new q(1,1,0),new q(-1,1,0),new q(1,-1,0),new q(-1,-1,0),new q(1,0,1),new q(-1,0,1),new q(1,0,-1),new q(-1,0,-1),new q(0,1,1),new q(0,-1,1),new q(0,1,-1),new q(0,-1,-1)],_=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],H=.5*(Math.sqrt(3)-1),X=(3-Math.sqrt(3))/6,Z=1/6,J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2147483647*Math.random();Object(s.a)(this,e),this.perm=new Array(512),this.gradP=new Array(512),this.octaveNum=6,this.octaveFalloff=.5,this.octaveMatrix2=[2*Math.cos(1),2*-Math.sin(1),2*Math.sin(1),2*Math.cos(1)],this.seed(t)}return Object(l.a)(e,[{key:"seed",value:function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?_[t]^255&e:_[t]^e>>8&255,this.perm[t]=this.perm[t+256]=n,this.gradP[t]=this.gradP[t+256]=G[n%12]}}}]),Object(l.a)(e,[{key:"simplex2",value:function(e,t){var n,r,i=(e+t)*H,a=Math.floor(e+i),o=Math.floor(t+i),s=(a+o)*X,l=e-a+s,u=t-o+s;l>u?(n=1,r=0):(n=0,r=1);var c=l-n+X,h=u-r+X,d=l-1+2*X,p=u-1+2*X;a&=255,o&=255;var v=this.gradP[a+this.perm[o]],f=this.gradP[a+n+this.perm[o+r]],m=this.gradP[a+1+this.perm[o+1]],y=.5-l*l-u*u,g=.5-c*c-h*h,w=.5-d*d-p*p;return 70*((y<0?0:(y*=y)*y*v.dot2(l,u))+(g<0?0:(g*=g)*g*f.dot2(c,h))+(w<0?0:(w*=w)*w*m.dot2(d,p)))}},{key:"octaveSimplex2",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.octaveNum,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveFalloff,i=0,a=e,o=t,s=1,l=0;l<n;l++){i+=this.simplex2(a,o)*s;var u=a*this.octaveMatrix2[0]+o*this.octaveMatrix2[1],c=a*this.octaveMatrix2[2]+o*this.octaveMatrix2[3];a=u,o=c,s*=r}return i}},{key:"simplex3",value:function(e,t,n){var r,i,a,o,s,l,u=(e+t+n)*(1/3),c=Math.floor(e+u),h=Math.floor(t+u),d=Math.floor(n+u),p=(c+h+d)*Z,v=e-c+p,f=t-h+p,m=n-d+p;v>=f?f>=m?(r=1,i=0,a=0,o=1,s=1,l=0):v>=m?(r=1,i=0,a=0,o=1,s=0,l=1):(r=0,i=0,a=1,o=1,s=0,l=1):f<m?(r=0,i=0,a=1,o=0,s=1,l=1):v<m?(r=0,i=1,a=0,o=0,s=1,l=1):(r=0,i=1,a=0,o=1,s=1,l=0);var y=v-r+Z,g=f-i+Z,w=m-a+Z,b=v-o+2*Z,k=f-s+2*Z,O=m-l+2*Z,E=v-1+.5,j=f-1+.5,x=m-1+.5;c&=255,h&=255,d&=255;var A=this.gradP,C=this.perm,M=A[c+C[h+C[d]]],T=A[c+r+C[h+i+C[d+a]]],S=A[c+o+C[h+s+C[d+l]]],R=A[c+1+C[h+1+C[d+1]]],P=.6-v*v-f*f-m*m,N=.6-y*y-g*g-w*w,F=.6-b*b-k*k-O*O,B=.6-E*E-j*j-x*x;return 32*((P<0?0:(P*=P)*P*M.dot3(v,f,m))+(N<0?0:(N*=N)*N*T.dot3(y,g,w))+(F<0?0:(F*=F)*F*S.dot3(b,k,O))+(B<0?0:(B*=B)*B*R.dot3(E,j,x)))}},{key:"octaveSimplex3",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveNum,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.octaveFalloff,a=0,o=e,s=t,l=n,u=1,c=0;c<r;c++)a+=this.simplex3(o,s,l)*u,o*=2,s*=2,l*=2,u*=i;return a}},{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,n){return(1-n)*e+n*t}},{key:"perlin2",value:function(e,t){var n=Math.floor(e),r=Math.floor(t);e-=n,t-=r,n&=255,r&=255;var i=this.gradP,a=this.perm,o=i[n+a[r]].dot2(e,t),s=i[n+a[r+1]].dot2(e,t-1),l=i[n+1+a[r]].dot2(e-1,t),u=i[n+1+a[r+1]].dot2(e-1,t-1),c=this.fade(e);return this.lerp(this.lerp(o,l,c),this.lerp(s,u,c),this.fade(t))}},{key:"perlin3",value:function(e,t,n){var r=this.gradP,i=this.perm,a=Math.floor(e),o=Math.floor(t),s=Math.floor(n);e-=a,t-=o,n-=s;var l=r[(a&=255)+i[(o&=255)+i[s&=255]]].dot3(e,t,n),u=r[a+i[o+i[s+1]]].dot3(e,t,n-1),c=r[a+i[o+1+i[s]]].dot3(e,t-1,n),h=r[a+i[o+1+i[s+1]]].dot3(e,t-1,n-1),d=r[a+1+i[o+i[s]]].dot3(e-1,t,n),p=r[a+1+i[o+i[s+1]]].dot3(e-1,t,n-1),v=r[a+1+i[o+1+i[s]]].dot3(e-1,t-1,n),f=r[a+1+i[o+1+i[s+1]]].dot3(e-1,t-1,n-1),m=this.fade(e),y=this.fade(t),g=this.fade(n);return this.lerp(this.lerp(this.lerp(l,d,m),this.lerp(u,p,m),g),this.lerp(this.lerp(c,v,m),this.lerp(h,f,m),g),y)}}]),e}(),Q=n(15),K={isRealtime:!0,environment:"Temperate",cellEnergyMax:1e4,tissueInventoryCapacity:6,rootTurnsPerTransfer:20,leafReactionRate:.01,leafSugarPerReaction:1,cellGestationTurns:0,cellDiffusionWater:.002,cellDiffusionSugar:.002,soilDarknessBase:.2,soilDiffusionType:"discrete",soilDiffusionWater:.001,veinDiffusion:.5,soilMaxWater:20,droop:.03,fountainTurnsPerWater:11,fountainAppearanceRate:1.5,transportTurnsPerMove:5,sunlightReintroduction:.15,sunlightDiffusion:0,maxResources:100},$=Object(Q.a)({},K);if(window.location.hash.length>0){var ee=JSON.parse(decodeURI(window.location.hash.substr(1)));Object.assign($,ee)}function te(){for(var e={},t=0,n=Object.keys(K);t<n.length;t++){var r=n[t],i=$[r];i!==K[r]&&(e[r]=i)}Object.keys(e).length>0?window.location.hash=encodeURI(JSON.stringify(e)):window.location.hash=""}function ne(e){return"number"===typeof e.energy}te();var re=function(){function e(t,n){if(Object(s.a)(this,e),this.world=n,this.isObstacle=!1,this.darkness=1/0,this.pos=void 0,this.pos=t.clone(),null==n)throw new Error("null world!")}return Object(l.a)(e,[{key:"diffusionWater",get:function(){return this.constructor.diffusionWater}},{key:"diffusionSugar",get:function(){return this.constructor.diffusionSugar}},{key:"fallAmount",get:function(){return this.constructor.fallAmount}}]),Object(l.a)(e,[{key:"lightAmount",value:function(){return Math.sqrt(Math.min(Math.max(P(1-this.darkness,0,1,0,1),0),1))}},{key:"step",value:function(){var e=this.world.tileNeighbors(this.pos);this.stepDarkness(e),this.stepDiffusion(e),this.stepGravity()}},{key:"stepDarkness",value:function(e){if(this instanceof he)this.darkness=0;else{var t=this.darkness,n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=Object(U.a)(s,2)[1],u=Math.max(.2,P(this.pos.y,Et/2,Et,$.soilDarknessBase,1)),c=l instanceof le?1/0:l.darkness+u;t=l instanceof he?0:Math.min(t,c)}}catch(d){r=!0,i=d}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.darkness=t;var h=null!=this.world.cellAt(this.pos.x,this.pos.y);h&&console.error("stepping environmental tile even when a cell is on-top:",h)}}},{key:"stepDiffusion",value:function(e){if(L(this)){var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=Object(U.a)(o,2),l=s[0],u=s[1];this.canDiffuse(l,u)&&(null!=this.diffusionWater&&u.inventory.water>this.inventory.water&&this.diffuseWater(u),null!=this.diffusionSugar&&u.inventory.sugar>this.inventory.sugar&&this.diffuseSugar(u))}}catch(c){n=!0,r=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}}},{key:"canDiffuse",value:function(e,t){return ie(this,t)}},{key:"diffuseWater",value:function(e){if(L(this))if("continuous"===$.soilDiffusionType){var t=(e.inventory.water-this.inventory.water)*this.diffusionWater;e.inventory.give(this.inventory,t,0)}else{var n=e.inventory.water-this.inventory.water,r=Math.min(n,1);Math.random()<n*this.diffusionWater*r&&e.inventory.give(this.inventory,1,0)}}},{key:"diffuseSugar",value:function(e){if(L(this)){var t=(e.inventory.sugar-this.inventory.sugar)*this.diffusionSugar;e.inventory.give(this.inventory,0,t)}}},{key:"stepGravity",value:function(){var e=this.fallAmount,t=this.world.tileAt(this.pos.x,this.pos.y+1);e>0&&this.world.time%Math.floor(1/e)<1&&L(t)&&ie(t,this)&&this.inventory.give(t.inventory,1,0)}}]),e}();function ie(e,t){return L(e)&&L(t)&&(e instanceof t.constructor||t instanceof e.constructor||e instanceof he&&t instanceof he||function(e,t,n,r){return e instanceof t&&n instanceof r}(e,se,t,oe))}re.displayName="Tile",re.fallAmount=0;var ae=new J,oe=function(e){function t(e,n){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n))).pos=e,r.sunlightCached=1,r._co2=void 0,r.inventory=new I(20,Object(R.a)(r)),r.darkness=0,r._co2=r.computeCo2(),r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"computeCo2",value:function(){var e=P(this.pos.y,Et/2,0,this.world.environment.floorCo2,1.15),t=P(this.pos.y,Et/2,0,4,9),n=null==this.world?0:this.world.time,r=.25*ae.perlin3(94.231+(this.pos.x-Ot/2)/t,2312+this.pos.y/8,n/1e3+93.1);return Math.max(Math.min(e+r,1),Math.min(.4,.75*this.world.environment.floorCo2))}},{key:"lightAmount",value:function(){return this.sunlight()}},{key:"step",value:function(){this.stepGravity(),this.stepDiffusion(this.world.tileNeighbors(this.pos)),this._co2=this.computeCo2()}},{key:"canDiffuse",value:function(e,n){return e!==z.s&&e!==z.sw&&e!==z.se&&Object(V.a)(Object(c.a)(t.prototype),"canDiffuse",this).call(this,e,n)}},{key:"co2",value:function(){return this._co2}},{key:"sunlight",value:function(){return this.sunlightCached}}]),t}(re);oe.displayName="Air",oe.fallAmount=1,oe.diffusionWater=.1;var se=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e,i))).inventory=new I($.soilMaxWater,Object(R.a)(n)),n.inventory.add(r,0),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"fallAmount",get:function(){return this.world.environment.waterGravityPerTurn}}]),Object(l.a)(t,[{key:"step",value:function(){Object(V.a)(Object(c.a)(t.prototype),"step",this).call(this),this.stepEvaporation()}},{key:"stepEvaporation",value:function(){var e=this.world.environment,t=e.evaporationRate,n=e.evaporationBottom,r=P(this.pos.y,Et/2,Et*n,1,0),i=this.inventory.water;Math.random()<t*r*i&&this.inventory.add(-1,0)}}]),t}(re);se.displayName="Soil",se.diffusionWater=$.soilDiffusionWater;var le=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).isObstacle=!0,n}return Object(h.a)(t,e),t}(re);le.displayName="Rock";var ue=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),t}(re);ue.displayName="Dead Cell";var ce=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e,r,i))).turnsPerWater=a,n.isObstacle=!0,n.cooldown=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(V.a)(Object(c.a)(t.prototype),"step",this).call(this),this.cooldown>0&&this.cooldown--,this.inventory.space()>1&&this.cooldown<=0&&(this.inventory.add(1,0),this.cooldown=this.turnsPerWater)}}]),t}(se);ce.displayName="Fountain";var he=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).energy=$.cellEnergyMax,n.darkness=0,n.droopY=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(V.a)(Object(c.a)(t.prototype),"step",this).call(this),this.energy-=1;var e=this.world.tileNeighbors(this.pos),n=Array.from(e.values()),r=[].concat(Object(v.a)(n),[this]),i=!0,a=!1,o=void 0;try{for(var s,l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;if(L(u)&&!(u instanceof me)){if(!(this.energy<$.cellEnergyMax))break;var h=$.cellEnergyMax-this.energy,d=Math.min(h/$.cellEnergyMax,u.inventory.sugar);u.inventory.add(0,-d);var p=d*$.cellEnergyMax;this.energy+=p}}}catch(E){a=!0,o=E}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}if(this.energy<$.cellEnergyMax){var f=r.filter(function(e){return ne(e)}),m=!0,y=!1,g=void 0;try{for(var w,b=f[Symbol.iterator]();!(m=(w=b.next()).done);m=!0){var k=w.value;if(!(this.energy<$.cellEnergyMax))break;var O=0;if(k.energy>this.energy){if(O=Math.floor(.25*(k.energy-this.energy)),k.energy-O<0)throw new Error("cell energy diffusion: taking more energy than available");if(this.energy+O>$.cellEnergyMax)throw new Error("cell energy diffusion: taking more energy than i can carry");this.energy+=O,k.energy-=O}}}catch(E){y=!0,g=E}finally{try{m||null==b.return||b.return()}finally{if(y)throw g}}}this.stepDroop(e),this.droopY>.5&&(this.world.player.pos.equals(this.pos)&&(this.world.player.pos.y+=1),this.world.maybeRemoveCellAt(this.pos),this.pos.y<Et-1&&(this.pos.y+=1),this.droopY-=1,this.world.setTileAt(this.pos,this)),this.energy<=0&&this.world.setTileAt(this.pos,new ue(this.pos,this.world))}},{key:"stepDroop",value:function(e){var n=e.get(z.s),r=e.get(z.sw),i=e.get(z.se),a=e.get(z.w),o=e.get(z.e),s=e.get(z.n),l=e.get(z.nw),u=e.get(z.ne);this.droopY+=$.droop,this.energy<$.cellEnergyMax/2&&(this.droopY+=$.droop);for(var c=!1,h=0,d=[n,r,i];h<d.length;h++){var p=d[h];if(p instanceof le||p instanceof se)return void(this.droopY=Math.min(this.droopY,0));if(p instanceof t)return this.droopY=Math.min(this.droopY,p.droopY),void(c=!0)}var v=[l,s,u,a,o,this].filter(function(e){return e instanceof t});c||1!==v.length?this.droopY=v.reduce(function(e,t){return e+t.droopY},0)/v.length:this.droopY+=1}}]),t}(re);he.displayName="Cell",he.diffusionWater=$.cellDiffusionWater,he.diffusionSugar=$.cellDiffusionSugar,he.turnsToBuild=$.cellGestationTurns;var de=function(e){function t(e,n,r){var i;return Object(s.a)(this,t),(i=Object(u.a)(this,Object(c.a)(t).call(this,e,n))).completedCell=r,i.isObstacle=!0,i.timeRemaining=void 0,i.timeToBuild=void 0,i.timeRemaining=i.timeToBuild=r.constructor.turnsToBuild||0,i}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(V.a)(Object(c.a)(t.prototype),"step",this).call(this),this.timeRemaining--,this.timeRemaining<=0&&this.world.setTileAt(this.completedCell.pos,this.completedCell)}}]),t}(he),pe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).inventory=new I($.tissueInventoryCapacity,Object(R.a)(n)),n}return Object(h.a)(t,e),t}(he);pe.displayName="Tissue";var ve=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).isObstacle=!0,n.averageEfficiency=0,n.averageSpeed=0,n.didConvert=!1,n.sugarConverted=0,n.tilePairs=[],n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(V.a)(Object(c.a)(t.prototype),"step",this).call(this),this.didConvert=!1;var e=this.world.tileNeighbors(this.pos);this.averageEfficiency=0,this.averageSpeed=0,this.sugarConverted=0;var n=0;this.tilePairs=[];var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value,u=Object(U.a)(l,2),h=u[0],d=u[1],p=this.world.tileAt(this.pos.x-h.x,this.pos.y-h.y);if(d instanceof oe&&p instanceof pe){n+=1,this.tilePairs.push(h);var v=d,f=p,m=v.sunlight(),y=v.co2();this.averageEfficiency+=y,this.averageSpeed+=m;var g=$.leafSugarPerReaction/y,w=Math.min(f.inventory.water,g),b=m*$.leafReactionRate*w/g;if(Math.random()<b){this.didConvert=!0;var k=w*y;f.inventory.add(-w,k),this.sugarConverted+=k}}}}catch(O){i=!0,a=O}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}n>0&&(this.averageEfficiency/=n)}}]),t}(he);ve.displayName="Leaf";var fe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).waterTransferAmount=0,n.activeNeighbors=[],n.inventory=new I($.tissueInventoryCapacity,Object(R.a)(n)),n.cooldown=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(V.a)(Object(c.a)(t.prototype),"step",this).call(this),this.cooldown<=0&&(this.stepWaterTransfer(),this.cooldown+=$.rootTurnsPerTransfer),this.cooldown-=1}},{key:"stepWaterTransfer",value:function(){this.waterTransferAmount=0,this.activeNeighbors=[];var e=this.world.tileNeighbors(this.pos),t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=Object(U.a)(o,2),l=s[0],u=s[1];if(u instanceof se){this.activeNeighbors.push(l);var c=u.inventory.give(this.inventory,1,0).water;this.waterTransferAmount+=c+1e-4*Math.random()}}}catch(h){n=!0,r=h}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}}]),t}(he);fe.displayName="Root";var me=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).isObstacle=!0,n.inventory=new I(t.sugarToWin+100,Object(R.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){Object(V.a)(Object(c.a)(t.prototype),"step",this).call(this);var e=this.world.tileNeighbors(this.pos),n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=Object(U.a)(s,2)[1];L(l)&&l.inventory.give(this.inventory,0,l.inventory.sugar)}}catch(u){r=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}]),t}(he);me.displayName="Fruit",me.sugarToWin=200;var ye=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).dir=void 0,n.cooldown=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){if(this.energy-=1,Object(V.a)(Object(c.a)(t.prototype),"step",this).call(this),this.cooldown<=0){this.cooldown+=$.transportTurnsPerMove;var e=this.getTarget();e&&this.inventory.give(e.inventory,1,1);var n=this.getFrom();n&&n.inventory.give(this.inventory,1,1)}this.cooldown-=1}},{key:"getTarget",value:function(){var e=this.world.tileAt(this.pos.x+this.dir.x,this.pos.y+this.dir.y);if(e instanceof he&&L(e))return e}},{key:"getFrom",value:function(){var e=this.world.tileAt(this.pos.x-this.dir.x,this.pos.y-this.dir.y);if(e instanceof he&&L(e))return e}}]),t}(pe);ye.displayName="Transport";var ge=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).inventory=new I(8,Object(R.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"diffusionWater",get:function(){return $.veinDiffusion}},{key:"diffusionSugar",get:function(){return $.veinDiffusion}}]),t}(pe);ge.displayName="Vein";var we={j:{type:"drop",sugar:0,water:10},k:{type:"drop",sugar:10,water:0},".":{type:"still"}},be={w:{type:"move",dir:z.n},a:{type:"move",dir:z.w},s:{type:"move",dir:z.s},d:{type:"move",dir:z.e},q:{type:"move",dir:z.nw},e:{type:"move",dir:z.ne},z:{type:"move",dir:z.sw},c:{type:"move",dir:z.se}},ke=Object.keys(be).map(function(e){return be[e]}),Oe={u:pe,l:ve,o:fe,p:ye,i:me},Ee=function(){function e(t,n){Object(s.a)(this,e),this.pos=t,this.world=n,this.inventory=new I($.maxResources,this,Math.round($.maxResources/3),Math.round($.maxResources/3)),this.action=void 0,this.events=new W.EventEmitter,this.actionQueue=[],this.mapActions=void 0}return Object(l.a)(e,[{key:"setActions",value:function(e){this.actionQueue=e}},{key:"setAction",value:function(e){this.action=e,this.actionQueue=[]}},{key:"getAction",value:function(){return this.action}},{key:"droopY",value:function(){var e=this.world.tileAt(this.pos.x,this.pos.y);return e instanceof he?e.droopY:0}},{key:"droopPos",value:function(){var e=this.droopY();if(0!==e){var t=this.pos.clone();return t.y+=e,t}return this.pos}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"step",value:function(){if(void 0===this.action&&(this.action=this.actionQueue.shift()||{type:"none"}),this.mapActions){var e=this.mapActions(this,this.action);if(Array.isArray(e)){var t,n=Object(B.a)(e),r=n[0],i=n.slice(1);this.action=r,(t=this.actionQueue).unshift.apply(t,Object(v.a)(i))}else this.action=null!=e?e:{type:"none"}}this.attemptAction(this.action)&&this.events.emit("action",this.action),this.action=void 0}},{key:"attemptAction",value:function(e){switch(e.type){case"none":return!0;case"still":return this.attemptStill();case"move":return this.attemptMove(e);case"build":return this.attemptBuild(e);case"build-transport":return this.attemptBuildTransport(e);case"deconstruct":return this.attemptDeconstruct(e);case"drop":return this.attemptDrop(e);case"multiple":return this.attemptMultiple(e)}}},{key:"verifyMove",value:function(e){var t=this.pos.clone().add(e.dir);return this.isWalkable(t)}},{key:"isWalkable",value:function(e){if(e instanceof re&&(e=e.pos),!this.world.isValidPosition(e.x,e.y))return!1;var t=this.world.tileAt(e.x,e.y);return t instanceof he&&null!=t&&!t.isObstacle}},{key:"isBuildCandidate",value:function(e){if(null==e||this.isWalkable(e)||e.isObstacle)return!1;var t=e.pos.clone().sub(this.pos);return null!=ke.find(function(e){return e.dir.equals(t)})}},{key:"attemptMove",value:function(e){return!!this.verifyMove(e)&&(E.audio.currentTime=.05*Math.random(),E.gain.gain.cancelScheduledValues(0),E.gain.gain.value=1,E.gain.gain.linearRampToValueAtTime(0,E.gain.context.currentTime+.05),this.pos.add(e.dir),this.autopickup(),!0)}},{key:"attemptStill",value:function(){return this.autopickup(),!0}},{key:"autopickup",value:function(){var e=this.currentTile();if(L(e)){var t=e.inventory;t.give(this.inventory,t.water,t.sugar)}}},{key:"tryConstructingNewCell",value:function(e,t){e=e.clone();var n=this.world.tileAt(e.x,e.y);if(null!=n&&(null==this.world.fruit||t!==me)&&!(n instanceof me)){if(!(n instanceof t&&!(t===ye&&n instanceof ye))&&!n.isObstacle&&this.inventory.water>=1&&this.inventory.sugar>=1){this.inventory.add(-1,-1);var r=new t(e,this.world);return j.audio.currentTime=0,j.gain.gain.cancelScheduledValues(0),j.gain.gain.value=.2,j.gain.gain.exponentialRampToValueAtTime(1e-4,j.gain.context.currentTime+.5),r}}}},{key:"attemptBuild",value:function(e){var t=this.world.cellAt(e.position.x,e.position.y);if(null!=t&&t.constructor===e.cellType)return!0;t&&this.attemptDeconstruct({type:"deconstruct",position:e.position,force:!0});var n,r=this.tryConstructingNewCell(e.position,e.cellType);return null!=r&&((n=e.cellType.turnsToBuild?new de(e.position,this.world,r):r).droopY=this.droopY(),this.world.setTileAt(e.position,n),this.isWalkable(n)&&this.attemptMove({type:"move",dir:e.position.clone().sub(this.pos)}),!0)}},{key:"attemptBuildTransport",value:function(e){if(null==e.dir)return console.error("null dir",e),!0;this.world.cellAt(e.position.x,e.position.y)&&this.attemptDeconstruct({type:"deconstruct",position:e.position,force:!0});var t=this.tryConstructingNewCell(e.position,e.cellType);return null!=t&&(t.dir=e.dir,this.world.setTileAt(e.position,t),this.attemptMove({type:"move",dir:e.dir}),!0)}},{key:"attemptDeconstruct",value:function(e){if(!e.position.equals(this.pos)||e.force){var t=this.world.maybeRemoveCellAt(e.position);if(null!=t){var n=t.energy/$.cellEnergyMax;return this.inventory.add(n,n),L(t)&&t.inventory.give(this.inventory,t.inventory.water,t.inventory.sugar),!0}}return!1}},{key:"attemptDrop",value:function(e){var t=this.currentTile();if(L(t)){var n=e.water,r=e.sugar;return t.inventory.give(this.inventory,r,n),this.inventory.give(t.inventory,n,r),!0}return!1}},{key:"attemptMultiple",value:function(e){var t=!0,n=!0,r=!1,i=void 0;try{for(var a,o=e.actions[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t=this.attemptAction(s)&&t}}catch(l){r=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}}]),e}(),je=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(s.a)(this,e),this.deleted=t,this.added=n},xe=function(){function e(t){var n=this;Object(s.a)(this,e),this.environment=t,this.time=0,this.player=new Ee(new y.E(Ot/2,Et/2),this),this.fruit=void 0,this.gridEnvironment=void 0,this.gridCells=void 0,this.neighborCache=void 0,this.cachedEntities=void 0,this.stepStats=new je,this.gridEnvironment=new Array(Ot).fill(void 0).map(function(e,r){return new Array(Et).fill(void 0).map(function(e,i){var a,o=new y.E(r,i),s=!0,l=!1,u=void 0;try{for(var c,h=t.fill[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=(0,c.value)(o,n);if(null!=d){a=d;break}}}catch(p){l=!0,u=p}finally{try{s||null==h.return||h.return()}finally{if(l)throw u}}return null==a&&(a=new oe(o,n)),a})});var r=this.player.pos.x,i=this.gridEnvironment[r].find(function(e){return!(e instanceof oe)});i&&(this.player.pos.y=i.pos.y);this.gridCells=new Array(Ot).fill(void 0).map(function(e,t){return new Array(Et).fill(void 0).map(function(e,r){var i=new y.E(t,r);return n.player.pos.distanceTo(i)<2.5?(n.gridEnvironment instanceof le&&(n.gridEnvironment[t][r]=new se(new y.E(t,r),0,n)),new pe(i,n)):null})}),this.neighborCache=new Array(Ot).fill(void 0).map(function(e,t){return new Array(Et).fill(void 0).map(function(e,r){return n.computeTileNeighbors(t,r)})}),this.fillCachedEntities()}return Object(l.a)(e,[{key:"tileAt",value:function(e,t){var n;if(e instanceof y.E?(n=e.x,t=e.y):(n=e,t=t),!this.isValidPosition(n,t))return null;var r=this.gridCells[n][t];return null!=r?r:this.gridEnvironment[n][t]}},{key:"cellAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridCells[e][t]:null}},{key:"environmentTileAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridEnvironment[e][t]:null}},{key:"setTileAt",value:function(e,t){var n=e.x,r=e.y;if(!this.isValidPosition(n,r))throw new Error("invalid position ".concat(n,", ").concat(r," "));t instanceof me&&(null==this.fruit?this.fruit=t:console.warn("made multiple Fruit!"));var i=this.tileAt(n,r);L(i)&&(L(t)&&i.inventory.give(t.inventory,i.inventory.water,i.inventory.sugar),0===i.inventory.water&&0===i.inventory.sugar||(console.warn("lost",i.inventory,"resources to building"),i.inventory.add(-i.inventory.water,-i.inventory.sugar)));var a=this.gridCells[n][r];if(null!=a&&this.stepStats.deleted.push(a),t instanceof he)this.gridCells[n][r]=t;else{this.gridCells[n][r]=null;var o=this.gridEnvironment[n][r];null!=o&&this.stepStats.deleted.push(o),this.gridEnvironment[n][r]=t}this.stepStats.added.push(t),this.handleTileUpdated(e)}},{key:"maybeRemoveCellAt",value:function(e){var t=this.cellAt(e.x,e.y);return t&&(this.gridCells[e.x][e.y]=null,t===this.fruit&&(this.fruit=void 0),this.stepStats.deleted.push(t)),this.handleTileUpdated(e),t}},{key:"isValidPosition",value:function(e,t){return!(e>=Ot||e<0||t>=Et||t<0)}},{key:"tileNeighbors",value:function(e){return this.neighborCache[e.x][e.y]}},{key:"computeTileNeighbors",value:function(e,t){var n=this,r=new Map;return Ce[this.time%Ce.length].forEach(function(i){var a=e+i.x,o=t+i.y,s=n.tileAt(a,o);null!=s&&r.set(i,s)}),r}},{key:"entities",value:function(){if(null==this.cachedEntities)throw new Error("accessed entities before filling");return this.cachedEntities}},{key:"handleTileUpdated",value:function(e){this.neighborCache[e.x][e.y]=this.computeTileNeighbors(e.x,e.y);var t=!0,n=!1,r=void 0;try{for(var i,a=Y[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=e.x+o.x,l=e.y+o.y;this.isValidPosition(s,l)&&(this.neighborCache[s][l]=this.computeTileNeighbors(s,l))}}catch(u){n=!0,r=u}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}this.fillCachedEntities()}},{key:"fillCachedEntities",value:function(){var e=[],t=0,n=0;for(t=0;t<Ot;t++)for(n=(t+this.time)%2;n<Et;n+=2)e.push(this.tileAt(t,n));for(t=0;t<Ot;t++)for(n=(t+this.time+1)%2;n<Et;n+=2)e.push(this.tileAt(t,n));this.time%4<2&&e.reverse(),e.push(this.player),this.cachedEntities=e}},{key:"step",value:function(){var e=this.entities();return this.stepStats=new je,e.forEach(function(e){"function"===typeof e.step&&e.step()}),this.computeSunlight(),this.stepWeather(),this.time++,this.fillCachedEntities(),this.stepStats}},{key:"stepWeather",value:function(){if((this.time+this.environment.climate.turnsBetweenRainfall-200)%this.environment.climate.turnsBetweenRainfall<this.environment.climate.rainDuration){var e=y.p.randInt(0,Ot-1),t=this.tileAt(e,0);t instanceof oe&&t.inventory.add(this.environment.climate.waterPerDroplet,0)}}},{key:"computeSunlight",value:function(){for(var e=this.time*Math.PI*2/1e3,t=Math.sin(e+Math.PI/2),n=Math.atan(12*Math.sin(e))/(Math.PI/2)*.5+.5,r=0;r<=.6*Et;r++)for(var i=0;i<Ot;i++){var a=this.environmentTileAt(i,r);if(a instanceof oe){var o=0;if(0===r)o=1;else{var s=this.tileAt(i,r-1),l=this.tileAt(i+1,r-1),u=this.tileAt(i-1,r-1),c=s instanceof oe?s.sunlightCached/n:null==s?1:0,h=l instanceof oe?l.sunlightCached/n:null==l?1:0,d=u instanceof oe?u.sunlightCached/n:null==u?1:0;o=(o=t>0?h*t+c*(1-t):d*-t+c*(1- -t))*(1-$.sunlightDiffusion)+(c+h+d)/3*$.sunlightDiffusion}o=$.sunlightReintroduction+o*(1-$.sunlightReintroduction),o*=n,a.sunlightCached=o}}}},{key:"checkWinLoss",value:function(){return null!=this.fruit&&this.fruit.inventory.sugar>me.sugarToWin?"win":this.tileAt(this.player.pos.x,this.player.pos.y)instanceof ue?"lose":null}},{key:"checkResources",value:function(){this.entities().forEach(function(e){L(e)&&(e.inventory.sugar,e.inventory.water),ne(e)&&e.energy})}}]),e}();function Ae(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}var Ce=[Ae(Y.slice()),Ae(Y.slice()),Ae(Y.slice()),Ae(Y.slice()),Ae(Y.slice())],Me=n(23);function Te(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ne(function(t,n,r){var i=e.tileAt(t,n);null!=i&&e.player.isWalkable(i)&&r.setWalkableAt(t,n,!0)});r.setWalkableAt(t.x,t.y,!0);var i=Pe(r,e.player.pos,t);return e.tileAt(t)instanceof he||n?i:(i.pop(),i)}function Se(e,t){return Pe(Ne(function(t,n,r){var i=e.tileAt(t,n);(i instanceof pe||!(i instanceof he)&&!i.isObstacle)&&r.setWalkableAt(t,n,!0)}),e.player.pos,t)}function Re(e){for(var t=[],n=0;n<e.length-1;n++){var r=Object(U.a)(e[n],2),i=r[0],a=r[1],o=Object(U.a)(e[n+1],2),s=Fe(i,a,o[0],o[1]);if(null==s)throw new Error("couldn't find corresponding movement action");t.push(s)}return t}function Pe(e,t,n){return new Me.AStarFinder({diagonalMovement:Me.DiagonalMovement.Always}).findPath(t.x,t.y,n.x,n.y,e)}function Ne(e){for(var t=new Me.Grid(Ot,Et),n=0;n<Ot;n++)for(var r=0;r<Et;r++)t.setWalkableAt(n,r,!1);for(var i=0;i<Ot;i++)for(var a=0;a<Et;a++)e(i,a,t);return t}function Fe(e,t,n,r){var i=n-e,a=r-t;return ke.find(function(e){var t=e.dir;return t.x===i&&t.y===a})}function Be(e){var t;return function(){return void 0===t&&(t=e()),t}}var We=16,De=!1,Ie=Be(function(){return(new y.D).load("assets/images/roguelikeSheet_transparent.png",function(){Ie().dispatchEvent({type:"update"}),De=!0})}),Le=(new y.D).load("assets/images/fruit.png"),ze={};function Ye(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";e=Math.floor(e),t=Math.floor(t);var r="".concat(e,",").concat(t);if(null==ze[r]){var i=function(){var r=Ie().image,i=a.getContext("2d");i.fillStyle=n,i.fillRect(0,0,We,16),i.drawImage(r,We*e,We*t,We,We,0,0,We,We),o.needsUpdate=!0},a=document.createElement("canvas");a.width=We,a.height=We;var o=new y.C(a);o.magFilter=y.s,o.flipY=!0,o.wrapS=y.z,o.wrapT=y.z,De?i():Ie().addEventListener("update",function(){i()}),ze[r]=o}return ze[r]}var Ve=function e(t,n,r){Object(s.a)(this,e),this.target=t,this.scene=n,this.mito=r},Ue=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this))).geometry=void 0,n.material=void 0,n.index=0,n.geometry=t.newGeometry(),n.material=new qe(e),n.frustumCulled=!1,n}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"newGeometry",value:function(){var e=new y.g,n=new Float32Array(3*t.BUFFER_SIZE),r=new Float32Array(t.BUFFER_SIZE);return e.addAttribute("position",new y.f(n,3).setDynamic(!0)),e.addAttribute("size",new y.f(r,1).setDynamic(!0)),e}}]),Object(l.a)(t,[{key:"startFrame",value:function(){this.index=0}},{key:"commit",value:function(e,t,n,r){this.geometry.attributes.position.setXYZ(this.index,e,t,n),this.geometry.attributes.size.setX(this.index,r),this.index++}},{key:"endFrame",value:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.setDrawRange(0,this.index)}}]),t}(y.x);Ue.BUFFER_SIZE=1e5;var qe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,{uniforms:{opacity:{value:e.opacity},sizeGlobal:{value:e.size},color:{value:e.color},map:{value:e.map}},vertexShader:Ge,fragmentShader:_e,depthTest:!1,transparent:!0}))).params=e,n.map=void 0,n.map=e.map,n}return Object(h.a)(t,e),t}(y.B),Ge="\nattribute float size;\nuniform float sizeGlobal;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",_e="\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\n#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n\nvoid main() {\n    gl_FragColor = vec4( color, opacity );\n\n    #ifdef USE_MAP\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\n        gl_FragColor *= mapTexelToLinear( mapTexel );\n    #endif\n}\n",He=function(e){function t(e,n,r){var i;Object(s.a)(this,t),(i=Object(u.a)(this,Object(c.a)(t).call(this,e,n,r))).animationOffset=0,i.waters=[],i.sugars=[],i.handleGetResources=function(e){for(var t=Math.ceil(i.target.water);i.waters.length<t;){var n=e.carrier.pos.clone().sub(i.target.carrier.pos);n.x+=.1*(Math.random()-.5),n.y+=.1*(Math.random()-.5),i.waters.push(n)}for(t=Math.ceil(i.target.sugar);i.sugars.length<t;){var r=e.carrier.pos.clone().sub(i.target.carrier.pos);r.x+=.1*(Math.random()-.5),r.y+=.1*(Math.random()-.5),i.sugars.push(r)}},i.handleGiveResources=function(){var e=Math.ceil(i.target.water);i.waters.length>e&&i.waters.splice(e,i.waters.length-e),e=Math.ceil(i.target.sugar),i.sugars.length>e&&i.sugars.splice(e,i.sugars.length-e)},e.on("get",i.handleGetResources),e.on("give",i.handleGiveResources);for(var a=0;a<i.target.water;a++)i.waters.push(Xe());for(var o=0;o<i.target.sugar;o++)i.sugars.push(Xe());return i}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"startFrame",value:function(){t.WaterParticles().startFrame(),t.SugarParticles().startFrame()}},{key:"endFrame",value:function(){t.WaterParticles().endFrame(),t.SugarParticles().endFrame()}}]),Object(l.a)(t,[{key:"updateNumParticles",value:function(e){}},{key:"commitParticles",value:function(e,t,n){if(n.length>0){for(var r=0;r<n.length-1;r++){var i=n[r];e.commit(i.x+this.target.carrier.pos.x,i.y+this.target.carrier.pos.y,10,1),t-=1}var a=n[n.length-1],o=t;e.commit(a.x+this.target.carrier.pos.x,a.y+this.target.carrier.pos.y,10,o)}}},{key:"simulateResourcePositions",value:function(){var e=this.waters.concat(this.sugars),t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=0,l=0,u=performance.now()/3e3+this.animationOffset;s+=.02*Math.cos(u);var c=.1+.1*o.length();if(s+=-o.x*c,l+=-o.y*c,this.mito.world.player.pos.equals(this.target.carrier.pos)){var h=Math.max(Math.min(P(o.lengthSq(),0,1,3,-5),3),0),d=o.clone().multiplyScalar(.2*h);s+=d.x,l+=d.y}var p=!0,v=!1,f=void 0;try{for(var m,y=e[Symbol.iterator]();!(p=(m=y.next()).done);p=!0){var g=m.value;if(o===g)break;var w=o.x-g.x,b=o.y-g.y,k=w*w+b*b;if(k>0){var O=.003/k;s+=w*O,l+=b*O}}}catch(E){v=!0,f=E}finally{try{p||null==y.return||y.return()}finally{if(v)throw f}}o.x+=s,o.y+=l}}catch(E){n=!0,r=E}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"update",value:function(){this.updateNumParticles(this.target.water),this.updateNumParticles(this.target.sugar),this.simulateResourcePositions(),this.commitParticles(t.WaterParticles(),this.target.water,this.waters),this.commitParticles(t.SugarParticles(),this.target.sugar,this.sugars)}},{key:"destroy",value:function(){}}]),t}(Ve);function Xe(){return new y.E(.01*(Math.random()-.5),.01*(Math.random()-.5))}He.WaterParticles=Be(function(){return new Ue({color:new y.i("rgb(9, 12, 255)"),size:45,opacity:.75})}),He.SugarParticles=Be(function(){return new Ue({color:new y.i("yellow"),size:85,opacity:.9,map:Ye(42,12,"transparent")})});var Ze=new y.w(1,1);function Je(e){var t=document.createElement("canvas");t.width=64,t.height=64;var n=t.getContext("2d");n.font="".concat(32,"px monospace"),n.textAlign="center",n.textBaseline="middle",n.fillStyle="white",n.fillText(e,32,32);var r=new y.h(t);r.flipY=!0;var i=new y.r({map:r,transparent:!0,side:y.j});return new y.q(Ze,i)}Ze.rotateX(Math.PI);var Qe=new Map;for(var Ke in be)Qe.set(Ke,Je(Ke));var $e=function(e){function t(e,n,r){var i;return Object(s.a)(this,t),(i=Object(u.a)(this,Object(c.a)(t).call(this,e,n,r))).mesh=void 0,i.mesh=new y.q(new y.v(1,1),new y.r({transparent:!0,depthWrite:!1,depthTest:!1,map:Ye(29,12,"transparent"),color:new y.i("white"),side:y.j})),jt(i.mesh.position,i.target.pos,1),i.mesh.position.z=2,i.scene.add(i.mesh),i}return Object(h.a)(t,e),Object(l.a)(t,[{key:"update",value:function(){jt(this.mesh.position,this.target.droopPos(),.5),this.mesh.position.z=2;var e=!0,t=!1,n=void 0;try{for(var r,i=Qe[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value,o=Object(U.a)(a,2),s=o[0],l=o[1],u=be[s],c=this.target.pos.x+u.dir.x,h=this.target.pos.y+u.dir.y;this.target.isBuildCandidate(this.mito.world.tileAt(c,h))&&"main"===this.mito.uiState.type?(this.scene.add(l),l.position.x=c,l.position.y=h,l.position.z=2):this.scene.remove(l)}}catch(d){t=!0,n=d}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(Ve),et=function(e){function t(e){var n,r;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,t.geometry,(r=e.target,nt().get(r.constructor).clone())))).renderer=e,n}return Object(h.a)(t,e),t}(y.q);et.geometry=new y.v(1,1);var tt=function(e){function t(e,n,r){var i;Object(s.a)(this,t),(i=Object(u.a)(this,Object(c.a)(t).call(this,e,n,r))).mesh=void 0,i.inventoryRenderer=void 0,i.originalColor=void 0,i.audio=void 0,i.lastAudioValueTracker=0,i.pairsLines=[],i.growingRenderer=void 0,i.target instanceof de?(i.growingRenderer=new t(i.target.completedCell,i.scene,i.mito),i.mesh=i.growingRenderer.mesh):i.mesh=new et(Object(R.a)(i)),i.originalColor=i.mesh.material.color.clone(),L(i.target)&&(i.inventoryRenderer=new He(i.target.inventory,i.scene,i.mito),i.inventoryRenderer.animationOffset=(i.target.pos.x+i.target.pos.y)/2),i.scene.add(i.mesh);var a=i.target instanceof he?1:0;return i.mesh.position.set(i.target.pos.x,i.target.pos.y,a),i.target instanceof he?i.target.constructor.turnsToBuild||i.mesh.scale.set(.01,.01,1):i.mesh.matrixAutoUpdate=!1,i.mesh.updateMatrix(),(i.target instanceof ve||i.target instanceof fe)&&(i.audio=new y.b(i.mito.audioListener),i.mesh.add(i.audio)),i}return Object(h.a)(t,e),Object(l.a)(t,[{key:"steps",value:function(e,t){return Math.floor(e/t)*t}},{key:"update",value:function(){var e=this;if(this.target instanceof de){var t=P(1.001-this.target.timeRemaining/this.target.timeToBuild,0,1,.2,1);jt(this.mesh.scale,{x:t,y:t},.1)}else jt(this.mesh.scale,new y.E(1,1),.1);var n=this.target.lightAmount(),r=this.mesh.material;if(this.target instanceof oe){var i=Math.max(0,P(this.target.co2(),1/6,1.001,0,rt.length-1)),a=Math.floor(i),o=rt[a];if(this.originalColor=o.clone(),a!==rt.length-1){var s=i-a,l=rt[a+1];this.originalColor.lerp(l,s)}}if(r.color=new y.i(0).lerp(this.originalColor,P(n,0,1,.2,1)),this.target instanceof he&&this.mesh.position.set(this.target.pos.x,this.target.pos.y+this.target.droopY,1),ne(this.target)&&r.color.lerp(new y.i(0),1-this.target.energy/$.cellEnergyMax),null!=this.inventoryRenderer&&n>0&&this.inventoryRenderer.update(),this.target instanceof ve&&null!=this.audio){var u=this.target.didConvert?1:0;if(u!==this.lastAudioValueTracker&&u>0){this.audio.setBuffer(x);var c=this.target.pos.distanceToSquared(this.mito.world.player.pos),h=Math.min(1,1/(1+c/25))*this.target.sugarConverted*this.target.sugarConverted;this.audio.setVolume(h),this.audio.play()}this.lastAudioValueTracker=u}if(this.target instanceof fe&&null!=this.audio){var d=this.target.waterTransferAmount;if(d!==this.lastAudioValueTracker){this.audio.setBuffer(A);var p=this.target.waterTransferAmount/(2+this.target.waterTransferAmount),v=this.target.pos.distanceToSquared(this.mito.world.player.pos),f=Math.min(1,1/(1+v/25))*p;this.audio.setVolume(f),null!=this.audio.source&&this.audio.stop(),this.audio.play()}this.lastAudioValueTracker=d}if(this.target.tilePairs instanceof Array){var m=this.target instanceof ve?16763150:new y.i("rgb(9, 12, 255)").getHex(),g=this.target.tilePairs;g.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=g.map(function(t){var n=2*t.length()-.25,r=new y.F(t.x,t.y,0).normalize(),i=e.makeLine(r,r.clone().multiplyScalar(-n/2),n,m);return e.mesh.add(i),i}))}if(this.hasActiveNeighbors(this.target)){var w=this.target instanceof fe?new y.i("rgb(9, 12, 255)").getHex():16777215,b=this.target.activeNeighbors;b.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=b.map(function(t){var n=t.length()-.25,r=new y.F(t.x,t.y,0).normalize(),i=e.target instanceof fe?e.makeLine(r,new y.F,n,w):new y.a(r,new y.F(0,0,5),n,w);return e.mesh.add(i),i}))}}},{key:"hasActiveNeighbors",value:function(e){return Array.isArray(e.activeNeighbors)}},{key:"makeLine",value:function(e,n,r,i){var a=new y.m(t.lineGeometry,new y.n({color:i}));if(a.position.copy(n),e.y>.99999)a.quaternion.set(0,0,0,1);else if(e.y<-.99999)a.quaternion.set(1,0,0,0);else{var o=new y.F(e.z,0,-e.x).normalize(),s=Math.acos(e.y);a.quaternion.setFromAxisAngle(o,s)}return a.scale.set(1,Math.max(0,r),1),a.position.z=.1,a.updateMatrix(),a.matrixAutoUpdate=!1,a}},{key:"destroy",value:function(){this.scene.remove(this.mesh),null!=this.inventoryRenderer&&this.inventoryRenderer.destroy()}}]),t}(Ve);tt.lineGeometry=function(){var e=new y.g;return e.addAttribute("position",new y.l([0,0,0,0,1,0],3)),e}();var nt=Be(function(){var e=new Map;return e.set(oe,new y.r({side:y.j,depthWrite:!1})),e.set(se,new y.r({map:Ye(8,11),side:y.j,color:new y.i("rgb(112, 89, 44)"),depthWrite:!1})),e.set(ce,new y.r({map:Ye(3.5,2.375),side:y.j})),e.set(le,new y.r({map:Ye(26,20),side:y.j,color:new y.i("rgb(63, 77, 84)")})),e.set(ue,new y.r({map:Ye(8.5625,23.375),side:y.j,color:new y.i("rgb(128, 128, 128)")})),e.set(pe,new y.r({map:Ye(6,31),side:y.j,color:new y.i(3190309)})),e.set(ye,e.get(pe)),e.set(ve,new y.r({map:Ye(55/16,17.5),side:y.j})),e.set(fe,new y.r({map:Ye(59/16,327/16),side:y.j})),e.set(me,new y.r({map:Le,side:y.j,transparent:!0})),e.set(ge,new y.r({map:Ye(Math.floor(11.5),Math.floor(9.5)),side:y.j})),e});var rt=[new y.i("hsl(67, 31%, 25%)"),new y.i("hsl(180, 31%, 76%)"),new y.i("hsl(213, 63%, 58%)")],it=function(e){function t(e,n,r){var i;return Object(s.a)(this,t),(i=Object(u.a)(this,Object(c.a)(t).call(this,e,n,r))).arrow=void 0,i.arrow=i.makeArrow(i.target.dir),i.mesh.add(i.arrow),i}return Object(h.a)(t,e),Object(l.a)(t,[{key:"makeArrow",value:function(e){var t=e.length()-.25,n=new y.F(e.x,e.y,0).normalize(),r=n.clone().multiplyScalar(-t/2);return new y.a(n,new y.F(r.x,r.y,1),t,16777215,.1,.1)}}]),t}(tt),at=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.props.parent.add(this.props.object)}},{key:"componentWillUnmount",value:function(){this.props.parent.remove(this.props.object)}}]),t}(r.PureComponent),ot=Be(function(){var e=new y.v(1,1),t=new y.k(e,1),n=new y.n({color:16777215,transparent:!0,opacity:.75}),r=new y.o(t,n);return r.position.z=10,r}),st=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).object=ot().clone(),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(lt,{a:function(t){return e.object.scale.setScalar(.04*Math.sin(3.7*t)+.94)}}),r.createElement(at,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),lt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).rafid=void 0,n.animate=function(e){n.props.a(e/1e3),n.rafid=requestAnimationFrame(n.animate)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.rafid=requestAnimationFrame(this.animate)}},{key:"componentWillUnmount",value:function(){this.rafid&&cancelAnimationFrame(this.rafid)}}]),t}(r.Component),ut=st;r.PureComponent;var ct=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.createElement("div",{className:"mito-instructions"},r.createElement("div",{className:"mito-instructions-container"},r.createElement("div",{className:"esc",onClick:function(){return e.props.play()}},"Back (Esc)"),r.createElement("h1",null,"Mito"),r.createElement("div",{className:"play-button",onClick:function(){return e.props.play()}},"Play"),r.createElement("p",null,r.createElement("ol",null,r.createElement("li",null,"Build Tissue to expand your reach (press t and walk into empty space)."),r.createElement("li",null,"Build Roots (press r) underground to suck up adjacent water."),r.createElement("li",null,"Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar."),r.createElement("li",null,r.createElement("b",null,"Win the game by building and loading the Fruit with 1000 sugar.")),r.createElement("li",null,"Click around to see the different properties of each tile."),r.createElement("li",null,"Build leaves early."),r.createElement("li",null,"Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air."),r.createElement("li",null,"Explore underground for water reservoires and Fountains."),r.createElement("li",null,"Build transports (capital T) to carry water back up the plant."),r.createElement("li",null,"You can scroll out infinitely far."))),r.createElement("h3",null,"You"),r.createElement("p",null,"You can carry max ",$.maxResources," resources, and you automatically suck in any resources you're standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil below and air above."),r.createElement("h3",null,"Soil and Underground"),r.createElement("p",null,"Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a permanent source of water. Soil holds up to ",$.soilMaxWater," water at a time. Fountains emit one water per ",$.fountainTurnsPerWater," turns."),r.createElement("h3",null,"Air and Aboveground"),r.createElement("p",null,"Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun, which gently sways left to right."),r.createElement("h3",null,"Water"),r.createElement("p",null,"Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2 required) at about 1 unit per ",(1/$.soilDiffusionWater).toFixed(0)," turns. Obtain water in the ground through Roots. Leaves require water to photosynthesize. You require water to build."),r.createElement("h3",null,"Sugar"),r.createElement("p",null,"Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by putting water next to leaves. Cells require sugar to survive. You require sugar to build."),r.createElement("h3",null,"Building"),r.createElement("p",null,'Build Tissue, Leaves, Roots, and The Fruit by toggling "build mode" on and walking into Air or Soil. Build Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they\'re not properly supported underneath them.'),r.createElement("h3",null,"Cells"),r.createElement("p",null,"All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their neighbors. Each cell consumes 1 sugar every ",$.cellEnergyMax," turns."),r.createElement("h3",null,"Tissue"),r.createElement("p",null,"Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to ",$.tissueInventoryCapacity," resources."),r.createElement("h3",null,"Roots"),r.createElement("p",null,"Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is called a Pairing."),r.createElement("h3",null,"Leaves"),r.createElement("p",null,"When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per ",(1/$.leafReactionRate).toFixed(0)," turns per pair. Leaf efficiency is heavily influenced by co2 and sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize. Leaves higher up produce sugar faster."),r.createElement("h3",null,"Transport"),r.createElement("p",null,"Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you. Transport hungers at double speed."),r.createElement("h3",null,"The Fruit"),r.createElement("p",null,"You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to 1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity."),this.renderCredit()))}},{key:"renderCredit",value:function(){return r.createElement(r.Fragment,null,r.createElement("h2",null,"Attribution"),r.createElement("p",null,"Tiles: ",r.createElement("a",{href:"http://kenney.nl/assets?s=roguelike",target:"_blank",rel:"noopener noreferrer"},"Kenney.nl Roguelike Assets")),r.createElement("p",null,"Pop sound when leaves convert: ",r.createElement("a",{href:"http://soundbible.com/2067-Blop.html",target:"_blank",rel:"noopener noreferrer"},"Blop by Mark DiAngelo")," (",r.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/us/"},"CC BY 3.0 US"),")"),r.createElement("p",null,"Perlin noise: ",r.createElement("a",{href:"https://github.com/josephg/noisejs",target:"_blank",rel:"noopener noreferrer"},"josephg/noisejs")),r.createElement("p",null,"Part of 7drl 2018: ",r.createElement("a",{href:"http://7drl.org/",target:"_blank",rel:"noopener noreferrer"},"http://7drl.org/")),r.createElement("p",null,"Fruit icon: ",r.createElement("a",{href:"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm"},"Designed by Freepik")))}}]),t}(r.PureComponent),ht=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).handlePlay=function(){n.props.mito.gameState="main"},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e={width:"100%",height:"100%",position:"absolute",background:"rgba(255, 255, 255, 0.95)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px"};return"main"===this.props.state?null:"win"===this.props.state?r.createElement("div",{className:"screen-win",style:e},"You won!"):"lose"===this.props.state?r.createElement("div",{className:"screen-lose",style:e},"You lost!"):"instructions"===this.props.state?r.createElement(ct,{play:this.handlePlay}):void 0}}]),t}(r.PureComponent),dt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.tile;return e?r.createElement("div",{className:"tile-hover"},this.tileInfo(e),this.inventoryInfo(e),this.cellInfo(e),this.growingCellInfo(e),this.rootInfo(e),this.leafInfo(e),this.airInfo(e),this.fountainInfo(e)):null}},{key:"rootInfo",value:function(e){return e instanceof fe?r.createElement("div",{className:"info-root"},r.createElement("div",null,e.cooldown," turns until next water suck"),r.createElement("div",null,e.waterTransferAmount.toFixed(0)," water transfer per round")):null}},{key:"leafInfo",value:function(e){return e instanceof ve?r.createElement("div",{className:"info-leaf"},r.createElement("div",null,(1/(e.averageSpeed*$.leafReactionRate)).toFixed(0)," turns per reaction"),r.createElement("div",null,(1/e.averageEfficiency).toFixed(2)," water per sugar")):null}},{key:"airInfo",value:function(e){if(e instanceof oe)return r.createElement("div",{className:"info-air"},r.createElement("div",null,"\u2600\ufe0f ",(100*e.sunlight()).toFixed(0),"%"),r.createElement("div",null,"\u2601\ufe0f ",(100*e.co2()).toFixed(0),"%"))}},{key:"fountainInfo",value:function(e){if(e instanceof ce)return r.createElement("div",{className:"info-fountain"},r.createElement("div",null,e.turnsPerWater," turns per water"))}},{key:"tileInfo",value:function(e){var t=ne(e)?r.createElement("span",{className:"info-energy"},"\ud83d\udc9a",(e.energy/$.cellEnergyMax*100).toFixed(0),"%"):null;return r.createElement("div",{className:"info-tile"},r.createElement("div",{className:"info-tile-name"},e.constructor.displayName),t)}},{key:"inventoryInfo",value:function(e){if(L(e)){var t=e.inventory.water>0?r.createElement("div",{className:"info-inventory-item"},"\ud83d\udca7 ",e.inventory.water.toFixed(2)):null,n=e.inventory.sugar>0?r.createElement("div",{className:"info-inventory-item"},"Sugar ",e.inventory.sugar.toFixed(2)):null;return r.createElement("div",{className:"info-inventory"},t,n)}}},{key:"cellInfo",value:function(e){if(e instanceof he&&200*e.droopY>1)return r.createElement("div",{className:"info-cell"},(200*e.droopY).toFixed(0),"% droop")}},{key:"growingCellInfo",value:function(e){if(e instanceof de)return r.createElement("div",{className:"info-growing-cell"},(100-e.timeRemaining/e.timeToBuild*100).toFixed(0),"% mature")}}]),t}(r.Component),pt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.water+this.props.sugar>$.maxResources-1,t=r.createElement("div",{className:"mito-inventory-maxed".concat(e?" is-maxed":"")},"maxed");return r.createElement(r.Fragment,null,r.createElement("div",{className:m()("mito-hud",{hidden:!this.props.isTutorialFinished})},this.renderFruitUI(),this.renderAllBuildButtons(),this.renderSecondEls(),this.renderDPad()),r.createElement("div",{className:m()("mito-inventory",{hidden:!1})},t,r.createElement("div",{className:"mito-inventory-container"},this.renderInventoryBar(),this.renderInventory())),this.renderUIState(),this.renderAutoplacePopup())}},{key:"ensureCanvasFocus",value:function(e){e.preventDefault(),document.getElementsByTagName("canvas")[0].focus()}},{key:"renderButton",value:function(e,t,n){var i=this;return r.createElement("div",Object.assign({key:e,className:"mito-hud-button mito-hud-build-item",onClick:function(t){i.props.onTryActionKey(e),i.ensureCanvasFocus(t)}},n),r.createElement("span",{className:"mito-hud-button-hotkey"},e),t)}},{key:"renderBuildButton",value:function(e,t){var n,r=Oe[e];n=r===pe?"Build ".concat(r.displayName):r===ve||r===fe?"Build ".concat(r.displayName):r===me?"Build ".concat(r.displayName):r===ye?"Lay ".concat(r.displayName):"Build ".concat(r.displayName);var i=Object(Q.a)({},(t||{style:{}}).style);return this.props.autoplace===r&&(i.fontWeight="bold",i.textDecoration="underline",i.color="rgb(45, 220, 40)",this.props.water<1&&(n+=" (need water!)",i.color="red"),this.props.sugar<1&&(n+=" (need sugar!)",i.color="red")),this.renderButton(e," - "+n,Object(Q.a)({},t,{style:i}))}},{key:"renderInventory",value:function(){return r.createElement("div",{className:"mito-inventory-indicator"},r.createElement("span",{className:"mito-inventory-water"},this.props.water.toFixed(2)," water"),"\xa0",r.createElement("span",{className:"mito-inventory-sugar"},this.props.sugar.toFixed(2)," sugar"))}},{key:"renderInventoryBar",value:function(){var e=this.props.water/$.maxResources,t=this.props.sugar/$.maxResources,n=1-(this.props.water+this.props.sugar)/$.maxResources,i={width:"".concat(100*e,"%")},a={width:"".concat(100*t,"%")},o={width:"".concat(100*n,"%")};return r.createElement("div",{className:"mito-inventory-bar"},r.createElement("div",{style:i,className:"mito-inventory-bar-water"}),r.createElement("div",{style:a,className:"mito-inventory-bar-sugar"}),r.createElement("div",{style:o,className:"mito-inventory-bar-empty"}))}},{key:"renderAllBuildButtons",value:function(){var e=[];for(var t in Oe)if("F"!==t){var n=this.renderBuildButton(t);null!=n&&e.push(n)}return null==this.props.world.fruit&&Oe.F&&e.push(this.renderBuildButton("F")),r.createElement("div",{className:"mito-hud-section mito-hud-section-build"},e)}},{key:"renderSecondEls",value:function(){return r.createElement("div",{className:"mito-hud-section mito-hud-section-actions"},this.renderButton("1"," - Drop water"),this.renderButton("2"," - Drop sugar"),this.renderButton("."," - Wait a turn"),this.renderButton("?"," - Instructions"))}},{key:"renderDPad",value:function(){var e=[],t=!0,n=!1,i=void 0;try{for(var a,o="qwea.dzsc".split("")[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;e.push(this.renderButton(s,null,{style:{}}))}}catch(l){n=!0,i=l}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return r.createElement("div",{className:"mito-hud-section d-pad"},e)}},{key:"renderFruitUI",value:function(){var e=this.props.world;if(null!=e.fruit)return r.createElement("div",{className:"mito-hud-section"},"You bear Fruit! ",e.fruit.inventory.sugar.toFixed(2)," of ",me.sugarToWin," sugar!")}},{key:"renderUIState",value:function(){if("expanding"===this.props.uiState.type){var e=[];for(var t in Oe){var n=Oe[t];if((n!==me||null==this.props.world.fruit)&&n!==ye){var i=this.renderButton(t,n.displayName);null!=i&&e.push(i)}}return e.push(this.renderButton("Esc",null)),r.createElement("div",{className:"ui-popup ui-popup-bottom"},r.createElement("div",{className:"connector-line"}),r.createElement("span",{className:"popup-title"},"Build"),r.createElement("div",{className:"popup-content popup-row"},e))}}},{key:"renderAutoplacePopup",value:function(){if(this.props.autoplace){var e={left:this.props.mouseX,top:this.props.mouseY};return r.createElement("div",{className:"popup-autoplace ui-popup",style:e},r.createElement("div",{className:"popup-content popup-text"},"Building ",this.props.autoplace.displayName,this.renderButton("Esc",null)))}}}]),t}(r.PureComponent),vt=n(32),ft=Be(function(){var e=new J,t=new J,n=new J;return{climate:{turnsBetweenRainfall:800,rainDuration:50,waterPerDroplet:2},evaporationRate:2e-4,evaporationBottom:.6,floorCo2:.5,waterGravityPerTurn:.001,fill:[function(r,i){var a=r.x,o=r.y,s=Et/2-4*(n.perlin2(0,a/5)+1)/2-16*n.perlin2(10,a/20+10),l=P(o-Et/2,0,Et/2,-.7,.3),u=t.simplex2(a/5,o/5)<l;if(o>s){if(u)return new le(r,i);var c=Math.pow(P(o-Et/2,0,Et/2,.5,1),2),h=e.simplex2(.2*a,.2*o)+.2,d=Math.round(Math.max(1,Math.min(20,h>.4?20*c:0)));if(c*h>1/$.fountainAppearanceRate){var p=Math.min(c*h,1);return new ce(r,d,i,Math.round($.fountainTurnsPerWater/p))}return new se(r,d,i)}}]}}),mt=Be(function(){var e=new J,t=new J;return{climate:{rainDuration:220,turnsBetweenRainfall:3e3,waterPerDroplet:8},evaporationRate:.002,evaporationBottom:.7,waterGravityPerTurn:.02,floorCo2:.95,fill:[function(n,r){var i=n.x,a=n.y,o=Et/2-2*(e.perlin2(0,i/20)+1)/2-3*e.perlin2(10,i/100+10),s=P(a,Et/2,Et,-.8,-.4),l=t.simplex2(i/4,a/4)<s;if(a>o){if(l)return new le(n,r);var u=Math.floor(Math.max(0,P(a,.75*Et,Et,1,9)));return new se(n,u,r)}}]}}),yt=Be(function(){var e=new J,t=new J;return{climate:{turnsBetweenRainfall:1200,rainDuration:120,waterPerDroplet:3},waterGravityPerTurn:.1,evaporationBottom:.6,evaporationRate:.001,floorCo2:1,fill:[function(n,r){var i=n.x,a=n.y,o=.55*Et-4*(t.perlin2(0,i/5)+1)/2-16*t.perlin2(10,i/20+10)-P(i,0,Ot,10,-10),s=a-6*(t.perlin2(0,i/25)+1)/2-20*t.perlin2(10,i/150+10)<.5*Et?-1:-.15;return e.simplex2(i/10,a/10)<s?new le(n,r):a>o?new se(n,3,r):void 0}]}}),gt={Temperate:ft,Desert:mt,Rocky:yt},wt=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).gui=void 0;var r=new vt.a({closed:!0,width:450});r.add($,"environment",Object.keys(gt)).onChange(function(){return setTimeout(function(){return window.location.reload()},100)}),r.add($,"droop",0,.5,.01),r.add($,"fountainTurnsPerWater",1,100,1),r.add($,"isRealtime"),r.add($,"leafReactionRate",0,.2,1e-4),r.add($,"leafSugarPerReaction",0,1,.01),r.add($,"rootTurnsPerTransfer",1,100,1),r.add($,"soilDarknessBase",0,1,.01),r.add($,"soilDiffusionType",["discrete","continuous"]),r.add($,"sunlightReintroduction",0,1,.01),r.add($,"sunlightDiffusion",0,1,.01),r.add($,"transportTurnsPerMove",1,50,1),r.add($,"veinDiffusion",0,.85,1e-4);var i=r.addFolder("Needs Page Refresh");i.add($,"cellGestationTurns",0,100,1),i.add($,"cellDiffusionSugar",0,.85,1e-4),i.add($,"cellDiffusionWater",0,.85,1e-4),i.add($,"cellEnergyMax",400,1e4,100),i.add($,"fountainAppearanceRate",1,5,.1),i.add($,"maxResources",10,1e3,1),i.add($,"soilDiffusionWater",0,.25,1e-5),i.add($,"soilMaxWater",1,100,1),i.add($,"tissueInventoryCapacity",1,100,1);var a=!0,o=!1,l=void 0;try{for(var h,d=r.__controllers.concat(i.__controllers)[Symbol.iterator]();!(a=(h=d.next()).done);a=!0){h.value.onFinishChange(te)}}catch(p){o=!0,l=p}finally{try{a||null==d.return||d.return()}finally{if(o)throw l}}return n.gui=r,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return null}}]),t}(r.Component),bt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.mito.hoveredTile;return r.createElement(r.Fragment,null,r.createElement(dt,{tile:e}),this.maybeRenderHoveredTileHighlight(e),this.maybeRenderPath())}},{key:"maybeRenderHoveredTileHighlight",value:function(e){if(e)return r.createElement(ut,{x:e.pos.x,y:e.pos.y,scene:this.scene})}},{key:"maybeRenderPath",value:function(){var e=this.props.mito,t=e.autoplace,n=e.hoveredTile,i=e.scene,a=e.world;if(n){if(null!=t&&-1!==At.expansionTiles.indexOf(t))return r.createElement(kt,{tile:n,scene:i,world:a,walkable:"non-obstacles"});if(t===ye)return r.createElement(kt,{tile:n,scene:i,world:a,walkable:"tissue"})}}},{key:"scene",get:function(){return this.props.mito.scene}}]),t}(r.Component),kt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t="non-obstacles"===this.props.walkable?Se(this.props.world,this.props.tile.pos):Te(this.props.world,this.props.tile.pos);return r.createElement(r.Fragment,null,t.map(function(t){var n=Object(U.a)(t,2),i=n[0],a=n[1];return r.createElement(ut,{x:i,y:a,scene:e.props.scene})}))}}]),t}(r.PureComponent);var Ot=50,Et=100;function jt(e,t,n){e.x=e.x*(1-n)+t.x*n,e.y=e.y*(1-n)+t.y*n}var xt=function(e){function t(e,n,r,i){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(c.a)(t).call(this,e,n))).onWinLoss=i,a.world=void 0,a.scene=new y.A,a.camera=new y.u(0,0,0,0,-100,100),a.renderers=new Map,a.autoplace=void 0,a.tutorialRef=null,a.mouse=new y.E,a.hoveredTile=void 0,a.raycaster=new y.y,a.gameState="main",a.firstActionTakenYet=!1,a.audioListener=new y.d,a.keyMap=new Set,a.uiState={type:"main"},a.events={contextmenu:function(e){if("main"===a.uiState.type){var t=a.getTileAtScreenPosition(e.clientX,e.clientY);null!=t&&a.world.player.setAction({type:"deconstruct",position:t.pos})}return e.preventDefault(),!1},mousemove:function(e){a.mouse.x=e.clientX,a.mouse.y=e.clientY},click:function(e){a.handleClick(e.clientX,e.clientY)},keydown:function(e){a.firstActionTakenYet=!0;var t=e.key;a.keyMap.add(t),a.tryAction(t)},keyup:function(e){a.keyMap.delete(e.key)},wheel:function(e){var t=-(e.deltaX+e.deltaY)/125/20,n=a.camera.zoom*Math.pow(2,t);a.camera.zoom=n,a.camera.updateProjectionMatrix()}},a.tryAction=function(e){if("?"!==e){if("expanding"===a.uiState.type){if("Escape"===e)return void a.resetUIState();if(e in Oe&&(Oe[e]!==me||null==a.world.fruit)){var t={type:"build",cellType:Oe[e],position:a.uiState.target};return a.world.player.setAction(t),void a.resetUIState()}if(we[e])return void a.resetUIState()}if("instructions"!==a.gameState){null!=a.autoplace&&"Escape"===e&&(a.autoplace=void 0);var n=we[e]||be[e];null!=n?a.world.player.setAction(n):e in Oe&&(a.autoplace===Oe[e]||Oe[e]===me&&null!=a.world.fruit?a.autoplace=void 0:a.autoplace=Oe[e])}else"Escape"===e&&(a.gameState="main")}else a.gameState="instructions"===a.gameState?"main":"instructions"},a.expandingTileHighlight=new y.q(new y.v(1,1),new y.r({color:"white",side:y.j,transparent:!0,opacity:.5})),a.mapActions=function(e,t){if(null!=t){if("none"===t.type)return t;if(a.resetUIState(),"still"===t.type&&(a.autoplace===ge||a.autoplace===pe))return{type:"build",cellType:a.autoplace,position:e.pos};if("move"!==t.type)return t;var n=a.world.tileAt(e.pos.x+t.dir.x,e.pos.y+t.dir.y),r=e.currentTile();if(null!=a.autoplace){if(a.autoplace===ye){if(null==t.dir)throw new Error("bad dir");return{type:"build-transport",cellType:ye,position:a.world.player.pos,dir:t.dir}}if(a.autoplace!==ge||r instanceof ge){if(e.verifyMove(t))return t;var i={type:"build",cellType:a.autoplace,position:e.pos.clone().add(t.dir)};return a.autoplace!==pe&&a.autoplace!==fe&&(a.autoplace=void 0),i}return{type:"multiple",actions:[{type:"build",cellType:ge,position:e.pos},t]}}return e.isBuildCandidate(n)?void(null!=a.tutorialRef&&a.tutorialRef.tutorialRef):t}},a.world=r.world,window.mito=Object(R.a)(a),function(e){var t=0;function n(){3===++t&&(b.audio.currentTime=0,k.audio.currentTime=0,O.audio.currentTime=0,b.gain.connect(e.gain),k.gain.connect(e.gain),O.gain.connect(e.gain))}(b=F(e,"mito-base")).audio.oncanplaythrough=n,b.gain.gain.value=.5,(k=F(e,"mito-strings")).audio.oncanplaythrough=n,k.gain.gain.value=0,(O=F(e,"mito-drums")).audio.oncanplaythrough=n,O.gain.gain.value=0,(E=F(e,"footsteps")).gain.gain.value=0,E.gain.connect(e.gain),(j=F(e,"build")).gain.gain.value=0,j.gain.connect(e.gain);var r=new y.e;r.load("assets/audio/Blop-Mark_DiAngelo-79054334.mp3",function(e){x=e},function(e){e.loaded,e.total},function(e){}),r.load("assets/audio/suckwater.wav",function(e){A=e},function(e){e.loaded,e.total},function(e){})}(a.audioContext),a.camera.zoom=1.5,a.camera.add(a.audioListener),a.resize(a.canvas.width,a.canvas.height),a.scene.add(He.WaterParticles()),a.scene.add(He.SugarParticles());for(var o=0;o<5;o++)a.world.step();return a.camera.position.z=10,a.camera.lookAt(new y.F(0,0,0)),a.camera.position.x=a.world.player.pos.x,a.camera.position.y=a.world.player.pos.y,a.updateAmbientAudio(),a.world.player.mapActions=a.mapActions,a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.createElement(r.Fragment,null,r.createElement(pt,{autoplace:this.autoplace,mouseX:this.mouse.x,mouseY:this.mouse.y,uiState:this.uiState,isTutorialFinished:null==this.tutorialRef||this.tutorialRef.isFinished(),sugar:this.world.player.inventory.sugar,water:this.world.player.inventory.water,onTryActionKey:this.tryAction,world:this.world}),r.createElement(ht,{mito:this,state:this.gameState}),r.createElement(wt,null),r.createElement(bt,{mito:this}))}},{key:"enterUIStateExpanding",value:function(e){var t="main"===this.uiState.type?this.camera.zoom:this.uiState.originalZoom;this.uiState={type:"expanding",originalZoom:t,target:e}}},{key:"resetUIState",value:function(){"expanding"===this.uiState.type&&(this.camera.zoom=this.uiState.originalZoom,this.camera.updateProjectionMatrix(),this.uiState={type:"main"})}}]),Object(l.a)(t,[{key:"getOrCreateRenderer",value:function(e){var t=this.renderers.get(e);if(null==t){var n=function(e,t,n){if(e instanceof Ee)return new $e(e,t,n);if(e instanceof ye)return new it(e,t,n);if(e instanceof re)return new tt(e,t,n);throw new Error("Couldn't find renderer for ".concat(e))}(e,this.scene,this);return this.renderers.set(e,n),n}return t}},{key:"updateAmbientAudio",value:function(){var e=this.world.player.pos.y,t=P(e,Et/2,Et,0,.5),n=P(e,Et/2,0,0,.5);O.gain.gain.value=Math.max(0,t),k.gain.gain.value=Math.max(0,n)}},{key:"logRenderInfo",value:function(){"Geometries in memory: ".concat(this.renderer.info.memory.geometries,"\nTextures in memory: ").concat(this.renderer.info.memory.textures,"\n# Render Calls: ").concat(this.renderer.info.render.calls,"\n# Render Lines: ").concat(this.renderer.info.render.lines,"\n# Render Points: ").concat(this.renderer.info.render.points,"\n# Render Tris: ").concat(this.renderer.info.render.triangles,"\n")}},{key:"perfDebug",value:function(){var e=0,t=0;this.scene.traverse(function(n){n.matrixAutoUpdate?e++:t++}),console.log("yes",e,"no",t);var n=new Map;this.scene.traverse(function(e){var t=n.get(e.name||e.constructor.name)||[];n.set(e.name||e.constructor.name,t),t.push(e)}),console.log(n)}},{key:"worldStepAndDeleteOldRenderers",value:function(){if(this.firstActionTakenYet){var e=this.world.step();this.tutorialRef&&this.tutorialRef.setState({time:this.world.time}),"main"===this.gameState&&(this.gameState=this.world.checkWinLoss()||this.gameState,"win"!==this.gameState&&"lose"!==this.gameState||this.onWinLoss(this.gameState));var t=e.deleted,n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=this.renderers.get(s);if(null==l)throw new Error("Couldn't find renderer for ".concat(s,"!"));l.destroy(),this.renderers.delete(s)}}catch(u){r=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.updateAmbientAudio()}}},{key:"getCameraNormCoordinates",value:function(e,t){return new y.E(e/this.canvas.width*2-1,-t/this.canvas.height*2+1)}},{key:"getTileAtScreenPosition",value:function(e,t){var n=this.getCameraNormCoordinates(e,t);this.raycaster.setFromCamera(n,this.camera);var r=this.raycaster.ray.origin,i=r.x,a=r.y,o=Math.round(i),s=Math.round(a),l=this.world.tileAt(o,s);if(null!=l&&l.lightAmount()>0)return l}},{key:"animate",value:function(){var e=this,t=this.world;if(this.canvas.focus(),"main"===this.gameState){if($.isRealtime){if(this.frameCount%3===0){if(null==this.world.player.getAction()){var n=this.keysToMovement(this.keyMap);n&&this.world.player.setAction(n)}this.worldStepAndDeleteOldRenderers()}}else null!=t.player.getAction()&&this.worldStepAndDeleteOldRenderers();He.startFrame(),this.world.entities().forEach(function(t){e.getOrCreateRenderer(t).update()}),He.endFrame()}"expanding"===this.uiState.type&&(this.world.player.isBuildCandidate(this.world.tileAt(this.uiState.target))||this.resetUIState());var r=this.getCameraNormCoordinates(this.mouse.x,this.mouse.y);if("main"===this.uiState.type){this.scene.remove(this.expandingTileHighlight);var i=new y.E(this.world.player.pos.x+r.x/2,this.world.player.pos.y-r.y/2);jt(this.camera.position,i,.3)}else{this.scene.add(this.expandingTileHighlight),this.expandingTileHighlight.position.set(this.uiState.target.x,this.uiState.target.y,1);var a=new y.E(this.uiState.target.x,this.uiState.target.y);jt(this.camera.position,a,.3)}this.renderer.render(this.scene,this.camera),this.hoveredTile=this.getTileAtScreenPosition(this.mouse.x,this.mouse.y)}},{key:"keysToMovement",value:function(e){var t=new y.E,n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;be[s]&&t.add(be[s].dir)}}catch(l){r=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return 0===t.x&&0===t.y?null:{type:"move",dir:t}}},{key:"resize",value:function(e,t){var n=t/e;this.camera.left=-12/n,this.camera.right=12/n,this.camera.top=-12,this.camera.bottom=12,this.camera.updateProjectionMatrix()}},{key:"handleClick",value:function(e,n){this.firstActionTakenYet=!0;var r=this.getTileAtScreenPosition(e,n);if("expanding"===this.uiState.type&&(null!=r&&this.uiState.target.equals(r.pos)||this.resetUIState()),r)if(r.pos.equals(this.world.player.pos))this.world.player.setAction({type:"still"});else{var i,a=Fe(this.world.player.pos.x,this.world.player.pos.y,r.pos.x,r.pos.y);if(a)return this.world.player.isBuildCandidate(r)?void this.enterUIStateExpanding(r.pos):void this.world.player.setAction(a);i=this.autoplace&&-1!==t.expansionTiles.indexOf(this.autoplace)?Re(Se(this.world,r.pos)):Re(Te(this.world,r.pos,null!=this.autoplace)),this.world.player.setActions(i)}}}]),t}(w);xt.originalFn=y.t.prototype.updateMatrixWorld,xt.expansionTiles=[pe,fe,ge];var At=xt,Ct=(n(57),function(){function e(t,n,r){Object(s.a)(this,e),this.width=t,this.height=n,this.levels=r}return Object(l.a)(e,null,[{key:"generate",value:function(){for(var t={},n=0;n<5;n++)for(var r=0;r<5;r++){var i="".concat(n,",").concat(r);if(n===Math.floor(2.5)&&r===Math.floor(2.5)){var a=Mt(n,r,ft());a.visible=!0,t[i]=a}else{var o=Math.random()<.33?ft():Math.random()<.5?yt():mt();t[i]=Mt(n,r,o)}}return new e(5,5,t)}}]),Object(l.a)(e,[{key:"levelAt",value:function(e,t){return this.isValidPosition(e,t)?[this.levels["".concat(e,",").concat(t)]]:[]}},{key:"isValidPosition",value:function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height&&e===Math.floor(e)&&t===Math.floor(t)}}]),e}());function Mt(e,t,n){return{x:e,y:t,conquered:!1,visible:!1,environment:n,world:new xe(n)}}var Tt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).handleOnClick=function(e){n.props.onClickLevel(e)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=[];for(var t in this.props.overWorld.levels){var n=this.props.overWorld.levels[t];n.visible&&e.push(this.renderLevelMapIcon(n))}var r={width:100*this.props.overWorld.width,height:100*this.props.overWorld.width};return i.a.createElement("div",{className:"overworld-map-container"},i.a.createElement("h1",null,"Overworld Map"),i.a.createElement("div",{className:"overworld-map",style:r},e))}},{key:"renderLevelMapIcon",value:function(e){var t=this,n=function(){switch(e.environment){case ft():return t.renderTemperate();case yt():return t.renderRocky();case mt():return t.renderDesert()}}(),r={transform:"translate(".concat(100*e.x,"px, ").concat(100*e.y,"px)")};return i.a.createElement("div",{className:"overworld-map-icon",style:r,onClick:function(){return t.handleOnClick(e)}},n)}},{key:"renderTemperate",value:function(){return i.a.createElement("div",{className:"icon icon-temperate"},"Temperate")}},{key:"renderRocky",value:function(){return i.a.createElement("div",{className:"icon icon-rocky"},"Rocky")}},{key:"renderDesert",value:function(){return i.a.createElement("div",{className:"icon icon-desert"},"Desert")}}]),t}(i.a.PureComponent),St=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(i)))).state={overWorld:Ct.generate()},n.handleClickLevel=function(e){n.setState({currentLevel:e})},n.handleWinLoss=function(e){if("win"===e&&n.state.currentLevel){var t=n.state.currentLevel,r=t.x,i=t.y;t.conquered=!0;var a=n.state.overWorld;a.levelAt(r-1,i).forEach(function(e){return e.visible=!0}),a.levelAt(r+1,i).forEach(function(e){return e.visible=!0}),a.levelAt(r,i-1).forEach(function(e){return e.visible=!0}),a.levelAt(r,i+1).forEach(function(e){return e.visible=!0}),n.setState({currentLevel:void 0})}},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"App"},this.maybeRenderOverWorldMap(),this.maybeRenderLevel())}},{key:"maybeRenderOverWorldMap",value:function(){if(null==this.state.currentLevel)return i.a.createElement(Tt,{overWorld:this.state.overWorld,onClickLevel:this.handleClickLevel})}},{key:"maybeRenderLevel",value:function(){if(null!=this.state.currentLevel)return i.a.createElement(S,{sketchClass:At,otherArgs:[this.state.currentLevel,this.handleWinLoss]})}}]),t}(i.a.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(St,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[34,1,2]]]);
//# sourceMappingURL=main.ce157d5b.chunk.js.map