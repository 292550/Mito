(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{49:function(e,t,n){e.exports=n(86)},54:function(e,t,n){},55:function(e,t,n){},72:function(e,t,n){},73:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){},86:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(43),o=n.n(a),s=n(46),l=n(16),c=n(3),u=n(2),h=n(6),d=n(4),v=n(5),f=n(30),m=n(28),p=n(18),y=n(21),g=n.n(y),w=n(1),b={click:!0,contextmenu:!0,dblclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,touchstart:!0,touchmove:!0,touchend:!0,keyup:!0,keydown:!0,keypress:!0,wheel:!0},k=function(){function e(t,n){Object(c.a)(this,e),this.renderer=t,this.audioContext=n,this.elements=void 0,this.events=void 0,this.timeElapsed=0,this.frameCount=0}return Object(u.a)(e,[{key:"aspectRatio",get:function(){return this.renderer.domElement.height/this.renderer.domElement.width}},{key:"resolution",get:function(){return new w.Vector2(this.renderer.domElement.width,this.renderer.domElement.height)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),e}();k.id=void 0;var E,O,j,x,M,C,A,R=n(39),S=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).frameId=void 0,n.lastTimestamp=0,n.stop=!1,n.loop=function(e){var t=e-n.lastTimestamp;n.lastTimestamp=e,n.props.sketch.frameCount++,n.props.sketch.timeElapsed=e;try{n.props.sketch.animate(t)}catch(r){console.error(r)}n.stop||(n.setState({frameCount:n.props.sketch.frameCount}),n.frameId=requestAnimationFrame(n.loop))},n.handleWindowResize=function(){var e=n.props.sketch.renderer;n.updateRendererCanvasToMatchParent(e),null!=n.props.sketch.resize&&n.props.sketch.resize(e.domElement.width,e.domElement.height)},n.state={frameCount:e.sketch.frameCount},n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize();var t=this.props.sketch.renderer.domElement;t.tabIndex=1,Object.keys(b).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.addEventListener(n,r):t.addEventListener(n,r))}}),this.frameId=requestAnimationFrame(this.loop)}},{key:"render",value:function(){var e=[];return null!=this.props.sketch.render&&e.push(this.props.sketch.render()),null!=this.props.sketch.elements&&e.push.apply(e,Object(p.a)(this.props.sketch.elements)),r.createElement("div",{className:"sketch-elements"},e.map(function(e,t){return r.cloneElement(e,{key:t})}))}},{key:"componentWillUnmount",value:function(){var e=this;this.stop=!0,this.props.sketch.destroy&&this.props.sketch.destroy(),null!=this.frameId&&cancelAnimationFrame(this.frameId),this.props.sketch.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize);var t=this.props.sketch.canvas;Object.keys(b).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.removeEventListener(n,r):t.removeEventListener(n,r))}})}},{key:"updateRendererCanvasToMatchParent",value:function(e){var t=e.domElement.parentElement;null!=t&&e.setSize(t.clientWidth,t.clientHeight)}}]),t}(r.Component),T=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={status:{type:"loading"},volumeEnabled:JSON.parse(window.localStorage.getItem("sketch-volumeEnabled")||"true")},n.audioContext=void 0,n.userVolume=void 0,n.handleContainerRef=function(e){if(null!=e)try{var t=window.AudioContext||window.webkitAudioContext,r=n.audioContext=new t;w.AudioContext.setContext(r),n.userVolume=r.createGain(),n.userVolume.gain.setValueAtTime(.8,0),n.userVolume.connect(r.destination),(r.gain=r.createGain()).connect(n.userVolume),document.addEventListener("visibilitychange",n.handleVisibilityChange);var i=new w.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0,antialias:!0});e.appendChild(i.domElement);var a=n.props.otherArgs||[],o=Object(m.a)(n.props.sketchClass,[i,n.audioContext].concat(Object(p.a)(a)));n.setState({status:{type:"success",sketch:o}})}catch(s){n.setState({status:{type:"error",error:s}}),console.error(s)}else"success"===n.state.status.type&&n.state.status.sketch.canvas.remove(),document.removeEventListener("visibilitychange",n.handleVisibilityChange),null!=n.audioContext&&n.audioContext.close(),n.setState({status:{type:"loading"}})},n.handleVolumeButtonClick=function(){var e=!n.state.volumeEnabled;n.setState({volumeEnabled:e}),window.localStorage.setItem("sketch-volumeEnabled",JSON.stringify(e))},n.handleVisibilityChange=function(){null!=n.audioContext&&(document.hidden?n.audioContext.suspend():n.state.volumeEnabled&&n.audioContext.resume())},n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){null!=this.userVolume&&null!=this.audioContext&&(this.state.volumeEnabled&&"suspended"===this.audioContext.state?this.audioContext.resume():this.state.volumeEnabled||"running"!==this.audioContext.state||this.audioContext.suspend());var e=this.props,t=(e.sketchClass,e.otherArgs,e.eventsOnBody,e.errorElement,Object(f.a)(e,["sketchClass","otherArgs","eventsOnBody","errorElement"])),n=g()("sketch-component",this.state.status.type);return r.createElement("div",Object.assign({},t,{id:this.props.sketchClass.id,className:n,ref:this.handleContainerRef}),this.renderSketchOrStatus(),this.renderVolumeButton())}},{key:"renderSketchOrStatus",value:function(){var e=this.state.status;return"success"===e.type?r.createElement(S,{key:this.props.sketchClass.id,sketch:e.sketch,eventsOnBody:this.props.eventsOnBody}):"error"===e.type?this.props.errorElement||this.renderDefaultErrorElement(e.error.message):"loading"===e.type?null:void 0}},{key:"renderDefaultErrorElement",value:function(e){return r.createElement("p",{className:"sketch-error"},"Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.",r.createElement("pre",null,e))}},{key:"renderVolumeButton",value:function(){var e=this.state.volumeEnabled;return r.createElement("button",{className:"user-volume",onClick:this.handleVolumeButtonClick},e?r.createElement(R.b,null):r.createElement(R.a,null))}}]),t}(r.Component),N=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handleDivRef=function(e){null!=e||n.exitFullscreen()},n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:"full-page-sketch",ref:this.handleDivRef},r.createElement(T,{sketchClass:this.props.sketchClass,otherArgs:this.props.otherArgs}))}},{key:"exitFullscreen",value:function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}}]),t}(r.Component),P=n(9);function D(e,t,n){e.x=e.x*(1-n)+t.x*n,e.y=e.y*(1-n)+t.y*n}function B(e,t,n,r,i){return function(e,t,n){return e+(t-e)*n}(r,i,(e-t)/(n-t))}function F(e,t){var n=document.createElement("source");return n.src="/assets/audio/".concat(e,".").concat(t),n.type="audio/".concat(t),n}function L(e,t){var n=document.createElement("audio");n.autoplay=!0,n.loop=!0,n.appendChild(F(t,"ogg")),n.appendChild(F(t,"mp3")),n.appendChild(F(t,"wav"));var r=e.createMediaElementSource(n),i=e.createGain();return r.connect(i),{audio:n,gain:i}}var W=n(24);function V(e){return Math.round(1e12*e)/1e12}var I=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(c.a)(this,e),this.capacity=t,this.carrier=n,this.water=r,this.sugar=i,this.events=void 0,this.validate()}return Object(u.a)(e,[{key:"give",value:function(e,t,n){if(e===this)throw new Error("shouldn't give to self");var r=Math.min(t,this.water),i=Math.min(n,this.sugar),a=V(r+i),o=e.space();return a>o&&(r=Math.floor(r/a*o),i=Math.floor(i/a*o)),this.change(-r,-i),e.change(r,i),this.events&&this.events.emit("give",e,r,i),e.events&&e.events.emit("get",this,r,i),{water:r,sugar:i}}},{key:"on",value:function(e,t){this.events=this.events||new W.EventEmitter,this.events.on(e,t)}},{key:"off",value:function(e,t){this.events=this.events||new W.EventEmitter,this.events.off(e,t)}},{key:"add",value:function(e,t){var n=V(e+t),r=this.space();n>r&&(e=e/n*r,t=t/n*r),this.change(e,t)}},{key:"change",value:function(e,t){var n=V(this.water+e),r=V(this.sugar+t);this.validate(n,r),this.water=n,this.sugar=r,this.water<0&&(this.water=0),this.sugar<0&&(this.sugar=0),this.water+this.sugar>this.capacity&&(this.water>this.sugar?this.water=this.capacity-this.sugar:this.sugar=this.capacity-this.water)}},{key:"space",value:function(){return V(this.capacity-this.water-this.sugar)}},{key:"isMaxed",value:function(){return this.space()<1}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.water,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sugar,n=this.capacity;e<0&&console.warn("water < 0: ".concat(e)),t<0&&console.warn("sugar < 0: ".concat(t)),e+t>n&&console.warn("bad inventory: ".concat(e," water + ").concat(t," > ").concat(n," max"))}}]),e}();function Y(e){return null!=e&&e.inventory instanceof I}var G=n(12),z={isRealtime:!0,environment:"Temperate",cellEnergyMax:1e4,tissueInventoryCapacity:6,rootTurnsPerTransfer:20,leafReactionRate:.01,leafSugarPerReaction:1,cellGestationTurns:0,cellDiffusionWater:.002,cellDiffusionSugar:.002,soilDarknessBase:.2,soilDiffusionType:"discrete",soilDiffusionWater:.001,veinDiffusion:.5,soilMaxWater:20,droop:.03,fountainTurnsPerWater:11,fountainAppearanceRate:1.5,transportTurnsPerMove:5,sunlightReintroduction:.15,sunlightDiffusion:0,maxResources:100},q=Object(G.a)({},z);if(window.location.hash.length>0){var U=JSON.parse(decodeURI(window.location.hash.substr(1)));Object.assign(q,U)}function H(){for(var e={},t=0,n=Object.keys(z);t<n.length;t++){var r=n[t],i=q[r];i!==z[r]&&(e[r]=i)}Object.keys(e).length>0?window.location.hash=encodeURI(JSON.stringify(e)):window.location.hash=""}H();var _=n(15),K=n(8),X=function(){function e(t,n,r){Object(c.a)(this,e),this.x=t,this.y=n,this.z=r}return Object(u.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,n){return this.x*e+this.y*t+this.z*n}}]),e}(),J=[new X(1,1,0),new X(-1,1,0),new X(1,-1,0),new X(-1,-1,0),new X(1,0,1),new X(-1,0,1),new X(1,0,-1),new X(-1,0,-1),new X(0,1,1),new X(0,-1,1),new X(0,1,-1),new X(0,-1,-1)],Z=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],$=.5*(Math.sqrt(3)-1),Q=(3-Math.sqrt(3))/6,ee=1/6,te=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2147483647*Math.random();Object(c.a)(this,e),this.perm=new Array(512),this.gradP=new Array(512),this.octaveNum=6,this.octaveFalloff=.5,this.octaveMatrix2=[2*Math.cos(1),2*-Math.sin(1),2*Math.sin(1),2*Math.cos(1)],this.seed(t)}return Object(u.a)(e,[{key:"seed",value:function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?Z[t]^255&e:Z[t]^e>>8&255,this.perm[t]=this.perm[t+256]=n,this.gradP[t]=this.gradP[t+256]=J[n%12]}}}]),Object(u.a)(e,[{key:"simplex2",value:function(e,t){var n,r,i=(e+t)*$,a=Math.floor(e+i),o=Math.floor(t+i),s=(a+o)*Q,l=e-a+s,c=t-o+s;l>c?(n=1,r=0):(n=0,r=1);var u=l-n+Q,h=c-r+Q,d=l-1+2*Q,v=c-1+2*Q;a&=255,o&=255;var f=this.gradP[a+this.perm[o]],m=this.gradP[a+n+this.perm[o+r]],p=this.gradP[a+1+this.perm[o+1]],y=.5-l*l-c*c,g=.5-u*u-h*h,w=.5-d*d-v*v;return 70*((y<0?0:(y*=y)*y*f.dot2(l,c))+(g<0?0:(g*=g)*g*m.dot2(u,h))+(w<0?0:(w*=w)*w*p.dot2(d,v)))}},{key:"octaveSimplex2",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.octaveNum,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveFalloff,i=0,a=e,o=t,s=1,l=0;l<n;l++){i+=this.simplex2(a,o)*s;var c=a*this.octaveMatrix2[0]+o*this.octaveMatrix2[1],u=a*this.octaveMatrix2[2]+o*this.octaveMatrix2[3];a=c,o=u,s*=r}return i}},{key:"simplex3",value:function(e,t,n){var r,i,a,o,s,l,c=(e+t+n)*(1/3),u=Math.floor(e+c),h=Math.floor(t+c),d=Math.floor(n+c),v=(u+h+d)*ee,f=e-u+v,m=t-h+v,p=n-d+v;f>=m?m>=p?(r=1,i=0,a=0,o=1,s=1,l=0):f>=p?(r=1,i=0,a=0,o=1,s=0,l=1):(r=0,i=0,a=1,o=1,s=0,l=1):m<p?(r=0,i=0,a=1,o=0,s=1,l=1):f<p?(r=0,i=1,a=0,o=0,s=1,l=1):(r=0,i=1,a=0,o=1,s=1,l=0);var y=f-r+ee,g=m-i+ee,w=p-a+ee,b=f-o+2*ee,k=m-s+2*ee,E=p-l+2*ee,O=f-1+.5,j=m-1+.5,x=p-1+.5;u&=255,h&=255,d&=255;var M=this.gradP,C=this.perm,A=M[u+C[h+C[d]]],R=M[u+r+C[h+i+C[d+a]]],S=M[u+o+C[h+s+C[d+l]]],T=M[u+1+C[h+1+C[d+1]]],N=.6-f*f-m*m-p*p,P=.6-y*y-g*g-w*w,D=.6-b*b-k*k-E*E,B=.6-O*O-j*j-x*x;return 32*((N<0?0:(N*=N)*N*A.dot3(f,m,p))+(P<0?0:(P*=P)*P*R.dot3(y,g,w))+(D<0?0:(D*=D)*D*S.dot3(b,k,E))+(B<0?0:(B*=B)*B*T.dot3(O,j,x)))}},{key:"octaveSimplex3",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveNum,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.octaveFalloff,a=0,o=e,s=t,l=n,c=1,u=0;u<r;u++)a+=this.simplex3(o,s,l)*c,o*=2,s*=2,l*=2,c*=i;return a}},{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,n){return(1-n)*e+n*t}},{key:"perlin2",value:function(e,t){var n=Math.floor(e),r=Math.floor(t);e-=n,t-=r,n&=255,r&=255;var i=this.gradP,a=this.perm,o=i[n+a[r]].dot2(e,t),s=i[n+a[r+1]].dot2(e,t-1),l=i[n+1+a[r]].dot2(e-1,t),c=i[n+1+a[r+1]].dot2(e-1,t-1),u=this.fade(e);return this.lerp(this.lerp(o,l,u),this.lerp(s,c,u),this.fade(t))}},{key:"perlin3",value:function(e,t,n){var r=this.gradP,i=this.perm,a=Math.floor(e),o=Math.floor(t),s=Math.floor(n);e-=a,t-=o,n-=s;var l=r[(a&=255)+i[(o&=255)+i[s&=255]]].dot3(e,t,n),c=r[a+i[o+i[s+1]]].dot3(e,t,n-1),u=r[a+i[o+1+i[s]]].dot3(e,t-1,n),h=r[a+i[o+1+i[s+1]]].dot3(e,t-1,n-1),d=r[a+1+i[o+i[s]]].dot3(e-1,t,n),v=r[a+1+i[o+i[s+1]]].dot3(e-1,t,n-1),f=r[a+1+i[o+1+i[s]]].dot3(e-1,t-1,n),m=r[a+1+i[o+1+i[s+1]]].dot3(e-1,t-1,n-1),p=this.fade(e),y=this.fade(t),g=this.fade(n);return this.lerp(this.lerp(this.lerp(l,d,p),this.lerp(c,v,p),g),this.lerp(this.lerp(u,f,p),this.lerp(h,m,p),g),y)}}]),e}(),ne={nw:new w.Vector2(-1,-1),w:new w.Vector2(-1,0),sw:new w.Vector2(-1,1),n:new w.Vector2(0,-1),s:new w.Vector2(0,1),ne:new w.Vector2(1,-1),e:new w.Vector2(1,0),se:new w.Vector2(1,1)},re=Object.keys(ne).map(function(e){return ne[e]});function ie(e){return"number"===typeof e.energy}var ae=function(){function e(t,n){if(Object(c.a)(this,e),this.world=n,this.isObstacle=!1,this.darkness=1/0,this.timeMade=void 0,this.pos=void 0,this.pos=t.clone(),null==n)throw new Error("null world!");this.timeMade=n.time}return Object(u.a)(e,[{key:"diffusionWater",get:function(){return this.constructor.diffusionWater}},{key:"diffusionSugar",get:function(){return this.constructor.diffusionSugar}},{key:"fallAmount",get:function(){return this.constructor.fallAmount}}]),Object(u.a)(e,[{key:"lightAmount",value:function(){return Math.sqrt(Math.min(Math.max(B(1-this.darkness,0,1,0,1),0),1))}},{key:"step",value:function(){if(this.world.time%3===0){var e=this.world.tileNeighbors(this.pos);this.stepDarkness(e),this.stepDiffusion(e),this.stepGravity()}}},{key:"stepDarkness",value:function(e){if(this instanceof ve)this.darkness=0;else{var t=this.darkness,n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=Object(K.a)(s,2)[1],c=Math.max(.2,B(this.pos.y,this.world.height/2,this.world.height,q.soilDarknessBase,1)),u=l instanceof ue?1/0:l.darkness+c;t=l instanceof ve?0:Math.min(t,u)}}catch(d){r=!0,i=d}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.darkness=t;var h=null!=this.world.cellAt(this.pos.x,this.pos.y);h&&console.error("stepping environmental tile even when a cell is on-top:",h)}}},{key:"stepDiffusion",value:function(e){if(Y(this)){var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=Object(K.a)(o,2),l=s[0],c=s[1];this.canDiffuse(l,c)&&(null!=this.diffusionWater&&c.inventory.water>this.inventory.water&&this.diffuseWater(c),null!=this.diffusionSugar&&c.inventory.sugar>this.inventory.sugar&&this.diffuseSugar(c))}}catch(u){n=!0,r=u}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}}},{key:"canDiffuse",value:function(e,t){return oe(this,t)}},{key:"diffuseWater",value:function(e){if(Y(this))if("continuous"===q.soilDiffusionType){var t=(e.inventory.water-this.inventory.water)*this.diffusionWater;e.inventory.give(this.inventory,t,0)}else{var n=e.inventory.water-this.inventory.water,r=Math.min(n,1);Math.random()<n*this.diffusionWater*r&&e.inventory.give(this.inventory,1,0)}}},{key:"diffuseSugar",value:function(e){if(Y(this)){var t=(e.inventory.sugar-this.inventory.sugar)*this.diffusionSugar;e.inventory.give(this.inventory,0,t)}}},{key:"stepGravity",value:function(){var e=this.fallAmount,t=this.world.tileAt(this.pos.x,this.pos.y+1);e>0&&this.world.time%Math.floor(1/e)<1&&Y(t)&&oe(t,this)&&this.inventory.give(t.inventory,1,0)}}]),e}();function oe(e,t){return Y(e)&&Y(t)&&(e instanceof t.constructor||t instanceof e.constructor||e instanceof ve&&t instanceof ve||function(e,t,n,r){return e instanceof t&&n instanceof r}(e,ce,t,le))}ae.displayName="Tile",ae.fallAmount=0;var se=new te,le=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).pos=e,r.sunlightCached=1,r._co2=void 0,r.inventory=new I(20,Object(P.a)(r)),r.darkness=0,r._co2=r.computeCo2(),r}return Object(v.a)(t,e),Object(u.a)(t,[{key:"computeCo2",value:function(){var e=B(this.pos.y,this.world.height/2,0,this.world.environment.floorCo2,1.15),t=B(this.pos.y,this.world.height/2,0,4,9),n=null==this.world?0:this.world.time,r=.25*se.perlin3(94.231+(this.pos.x-this.world.width/2)/t,2312+this.pos.y/8,n/1e3+93.1);return Math.max(Math.min(e+r,1),Math.min(.4,.75*this.world.environment.floorCo2))}},{key:"lightAmount",value:function(){return this.sunlight()}},{key:"step",value:function(){this.world.time%3===0&&(this.stepGravity(),this.stepDiffusion(this.world.tileNeighbors(this.pos)),this.stepEvaporation(),this._co2=this.computeCo2())}},{key:"stepEvaporation",value:function(){Math.random()<.01*this.inventory.water&&this.inventory.add(-1,0)}},{key:"canDiffuse",value:function(e,n){return e!==ne.s&&e!==ne.sw&&e!==ne.se&&Object(_.a)(Object(d.a)(t.prototype),"canDiffuse",this).call(this,e,n)}},{key:"co2",value:function(){return this._co2}},{key:"sunlight",value:function(){return this.sunlightCached}}]),t}(ae);le.displayName="Air",le.fallAmount=1,le.diffusionWater=.1;var ce=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e,i))).inventory=new I(q.soilMaxWater,Object(P.a)(n)),n.inventory.add(r,0),n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"fallAmount",get:function(){return this.world.environment.waterGravityPerTurn}}]),Object(u.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(_.a)(Object(d.a)(t.prototype),"step",this).call(this),this.stepEvaporation())}},{key:"stepEvaporation",value:function(){var e=this.world.environment,t=e.evaporationRate,n=e.evaporationBottom,r=B(this.pos.y,this.world.height/2,this.world.height*n,1,0),i=this.inventory.water;Math.random()<t*r*i&&this.inventory.add(-1,0)}}]),t}(ae);ce.displayName="Soil",ce.diffusionWater=q.soilDiffusionWater;var ue=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).isObstacle=!0,n}return Object(v.a)(t,e),t}(ae);ue.displayName="Rock";var he=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(v.a)(t,e),t}(ae);he.displayName="Dead Cell";var de=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e,r,i))).turnsPerWater=a,n.isObstacle=!0,n.cooldown=0,n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(_.a)(Object(d.a)(t.prototype),"step",this).call(this),this.cooldown>0&&this.cooldown--,this.inventory.space()>1&&this.cooldown<=0&&(this.inventory.add(1,0),this.cooldown=this.turnsPerWater))}}]),t}(ce);de.displayName="Fountain";var ve=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).energy=q.cellEnergyMax,n.darkness=0,n.droopY=0,n.args=[],n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){Object(_.a)(Object(d.a)(t.prototype),"step",this).call(this),this.energy-=1;var e=this.world.tileNeighbors(this.pos),n=Array.from(e.values()),r=[].concat(Object(p.a)(n),[this]),i=!0,a=!1,o=void 0;try{for(var s,l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;if(Y(c)&&!(c instanceof ge)){if(!(this.energy<q.cellEnergyMax))break;var u=q.cellEnergyMax-this.energy,h=Math.min(u/q.cellEnergyMax,c.inventory.sugar);c.inventory.add(0,-h);var v=h*q.cellEnergyMax;this.energy+=v}}}catch(O){a=!0,o=O}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}if(this.energy<q.cellEnergyMax){var f=r.filter(function(e){return ie(e)}),m=!0,y=!1,g=void 0;try{for(var w,b=f[Symbol.iterator]();!(m=(w=b.next()).done);m=!0){var k=w.value;if(!(this.energy<q.cellEnergyMax))break;var E=0;if(k.energy>this.energy){if(E=Math.floor(.25*(k.energy-this.energy)),k.energy-E<0)throw new Error("cell energy diffusion: taking more energy than available");if(this.energy+E>q.cellEnergyMax)throw new Error("cell energy diffusion: taking more energy than i can carry");this.energy+=E,k.energy-=E}}}catch(O){y=!0,g=O}finally{try{m||null==b.return||b.return()}finally{if(y)throw g}}}this.stepDroop(e),this.droopY>.5&&(this.world.player.pos.equals(this.pos)&&(this.world.player.pos.y+=1),this.world.maybeRemoveCellAt(this.pos),this.pos.y<this.world.height-1&&(this.pos.y+=1),this.droopY-=1,this.world.setTileAt(this.pos,this)),this.energy<=0&&this.world.setTileAt(this.pos,new he(this.pos,this.world))}}},{key:"stepDroop",value:function(e){var n=e.get(ne.s),r=e.get(ne.sw),i=e.get(ne.se),a=e.get(ne.w),o=e.get(ne.e),s=e.get(ne.n),l=e.get(ne.nw),c=e.get(ne.ne);this.droopY+=q.droop,this.energy<q.cellEnergyMax/2&&(this.droopY+=q.droop);for(var u=!1,h=0,d=[n,r,i];h<d.length;h++){var v=d[h];if(v instanceof ue||v instanceof ce)return void(this.droopY=Math.min(this.droopY,0));if(v instanceof t)return this.droopY=Math.min(this.droopY,v.droopY),void(u=!0)}var f=[l,s,c,a,o,this].filter(function(e){return e instanceof t});u||1!==f.length?this.droopY=f.reduce(function(e,t){return e+t.droopY},0)/f.length:this.droopY+=1}}]),t}(ae);ve.displayName="Cell",ve.diffusionWater=q.cellDiffusionWater,ve.diffusionSugar=q.cellDiffusionSugar,ve.turnsToBuild=q.cellGestationTurns;var fe=function(e){function t(e,n,r){var i;return Object(c.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).completedCell=r,i.isObstacle=!0,i.timeRemaining=void 0,i.timeToBuild=void 0,i.timeRemaining=i.timeToBuild=r.constructor.turnsToBuild||0,i}return Object(v.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(_.a)(Object(d.a)(t.prototype),"step",this).call(this),this.timeRemaining--,this.timeRemaining<=0&&this.world.setTileAt(this.completedCell.pos,this.completedCell))}}]),t}(ve),me=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).inventory=new I(q.tissueInventoryCapacity,Object(P.a)(n)),n}return Object(v.a)(t,e),t}(ve);me.displayName="Tissue";var pe=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).isObstacle=!1,n.averageEfficiency=0,n.averageSpeed=0,n.didConvert=!1,n.sugarConverted=0,n.tilePairs=[],n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){Object(_.a)(Object(d.a)(t.prototype),"step",this).call(this),this.didConvert=!1;var e=this.world.tileNeighbors(this.pos);this.averageEfficiency=0,this.averageSpeed=0,this.sugarConverted=0;var n=0;this.tilePairs=[];var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value,c=Object(K.a)(l,2),u=c[0],h=c[1],v=this.world.tileAt(this.pos.x-u.x,this.pos.y-u.y);if(h instanceof le&&v instanceof me){n+=1,this.tilePairs.push(u);var f=h,m=v,p=f.sunlight(),y=f.co2();this.averageEfficiency+=y,this.averageSpeed+=p;var g=q.leafSugarPerReaction/y,w=Math.min(m.inventory.water,g),b=p*q.leafReactionRate*w/g;if(Math.random()<b){this.didConvert=!0;var k=w*y;m.inventory.add(-w,k),this.sugarConverted+=k}}}}catch(E){i=!0,a=E}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}n>0&&(this.averageEfficiency/=n)}}}]),t}(ve);pe.displayName="Leaf";var ye=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).waterTransferAmount=0,n.isObstacle=!1,n.activeNeighbors=[],n.inventory=new I(q.tissueInventoryCapacity,Object(P.a)(n)),n.cooldown=0,n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(_.a)(Object(d.a)(t.prototype),"step",this).call(this),this.cooldown<=0&&(this.stepWaterTransfer(),this.cooldown+=q.rootTurnsPerTransfer),this.cooldown-=1)}},{key:"stepWaterTransfer",value:function(){this.waterTransferAmount=0,this.activeNeighbors=[];var e=this.world.tileNeighbors(this.pos),t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=Object(K.a)(o,2),l=s[0],c=s[1];if(c instanceof ce){this.activeNeighbors.push(l);var u=c.inventory.give(this.inventory,1,0).water;this.waterTransferAmount+=u+1e-4*Math.random()}}}catch(h){n=!0,r=h}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}}]),t}(ve);ye.displayName="Root";var ge=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).isObstacle=!0,r.inventory=new I(8,Object(P.a)(r)),r.committedResources=new I(t.neededResources,Object(P.a)(r)),r.timeMatured=void 0,r.handleGetResources=function(){null==r.timeMatured&&r.isMature()&&(r.timeMatured=r.world.time),r.committedResources.off("get",r.handleGetResources)},r.committedResources.on("get",r.handleGetResources),r}return Object(v.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){Object(_.a)(Object(d.a)(t.prototype),"step",this).call(this);var e=this.world.tileNeighbors(this.pos),n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=Object(K.a)(s,2)[1];if(Y(l)&&l instanceof ve){var c=t.neededResources/2-this.committedResources.water,u=t.neededResources/2-this.committedResources.sugar;l.inventory.give(this.inventory,c,u)}}}catch(h){r=!0,i=h}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.commitResources()}}},{key:"commitResources",value:function(){var e=Math.min(t.neededResources/2-this.committedResources.water,.2),n=Math.min(t.neededResources/2-this.committedResources.sugar,.2);this.inventory.give(this.committedResources,e,n)}},{key:"getPercentMatured",value:function(){var e=this.committedResources;return(e.sugar+e.water)/e.capacity}},{key:"isMature",value:function(){return this.committedResources.water+this.committedResources.sugar>=t.neededResources-1}}]),t}(ve);function we(e){return e%1!==0}ge.displayName="Fruit",ge.neededResources=100;var be=function(e){function t(e,n,r){var i;if(Object(c.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).dir=r,i.cooldown=0,we(r.x)||we(r.y))throw new Error("build transport with fractional dir "+r.x+", "+r.y);return i}return Object(v.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){if(this.energy-=1,Object(_.a)(Object(d.a)(t.prototype),"step",this).call(this),this.cooldown<=0){this.cooldown+=q.transportTurnsPerMove;var e=this.getTarget();e&&this.inventory.give(e.inventory,1,1);var n=this.getFrom();n&&n.inventory.give(this.inventory,1,1)}this.cooldown-=1}}},{key:"getTarget",value:function(){var e=this.world.tileAt(this.pos.x+this.dir.x,this.pos.y+this.dir.y);if(e instanceof ve&&Y(e))return e}},{key:"getFrom",value:function(){var e=this.world.tileAt(this.pos.x-this.dir.x,this.pos.y-this.dir.y);if(e instanceof ve&&Y(e))return e}}]),t}(me);be.displayName="Transport";var ke=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).inventory=new I(8,Object(P.a)(n)),n}return Object(v.a)(t,e),Object(u.a)(t,null,[{key:"diffusionWater",get:function(){return q.veinDiffusion}},{key:"diffusionSugar",get:function(){return q.veinDiffusion}}]),t}(me);ke.displayName="Vein";var Ee=function(){function e(t,n){Object(c.a)(this,e),this.posFloat=t,this.world=n,this.inventory=new I(q.maxResources,this,Math.round(q.maxResources/3),Math.round(q.maxResources/3)),this.action=void 0,this.events=new W.EventEmitter,this.mapActions=void 0,this.speed=.2}return Object(u.a)(e,[{key:"pos",get:function(){return this.posFloat.clone().round()}}]),Object(u.a)(e,[{key:"setAction",value:function(e){null!=this.action?this.action={type:"multiple",actions:[this.action,e]}:this.action=e}},{key:"getAction",value:function(){return this.action}},{key:"droopY",value:function(){var e=this.world.tileAt(this.pos.x,this.pos.y);return e instanceof ve?e.droopY:0}},{key:"droopPosFloat",value:function(){var e=this.droopY();if(0!==e){var t=this.posFloat.clone();return t.y+=e,t}return this.posFloat}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"step",value:function(){if(void 0===this.action&&(this.action={type:"none"}),this.mapActions){var e=this.mapActions(this,this.action);this.action=null!=e?e:{type:"none"}}this.attemptAction(this.action)&&this.events.emit("action",this.action),this.action=void 0}},{key:"attemptAction",value:function(e){switch(e.type){case"none":return!0;case"still":return this.attemptStill();case"move":return this.attemptMove(e);case"build":return this.attemptBuild(e);case"deconstruct":return this.attemptDeconstruct(e);case"drop":return this.attemptDrop(e);case"pickup":return this.attemptPickup(e);case"multiple":return this.attemptMultiple(e)}}},{key:"verifyMove",value:function(e){var t=this.posFloat.clone().add(e.dir.clone().setLength(this.speed)).round();return this.isWalkable(t)}},{key:"isWalkable",value:function(e){if(e instanceof ae&&(e=e.pos),!this.world.isValidPosition(e.x,e.y))return!1;var t=this.world.tileAt(e.x,e.y);return t instanceof ve&&null!=t&&!t.isObstacle}},{key:"isBuildCandidate",value:function(e){return null!=e&&!e.isObstacle}},{key:"attemptMove",value:function(e){return!!this.verifyMove(e)&&(x.audio.currentTime=.05*Math.random(),x.gain.gain.cancelScheduledValues(0),x.gain.gain.value=1,x.gain.gain.linearRampToValueAtTime(0,x.gain.context.currentTime+.05),this.posFloat.add(e.dir.clone().setLength(this.speed)),!0)}},{key:"attemptStill",value:function(){return!0}},{key:"tryConstructingNewCell",value:function(e,t,n){e=e.clone();var r=this.world.tileAt(e.x,e.y);if(null!=r&&!(r instanceof ge)){if(!(r instanceof t&&!(t===be&&r instanceof be))&&!r.isObstacle&&this.inventory.water>=1&&this.inventory.sugar>=1){this.inventory.add(-1,-1);var i=Object(m.a)(t,[e,this.world].concat(Object(p.a)(n)));return i.args=n,M.audio.currentTime=0,M.gain.gain.cancelScheduledValues(0),M.gain.gain.value=.2,M.gain.gain.exponentialRampToValueAtTime(1e-4,M.gain.context.currentTime+.5),i}}}},{key:"argsEq",value:function(e,t){var n=this;return typeof e===typeof t&&(null==e&&null==t||(e instanceof w.Vector2&&t instanceof w.Vector2?e.equals(t):e instanceof Array&&t instanceof Array?e.every(function(r,i){return n.argsEq(e[i],t[i])}):void 0))}},{key:"isMeaningfulBuild",value:function(e,t){return t.constructor!==e.cellType||!this.argsEq(e.args,t.args)}},{key:"attemptBuild",value:function(e){var t=this.world.cellAt(e.position.x,e.position.y);if(null!=t&&!this.isMeaningfulBuild(e,t))return!0;t&&this.attemptDeconstruct({type:"deconstruct",position:e.position,force:!0});var n,r=this.tryConstructingNewCell(e.position,e.cellType,e.args);return null!=r&&((n=e.cellType.turnsToBuild?new fe(e.position,this.world,r):r).droopY=this.droopY(),this.world.setTileAt(e.position,n),!0)}},{key:"attemptDeconstruct",value:function(e){if(!e.position.equals(this.pos)||e.force){var t=this.world.maybeRemoveCellAt(e.position);if(null!=t){var n=t.energy/q.cellEnergyMax;return this.inventory.add(n,n),Y(t)&&t.inventory.give(this.inventory,t.inventory.water,t.inventory.sugar),!0}}return!1}},{key:"attemptDrop",value:function(e){var t=this.currentTile();if(Y(t)){var n=e.water,r=e.sugar;return t.inventory.give(this.inventory,r,n),this.inventory.give(t.inventory,n,r),!0}return!1}},{key:"attemptPickup",value:function(e){var t=this.currentTile();Y(t)&&t.inventory.give(this.inventory,e.water,e.sugar);return!0}},{key:"attemptMultiple",value:function(e){var t=!0,n=!0,r=!1,i=void 0;try{for(var a,o=e.actions[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t=this.attemptAction(s)&&t}}catch(l){r=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}}]),e}();var Oe=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(c.a)(this,e),this.deleted=t,this.added=n},je=["spring","summer","fall","winter"],xe=10800,Me=xe/4,Ce=function(){function e(t){var n=this;Object(c.a)(this,e),this.environment=t,this.time=0,this.width=50,this.height=100,this.player=new Ee(new w.Vector2(this.width/2,this.height/2),this),this.gridEnvironment=void 0,this.gridCells=void 0,this.neighborCache=void 0,this.wipResult=void 0,this.cachedEntities=void 0,this.stepStats=new Oe,this.wipResult={fruits:[],world:this},this.gridEnvironment=new Array(this.width).fill(void 0).map(function(e,r){return new Array(n.height).fill(void 0).map(function(e,i){var a,o=new w.Vector2(r,i),s=!0,l=!1,c=void 0;try{for(var u,h=t.fill[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=(0,u.value)(o,n);if(null!=d){a=d;break}}}catch(v){l=!0,c=v}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return null==a&&(a=new le(o,n)),a})});var r=this.player.pos.x,i=this.gridEnvironment[r].find(function(e){return!(e instanceof le)});i&&(this.player.pos.y=i.pos.y);this.gridCells=new Array(this.width).fill(void 0).map(function(e,t){return new Array(n.height).fill(void 0).map(function(e,r){var i=new w.Vector2(t,r);return n.player.pos.distanceTo(i)<2.5?(n.gridEnvironment instanceof ue&&(n.gridEnvironment[t][r]=new ce(new w.Vector2(t,r),0,n)),new me(i,n)):null})}),this.neighborCache=new Array(this.width).fill(void 0).map(function(e,t){return new Array(n.height).fill(void 0).map(function(e,r){return n.computeTileNeighbors(t,r)})}),this.fillCachedEntities()}return Object(u.a)(e,[{key:"season",get:function(){return{name:je[Math.floor(this.time/Me)],percent:this.time%Me/Me}}}]),Object(u.a)(e,[{key:"tileAt",value:function(e,t){var n;if(e instanceof w.Vector2?(n=e.x,t=e.y):(n=e,t=t),!this.isValidPosition(n,t))return null;var r=this.gridCells[n][t];return null!=r?r:this.gridEnvironment[n][t]}},{key:"cellAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridCells[e][t]:null}},{key:"environmentTileAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridEnvironment[e][t]:null}},{key:"setTileAt",value:function(e,t){var n=e.x,r=e.y;if(!this.isValidPosition(n,r))throw new Error("invalid position ".concat(n,", ").concat(r," "));t instanceof ge&&this.wipResult.fruits.push(t);var i=this.tileAt(n,r);Y(i)&&(Y(t)&&i.inventory.give(t.inventory,i.inventory.water,i.inventory.sugar),0===i.inventory.water&&0===i.inventory.sugar||(console.warn("lost",i.inventory,"resources to building"),i.inventory.add(-i.inventory.water,-i.inventory.sugar)));var a=this.gridCells[n][r];if(null!=a&&this.stepStats.deleted.push(a),t instanceof ve)this.gridCells[n][r]=t;else{this.gridCells[n][r]=null;var o=this.gridEnvironment[n][r];null!=o&&this.stepStats.deleted.push(o),this.gridEnvironment[n][r]=t}this.stepStats.added.push(t),this.handleTileUpdated(e)}},{key:"maybeRemoveCellAt",value:function(e){var t=this.cellAt(e.x,e.y);return t&&(this.gridCells[e.x][e.y]=null,this.stepStats.deleted.push(t)),this.handleTileUpdated(e),t}},{key:"isValidPosition",value:function(e,t){return!(e>=this.width||e<0||t>=this.height||t<0)}},{key:"tileNeighbors",value:function(e){return this.neighborCache[e.x][e.y]}},{key:"computeTileNeighbors",value:function(e,t){var n=this,r=new Map;return Re[this.time%Re.length].forEach(function(i){var a=e+i.x,o=t+i.y,s=n.tileAt(a,o);null!=s&&r.set(i,s)}),r}},{key:"entities",value:function(){if(null==this.cachedEntities)throw new Error("accessed entities before filling");return this.cachedEntities}},{key:"handleTileUpdated",value:function(e){this.neighborCache[e.x][e.y]=this.computeTileNeighbors(e.x,e.y);var t=!0,n=!1,r=void 0;try{for(var i,a=re[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=e.x+o.x,l=e.y+o.y;this.isValidPosition(s,l)&&(this.neighborCache[s][l]=this.computeTileNeighbors(s,l))}}catch(c){n=!0,r=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}this.fillCachedEntities()}},{key:"fillCachedEntities",value:function(){var e=[],t=0,n=0;for(t=0;t<this.width;t++)for(n=(t+this.time)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));for(t=0;t<this.width;t++)for(n=(t+this.time+1)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));this.time%4<2&&e.reverse(),e.push(this.player),this.cachedEntities=e}},{key:"step",value:function(){var e=this.entities();return this.stepStats=new Oe,e.forEach(function(e){"function"===typeof e.step&&e.step()}),this.computeSunlight(),this.stepWeather(),this.time++,this.fillCachedEntities(),this.stepStats}},{key:"getLastStepStats",value:function(){return this.stepStats}},{key:"stepWeather",value:function(){if((this.time+this.environment.climate.turnsBetweenRainfall-200)%this.environment.climate.turnsBetweenRainfall<this.environment.climate.rainDuration){var e=w.Math.randInt(0,this.width-1),t=this.tileAt(e,0);t instanceof le&&t.inventory.add(this.environment.climate.waterPerDroplet,0)}}},{key:"computeSunlight",value:function(){for(var e=this.time*Math.PI*2/1e3,t=Math.sin(e+Math.PI/2),n=Math.atan(12*Math.sin(e))/(Math.PI/2)*.5+.5,r=0;r<=.6*this.height;r++)for(var i=0;i<this.width;i++){var a=this.environmentTileAt(i,r);if(a instanceof le){var o=0;if(0===r)o=1;else{var s=this.tileAt(i,r-1),l=this.tileAt(i+1,r-1),c=this.tileAt(i-1,r-1),u=s instanceof le?s.sunlightCached/n:null==s?1:0,h=l instanceof le?l.sunlightCached/n:null==l?1:0,d=c instanceof le?c.sunlightCached/n:null==c?1:0;o=(o=t>0?h*t+u*(1-t):d*-t+u*(1- -t))*(1-q.sunlightDiffusion)+(u+h+d)/3*q.sunlightDiffusion}o=q.sunlightReintroduction+o*(1-q.sunlightReintroduction),o*=n,a.sunlightCached=o}}}},{key:"maybeGetGameResult",value:function(){return this.tileAt(this.player.pos.x,this.player.pos.y)instanceof he?Object(G.a)({},this.wipResult,{status:"lost"}):this.time<xe?null:0===this.wipResult.fruits.filter(function(e){return e.isMature()}).length?Object(G.a)({},this.wipResult,{status:"lost"}):Object(G.a)({},this.wipResult,{status:"won"})}},{key:"checkResources",value:function(){this.entities().forEach(function(e){Y(e)&&(e.inventory.sugar,e.inventory.water),ie(e)&&e.energy})}}]),e}();function Ae(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}var Re=[Ae(re.slice()),Ae(re.slice()),Ae(re.slice()),Ae(re.slice()),Ae(re.slice())],Se={q:{type:"drop",sugar:0,water:1},e:{type:"drop",sugar:1,water:0}," ":{type:"pickup",sugar:1,water:1}},Te={w:{type:"move",dir:ne.n},a:{type:"move",dir:ne.w},s:{type:"move",dir:ne.s},d:{type:"move",dir:ne.e}},Ne=(Object.keys(Te).map(function(e){return Te[e]}),function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.createElement("div",{className:"mito-instructions"},r.createElement("div",{className:"mito-instructions-container"},r.createElement("div",{className:"esc",onClick:function(){return e.props.play()}},"Back (Esc)"),r.createElement("h1",null,"Mito"),r.createElement("div",{className:"play-button",onClick:function(){return e.props.play()}},"Play"),r.createElement("p",null,r.createElement("ol",null,r.createElement("li",null,"Build Tissue to expand your reach (press t and walk into empty space)."),r.createElement("li",null,"Build Roots (press r) underground to suck up adjacent water."),r.createElement("li",null,"Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar."),r.createElement("li",null,r.createElement("b",null,"Win the game by building and loading the Fruit with 1000 sugar.")),r.createElement("li",null,"Click around to see the different properties of each tile."),r.createElement("li",null,"Build leaves early."),r.createElement("li",null,"Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air."),r.createElement("li",null,"Explore underground for water reservoires and Fountains."),r.createElement("li",null,"Build transports (capital T) to carry water back up the plant."),r.createElement("li",null,"You can scroll out infinitely far."))),r.createElement("h3",null,"You"),r.createElement("p",null,"You can carry max ",q.maxResources," resources, and you automatically suck in any resources you're standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil below and air above."),r.createElement("h3",null,"Soil and Underground"),r.createElement("p",null,"Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a permanent source of water. Soil holds up to ",q.soilMaxWater," water at a time. Fountains emit one water per ",q.fountainTurnsPerWater," turns."),r.createElement("h3",null,"Air and Aboveground"),r.createElement("p",null,"Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun, which gently sways left to right."),r.createElement("h3",null,"Water"),r.createElement("p",null,"Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2 required) at about 1 unit per ",(1/q.soilDiffusionWater).toFixed(0)," turns. Obtain water in the ground through Roots. Leaves require water to photosynthesize. You require water to build."),r.createElement("h3",null,"Sugar"),r.createElement("p",null,"Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by putting water next to leaves. Cells require sugar to survive. You require sugar to build."),r.createElement("h3",null,"Building"),r.createElement("p",null,'Build Tissue, Leaves, Roots, and The Fruit by toggling "build mode" on and walking into Air or Soil. Build Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they\'re not properly supported underneath them.'),r.createElement("h3",null,"Cells"),r.createElement("p",null,"All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their neighbors. Each cell consumes 1 sugar every ",q.cellEnergyMax," turns."),r.createElement("h3",null,"Tissue"),r.createElement("p",null,"Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to ",q.tissueInventoryCapacity," resources."),r.createElement("h3",null,"Roots"),r.createElement("p",null,"Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is called a Pairing."),r.createElement("h3",null,"Leaves"),r.createElement("p",null,"When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per ",(1/q.leafReactionRate).toFixed(0)," turns per pair. Leaf efficiency is heavily influenced by co2 and sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize. Leaves higher up produce sugar faster."),r.createElement("h3",null,"Transport"),r.createElement("p",null,"Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you. Transport hungers at double speed."),r.createElement("h3",null,"The Fruit"),r.createElement("p",null,"You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to 1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity."),this.renderCredit()))}},{key:"renderCredit",value:function(){return r.createElement(r.Fragment,null,r.createElement("h2",null,"Attribution"),r.createElement("p",null,"Tiles: ",r.createElement("a",{href:"http://kenney.nl/assets?s=roguelike",target:"_blank",rel:"noopener noreferrer"},"Kenney.nl Roguelike Assets")),r.createElement("p",null,"Pop sound when leaves convert: ",r.createElement("a",{href:"http://soundbible.com/2067-Blop.html",target:"_blank",rel:"noopener noreferrer"},"Blop by Mark DiAngelo")," (",r.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/us/"},"CC BY 3.0 US"),")"),r.createElement("p",null,"Perlin noise: ",r.createElement("a",{href:"https://github.com/josephg/noisejs",target:"_blank",rel:"noopener noreferrer"},"josephg/noisejs")),r.createElement("p",null,"Part of 7drl 2018: ",r.createElement("a",{href:"http://7drl.org/",target:"_blank",rel:"noopener noreferrer"},"http://7drl.org/")),r.createElement("p",null,"Fruit icon: ",r.createElement("a",{href:"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm"},"Designed by Freepik")))}}]),t}(r.PureComponent)),Pe=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).handlePlay=function(){n.props.mito.instructionsOpen=!1},n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.props.mito.instructionsOpen?r.createElement(Ne,{play:this.handlePlay}):null}}]),t}(r.PureComponent),De=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.tile;return e?r.createElement("div",{className:"tile-hover"},this.tileInfo(e),this.inventoryInfo(e),this.cellInfo(e),this.growingCellInfo(e),this.rootInfo(e),this.leafInfo(e),this.airInfo(e),this.fountainInfo(e)):null}},{key:"rootInfo",value:function(e){return e instanceof ye?r.createElement("div",{className:"info-root"},r.createElement("div",null,e.cooldown," turns until next water suck"),r.createElement("div",null,e.waterTransferAmount.toFixed(0)," water transfer per round")):null}},{key:"leafInfo",value:function(e){return e instanceof pe?r.createElement("div",{className:"info-leaf"},r.createElement("div",null,(1/(e.averageSpeed*q.leafReactionRate)).toFixed(0)," turns per reaction"),r.createElement("div",null,(1/e.averageEfficiency).toFixed(2)," water per sugar")):null}},{key:"airInfo",value:function(e){if(e instanceof le)return r.createElement("div",{className:"info-air"},r.createElement("div",null,"\u2600\ufe0f ",(100*e.sunlight()).toFixed(0),"%"),r.createElement("div",null,"\u2601\ufe0f ",(100*e.co2()).toFixed(0),"%"))}},{key:"fountainInfo",value:function(e){if(e instanceof de)return r.createElement("div",{className:"info-fountain"},r.createElement("div",null,e.turnsPerWater," turns per water"))}},{key:"tileInfo",value:function(e){var t=ie(e)?r.createElement("span",{className:"info-energy"},"\ud83d\udc9a",(e.energy/q.cellEnergyMax*100).toFixed(0),"%"):null;return r.createElement("div",{className:"info-tile"},r.createElement("div",{className:"info-tile-name"},e.constructor.displayName),t)}},{key:"inventoryInfo",value:function(e){if(Y(e)){var t=e.inventory.water>0?r.createElement("div",{className:"info-inventory-item"},"\ud83d\udca7 ",e.inventory.water.toFixed(2)):null,n=e.inventory.sugar>0?r.createElement("div",{className:"info-inventory-item"},"Sugar ",e.inventory.sugar.toFixed(2)):null;return r.createElement("div",{className:"info-inventory"},t,n)}}},{key:"cellInfo",value:function(e){if(e instanceof ve&&200*e.droopY>1)return r.createElement("div",{className:"info-cell"},(200*e.droopY).toFixed(0),"% droop")}},{key:"growingCellInfo",value:function(e){if(e instanceof fe)return r.createElement("div",{className:"info-growing-cell"},(100-e.timeRemaining/e.timeToBuild*100).toFixed(0),"% mature")}}]),t}(r.Component);function Be(e){var t;return function(){return void 0===t&&(t=e()),t}}var Fe=16,Le=!1,We=Be(function(){return(new w.TextureLoader).load("assets/images/roguelikeSheet_transparent.png",function(){We().dispatchEvent({type:"update"}),Le=!0})}),Ve=(new w.TextureLoader).load("assets/images/fruit.png"),Ie={};function Ye(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";e=Math.floor(e),t=Math.floor(t);var r="".concat(e,",").concat(t);if(null==Ie[r]){var i=function(){var r=We().image,i=a.getContext("2d");i.fillStyle=n,i.fillRect(0,0,Fe,16),i.drawImage(r,Fe*e,Fe*t,Fe,Fe,0,0,Fe,Fe),o.needsUpdate=!0},a=document.createElement("canvas");a.width=Fe,a.height=Fe;var o=new w.Texture(a);o.magFilter=w.NearestFilter,o.flipY=!0,o.wrapS=w.RepeatWrapping,o.wrapT=w.RepeatWrapping,Le?i():We().addEventListener("update",function(){i()}),Ie[r]=o}return Ie[r]}var Ge=function e(t,n,r){Object(c.a)(this,e),this.target=t,this.scene=n,this.mito=r},ze=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this))).geometry=void 0,n.material=void 0,n.index=0,n.geometry=t.newGeometry(),n.material=new qe(e),n.frustumCulled=!1,n}return Object(v.a)(t,e),Object(u.a)(t,null,[{key:"newGeometry",value:function(){var e=new w.BufferGeometry,n=new Float32Array(3*t.BUFFER_SIZE),r=new Float32Array(t.BUFFER_SIZE);return e.addAttribute("position",new w.BufferAttribute(n,3).setDynamic(!0)),e.addAttribute("size",new w.BufferAttribute(r,1).setDynamic(!0)),e}}]),Object(u.a)(t,[{key:"startFrame",value:function(){this.index=0}},{key:"commit",value:function(e,t,n,r){this.geometry.attributes.position.setXYZ(this.index,e,t,n),this.geometry.attributes.size.setX(this.index,r),this.index++}},{key:"endFrame",value:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.setDrawRange(0,this.index)}}]),t}(w.Points);ze.BUFFER_SIZE=1e5;var qe=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,{uniforms:{opacity:{value:e.opacity},sizeGlobal:{value:e.size},color:{value:e.color},map:{value:e.map}},vertexShader:Ue,fragmentShader:He,depthTest:!1,transparent:!0}))).params=e,n.map=void 0,n.map=e.map,n}return Object(v.a)(t,e),t}(w.ShaderMaterial),Ue="\nattribute float size;\nuniform float sizeGlobal;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",He="\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\n#ifdef USE_MAP\n  uniform mat3 uvTransform;\n  uniform sampler2D map;\n#endif\n\nvoid main() {\n    gl_FragColor = vec4( color, opacity );\n\n    #ifdef USE_MAP\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\n        gl_FragColor *= mapTexelToLinear( mapTexel );\n    #endif\n}\n",_e=function(e){function t(e,n,r){var i;Object(c.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).animationOffset=0,i.waters=[],i.sugars=[],i.handleGetResources=function(e){for(var t=Math.ceil(i.target.water);i.waters.length<t;){var n=e.carrier.pos.clone().sub(i.target.carrier.pos);n.x+=.1*(Math.random()-.5),n.y+=.1*(Math.random()-.5),i.waters.push(n)}for(t=Math.ceil(i.target.sugar);i.sugars.length<t;){var r=e.carrier.pos.clone().sub(i.target.carrier.pos);r.x+=.1*(Math.random()-.5),r.y+=.1*(Math.random()-.5),i.sugars.push(r)}},i.handleGiveResources=function(){var e=Math.ceil(i.target.water);i.waters.length>e&&i.waters.splice(e,i.waters.length-e),e=Math.ceil(i.target.sugar),i.sugars.length>e&&i.sugars.splice(e,i.sugars.length-e)},e.on("get",i.handleGetResources),e.on("give",i.handleGiveResources);for(var a=0;a<i.target.water;a++)i.waters.push(Ke());for(var o=0;o<i.target.sugar;o++)i.sugars.push(Ke());return i}return Object(v.a)(t,e),Object(u.a)(t,null,[{key:"startFrame",value:function(){t.WaterParticles().startFrame(),t.SugarParticles().startFrame()}},{key:"endFrame",value:function(){t.WaterParticles().endFrame(),t.SugarParticles().endFrame()}}]),Object(u.a)(t,[{key:"updateNumParticles",value:function(e){}},{key:"commitParticles",value:function(e,t,n){if(n.length>0){for(var r=0;r<n.length-1;r++){var i=n[r];e.commit(i.x+this.target.carrier.pos.x,i.y+this.target.carrier.pos.y,10,1),t-=1}var a=n[n.length-1],o=t;e.commit(a.x+this.target.carrier.pos.x,a.y+this.target.carrier.pos.y,10,o)}}},{key:"simulateResourcePositions",value:function(){var e=this.waters.concat(this.sugars),t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=0,l=0,c=performance.now()/3e3+this.animationOffset;s+=.02*Math.cos(c);var u=.1+.1*o.length();if(s+=-o.x*u,l+=-o.y*u,this.mito.world.player.pos.equals(this.target.carrier.pos)){var h=Math.max(Math.min(B(o.lengthSq(),0,1,3,-5),3),0),d=o.clone().multiplyScalar(.2*h);s+=d.x,l+=d.y}var v=!0,f=!1,m=void 0;try{for(var p,y=e[Symbol.iterator]();!(v=(p=y.next()).done);v=!0){var g=p.value;if(o===g)break;var w=o.x-g.x,b=o.y-g.y,k=w*w+b*b;if(k>0){var E=.003/k;s+=w*E,l+=b*E}}}catch(O){f=!0,m=O}finally{try{v||null==y.return||y.return()}finally{if(f)throw m}}o.x+=s,o.y+=l}}catch(O){n=!0,r=O}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"update",value:function(){this.updateNumParticles(this.target.water),this.updateNumParticles(this.target.sugar),this.simulateResourcePositions(),this.commitParticles(t.WaterParticles(),this.target.water,this.waters),this.commitParticles(t.SugarParticles(),this.target.sugar,this.sugars)}},{key:"destroy",value:function(){}}]),t}(Ge);function Ke(){return new w.Vector2(.01*(Math.random()-.5),.01*(Math.random()-.5))}_e.WaterParticles=Be(function(){return new ze({color:new w.Color("rgb(9, 12, 255)"),size:45,opacity:.75})}),_e.SugarParticles=Be(function(){return new ze({color:new w.Color("yellow"),size:85,opacity:.9,map:Ye(42,12,"transparent")})});var Xe=function(e){function t(e){var n,r;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,t.geometry,(r=e.target,Ze().get(r.constructor).clone())))).renderer=e,n}return Object(v.a)(t,e),t}(w.Mesh);Xe.geometry=new w.PlaneBufferGeometry(1,1);var Je=function(e){function t(e,n,r){var a;Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).mesh=void 0,a.inventoryRenderer=void 0,a.originalColor=void 0,a.audio=void 0,a.lastAudioValueTracker=0,a.pairsLines=[],a.worldDomElement=void 0,a.growingRenderer=void 0,a.target instanceof fe?(a.growingRenderer=new t(a.target.completedCell,a.scene,a.mito),a.mesh=a.growingRenderer.mesh):a.mesh=new Xe(Object(P.a)(a)),a.originalColor=a.mesh.material.color.clone(),Y(a.target)&&(a.inventoryRenderer=new _e(a.target.inventory,a.scene,a.mito),a.inventoryRenderer.animationOffset=(a.target.pos.x+a.target.pos.y)/2),a.scene.add(a.mesh);var o=a.target instanceof ve?1:0;if(a.mesh.position.set(a.target.pos.x,a.target.pos.y,o),a.target instanceof ve?a.target.constructor.turnsToBuild||a.mesh.scale.set(.01,.01,1):a.mesh.matrixAutoUpdate=!1,a.mesh.updateMatrix(),(a.target instanceof pe||a.target instanceof ye)&&(a.audio=new w.Audio(a.mito.audioListener),a.mesh.add(a.audio)),a.target instanceof ge){var s=a.target;a.worldDomElement=r.addWorldDOMElement(function(){return a.target.pos},function(){return i.a.createElement("div",{className:"fruit-indicator"},i.a.createElement("div",null,s.committedResources.water.toFixed(1),"/",ge.neededResources/2," water"),i.a.createElement("div",null,s.committedResources.sugar.toFixed(1),"/",ge.neededResources/2," sugar"))})}return a}return Object(v.a)(t,e),Object(u.a)(t,[{key:"steps",value:function(e,t){return Math.floor(e/t)*t}},{key:"update",value:function(){var e=this;if(this.target instanceof fe){var n=B(1.001-this.target.timeRemaining/this.target.timeToBuild,0,1,.2,1);D(this.mesh.scale,{x:n,y:n},.1)}else if(this.target instanceof ge){var r=B(this.target.getPercentMatured(),0,1,.2,1),i=new w.Vector2(r,r);D(this.mesh.scale,i,.1)}else D(this.mesh.scale,t.ONE,.1);var a=this.target.lightAmount(),o=this.mesh.material;if(this.target instanceof le){var s=Math.max(0,B(this.target.co2(),1/6,1.001,0,$e.length-1)),l=Math.floor(s),c=$e[l];if(this.originalColor=c.clone(),l!==$e.length-1){var u=s-l,h=$e[l+1];this.originalColor.lerp(h,u)}}if(o.color=new w.Color(0).lerp(this.originalColor,B(a,0,1,.2,1)),this.target instanceof ve&&this.mesh.position.set(this.target.pos.x,this.target.pos.y+this.target.droopY,1),ie(this.target)&&o.color.lerp(new w.Color(0),1-this.target.energy/q.cellEnergyMax),null!=this.inventoryRenderer&&a>0&&this.inventoryRenderer.update(),this.target instanceof pe&&null!=this.audio){var d=this.target.didConvert?1:0;if(d!==this.lastAudioValueTracker&&d>0){this.audio.setBuffer(C);var v=this.target.pos.distanceToSquared(this.mito.world.player.pos),f=Math.min(1,1/(1+v/25))*this.target.sugarConverted*this.target.sugarConverted;this.audio.setVolume(f),this.audio.play()}this.lastAudioValueTracker=d}if(this.target instanceof ye&&null!=this.audio){var m=this.target.waterTransferAmount;if(m!==this.lastAudioValueTracker){this.audio.setBuffer(A);var p=this.target.waterTransferAmount/(2+this.target.waterTransferAmount),y=this.target.pos.distanceToSquared(this.mito.world.player.pos),g=Math.min(1,1/(1+y/25))*p;this.audio.setVolume(g),null!=this.audio.source&&this.audio.stop(),this.audio.play()}this.lastAudioValueTracker=m}if(this.target.tilePairs instanceof Array){var b=this.target instanceof pe?16763150:new w.Color("rgb(9, 12, 255)").getHex(),k=this.target.tilePairs;k.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=k.map(function(t){var n=2*t.length()-.25,r=new w.Vector3(t.x,t.y,0).normalize(),i=e.makeLine(r,r.clone().multiplyScalar(-n/2),n,b);return e.mesh.add(i),i}))}if(this.hasActiveNeighbors(this.target)){var E=this.target instanceof ye?new w.Color("rgb(9, 12, 255)").getHex():16777215,O=this.target.activeNeighbors;O.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=O.map(function(t){var n=t.length()-.25,r=new w.Vector3(t.x,t.y,0).normalize(),i=e.target instanceof ye?e.makeLine(r,new w.Vector3,n,E):new w.ArrowHelper(r,new w.Vector3(0,0,5),n,E);return e.mesh.add(i),i}))}}},{key:"hasActiveNeighbors",value:function(e){return Array.isArray(e.activeNeighbors)}},{key:"makeLine",value:function(e,n,r,i){var a=new w.Line(t.lineGeometry,new w.LineBasicMaterial({color:i}));if(a.position.copy(n),e.y>.99999)a.quaternion.set(0,0,0,1);else if(e.y<-.99999)a.quaternion.set(1,0,0,0);else{var o=new w.Vector3(e.z,0,-e.x).normalize(),s=Math.acos(e.y);a.quaternion.setFromAxisAngle(o,s)}return a.scale.set(1,Math.max(0,r),1),a.position.z=.1,a.updateMatrix(),a.matrixAutoUpdate=!1,a}},{key:"destroy",value:function(){this.scene.remove(this.mesh),null!=this.worldDomElement&&this.mito.removeWorldDOMElement(this.worldDomElement),null!=this.inventoryRenderer&&this.inventoryRenderer.destroy()}}]),t}(Ge);Je.ONE=new w.Vector2(1,1),Je.lineGeometry=function(){var e=new w.BufferGeometry;return e.addAttribute("position",new w.Float32BufferAttribute([0,0,0,0,1,0],3)),e}();var Ze=Be(function(){var e=new Map;return e.set(le,new w.MeshBasicMaterial({side:w.DoubleSide,depthWrite:!1})),e.set(ce,new w.MeshBasicMaterial({map:Ye(8,11),side:w.DoubleSide,color:new w.Color("rgb(112, 89, 44)"),depthWrite:!1})),e.set(de,new w.MeshBasicMaterial({map:Ye(3.5,2.375),side:w.DoubleSide})),e.set(ue,new w.MeshBasicMaterial({map:Ye(26,20),side:w.DoubleSide,color:new w.Color("rgb(63, 77, 84)")})),e.set(he,new w.MeshBasicMaterial({map:Ye(8.5625,23.375),side:w.DoubleSide,color:new w.Color("rgb(128, 128, 128)")})),e.set(me,new w.MeshBasicMaterial({map:Ye(6,31),side:w.DoubleSide,color:new w.Color(3190309)})),e.set(be,e.get(me)),e.set(pe,new w.MeshBasicMaterial({map:Ye(55/16,17.5),side:w.DoubleSide})),e.set(ye,new w.MeshBasicMaterial({map:Ye(59/16,327/16),side:w.DoubleSide})),e.set(ge,new w.MeshBasicMaterial({map:Ve,side:w.DoubleSide,transparent:!0})),e.set(ke,new w.MeshBasicMaterial({map:Ye(Math.floor(11.5),Math.floor(9.5)),side:w.DoubleSide})),e});var $e=[new w.Color("hsl(67, 31%, 25%)"),new w.Color("hsl(180, 31%, 76%)"),new w.Color("hsl(213, 63%, 58%)")];n(54);function Qe(e){var t=e.type,n=e.isSelected,i=e.onClick,a=r.useMemo(function(){var e=Ze().get(t),n=e.color.getStyle(),r=function(){var t=e.map.image;return null==t?"url()":t instanceof HTMLCanvasElement?"url(".concat(t.toDataURL(),")"):t instanceof Image?"url(".concat(t.src,")"):void 0}();return{backgroundImage:"linear-gradient(".concat(n,", ").concat(n,"), ").concat(r)}},[t]);return r.createElement("div",{className:g()("cell-bar-item",{selected:n}),onClick:i,style:a},t.displayName)}function et(e){var t=e.hotkey,n=e.onClick,i=Object(f.a)(e,["hotkey","onClick"]);return r.createElement("div",Object.assign({className:"mito-hud-button mito-hud-build-item",onClick:function(e){n&&n(e),function(e){e.preventDefault(),document.getElementsByTagName("canvas")[0].focus()}(e)}},i),r.createElement("span",{className:"mito-hud-button-hotkey"},t))}var tt=function(e){var t=e.bar,n=e.index,i=e.onIndexClicked;return r.createElement("div",{className:"cell-bar"},t.map(function(e,t){return r.createElement("div",{key:t},r.createElement(Qe,{type:e,isSelected:n===t,onClick:function(){return i(t)}}),r.createElement(et,{hotkey:String(t+1),onClick:function(){return i(t)}}))}))};n(55);function nt(e){var t=e.percent,n={left:"".concat((100*t).toFixed(2),"%")};return r.createElement("div",{className:"bar-marker",style:n})}function rt(e){var t=e.percent,n={left:"".concat((100*t).toFixed(2),"%")};return r.createElement("div",{className:"season-bead",style:n})}function it(e){var t,n=e.time,i=e.season,a=n/xe,o=Math.floor(3*i.percent)+1;return r.createElement("div",{className:"seasons-tracker"},r.createElement("div",{className:"container"},r.createElement("div",{className:"end-brace"}),r.createElement("div",{className:"bar"},r.createElement(nt,{percent:.25}),r.createElement(nt,{percent:.5}),r.createElement(nt,{percent:.75}),r.createElement(rt,{percent:a})),r.createElement("div",{className:"end-brace"})),r.createElement("div",null,(t=i.name).substr(0,1).toLocaleUpperCase()+t.substr(1),", Month ",o))}var at=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(u.a)(t,[{key:"isTutorialFinished",value:function(){return null==this.mito.tutorialRef||this.mito.tutorialRef.isFinished()}},{key:"render",value:function(){var e=this,t=this.inventory.isMaxed(),n=r.createElement("div",{className:"mito-inventory-maxed".concat(t?" is-maxed":"")},"maxed");return r.createElement(r.Fragment,null,r.createElement(it,{time:this.world.time,season:this.world.season}),r.createElement("div",{className:g()("mito-inventory",{hidden:!1})},n,r.createElement("div",{className:"mito-inventory-container"},this.renderInventoryBar(),this.renderInventory()),r.createElement(tt,{bar:this.mito.cellBar,index:this.mito.cellBarIndex,onIndexClicked:function(t){return e.mito.setCellBarIndex(t)}})))}},{key:"renderInventory",value:function(){return r.createElement("div",{className:"mito-inventory-indicator"},r.createElement("span",{className:"mito-inventory-water"},this.inventory.water.toFixed(2)," water"),"\xa0",r.createElement("span",{className:"mito-inventory-sugar"},this.inventory.sugar.toFixed(2)," sugar"))}},{key:"renderInventoryBar",value:function(){var e=this.inventory.water/q.maxResources,t=this.inventory.sugar/q.maxResources,n=1-(this.inventory.water+this.inventory.sugar)/q.maxResources,i={width:"".concat(100*e,"%")},a={width:"".concat(100*t,"%")},o={width:"".concat(100*n,"%")};return r.createElement("div",{className:"mito-inventory-bar"},r.createElement("div",{style:i,className:"mito-inventory-bar-water"}),r.createElement("div",{style:a,className:"mito-inventory-bar-sugar"}),r.createElement("div",{style:o,className:"mito-inventory-bar-empty"}))}},{key:"mito",get:function(){return this.props.mito}},{key:"world",get:function(){return this.mito.world}},{key:"player",get:function(){return this.world.player}},{key:"inventory",get:function(){return this.player.inventory}}]),t}(r.Component),ot=n(44),st=Be(function(){var e=new te,t=new te,n=new te;return{climate:{turnsBetweenRainfall:800,rainDuration:50,waterPerDroplet:2},evaporationRate:2e-4,evaporationBottom:.6,floorCo2:.5,waterGravityPerTurn:.001,fill:[function(r,i){var a=r.x,o=r.y,s=i.height/2-4*(n.perlin2(0,a/5)+1)/2-16*n.perlin2(10,a/20+10),l=B(o-i.height/2,0,i.height/2,-.7,.3),c=t.simplex2(a/5,o/5)<l;if(o>s){if(c)return new ue(r,i);var u=Math.pow(B(o-i.height/2,0,i.height/2,.5,1),2),h=e.simplex2(.2*a,.2*o)+.2,d=Math.round(Math.max(1,Math.min(20,h>.4?20*u:0)));if(u*h>1/q.fountainAppearanceRate){var v=Math.min(u*h,1);return new de(r,d,i,Math.round(q.fountainTurnsPerWater/v))}return new ce(r,d,i)}}]}}),lt=Be(function(){var e=new te,t=new te;return{climate:{rainDuration:220,turnsBetweenRainfall:3e3,waterPerDroplet:8},evaporationRate:.002,evaporationBottom:.7,waterGravityPerTurn:.02,floorCo2:.95,fill:[function(n,r){var i=n.x,a=n.y,o=r.height/2-2*(e.perlin2(0,i/20)+1)/2-3*e.perlin2(10,i/100+10),s=B(a,r.height/2,r.height,-.8,-.4),l=t.simplex2(i/4,a/4)<s;if(a>o){if(l)return new ue(n,r);var c=Math.floor(Math.max(0,B(a,.75*r.height,r.height,1,9)));return new ce(n,c,r)}}]}}),ct=Be(function(){var e=new te,t=new te;return{climate:{turnsBetweenRainfall:1200,rainDuration:120,waterPerDroplet:3},waterGravityPerTurn:.1,evaporationBottom:.6,evaporationRate:.001,floorCo2:1,fill:[function(n,r){var i=n.x,a=n.y,o=.55*r.height-4*(t.perlin2(0,i/5)+1)/2-16*t.perlin2(10,i/20+10)-B(i,0,r.width,10,-10),s=a-6*(t.perlin2(0,i/25)+1)/2-20*t.perlin2(10,i/150+10)<.5*r.height?-1:-.15;return e.simplex2(i/10,a/10)<s?new ue(n,r):a>o?new ce(n,3,r):void 0}]}}),ut={Temperate:st,Desert:lt,Rocky:ct},ht=(r.Component,n(31));function dt(e,t,n){return new ht.AStarFinder({diagonalMovement:ht.DiagonalMovement.Always}).findPath(t.x,t.y,n.x,n.y,e)}function vt(e,t,n){for(var r=new ht.Grid(e,t),i=0;i<e;i++)for(var a=0;a<t;a++)r.setWalkableAt(i,a,!1);for(var o=0;o<e;o++)for(var s=0;s<t;s++)n(o,s,r);return r}var ft=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.props.parent.add(this.props.object)}},{key:"componentWillUnmount",value:function(){this.props.parent.remove(this.props.object)}}]),t}(r.PureComponent),mt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).rafid=void 0,n.animate=function(e){n.props.a(e/1e3),n.rafid=requestAnimationFrame(n.animate)},n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.rafid=requestAnimationFrame(this.animate)}},{key:"componentWillUnmount",value:function(){this.rafid&&cancelAnimationFrame(this.rafid)}}]),t}(i.a.Component),pt=Be(function(){var e=new w.PlaneBufferGeometry(1,1),t=new w.EdgesGeometry(e,1),n=new w.LineBasicMaterial({color:16777215,transparent:!0,opacity:.75}),r=new w.LineSegments(t,n);return r.position.z=10,r}),yt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).object=pt().clone(),n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(mt,{a:function(t){return e.object.scale.setScalar(.04*Math.sin(3.7*t)+.94)}}),r.createElement(ft,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),gt=Be(function(){var e=new w.CircleBufferGeometry(.1,20),t=new w.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.75,side:w.DoubleSide}),n=new w.Mesh(e,t);return n.position.z=10,n}),wt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).object=gt().clone(),n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(ft,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),bt=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.mito.highlightedTile,t=this.props.mito.getHighlightPosition();return r.createElement(r.Fragment,null,r.createElement(De,{tile:e}),r.createElement(wt,{x:t.x,y:t.y,scene:this.scene}),this.maybeRenderTileHighlight(e))}},{key:"maybeRenderTileHighlight",value:function(e){if(e)return r.createElement(yt,{x:e.pos.x,y:e.pos.y,scene:this.scene})}},{key:"scene",get:function(){return this.props.mito.scene}}]),t}(r.Component),kt=(r.PureComponent,n(45)),Et=function(e){function t(e,n,r){var i;return Object(c.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).mesh=void 0,i.mesh=new w.Mesh(new w.PlaneBufferGeometry(.75,.75),new w.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:Ye(29,12,"transparent"),color:new w.Color("white"),side:w.DoubleSide})),D(i.mesh.position,i.target.pos,1),i.mesh.position.z=2,i.scene.add(i.mesh),i}return Object(v.a)(t,e),Object(u.a)(t,[{key:"update",value:function(){var e=this.target.droopPosFloat().clone();e.x+=.04*Math.cos(performance.now()/1e3),e.y+=.08*Math.sin(performance.now()/400),D(this.mesh.position,e,.5),this.mesh.position.z=2}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(Ge),Ot=function(e){function t(e,n,r){var i;return Object(c.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).arrow=void 0,i.arrow=i.makeArrow(i.target.dir),i.mesh.add(i.arrow),i}return Object(v.a)(t,e),Object(u.a)(t,[{key:"makeArrow",value:function(e){var t=e.length()-.25,n=new w.Vector3(e.x,e.y,0).normalize(),r=n.clone().multiplyScalar(-t/2);return new w.ArrowHelper(n,new w.Vector3(r.x,r.y,1),t,16777215,.1,.1)}}]),t}(Je);var jt=function(e){function t(e,n,r){var i;return Object(c.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).renderers=new Map,i.deleteDeadEntityRenderers=Object(kt.a)(function(e){return e},function(e){var t=e.deleted,n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,c=i.renderers.get(l);if(null==c)throw new Error("Couldn't find renderer for ".concat(l,"!"));c.destroy(),i.renderers.delete(l)}}catch(u){r=!0,a=u}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}}),n.add(_e.WaterParticles()),n.add(_e.SugarParticles()),i}return Object(v.a)(t,e),Object(u.a)(t,[{key:"getOrCreateRenderer",value:function(e){var t=this.renderers.get(e);if(null==t){var n=function(e,t,n){if(e instanceof Ee)return new Et(e,t,n);if(e instanceof be)return new Ot(e,t,n);if(e instanceof ae)return new Je(e,t,n);throw new Error("Couldn't find renderer for ".concat(e))}(e,this.scene,this.mito);return this.renderers.set(e,n),n}return t}},{key:"update",value:function(){var e=this;this.deleteDeadEntityRenderers(this.target.getLastStepStats()),_e.startFrame(),this.target.entities().forEach(function(t){e.getOrCreateRenderer(t).update()}),_e.endFrame()}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}}]),t}(Ge),xt=function(){function e(t,n,r){Object(c.a)(this,e),this.mito=t,this.positionFn=n,this.renderFn=r}return Object(u.a)(e,[{key:"render",value:function(){var e=this.positionFn(),t=this.mito.worldToScreen(e),n={left:t.x,top:t.y};return r.createElement("div",{style:n},this.renderFn())}}]),e}(),Mt=function(e){function t(e,n,r,i){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).onWinLoss=i,a.world=void 0,a.scene=new w.Scene,a.camera=new w.OrthographicCamera(0,0,0,0,-100,100),a.cellBar=[me,pe,ye,be,ge],a.cellBarIndex=0,a.tutorialRef=null,a.mouse=new w.Vector2,a.mouseDown=!1,a.mouseButton=-1,a.instructionsOpen=!1,a.firstActionTakenYet=!1,a.audioListener=new w.AudioListener,a.keyMap=new Set,a.highlightedTile=void 0,a.events={contextmenu:function(e){return e.preventDefault(),!1},mousemove:function(e){a.mouse.x=e.clientX,a.mouse.y=e.clientY},click:function(){},mousedown:function(e){a.mouseButton=e.button,a.mouseDown=!0},mouseup:function(){a.mouseDown=!1},keydown:function(e){a.firstActionTakenYet=!0;var t=e.key;a.keyMap.add(t),e.repeat||a.handleKeyDown(t)},keyup:function(e){a.keyMap.delete(e.key)},wheel:function(e){e.deltaX+e.deltaY<0?a.setCellBarIndex(a.cellBarIndex-1):a.setCellBarIndex(a.cellBarIndex+1)}},a.worldRenderer=void 0,a.handleKeyDown=function(e){if("?"!==e){if(a.instructionsOpen)"Escape"===e&&(a.instructionsOpen=!1);else if(-1!==["1","2","3","4","5"].indexOf(e)){var t=e.charCodeAt(0)-"1".charCodeAt(0);a.cellBarIndex=t}}else a.instructionsOpen=!a.instructionsOpen},a.worldDomElements=new Set,null==r.info.world&&(r.info.world=new Ce(r.info.environment)),a.world=r.info.world,a.camera.position.z=10,a.camera.lookAt(new w.Vector3(0,0,0)),a.camera.position.x=a.world.player.pos.x,a.camera.position.y=a.world.player.pos.y,a.camera.zoom=1.5,a.camera.add(a.audioListener),a.worldRenderer=new jt(a.world,a.scene,Object(P.a)(a)),a.world.step(),function(e){var t=0;function n(){3===++t&&(E.audio.currentTime=0,O.audio.currentTime=0,j.audio.currentTime=0,E.gain.connect(e.gain),O.gain.connect(e.gain),j.gain.connect(e.gain))}(E=L(e,"mito-base")).audio.oncanplaythrough=n,E.gain.gain.value=.5,(O=L(e,"mito-strings")).audio.oncanplaythrough=n,O.gain.gain.value=0,(j=L(e,"mito-drums")).audio.oncanplaythrough=n,j.gain.gain.value=0,(x=L(e,"footsteps")).gain.gain.value=0,x.gain.connect(e.gain),(M=L(e,"build")).gain.gain.value=0,M.gain.connect(e.gain);var r=new w.AudioLoader;r.load("assets/audio/Blop-Mark_DiAngelo-79054334.mp3",function(e){C=e},function(e){e.loaded,e.total},function(e){}),r.load("assets/audio/suckwater.wav",function(e){A=e},function(e){e.loaded,e.total},function(e){})}(a.audioContext),a.updateAmbientAudio(),window.mito=Object(P.a)(a),window.THREE=w,a}return Object(v.a)(t,e),Object(u.a)(t,[{key:"selectedCell",get:function(){return this.cellBar[this.cellBarIndex]}}]),Object(u.a)(t,[{key:"setCellBarIndex",value:function(e){this.cellBarIndex=(e%this.cellBar.length+this.cellBar.length)%this.cellBar.length}},{key:"render",value:function(){var e=[],t=!0,n=!1,i=void 0;try{for(var a,o=this.worldDomElements[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;e.push(s.render())}}catch(l){n=!0,i=l}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return r.createElement(r.Fragment,null,r.createElement(at,{mito:this}),r.createElement(Pe,{mito:this}),r.createElement(bt,{mito:this}),r.createElement("div",{className:"world-dom-components"},e))}},{key:"updateAmbientAudio",value:function(){var e=this.world.player.pos.y,t=B(e,this.world.height/2,this.world.height,0,.5),n=B(e,this.world.height/2,0,0,.5);j.gain.gain.value=Math.max(0,t),O.gain.gain.value=Math.max(0,n)}},{key:"logRenderInfo",value:function(){"Geometries in memory: ".concat(this.renderer.info.memory.geometries,"\nTextures in memory: ").concat(this.renderer.info.memory.textures,"\n# Render Calls: ").concat(this.renderer.info.render.calls,"\n# Render Lines: ").concat(this.renderer.info.render.lines,"\n# Render Points: ").concat(this.renderer.info.render.points,"\n# Render Tris: ").concat(this.renderer.info.render.triangles,"\n")}},{key:"perfDebug",value:function(){var e=0,t=0;this.scene.traverse(function(n){n.matrixAutoUpdate?e++:t++}),console.log("yes",e,"no",t);var n=new Map;this.scene.traverse(function(e){var t=n.get(e.name||e.constructor.name)||[];n.set(e.name||e.constructor.name,t),t.push(e)}),console.log(n)}},{key:"worldStep",value:function(){if(this.firstActionTakenYet&&!this.instructionsOpen){this.world.step(),this.tutorialRef&&this.tutorialRef.setState({time:this.world.time});var e=this.world.maybeGetGameResult();null!=e&&this.onWinLoss(e),this.updateAmbientAudio()}}},{key:"getCameraNormCoordinates",value:function(e,t){return new w.Vector2(e/this.canvas.width*2-1,-t/this.canvas.height*2+1)}},{key:"getHighlightVector",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=new w.Vector2(e-this.canvas.width/2,t-this.canvas.height/2);return n.setLength(.75),n}},{key:"getHighlightPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightVector(e,t),r=this.world.player.posFloat,i=r.x,a=r.y;return n.x+=i,n.y+=a,n}},{key:"getHighlightedTile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightPosition(e,t);n.round();var r=this.world.tileAt(n.x,n.y);if(null!=r&&r.lightAmount()>0)return r}},{key:"worldToScreen",value:function(e){var t=new w.Vector3(e.x,e.y,0);return t.project(this.camera),t.x=Math.round((.5+t.x/2)*this.canvas.width),t.y=Math.round((.5-t.y/2)*this.canvas.height),t}},{key:"addWorldDOMElement",value:function(e,t){var n=new xt(this,e,t);return this.worldDomElements.add(n),n}},{key:"removeWorldDOMElement",value:function(e){this.worldDomElements.delete(e)}},{key:"animate",value:function(){if(!this.instructionsOpen){if(this.canvas.focus(),q.isRealtime){var e=this.keysToMovement(this.keyMap);e&&this.world.player.setAction(e);var t=!0,n=!1,r=void 0;try{for(var i,a=this.keyMap[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;Se[o]&&this.world.player.setAction(Se[o])}}catch(c){n=!0,r=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}this.mouseDown&&(0===this.mouseButton?this.handleLeftClick():2===this.mouseButton&&this.handleRightClick()),this.worldStep()}else null!=this.world.player.getAction()&&this.worldStep();this.worldRenderer.update(),this.highlightedTile=this.getHighlightedTile();var s=this.getCameraNormCoordinates(this.mouse.x,this.mouse.y),l=new w.Vector2(this.world.player.posFloat.x+s.x/2,this.world.player.posFloat.y-s.y/2);D(this.camera.position,l,.3),this.renderer.render(this.scene,this.camera)}}},{key:"keysToMovement",value:function(e){var t=new w.Vector2,n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;Te[s]&&t.add(Te[s].dir)}}catch(l){r=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return 0===t.x&&0===t.y?null:{type:"move",dir:t}}},{key:"resize",value:function(e,t){var n=t/e;this.camera.left=-12/n,this.camera.right=12/n,this.camera.top=-12,this.camera.bottom=12,this.camera.updateProjectionMatrix()}},{key:"handleRightClick",value:function(){var e=this.getHighlightedTile();if(null!=e){if(e instanceof ge)return;this.world.player.setAction({type:"deconstruct",position:e.pos})}}},{key:"handleLeftClick",value:function(){this.firstActionTakenYet=!0;var e=this.getHighlightedTile();if(null!=e&&this.world.player.isBuildCandidate(e)){var t=[];if(this.selectedCell===be){var n=this.getHighlightVector().setLength(1).round();t.push(n)}var r={type:"build",cellType:this.selectedCell,position:e.pos.clone(),args:t};this.world.player.setAction(r)}}}]),t}(k);Mt.expansionTiles=[me,ye,ke];var Ct=Mt,At=n(29),Rt=n(88);function St(e,t){var n=t.dX,r=t.dY,i=t.scale,a=e.cartesian,o=a.x,s=a.y;return[window.innerWidth/2+n+o*i,window.innerHeight/2+r+s*i]}n(72),n(73);var Tt=function(e){var t=e.tile,n=e.camera,r=e.children,a=St(t,n),o=Object(K.a)(a,2),s=o[0],l=o[1],c={left:s+.5*n.scale,top:l};return i.a.createElement("div",{className:"overworld-modal",style:c},i.a.createElement("div",{className:"overworld-modal-positioner"},r))};n(74);var Nt=function(e){var t=e.children,n=e.shrunkElements,a=Object(r.useState)(!1),o=Object(K.a)(a,2),s=o[0],l=o[1];return i.a.createElement("div",null,i.a.createElement("div",{className:"expand-button",onClick:function(){l(!s)}},n,i.a.createElement("div",{className:"expand-caret"},s?"\u25bc":"\u25b6")),s?i.a.createElement("div",null,t):null)};n(75);var Pt=function(e){var t=e.tile,n=e.onClickPlay,r=-1===t.info.height||t.info.conquered?null:i.a.createElement("div",{className:"play-button",onClick:function(){n(t)}},"Populate"),a=t.info.conquered?i.a.createElement("h1",null,"Populated"):-1===t.info.height?i.a.createElement("h1",null,"Deep Water"):i.a.createElement("h1",null,"Unexplored"),o=Object(G.a)({},t.info);delete o.world;var s=-1===t.info.height?null:i.a.createElement(Nt,{shrunkElements:i.a.createElement("div",{className:"details"},"Details")},i.a.createElement("pre",{style:{fontSize:"12px"}},JSON.stringify(o,null,4)));return i.a.createElement("div",{className:"hex-tile-info-container"},a,s,r)},Dt=Math.sqrt(3)/2,Bt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={cameraState:{scale:48,dX:0,dY:0},pressedKeys:{}},n.canvas=null,n.rafId=void 0,n.handleCanvasRef=function(e){n.canvas=e,null!=e&&n.handleResize()},n.handleCanvasClick=function(e){if(null!=n.canvas)if(null!=n.state.highlightedTile)n.setState({highlightedTile:void 0});else{var t=function(e,t,n,r){var i=n.scale,a=n.dX,o=n.dY,s=t.width/2+a,l=t.height/2+o,c=r.nativeEvent,u=c.offsetX,h=c.offsetY,d=(u-s)/i/1.5,v=((h-l)/i-Dt*d)/(2*Dt),f=function(e,t,n){var r=Math.round(e),i=Math.round(t),a=Math.round(n),o=Math.abs(r-e),s=Math.abs(i-t),l=Math.abs(a-n);return o>s&&o>l?r=-i-a:s>l?i=-r-a:a=-r-i,{i:r,j:i,k:a}}(d,v,-(d+v));return e.tileAt(f.i,f.j)}(n.props.overWorld,n.canvas,n.state.cameraState,e);null!=t&&t.info.visible&&n.setState({highlightedTile:t})}},n.onPlayLevel=function(e){n.props.onPlayLevel(e)},n.handleKeyDown=function(e){if(!e.repeat){var t=Object(G.a)({},n.state.pressedKeys,Object(At.a)({},e.code,!0));n.setState({pressedKeys:t})}},n.handleKeyUp=function(e){var t=Object(G.a)({},n.state.pressedKeys);delete t[e.code],n.setState({pressedKeys:t})},n.handleResize=function(){null!=n.canvas&&(n.canvas.width=window.innerWidth,n.canvas.height=window.innerHeight,n.drawMap())},n.updateCamera=function(){var e=new w.Vector2;for(var t in n.state.pressedKeys)"KeyW"===t||"ArrowUp"===t?e.y+=20:"KeyS"===t||"ArrowDown"===t?e.y-=20:"KeyA"===t||"ArrowLeft"===t?e.x+=20:"KeyD"!==t&&"ArrowRight"!==t||(e.x-=20);if(e.setLength(20),0!==e.x||0!==e.y){var r=n.state.cameraState;n.setState({cameraState:Object(G.a)({},r,{dX:r.dX+e.x,dY:r.dY+e.y})})}n.rafId=requestAnimationFrame(n.updateCamera)},n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"drawMap",value:function(){if(null!=this.canvas){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height);var e=!0,t=!1,n=void 0;try{for(var r,i=this.props.overWorld[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;Wt(this.canvas,this.state.cameraState,a)}}catch(o){t=!0,n=o}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),window.addEventListener("resize",this.handleResize),this.rafId=requestAnimationFrame(this.updateCamera)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("resize",this.handleResize),cancelAnimationFrame(this.rafId)}},{key:"componentDidUpdate",value:function(){this.drawMap()}},{key:"render",value:function(){return i.a.createElement("div",{className:"overworld-map-container"},i.a.createElement("canvas",{ref:this.handleCanvasRef,onClick:this.handleCanvasClick}),this.maybeRenderHighlightedTile())}},{key:"maybeRenderHighlightedTile",value:function(){if(null!=this.state.highlightedTile)return i.a.createElement(Tt,{camera:this.state.cameraState,tile:this.state.highlightedTile},i.a.createElement(Pt,{tile:this.state.highlightedTile,onClickPlay:this.onPlayLevel}))}}]),t}(i.a.Component);function Ft(e,t,n,r){e.strokeStyle="rgb(112, 112, 112)",e.beginPath(),e.moveTo(t+r,n);for(var i=1;i<6;i++){var a=i/6*Math.PI*2;e.lineTo(t+Math.cos(a)*r,n+Math.sin(a)*r)}e.closePath(),e.fill(),e.stroke()}var Lt=Object(Rt.a)().domain([-1,0,1,5,6]).range(["rgb(0, 60, 255)","lightblue","yellow","orange"]);function Wt(e,t,n){var r=t.scale,i=St(n,t),a=Object(K.a)(i,2),o=a[0],s=a[1],l=e.getContext("2d");n.info.visible?(l.fillStyle=Lt(n.info.height),Ft(l,o,s,r),l.font="12px serif",l.textAlign="center",l.textBaseline="middle",l.fillStyle="#666",l.fillText(n.info.height+"",o,s,r)):(l.fillStyle="grey",Ft(l,o,s,r))}var Vt=n(19),It=n.n(Vt),Yt=n(36),Gt=n.n(Yt),zt=Math.sqrt(3)/2,qt=function(){function e(t,n){Object(c.a)(this,e),this.i=t,this.j=n,this.neighbors=new Array(6),this.info={height:0,rainfall:"medium",soilType:"average",temperature:"temperate",wind:"low",conquered:!1,visible:!1}}return Object(u.a)(e,[{key:"k",get:function(){return-(this.i+this.j)}},{key:"magnitude",get:function(){return Math.abs(this.i)+Math.abs(this.j)+Math.abs(this.k)}},{key:"cartesian",get:function(){var e=this.i,t=this.j;return{x:1.5*e,y:2*zt*t+zt*e}}}]),e}(),Ut=Symbol.iterator,Ht=function(){function e(){Object(c.a)(this,e),this.tiles={}}return Object(u.a)(e,[{key:"hash",value:function(e,t){return"".concat(e,",").concat(t)}},{key:"get",value:function(e,t){return this.tiles[this.hash(e,t)]}},{key:"set",value:function(e,t,n){this.tiles[this.hash(e,t)]=n}},{key:"hookUpNeighbors",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value,o=a.i,s=a.j;a.neighbors[0]=this.get(o+1,s),a.neighbors[1]=this.get(o,s+1),a.neighbors[2]=this.get(o-1,s+1),a.neighbors[3]=this.get(o-1,s),a.neighbors[4]=this.get(o,s-1),a.neighbors[5]=this.get(o+1,s-1)}}catch(l){t=!0,n=l}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:Ut,value:It.a.mark(function e(){var t;return It.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=It.a.keys(this.tiles);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.tiles[t];case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)})}]),e}(),_t=Symbol.iterator,Kt=function(){function e(t){Object(c.a)(this,e),this.storage=t,this.startTile=void 0,t.hookUpNeighbors();var n=Array.from(t);this.startTile=n.filter(function(e){return 0===e.info.height}).sort(function(e,t){return e.magnitude-t.magnitude})[0],this.startTile.info.visible=!0}return Object(u.a)(e,null,[{key:"randomHeight",value:function(e,t){var n=e.cartesian,r=n.x,i=n.y,a=0;return a+=6*(t.noise3D(r/24,i/24,0)-.2),a+=6*t.noise3D(r/24,i/24,1.453),a+=1.5*t.noise3D(r/6,i/6,1.453),a+=1,(a-=.025*Math.abs(i*i))<0&&a>=-1&&(a=0),a=Math.round(Math.max(Math.min(a,6),-1))}},{key:"populateLevelInfo",value:function(t,n){var r=t.info;r.height=e.randomHeight(t,n),r.environment=r.height<2?st():r.height<4?ct():lt()}},{key:"generateFilledHex",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=new Ht,r=new Gt.a,i=-t;i<=t;i++)for(var a=-t;a<=t;a++){var o=-(i+a);if(!(Math.abs(o)>t)){var s=new qt(i,a);e.populateLevelInfo(s,r),n.set(i,a,s)}}return new e(n)}},{key:"generateRectangle",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,r=new Ht,i=new Gt.a,a=Math.max(t/2,n/2),o=-a;o<=a;o++)for(var s=-a;s<=a;s++){var l=-(o+s);if(!(Math.abs(l)>a)){var c=new qt(o,s),u=c.cartesian,h=u.x,d=u.y;h<-t/2||h>t/2||d<-n/2||d>n/2||(e.populateLevelInfo(c,i),r.set(o,s,c))}}return new e(r)}}]),Object(u.a)(e,[{key:"getStartTile",value:function(){return this.startTile}},{key:"tileAt",value:function(e,t){return this.storage.get(e,t)}},{key:_t,value:It.a.mark(function e(){var t,n,r,i,a,o;return It.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,i=this.storage[Symbol.iterator]();case 5:if(t=(a=i.next()).done){e.next=12;break}return o=a.value,e.next=9,o;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,r=e.t0;case 18:e.prev=18,e.prev=19,t||null==i.return||i.return();case 21:if(e.prev=21,!n){e.next=24;break}throw r;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})}]),e}();n(77);function Xt(){return r.createElement("div",{className:"glow"},r.createElement("span",null))}function Jt(e){var t=e.fruit;return r.createElement("div",{className:"fruit-info"},r.createElement("div",{className:"fruit-visual"},t.isMature()?r.createElement(Xt,null):null,r.createElement("img",{src:"assets/images/fruit.png"})),t.isMature()?r.createElement(r.Fragment,null,r.createElement("span",{className:"matured-info success"},"Matured"),"\xa0at ",t.timeMatured,", Mutation Points earned: 1"):r.createElement("span",{className:"matured-info in-progress"},(100*t.getPercentMatured()).toFixed(0),"% maturity"),", started ",t.timeMade,".")}function Zt(e){var t=e.results,n=t.fruits.filter(function(e){return e.isMature()});return r.createElement(r.Fragment,null,r.createElement("div",{className:"character-party-container"},r.createElement("img",{className:"character",src:"assets/images/character.png"})),r.createElement("h1",null,"You ",n.length>=3?"thrived":"survived","!"),r.createElement("h2",null,n.length," Mutation Points earned."),r.createElement("h5",null,"Fruit Made"),r.createElement("div",{className:"fruit-list"},t.fruits.map(function(e){return r.createElement(Jt,{fruit:e})})))}function $t(e){var t=e.results;return r.createElement(r.Fragment,null,r.createElement("h1",null,"You died!"),r.createElement("div",null,"You survived until ",t.world.season.name,"!"))}function Qt(e){var t=e.onDone,n=e.results;return r.createElement("div",{className:"game-results-screen ".concat(n.status)},r.createElement("div",{className:"game-results-content"},"won"===n.status?r.createElement(Zt,{onDone:t,results:n}):r.createElement($t,{onDone:t,results:n}),r.createElement("button",{className:"done-button",onClick:t},"Continue \u2192")))}var en=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handlePlayLevel=function(e){e.info.visible&&!e.info.conquered&&n.setState({activeLevel:e})},n.handleWinLoss=function(e){if(n.setState({activeGameResult:e}),"won"===e.status&&null!=n.state.activeLevel){var t=n.state.activeLevel;t.info.conquered=!0;var r=!0,i=!1,a=void 0;try{for(var o,s=t.neighbors[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value.info.visible=!0}}catch(l){i=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},n.handleResultsDone=function(){n.setState({activeLevel:void 0,activeGameResult:void 0})};var r=Kt.generateRectangle(100,50),i=r.getStartTile();return n.state={overWorld:r,activeLevel:i},n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"App"},this.maybeRenderOverWorldMap(),this.maybeRenderLevel(),this.maybeRenderGameResult())}},{key:"maybeRenderOverWorldMap",value:function(){if(null==this.state.activeLevel)return i.a.createElement(Bt,{overWorld:this.state.overWorld,onPlayLevel:this.handlePlayLevel})}},{key:"maybeRenderLevel",value:function(){if(null!=this.state.activeLevel&&null==this.state.activeGameResult)return i.a.createElement(N,{sketchClass:Ct,otherArgs:[this.state.activeLevel,this.handleWinLoss]})}},{key:"maybeRenderGameResult",value:function(){if(null!=this.state.activeGameResult)return i.a.createElement(Qt,{results:this.state.activeGameResult,onDone:this.handleResultsDone})}}]),t}(i.a.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(78);o.a.render(i.a.createElement(s.a,null,i.a.createElement(l.d,null,i.a.createElement(l.b,{path:"/test-win"},i.a.createElement(function(){var e=new Ce(st());e.time=150;var t=new ge(new w.Vector2(0,0),e);t.committedResources.add(50,50),t.timeMatured=250,e.time=479;var n=new ge(new w.Vector2(0,0),e);n.committedResources.add(25,15),e.time=1296;var r=new ge(new w.Vector2(0,0),e);r.committedResources.add(50,50);var a={status:"won",fruits:[t,n,r],world:e};return i.a.createElement(Qt,{results:a,onDone:function(){}})},null)),i.a.createElement(l.b,{exact:!0,path:"/"},i.a.createElement(en,null)),i.a.createElement(l.b,{path:"*"},i.a.createElement(l.a,{to:"/"})))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[49,1,2]]]);
//# sourceMappingURL=main.545f5fac.chunk.js.map