(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{105:function(e,t,n){},106:function(e,t,n){},115:function(e,t,n){},117:function(e,t,n){},118:function(e,t,n){},119:function(e,t,n){},131:function(e,t,n){},132:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){},135:function(e,t,n){},137:function(e,t,n){},143:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(27),o=n.n(i),s=n(66),l=n(22),c=n(4),u=n(3),h=n(7),d=n(5),f=n(6),m=a.a.createContext({x:window.innerWidth/2,y:window.innerHeight/2});var v=function(){return Object(r.useContext)(m)},p=n(8),y=n(9),g=n.n(y),w=new(function(){function e(){var t=this;Object(c.a)(this,e),this.tickerId=1,this.tickers={},this._time=0,this.tickerLoop=function(e){t._time=e;var n=[];for(var r in t.tickers){!0===(0,t.tickers[r])(e)&&n.push(Number(r))}for(var a=0,i=n;a<i.length;a++){var o=i[a];t.removeAnimation(o)}requestAnimationFrame(t.tickerLoop)}}return Object(u.a)(e,[{key:"addAnimation",value:function(e){var t=this.tickerId++;return this.tickers[t]=e,t}},{key:"removeAnimation",value:function(e){return delete this.tickers[e]}},{key:"start",value:function(){requestAnimationFrame(this.tickerLoop)}},{key:"now",get:function(){return this._time}}]),e}());w.start();var b=w,k=new Intl.NumberFormat(void 0,{maximumFractionDigits:2,useGrouping:!0});var E=function(e){var t=e.value,n=e.speed,r=void 0===n?.1:n,i=e.formatter,o=void 0===i?k:i,s=a.a.useState(t),l=Object(p.a)(s,2),c=l[0],u=l[1];return a.a.useEffect(function(){var e=b.addAnimation(function(){u(function(n){return Math.abs(n-t)<.005?(b.removeAnimation(e),t):n*(1-r)+t*r})});return function(){b.removeAnimation(e)}},[t,r]),a.a.createElement(a.a.Fragment,null,o.format(c))},x=n(11),O=n(13),j=n(31),A=n.n(j);n(78);function M(e){return a.a.createElement("button",Object.assign({},e,{className:g()("button",e.className,e.color||"purple")}),e.children)}var C=n(18),S=n(50),T=n.n(S);n(79);var R=function(e){var t=e.size,n=Object(C.a)(e,["size"]);return a.a.createElement("img",Object.assign({className:g()("character",t),alt:"",src:T.a},n))},P=n(28),N=(n(80),new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0}));var F=function(e){var t=e.amount,n=e.total,r=Object(C.a)(e,["amount","total"]);return a.a.createElement("div",Object.assign({},r,{className:g()("mp",r.className)}),a.a.createElement(E,{speed:.3,formatter:N,value:t}),null!=n?a.a.createElement(a.a.Fragment,null,"/",n):null,a.a.createElement(P.a,{className:"mp-icon"}))};var D=function(e){return e.substr(0,1).toLocaleUpperCase()+e.substr(1)};var B=Object.keys({carryCapacity:0,energyEfficiency:0,photosynthesis:0,rootAbsorption:0,structuralStability:0,activeTransportSugar:0,activeTransportWater:0,walkSpeed:0,diffuseWater:0,diffuseSugar:0,buildTime:0,heatTolerant:0,coldTolerant:0,fruitGrowthSpeed:0,fruitMutationPoints:0,fruitNeededResources:0});function W(e){for(var t=e.split(/([A-Z])+/g),n=D(t[0]),r=1;r<t.length;r+=2)n+=" "+t[r]+t[r+1];return n}function I(e,t){for(var n in t)e[n]=(r=(e[n]||0)+t[n])<-3?-3:r>3?3:r;var r}function L(e){var t={carryCapacity:0,energyEfficiency:0,photosynthesis:0,rootAbsorption:0,structuralStability:0,activeTransportSugar:0,activeTransportWater:0,walkSpeed:0,diffuseWater:0,diffuseSugar:0,buildTime:0,heatTolerant:0,coldTolerant:0,fruitGrowthSpeed:0,fruitMutationPoints:0,fruitNeededResources:0},n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){I(t,z(i.value))}}catch(s){r=!0,a=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}function z(e){var t={},n=Y(e[0]);null!=n&&(t[n]=1);var r=Y(e[1]);return null!=r&&(t[r]=-1),t}function Y(e){switch(e){case"AA":return"walkSpeed";case"AC":return"energyEfficiency";case"AG":return"photosynthesis";case"AT":return"rootAbsorption";case"CA":return"carryCapacity";case"CC":return"activeTransportSugar";case"CG":return"activeTransportWater";case"CT":return"structuralStability";case"GA":return"diffuseSugar";case"GC":return"diffuseWater";case"GG":return"buildTime";case"GT":return"heatTolerant";case"TA":return"coldTolerant";case"TC":return"fruitGrowthSpeed";case"TG":return"fruitMutationPoints";case"TT":return"fruitNeededResources"}}function G(e,t,n){return t*Math.pow(n,e)}n(81);var V=function(e){var t=e.className,n=e.children,i=e.shrunkElements,o=Object(r.useState)(!1),s=Object(p.a)(o,2),l=s[0],c=s[1];return a.a.createElement("div",{className:g()(t,"expand")},a.a.createElement("div",{className:"expand-button",onClick:function(){c(!l)}},i,a.a.createElement("div",{className:"expand-caret"},l?"\u25bc":"\u25b6")),l?a.a.createElement("div",null,n):null)};n(82);var H=function(e){var t=e.traits,n=B.filter(function(e){return 0!==t[e]});n.sort(function(e,n){return t[n]-t[e]});var r=n.length>0?a.a.createElement("div",{className:"interesting-traits"},n.map(function(e){return a.a.createElement("div",{className:g()("trait",{green:t[e]>0,red:t[e]<0}),key:e},W(e),": ",t[e])})):a.a.createElement("div",{className:"no-interesting-traits"},"All traits are zero."),i=B.filter(function(e){return 0===t[e]}),o=a.a.createElement("div",{className:"zero-traits"},i.map(function(e){return a.a.createElement("div",{className:"trait",key:e},W(e),": ",t[e])}));return a.a.createElement("div",{className:"trait-display"},r,a.a.createElement(V,{shrunkElements:a.a.createElement("div",{className:"expand-toggle"},"Show All")},o))};n(83);function U(e){var t=e.gene,n=e.onClick;return a.a.createElement("div",{className:"gene"},a.a.createElement("div",{className:"gene-number"},a.a.createElement("span",{className:"tuple-plus",title:Y(t[0])+" +1"},a.a.createElement("span",{className:"dna",onClick:function(){return n(0)}},t[0][0]),a.a.createElement("span",{className:"dna",onClick:function(){return n(1)}},t[0][1])),a.a.createElement("span",{className:"tuple-minus",title:Y(t[1])+" -1"},a.a.createElement("span",{className:"dna",onClick:function(){return n(2)}},t[1][0]),a.a.createElement("span",{className:"dna",onClick:function(){return n(3)}},t[1][1]))),a.a.createElement("div",{className:"gene-visual"},a.a.createElement("img",{alt:"",src:"https://media2.giphy.com/media/YlmI36YAWe7KScC7hK/giphy.gif",width:"44px"})))}var Z=function(e){var t=e.genes,n=e.onClick,r=t.length>0?a.a.createElement("div",{className:"genes-container"},t.map(function(e,t){return a.a.createElement(U,{key:t,gene:e,onClick:function(t){return n(e,t)}})})):a.a.createElement("div",{className:"genes-empty"},"No genes.");return a.a.createElement("div",{className:"gene-display"},r)};n(84);var K=function(e){var t=e.genes,n=e.onClick,r=a.a.useMemo(function(){return L(t)},[t]);return a.a.createElement("div",{className:"genes-to-traits"},a.a.createElement("div",{className:"genes-details"},a.a.createElement("h3",null,"Genes"),a.a.createElement(Z,{genes:t,onClick:n})),a.a.createElement("div",{className:"arrow"},"\u21d2"),a.a.createElement("div",{className:"traits-details"},a.a.createElement("h3",null,"Traits"),a.a.createElement(H,{traits:r})))};function q(e,t){var n=e.join("");return J(n.substr(0,t)+function(e){var t;do{t=Q()}while(t===e);return t}(n.charAt(t))+n.substr(t+1))}function J(e){return[e.substr(0,2),e.substr(2)]}function X(){return Q()+Q()}function Q(){var e=Math.random();return e<.25?"A":e<.5?"C":e<.75?"G":"T"}n(85);var _=function(e){var t=e.species,n=e.onCommit,r=t.freeMutationPoints,i=function(e){t.freeMutationPoints="number"===typeof e?e:e(r)},o=a.a.useState({id:A()(),descendants:[],freeMutationPoints:0,totalMutationPoints:0,genes:Object(O.a)(t.genes),name:"New species",parent:t}),s=Object(p.a)(o,2),l=s[0],c=s[1],u=a.a.useState(),h=Object(p.a)(u,2),d=h[0],f=h[1],m=d&&"swap"===d.type,v=d&&"reroll"===d.type,y=l.genes.length+1;function w(e,t,n,r){i(function(e){return e-2}),c(function(a){var i=a.genes.indexOf(e),o=a.genes.indexOf(n),s=Object(O.a)(a.genes),l=function(e,t,n,r){var a=e.join(""),i=n.join(""),o=a.charAt(t),s=i.charAt(r),l=a.substr(0,t)+s+a.substr(t+1),c=i.substr(0,r)+o+i.substr(r+1);return[J(l),J(c)]}(e,t,n,r),c=Object(p.a)(l,2),u=c[0],h=c[1];return s[i]=u,s[o]=h,Object(x.a)({},a,{genes:s})}),f(void 0)}var b=a.a.useMemo(function(){var e=t.genes,n=l.genes;return e.length!==n.length||e.some(function(t,r){return e[r]!==n[r]})},[l.genes,t.genes]);return a.a.createElement("div",{className:g()("mutation-screen",{"click-mode-active":null!=d})},a.a.createElement("div",{className:"mutation-screen-content"},a.a.createElement("h1",null,a.a.createElement(R,{size:"medium"}),a.a.createElement("span",{className:"name"},t.name)),a.a.createElement("div",{className:"buttons"},a.a.createElement(F,{className:"pool",amount:r,total:t.totalMutationPoints}),a.a.createElement(M,{onClick:function(){i(function(e){return e-y}),c(function(e){return Object(x.a)({},e,{genes:[].concat(Object(O.a)(e.genes),[[X(),X()]])})})},disabled:r<y},"New Gene (",a.a.createElement(F,{amount:y}),")"),a.a.createElement(M,{className:g()({"is-cancel":m}),onClick:function(){f(m?void 0:{type:"swap"})},disabled:!m&&r<2||0===l.genes.length},m?"Cancel":a.a.createElement(a.a.Fragment,null,"Swap DNA (",a.a.createElement(F,{amount:2}),")")),a.a.createElement(M,{className:g()({"is-cancel":v}),onClick:function(){f(v?void 0:{type:"reroll"})},disabled:!v&&r<1||0===l.genes.length},v?"Cancel":a.a.createElement(a.a.Fragment,null,"Re-roll DNA (",a.a.createElement(F,{amount:1}),")"))),a.a.createElement(K,{genes:l.genes,onClick:function(e,t){d&&("reroll"===d.type?function(e,t){i(function(e){return e-1}),c(function(n){var r=n.genes.indexOf(e),a=q(e,t),i=[].concat(Object(O.a)(n.genes.slice(0,r)),[a],Object(O.a)(n.genes.slice(r+1)));return Object(x.a)({},n,{genes:i})}),f(void 0)}(e,t):"swap"===d.type&&(null==d.p1?d.p1={gene:e,position:t}:w(d.p1.gene,d.p1.position,e,t)))}}),b?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"arrow"},"\u21d3"),a.a.createElement("h1",null,a.a.createElement(R,{size:"medium"}),a.a.createElement("input",{type:"text",className:"name",value:l.name,onChange:function(e){c(function(t){return Object(x.a)({},t,{name:e.target.value})})}})),a.a.createElement(M,{className:"commit",color:"green",onClick:function(){n(l,r)}},"Commit")):null))},$=(n(86),n(51));n(87);var ee=function(e){var t=v(),n=Object($.a)(),r=Object(p.a)(n,2),i=r[0],o=r[1],s=e.children,l=e.className,c=e.zScale,u=void 0===c?5:c,h=Object(C.a)(e,["children","className","zScale"]),d=window.innerWidth*u,f=a.a.useMemo(function(){if(null!=o){var e=o.left+o.width/2,n=o.top+o.height/2,r=t.x-e,a=t.y-n,i=Math.atan(2*r/d),s=Math.atan(-2*a/d);return{transform:"perspective(525px) rotateX(".concat(s,"rad) rotateY(").concat(i,"rad)")}}return{}},[t.x,t.y,o,d]);return a.a.createElement("div",Object.assign({ref:i,className:g()("look-at-mouse",l)},h),a.a.createElement("div",{className:"look-at-mouse-transform",style:f},s))},te=n(52),ne=n.n(te);n(105),n(106);var re=function(e){var t=e.species,n=e.onClick,r=e.onMutate;return a.a.createElement("div",{className:"species-details"},a.a.createElement(K,{genes:t.genes,onClick:n}),t.freeMutationPoints>0?a.a.createElement("div",{className:"suggestion"},t.freeMutationPoints," Mutation Points available. Use them!"):null,a.a.createElement(M,{onClick:function(){return r(t)}},"Mutate"))};var ae=function e(t){var n=t.species,r=t.onMutate,i=function(e){c(!1),r(e)},o=a.a.useState(!1),s=Object(p.a)(o,2),l=s[0],c=s[1],u=n.descendants.length>0?a.a.createElement("div",{className:"descendants-container"},n.descendants.map(function(t,n){return a.a.createElement(e,{key:n,species:t,onMutate:i})})):null,h=a.a.createElement("div",{className:"species-detail-popover"},a.a.createElement(re,{species:n,onMutate:i,onClick:function(){}}));return a.a.createElement("div",{className:"species-node"},u,a.a.createElement(ne.a,{isOpen:l,preferPlace:"right",onOuterAction:function(){return c(!1)},body:h},a.a.createElement(ee,{zScale:5},a.a.createElement("div",{className:"species-info",onClick:function(){return c(!l)}},a.a.createElement("div",{className:"species-info-name"},n.name),a.a.createElement("div",{className:"species-info-animation"},a.a.createElement(R,{size:"small"})),a.a.createElement(F,{amount:n.freeMutationPoints,total:n.totalMutationPoints})))))};var ie=function(e){var t=e.rootSpecies,n=e.onMutate;return a.a.createElement("div",{className:"phylogenetic-tree"},a.a.createElement("div",{className:"title"},"Phylogenetic Tree"),a.a.createElement("div",{className:"tree-nodes"},a.a.createElement(ae,{species:t,onMutate:n})))},oe=n(53),se=n.n(oe),le=n(15),ce=n(2);var ue=Math.sqrt(3)/2;function he(e,t,n){var r=t.scale,a=t.dX,i=t.dY,o=e.width/2+a,s=e.height/2+i,l=n.nativeEvent,c=(l.offsetX-o)/r/1.5,u=((l.offsetY-s)/r-ue*c)/(2*ue);return function(e,t,n){var r=Math.round(e),a=Math.round(t),i=Math.round(n),o=Math.abs(r-e),s=Math.abs(a-t),l=Math.abs(i-n);o>s&&o>l?r=-a-i:s>l?a=-r-i:i=-r-a;return{i:r,j:a,k:i}}(c,u,-(c+u))}function de(e,t){var n=t.dX,r=t.dY,a=t.scale,i=e.cartesian,o=i.x,s=i.y;return[window.innerWidth/2+n+o*a,window.innerHeight/2+r+s*a]}function fe(e,t){var n=e.cartesian,r=n.x,a=n.y,i=window.innerWidth/2-r*t,o=window.innerHeight/2-a*t;return[i-window.innerWidth/2,o-window.innerHeight/2]}!function(){var e=[new ce.Vector2(-1,0),new ce.Vector2(.5,ue),new ce.Vector2(.5,-ue)]}();var me=function(e){var t=2*ue;return function(e){var t=e.width,n=void 0===t?1:t,r=e.height,a=void 0===r?1:r,i=e.radius,o=void 0===i?.1:i,s=e.max,l=void 0===s?1e3:s,c=e.rng,u=void 0===c?Math.random:c,h=o*o,d=3*h,f=o*Math.SQRT1_2,m=Math.ceil(n/f),v=Math.ceil(a/f),p=new Array(m*v),y=[],g=0,w=0;function b(e,t){var n=e/f|0,r=t/f|0,a=Math.max(n-2,0),i=Math.max(r-2,0),o=Math.min(n+3,m),s=Math.min(r+3,v);for(r=i;r<s;++r){var l=r*m;for(n=a;n<o;++n){var c;if(c=p[l+n]){var u=c[0]-e,d=c[1]-t;if(u*u+d*d<h)return!1}}}return!0}function k(e,t){var n=[e,t];return y.push(n),p[m*(t/f|0)+(e/f|0)]=n,w++,g++,n}u=u||Math.random;for(var E=function(){if(!w)return k(u()*n,u()*a);for(;g;){for(var e=u()*g|0,t=y[e],r=0;r<30;++r){var i=2*Math.PI*u(),o=Math.sqrt(u()*d+h),s=t[0]+o*Math.cos(i),l=t[1]+o*Math.sin(i);if(s>=0&&s<n&&l>=0&&l<a&&b(s,l))return k(s,l)}y[e]=y[--g],y.length=g}},x=[],O=0;O<l;O++){var j=E();if(null==j)break;x.push(new ce.Vector2(j[0],j[1]))}return x}({width:2,height:t,radius:e,max:1e4}).map(function(e){return e.x-=1,e.y-=t/2,e}).filter(function(e){return ve(e.x,e.y)})},ve=function(){var e=1*ue;return function(t,n){var r=Math.abs(t),a=Math.abs(n);return!(r>1||a>e)&&1*e-e*r-.5*a>=0}}();function pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"newBaseSpecies";return{id:A()(),name:e,genes:[],freeMutationPoints:0,totalMutationPoints:0,descendants:[]}}function ye(e){var t=[];t.push(e);var n=!0,r=!1,a=void 0;try{for(var i,o=e.descendants[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;t.push.apply(t,Object(O.a)(ye(s)))}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}var ge=n(54),we=n.n(ge);n(115);var be=function(e){var t=e.tile,n=e.onClickPlay,r=e.rootSpecies,i=a.a.useMemo(function(){return ye(r)},[r]),o=a.a.useState(i[0].id),s=Object(p.a)(o,2),l=s[0],c=s[1],u=t.info,h=u.height,d=u.flora,f=i.map(function(e){return{value:e.id,label:e.name}}),m=-1===h||null!=d?null:a.a.createElement("div",{className:"play-selector"},a.a.createElement(we.a,{options:f,value:l,onChange:function(e){c(e.value)}}),a.a.createElement(M,{color:"green",className:"play-button",onClick:function(){n(t,i.find(function(e){return e.id===l}))}},"Populate")),v=null!=d?a.a.createElement("h1",null,"Inhabited by ",d.species.name,a.a.createElement("small",null,a.a.createElement(F,{amount:d.mutationPointsPerEpoch})," per epoch")):-1===t.info.height?a.a.createElement("h1",null,"Deep Water"):a.a.createElement("h1",null,"Uninhabited"),y=-1===t.info.height?null:a.a.createElement(V,{shrunkElements:a.a.createElement("div",{className:"details"},"Details")},a.a.createElement("pre",{style:{fontSize:"12px"}},JSON.stringify(t.info,null,4)));return a.a.createElement("div",{className:"hex-tile-info-container"},v,y,m)},ke=n(14),Ee=n.n(ke),xe=n(55),Oe=n(56),je=n.n(Oe);function Ae(e){return new Promise(function(t){setTimeout(t,e)})}var Me=n(145),Ce=new Image;Ce.src=je.a;var Se=Object(Me.a)().domain([-1,0,1,5,6]).range(["rgb(0, 60, 255)","lightblue","yellow","orange"]),Te=function(){function e(t){Object(c.a)(this,e),this.tile=t,this.vignettePositions=void 0}return Object(u.a)(e,[{key:"draw",value:function(e,t){var n=t.scale,r=de(this.tile,t),a=Object(p.a)(r,2),i=a[0],o=a[1];this.tile.info.visible?(e.fillStyle=Se(this.tile.info.height),e.fillStyle=Se(this.tile.info.height),Re(e,i,o,n),e.font="".concat(12*n/48,"px serif"),e.textAlign="center",e.textBaseline="middle",e.fillStyle="#666",e.fillText(this.tile.info.height+"",i,o,n),null!=this.tile.info.flora&&this.updateVignettes(e,this.tile.info.flora.species,i,o,n)):(e.strokeStyle="rgb(112, 112, 112)",Re(e,i,o,n,!1))}},{key:"updateVignettes",value:function(e,t,n,r,a){if(null==this.vignettePositions){var i=me(.2).sort(function(e,t){return e.y-t.y});this.vignettePositions=[];var o=this.vignettePositions;Object(xe.a)(Ee.a.mark(function e(){var t,n,r,a,s,l;return Ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,a=i[Symbol.iterator]();case 5:if(t=(s=a.next()).done){e.next=13;break}return l=s.value,o.push(l),e.next=10,Ae(300);case 10:t=!0,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),n=!0,r=e.t0;case 19:e.prev=19,e.prev=20,t||null==a.return||a.return();case 22:if(e.prev=22,!n){e.next=25;break}throw r;case 25:return e.finish(22);case 26:return e.finish(19);case 27:case"end":return e.stop()}},e,null,[[3,15,19,27],[20,,22,26]])}))()}var s=a/48/2,l=!0,c=!1,u=void 0;try{for(var h,d=this.vignettePositions[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f=h.value;e.drawImage(Ce,n+f.x*a-Ce.width/2*s,r+f.y*a-Ce.height*s,Ce.width*s,Ce.height*s)}}catch(m){c=!0,u=m}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}}}]),e}();function Re(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.beginPath(),e.moveTo(t+r,n);for(var i=1;i<6;i++){var o=i/6*Math.PI*2;e.lineTo(t+Math.cos(o)*r,n+Math.sin(o)*r)}e.closePath(),a&&e.fill(),e.stroke()}n(117),n(118);var Pe=function(e){var t=e.tile,n=e.camera,r=e.children,i=de(t,n),o=Object(p.a)(i,2),s=o[0],l=o[1],c={left:s+.5*n.scale,top:l};return a.a.createElement("div",{className:"overworld-popover",style:c},a.a.createElement("div",{className:"overworld-popover-positioner"},r))},Ne=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).hexTileSprites=new Map,n.canvas=null,n.rafId=void 0,n.handleCanvasRef=function(e){n.canvas=e,null!=e&&(b.addAnimation(function(){return n.setState({frame:n.state.frame+1}),null==n.canvas}),n.handleResize())},n.handleCanvasClick=function(e){if(null!=n.canvas)if(null!=n.state.highlightedHex)n.setState({highlightedHex:void 0});else{var t=he(n.canvas,n.state.cameraState,e),r=n.props.overWorld.tileAt(t.i,t.j);null!=r&&r.info.visible&&n.setState({highlightedHex:r})}},n.onPlayLevel=function(e,t){n.props.onPlayLevel(e,t)},n.handleKeyDown=function(e){if(!e.repeat){var t=Object(x.a)({},n.state.pressedKeys,Object(le.a)({},e.code,!0));n.setState({pressedKeys:t})}},n.handleKeyUp=function(e){var t=Object(x.a)({},n.state.pressedKeys);delete t[e.code],n.setState({pressedKeys:t})},n.handleWheel=function(e){var t=-(e.deltaX+e.deltaY)/125/10,r=Math.pow(2,t),a=n.state.cameraState.scale*r;n.setState({cameraState:Object(x.a)({},n.state.cameraState,{scale:a})})},n.handleResize=function(){null!=n.canvas&&(n.canvas.width=window.innerWidth,n.canvas.height=window.innerHeight,n.drawMap())},n.updateCamera=function(){var e=new ce.Vector2;for(var t in n.state.pressedKeys)"KeyW"===t||"ArrowUp"===t?e.y+=20:"KeyS"===t||"ArrowDown"===t?e.y-=20:"KeyA"===t||"ArrowLeft"===t?e.x+=20:"KeyD"!==t&&"ArrowRight"!==t||(e.x-=20);if(e.setLength(20),0!==e.x||0!==e.y){var r=n.state.cameraState;n.setState({cameraState:Object(x.a)({},r,{dX:r.dX+e.x,dY:r.dY+e.y})})}};var r=fe(e.overWorld.getStartTile(),96),a=Object(p.a)(r,2),i=a[0],o=a[1];n.state={cameraState:{scale:96,dX:i,dY:o},pressedKeys:{},frame:0};var s=!0,l=!1,u=void 0;try{for(var f,m=e.overWorld[Symbol.iterator]();!(s=(f=m.next()).done);s=!0){var v=f.value,y=new Te(v);n.hexTileSprites.set(v,y)}}catch(g){l=!0,u=g}finally{try{s||null==m.return||m.return()}finally{if(l)throw u}}return n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"drawMap",value:function(){if(null!=this.canvas){var e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height);var t=!0,n=!1,r=void 0;try{for(var a,i=this.hexTileSprites.values()[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.draw(e,this.state.cameraState)}}catch(o){n=!0,r=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),document.addEventListener("wheel",this.handleWheel),window.addEventListener("resize",this.handleResize),this.rafId=b.addAnimation(this.updateCamera)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),document.removeEventListener("wheel",this.handleWheel),window.removeEventListener("resize",this.handleResize),b.removeAnimation(this.rafId)}},{key:"componentDidUpdate",value:function(e){e.focusedHex!==this.props.focusedHex&&null!=this.props.focusedHex&&this.focusHex(this.props.focusedHex),this.drawMap()}},{key:"focusHex",value:function(e){var t=this,n=0;b.addAnimation(function(r){0===n&&(n=r);var a=r-n,i=fe(e,t.state.cameraState.scale),o=Object(p.a)(i,2),s=o[0],l=o[1],c=.5*t.state.cameraState.dX+.5*s,u=.5*t.state.cameraState.dY+.5*l;return t.setState({cameraState:Object(x.a)({},t.state.cameraState,{dX:c,dY:u})}),a>1e3||Math.abs(s-c)<.01&&Math.abs(l-u)<.01})}},{key:"render",value:function(){return a.a.createElement("div",{className:"overworld-map-container"},a.a.createElement("canvas",{tabIndex:-1,ref:this.handleCanvasRef,onClick:this.handleCanvasClick}),this.maybeRenderHexPopover())}},{key:"maybeRenderHexPopover",value:function(){if(null!=this.state.highlightedHex)return a.a.createElement(Pe,{camera:this.state.cameraState,tile:this.state.highlightedHex},a.a.createElement(be,{rootSpecies:this.props.rootSpecies,tile:this.state.highlightedHex,onClickPlay:this.onPlayLevel}))}}]),t}(a.a.PureComponent),Fe=(n(119),new Intl.NumberFormat(void 0,{useGrouping:!0,maximumFractionDigits:0}));function De(e){var t=e.epoch,n=e.overWorld,i=e.onNextEpoch,o=e.onFocusHex,s=Object(r.useState)(!1),l=Object(p.a)(s,2),c=l[0],u=l[1],h=n.unusedHexes(),d=0===h.length;return a.a.createElement("div",{className:g()("epoch-display",{"ready-to-advance":d,transitioning:c})},a.a.createElement("span",{className:"number"},a.a.createElement(E,{formatter:Fe,value:1e6*t,speed:.08})," Years"),h.length>0?a.a.createElement("div",{onClick:function(){return o(h[0])}},h.length," hexes unused"):null,a.a.createElement("button",{className:"button-next-epoch",onClick:function(){u(!0),setTimeout(function(){return u(!1)},5e3),i()},disabled:c},a.a.createElement(P.c,{className:"icon"})))}var Be=function(e){var t=e.rootSpecies,n=e.epoch,i=e.overWorld,o=e.onPopulationAttempt,s=e.onNextEpoch,l=Object(r.useState)(!1),c=Object(p.a)(l,2),u=c[0],h=c[1],d=Object(r.useState)(void 0),f=Object(p.a)(d,2),m=f[0],v=f[1];Object(r.useEffect)(function(){function e(e){"Tab"===e.code&&(h(function(e){return!e}),e.preventDefault())}return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}},[]);var y=Object(r.useCallback)(function(e){v(e)},[]),w=Object(r.useCallback)(function(e,t){if(null==m)throw new Error("created new species with no actively mutating one!");m.descendants.push(e),m.freeMutationPoints=t,e.parent=m,v(void 0)},[m]);var b=Object(r.useState)(void 0),k=Object(p.a)(b,2),E=k[0],x=k[1],O=Object(r.useCallback)(function(e){x(e)},[]);return a.a.createElement("div",{className:"overworld-screen"},a.a.createElement(Ne,{focusedHex:E,overWorld:i,rootSpecies:t,onPlayLevel:o}),a.a.createElement("div",{className:g()("panel-left",{open:u})},u?a.a.createElement(ie,{onMutate:y,rootSpecies:t}):null,a.a.createElement("button",{className:"panel-left-handle",onClick:function(){return h(function(e){return!e})}},a.a.createElement(P.b,{className:"icon"}))),function(){var e=null!=m?a.a.createElement(_,{species:m,onCommit:w}):null;return a.a.createElement(se.a,{ariaHideApp:!1,isOpen:null!=m,onRequestClose:function(){return v(void 0)},className:"mutation-screen-portal"},e)}(),a.a.createElement(De,{epoch:n,onNextEpoch:s,onFocusHex:O,overWorld:i}))},We=n(32),Ie=n(39),Le=n.n(Ie),ze=function(){function e(t,n,r){Object(c.a)(this,e),this.x=t,this.y=n,this.z=r}return Object(u.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,n){return this.x*e+this.y*t+this.z*n}}]),e}(),Ye=[new ze(1,1,0),new ze(-1,1,0),new ze(1,-1,0),new ze(-1,-1,0),new ze(1,0,1),new ze(-1,0,1),new ze(1,0,-1),new ze(-1,0,-1),new ze(0,1,1),new ze(0,-1,1),new ze(0,1,-1),new ze(0,-1,-1)],Ge=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Ve=.5*(Math.sqrt(3)-1),He=(3-Math.sqrt(3))/6,Ue=1/6,Ze=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2147483647*Math.random();Object(c.a)(this,e),this.perm=new Array(512),this.gradP=new Array(512),this.octaveNum=6,this.octaveFalloff=.5,this.octaveMatrix2=[2*Math.cos(1),2*-Math.sin(1),2*Math.sin(1),2*Math.cos(1)],this.seed(t)}return Object(u.a)(e,[{key:"seed",value:function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?Ge[t]^255&e:Ge[t]^e>>8&255,this.perm[t]=this.perm[t+256]=n,this.gradP[t]=this.gradP[t+256]=Ye[n%12]}}}]),Object(u.a)(e,[{key:"simplex2",value:function(e,t){var n,r,a=(e+t)*Ve,i=Math.floor(e+a),o=Math.floor(t+a),s=(i+o)*He,l=e-i+s,c=t-o+s;l>c?(n=1,r=0):(n=0,r=1);var u=l-n+He,h=c-r+He,d=l-1+2*He,f=c-1+2*He;i&=255,o&=255;var m=this.gradP[i+this.perm[o]],v=this.gradP[i+n+this.perm[o+r]],p=this.gradP[i+1+this.perm[o+1]],y=.5-l*l-c*c,g=.5-u*u-h*h,w=.5-d*d-f*f;return 70*((y<0?0:(y*=y)*y*m.dot2(l,c))+(g<0?0:(g*=g)*g*v.dot2(u,h))+(w<0?0:(w*=w)*w*p.dot2(d,f)))}},{key:"octaveSimplex2",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.octaveNum,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveFalloff,a=0,i=e,o=t,s=1,l=0;l<n;l++){a+=this.simplex2(i,o)*s;var c=i*this.octaveMatrix2[0]+o*this.octaveMatrix2[1],u=i*this.octaveMatrix2[2]+o*this.octaveMatrix2[3];i=c,o=u,s*=r}return a}},{key:"simplex3",value:function(e,t,n){var r,a,i,o,s,l,c=(e+t+n)*(1/3),u=Math.floor(e+c),h=Math.floor(t+c),d=Math.floor(n+c),f=(u+h+d)*Ue,m=e-u+f,v=t-h+f,p=n-d+f;m>=v?v>=p?(r=1,a=0,i=0,o=1,s=1,l=0):m>=p?(r=1,a=0,i=0,o=1,s=0,l=1):(r=0,a=0,i=1,o=1,s=0,l=1):v<p?(r=0,a=0,i=1,o=0,s=1,l=1):m<p?(r=0,a=1,i=0,o=0,s=1,l=1):(r=0,a=1,i=0,o=1,s=1,l=0);var y=m-r+Ue,g=v-a+Ue,w=p-i+Ue,b=m-o+2*Ue,k=v-s+2*Ue,E=p-l+2*Ue,x=m-1+.5,O=v-1+.5,j=p-1+.5;u&=255,h&=255,d&=255;var A=this.gradP,M=this.perm,C=A[u+M[h+M[d]]],S=A[u+r+M[h+a+M[d+i]]],T=A[u+o+M[h+s+M[d+l]]],R=A[u+1+M[h+1+M[d+1]]],P=.6-m*m-v*v-p*p,N=.6-y*y-g*g-w*w,F=.6-b*b-k*k-E*E,D=.6-x*x-O*O-j*j;return 32*((P<0?0:(P*=P)*P*C.dot3(m,v,p))+(N<0?0:(N*=N)*N*S.dot3(y,g,w))+(F<0?0:(F*=F)*F*T.dot3(b,k,E))+(D<0?0:(D*=D)*D*R.dot3(x,O,j)))}},{key:"octaveSimplex3",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveNum,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.octaveFalloff,i=0,o=e,s=t,l=n,c=1,u=0;u<r;u++)i+=this.simplex3(o,s,l)*c,o*=2,s*=2,l*=2,c*=a;return i}},{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,n){return(1-n)*e+n*t}},{key:"perlin2",value:function(e,t){var n=Math.floor(e),r=Math.floor(t);e-=n,t-=r,n&=255,r&=255;var a=this.gradP,i=this.perm,o=a[n+i[r]].dot2(e,t),s=a[n+i[r+1]].dot2(e,t-1),l=a[n+1+i[r]].dot2(e-1,t),c=a[n+1+i[r+1]].dot2(e-1,t-1),u=this.fade(e);return this.lerp(this.lerp(o,l,u),this.lerp(s,c,u),this.fade(t))}},{key:"perlin3",value:function(e,t,n){var r=this.gradP,a=this.perm,i=Math.floor(e),o=Math.floor(t),s=Math.floor(n);e-=i,t-=o,n-=s;var l=r[(i&=255)+a[(o&=255)+a[s&=255]]].dot3(e,t,n),c=r[i+a[o+a[s+1]]].dot3(e,t,n-1),u=r[i+a[o+1+a[s]]].dot3(e,t-1,n),h=r[i+a[o+1+a[s+1]]].dot3(e,t-1,n-1),d=r[i+1+a[o+a[s]]].dot3(e-1,t,n),f=r[i+1+a[o+a[s+1]]].dot3(e-1,t,n-1),m=r[i+1+a[o+1+a[s]]].dot3(e-1,t-1,n),v=r[i+1+a[o+1+a[s+1]]].dot3(e-1,t-1,n-1),p=this.fade(e),y=this.fade(t),g=this.fade(n);return this.lerp(this.lerp(this.lerp(l,d,p),this.lerp(c,f,p),g),this.lerp(this.lerp(u,m,p),this.lerp(h,v,p),g),y)}}]),e}();function Ke(e,t,n){return e+(t-e)*n}function qe(e,t,n){e.x=e.x*(1-n)+t.x*n,e.y=e.y*(1-n)+t.y*n}function Je(e,t,n,r,a){return Ke(r,a,(e-t)/(n-t))}function Xe(e,t,n){return e<t?t:e>n?n:e}function Qe(e){var t=Math.floor(e),n=e-t;return t+(Math.random()<n?1:0)}var _e=n(26),$e=n(25),et=n(29);var tt,nt,rt,at,it,ot,st,lt=n(57),ct=n.n(lt),ut=n(58),ht=n.n(ut),dt=n(59),ft=n.n(dt),mt=n(60),vt=n.n(mt),pt=n(61),yt=n.n(pt),gt=n(62),wt=n.n(gt),bt=n(63),kt=n.n(bt);function Et(e){var t=e.substr(e.length-3),n=document.createElement("source");return n.src=e,n.type="audio/".concat(t),n}function xt(e){var t=document.createElement("audio");t.autoplay=!0,t.loop=!0;for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var i=0,o=r;i<o.length;i++){var s=o[i];t.appendChild(Et(s))}var l=e.createMediaElementSource(t),c=e.createGain();return l.connect(c),{audio:t,gain:c}}function Ot(e){return Math.round(1e12*e)/1e12}var jt=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(c.a)(this,e),this.capacity=t,this.carrier=n,this.water=r,this.sugar=a,this.events=void 0,this.validate()}return Object(u.a)(e,[{key:"isEmpty",value:function(){return 0===this.water&&0===this.sugar}},{key:"give",value:function(e,t,n){if(e===this)throw new Error("shouldn't give to self");if(0===t&&0===n)return{water:0,sugar:0};var r=Math.min(t,this.water),a=Math.min(n,this.sugar),i=Ot(r+a),o=e.space();return i>o&&(r=Math.floor(r/i*o),a=Math.floor(a/i*o)),this.change(-r,-a),e.change(r,a),this.events&&this.events.emit("give",e,r,a),e.events&&e.events.emit("get",this,r,a),{water:r,sugar:a}}},{key:"on",value:function(e,t){this.events=this.events||new et.EventEmitter,this.events.on(e,t)}},{key:"off",value:function(e,t){this.events=this.events||new et.EventEmitter,this.events.off(e,t)}},{key:"add",value:function(e,t){var n=Ot(e+t),r=this.space();n>r&&(e=e/n*r,t=t/n*r),this.change(e,t)}},{key:"change",value:function(e,t){var n=Ot(this.water+e),r=Ot(this.sugar+t);this.validate(n,r),this.water=n,this.sugar=r,this.water<0&&(this.water=0),this.sugar<0&&(this.sugar=0),this.water+this.sugar>this.capacity&&(this.water>this.sugar?this.water=this.capacity-this.sugar:this.sugar=this.capacity-this.water)}},{key:"space",value:function(){return Ot(this.capacity-this.water-this.sugar)}},{key:"isMaxed",value:function(){return this.space()<1}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.water,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sugar,n=this.capacity;e<0&&console.warn("water < 0: ".concat(e)),t<0&&console.warn("sugar < 0: ".concat(t)),e+t>n&&console.warn("bad inventory: ".concat(e," water + ").concat(t," > ").concat(n," max"))}}]),e}();function At(e){return null!=e&&e.inventory instanceof jt}var Mt,Ct=n(20),St=n(12),Tt={nw:new ce.Vector2(-1,-1),w:new ce.Vector2(-1,0),sw:new ce.Vector2(-1,1),n:new ce.Vector2(0,-1),s:new ce.Vector2(0,1),ne:new ce.Vector2(1,-1),e:new ce.Vector2(1,0),se:new ce.Vector2(1,1)},Rt=Object.keys(Tt).map(function(e){return Tt[e]}),Pt=n(70),Nt=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),t}(Object(Pt.a)(Error));function Ft(e){return"function"===typeof e.interact}!function(e){e.Scorching="Scorching",e.Hot="Hot",e.Mild="Mild",e.Cold="Cold",e.Freezing="Freezing"}(Mt||(Mt={}));var Dt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(c.a)(this,e),this.deleted=t,this.added=n};var Bt=["Spring","Summer","Fall","Winter"];function Wt(e){return"".concat(Bt[e.season],", Month ").concat(e.month)}var It=27e3,Lt=It/4,zt=Lt/3,Yt=zt/3,Gt=function(){function e(t,n){var r=this;Object(c.a)(this,e),this.environment=t,this.time=0,this.frame=0,this.width=50,this.height=100,this.player=void 0,this.gridEnvironment=void 0,this.gridCells=void 0,this.neighborCache=void 0,this.wipResult=void 0,this.species=void 0,this.traits=void 0,this.cachedEntities=void 0,this.stepStats=new Dt,this.temperatureScale={0:{day:60,night:40},1:{day:80,night:60},2:{day:65,night:31},3:{day:40,night:0}},this.wipResult={fruits:[],world:this},this.species=n,this.traits=L(this.species.genes),tn.diffusionWater=G(this.traits.diffuseWater,fn.cellDiffusionWater,2),tn.diffusionSugar=G(this.traits.diffuseSugar,fn.cellDiffusionSugar,2),tn.turnsToBuild=Math.floor(G(this.traits.buildTime,fn.cellGestationTurns,.5)),this.player=new hn(new ce.Vector2(this.width/2,this.height/2),this),this.gridEnvironment=new Array(this.width).fill(void 0).map(function(e,n){return new Array(r.height).fill(void 0).map(function(e,a){var i,o=new ce.Vector2(n,a),s=!0,l=!1,c=void 0;try{for(var u,h=t.fill[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=(0,u.value)(o,r);if(null!=d){i=d;break}}}catch(f){l=!0,c=f}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return null==i&&(i=new Jt(o,r)),i})});var a=this.player.pos.x,i=this.gridEnvironment[a].find(function(e){return!(e instanceof Jt)});i&&(this.player.posFloat.y=i.pos.y);this.gridCells=new Array(this.width).fill(void 0).map(function(e,t){return new Array(r.height).fill(void 0).map(function(e,n){var a=new ce.Vector2(t,n);return r.player.pos.distanceTo(a)<2.5?(r.gridEnvironment instanceof Qt&&(r.gridEnvironment[t][n]=new Xt(new ce.Vector2(t,n),0,r)),new rn(a,r)):null})}),this.neighborCache=new Array(this.width).fill(void 0).map(function(e,t){return new Array(r.height).fill(void 0).map(function(e,n){return r.computeTileNeighbors(t,n)})}),this.fillCachedEntities();for(var o=0;o<this.width;o++)for(var s=0;s<this.height;s++){var l=this.gridEnvironment[o][s];l&&l.step(0);var u=this.gridCells[o][s];u&&u.step(0)}}return Object(u.a)(e,[{key:"season",get:function(){return e=this.time,{season:Math.floor(e/Lt),percent:e%Lt/Lt,month:Math.floor(e%Lt/zt)+1};var e}}]),Object(u.a)(e,[{key:"tileAt",value:function(e,t){var n;if(e instanceof ce.Vector2?(n=e.x,t=e.y):(n=e,t=t),!this.isValidPosition(n,t))return null;var r=this.gridCells[n][t];return null!=r?r:this.gridEnvironment[n][t]}},{key:"cells",value:function(){var e=this.gridCells,t=this.width,n=this.height;return Object(le.a)({},Symbol.iterator,Ee.a.mark(function r(){var a,i,o;return Ee.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:a=0;case 1:if(!(a<t)){r.next=14;break}i=0;case 3:if(!(i<n)){r.next=11;break}if(null==(o=e[a][i])){r.next=8;break}return r.next=8,o;case 8:i++,r.next=3;break;case 11:a++,r.next=1;break;case 14:case"end":return r.stop()}},r)}))}},{key:"cellAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridCells[e][t]:null}},{key:"environmentTileAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridEnvironment[e][t]:null}},{key:"setTileAt",value:function(e,t){var n=e.x,r=e.y;if(!this.isValidPosition(n,r))throw new Error("invalid position ".concat(n,", ").concat(r," "));t instanceof sn&&this.wipResult.fruits.push(t);var a=this.tileAt(n,r);if(At(a)){var i=this.tileNeighbors(e),o=!0,s=!1,l=void 0;try{for(var c,u=i.values()[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var h=c.value;if(At(h)&&h instanceof a.constructor&&a.inventory.give(h.inventory,a.inventory.water,a.inventory.sugar),0===a.inventory.water&&0===a.inventory.sugar)break}}catch(m){s=!0,l=m}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}0===a.inventory.water&&0===a.inventory.sugar||(console.warn("lost",a.inventory,"resources to building"),a.inventory.add(-a.inventory.water,-a.inventory.sugar))}var d=this.gridCells[n][r];if(null!=d&&this.stepStats.deleted.push(d),t instanceof tn)this.gridCells[n][r]=t;else{this.gridCells[n][r]=null;var f=this.gridEnvironment[n][r];null!=f&&this.stepStats.deleted.push(f),this.gridEnvironment[n][r]=t}this.stepStats.added.push(t),this.handleTileUpdated(e)}},{key:"maybeRemoveCellAt",value:function(e){var t=this.cellAt(e.x,e.y);return t&&(this.gridCells[e.x][e.y]=null,this.stepStats.deleted.push(t)),this.handleTileUpdated(e),t}},{key:"isValidPosition",value:function(e,t){return!(e>=this.width||e<0||t>=this.height||t<0)}},{key:"tileNeighbors",value:function(e){return this.neighborCache[e.x][e.y]}},{key:"computeTileNeighbors",value:function(e,t){var n=this,r=new Map;return Ht[this.frame%Ht.length].forEach(function(a){var i=e+a.x,o=t+a.y,s=n.tileAt(i,o);null!=s&&r.set(a,s)}),r}},{key:"entities",value:function(){if(null==this.cachedEntities)throw new Error("accessed entities before filling");return this.cachedEntities}},{key:"handleTileUpdated",value:function(e){this.neighborCache[e.x][e.y]=this.computeTileNeighbors(e.x,e.y);var t=!0,n=!1,r=void 0;try{for(var a,i=Rt[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,s=e.x+o.x,l=e.y+o.y;this.isValidPosition(s,l)&&(this.neighborCache[s][l]=this.computeTileNeighbors(s,l))}}catch(c){n=!0,r=c}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}this.fillCachedEntities()}},{key:"fillCachedEntities",value:function(){var e=[],t=0,n=0;for(t=0;t<this.width;t++)for(n=(t+this.frame)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));for(t=0;t<this.width;t++)for(n=(t+this.frame+1)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));this.frame%4<2&&e.reverse(),e.push(this.player),this.cachedEntities=e}},{key:"step",value:function(e){var t=this.entities();return this.stepStats=new Dt,t.forEach(function(t){"function"===typeof t.step&&function(e,t){var n=e.dtSinceLastStepped+t;if(e.shouldStep(n))try{e.step(n)}catch(r){if(!(r instanceof Nt))throw r}finally{e.dtSinceLastStepped=0}else e.dtSinceLastStepped=n}(t,e)}),this.updateTemperatures(e),this.computeSunlight(e),this.stepWeather(e),this.frame++,this.time+=e,this.fillCachedEntities(),this.stepStats}},{key:"getLastStepStats",value:function(){return this.stepStats}},{key:"stepWeather",value:function(e){if((this.time+this.environment.climate.turnsBetweenRainfall-200)%this.environment.climate.turnsBetweenRainfall<this.environment.climate.rainDuration)for(;e>0;){var t=Math.min(e,1),n=ce.Math.randInt(0,this.width-1),r=this.tileAt(n,0);r instanceof Jt&&r.inventory.add(Qe(this.environment.climate.waterPerDroplet*t),0),e-=1}}},{key:"getCurrentTemperature",value:function(){var e=this.season.season,t=this.temperatureScale[e],n=t.day,r=t.night;return Je(this.sunAmount,0,1,r,n)}},{key:"computeSunlight",value:function(e){for(var t=this.sunAngle,n=Math.sin(t+Math.PI/2),r=this.sunAmount,a=0;a<=.6*this.height;a++)for(var i=0;i<this.width;i++){var o=this.environmentTileAt(i,a);if(o instanceof Jt){var s=0;if(0===a)s=1;else{var l=this.tileAt(i,a-1),c=this.tileAt(i+1,a-1),u=this.tileAt(i-1,a-1),h=l instanceof Jt?l.sunlightCached/r:null==l?1:0,d=c instanceof Jt?c.sunlightCached/r:null==c?1:0,f=u instanceof Jt?u.sunlightCached/r:null==u?1:0;s=(s=n>0?d*n+h*(1-n):f*-n+h*(1- -n))*(1-fn.sunlightDiffusion)+(h+d+f)/3*fn.sunlightDiffusion}s=fn.sunlightReintroduction+s*(1-fn.sunlightReintroduction),s*=r,o.sunlightCached=s}}}},{key:"updateTemperatures",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.cells()[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;o.temperatureFloat=o.nextTemperature}}catch(s){n=!0,r=s}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"maybeGetGameResult",value:function(){if(this.tileAt(this.player.pos.x,this.player.pos.y)instanceof _t)return Object(x.a)({},this.wipResult,{mutationPointsPerEpoch:0,status:"lost"});if(this.time<It)return null;var e=this.wipResult.fruits.filter(function(e){return e.isMature()});return 0===e.length?Object(x.a)({},this.wipResult,{mutationPointsPerEpoch:0,status:"lost"}):Object(x.a)({},this.wipResult,{mutationPointsPerEpoch:e.length*G(this.traits.fruitMutationPoints,1,1.5),status:"won"})}},{key:"checkResources",value:function(){this.entities().forEach(function(e){At(e)&&(e.inventory.sugar,e.inventory.water),Ut(e)&&e.energy})}},{key:"environmentTiles",value:function(){var e=this;return Object(le.a)({},Symbol.iterator,Ee.a.mark(function t(){var n,r,a,i,o,s,l,c,u,h,d,f;return Ee.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,r=!1,a=void 0,t.prev=3,i=e.gridEnvironment[Symbol.iterator]();case 5:if(n=(o=i.next()).done){t.next=36;break}s=o.value,l=!0,c=!1,u=void 0,t.prev=10,h=s[Symbol.iterator]();case 12:if(l=(d=h.next()).done){t.next=19;break}return f=d.value,t.next=16,f;case 16:l=!0,t.next=12;break;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(10),c=!0,u=t.t0;case 25:t.prev=25,t.prev=26,l||null==h.return||h.return();case 28:if(t.prev=28,!c){t.next=31;break}throw u;case 31:return t.finish(28);case 32:return t.finish(25);case 33:n=!0,t.next=5;break;case 36:t.next=42;break;case 38:t.prev=38,t.t1=t.catch(3),r=!0,a=t.t1;case 42:t.prev=42,t.prev=43,n||null==i.return||i.return();case 45:if(t.prev=45,!r){t.next=48;break}throw a;case 48:return t.finish(45);case 49:return t.finish(42);case 50:case"end":return t.stop()}},t,null,[[3,38,42,50],[10,21,25,33],[26,,28,32],[43,,45,49]])}))}},{key:"sunAngle",get:function(){return this.time*Math.PI*2/Yt}},{key:"dayOrNight",get:function(){return this.sunAngle%(2*Math.PI)<Math.PI?"day":"night"}},{key:"sunAmount",get:function(){return Math.atan(12*Math.sin(this.sunAngle))/(Math.PI/2)*.5+.5}}]),e}();function Vt(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}var Ht=[Vt(Rt.slice()),Vt(Rt.slice()),Vt(Rt.slice()),Vt(Rt.slice()),Vt(Rt.slice())];function Ut(e){return"number"===typeof e.energy}var Zt=function(){function e(t,n){if(Object(c.a)(this,e),this.world=n,this.isObstacle=!1,this.darkness=1/0,this.temperatureFloat=void 0,this.dtSinceLastStepped=0,this.timeMade=void 0,this.pos=void 0,this.pos=t.clone(),null==n)throw new Error("null world!");this.timeMade=n.time,this.temperatureFloat=this.world.getCurrentTemperature()}return Object(u.a)(e,[{key:"temperature",get:function(){return(e=this.temperatureFloat)<=0?Mt.Freezing:e<=32?Mt.Cold:e<=64?Mt.Mild:e<=96?Mt.Hot:Mt.Scorching;var e}},{key:"diffusionWater",get:function(){return this.constructor.diffusionWater}},{key:"diffusionSugar",get:function(){return this.constructor.diffusionSugar}},{key:"fallAmount",get:function(){return this.constructor.fallAmount}},{key:"age",get:function(){return this.world.time-this.timeMade}}]),Object(u.a)(e,[{key:"lightAmount",value:function(){return Math.sqrt(Math.min(Math.max(Je(1-this.darkness,0,1,0,1),0),1))}},{key:"step",value:function(e){var t=this.world.tileNeighbors(this.pos);this.stepDarkness(t,e),this.stepDiffusion(t,e),this.stepTemperature(e),this.stepGravity(e)}},{key:"stepTemperature",value:function(e){this.temperatureFloat=this.world.getCurrentTemperature()}},{key:"stepDarkness",value:function(e,t){if(this instanceof tn)this.darkness=0;else{var n=this.darkness,r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value,c=Object(p.a)(l,2)[1],u=Math.max(.2,Je(this.pos.y,this.world.height/2,this.world.height,fn.soilDarknessBase,1)),h=c instanceof Qt?1/0:c.darkness+u;n=c instanceof tn?0:Math.min(n,h)}}catch(d){a=!0,i=d}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}this.darkness=n}}},{key:"stepDiffusion",value:function(e,t){if(At(this)){var n=!0,r=!1,a=void 0;try{for(var i,o=e.values()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;this.canDiffuse(s)&&(null!=this.diffusionWater&&s.inventory.water>this.inventory.water&&this.diffuseWater(s,t),null!=this.diffusionSugar&&s.inventory.sugar>this.inventory.sugar&&this.diffuseSugar(s,t))}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}}}},{key:"canDiffuse",value:function(e){return Kt(this,e)}},{key:"diffuseWater",value:function(e,t){if(At(this)){var n=(e.inventory.water-this.inventory.water)*this.diffusionWater*t;e.inventory.give(this.inventory,Qe(n),0)}}},{key:"diffuseSugar",value:function(e,t){if(At(this)){var n=(e.inventory.sugar-this.inventory.sugar)*this.diffusionSugar*t;e.inventory.give(this.inventory,0,Qe(n))}}},{key:"stepGravity",value:function(e){var t=this.fallAmount*e,n=this.world.tileAt(this.pos.x,this.pos.y+1);At(n)&&t>0&&Kt(n,this)&&this.inventory.give(n.inventory,Qe(t),0)}}]),e}();function Kt(e,t){return At(e)&&At(t)&&(e instanceof t.constructor||t instanceof e.constructor||e instanceof tn&&t instanceof tn||function(e,t,n,r){return e instanceof t&&n instanceof r}(e,Xt,t,Jt))}Zt.displayName="Tile",Zt.fallAmount=0;var qt=new Ze,Jt=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).pos=e,r.sunlightCached=1,r._co2=void 0,r.inventory=new jt(20,Object(St.a)(r)),r.darkness=0,r._co2=r.computeCo2(),r}return Object(f.a)(t,e),Object(u.a)(t,[{key:"shouldStep",value:function(e){return e>3}},{key:"computeCo2",value:function(){var e=Je(this.pos.y,this.world.height/2,0,this.world.environment.floorCo2,1.15),t=Je(this.pos.y,this.world.height/2,0,4,9),n=null==this.world?0:this.world.time,r=.25*qt.perlin3(94.231+(this.pos.x-this.world.width/2)/t,2312+this.pos.y/8,n/1e3+93.1);return Math.max(Math.min(e+r,1),Math.min(.4,.75*this.world.environment.floorCo2))}},{key:"lightAmount",value:function(){return this.sunlight()}},{key:"step",value:function(e){this.stepGravity(e),this.stepDiffusionCheap(e),this.stepEvaporation(e),this.stepTemperature(e),this._co2=this.computeCo2()}},{key:"stepDiffusionCheap",value:function(e){var t=this.world.tileAt(this.pos.x-1,this.pos.y),n=this.world.tileAt(this.pos.x+1,this.pos.y);Math.random()<.5?(this.tryDiffuse(t,e),this.tryDiffuse(n,e)):(this.tryDiffuse(n,e),this.tryDiffuse(t,e))}},{key:"tryDiffuse",value:function(e,t){null!=e&&this.canDiffuse(e)&&e.inventory.water>this.inventory.water&&this.diffuseWater(e,t)}},{key:"stepEvaporation",value:function(e){Math.random()<.01*this.inventory.water*e&&this.inventory.add(-1,0)}},{key:"co2",value:function(){return this._co2}},{key:"sunlight",value:function(){return this.sunlightCached}}]),t}(Zt);Jt.displayName="Air",Jt.fallAmount=1,Jt.diffusionWater=.1;var Xt=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e,a))).inventory=new jt(fn.soilMaxWater,Object(St.a)(n)),n.inventory.add(r,0),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"fallAmount",get:function(){return this.world.environment.waterGravityPerTurn}}]),Object(u.a)(t,[{key:"shouldStep",value:function(e){return e>10}},{key:"step",value:function(e){Object(Ct.a)(Object(d.a)(t.prototype),"step",this).call(this,e),this.stepEvaporation(e)}},{key:"stepEvaporation",value:function(e){var t=this.world.environment,n=t.evaporationRate,r=t.evaporationBottom,a=Je(this.pos.y,this.world.height/2,this.world.height*r,1,0),i=this.inventory.water;Math.random()<n*a*i*e&&this.inventory.add(-1,0)}}]),t}(Zt);Xt.displayName="Soil",Xt.diffusionWater=fn.soilDiffusionWater;var Qt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).isObstacle=!0,n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"shouldStep",value:function(){return!1}}]),t}(Zt);Qt.displayName="Rock";var _t=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"shouldStep",value:function(){return!1}}]),t}(Zt);_t.displayName="Dead Cell";var $t=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e,r,a))).turnsPerWater=i,n.isObstacle=!0,n.cooldown=0,n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"step",value:function(e){Object(Ct.a)(Object(d.a)(t.prototype),"step",this).call(this,e),this.cooldown>0&&(this.cooldown-=e),this.inventory.space()>1&&this.cooldown<=0&&(this.inventory.add(1,0),this.cooldown=this.turnsPerWater)}}]),t}(Xt);$t.displayName="Fountain";var en=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).turnsToDie=2e3,n.percentFrozen=.5,n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"interact",value:function(e){this.percentFrozen-=20/this.turnsToDie*e,this.onFrozenChanged()}},{key:"step",value:function(e){throw this.cell.temperature===Mt.Cold?this.percentFrozen+=1/this.turnsToDie*e:this.cell.temperature===Mt.Freezing?this.percentFrozen+=10/this.turnsToDie*e:this.percentFrozen-=10/this.turnsToDie*e,this.onFrozenChanged(),new Nt}},{key:"onFrozenChanged",value:function(){this.percentFrozen>1?this.cell.die():this.percentFrozen<0&&this.remove()}},{key:"turnsUntilDeath",get:function(){return this.turnsToDie-this.age}}]),t}(function(){function e(){Object(c.a)(this,e),this.timeMade=void 0,this.cell=void 0}return Object(u.a)(e,[{key:"attachTo",value:function(e){this.cell=e,this.timeMade=this.cell.world.time}},{key:"remove",value:function(){var e=this.cell.effects.indexOf(this);this.cell.effects.splice(e,1)}},{key:"age",get:function(){return this.cell.world.time-this.timeMade}}]),e}());en.displayName="Frozen",en.stacks=!1;var tn=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).energy=fn.cellEnergyMax,r.darkness=0,r.nextTemperature=void 0,r.droopY=0,r.args=[],r.effects=[],r.temperatureFloat=48,r.nextTemperature=r.temperatureFloat,r}return Object(f.a)(t,e),Object(u.a)(t,[{key:"tempo",get:function(){return this.temperatureFloat<=0?.5:this.temperatureFloat<=32?2/3:this.temperatureFloat<=64?1:this.temperatureFloat<=96?1.5:2}}]),Object(u.a)(t,[{key:"addEffect",value:function(e){(e.constructor.stacks||null==this.findEffectOfType(e.constructor))&&(e.attachTo(this),this.effects.push(e))}},{key:"findEffectOfType",value:function(e){return this.effects.find(function(t){return t.constructor===e})}},{key:"interact",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.effects[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;Ft(o)&&o.interact(e)}}catch(s){n=!0,r=s}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"die",value:function(){this.world.setTileAt(this.pos,new _t(this.pos,this.world))}},{key:"isHungry",value:function(){return this.energy<.95*fn.cellEnergyMax}},{key:"shouldStep",value:function(e){return e>3}},{key:"step",value:function(e){var n=this.tempo;Object(Ct.a)(Object(d.a)(t.prototype),"step",this).call(this,e),this.energy-=1*n*e;var r=!0,a=!1,i=void 0;try{for(var o,s=this.effects[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value.step(e)}}catch(v){a=!0,i=v}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}var l=this.world.tileNeighbors(this.pos),c=Array.from(l.values());if(this.isHungry()&&this.stepEatSugar(this),this.isHungry())for(var u=0,h=c;u<h.length;u++){var f=h[u];if(this.stepEatSugar(f),!this.isHungry())break}if(this.isHungry()){var m=c.filter(function(e){return Ut(e)});this.stepEqualizeEnergy(m,n,e)}this.stepDroop(l,e),this.droopY>.5&&this.pos.y<this.world.height-1&&(this.world.player.pos.equals(this.pos)&&(this.world.player.pos.y+=1),this.world.maybeRemoveCellAt(this.pos),this.pos.y+=1,this.droopY-=1,this.world.setTileAt(this.pos,this)),this.energy<=0&&this.die()}},{key:"stepEatSugar",value:function(e){if(At(e)&&!(e instanceof sn)){var t=fn.cellEnergyMax-this.energy,n=G(this.world.traits.energyEfficiency,1/fn.cellEnergyMax,1/1.5),r=Math.min(t*n,e.inventory.sugar);if(t>100&&r>0){e.inventory.add(0,-r);var a=r/n;return this.energy+=a,!0}}return!1}},{key:"stepEqualizeEnergy",value:function(e,t,n){var r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;if(!this.isHungry())break;var c=l.energy-this.energy;if(c>20){var u=.125*t*n,h=Math.floor(c*Xe(u,0,.5));this.energy+=h,l.energy-=h}}}catch(d){a=!0,i=d}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}},{key:"stepTemperature",value:function(e){var t=this.world.tileNeighbors(this.pos);if(this.nextTemperature=function(e,t,n){var r=e.temperatureFloat,a=r,i=!0,o=!1,s=void 0;try{for(var l,c=t.values()[Symbol.iterator]();!(i=(l=c.next()).done);i=!0)a+=l.value.temperatureFloat}catch(u){o=!0,s=u}finally{try{i||null==c.return||c.return()}finally{if(o)throw s}}return Ke(r,a/=t.size+1,.2*n)}(this,t,e),this.temperatureFloat<=32){var n=G(this.world.traits.coldTolerant,this.temperature===Mt.Cold?.001:.01,1/1.5)*e;Math.random()<n&&this.addEffect(new en)}else if(this.temperatureFloat>=64){var r=G(this.world.traits.heatTolerant,this.temperature===Mt.Hot?.001:.01,1/1.5)*e;Math.random()<r&&At(this)&&this.inventory.add(Math.max(-1,this.inventory.water),0)}}},{key:"stepDroop",value:function(e,n){var r=e.get(Tt.s),a=e.get(Tt.sw),i=e.get(Tt.se),o=e.get(Tt.w),s=e.get(Tt.e),l=e.get(Tt.n),c=e.get(Tt.nw),u=e.get(Tt.ne),h=G(this.world.traits.structuralStability,fn.droop,1/1.5)*n;this.droopY+=h,this.energy<fn.cellEnergyMax/2&&(this.droopY+=h);for(var d=!1,f=0,m=[r,a,i];f<m.length;f++){var v=m[f];if(v instanceof Qt||v instanceof Xt)return void(this.droopY=Math.min(this.droopY,0));if(v instanceof t)return this.droopY=Math.min(this.droopY,v.droopY),void(d=!0)}var p=[c,l,u,o,s,this].filter(function(e){return e instanceof t});d||1!==p.length?this.droopY=p.reduce(function(e,t){return e+t.droopY},0)/p.length:this.droopY+=1}}]),t}(Zt);tn.displayName="Cell",tn.diffusionWater=fn.cellDiffusionWater,tn.diffusionSugar=fn.cellDiffusionSugar,tn.turnsToBuild=fn.cellGestationTurns;var nn=function(e){function t(e,n,r){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).completedCell=r,a.isObstacle=!0,a.timeRemaining=void 0,a.timeToBuild=void 0,a.timeRemaining=a.timeToBuild=r.constructor.turnsToBuild||0,a}return Object(f.a)(t,e),Object(u.a)(t,[{key:"step",value:function(e){Object(Ct.a)(Object(d.a)(t.prototype),"step",this).call(this,e),this.timeRemaining-=1*this.tempo*e,this.timeRemaining<=0&&this.world.setTileAt(this.completedCell.pos,this.completedCell)}}]),t}(tn),rn=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).inventory=void 0,r.inventory=new jt(Math.floor(G(n.traits.carryCapacity,fn.tissueInventoryCapacity,1.5)),Object(St.a)(r)),r}return Object(f.a)(t,e),t}(tn);rn.displayName="Tissue";var an=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).isObstacle=!1,n.averageEfficiency=0,n.averageSpeed=0,n.sugarConverted=0,n.tilePairs=[],n.totalSugarProduced=0,n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"step",value:function(e){Object(Ct.a)(Object(d.a)(t.prototype),"step",this).call(this,e);var n=this.world.tileNeighbors(this.pos);this.averageEfficiency=0,this.averageSpeed=0,this.sugarConverted=0;var r=0;this.tilePairs=[];var a=!0,i=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=Object(p.a)(c,2),h=u[0],f=u[1],m=this.world.tileAt(this.pos.x-h.x,this.pos.y-h.y);if(f instanceof Jt&&m instanceof rn){r+=1,this.tilePairs.push(h);var v=f,y=m,g=v.sunlight(),w=v.co2();this.averageEfficiency+=w,this.averageSpeed+=g;var b=G(this.world.traits.photosynthesis,.01,1.5)*this.tempo,k=fn.leafSugarPerReaction/w,E=Math.min(y.inventory.water,k),x=g*b*E*e/k;if(Math.random()<x){var O=E*w;y.inventory.add(-E,O),this.sugarConverted+=O,this.totalSugarProduced+=O}}}}catch(j){i=!0,o=j}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}r>0&&(this.averageEfficiency/=r)}}]),t}(tn);an.displayName="Leaf";var on=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).isObstacle=!1,n.activeNeighbors=[],n.inventory=new jt(fn.tissueInventoryCapacity,Object(St.a)(n)),n.cooldown=0,n.totalSucked=0,n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"step",value:function(e){Object(Ct.a)(Object(d.a)(t.prototype),"step",this).call(this,e),this.cooldown<=0&&(this.stepWaterTransfer(e),this.cooldown+=G(this.world.traits.rootAbsorption,fn.rootTurnsPerTransfer,1/1.5)),this.cooldown-=1*this.tempo*e}},{key:"stepWaterTransfer",value:function(e){this.activeNeighbors=[];var t=this.world.tileNeighbors(this.pos),n=!1,r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value,c=Object(p.a)(l,2),u=c[0],h=c[1];if(h instanceof Xt&&(this.activeNeighbors.push(u),!n)){var d=h.inventory.give(this.inventory,1,0).water;this.totalSucked+=d,d>0&&(n=!0)}}}catch(f){a=!0,i=f}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}}]),t}(tn);on.displayName="Root";var sn=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).isObstacle=!0,r.inventory=new jt(8,Object(St.a)(r)),r.neededResources=void 0,r.committedResources=void 0,r.timeMatured=void 0,r.turnsToMature=void 0,r.handleGetResources=function(){null==r.timeMatured&&r.isMature()&&(r.timeMatured=r.world.time,r.committedResources.off("get",r.handleGetResources))},r.neededResources=2*Math.ceil(G(n.traits.fruitNeededResources,100,1/1.5)/2),r.committedResources=new jt(r.neededResources,Object(St.a)(r)),r.committedResources.on("get",r.handleGetResources),r.turnsToMature=Math.ceil(G(n.traits.fruitGrowthSpeed,Lt/3*2,1/1.5)),r}return Object(f.a)(t,e),Object(u.a)(t,[{key:"oneTurnCommitMax",get:function(){return this.neededResources/this.turnsToMature}}]),Object(u.a)(t,[{key:"step",value:function(e){Object(Ct.a)(Object(d.a)(t.prototype),"step",this).call(this,e);var n=1*e*this.tempo,r=this.world.tileNeighbors(this.pos),a=!0,i=!1,o=void 0;try{for(var s,l=r[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=Object(p.a)(c,2)[1];if(At(u)&&u instanceof tn&&!(u instanceof t)){var h=Math.min(this.neededResources/2-this.committedResources.water,n),f=Math.min(this.neededResources/2-this.committedResources.sugar,n);u.inventory.give(this.inventory,h,f)}}}catch(m){i=!0,o=m}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}this.commitResources(e)}},{key:"commitResources",value:function(e){var t=Math.min(this.neededResources/2-this.committedResources.water,this.oneTurnCommitMax/2*e*this.tempo),n=Math.min(this.neededResources/2-this.committedResources.sugar,this.oneTurnCommitMax/2*e*this.tempo);this.inventory.give(this.committedResources,t,n)}},{key:"getPercentMatured",value:function(){var e=this.committedResources;return(e.sugar+e.water)/e.capacity}},{key:"isMature",value:function(){return this.committedResources.water+this.committedResources.sugar>=this.neededResources-1}}]),t}(tn);function ln(e){return e%1!==0}sn.displayName="Fruit",sn.turnsToBuild=0;var cn=function(e){function t(e,n,r){var a;if(Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).dir=r,a.cooldownWater=0,a.cooldownSugar=0,ln(r.x)||ln(r.y))throw new Error("build transport with fractional dir "+r.x+", "+r.y);return a}return Object(f.a)(t,e),Object(u.a)(t,[{key:"step",value:function(e){Object(Ct.a)(Object(d.a)(t.prototype),"step",this).call(this,e),this.energy-=1*this.tempo*e;var n=0,r=0;if(this.cooldownWater<=0){n++;var a=Math.floor(G(this.world.traits.activeTransportWater,20,1/1.5));this.cooldownWater+=a}if(this.cooldownSugar<=0){r++;var i=Math.floor(G(this.world.traits.activeTransportSugar,20,1/1.5));this.cooldownSugar+=i}if(n>0||r>0){var o=this.getTarget();o&&this.inventory.give(o.inventory,n,r);var s=this.getFrom();s&&s.inventory.give(this.inventory,n,r)}this.cooldownWater-=1*e*this.tempo,this.cooldownSugar-=1*e*this.tempo}},{key:"getTarget",value:function(){var e=this.world.tileAt(this.pos.x+this.dir.x,this.pos.y+this.dir.y);if(e instanceof tn&&At(e))return e}},{key:"getFrom",value:function(){var e=this.world.tileAt(this.pos.x-this.dir.x,this.pos.y-this.dir.y);if(e instanceof tn&&At(e))return e}}]),t}(rn);cn.displayName="Transport";var un=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).inventory=new jt(8,Object(St.a)(n)),n}return Object(f.a)(t,e),Object(u.a)(t,null,[{key:"diffusionWater",get:function(){return fn.veinDiffusion}},{key:"diffusionSugar",get:function(){return fn.veinDiffusion}}]),t}(rn);un.displayName="Vein";var hn=function(){function e(t,n){Object(c.a)(this,e),this.posFloat=t,this.world=n,this.inventory=new jt(fn.maxResources,this,Math.round(fn.maxResources/3),Math.round(fn.maxResources/3)),this.action=void 0,this.events=new et.EventEmitter,this.mapActions=void 0,this.baseSpeed=void 0,this.dtSinceLastStepped=0,this.baseSpeed=G(n.traits.walkSpeed,.15,1.5)}return Object(u.a)(e,[{key:"speed",get:function(){var e=this.currentTile();return this.baseSpeed*(e instanceof tn?e.tempo:1)}},{key:"pos",get:function(){return this.posFloat.clone().round()}}]),Object(u.a)(e,[{key:"shouldStep",value:function(){return!0}},{key:"setAction",value:function(e){null!=this.action?this.action={type:"multiple",actions:[this.action,e]}:this.action=e}},{key:"getAction",value:function(){return this.action}},{key:"droopY",value:function(){var e=this.world.tileAt(this.pos.x,this.pos.y);return e instanceof tn?e.droopY:0}},{key:"droopPosFloat",value:function(){var e=this.droopY();if(0!==e){var t=this.posFloat.clone();return t.y+=e,t}return this.posFloat}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"step",value:function(e){if(void 0===this.action&&(this.action={type:"none"}),this.mapActions){var t=this.mapActions(this,this.action);this.action=null!=t?t:{type:"none"}}var n=this.attemptAction(this.action,e);this.maybeMoveWithTransports(e),n&&this.events.emit("action",this.action),this.action=void 0}},{key:"maybeMoveWithTransports",value:function(e){var t=this.currentTile();t instanceof cn&&this.posFloat.add(t.dir.clone().setLength(.15*this.speed*e))}},{key:"attemptAction",value:function(e,t){switch(e.type){case"none":return!0;case"still":return this.attemptStill(t);case"move":return this.attemptMove(e,t);case"build":return this.attemptBuild(e,t);case"deconstruct":return this.attemptDeconstruct(e,t);case"drop":return this.attemptDrop(e,t);case"pickup":return this.attemptPickup(e,t);case"multiple":return this.attemptMultiple(e,t);case"interact":return this.attemptInteract(e,t)}}},{key:"verifyMove",value:function(e,t){var n=this.posFloat.clone().add(e.dir.clone().setLength(this.speed*t)).round();return this.isWalkable(n)}},{key:"isWalkable",value:function(e){if(e instanceof Zt&&(e=e.pos),!this.world.isValidPosition(e.x,e.y))return!1;var t=this.world.tileAt(e.x,e.y);return t instanceof tn&&null!=t&&!t.isObstacle&&(!(t instanceof tn)||null==t.findEffectOfType(en))}},{key:"isBuildCandidate",value:function(e){return null!=e&&!e.isObstacle&&(!(e instanceof tn)||null==e.findEffectOfType(en))}},{key:"attemptMove",value:function(e,t){return!!this.verifyMove(e,t)&&(at.gain.gain.cancelScheduledValues(0),at.gain.gain.value=.5,at.gain.gain.linearRampToValueAtTime(0,at.gain.context.currentTime+.05),this.posFloat.add(e.dir.clone().setLength(this.speed*t)),!0)}},{key:"attemptStill",value:function(e){return!0}},{key:"tryConstructingNewCell",value:function(e,t,n){e=e.clone();var r=this.world.tileAt(e.x,e.y);if(null!=r&&!(r instanceof sn)){if(!(r instanceof t&&!(t===cn&&r instanceof cn))&&!r.isObstacle&&this.inventory.water>=1&&this.inventory.sugar>=1){this.inventory.add(-1,-1);var a=Object($e.a)(t,[e,this.world].concat(Object(O.a)(n)));return a.args=n,it.audio.currentTime=0,it.gain.gain.cancelScheduledValues(0),it.gain.gain.value=.2,it.gain.gain.exponentialRampToValueAtTime(1e-4,it.gain.context.currentTime+.5),a}}}},{key:"argsEq",value:function(e,t){var n=this;return typeof e===typeof t&&(null==e&&null==t||(e instanceof ce.Vector2&&t instanceof ce.Vector2?e.equals(t):e instanceof Array&&t instanceof Array?e.every(function(r,a){return n.argsEq(e[a],t[a])}):void 0))}},{key:"isMeaningfulBuild",value:function(e,t){return t.constructor!==e.cellType||!this.argsEq(e.args,t.args)}},{key:"attemptBuild",value:function(e,t){var n=this.world.cellAt(e.position.x,e.position.y);if(null!=n&&!this.isMeaningfulBuild(e,n))return!0;n&&this.attemptDeconstruct({type:"deconstruct",position:e.position,force:!0},t);var r,a=this.tryConstructingNewCell(e.position,e.cellType,e.args);return null!=a&&((r=e.cellType.turnsToBuild?new nn(e.position,this.world,a):a).droopY=this.droopY(),this.world.setTileAt(e.position,r),!0)}},{key:"attemptDeconstruct",value:function(e,t){if(!e.position.equals(this.pos)||e.force){var n=this.world.maybeRemoveCellAt(e.position);if(null!=n){var r=n.energy/fn.cellEnergyMax;return this.inventory.add(r,r),At(n)&&n.inventory.give(this.inventory,n.inventory.water,n.inventory.sugar),!0}}return!1}},{key:"attemptDrop",value:function(e,t){var n=this.currentTile();if(At(n)){var r=e.water*t,a=e.sugar*t;return n.inventory.give(this.inventory,a,r),this.inventory.give(n.inventory,r,a),!0}return!1}},{key:"attemptPickup",value:function(e,t){var n=this.currentTile();At(n)&&n.inventory.give(this.inventory,e.water*t,e.sugar*t);return!0}},{key:"attemptMultiple",value:function(e,t){var n=!0,r=!0,a=!1,i=void 0;try{for(var o,s=e.actions[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;n=this.attemptAction(l,t)&&n}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}},{key:"attemptInteract",value:function(e,t){return e.interactable.interact(t),!0}}]),e}(),dn={isRealtime:!0,environment:"Temperate",cellEnergyMax:Lt,tissueInventoryCapacity:6,rootTurnsPerTransfer:40,leafReactionRate:.01,leafSugarPerReaction:1,cellGestationTurns:20,cellDiffusionWater:.002,cellDiffusionSugar:.002,soilDarknessBase:.2,soilDiffusionWater:.001,veinDiffusion:.5,soilMaxWater:20,droop:.03,fountainTurnsPerWater:11,fountainAppearanceRate:1.5,transportTurnsPerMove:5,sunlightReintroduction:.15,sunlightDiffusion:0,maxResources:100},fn=Object(x.a)({},dn),mn=Object(_e.parse)(window.location.search);if(null!=mn.params){var vn=JSON.parse(mn.params);Object.assign(fn,vn)}function pn(){for(var e={},t=0,n=Object.keys(dn);t<n.length;t++){var r=n[t],a=fn[r];a!==dn[r]&&(e[r]=a)}if(Object.keys(e).length>0){var i=Object(_e.stringify)(Object(x.a)({},Object(_e.parse)(window.location.search),{params:JSON.stringify(e)}));window.location.search=i}}pn();var yn=function(){var e=new Ze,t=new Ze,n=new Ze;return{climate:{turnsBetweenRainfall:800,rainDuration:50,waterPerDroplet:2},evaporationRate:2e-4,evaporationBottom:.6,floorCo2:.3333,waterGravityPerTurn:.005,fill:[function(r,a){var i=r.x,o=r.y,s=a.height/2-4*(n.perlin2(0,i/5)+1)/2-16*n.perlin2(10,i/20+10),l=Je(o-a.height/2,0,a.height/2,-.7,.3),c=t.simplex2(i/5,o/5)<l;if(o>s){if(c)return new Qt(r,a);var u=Math.pow(Je(o-a.height/2,0,a.height/2,.5,1),2),h=e.simplex2(.2*i,.2*o)+.2,d=Math.round(Math.max(1,Math.min(20,h>.4?20*u:0)));if(u*h>1/fn.fountainAppearanceRate){var f=Math.min(u*h,1);return new $t(r,d,a,Math.round(fn.fountainTurnsPerWater/f))}return new Xt(r,d,a)}}]}},gn=function(){var e=new Ze,t=new Ze;return{climate:{rainDuration:220,turnsBetweenRainfall:3300,waterPerDroplet:8},evaporationRate:.002,evaporationBottom:.7,waterGravityPerTurn:.02,floorCo2:.95,fill:[function(n,r){var a=n.x,i=n.y,o=r.height/2-2*(e.perlin2(0,a/20)+1)/2-3*e.perlin2(10,a/100+10),s=Je(i,r.height/2,r.height,-.8,-.4),l=t.simplex2(a/4,i/4)<s;if(i>o){if(l)return new Qt(n,r);var c=Math.floor(Math.max(0,Je(i,.75*r.height,r.height,1,9)));return new Xt(n,c,r)}}]}},wn=function(){var e=new Ze,t=new Ze;return{climate:{turnsBetweenRainfall:2500,rainDuration:120,waterPerDroplet:3},waterGravityPerTurn:.1,evaporationBottom:.6,evaporationRate:.001,floorCo2:1,fill:[function(n,r){var a=n.x,i=n.y,o=.55*r.height-4*(t.perlin2(0,a/5)+1)/2-16*t.perlin2(10,a/20+10)-Je(a,0,r.width,10,-10),s=i-6*(t.perlin2(0,a/25)+1)/2-20*t.perlin2(10,a/150+10)<.5*r.height?-1:-.15;return e.simplex2(a/10,i/10)<s?new Qt(n,r):i>o?new Xt(n,3,r):void 0}]}},bn={Temperate:yn,Desert:gn,Rocky:wn},kn=Symbol.iterator,En=function(){function e(){Object(c.a)(this,e),this.tiles={}}return Object(u.a)(e,[{key:"hash",value:function(e,t){return"".concat(e,",").concat(t)}},{key:"get",value:function(e,t){return this.tiles[this.hash(e,t)]}},{key:"set",value:function(e,t,n){this.tiles[this.hash(e,t)]=n}},{key:"hookUpNeighbors",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value,o=i.i,s=i.j;i.neighbors[0]=this.get(o+1,s),i.neighbors[1]=this.get(o,s+1),i.neighbors[2]=this.get(o-1,s+1),i.neighbors[3]=this.get(o-1,s),i.neighbors[4]=this.get(o,s-1),i.neighbors[5]=this.get(o+1,s-1)}}catch(l){t=!0,n=l}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:kn,value:Ee.a.mark(function e(){var t;return Ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=Ee.a.keys(this.tiles);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.tiles[t];case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)})}]),e}(),xn=Math.sqrt(3)/2,On=function(){function e(t,n){Object(c.a)(this,e),this.i=t,this.j=n,this.neighbors=new Array(6),this.info={height:0,rainfall:"medium",soilType:"average",temperature:"temperate",wind:"low",visible:!1}}return Object(u.a)(e,[{key:"k",get:function(){return-(this.i+this.j)}},{key:"magnitude",get:function(){return Math.abs(this.i)+Math.abs(this.j)+Math.abs(this.k)}},{key:"cartesian",get:function(){var e=this.i,t=this.j;return{x:1.5*e,y:2*xn*t+xn*e}}}]),e}(),jn=Symbol.iterator,An=function(){function e(t){Object(c.a)(this,e),this.storage=t,this.startTile=void 0,t.hookUpNeighbors();var n=Array.from(t);this.startTile=n.filter(function(e){return 0===e.info.height}).sort(function(e,t){return e.magnitude-t.magnitude})[0],this.startTile.info.visible=!0}return Object(u.a)(e,null,[{key:"randomHeight",value:function(e,t){var n=e.cartesian,r=n.x,a=n.y,i=0;return i+=6*(t.noise3D(r/24,a/24,0)-.2),i+=6*t.noise3D(r/24,a/24,1.453),i+=1.5*t.noise3D(r/6,a/6,1.453),i+=1,(i-=.025*Math.abs(a*a))<0&&i>=-1&&(i=0),i=Math.round(Math.max(Math.min(i,6),-1))}},{key:"populateLevelInfo",value:function(t,n){var r=t.info;r.height=e.randomHeight(t,n),r.environment=r.height<2?yn():r.height<4?wn():gn()}},{key:"generateFilledHex",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=new En,r=new Le.a,a=-t;a<=t;a++)for(var i=-t;i<=t;i++){var o=-(a+i);if(!(Math.abs(o)>t)){var s=new On(a,i);e.populateLevelInfo(s,r),n.set(a,i,s)}}return new e(n)}},{key:"generateRectangle",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,r=new En,a=new Le.a,i=Math.max(t/2,n/2),o=-i;o<=i;o++)for(var s=-i;s<=i;s++){var l=-(o+s);if(!(Math.abs(l)>i)){var c=new On(o,s),u=c.cartesian,h=u.x,d=u.y;h<-t/2||h>t/2||d<-n/2||d>n/2||(e.populateLevelInfo(c,a),r.set(o,s,c))}}return new e(r)}}]),Object(u.a)(e,[{key:"getStartTile",value:function(){return this.startTile}},{key:"tileAt",value:function(e,t){return this.storage.get(e,t)}},{key:jn,value:Ee.a.mark(function e(){var t,n,r,a,i,o;return Ee.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,a=this.storage[Symbol.iterator]();case 5:if(t=(i=a.next()).done){e.next=12;break}return o=i.value,e.next=9,o;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,r=e.t0;case 18:e.prev=18,e.prev=19,t||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw r;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})},{key:"resetActionPoints",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.storage[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;i.info.flora&&(i.info.flora.actionPoints=1)}}catch(o){t=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"unusedHexes",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var a,i=this.storage[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;o.info.flora&&o.info.flora.actionPoints>0&&e.push(o)}}catch(s){n=!0,r=s}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}},{key:"getMaxGenePool",value:function(e){var t=0,n=!0,r=!1,a=void 0;try{for(var i,o=this.storage[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value.info.flora;s&&s.species===e&&(t+=s.mutationPointsPerEpoch)}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}}]),e}(),Mn={click:!0,contextmenu:!0,dblclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,touchstart:!0,touchmove:!0,touchend:!0,keyup:!0,keydown:!0,keypress:!0,wheel:!0},Cn=function(){function e(t,n){Object(c.a)(this,e),this.renderer=t,this.audioContext=n,this.elements=void 0,this.events=void 0,this.timeElapsed=0,this.frameCount=0}return Object(u.a)(e,[{key:"aspectRatio",get:function(){return this.renderer.domElement.height/this.renderer.domElement.width}},{key:"resolution",get:function(){return new ce.Vector2(this.renderer.domElement.width,this.renderer.domElement.height)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),e}();Cn.id=void 0;var Sn=n(40),Tn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).frameId=void 0,n.lastTimestamp=0,n.stop=!1,n.loop=function(e){var t=e-n.lastTimestamp;n.lastTimestamp=e,n.props.sketch.frameCount++,n.props.sketch.timeElapsed=e;try{n.props.sketch.animate(t)}catch(r){console.error(r)}n.stop?b.removeAnimation(n.frameId):n.setState({frameCount:n.props.sketch.frameCount})},n.handleWindowResize=function(){var e=n.props.sketch.renderer;n.updateRendererCanvasToMatchParent(e),null!=n.props.sketch.resize&&n.props.sketch.resize(e.domElement.width,e.domElement.height)},n.state={frameCount:e.sketch.frameCount},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize();var t=this.props.sketch.renderer.domElement;t.tabIndex=1,Object.keys(Mn).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.addEventListener(n,r):t.addEventListener(n,r))}}),this.frameId=b.addAnimation(this.loop)}},{key:"render",value:function(){var e=[];return null!=this.props.sketch.render&&e.push(this.props.sketch.render()),null!=this.props.sketch.elements&&e.push.apply(e,Object(O.a)(this.props.sketch.elements)),r.createElement("div",{className:"sketch-elements"},e.map(function(e,t){return r.cloneElement(e,{key:t})}))}},{key:"componentWillUnmount",value:function(){var e=this;this.stop=!0,this.props.sketch.destroy&&this.props.sketch.destroy(),null!=this.frameId&&b.removeAnimation(this.frameId),this.props.sketch.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize);var t=this.props.sketch.canvas;Object.keys(Mn).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.removeEventListener(n,r):t.removeEventListener(n,r))}})}},{key:"updateRendererCanvasToMatchParent",value:function(e){var t=e.domElement.parentElement;null!=t&&e.setSize(t.clientWidth,t.clientHeight)}}]),t}(r.PureComponent),Rn=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).state={status:{type:"loading"},volumeEnabled:JSON.parse(window.localStorage.getItem("sketch-volumeEnabled")||"true")},n.audioContext=void 0,n.userVolume=void 0,n.handleContainerRef=function(e){if(null!=e)try{var t=window.AudioContext||window.webkitAudioContext,r=n.audioContext=new t;ce.AudioContext.setContext(r),n.userVolume=r.createGain(),n.userVolume.gain.setValueAtTime(.8,0),n.userVolume.connect(r.destination),(r.gain=r.createGain()).connect(n.userVolume),document.addEventListener("visibilitychange",n.handleVisibilityChange);var a=new ce.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0,antialias:!0});e.appendChild(a.domElement);var i=n.props.otherArgs||[],o=Object($e.a)(n.props.sketchClass,[a,n.audioContext].concat(Object(O.a)(i)));n.setState({status:{type:"success",sketch:o}})}catch(s){n.setState({status:{type:"error",error:s}}),console.error(s)}else"success"===n.state.status.type&&n.state.status.sketch.canvas.remove(),document.removeEventListener("visibilitychange",n.handleVisibilityChange),null!=n.audioContext&&n.audioContext.close(),n.setState({status:{type:"loading"}})},n.handleVolumeButtonClick=function(){var e=!n.state.volumeEnabled;n.setState({volumeEnabled:e}),window.localStorage.setItem("sketch-volumeEnabled",JSON.stringify(e))},n.handleVisibilityChange=function(){null!=n.audioContext&&(document.hidden?n.audioContext.suspend():n.state.volumeEnabled&&n.audioContext.resume())},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){null!=this.userVolume&&null!=this.audioContext&&(this.state.volumeEnabled&&"suspended"===this.audioContext.state?this.audioContext.resume():this.state.volumeEnabled||"running"!==this.audioContext.state||this.audioContext.suspend());var e=this.props,t=(e.sketchClass,e.otherArgs,e.eventsOnBody,e.errorElement,Object(C.a)(e,["sketchClass","otherArgs","eventsOnBody","errorElement"])),n=g()("sketch-component",this.state.status.type);return r.createElement("div",Object.assign({},t,{id:this.props.sketchClass.id,className:n,ref:this.handleContainerRef}),this.renderSketchOrStatus(),this.renderVolumeButton())}},{key:"renderSketchOrStatus",value:function(){var e=this.state.status;return"success"===e.type?r.createElement(Tn,{key:this.props.sketchClass.id,sketch:e.sketch,eventsOnBody:this.props.eventsOnBody}):"error"===e.type?this.props.errorElement||this.renderDefaultErrorElement(e.error.message):"loading"===e.type?null:void 0}},{key:"renderDefaultErrorElement",value:function(e){return r.createElement("p",{className:"sketch-error"},"Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.",r.createElement("pre",null,e))}},{key:"renderVolumeButton",value:function(){var e=this.state.volumeEnabled;return r.createElement("button",{className:"user-volume",onClick:this.handleVolumeButtonClick},e?r.createElement(Sn.b,null):r.createElement(Sn.a,null))}}]),t}(r.PureComponent),Pn=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).handleDivRef=function(e){null!=e||n.exitFullscreen()},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:"full-page-sketch",ref:this.handleDivRef},r.createElement(Rn,{sketchClass:this.props.sketchClass,otherArgs:this.props.otherArgs}))}},{key:"exitFullscreen",value:function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}}]),t}(r.PureComponent);function Nn(e){var t;return function(){return void 0===t&&(t=e()),t}}var Fn=n(64),Dn=n.n(Fn),Bn=n(33),Wn=n.n(Bn),In=16,Ln=!1,zn=Nn(function(){return(new ce.TextureLoader).load(Dn.a,function(){zn().dispatchEvent({type:"update"}),Ln=!0})}),Yn=(new ce.TextureLoader).load(Wn.a),Gn={};function Vn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";e=Math.floor(e),t=Math.floor(t);var r="".concat(e,",").concat(t);if(null==Gn[r]){var a=function(){var r=zn().image,a=i.getContext("2d");a.fillStyle=n,a.fillRect(0,0,In,16),a.drawImage(r,In*e,In*t,In,In,0,0,In,In),o.needsUpdate=!0},i=document.createElement("canvas");i.width=In,i.height=In;var o=new ce.Texture(i);o.magFilter=ce.NearestFilter,o.flipY=!0,o.wrapS=ce.RepeatWrapping,o.wrapT=ce.RepeatWrapping,Ln?a():zn().addEventListener("update",function(){a()}),Gn[r]=o}return Gn[r]}var Hn=function e(t,n,r){Object(c.a)(this,e),this.target=t,this.scene=n,this.mito=r},Un=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this))).geometry=void 0,n.material=void 0,n.index=0,n.geometry=t.newGeometry(),n.material=new Zn(e),n.frustumCulled=!1,n}return Object(f.a)(t,e),Object(u.a)(t,null,[{key:"newGeometry",value:function(){var e=new ce.BufferGeometry,n=new Float32Array(3*t.BUFFER_SIZE),r=new Float32Array(t.BUFFER_SIZE);return e.addAttribute("position",new ce.BufferAttribute(n,3).setDynamic(!0)),e.addAttribute("size",new ce.BufferAttribute(r,1).setDynamic(!0)),e}}]),Object(u.a)(t,[{key:"startFrame",value:function(){this.index=0}},{key:"commit",value:function(e,t,n,r){this.geometry.attributes.position.setXYZ(this.index,e,t,n),this.geometry.attributes.size.setX(this.index,r),this.index++}},{key:"endFrame",value:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.setDrawRange(0,this.index)}}]),t}(ce.Points);Un.BUFFER_SIZE=1e5;var Zn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,{uniforms:{opacity:{value:e.opacity},sizeGlobal:{value:e.size},color:{value:e.color},map:{value:e.map}},vertexShader:Kn,fragmentShader:qn,depthTest:!1,transparent:!0}))).params=e,n.map=void 0,n.map=e.map,n}return Object(f.a)(t,e),t}(ce.ShaderMaterial),Kn="\nattribute float size;\nuniform float sizeGlobal;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",qn="\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\n#ifdef USE_MAP\n  uniform mat3 uvTransform;\n  uniform sampler2D map;\n#endif\n\nvoid main() {\n    gl_FragColor = vec4( color, opacity );\n\n    #ifdef USE_MAP\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\n        gl_FragColor *= mapTexelToLinear( mapTexel );\n    #endif\n}\n",Jn=function(e){function t(e,n,r){var a;Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).animationOffset=0,a.waters=[],a.sugars=[],a.handleGetResources=function(e){for(var t=Math.ceil(a.target.water);a.waters.length<t;){var n=e.carrier.pos.clone().sub(a.target.carrier.pos);n.x+=.1*(Math.random()-.5),n.y+=.1*(Math.random()-.5),a.waters.push(n)}for(t=Math.ceil(a.target.sugar);a.sugars.length<t;){var r=e.carrier.pos.clone().sub(a.target.carrier.pos);r.x+=.1*(Math.random()-.5),r.y+=.1*(Math.random()-.5),a.sugars.push(r)}},a.handleGiveResources=function(){var e=Math.ceil(a.target.water);a.waters.length>e&&a.waters.splice(e,a.waters.length-e),e=Math.ceil(a.target.sugar),a.sugars.length>e&&a.sugars.splice(e,a.sugars.length-e)},e.on("get",a.handleGetResources),e.on("give",a.handleGiveResources);for(var i=0;i<a.target.water;i++)a.waters.push(Xn());for(var o=0;o<a.target.sugar;o++)a.sugars.push(Xn());return a}return Object(f.a)(t,e),Object(u.a)(t,null,[{key:"startFrame",value:function(){t.WaterParticles().startFrame(),t.SugarParticles().startFrame()}},{key:"endFrame",value:function(){t.WaterParticles().endFrame(),t.SugarParticles().endFrame()}}]),Object(u.a)(t,[{key:"updateNumParticles",value:function(e){}},{key:"commitParticles",value:function(e,t,n){if(n.length>0){for(var r=0;r<n.length-1;r++){var a=n[r];e.commit(a.x+this.target.carrier.pos.x,a.y+this.target.carrier.pos.y,10,1),t-=1}var i=n[n.length-1],o=t;e.commit(i.x+this.target.carrier.pos.x,i.y+this.target.carrier.pos.y,10,Je(Math.sqrt(o),0,1,.2,1))}}},{key:"simulateResourcePositions",value:function(){for(var e=this.waters.length,t=e+this.sugars.length,n=0;n<t;n++){var r=n<e?this.waters[n]:this.sugars[n-e],a=0,i=0,o=b.now/3e3+this.animationOffset;a+=.02*Math.cos(o);var s=.1+.1*r.length();a+=-r.x*s,i+=-r.y*s;var l=this.mito.world.player;if(l.pos.equals(this.target.carrier.pos)){var c=l.posFloat.x-l.pos.x,u=l.posFloat.y-l.pos.y,h=r.x-c,d=r.y-u,f=h*h+d*d,m=Math.max(Math.min(Je(f,0,1,3,-5),3),0);a+=h*m*.2,i+=d*m*.2}for(var v=0;v<t;v++){var p=v<e?this.waters[v]:this.sugars[v-e];if(r===p)break;var y=r.x-p.x,g=r.y-p.y,w=y*y+g*g;if(w>0){var k=.003/w;a+=y*k,i+=g*k}}r.x+=a,r.y+=i}}},{key:"update",value:function(){this.updateNumParticles(this.target.water),this.updateNumParticles(this.target.sugar),this.simulateResourcePositions(),this.commitParticles(t.WaterParticles(),this.target.water,this.waters),this.commitParticles(t.SugarParticles(),this.target.sugar,this.sugars)}},{key:"destroy",value:function(){this.target.off("get",this.handleGetResources),this.target.off("give",this.handleGiveResources)}}]),t}(Hn);function Xn(){return new ce.Vector2(.01*(Math.random()-.5),.01*(Math.random()-.5))}Jn.WaterParticles=Nn(function(){return new Un({color:new ce.Color("rgb(9, 12, 255)"),size:45,opacity:.75})}),Jn.SugarParticles=Nn(function(){return new Un({color:new ce.Color("yellow"),size:85,opacity:.9,map:Vn(42,12,"transparent")})});var Qn=function(e){function t(e,n,r){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).mesh=void 0,a.mesh=new ce.Mesh(new ce.PlaneBufferGeometry(.75,.75),new ce.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:Vn(29,12,"transparent"),color:new ce.Color("white"),side:ce.DoubleSide})),qe(a.mesh.position,a.target.pos,1),a.mesh.position.z=2,a.scene.add(a.mesh),a}return Object(f.a)(t,e),Object(u.a)(t,[{key:"update",value:function(){var e=this.target.droopPosFloat().clone();e.x+=.04*Math.cos(b.now/1e3),e.y+=.08*Math.sin(b.now/400),qe(this.mesh.position,e,.5),this.mesh.position.z=2}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(Hn),_n=n(69);var $n=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e.target,e.scene,e.mito))).tileRenderer=e,n.renderers=[],n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"update",value:function(){var e;for(e=0;e<this.target.effects.length;e++){var t=this.target.effects[e],n=this.renderers[e];null==n?this.renderers[e]=er(t,this.tileRenderer):t!==n.target&&(n.destroy(),this.renderers[e]=er(t,this.tileRenderer))}for(;e<this.renderers.length;e++){this.renderers[e].destroy()}var r=!0,a=!1,i=void 0;try{for(var o,s=this.renderers[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value.update()}}catch(l){a=!0,i=l}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}},{key:"destroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.renderers[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.destroy()}}catch(i){t=!0,n=i}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}}]),t}(Hn);function er(e,t){if(e instanceof en)return new tr(e,t);throw new Error("effect renderer not defined for"+e)}var tr=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n.scene,n.mito))).tileRenderer=n,r.mesh=void 0,r.mesh=t.newMesh(),n.mesh.add(r.mesh),r.mesh.scale.set(.01,.01,1),r}return Object(f.a)(t,e),Object(u.a)(t,[{key:"update",value:function(){var e=Je(this.target.percentFrozen,0,1,.2,1);this.mesh.scale.x=Ke(this.mesh.scale.x,e,.2),this.mesh.scale.y=Ke(this.mesh.scale.y,e,.2)}},{key:"destroy",value:function(){this.tileRenderer.mesh.remove(this.mesh)}}]),t}(Hn);tr.newMesh=function(){var e=new ce.PlaneBufferGeometry(.75,.75);e.translate(0,0,1);var t=new ce.MeshBasicMaterial({map:Vn(Math.floor(23/16),Math.floor(1.375)),side:ce.DoubleSide,color:rr,transparent:!0,opacity:.5});return new ce.Mesh(e,t)};var nr,rr=new ce.Color("#1E90FF").lerp(new ce.Color(0),.5),ar=function(){function e(){Object(c.a)(this,e),this.animation=void 0,this.timeStarted=void 0}return Object(u.a)(e,[{key:"set",value:function(e,t){this.animation=e,this.timeStarted=t}},{key:"update",value:function(e){if(null!=this.animation&&null!=this.timeStarted){var t=e-this.timeStarted;this.animation(t)&&(this.animation=void 0,this.timeStarted=void 0)}}}]),e}(),ir=function(e){function t(e){var n,r;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,t.geometry,(r=e.target,sr().get(r.constructor).clone())))).renderer=e,n}return Object(f.a)(t,e),t}(ce.Mesh);ir.geometry=new ce.PlaneBufferGeometry(1,1);var or=function(e){function t(e,n,r){var i;Object(c.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).mesh=void 0,i.inventoryRenderer=void 0,i.originalColor=void 0,i.audio=void 0,i.lastAudioValueTracker=0,i.pairsLines=new ce.Object3D,i.worldDomElement=void 0,i.growingRenderer=void 0,i.cellEffectsRenderer=void 0,i.animation=new ar,i.temperatureColor=t.TEMPERATURE_COLORS[Mt.Mild],i.currentLerp=0,i.target instanceof nn?(i.growingRenderer=new t(i.target.completedCell,i.scene,i.mito),i.mesh=i.growingRenderer.mesh,i.mesh.scale.set(.01,.01,1)):i.mesh=new ir(Object(St.a)(i)),i.originalColor=i.mesh.material.color.clone(),At(i.target)&&(i.inventoryRenderer=new Jn(i.target.inventory,i.scene,i.mito),i.inventoryRenderer.animationOffset=(i.target.pos.x+i.target.pos.y)/2),i.scene.add(i.mesh);var o=i.target instanceof tn?1:0;if(i.mesh.position.set(i.target.pos.x,i.target.pos.y,o),i.target instanceof tn?i.target.constructor.turnsToBuild||i.mesh.scale.set(.01,.01,1):i.mesh.matrixAutoUpdate=!1,i.mesh.updateMatrix(),(i.target instanceof an||i.target instanceof on)&&(i.audio=new ce.Audio(i.mito.audioListener),i.mesh.add(i.audio)),i.target instanceof sn){var s=i.target;i.worldDomElement=r.addWorldDOMElement(function(){return i.target.pos},function(){return a.a.createElement("div",{className:"fruit-indicator"},a.a.createElement("div",null,s.committedResources.water.toFixed(1),"/",s.neededResources/2," water"),a.a.createElement("div",null,s.committedResources.sugar.toFixed(1),"/",s.neededResources/2," sugar"))})}return i.target instanceof tn&&(i.cellEffectsRenderer=new $n(Object(St.a)(i))),i}return Object(f.a)(t,e),Object(u.a)(t,[{key:"steps",value:function(e,t){return Math.floor(e/t)*t}},{key:"update",value:function(){var e=this.target.lightAmount();this.updateVisibility(e),this.updateSize(),this.updateColor(e),this.target instanceof tn&&this.mesh.position.set(this.target.pos.x,this.target.pos.y+this.target.droopY,1),this.respondToEvents(),null!=this.cellEffectsRenderer&&this.cellEffectsRenderer.update(),this.animation.update(b.now/1e3)}},{key:"updateVisibility",value:function(e){e>0?(null==this.mesh.parent&&this.scene.add(this.mesh),null!=this.inventoryRenderer&&this.inventoryRenderer.update()):null!=this.mesh.parent&&this.scene.remove(this.mesh)}},{key:"updateSize",value:function(){if(this.target instanceof nn){var e=1-this.target.timeRemaining/this.target.timeToBuild;qe(this.mesh.scale,{x:e,y:e},.5)}else if(this.target instanceof sn){var n=Je(this.target.getPercentMatured(),0,1,.2,1),r=new ce.Vector2(n,n);qe(this.mesh.scale,r,.1)}else qe(this.mesh.scale,t.ONE,.1)}},{key:"updateColor",value:function(e){var t=this.mesh.material;if(this.target instanceof Jt){var n=Math.max(0,Je(this.target.co2(),1/6,1.001,0,lr.length-1)),r=Math.floor(n),a=lr[r];if(this.originalColor=a.clone(),r!==lr.length-1){var i=n-r,o=lr[r+1];this.originalColor.lerp(o,i)}}t.color.copy(this.originalColor),Ut(this.target)&&t.color.lerp(new ce.Color(0),1-this.target.energy/fn.cellEnergyMax),t.color=this.lerpColorTemperature(t.color),t.color=new ce.Color(0).lerp(t.color,Je(e,0,1,.2,1))}},{key:"respondToEvents",value:function(){if(this.target instanceof an&&null!=this.audio){var e=this.target.totalSugarProduced;if(e>this.lastAudioValueTracker){this.audio.setBuffer(ot);var t=this.target.pos.distanceToSquared(this.mito.world.player.pos),n=Math.min(1,1/(1+t/25))*this.target.sugarConverted*this.target.sugarConverted;this.audio.setVolume(n),this.audio.play(),this.animation.set(this.growPulseAnimation(),b.now/1e3)}this.lastAudioValueTracker=e}if(this.target instanceof on&&null!=this.audio){var r=this.target.totalSucked;if(r!==this.lastAudioValueTracker){this.audio.setBuffer(st);var a=this.target.pos.distanceToSquared(this.mito.world.player.pos),i=1*Math.min(1,1/(1+a/25));this.audio.setVolume(i),null!=this.audio.source&&this.audio.stop(),this.audio.play(),this.animation.set(this.growPulseAnimation(),b.now/1e3)}this.lastAudioValueTracker=r}this.mesh.remove(this.pairsLines)}},{key:"lerpColorTemperature",value:function(e){var n=this.target.temperature,r=t.TEMPERATURE_COLORS[n];r!==this.temperatureColor&&(this.currentLerp=0);var a=n===Mt.Mild?0:.5;return this.temperatureColor=r,this.currentLerp=Ke(this.currentLerp,a,.1),e.lerp(this.temperatureColor,this.currentLerp),e}},{key:"updateHover",value:function(){var e=this;if(this.mesh.add(this.pairsLines),this.target.tilePairs instanceof Array){var t,n=this.target instanceof an?16763150:new ce.Color("rgb(9, 12, 255)").getHex(),r=this.target.tilePairs;if(r.length!==this.pairsLines.children.length)(t=this.pairsLines).remove.apply(t,Object(O.a)(this.pairsLines.children)),r.forEach(function(t){var r=2*t.length()-.25,a=new ce.Vector3(t.x,t.y,0).normalize(),i=e.makeLine(a,a.clone().multiplyScalar(-r/2),r,n);e.pairsLines.add(i)})}if(this.hasActiveNeighbors(this.target)){var a,i=this.target instanceof on?new ce.Color("rgb(9, 12, 255)").getHex():16777215,o=this.target.activeNeighbors;if(o.length!==this.pairsLines.children.length)(a=this.pairsLines).remove.apply(a,Object(O.a)(this.pairsLines.children)),o.forEach(function(t){var n=t.length()-.25,r=new ce.Vector3(t.x,t.y,0).normalize(),a=e.target instanceof on?e.makeLine(r,new ce.Vector3,n,i):new ce.ArrowHelper(r,new ce.Vector3(0,0,5),n,i);e.pairsLines.add(a)})}}},{key:"growPulseAnimation",value:function(){var e,t=this,n=(e=_n.a,function(t){return e(1-t)});return function(e){var r=Xe(e/.5*(t.target.tempo||1),0,1),a=Je(n(r),0,1,1,1.3);return t.mesh.scale.setScalar(a),r>=1}}},{key:"hasActiveNeighbors",value:function(e){return Array.isArray(e.activeNeighbors)}},{key:"makeLine",value:function(e,n,r,a){var i=new ce.Line(t.lineGeometry,new ce.LineBasicMaterial({color:a}));if(i.position.copy(n),e.y>.99999)i.quaternion.set(0,0,0,1);else if(e.y<-.99999)i.quaternion.set(1,0,0,0);else{var o=new ce.Vector3(e.z,0,-e.x).normalize(),s=Math.acos(e.y);i.quaternion.setFromAxisAngle(o,s)}return i.scale.set(1,Math.max(0,r),1),i.position.z=.1,i.updateMatrix(),i.matrixAutoUpdate=!1,i}},{key:"destroy",value:function(){this.scene.remove(this.mesh),null!=this.worldDomElement&&this.mito.removeWorldDOMElement(this.worldDomElement),null!=this.inventoryRenderer&&this.inventoryRenderer.destroy(),null!=this.cellEffectsRenderer&&this.cellEffectsRenderer.destroy()}}]),t}(Hn);or.TEMPERATURE_COLORS=(nr={},Object(le.a)(nr,Mt.Scorching,new ce.Color("orange")),Object(le.a)(nr,Mt.Hot,new ce.Color("orange").lerp(new ce.Color("white"),.5)),Object(le.a)(nr,Mt.Mild,new ce.Color("white")),Object(le.a)(nr,Mt.Cold,new ce.Color("lightblue").lerp(new ce.Color("white"),.5)),Object(le.a)(nr,Mt.Freezing,new ce.Color("lightblue")),nr),or.ONE=new ce.Vector2(1,1),or.lineGeometry=function(){var e=new ce.BufferGeometry;return e.addAttribute("position",new ce.Float32BufferAttribute([0,0,0,0,1,0],3)),e}();var sr=Nn(function(){var e=new Map;return e.set(Jt,new ce.MeshBasicMaterial({side:ce.DoubleSide,depthWrite:!1})),e.set(Xt,new ce.MeshBasicMaterial({map:Vn(8,11),side:ce.DoubleSide,color:new ce.Color("rgb(112, 89, 44)"),depthWrite:!1})),e.set($t,new ce.MeshBasicMaterial({map:Vn(3.5,2.375),side:ce.DoubleSide})),e.set(Qt,new ce.MeshBasicMaterial({map:Vn(26,20),side:ce.DoubleSide,color:new ce.Color("rgb(63, 77, 84)")})),e.set(_t,new ce.MeshBasicMaterial({map:Vn(8.5625,23.375),side:ce.DoubleSide,color:new ce.Color("rgb(128, 128, 128)")})),e.set(rn,new ce.MeshBasicMaterial({map:Vn(6,31),side:ce.DoubleSide,color:new ce.Color(3190309)})),e.set(cn,e.get(rn)),e.set(an,new ce.MeshBasicMaterial({map:Vn(55/16,17.5),side:ce.DoubleSide})),e.set(on,new ce.MeshBasicMaterial({map:Vn(59/16,327/16),side:ce.DoubleSide})),e.set(sn,new ce.MeshBasicMaterial({map:Yn,side:ce.DoubleSide,transparent:!0})),e.set(un,new ce.MeshBasicMaterial({map:Vn(Math.floor(11.5),Math.floor(9.5)),side:ce.DoubleSide})),e});var lr=[new ce.Color("hsl(67, 31%, 25%)"),new ce.Color("hsl(180, 31%, 76%)"),new ce.Color("hsl(213, 63%, 58%)")],cr=function(e){function t(e,n,r){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).arrow=void 0,a.arrow=a.makeArrow(a.target.dir),a.mesh.add(a.arrow),a}return Object(f.a)(t,e),Object(u.a)(t,[{key:"makeArrow",value:function(e){var t=e.length()-.25,n=new ce.Vector3(e.x,e.y,0).normalize(),r=n.clone().multiplyScalar(-t/2);return new ce.ArrowHelper(n,new ce.Vector3(r.x,r.y,1),t,16777215,.1,.1)}}]),t}(or);function ur(e,t,n){if(e instanceof hn)return new Qn(e,t,n);if(e instanceof cn)return new cr(e,t,n);if(e instanceof Zt)return new or(e,t,n);throw new Error("Couldn't find renderer for ".concat(e))}var hr=function(e){function t(e,n,r){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).renderers=new Map,a.deleteDeadEntityRenderers=Object(We.a)(function(e){return e},function(e){var t=e.deleted,n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,c=a.renderers.get(l);if(null==c)throw new Error("Couldn't find renderer for ".concat(l,"!"));c.destroy(),a.renderers.delete(l)}}catch(u){r=!0,i=u}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}),n.add(Jn.WaterParticles()),n.add(Jn.SugarParticles()),a}return Object(f.a)(t,e),Object(u.a)(t,[{key:"getOrCreateRenderer",value:function(e){var t=this.renderers.get(e);if(null==t){var n=ur(e,this.scene,this.mito);return this.renderers.set(e,n),n}return t}},{key:"update",value:function(){var e=this;this.deleteDeadEntityRenderers(this.target.getLastStepStats()),Jn.startFrame(),this.target.entities().forEach(function(t){e.getOrCreateRenderer(t).update()}),Jn.endFrame()}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}}]),t}(Hn),dr=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Lt/27;Object(c.a)(this,e),this.mito=t,this.pxPerTile=n,this.captureInterval=r,this.lastCaptureTime=0}return Object(u.a)(e,[{key:"isTimeForNewCapture",value:function(){return this.mito.world.time-this.lastCaptureTime>this.captureInterval}},{key:"capture",value:function(){var t=this,n=e.renderTarget,r=e.rtBuffer,a=e.rtCanvas;this.lastCaptureTime=this.mito.world.time;var i=Array.from(this.mito.world.cells()).filter(function(e){return e.pos.y<50&&!(e instanceof nn)}),o=this.getBounds(i),s=Object(p.a)(o,2),l=s[0],c=s[1],u=new ce.Scene,h=i.map(function(e){var n=ur(e,u,t.mito);return n.update(),n}),d=this.cameraEncompassingBounds([l,c]),f=this.mito.renderer;f.setRenderTarget(n),f.clear(!0,!0,!0),f.render(u,d),f.setRenderTarget(null),f.readRenderTargetPixels(n,0,0,n.width,n.height,r);for(var m=a.getContext("2d"),v=m.createImageData(a.width,a.height),y=v.data,g=0;g<r.length;g++)y[g]=r[g];m.putImageData(v,0,0);var w=c.x-l.x,b=c.y-l.y,k=Math.max(w,b),E=Je(w,0,k,0,1024),x=Je(b,0,k,0,1024),O=new ce.Vector2(512-E/2,512-x/2),j=document.createElement("canvas");j.width=Math.ceil(w*this.pxPerTile),j.height=Math.ceil(b*this.pxPerTile),j.getContext("2d").drawImage(a,O.x,O.y,E,x,0,0,j.width,j.height);var A=new Image;return A.src=j.toDataURL(),document.body.appendChild(A),h.forEach(function(e){e.destroy()}),j}},{key:"getBounds",value:function(e){var t=new ce.Vector2,n=new ce.Vector2;null!=e[0]&&(t.copy(e[0].pos),n.copy(e[0].pos));var r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;t.min(l.pos),n.max(l.pos)}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return t.subScalar(.5),n.addScalar(.5),[t,n]}},{key:"cameraEncompassingBounds",value:function(e){var t=Object(p.a)(e,2),n=t[0],r=t[1],a=n.clone().lerp(r,.5),i=r.x-n.x,o=r.y-n.y,s=Math.max(i,o);return new ce.OrthographicCamera(a.x-s/2,a.x+s/2,a.y+s/2,a.y-s/2,-100,100)}}]),e}();dr.renderTarget=new ce.WebGLRenderTarget(1024,1024),dr.rtBuffer=new Uint8Array(dr.renderTarget.width*dr.renderTarget.height*4),dr.rtCanvas=function(){var e=document.createElement("canvas");return e.width=dr.renderTarget.width,e.height=dr.renderTarget.height,e}();var fr=dr,mr={KeyQ:{type:"drop",sugar:0,water:1},KeyE:{type:"drop",sugar:1,water:0},Space:{type:"pickup",sugar:1,water:1}},vr={KeyW:{type:"move",dir:Tt.n},KeyA:{type:"move",dir:Tt.w},KeyS:{type:"move",dir:Tt.s},KeyD:{type:"move",dir:Tt.e}},pr={Digit1:0,Digit2:1,Digit3:2,Digit4:3,Digit5:4},yr=(Object.keys(vr).map(function(e){return vr[e]}),function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.createElement("div",{className:"mito-instructions"},r.createElement("div",{className:"mito-instructions-container"},r.createElement("div",{className:"esc",onClick:function(){return e.props.play()}},"Back (Esc)"),r.createElement("h1",null,"Mito"),r.createElement("div",{className:"play-button",onClick:function(){return e.props.play()}},"Play"),r.createElement("p",null,r.createElement("ol",null,r.createElement("li",null,"Build Tissue to expand your reach (press t and walk into empty space)."),r.createElement("li",null,"Build Roots (press r) underground to suck up adjacent water."),r.createElement("li",null,"Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar."),r.createElement("li",null,r.createElement("b",null,"Win the game by building and loading the Fruit with 1000 sugar.")),r.createElement("li",null,"Click around to see the different properties of each tile."),r.createElement("li",null,"Build leaves early."),r.createElement("li",null,"Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air."),r.createElement("li",null,"Explore underground for water reservoires and Fountains."),r.createElement("li",null,"Build transports (capital T) to carry water back up the plant."),r.createElement("li",null,"You can scroll out infinitely far."))),r.createElement("h3",null,"You"),r.createElement("p",null,"You can carry max ",fn.maxResources," resources, and you automatically suck in any resources you're standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil below and air above."),r.createElement("h3",null,"Soil and Underground"),r.createElement("p",null,"Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a permanent source of water. Soil holds up to ",fn.soilMaxWater," water at a time. Fountains emit one water per ",fn.fountainTurnsPerWater," turns."),r.createElement("h3",null,"Air and Aboveground"),r.createElement("p",null,"Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun, which gently sways left to right."),r.createElement("h3",null,"Water"),r.createElement("p",null,"Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2 required) at about 1 unit per ",(1/fn.soilDiffusionWater).toFixed(0)," turns. Obtain water in the ground through Roots. Leaves require water to photosynthesize. You require water to build."),r.createElement("h3",null,"Sugar"),r.createElement("p",null,"Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by putting water next to leaves. Cells require sugar to survive. You require sugar to build."),r.createElement("h3",null,"Building"),r.createElement("p",null,'Build Tissue, Leaves, Roots, and The Fruit by toggling "build mode" on and walking into Air or Soil. Build Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they\'re not properly supported underneath them.'),r.createElement("h3",null,"Cells"),r.createElement("p",null,"All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their neighbors. Each cell consumes 1 sugar every ",fn.cellEnergyMax," turns."),r.createElement("h3",null,"Tissue"),r.createElement("p",null,"Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to"," ",fn.tissueInventoryCapacity," resources."),r.createElement("h3",null,"Roots"),r.createElement("p",null,"Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is called a Pairing."),r.createElement("h3",null,"Leaves"),r.createElement("p",null,"When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per"," ",(1/fn.leafReactionRate).toFixed(0)," turns per pair. Leaf efficiency is heavily influenced by co2 and sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize. Leaves higher up produce sugar faster."),r.createElement("h3",null,"Transport"),r.createElement("p",null,"Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you. Transport hungers at double speed."),r.createElement("h3",null,"The Fruit"),r.createElement("p",null,"You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to 1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity."),this.renderCredit()))}},{key:"renderCredit",value:function(){return r.createElement(r.Fragment,null,r.createElement("h2",null,"Attribution"),r.createElement("p",null,"Tiles:"," ",r.createElement("a",{href:"http://kenney.nl/assets?s=roguelike",target:"_blank",rel:"noopener noreferrer"},"Kenney.nl Roguelike Assets")),r.createElement("p",null,"Pop sound when leaves convert:"," ",r.createElement("a",{href:"http://soundbible.com/2067-Blop.html",target:"_blank",rel:"noopener noreferrer"},"Blop by Mark DiAngelo")," ","(",r.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/us/"},"CC BY 3.0 US"),")"),r.createElement("p",null,"Perlin noise:"," ",r.createElement("a",{href:"https://github.com/josephg/noisejs",target:"_blank",rel:"noopener noreferrer"},"josephg/noisejs")),r.createElement("p",null,"Part of 7drl 2018:"," ",r.createElement("a",{href:"http://7drl.org/",target:"_blank",rel:"noopener noreferrer"},"http://7drl.org/")),r.createElement("p",null,"Fruit icon:"," ",r.createElement("a",{href:"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm"},"Designed by Freepik")))}}]),t}(r.PureComponent)),gr=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).handlePlay=function(){n.props.mito.instructionsOpen=!1},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.props.mito.instructionsOpen?r.createElement(yr,{play:this.handlePlay}):null}}]),t}(r.PureComponent),wr=(n(131),function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.tile;return e?r.createElement("div",{className:"tile-hover"},this.tileInfo(e),this.inventoryInfo(e),this.cellInfo(e),this.growingCellInfo(e),this.rootInfo(e),this.leafInfo(e),this.airInfo(e),this.fountainInfo(e)):null}},{key:"rootInfo",value:function(e){return e instanceof on?r.createElement("div",{className:"info-root"},r.createElement("div",null,e.totalSucked," water collected."),r.createElement("div",null,e.cooldown.toFixed(0)," turns until next water suck.")):null}},{key:"leafInfo",value:function(e){return e instanceof an?r.createElement("div",{className:"info-leaf"},r.createElement("div",null,e.totalSugarProduced," sugar produced."),r.createElement("div",null,(1/(e.averageSpeed*fn.leafReactionRate)).toFixed(0)," turns per reaction."),r.createElement("div",null,(1/e.averageEfficiency).toFixed(2)," water per sugar.")):null}},{key:"airInfo",value:function(e){if(e instanceof Jt)return r.createElement("div",{className:"info-air"},r.createElement("div",null,"\u2600\ufe0f ",(100*e.sunlight()).toFixed(0),"%"),r.createElement("div",null,"\u2601\ufe0f ",(100*e.co2()).toFixed(0),"%"))}},{key:"fountainInfo",value:function(e){if(e instanceof $t)return r.createElement("div",{className:"info-fountain"},r.createElement("div",null,e.turnsPerWater," turns per water"))}},{key:"tileInfo",value:function(e){var t=Ut(e)?r.createElement("span",{className:"info-energy"},"\ud83d\udc9a",(e.energy/fn.cellEnergyMax*100).toFixed(0),"%"):null;return r.createElement("div",{className:"info-tile"},r.createElement("div",{className:"info-tile-name"},e.constructor.displayName),this.temperatureInfo(e),t)}},{key:"temperatureInfo",value:function(e){function t(e){var t=e.color,n=void 0===t?"black":t,a=e.left,i=void 0===a?0:a,o=e.width,s=void 0===o?3:o;return r.createElement("div",{style:{position:"absolute",top:-1,left:i,width:1,bottom:0,borderRight:"".concat(s,"px solid ").concat(n)}})}function n(e){var t=e.children,n=e.fontWeight,a=void 0===n?"normal":n,i=e.left;return r.createElement("div",{style:{position:"absolute",left:i,width:"".concat(32,"%"),textAlign:"center",fontSize:12,fontWeight:a,fontFamily:"Arial"}},t)}return r.createElement("div",{className:"info-tile-temperature"},r.createElement("div",{style:{width:200,height:"1.15em",border:"1px solid grey",position:"relative"}},r.createElement(t,{left:"".concat(32,"%"),color:"lightblue"}),r.createElement(n,{left:0,fontWeight:e.temperature===Mt.Cold?"bold":"normal"},Mt.Cold),r.createElement(t,{left:"".concat(64,"%"),color:"orange"}),r.createElement(n,{left:"".concat(32,"%"),fontWeight:e.temperature===Mt.Mild?"bold":"normal"},Mt.Mild),r.createElement(n,{left:"".concat(64,"%"),fontWeight:e.temperature===Mt.Hot?"bold":"normal"},Mt.Hot),r.createElement(t,{left:"".concat(e.temperatureFloat/100*100,"%"),color:"black",width:3}),r.createElement("div",{style:{position:"absolute",left:"".concat(e.temperatureFloat/100*100,"%"),transform:"translateX(-50%)",top:"-1.5em",textAlign:"center",fontSize:12,fontWeight:"bold",fontFamily:"Arial"}},e.temperatureFloat.toFixed(0)," \xb0F")))}},{key:"inventoryInfo",value:function(e){if(At(e)){var t=e.inventory.water>0?r.createElement("div",{className:"info-inventory-item"},"\ud83d\udca7 ",e.inventory.water.toFixed(2)):null,n=e.inventory.sugar>0?r.createElement("div",{className:"info-inventory-item"},"Sugar ",e.inventory.sugar.toFixed(2)):null;return r.createElement("div",{className:"info-inventory"},t,n)}}},{key:"cellInfo",value:function(e){if(e instanceof tn)return r.createElement(r.Fragment,null,200*e.droopY>1?r.createElement("div",{className:"info-cell"},(200*e.droopY).toFixed(0),"% droop"):null,this.cellEffects(e))}},{key:"cellEffects",value:function(e){var t=e.effects;if(t.length>0){var n=t.map(function(e){var t=e.constructor.displayName;return e instanceof en?"".concat((100*e.percentFrozen).toFixed(0),"% ").concat(t):t}).join(", ");return r.createElement("div",{className:"info-cell"},n)}return null}},{key:"growingCellInfo",value:function(e){if(e instanceof nn)return r.createElement("div",{className:"info-growing-cell"},(100-e.timeRemaining/e.timeToBuild*100).toFixed(0),"% mature")}}]),t}(r.Component));n(132);function br(e){var t=e.type,n=e.hotkey,a=e.isSelected,i=e.onClick,o=e.spritesheetLoaded,s=r.useMemo(function(){var e=sr().get(t),n=e.map.image,r=e.color.getStyle(),a=null!=n?n instanceof HTMLCanvasElement&&o?n.toDataURL():n instanceof Image?n.src:"":"";return{backgroundImage:"url(".concat(a,"), linear-gradient(").concat(r,", ").concat(r,")")}},[o,t]);return r.createElement("div",{className:g()("cell-bar-item",{selected:a})},r.createElement("div",{className:"cell-bar-item-icon",onClick:i,style:s},t.displayName),r.createElement(kr,{hotkey:n,onClick:i}))}function kr(e){var t=e.hotkey,n=e.onClick,a=Object(C.a)(e,["hotkey","onClick"]);return r.createElement("div",Object.assign({className:"mito-hud-button mito-hud-build-item",onClick:function(e){n&&n(e),function(e){e.preventDefault(),document.getElementsByTagName("canvas")[0].focus()}(e)}},a),r.createElement("span",{className:"mito-hud-button-hotkey"},t))}var Er=function(e){var t=e.bar,n=e.index,a=e.onIndexClicked;return r.createElement("div",{className:"cell-bar"},t.map(function(e,t){return r.createElement(br,{key:t,hotkey:String(t+1),type:e,isSelected:n===t,onClick:function(){return a(t)},spritesheetLoaded:Ln})}))};n(133),n(134);function xr(e){var t=e.time,n=e.season,a=t/It;return r.createElement("div",{className:"seasons-tracker"},r.createElement("div",{className:"container"},r.createElement("div",{className:"end-brace"}),r.createElement("div",{className:"bar"},r.createElement(Or,{percent:.25}),r.createElement(Or,{percent:.5}),r.createElement(Or,{percent:.75}),r.createElement(jr,{percent:a})),r.createElement("div",{className:"end-brace"})),r.createElement("div",{className:"season-display"},Wt(n)))}function Or(e){var t=e.percent,n={left:"".concat((100*t).toFixed(2),"%")};return r.createElement("div",{className:"bar-marker",style:n})}function jr(e){var t=e.percent,n={left:"".concat((100*t).toFixed(2),"%")};return r.createElement("div",{className:"season-bead",style:n})}var Ar=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).state={traitsPanelOpen:!0},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"isTutorialFinished",value:function(){return null==this.mito.tutorialRef||this.mito.tutorialRef.isFinished()}},{key:"render",value:function(){var e=this,t=this.inventory.isMaxed(),n=r.createElement("div",{className:"mito-inventory-maxed".concat(t?" is-maxed":"")},"maxed");return r.createElement(r.Fragment,null,r.createElement(xr,{time:this.world.time,season:this.world.season}),this.maybeRenderTraits(),r.createElement("div",{className:g()("mito-inventory",{hidden:!1})},n,r.createElement("div",{className:"mito-inventory-container"},this.renderInventoryBar(),this.renderInventory()),r.createElement(Er,{bar:this.mito.cellBar,index:this.mito.cellBarIndex,onIndexClicked:function(t){return e.mito.setCellBarIndex(t)}})))}},{key:"maybeRenderTraits",value:function(){if(this.state.traitsPanelOpen&&(e=this.world.traits,B.some(function(t){return 0!==e[t]})))return r.createElement("div",{className:"hud-panel-right"},r.createElement(H,{traits:this.world.traits}));var e}},{key:"renderInventory",value:function(){return r.createElement("div",{className:"mito-inventory-indicator"},r.createElement("span",{className:"mito-inventory-water"},r.createElement(E,{speed:.5,value:this.inventory.water})," water"),"\xa0",r.createElement("span",{className:"mito-inventory-sugar"},r.createElement(E,{speed:.5,value:this.inventory.sugar})," sugar"))}},{key:"renderInventoryBar",value:function(){var e=this.inventory.water/fn.maxResources,t=this.inventory.sugar/fn.maxResources,n=1-(this.inventory.water+this.inventory.sugar)/fn.maxResources,a={width:"".concat(100*e,"%")},i={width:"".concat(100*t,"%")},o={width:"".concat(100*n,"%")};return r.createElement("div",{className:"mito-inventory-bar"},r.createElement("div",{style:a,className:"mito-inventory-bar-water"}),r.createElement("div",{style:i,className:"mito-inventory-bar-sugar"}),r.createElement("div",{style:o,className:"mito-inventory-bar-empty"}))}},{key:"mito",get:function(){return this.props.mito}},{key:"world",get:function(){return this.mito.world}},{key:"player",get:function(){return this.world.player}},{key:"inventory",get:function(){return this.player.inventory}}]),t}(r.Component),Mr=n(65),Cr=(r.Component,function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.props.parent.add(this.props.object)}},{key:"componentWillUnmount",value:function(){this.props.parent.remove(this.props.object)}}]),t}(r.PureComponent)),Sr=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).rafid=void 0,n.animate=function(e){n.props.a(e/1e3)},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.rafid=b.addAnimation(this.animate)}},{key:"componentWillUnmount",value:function(){this.rafid&&b.removeAnimation(this.rafid)}}]),t}(a.a.Component),Tr=Nn(function(){var e=new ce.PlaneBufferGeometry(1,1),t=new ce.EdgesGeometry(e,1),n=new ce.LineBasicMaterial({color:16777215,transparent:!0,opacity:.75}),r=new ce.LineSegments(t,n);return r.position.z=10,r}),Rr=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).object=Tr().clone(),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(Sr,{a:function(t){return e.object.scale.setScalar(.04*Math.sin(3.7*t)+.94)}}),r.createElement(Cr,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),Pr=Nn(function(){var e=new ce.CircleBufferGeometry(.1,20),t=new ce.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.75,side:ce.DoubleSide}),n=new ce.Mesh(e,t);return n.position.z=10,n}),Nr=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).object=Pr().clone(),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(Cr,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),Fr=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.mito.highlightedTile,t=this.props.mito.getHighlightPosition();return r.createElement(r.Fragment,null,r.createElement(wr,{tile:e}),r.createElement(Nr,{x:t.x,y:t.y,scene:this.scene}),this.maybeRenderTileHighlight(e))}},{key:"maybeRenderTileHighlight",value:function(e){if(e)return r.createElement(Rr,{x:e.pos.x,y:e.pos.y,scene:this.scene})}},{key:"scene",get:function(){return this.props.mito.scene}}]),t}(r.Component),Dr=function(){function e(t,n,r){Object(c.a)(this,e),this.mito=t,this.positionFn=n,this.renderFn=r}return Object(u.a)(e,[{key:"render",value:function(){var e=this.positionFn(),t=this.mito.worldToScreen(e),n={left:t.x,top:t.y};return r.createElement("div",{style:n},this.renderFn())}}]),e}(),Br=function(e){function t(e,n,r,a){var i;return Object(c.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).onWinLoss=a,i.world=void 0,i.scene=new ce.Scene,i.camera=new ce.OrthographicCamera(0,0,0,0,-100,100),i.cellBar=[rn,an,on,cn,sn],i.cellBarIndex=0,i.tutorialRef=null,i.mouse=new ce.Vector2,i.mouseDown=!1,i.mouseButton=-1,i.instructionsOpen=!1,i.firstActionTakenYet=!1,i.audioListener=new ce.AudioListener,i.keyMap=new Set,i.highlightedTile=void 0,i.events={contextmenu:function(e){return e.preventDefault(),!1},mousemove:function(e){i.mouse.x=e.clientX,i.mouse.y=e.clientY},click:function(){},mousedown:function(e){i.mouseButton=e.button,i.mouseDown=!0},mouseup:function(){i.mouseDown=!1},keydown:function(e){i.firstActionTakenYet=!0;var t=e.code;i.keyMap.add(t),e.repeat||i.handleKeyDown(t)},keyup:function(e){i.keyMap.delete(e.code)},wheel:function(e){if(e.shiftKey){var t=-(e.deltaX+e.deltaY)/125/20,n=i.camera.zoom*Math.pow(2,t);i.camera.zoom=n,i.camera.updateProjectionMatrix()}else e.deltaX+e.deltaY<0?i.setCellBarIndex(i.cellBarIndex-1):i.setCellBarIndex(i.cellBarIndex+1)}},i.worldRenderer=void 0,i.vignetteCapturer=new fr(Object(St.a)(i)),i.vignettes=[],i.handleKeyDown=function(e){"Slash"!==e?i.instructionsOpen?"Escape"===e&&(i.instructionsOpen=!1):null!=pr[e]&&(i.cellBarIndex=pr[e]):i.instructionsOpen=!i.instructionsOpen},i.worldDomElements=new Set,i.world=new Gt(r.targetHex.info.environment,r.settlingSpecies),i.camera.position.z=10,i.camera.lookAt(new ce.Vector3(0,0,0)),i.camera.position.x=i.world.player.pos.x,i.camera.position.y=i.world.player.pos.y,i.camera.zoom=1.5,i.camera.add(i.audioListener),i.worldRenderer=new hr(i.world,i.scene,Object(St.a)(i)),function(e){var t=0;function n(){3===++t&&(tt.audio.currentTime=0,nt.audio.currentTime=0,rt.audio.currentTime=0,tt.gain.connect(e.gain),nt.gain.connect(e.gain),rt.gain.connect(e.gain))}(tt=xt(e,ct.a)).audio.oncanplaythrough=n,tt.gain.gain.value=.5,(nt=xt(e,ht.a)).audio.oncanplaythrough=n,nt.gain.gain.value=0,(rt=xt(e,ft.a)).audio.oncanplaythrough=n,rt.gain.gain.value=0,(at=xt(e,vt.a)).gain.gain.value=0,at.gain.connect(e.gain),(it=xt(e,yt.a)).gain.gain.value=0,it.gain.connect(e.gain);var r=new ce.AudioLoader;r.load(wt.a,function(e){ot=e},function(e){},function(e){}),r.load(kt.a,function(e){st=e},function(e){},function(e){})}(i.audioContext),i.updateAmbientAudio(),i.attachWindowEvents(),window.mito=Object(St.a)(i),window.THREE=ce,i}return Object(f.a)(t,e),Object(u.a)(t,[{key:"selectedCell",get:function(){return this.cellBar[this.cellBarIndex]}}]),Object(u.a)(t,[{key:"attachWindowEvents",value:function(){var e=this;window.addEventListener("blur",function(){e.keyMap.clear()})}},{key:"setCellBarIndex",value:function(e){this.cellBarIndex=(e%this.cellBar.length+this.cellBar.length)%this.cellBar.length}},{key:"render",value:function(){var e=[],t=!0,n=!1,a=void 0;try{for(var i,o=this.worldDomElements[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;e.push(s.render())}}catch(l){n=!0,a=l}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}return r.createElement(r.Fragment,null,r.createElement(Ar,{mito:this}),r.createElement(gr,{mito:this}),r.createElement(Fr,{mito:this}),r.createElement("div",{className:"world-dom-components"},e))}},{key:"updateAmbientAudio",value:function(){var e=this.world.player.pos.y,t=Je(e,this.world.height/2,this.world.height,0,.5),n=Je(e,this.world.height/2,0,0,.5);rt.gain.gain.value=Math.max(0,t),nt.gain.gain.value=Math.max(0,n)}},{key:"logRenderInfo",value:function(){console.log("Geometries in memory: ".concat(this.renderer.info.memory.geometries,"\nTextures in memory: ").concat(this.renderer.info.memory.textures,"\nNumber of Programs: ").concat(this.renderer.info.programs.length,"\n# Render Calls: ").concat(this.renderer.info.render.calls,"\n# Render Lines: ").concat(this.renderer.info.render.lines,"\n# Render Points: ").concat(this.renderer.info.render.points,"\n# Render Tris: ").concat(this.renderer.info.render.triangles,"\n"))}},{key:"perfDebug",value:function(){var e=0,t=0;this.scene.traverse(function(n){n.matrixAutoUpdate?e++:t++}),console.log("matrixAutoUpdate: yes",e,", no",t);var n=new Map;this.scene.traverse(function(e){var t=n.get(e.name||e.constructor.name)||[];n.set(e.name||e.constructor.name,t),t.push(e)}),console.log(n)}},{key:"worldStep",value:function(e){if(this.firstActionTakenYet&&!this.instructionsOpen){if(this.world.step(e),this.vignetteCapturer.isTimeForNewCapture()){var t=this.vignetteCapturer.capture();this.vignettes.push(t)}this.tutorialRef&&this.tutorialRef.setState({time:this.world.time});var n=this.world.maybeGetGameResult();null!=n&&this.onWinLoss(n),this.updateAmbientAudio()}}},{key:"getCameraNormCoordinates",value:function(e,t){return new ce.Vector2(e/this.canvas.width*2-1,-t/this.canvas.height*2+1)}},{key:"getHighlightVector",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=new ce.Vector2(e-this.canvas.width/2,t-this.canvas.height/2);return n.setLength(.75),n}},{key:"getHighlightPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightVector(e,t),r=this.world.player.posFloat,a=r.x,i=r.y;return n.x+=a,n.y+=i,n}},{key:"getHighlightedTile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightPosition(e,t);n.round();var r=this.world.tileAt(n.x,n.y);if(null!=r&&r.lightAmount()>0)return r}},{key:"worldToScreen",value:function(e){var t=new ce.Vector3(e.x,e.y,0);return t.project(this.camera),t.x=Math.round((.5+t.x/2)*this.canvas.width),t.y=Math.round((.5-t.y/2)*this.canvas.height),t}},{key:"addWorldDOMElement",value:function(e,t){var n=new Dr(this,e,t);return this.worldDomElements.add(n),n}},{key:"removeWorldDOMElement",value:function(e){this.worldDomElements.delete(e)}},{key:"animate",value:function(e){if(!this.instructionsOpen){this.canvas.focus();var t=Math.min(1*e/30,10);if(fn.isRealtime){var n=this.keysToMovement(this.keyMap);n&&this.world.player.setAction(n);var r=!0,a=!1,i=void 0;try{for(var o,s=this.keyMap[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;mr[l]&&this.world.player.setAction(mr[l])}}catch(h){a=!0,i=h}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}this.mouseDown&&(0===this.mouseButton?this.handleLeftClick():2===this.mouseButton&&this.handleRightClick()),this.worldStep(t)}else null!=this.world.player.getAction()&&this.worldStep(t);this.worldRenderer.update(),this.highlightedTile=this.getHighlightedTile(),null!=this.highlightedTile&&this.worldRenderer.getOrCreateRenderer(this.highlightedTile).updateHover();var c=this.getCameraNormCoordinates(this.mouse.x,this.mouse.y),u=new ce.Vector2(this.world.player.posFloat.x+c.x/2,this.world.player.posFloat.y-c.y/2);qe(this.camera.position,u,.3),this.renderer.render(this.scene,this.camera),Boolean(Object(_e.parse)(window.location.search).debug)&&this.frameCount%100===0&&this.logRenderInfo()}}},{key:"keysToMovement",value:function(e){var t=new ce.Vector2,n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;vr[s]&&t.add(vr[s].dir)}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return 0===t.x&&0===t.y?null:{type:"move",dir:t}}},{key:"resize",value:function(e,t){var n=t/e;this.camera.left=-12/n,this.camera.right=12/n,this.camera.top=-12,this.camera.bottom=12,this.camera.updateProjectionMatrix()}},{key:"handleRightClick",value:function(){var e=this.getHighlightedTile();if(null!=e){if(e instanceof sn)return;this.world.player.setAction({type:"deconstruct",position:e.pos})}}},{key:"handleLeftClick",value:function(){this.firstActionTakenYet=!0;var e=this.getHighlightedTile();if(null!=e)if(Ft(e)){var t={type:"interact",interactable:e};this.world.player.setAction(t)}else if(this.world.player.isBuildCandidate(e)){var n=[];if(this.selectedCell===cn){var r=this.getHighlightVector().setLength(1).round();n.push(r)}var a={type:"build",cellType:this.selectedCell,position:e.pos.clone(),args:n};this.world.player.setAction(a)}}}]),t}(Cn);Br.id="mito",Br.expansionTiles=[rn,on,un];var Wr=Br;n(135);function Ir(){return r.createElement("div",{className:"glow"},r.createElement("span",null))}function Lr(e){var t=e.fruit;return r.createElement("div",{className:"fruit-info"},r.createElement("div",{className:"fruit-visual"},t.isMature()?r.createElement(Ir,null):null,r.createElement("img",{alt:"",src:Wn.a})),t.isMature()?r.createElement(r.Fragment,null,r.createElement("span",{className:"matured-info success"},"Matured"),"\xa0at ",t.timeMatured,", Mutation Points earned: 1"):r.createElement("span",{className:"matured-info in-progress"},(100*t.getPercentMatured()).toFixed(0),"% maturity"),", started ",t.timeMade,".")}function zr(e){var t=e.results,n=t.fruits.filter(function(e){return e.isMature()});return r.createElement(r.Fragment,null,r.createElement("div",{className:"character-party-container"},r.createElement(R,{size:"large"})),r.createElement("h1",null,"You ",n.length>=3?"thrived":"survived","!"),r.createElement("h2",null,n.length," Mutation Points earned."),r.createElement("h5",null,"Fruit Made"),r.createElement("div",{className:"fruit-list"},t.fruits.map(function(e){return r.createElement(Lr,{fruit:e})})))}function Yr(e){var t=e.results;return r.createElement(r.Fragment,null,r.createElement("h1",null,"You died!"),r.createElement("div",null,"You survived until ",Wt(t.world.season),"!"))}function Gr(e){var t=e.onDone,n=e.results;return r.createElement("div",{className:"game-results-screen ".concat(n.status)},r.createElement("div",{className:"game-results-content"},"won"===n.status?r.createElement(zr,{onDone:t,results:n}):r.createElement(Yr,{onDone:t,results:n}),r.createElement("button",{className:"done-button",onClick:t},"Continue \u2192")))}var Vr=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handleMousePosition=function(e){n.setState({mousePosition:{x:e.clientX,y:e.clientY}})},n.handlePopulationAttempt=function(e,t,r){if(e.info.visible){if(null!=r&&null!=r.info.flora&&r.info.flora.actionPoints<1)return;var a={settlingSpecies:t,sourceHex:r,targetHex:e};n.setState({activePopulationAttempt:a})}},n.handleNextEpoch=function(){n.state.overWorld.resetActionPoints();var e=!0,t=!1,r=void 0;try{for(var a,i=ye(n.state.rootSpecies)[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;o.freeMutationPoints=o.totalMutationPoints}}catch(s){t=!0,r=s}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}n.setState({epoch:n.state.epoch+1})},n.handleWinLoss=function(e){if(null==n.state.activePopulationAttempt)throw new Error("activePopulationAttempt shouldn't be null during handleWinLoss");n.setState({activeGameResult:e}),"won"===e.status&&n.doPopulationAttemptSuccess(n.state.activePopulationAttempt,e)},n.handleResultsDone=function(){n.setState({activePopulationAttempt:void 0,activeGameResult:void 0})},n.otherArgsSelector=Object(We.a)(function(e){return e.activePopulationAttempt},function(e){return[e,n.handleWinLoss]});var r=An.generateRectangle(100,50),a=pe("plantum originus");return n.state={overWorld:r,rootSpecies:a,epoch:1,mousePosition:{x:window.innerWidth/2,y:window.innerHeight/2}},n.doPopulationAttemptSuccess({settlingSpecies:a,targetHex:r.getStartTile()},{status:"won",mutationPointsPerEpoch:1,fruits:[],world:null}),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("mousemove",this.handleMousePosition)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.handleMousePosition)}},{key:"doPopulationAttemptSuccess",value:function(e,t){var n=e.targetHex,r=e.sourceHex,a=e.settlingSpecies;null!=r&&(r.info.flora.actionPoints-=1);var i=void 0;null!=n.info.flora&&(i=n.info.flora.species),n.info.flora={species:a,mutationPointsPerEpoch:t.mutationPointsPerEpoch,actionPoints:0},a.totalMutationPoints=this.state.overWorld.getMaxGenePool(a),i&&(i.totalMutationPoints=this.state.overWorld.getMaxGenePool(i));var o=!0,s=!1,l=void 0;try{for(var c,u=n.neighbors[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){c.value.info.visible=!0}}catch(h){s=!0,l=h}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}}},{key:"render",value:function(){return a.a.createElement(m.Provider,{value:this.state.mousePosition},a.a.createElement("div",{className:"App"},this.maybeRenderOverWorld(),this.maybeRenderInGame(),this.maybeRenderGameResult()))}},{key:"maybeRenderOverWorld",value:function(){if(null==this.state.activePopulationAttempt)return a.a.createElement(Be,{epoch:this.state.epoch,overWorld:this.state.overWorld,rootSpecies:this.state.rootSpecies,onPopulationAttempt:this.handlePopulationAttempt,onNextEpoch:this.handleNextEpoch})}},{key:"maybeRenderInGame",value:function(){if(null!=this.state.activePopulationAttempt&&null==this.state.activeGameResult)return a.a.createElement(Pn,{sketchClass:Wr,otherArgs:this.otherArgsSelector(this.state)})}},{key:"maybeRenderGameResult",value:function(){if(null!=this.state.activeGameResult)return a.a.createElement(Gr,{results:this.state.activeGameResult,onDone:this.handleResultsDone})}}]),t}(a.a.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(136),n(137);var Hr=function(){function e(t){Object(c.a)(this,e),this.visitors=t,this.trials=[]}return Object(u.a)(e,[{key:"recordDataFor",value:function(e){var t=function(e,t){for(var n=Array.from(e.environmentTiles()),r={},a=0,i=Object.entries(t);a<i.length;a++){var o=i[a],s=Object(p.a)(o,2),l=s[0],c=(0,s[1])(n,e);r[l]=c}return r}(e,this.visitors);this.trials.push(t)}},{key:"visitorNames",value:function(){return Object.keys(this.visitors)}}]),e}(),Ur=function(){function e(t){Object(c.a)(this,e),this.experiments=t}return Object(u.a)(e,[{key:"recordDataFor",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.experiments[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.recordDataFor(e)}}catch(o){n=!0,r=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}}]),e}();function Zr(e,t){console.log("running");for(var n=new Ur([new Hr({countAir:function(e){return e.filter(function(e){return e.constructor===Jt}).length}}),new Hr({countSoil:function(e){return e.filter(function(e){return e.constructor===Xt}).length}}),new Hr({countRock:function(e){return e.filter(function(e){return e.constructor===Qt}).length}}),new Hr({countFountain:function(e){return e.filter(function(e){return e.constructor===$t}).length}}),new Hr({playerY:function(e,t){return t.player.pos.y}}),new Hr({startAdjacentWaters:function(e,t){var n=function(e,t){var n,r=new Set,a=!0,i=!1,o=void 0;try{for(var s,l=e.entities()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(c instanceof Zt&&(n=c,e.player.isWalkable(n))){var u=!0,h=!1,d=void 0;try{for(var f,m=e.tileNeighbors(c.pos)[Symbol.iterator]();!(u=(f=m.next()).done);u=!0){var v=f.value,y=Object(p.a)(v,2)[1];y instanceof rn||y.isObstacle||(null==t?r.add(y):t(y)&&r.add(y))}}catch(g){h=!0,d=g}finally{try{u||null==m.return||m.return()}finally{if(h)throw d}}}}}catch(g){i=!0,o=g}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r}(t,function(e){return e instanceof Xt}),r=0,a=!0,i=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;At(c)&&(r+=c.inventory.water)}}catch(u){i=!0,o=u}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r}}),new Hr({countWaters:function(e){return e.reduce(function(e,t){return e+(At(t)?t.inventory.water:0)},0)}})]),r=0;r<20;r++){console.time("trial "+r);var a=new Gt(e(),pe());n.recordDataFor(a),console.timeEnd("trial "+r)}!function(e,t){var n=[],r=e.map(function(e){return e.visitorNames().join("")});for(var a in r){for(var i=r[a],o=[],s=[],l=0;l<e[0].trials.length;l++){o.push(l);var c=e[a],u=c.trials[l],h=u[i];s.push(h)}var d={x:o,y:s,name:i,type:"bar"};n.push(d)}var f=document.createElement("div");document.getElementById(t).appendChild(f),window.Plotly.newPlot(f,n,{barmode:"stack"})}(n.experiments.slice(0,4),t);var i=!0,o=!1,s=void 0;try{for(var l,c=n.experiments[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){Kr(l.value,t)}}catch(u){o=!0,s=u}finally{try{i||null==c.return||c.return()}finally{if(o)throw s}}}function Kr(e,t){var n=[],r={},a=!0,i=!1,o=void 0;try{for(var s,l=function(){var t=s.value;u={x:e.trials.map(function(e){return e[t]}),type:"histogram",name:t},n.push(u),r.title={text:t}},c=e.visitorNames()[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var u;l()}}catch(d){i=!0,o=d}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}var h=document.createElement("div");document.getElementById(t).appendChild(h),h.style.height="240px",h.style.width="320px",h.style.display="inline-block",window.Plotly.newPlot(h,n,r)}var qr=function(){return a.a.useEffect(function(){var e=document.createElement("script");e.src="https://cdn.plot.ly/plotly-latest.min.js",e.addEventListener("load",function(){Zr(yn,"temperate"),Zr(wn,"rocky"),Zr(gn,"desert")}),document.body.appendChild(e)},[]),a.a.createElement("div",null,a.a.createElement("h1",null,"Experiments"),a.a.createElement("div",{id:"temperate"},a.a.createElement("h2",null,"Temperate")),a.a.createElement("div",{id:"rocky"},a.a.createElement("h2",null,"Rocky")),a.a.createElement("div",{id:"desert"},a.a.createElement("h2",null,"Desert")))};o.a.render(a.a.createElement(s.a,null,a.a.createElement(l.d,null,a.a.createElement(l.b,{path:"/test-win"},a.a.createElement(function(){var e=new Gt(yn(),pe());e.time=150;var t=new sn(new ce.Vector2(0,0),e);t.committedResources.add(50,50),t.timeMatured=250,e.time=479;var n=new sn(new ce.Vector2(0,0),e);n.committedResources.add(25,15),e.time=1296;var r=new sn(new ce.Vector2(0,0),e);r.committedResources.add(50,50);var i={status:"won",fruits:[t,n,r],mutationPointsPerEpoch:2,world:e};return a.a.createElement(Gr,{results:i,onDone:function(){}})},null)),a.a.createElement(l.b,{path:"/test-stats"},a.a.createElement(qr,null)),a.a.createElement(l.b,{exact:!0,path:"/"},a.a.createElement(Vr,null)),a.a.createElement(l.b,{path:"*"},a.a.createElement(l.a,{to:"/"})))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},33:function(e,t,n){e.exports=n.p+"static/media/fruit.e136487f.png"},50:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAACC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KD0UqkwAAAM1JREFUKBVjYBgowIjL4v50+/8wucKZB7GqwxCEadJSkYfpZbh25yGYjW4IimaQRpimSbL8cM15jz+C2SBDkA1ggqtAYiBrBAmj82FK4TbDbF2qowSWe/vxLUwNgzC/MJgdfeUe2Asw27HajKwRpAudDzMVq2aYJCGaepr5JSH+hfkRZjOMD5OHicMDDCSAHmgwRSAaPbBAYhjOBpmehQhokBowH91WkDiKzSABWAqztHUEccHg+OH9YBoWRVBhTM0wCZghID66JpgaimgAWfxCZhIsrg0AAAAASUVORK5CYII="},56:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAFJklEQVRIS62We2xTVRzHv+e2ty0bfa223VMjMEjWTXyuBmOIsCiYIGCMRpYoiSYIGjSOmGE0gCSogcnDR0biwIQoCmqmLg4msP2xBLYYQmCj4GOKjLmue/Tlut3b3mPOvbT3di2tiTt/9fZ3ft/+fp/z7e9cgv+wpt4nFD7A9Bkl+bbn3SDshqriA/hDyJmTX7B7JSVn25XCZkOQ6YjdKyla2sEfzl0d25u1Qi0zzyflFJJKrv+VQZKLaYaguBs0le4DFteUQppWFS9wfujIzS1ZEKQEaa+5k9RGHhG7V1CcPZFiVrOoBPuqpuTn1/qNuPDQ3dCdU+PskJK5GS2roiqzo2230R19elnw7YUC6p8cJ2L34xQtP8pMtWJZGXZ13kFPBubKAkvMUTQOJABJpfBBtQFdgQI5XmcLYfmjg2nYMhhuPeaha0qikKZFtEcd+PqPsTSGa+c58ExFFJFoHB3RIuxceym7IO2x9BFvuJoJPuscg5MXcWCoGK3XxnG4JiZXtP6CCUxwc+kwAiKPowEH3n26nyRzszC0fH8maFl1KmiFw12IZYnr6IuK2HVZYbi1UkCN3Yjjo0WwOubgvrgfdfbQD6Q2/ETSGWnl0nPmhq5J+56OUbMcX2oN45fYNJqv8fLzhnIB1UWFOBUoTDFcZgltIQ9GmjIEaY/lC+INr2MtP1UcAp+I45uwC8cHRrFrnmKbRp9Bbnl9RRDBSYq2sENmmMxNa5n2WPzEG3YzwRfcAbh5EbsGS9F6fQKt90zKgqt7FYZvlg/BL/Jo8TuTDOXcTIY9ls9PBy3rToessDsLsFS6AV9UwHs+heEbCwR47Ca0jtlhsZvwgOTHcluYdVafnWGPZVtX1La9Y0xhyHx2ZVLAx38qgi9XCPAUFSLp0+XWEBPcTrzhHdkYniLecJ1sG/cECiHiSKgEx34fxUcLFdtsumSUW95YMYbxGPBt2Il31sgM5dyZDIeJN1zMBF90j8AlMyzDsZ9HcGKFiFW9JllUYXgDIyKPT/2uJEM5NwtDc/OZkHUD86G1yISH8TcuRwQ0XVVaZqvlfg5t43bMtRpRiwDqbMGDxBt5KTvDXuuezoi14aebDB+zhXA1No39A4oPN98u4AYpQTyujDPGeJkt0kRqQ1syGfZaL5La0F2s5eddo7Dp4zg4UY6vfgvgiEexTf15xTY6HYd6xwi+DLmxY/VFQm/mZrTMvmCCz7lGYdfHsX+oGMfPj0Bv06VaZoKvlg7LMbbYfzkVzHYFnO4op4yh2WbEEoxgU7+UNm2a79XjZNCKArMBkxEhtyDtMTdX91o2SII6/xoqRTT9qjB8/U4Be/8ygiY0t0TD0C3Hl3z0VftKqTSl3iGckcN3ixWGzDqE50BFNX6lcTh3y/MbnZTXMItHJOjNXApTYlKCrkB9ziuYrULtrZe3Qs+HZTQtwcCBCmpLMwWInoDGVYaEI6CaO4dU7S+jUiyRaokzcZjJMFeFGT8wv9FFeZvKJIPZPxJ0hWpcilFwc9RzYI7gDOrz7FfoOVCWZhNi5EA1rx7EQEA1viQ8ARVVhtARQOPL2a9wwVsuqp+r9RmFrkBlkohR6LTMpik4oxpn1bKqU9Nm1k+5ijHU2saogzStsZGBg5TLlzqS9t+efYaV29w0jdEUBWe6tc+oCBBl+MiLxgGi3hCY/Qq105Z9rm6uoJqXYuUtXGO7mfv7Nl7PPb6q9mbOw5zTZmueebhoZzHVMpnJiCYAol4xuJJP8P9W+C+xZd+qpRkU/AAAAABJRU5ErkJggg=="},57:function(e,t,n){e.exports=n.p+"static/media/mito-base.28ee2cbb.mp3"},58:function(e,t,n){e.exports=n.p+"static/media/mito-strings.9f30639c.mp3"},59:function(e,t,n){e.exports=n.p+"static/media/mito-drums.1c82b4f4.mp3"},60:function(e,t,n){e.exports=n.p+"static/media/footsteps.636605b0.wav"},61:function(e,t,n){e.exports=n.p+"static/media/build.a2067d20.wav"},62:function(e,t,n){e.exports=n.p+"static/media/Blop-Mark_DiAngelo-79054334.627c0e8b.mp3"},63:function(e,t,n){e.exports=n.p+"static/media/suckwater.b0fe81fa.wav"},64:function(e,t,n){e.exports=n.p+"static/media/roguelikeSheet_transparent.3c15bcea.png"},71:function(e,t,n){e.exports=n(143)},78:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){}},[[71,1,2]]]);
//# sourceMappingURL=main.ae07f044.chunk.js.map