(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){},101:function(e,t,n){},102:function(e,t,n){},103:function(e,t,n){},104:function(e,t,n){},105:function(e,t,n){},123:function(e,t,n){},124:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){},135:function(e,t,n){},136:function(e,t,n){},137:function(e,t,n){},138:function(e,t,n){},139:function(e,t,n){},140:function(e,t,n){},141:function(e,t,n){},142:function(e,t,n){},148:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(31),o=n.n(i),s=(n(81),n(71)),l=n(25),c=n(9),u=n(4),h=n(3),d=n(7),f=n(5),m=n(6),v=a.a.createContext({x:window.innerWidth/2,y:window.innerHeight/2});var p=function(){return Object(r.useContext)(v)},y=n(10),g=n(15),b=n(8),w=n(28),E=n.n(w),k=Object(b.a)({id:Object(b.c)(),name:Object(b.g)(),genes:Object(b.d)(Object(b.g)()),freeMutationPoints:Object(b.g)(),totalMutationPoints:Object(b.g)()});function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"newBaseSpecies";return{id:E()(),name:e,genes:[],freeMutationPoints:0,totalMutationPoints:0,descendants:[]}}function j(e){var t=[];t.push(e);var n=!0,r=!1,a=void 0;try{for(var i,o=e.descendants[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;t.push.apply(t,Object(g.a)(j(s)))}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}k.props.descendants=Object(b.d)(Object(b.f)(k)),k.props.parent=Object(b.h)(k);var x=a.a.createContext(null);function A(){return Object(r.useContext)(x)}function M(e,t){switch(t.type){case"AANewSpecies":return Object(y.a)({},e);case"AAStartPopulationAttempt":return function(e,t){var n=t.populationAttempt,r=n.targetHex,a=n.sourceHex;if(!r.info.visible)return e;if(null!=a&&null!=a.info.flora&&a.info.flora.actionPoints<1)return e;return Object(y.a)({},e,{activePopulationAttempt:t.populationAttempt})}(e,t);case"AAPopulationAttemptSuccess":return C(e,t);case"AANextEpoch":return function(e,t){e.overWorld.resetActionPoints();var n=!0,r=!1,a=void 0;try{for(var i,o=j(e.rootSpecies)[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;s.freeMutationPoints=s.totalMutationPoints}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return Object(y.a)({},e,{epoch:e.epoch+1})}(e);case"AAGetGameResult":return function(e,t){if(null==e.activePopulationAttempt)throw new Error("activePopulationAttempt shouldn't be null during handleWinLoss");"won"===t.result.status&&(e=C(e,{type:"AAPopulationAttemptSuccess",attempt:e.activePopulationAttempt,results:t.result}));return Object(y.a)({},e,{activeGameResult:t.result})}(e,t);case"AAGameResultDone":return function(e,t){return Object(y.a)({},e,{activePopulationAttempt:void 0,activeGameResult:void 0})}(e)}}function C(e,t){var n=t.attempt,r=void 0===n?e.activePopulationAttempt:n,a=t.results,i=r.targetHex,o=r.sourceHex,s=r.settlingSpecies;null!=o&&(o.info.flora.actionPoints-=1);var l=void 0;null!=i.info.flora&&(l=i.info.flora.species),i.info.flora={species:s,mutationPointsPerEpoch:a.mutationPointsPerEpoch,actionPoints:0},s.totalMutationPoints=e.overWorld.getMaxGenePool(s),l&&(l.totalMutationPoints=e.overWorld.getMaxGenePool(l));var c=!0,u=!1,h=void 0;try{for(var d,f=e.overWorld.hexNeighbors(i)[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){d.value.info.visible=!0}}catch(m){u=!0,h=m}finally{try{c||null==f.return||f.return()}finally{if(u)throw h}}return Object(y.a)({},e)}var S=n(20),T=n(21),R=(n(41),function(){function e(t,n,r){Object(u.a)(this,e),this.x=t,this.y=n,this.z=r}return Object(h.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,n){return this.x*e+this.y*t+this.z*n}}]),e}()),P=[new R(1,1,0),new R(-1,1,0),new R(1,-1,0),new R(-1,-1,0),new R(1,0,1),new R(-1,0,1),new R(1,0,-1),new R(-1,0,-1),new R(0,1,1),new R(0,-1,1),new R(0,1,-1),new R(0,-1,-1)],N=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],F=.5*(Math.sqrt(3)-1),D=(3-Math.sqrt(3))/6,B=1/6,W=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2147483647*Math.random();Object(u.a)(this,e),this.perm=new Array(512),this.gradP=new Array(512),this.octaveNum=6,this.octaveFalloff=.5,this.octaveMatrix2=[2*Math.cos(1),2*-Math.sin(1),2*Math.sin(1),2*Math.cos(1)],this.seed(t)}return Object(h.a)(e,[{key:"seed",value:function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?N[t]^255&e:N[t]^e>>8&255,this.perm[t]=this.perm[t+256]=n,this.gradP[t]=this.gradP[t+256]=P[n%12]}}}]),Object(h.a)(e,[{key:"simplex2",value:function(e,t){var n,r,a=(e+t)*F,i=Math.floor(e+a),o=Math.floor(t+a),s=(i+o)*D,l=e-i+s,c=t-o+s;l>c?(n=1,r=0):(n=0,r=1);var u=l-n+D,h=c-r+D,d=l-1+2*D,f=c-1+2*D;i&=255,o&=255;var m=this.gradP[i+this.perm[o]],v=this.gradP[i+n+this.perm[o+r]],p=this.gradP[i+1+this.perm[o+1]],y=.5-l*l-c*c,g=.5-u*u-h*h,b=.5-d*d-f*f;return 70*((y<0?0:(y*=y)*y*m.dot2(l,c))+(g<0?0:(g*=g)*g*v.dot2(u,h))+(b<0?0:(b*=b)*b*p.dot2(d,f)))}},{key:"octaveSimplex2",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.octaveNum,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveFalloff,a=0,i=e,o=t,s=1,l=0;l<n;l++){a+=this.simplex2(i,o)*s;var c=i*this.octaveMatrix2[0]+o*this.octaveMatrix2[1],u=i*this.octaveMatrix2[2]+o*this.octaveMatrix2[3];i=c,o=u,s*=r}return a}},{key:"simplex3",value:function(e,t,n){var r,a,i,o,s,l,c=(e+t+n)*(1/3),u=Math.floor(e+c),h=Math.floor(t+c),d=Math.floor(n+c),f=(u+h+d)*B,m=e-u+f,v=t-h+f,p=n-d+f;m>=v?v>=p?(r=1,a=0,i=0,o=1,s=1,l=0):m>=p?(r=1,a=0,i=0,o=1,s=0,l=1):(r=0,a=0,i=1,o=1,s=0,l=1):v<p?(r=0,a=0,i=1,o=0,s=1,l=1):m<p?(r=0,a=1,i=0,o=0,s=1,l=1):(r=0,a=1,i=0,o=1,s=1,l=0);var y=m-r+B,g=v-a+B,b=p-i+B,w=m-o+2*B,E=v-s+2*B,k=p-l+2*B,O=m-1+.5,j=v-1+.5,x=p-1+.5;u&=255,h&=255,d&=255;var A=this.gradP,M=this.perm,C=A[u+M[h+M[d]]],S=A[u+r+M[h+a+M[d+i]]],T=A[u+o+M[h+s+M[d+l]]],R=A[u+1+M[h+1+M[d+1]]],P=.6-m*m-v*v-p*p,N=.6-y*y-g*g-b*b,F=.6-w*w-E*E-k*k,D=.6-O*O-j*j-x*x;return 32*((P<0?0:(P*=P)*P*C.dot3(m,v,p))+(N<0?0:(N*=N)*N*S.dot3(y,g,b))+(F<0?0:(F*=F)*F*T.dot3(w,E,k))+(D<0?0:(D*=D)*D*R.dot3(O,j,x)))}},{key:"octaveSimplex3",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveNum,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.octaveFalloff,i=0,o=e,s=t,l=n,c=1,u=0;u<r;u++)i+=this.simplex3(o,s,l)*c,o*=2,s*=2,l*=2,c*=a;return i}},{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,n){return(1-n)*e+n*t}},{key:"perlin2",value:function(e,t){var n=Math.floor(e),r=Math.floor(t);e-=n,t-=r,n&=255,r&=255;var a=this.gradP,i=this.perm,o=a[n+i[r]].dot2(e,t),s=a[n+i[r+1]].dot2(e,t-1),l=a[n+1+i[r]].dot2(e-1,t),c=a[n+1+i[r+1]].dot2(e-1,t-1),u=this.fade(e);return this.lerp(this.lerp(o,l,u),this.lerp(s,c,u),this.fade(t))}},{key:"perlin3",value:function(e,t,n){var r=this.gradP,a=this.perm,i=Math.floor(e),o=Math.floor(t),s=Math.floor(n);e-=i,t-=o,n-=s;var l=r[(i&=255)+a[(o&=255)+a[s&=255]]].dot3(e,t,n),c=r[i+a[o+a[s+1]]].dot3(e,t,n-1),u=r[i+a[o+1+a[s]]].dot3(e,t-1,n),h=r[i+a[o+1+a[s+1]]].dot3(e,t-1,n-1),d=r[i+1+a[o+a[s]]].dot3(e-1,t,n),f=r[i+1+a[o+a[s+1]]].dot3(e-1,t,n-1),m=r[i+1+a[o+1+a[s]]].dot3(e-1,t-1,n),v=r[i+1+a[o+1+a[s+1]]].dot3(e-1,t-1,n-1),p=this.fade(e),y=this.fade(t),g=this.fade(n);return this.lerp(this.lerp(this.lerp(l,d,p),this.lerp(c,f,p),g),this.lerp(this.lerp(u,m,p),this.lerp(h,v,p),g),y)}}]),e}();function I(e,t,n){return e+(t-e)*n}function L(e,t,n){e.x=e.x*(1-n)+t.x*n,e.y=e.y*(1-n)+t.y*n}function z(e,t,n,r,a){return I(r,a,(e-t)/(n-t))}function G(e,t,n){return e<t?t:e>n?n:e}function Y(e){var t=Math.floor(e),n=e-t;return t+(Math.random()<n?1:0)}var V=n(30),H={isRealtime:!0,environment:"Temperate",cellEnergyMax:6750,tissueInventoryCapacity:6,rootTurnsPerTransfer:40,leafReactionRate:.01,leafSugarPerReaction:1,cellGestationTurns:20,cellDiffusionWater:.002,cellDiffusionSugar:.002,soilDarknessBase:.2,soilDiffusionWater:.001,veinDiffusion:.5,soilMaxWater:20,droop:.03,fountainTurnsPerWater:11,fountainAppearanceRate:1.5,transportTurnsPerMove:5,sunlightReintroduction:.15,sunlightDiffusion:0,maxResources:100},U=Object(y.a)({},H),Z=Object(V.parse)(window.location.search);if(null!=Z.params){var J=JSON.parse(Z.params);Object.assign(U,J)}function K(){for(var e={},t=0,n=Object.keys(H);t<n.length;t++){var r=n[t],a=U[r];a!==H[r]&&(e[r]=a)}if(Object.keys(e).length>0){var i=Object(V.stringify)(Object(y.a)({},Object(V.parse)(window.location.search),{params:JSON.stringify(e)}));window.location.search=i}}K();var q=n(23),X=n(12);function Q(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}var _=function(e){return e.substr(0,1).toLocaleUpperCase()+e.substr(1)};var $=Object.keys({carryCapacity:0,energyEfficiency:0,photosynthesis:0,rootAbsorption:0,structuralStability:0,activeTransportSugar:0,activeTransportWater:0,walkSpeed:0,diffuseWater:0,diffuseSugar:0,buildTime:0,heatTolerant:0,coldTolerant:0,fruitGrowthSpeed:0,fruitMutationPoints:0,fruitNeededResources:0});function ee(e){for(var t=e.split(/([A-Z])+/g),n=_(t[0]),r=1;r<t.length;r+=2)n+=" "+t[r]+t[r+1];return n}function te(e,t){for(var n in t)e[n]=(r=(e[n]||0)+t[n])<-3?-3:r>3?3:r;var r}function ne(e){var t={carryCapacity:0,energyEfficiency:0,photosynthesis:0,rootAbsorption:0,structuralStability:0,activeTransportSugar:0,activeTransportWater:0,walkSpeed:0,diffuseWater:0,diffuseSugar:0,buildTime:0,heatTolerant:0,coldTolerant:0,fruitGrowthSpeed:0,fruitMutationPoints:0,fruitNeededResources:0},n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){te(t,re(i.value))}}catch(s){r=!0,a=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}function re(e){var t={},n=ae(e[0]);null!=n&&(t[n]=1);var r=ae(e[1]);return null!=r&&(t[r]=-1),t}function ae(e){switch(e){case"AA":return"walkSpeed";case"AC":return"energyEfficiency";case"AG":return"photosynthesis";case"AT":return"rootAbsorption";case"CA":return"carryCapacity";case"CC":return"activeTransportSugar";case"CG":return"activeTransportWater";case"CT":return"structuralStability";case"GA":return"diffuseSugar";case"GC":return"diffuseWater";case"GG":return"buildTime";case"GT":return"heatTolerant";case"TA":return"coldTolerant";case"TC":return"fruitGrowthSpeed";case"TG":return"fruitMutationPoints";case"TT":return"fruitNeededResources"}}function ie(e,t,n){return t*Math.pow(n,e)}var oe=n(2),se={nw:new oe.Vector2(-1,-1),w:new oe.Vector2(-1,0),sw:new oe.Vector2(-1,1),n:new oe.Vector2(0,-1),s:new oe.Vector2(0,1),ne:new oe.Vector2(1,-1),e:new oe.Vector2(1,0),se:new oe.Vector2(1,1)},le=Object.keys(se).map(function(e){return se[e]}),ce=n(32);function ue(e){return Math.round(1e12*e)/1e12}var he=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(u.a)(this,e),this.capacity=t,this.carrier=n,this.water=r,this.sugar=a,this.events=void 0,this.validate()}return Object(h.a)(e,[{key:"isEmpty",value:function(){return 0===this.water&&0===this.sugar}},{key:"give",value:function(e,t,n){if(e===this)throw new Error("shouldn't give to self");if(0===t&&0===n)return{water:0,sugar:0};var r=Math.min(t,this.water),a=Math.min(n,this.sugar),i=ue(r+a),o=e.space();return i>o&&(r=Math.floor(r/i*o),a=Math.floor(a/i*o)),this.change(-r,-a),e.change(r,a),this.events&&this.events.emit("give",e,r,a),e.events&&e.events.emit("get",this,r,a),{water:r,sugar:a}}},{key:"on",value:function(e,t){this.events=this.events||new ce.EventEmitter,this.events.on(e,t)}},{key:"off",value:function(e,t){this.events=this.events||new ce.EventEmitter,this.events.off(e,t)}},{key:"add",value:function(e,t){var n=ue(e+t),r=this.space();n>r&&(e=e/n*r,t=t/n*r),this.change(e,t)}},{key:"change",value:function(e,t){var n=ue(this.water+e),r=ue(this.sugar+t);this.validate(n,r),this.water=n,this.sugar=r,this.water<0&&(this.water=0),this.sugar<0&&(this.sugar=0),this.water+this.sugar>this.capacity&&(this.water>this.sugar?this.water=this.capacity-this.sugar:this.sugar=this.capacity-this.water)}},{key:"space",value:function(){return ue(this.capacity-this.water-this.sugar)}},{key:"isMaxed",value:function(){return this.space()<1}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.water,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sugar,n=this.capacity;e<0&&console.warn("water < 0: ".concat(e)),t<0&&console.warn("sugar < 0: ".concat(t)),e+t>n&&console.warn("bad inventory: ".concat(e," water + ").concat(t," > ").concat(n," max"))}}]),e}();function de(e){return null!=e&&e.inventory instanceof he}function fe(e,t){var n=e instanceof t.constructor||t instanceof e.constructor,r=e instanceof ut&&t instanceof ut,a=function(e,t,n,r){return e instanceof t&&n instanceof r}(e,it,t,at);return n||r||a}var me,ve=n(75),pe=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(m.a)(t,e),t}(Object(ve.a)(Error));function ye(e){return"function"===typeof e.interact}!function(e){e.Scorching="Scorching",e.Hot="Hot",e.Mild="Mild",e.Cold="Cold",e.Freezing="Freezing"}(me||(me={}));var ge=n(16),be=n(14),we=n.n(be);var Ee,ke,Oe,je,xe,Ae,Me,Ce=n(29),Se=n(56),Te=n.n(Se),Re=n(57),Pe=n.n(Re),Ne=n(58),Fe=n.n(Ne),De=n(59),Be=n.n(De),We=n(60),Ie=n.n(We),Le=n(61),ze=n.n(Le),Ge=n(62),Ye=n.n(Ge);function Ve(e){var t=e.substr(e.length-3),n=document.createElement("source");return n.src=e,n.type="audio/".concat(t),n}function He(e){var t=document.createElement("audio");t.autoplay=!0,t.loop=!0;for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var i=0,o=r;i<o.length;i++){var s=o[i];t.appendChild(Ve(s))}var l=e.createMediaElementSource(t),c=e.createGain();return l.connect(c),{audio:t,gain:c}}var Ue=function(){function e(t,n){Object(u.a)(this,e),this.posFloat=t,this.world=n,this.inventory=new he(U.maxResources,this,Math.round(U.maxResources/3),Math.round(U.maxResources/3)),this.action=void 0,this.events=new ce.EventEmitter,this.mapActions=void 0,this.baseSpeed=void 0,this.dtSinceLastStepped=0,this.baseSpeed=ie(n.traits.walkSpeed,.15,1.5)}return Object(h.a)(e,[{key:"speed",get:function(){var e=this.currentTile();return this.baseSpeed*(e instanceof ut?e.tempo:1)}},{key:"pos",get:function(){return this.posFloat.clone().round()}}]),Object(h.a)(e,[{key:"shouldStep",value:function(){return!0}},{key:"setAction",value:function(e){null!=this.action?this.action={type:"multiple",actions:[this.action,e]}:this.action=e}},{key:"getAction",value:function(){return this.action}},{key:"droopY",value:function(){var e=this.world.tileAt(this.pos.x,this.pos.y);return e instanceof ut?e.droopY:0}},{key:"droopPosFloat",value:function(){var e=this.droopY();if(0!==e){var t=this.posFloat.clone();return t.y+=e,t}return this.posFloat}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"step",value:function(e){if(void 0===this.action&&(this.action={type:"none"}),this.mapActions){var t=this.mapActions(this,this.action);this.action=null!=t?t:{type:"none"}}var n=this.attemptAction(this.action,e);this.maybeMoveWithTransports(e),this.posFloat.lerp(this.pos,.05*e),n&&this.events.emit("action",this.action),this.action=void 0}},{key:"maybeMoveWithTransports",value:function(e){var t=this.currentTile();t instanceof yt&&this.posFloat.add(t.dir.clone().setLength(.15*this.speed*e))}},{key:"attemptAction",value:function(e,t){switch(e.type){case"none":return!0;case"still":return this.attemptStill(t);case"move":return this.attemptMove(e,t);case"build":return this.attemptBuild(e,t);case"deconstruct":return this.attemptDeconstruct(e,t);case"drop":return this.attemptDrop(e,t);case"pickup":return this.attemptPickup(e,t);case"multiple":return this.attemptMultiple(e,t);case"interact":return this.attemptInteract(e,t)}}},{key:"verifyMove",value:function(e,t){var n=this.posFloat.clone().add(e.dir.clone().setLength(this.speed*t)).round();return this.isWalkable(n)}},{key:"isWalkable",value:function(e){if(e instanceof nt&&(e=e.pos),!this.world.isValidPosition(e.x,e.y))return!1;var t=this.world.tileAt(e.x,e.y);return t instanceof ut&&null!=t&&!t.isObstacle&&(!(t instanceof ut)||null==t.findEffectOfType(ct))}},{key:"isBuildCandidate",value:function(e,t){return null!=e&&!e.isObstacle&&(!(e instanceof ut)||null==e.findEffectOfType(ct)&&!!(e instanceof dt&&t===yt))}},{key:"attemptMove",value:function(e,t){return!!this.verifyMove(e,t)&&(je.gain.gain.cancelScheduledValues(0),je.gain.gain.value=.5,je.gain.gain.linearRampToValueAtTime(0,je.gain.context.currentTime+.05),this.posFloat.add(e.dir.clone().setLength(this.speed*t)),!0)}},{key:"attemptStill",value:function(e){return!0}},{key:"tryConstructingNewCell",value:function(e,t,n){e=e.clone();var r=this.world.tileAt(e.x,e.y);if(null!=r&&!(r instanceof vt)){if(!(r instanceof t&&!(t===yt&&r instanceof yt))&&!r.isObstacle&&this.inventory.water>=1&&this.inventory.sugar>=1){this.inventory.add(-1,-1);var a=Object(Ce.a)(t,[e,this.world].concat(Object(g.a)(n)));return a.args=n,xe.audio.currentTime=0,xe.gain.gain.cancelScheduledValues(0),xe.gain.gain.value=.2,xe.gain.gain.exponentialRampToValueAtTime(1e-4,xe.gain.context.currentTime+.5),a}}}},{key:"argsEq",value:function(e,t){var n=this;return typeof e===typeof t&&(null==e&&null==t||(e instanceof oe.Vector2&&t instanceof oe.Vector2?e.equals(t):e instanceof Array&&t instanceof Array?e.every(function(r,a){return n.argsEq(e[a],t[a])}):void 0))}},{key:"isMeaningfulBuild",value:function(e,t){return t.constructor!==e.cellType||!this.argsEq(e.args,t.args)}},{key:"attemptBuild",value:function(e,t){var n=this.world.cellAt(e.position.x,e.position.y);if(null!=n&&!this.isMeaningfulBuild(e,n))return!0;n&&this.attemptDeconstruct({type:"deconstruct",position:e.position,force:!0},t);var r,a=this.tryConstructingNewCell(e.position,e.cellType,e.args);return null!=a&&((r=e.cellType.turnsToBuild?new ht(e.position,this.world,a):a).droopY=this.droopY(),this.world.setTileAt(e.position,r),!0)}},{key:"attemptDeconstruct",value:function(e,t){if(!e.position.equals(this.pos)||e.force){var n=this.world.maybeRemoveCellAt(e.position);if(null!=n){var r=n.energy/U.cellEnergyMax;return this.inventory.add(r,r),!0}}return!1}},{key:"attemptDrop",value:function(e,t){var n=this.currentTile();if(de(n)){var r=e.water*t,a=e.sugar*t;return n.inventory.give(this.inventory,a,r),this.inventory.give(n.inventory,r,a),!0}return!1}},{key:"attemptPickup",value:function(e,t){var n=this.currentTile();de(n)&&n.inventory.give(this.inventory,e.water*t,e.sugar*t);return!0}},{key:"attemptMultiple",value:function(e,t){var n=!0,r=!0,a=!1,i=void 0;try{for(var o,s=e.actions[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;n=this.attemptAction(l,t)&&n}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}},{key:"attemptInteract",value:function(e,t){return e.interactable.interact(t)}}]),e}(),Ze=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(u.a)(this,e),this.deleted=t,this.added=n};var Je=["Spring","Summer","Fall","Winter"];function Ke(e){return"".concat(Je[e.season],", Month ").concat(e.month)}var qe=27e3,Xe=qe/4,Qe=Xe/3,_e=Qe/3,$e=function(){function e(t,n){var r=this;Object(u.a)(this,e),this.environment=t,this.time=0,this.frame=0,this.width=50,this.height=100,this.player=void 0,this.gridEnvironment=void 0,this.gridCells=void 0,this.neighborCache=void 0,this.wipResult=void 0,this.species=void 0,this.traits=void 0,this.cachedEntities=void 0,this.stepStats=new Ze,this.temperatureScale={0:{day:60,night:40},1:{day:80,night:60},2:{day:65,night:31},3:{day:40,night:0}},this.wipResult={fruits:[],world:this},this.species=n,this.traits=ne(this.species.genes),ut.diffusionWater=ie(this.traits.diffuseWater,U.cellDiffusionWater,2),ut.diffusionSugar=ie(this.traits.diffuseSugar,U.cellDiffusionSugar,2),ut.turnsToBuild=Math.floor(ie(this.traits.buildTime,U.cellGestationTurns,.5)),this.player=new Ue(new oe.Vector2(this.width/2,this.height/2),this),this.gridEnvironment=new Array(this.width).fill(void 0).map(function(e,n){return new Array(r.height).fill(void 0).map(function(e,a){var i,o=new oe.Vector2(n,a),s=!0,l=!1,c=void 0;try{for(var u,h=zt[t.fill][Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=(0,u.value)(o,r);if(null!=d){i=d;break}}}catch(f){l=!0,c=f}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return null==i&&(i=new at(o,r)),i})});var a=this.player.pos.x,i=this.gridEnvironment[a].find(function(e){return!(e instanceof at)});i&&(this.player.posFloat.y=i.pos.y);this.gridCells=new Array(this.width).fill(void 0).map(function(e,t){return new Array(r.height).fill(void 0).map(function(e,n){var a=new oe.Vector2(t,n);return r.player.pos.distanceTo(a)<2.5?(r.gridEnvironment instanceof ot&&(r.gridEnvironment[t][n]=new it(new oe.Vector2(t,n),0,r)),new dt(a,r)):null})}),this.neighborCache=new Array(this.width).fill(void 0).map(function(e,t){return new Array(r.height).fill(void 0).map(function(e,n){return r.computeTileNeighbors(t,n)})}),this.fillCachedEntities();for(var o=0;o<this.width;o++)for(var s=0;s<this.height;s++){var l=this.gridEnvironment[o][s];l&&l.step(0);var c=this.gridCells[o][s];c&&c.step(0)}}return Object(h.a)(e,[{key:"season",get:function(){return e=this.time,{season:Math.floor(e/Xe),percent:e%Xe/Xe,month:Math.floor(e%Xe/Qe)+1};var e}}]),Object(h.a)(e,[{key:"tileAt",value:function(e,t){var n;if(e instanceof oe.Vector2?(n=e.x,t=e.y):(n=e,t=t),!this.isValidPosition(n,t))return null;var r=this.gridCells[n][t];return null!=r?r:this.gridEnvironment[n][t]}},{key:"cells",value:function(){var e=this.gridCells,t=this.width,n=this.height;return Object(ge.a)({},Symbol.iterator,we.a.mark(function r(){var a,i,o;return we.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:a=0;case 1:if(!(a<t)){r.next=14;break}i=0;case 3:if(!(i<n)){r.next=11;break}if(null==(o=e[a][i])){r.next=8;break}return r.next=8,o;case 8:i++,r.next=3;break;case 11:a++,r.next=1;break;case 14:case"end":return r.stop()}},r)}))}},{key:"cellAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridCells[e][t]:null}},{key:"environmentTileAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridEnvironment[e][t]:null}},{key:"setTileAt",value:function(e,t){var n=e.x,r=e.y;if(!this.isValidPosition(n,r))throw new Error("invalid position ".concat(n,", ").concat(r," "));t instanceof vt&&this.wipResult.fruits.push(t);var a=this.tileAt(n,r);de(a)&&(a.redistributeInventoryToNeighbors(),0===a.inventory.water&&0===a.inventory.sugar||(console.warn("lost",a.inventory,"resources to building"),a.inventory.add(-a.inventory.water,-a.inventory.sugar)));var i=this.gridCells[n][r];if(null!=i&&this.stepStats.deleted.push(i),t instanceof ut)this.gridCells[n][r]=t;else{this.gridCells[n][r]=null;var o=this.gridEnvironment[n][r];null!=o&&this.stepStats.deleted.push(o),this.gridEnvironment[n][r]=t}this.stepStats.added.push(t),this.handleTileUpdated(e)}},{key:"maybeRemoveCellAt",value:function(e){var t=this.cellAt(e.x,e.y);return t&&(t.redistributeInventoryToNeighbors(),this.gridCells[e.x][e.y]=null,this.stepStats.deleted.push(t)),this.handleTileUpdated(e),t}},{key:"isValidPosition",value:function(e,t){return!(e>=this.width||e<0||t>=this.height||t<0)}},{key:"tileNeighbors",value:function(e){return this.neighborCache[e.x][e.y]}},{key:"computeTileNeighbors",value:function(e,t){var n=this,r=new Map;return et[this.frame%et.length].forEach(function(a){var i=e+a.x,o=t+a.y,s=n.tileAt(i,o);null!=s&&r.set(a,s)}),r}},{key:"entities",value:function(){if(null==this.cachedEntities)throw new Error("accessed entities before filling");return this.cachedEntities}},{key:"handleTileUpdated",value:function(e){this.neighborCache[e.x][e.y]=this.computeTileNeighbors(e.x,e.y);var t=!0,n=!1,r=void 0;try{for(var a,i=le[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,s=e.x+o.x,l=e.y+o.y;this.isValidPosition(s,l)&&(this.neighborCache[s][l]=this.computeTileNeighbors(s,l))}}catch(c){n=!0,r=c}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}this.fillCachedEntities()}},{key:"fillCachedEntities",value:function(){var e=[],t=0,n=0;for(t=0;t<this.width;t++)for(n=(t+this.frame)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));for(t=0;t<this.width;t++)for(n=(t+this.frame+1)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));this.frame%4<2&&e.reverse(),e.push(this.player),this.cachedEntities=e}},{key:"step",value:function(e){var t=this.entities();return this.stepStats=new Ze,t.forEach(function(t){"function"===typeof t.step&&function(e,t){var n=e.dtSinceLastStepped+t;if(e.shouldStep(n))try{e.step(n)}catch(r){if(!(r instanceof pe))throw r}finally{e.dtSinceLastStepped=0}else e.dtSinceLastStepped=n}(t,e)}),this.updateTemperatures(e),this.computeSunlight(e),this.stepWeather(e),this.frame++,this.time+=e,this.fillCachedEntities(),this.stepStats}},{key:"getLastStepStats",value:function(){return this.stepStats}},{key:"stepWeather",value:function(e){if((this.time+this.environment.climate.turnsBetweenRainfall-200)%this.environment.climate.turnsBetweenRainfall<this.environment.climate.rainDuration)for(;e>0;){var t=Math.min(e,1),n=oe.Math.randInt(0,this.width-1),r=this.tileAt(n,0);r instanceof at&&r.inventory.add(Y(this.environment.climate.waterPerDroplet*t),0),e-=1}}},{key:"getCurrentTemperature",value:function(){var e=this.season.season,t=this.temperatureScale[e],n=t.day,r=t.night;return z(this.sunAmount,0,1,r,n)}},{key:"computeSunlight",value:function(e){for(var t=this.sunAngle,n=Math.sin(t+Math.PI/2),r=this.sunAmount,a=0;a<=.6*this.height;a++)for(var i=0;i<this.width;i++){var o=this.environmentTileAt(i,a);if(o instanceof at){var s=0;if(0===a)s=1;else{var l=this.tileAt(i,a-1),c=this.tileAt(i+1,a-1),u=this.tileAt(i-1,a-1),h=l instanceof at?l.sunlightCached/r:null==l?1:0,d=c instanceof at?c.sunlightCached/r:null==c?1:0,f=u instanceof at?u.sunlightCached/r:null==u?1:0;s=(s=n>0?d*n+h*(1-n):f*-n+h*(1- -n))*(1-U.sunlightDiffusion)+(h+d+f)/3*U.sunlightDiffusion}s=U.sunlightReintroduction+s*(1-U.sunlightReintroduction),s*=r,o.sunlightCached=s}}}},{key:"updateTemperatures",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.cells()[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;o.temperatureFloat=o.nextTemperature}}catch(s){n=!0,r=s}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"maybeGetGameResult",value:function(){if(this.tileAt(this.player.pos.x,this.player.pos.y)instanceof st)return Object(y.a)({},this.wipResult,{mutationPointsPerEpoch:0,status:"lost"});if(this.time<qe)return null;var e=this.wipResult.fruits.filter(function(e){return e.isMature()});return 0===e.length?Object(y.a)({},this.wipResult,{mutationPointsPerEpoch:0,status:"lost"}):Object(y.a)({},this.wipResult,{mutationPointsPerEpoch:e.length*ie(this.traits.fruitMutationPoints,1,1.5),status:"won"})}},{key:"checkResources",value:function(){this.entities().forEach(function(e){de(e)&&(e.inventory.sugar,e.inventory.water),tt(e)&&e.energy})}},{key:"environmentTiles",value:function(){var e=this;return Object(ge.a)({},Symbol.iterator,we.a.mark(function t(){var n,r,a,i,o,s,l,c,u,h,d,f;return we.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,r=!1,a=void 0,t.prev=3,i=e.gridEnvironment[Symbol.iterator]();case 5:if(n=(o=i.next()).done){t.next=36;break}s=o.value,l=!0,c=!1,u=void 0,t.prev=10,h=s[Symbol.iterator]();case 12:if(l=(d=h.next()).done){t.next=19;break}return f=d.value,t.next=16,f;case 16:l=!0,t.next=12;break;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(10),c=!0,u=t.t0;case 25:t.prev=25,t.prev=26,l||null==h.return||h.return();case 28:if(t.prev=28,!c){t.next=31;break}throw u;case 31:return t.finish(28);case 32:return t.finish(25);case 33:n=!0,t.next=5;break;case 36:t.next=42;break;case 38:t.prev=38,t.t1=t.catch(3),r=!0,a=t.t1;case 42:t.prev=42,t.prev=43,n||null==i.return||i.return();case 45:if(t.prev=45,!r){t.next=48;break}throw a;case 48:return t.finish(45);case 49:return t.finish(42);case 50:case"end":return t.stop()}},t,null,[[3,38,42,50],[10,21,25,33],[26,,28,32],[43,,45,49]])}))}},{key:"sunAngle",get:function(){return this.time*Math.PI*2/_e}},{key:"dayOrNight",get:function(){return this.sunAngle%(2*Math.PI)<Math.PI?"day":"night"}},{key:"sunAmount",get:function(){return Math.atan(12*Math.sin(this.sunAngle))/(Math.PI/2)*.5+.5}}]),e}(),et=[Q(le.slice()),Q(le.slice()),Q(le.slice()),Q(le.slice()),Q(le.slice())];function tt(e){return"number"===typeof e.energy}var nt=function(){function e(t,n){if(Object(u.a)(this,e),this.world=n,this.isObstacle=!1,this.darkness=1/0,this.temperatureFloat=void 0,this.dtSinceLastStepped=0,this.inventory=void 0,this.timeMade=void 0,this.pos=void 0,this.pos=t.clone(),null==n)throw new Error("null world!");this.timeMade=n.time,this.temperatureFloat=this.world.getCurrentTemperature()}return Object(h.a)(e,[{key:"temperature",get:function(){return(e=this.temperatureFloat)<=0?me.Freezing:e<=32?me.Cold:e<=64?me.Mild:e<=96?me.Hot:me.Scorching;var e}},{key:"diffusionWater",get:function(){return this.constructor.diffusionWater}},{key:"diffusionSugar",get:function(){return this.constructor.diffusionSugar}},{key:"fallAmount",get:function(){return this.constructor.fallAmount}},{key:"age",get:function(){return this.world.time-this.timeMade}}]),Object(h.a)(e,[{key:"lightAmount",value:function(){return Math.sqrt(Math.min(Math.max(z(1-this.darkness,0,1,0,1),0),1))}},{key:"redistributeInventoryToNeighbors",value:function(){var e=this;if(this.inventory.water>0||this.inventory.sugar>0)for(var t=this.world.tileNeighbors(this.pos),n=Array.from(t.values()).filter(function(t){return fe(t,e)});!this.inventory.isEmpty()&&n.length>0;){Q(n);for(var r=0;r<n.length;r++){var a=n[r];if(this.inventory.give(a.inventory,1,1),a.inventory.isMaxed&&n.splice(r,1),this.inventory.isEmpty())break}}}},{key:"step",value:function(e){var t=this.world.tileNeighbors(this.pos);this.stepDarkness(t,e),this.stepDiffusion(t,e),this.stepTemperature(e),this.stepGravity(e)}},{key:"stepTemperature",value:function(e){this.temperatureFloat=this.world.getCurrentTemperature()}},{key:"stepDarkness",value:function(e,t){if(this instanceof ut)this.darkness=0;else{var n=this.darkness,r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value,u=Object(c.a)(l,2)[1],h=Math.max(.2,z(this.pos.y,this.world.height/2,this.world.height,U.soilDarknessBase,1)),d=u instanceof ot?1/0:u.darkness+h;n=u instanceof ut?0:Math.min(n,d)}}catch(f){a=!0,i=f}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}this.darkness=n}}},{key:"stepDiffusion",value:function(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=e.values()[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;this.canDiffuse(s)&&(null!=this.diffusionWater&&s.inventory.water>this.inventory.water&&this.diffuseWater(s,t),null!=this.diffusionSugar&&s.inventory.sugar>this.inventory.sugar&&this.diffuseSugar(s,t))}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}}},{key:"canDiffuse",value:function(e){return fe(this,e)}},{key:"diffuseWater",value:function(e,t){var n=(e.inventory.water-this.inventory.water)*this.diffusionWater*t;e.inventory.give(this.inventory,Y(n),0)}},{key:"diffuseSugar",value:function(e,t){var n=(e.inventory.sugar-this.inventory.sugar)*this.diffusionSugar*t;e.inventory.give(this.inventory,0,Y(n))}},{key:"stepGravity",value:function(e){var t=this.fallAmount*e,n=this.world.tileAt(this.pos.x,this.pos.y+1);t>0&&null!=n&&fe(n,this)&&this.inventory.give(n.inventory,Y(t),0)}}]),e}();nt.displayName="Tile",nt.fallAmount=0;var rt=new W,at=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(d.a)(this,Object(f.a)(t).call(this,e,n))).pos=e,r.sunlightCached=1,r._co2=void 0,r.inventory=new he(20,Object(X.a)(r)),r.darkness=0,r._co2=r.computeCo2(),r}return Object(m.a)(t,e),Object(h.a)(t,[{key:"shouldStep",value:function(e){return e>3}},{key:"computeCo2",value:function(){var e=z(this.pos.y,this.world.height/2,0,this.world.environment.floorCo2,1.15),t=z(this.pos.y,this.world.height/2,0,4,9),n=null==this.world?0:this.world.time,r=.25*rt.perlin3(94.231+(this.pos.x-this.world.width/2)/t,2312+this.pos.y/8,n/1e3+93.1);return Math.max(Math.min(e+r,1),Math.min(.4,.75*this.world.environment.floorCo2))}},{key:"lightAmount",value:function(){return this.sunlight()}},{key:"step",value:function(e){this.stepGravity(e),this.stepDiffusionCheap(e),this.stepEvaporation(e),this.stepTemperature(e),this._co2=this.computeCo2()}},{key:"stepDiffusionCheap",value:function(e){var t=this.world.tileAt(this.pos.x-1,this.pos.y),n=this.world.tileAt(this.pos.x+1,this.pos.y);Math.random()<.5?(this.tryDiffuse(t,e),this.tryDiffuse(n,e)):(this.tryDiffuse(n,e),this.tryDiffuse(t,e))}},{key:"tryDiffuse",value:function(e,t){null!=e&&this.canDiffuse(e)&&e.inventory.water>this.inventory.water&&this.diffuseWater(e,t)}},{key:"stepEvaporation",value:function(e){Math.random()<.01*this.inventory.water*e&&this.inventory.add(-1,0)}},{key:"co2",value:function(){return this._co2}},{key:"sunlight",value:function(){return this.sunlightCached}}]),t}(nt);at.displayName="Air",at.fallAmount=1,at.diffusionWater=.1;var it=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this,e,a))).inventory=new he(U.soilMaxWater,Object(X.a)(n)),n.inventory.add(r,0),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"fallAmount",get:function(){return this.world.environment.waterGravityPerTurn}}]),Object(h.a)(t,[{key:"shouldStep",value:function(e){return e>10}},{key:"step",value:function(e){Object(q.a)(Object(f.a)(t.prototype),"step",this).call(this,e),this.stepEvaporation(e)}},{key:"stepEvaporation",value:function(e){var t=this.world.environment,n=t.evaporationRate,r=t.evaporationBottom,a=z(this.pos.y,this.world.height/2,this.world.height*r,1,0),i=this.inventory.water;Math.random()<n*a*i*e&&this.inventory.add(-1,0)}}]),t}(nt);it.displayName="Soil",it.diffusionWater=U.soilDiffusionWater;var ot=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).isObstacle=!0,n.inventory=new he(0,Object(X.a)(n)),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"shouldStep",value:function(e){return e>10}}]),t}(nt);ot.displayName="Rock";var st=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).inventory=new he(0,Object(X.a)(n)),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"shouldStep",value:function(e){return e>10}}]),t}(nt);st.displayName="Dead Cell";var lt=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this,e,r,a))).turnsPerWater=i,n.isObstacle=!0,n.cooldown=0,n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"step",value:function(e){Object(q.a)(Object(f.a)(t.prototype),"step",this).call(this,e),this.cooldown>0&&(this.cooldown-=e),this.inventory.space()>1&&this.cooldown<=0&&(this.inventory.add(1,0),this.cooldown=this.turnsPerWater)}}]),t}(it);lt.displayName="Fountain";var ct=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).turnsToDie=2e3,n.percentFrozen=.5,n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"interact",value:function(e){return this.percentFrozen-=20/this.turnsToDie*e,this.onFrozenChanged(),!0}},{key:"step",value:function(e){throw this.cell.temperature===me.Cold?this.percentFrozen+=1/this.turnsToDie*e:this.cell.temperature===me.Freezing?this.percentFrozen+=10/this.turnsToDie*e:this.percentFrozen-=10/this.turnsToDie*e,this.onFrozenChanged(),new pe}},{key:"onFrozenChanged",value:function(){this.percentFrozen>1?this.cell.die():this.percentFrozen<0&&this.remove()}},{key:"turnsUntilDeath",get:function(){return this.turnsToDie-this.age}}]),t}(function(){function e(){Object(u.a)(this,e),this.timeMade=void 0,this.cell=void 0}return Object(h.a)(e,[{key:"attachTo",value:function(e){this.cell=e,this.timeMade=this.cell.world.time}},{key:"remove",value:function(){var e=this.cell.effects.indexOf(this);this.cell.effects.splice(e,1)}},{key:"age",get:function(){return this.cell.world.time-this.timeMade}}]),e}());ct.displayName="Frozen",ct.stacks=!1;var ut=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(d.a)(this,Object(f.a)(t).call(this,e,n))).energy=U.cellEnergyMax,r.darkness=0,r.nextTemperature=void 0,r.droopY=0,r.args=[],r.effects=[],r.temperatureFloat=48,r.nextTemperature=r.temperatureFloat,r}return Object(m.a)(t,e),Object(h.a)(t,[{key:"tempo",get:function(){return this.temperatureFloat<=0?.5:this.temperatureFloat<=32?2/3:this.temperatureFloat<=64?1:this.temperatureFloat<=96?1.5:2}}]),Object(h.a)(t,[{key:"addEffect",value:function(e){(e.constructor.stacks||null==this.findEffectOfType(e.constructor))&&(e.attachTo(this),this.effects.push(e))}},{key:"findEffectOfType",value:function(e){return this.effects.find(function(t){return t.constructor===e})}},{key:"interact",value:function(e){var t=!1,n=!0,r=!1,a=void 0;try{for(var i,o=this.effects[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;if(ye(s)){var l=s.interact(e);t=t||l}}}catch(c){r=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}},{key:"die",value:function(){this.world.setTileAt(this.pos,new st(this.pos,this.world))}},{key:"isHungry",value:function(){return this.energy<.95*U.cellEnergyMax}},{key:"shouldStep",value:function(e){return e>3}},{key:"step",value:function(e){var n=this.tempo;Object(q.a)(Object(f.a)(t.prototype),"step",this).call(this,e),this.energy-=1*n*e;var r=!0,a=!1,i=void 0;try{for(var o,s=this.effects[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value.step(e)}}catch(v){a=!0,i=v}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}var l=this.world.tileNeighbors(this.pos),c=Array.from(l.values());if(this.isHungry()&&this.stepEatSugar(this),this.isHungry())for(var u=0,h=c;u<h.length;u++){var d=h[u];if(this.stepEatSugar(d),!this.isHungry())break}if(this.isHungry()){var m=c.filter(function(e){return tt(e)});this.stepEqualizeEnergy(m,n,e)}this.stepDroop(l,e),this.droopY>.5&&this.pos.y<this.world.height-1&&(this.world.player.pos.equals(this.pos)&&(this.world.player.pos.y+=1),this.world.maybeRemoveCellAt(this.pos),this.pos.y+=1,this.droopY-=1,this.world.setTileAt(this.pos,this)),this.energy<=0&&this.die()}},{key:"stepEatSugar",value:function(e){if(!(e instanceof vt)){var t=U.cellEnergyMax-this.energy,n=ie(this.world.traits.energyEfficiency,1/U.cellEnergyMax,1/1.5),r=Math.min(t*n,e.inventory.sugar);if(t>100&&r>0){e.inventory.add(0,-r);var a=r/n;return this.energy+=a,!0}}return!1}},{key:"stepEqualizeEnergy",value:function(e,t,n){var r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;if(!this.isHungry())break;var c=l.energy-this.energy;if(c>20){var u=.125*t*n,h=Math.floor(c*G(u,0,.5));this.energy+=h,l.energy-=h}}}catch(d){a=!0,i=d}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}},{key:"stepTemperature",value:function(e){var t=this.world.tileNeighbors(this.pos);if(this.nextTemperature=function(e,t,n){var r=e.temperatureFloat,a=r,i=!0,o=!1,s=void 0;try{for(var l,c=t.values()[Symbol.iterator]();!(i=(l=c.next()).done);i=!0)a+=l.value.temperatureFloat}catch(u){o=!0,s=u}finally{try{i||null==c.return||c.return()}finally{if(o)throw s}}return I(r,a/=t.size+1,.2*n)}(this,t,e),this.temperatureFloat<=32){var n=ie(this.world.traits.coldTolerant,this.temperature===me.Cold?.001:.01,1/1.5)*e;Math.random()<n&&this.addEffect(new ct)}else if(this.temperatureFloat>=64){var r=ie(this.world.traits.heatTolerant,this.temperature===me.Hot?.001:.01,1/1.5)*e;Math.random()<r&&this.inventory.add(Math.max(-1,this.inventory.water),0)}}},{key:"stepDroop",value:function(e,n){var r=e.get(se.s),a=e.get(se.sw),i=e.get(se.se),o=e.get(se.w),s=e.get(se.e),l=e.get(se.n),c=e.get(se.nw),u=e.get(se.ne),h=ie(this.world.traits.structuralStability,U.droop,1/1.5)*n;this.droopY+=h,this.energy<U.cellEnergyMax/2&&(this.droopY+=h);for(var d=!1,f=0,m=[r,a,i];f<m.length;f++){var v=m[f];if(v instanceof ot||v instanceof it)return void(this.droopY=Math.min(this.droopY,0));if(v instanceof t)return this.droopY=Math.min(this.droopY,v.droopY),void(d=!0)}var p=[c,l,u,o,s,this].filter(function(e){return e instanceof t});d||1!==p.length?this.droopY=p.reduce(function(e,t){return e+t.droopY},0)/p.length:this.droopY+=1}}]),t}(nt);ut.displayName="Cell",ut.diffusionWater=U.cellDiffusionWater,ut.diffusionSugar=U.cellDiffusionSugar,ut.turnsToBuild=U.cellGestationTurns;var ht=function(e){function t(e,n,r){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(f.a)(t).call(this,e,n))).completedCell=r,a.isObstacle=!0,a.timeRemaining=void 0,a.timeToBuild=void 0,a.inventory=new he(0,Object(X.a)(a)),a.timeRemaining=a.timeToBuild=r.constructor.turnsToBuild||0,a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"step",value:function(e){Object(q.a)(Object(f.a)(t.prototype),"step",this).call(this,e),this.timeRemaining-=1*this.tempo*e,this.timeRemaining<=0&&this.world.setTileAt(this.completedCell.pos,this.completedCell)}}]),t}(ut),dt=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(d.a)(this,Object(f.a)(t).call(this,e,n))).inventory=void 0,r.inventory=new he(Math.floor(ie(n.traits.carryCapacity,U.tissueInventoryCapacity,1.5)),Object(X.a)(r)),r}return Object(m.a)(t,e),t}(ut);dt.displayName="Tissue";var ft=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).isObstacle=!0,n.averageEfficiency=0,n.averageSpeed=0,n.sugarConverted=0,n.tilePairs=[],n.totalSugarProduced=0,n.inventory=new he(0,Object(X.a)(n)),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"step",value:function(e){Object(q.a)(Object(f.a)(t.prototype),"step",this).call(this,e);var n=this.world.tileNeighbors(this.pos);this.averageEfficiency=0,this.averageSpeed=0,this.sugarConverted=0;var r=0;this.tilePairs=[];var a=!0,i=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var u=s.value,h=Object(c.a)(u,2),d=h[0],m=h[1],v=this.world.tileAt(this.pos.x-d.x,this.pos.y-d.y);if(m instanceof at&&v instanceof dt){r+=1,this.tilePairs.push(d);var p=m,y=v,g=p.sunlight(),b=p.co2();this.averageEfficiency+=b,this.averageSpeed+=g;var w=ie(this.world.traits.photosynthesis,.01,1.5)*this.tempo,E=U.leafSugarPerReaction/b,k=Math.min(y.inventory.water,E),O=g*w*k*e/E;if(Math.random()<O){var j=k*b;y.inventory.add(-k,j),this.sugarConverted+=j,this.totalSugarProduced+=j}}}}catch(x){i=!0,o=x}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}r>0&&(this.averageEfficiency/=r)}}]),t}(ut);ft.displayName="Leaf";var mt=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).isObstacle=!0,n.activeNeighbors=[],n.inventory=new he(U.tissueInventoryCapacity,Object(X.a)(n)),n.cooldown=0,n.totalSucked=0,n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"interact",value:function(e){Object(q.a)(Object(f.a)(t.prototype),"interact",this).call(this,e);var n=this.world.player;return this.inventory.give(n.inventory,.25,0),!0}},{key:"step",value:function(e){Object(q.a)(Object(f.a)(t.prototype),"step",this).call(this,e),this.cooldown<=0&&(this.stepWaterTransfer(e),this.cooldown+=ie(this.world.traits.rootAbsorption,U.rootTurnsPerTransfer,1/1.5)),this.cooldown-=1*this.tempo*e}},{key:"stepWaterTransfer",value:function(e){this.activeNeighbors=[];var t=this.world.tileNeighbors(this.pos),n=!1,r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value,u=Object(c.a)(l,2),h=u[0],d=u[1];if(d instanceof it&&(this.activeNeighbors.push(h),!n)){var f=d.inventory.give(this.inventory,1,0).water;this.totalSucked+=f,f>0&&(n=!0)}}}catch(m){a=!0,i=m}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}}]),t}(ut);mt.displayName="Root";var vt=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(d.a)(this,Object(f.a)(t).call(this,e,n))).isObstacle=!0,r.inventory=new he(8,Object(X.a)(r)),r.neededResources=void 0,r.committedResources=void 0,r.timeMatured=void 0,r.turnsToMature=void 0,r.handleGetResources=function(){null==r.timeMatured&&r.isMature()&&(r.timeMatured=r.world.time,r.committedResources.off("get",r.handleGetResources))},r.neededResources=2*Math.ceil(ie(n.traits.fruitNeededResources,100,1/1.5)/2),r.committedResources=new he(r.neededResources,Object(X.a)(r)),r.committedResources.on("get",r.handleGetResources),r.turnsToMature=Math.ceil(ie(n.traits.fruitGrowthSpeed,Xe/3*2,1/1.5)),r}return Object(m.a)(t,e),Object(h.a)(t,[{key:"oneTurnCommitMax",get:function(){return this.neededResources/this.turnsToMature}}]),Object(h.a)(t,[{key:"step",value:function(e){Object(q.a)(Object(f.a)(t.prototype),"step",this).call(this,e);var n=1*e*this.tempo,r=this.world.tileNeighbors(this.pos),a=!0,i=!1,o=void 0;try{for(var s,l=r[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var u=s.value,h=Object(c.a)(u,2)[1];if(h instanceof ut&&!(h instanceof t)){var d=Math.min(this.neededResources/2-this.committedResources.water,n),m=Math.min(this.neededResources/2-this.committedResources.sugar,n);h.inventory.give(this.inventory,d,m)}}}catch(v){i=!0,o=v}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}this.commitResources(e)}},{key:"commitResources",value:function(e){var t=Math.min(this.neededResources/2-this.committedResources.water,this.oneTurnCommitMax/2*e*this.tempo),n=Math.min(this.neededResources/2-this.committedResources.sugar,this.oneTurnCommitMax/2*e*this.tempo);this.inventory.give(this.committedResources,t,n)}},{key:"getPercentMatured",value:function(){var e=this.committedResources;return(e.sugar+e.water)/e.capacity}},{key:"isMature",value:function(){return this.committedResources.water+this.committedResources.sugar>=this.neededResources-1}}]),t}(ut);function pt(e){return e%1!==0}vt.displayName="Fruit",vt.turnsToBuild=0;var yt=function(e){function t(e,n,r){var a;if(Object(u.a)(this,t),(a=Object(d.a)(this,Object(f.a)(t).call(this,e,n))).dir=r,a.cooldownWater=0,a.cooldownSugar=0,pt(r.x)||pt(r.y))throw new Error("build transport with fractional dir "+r.x+", "+r.y);return a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"step",value:function(e){Object(q.a)(Object(f.a)(t.prototype),"step",this).call(this,e),this.energy-=1*this.tempo*e;var n=0,r=0;if(this.cooldownWater<=0){n++;var a=Math.floor(ie(this.world.traits.activeTransportWater,20,1/1.5));this.cooldownWater+=a}if(this.cooldownSugar<=0){r++;var i=Math.floor(ie(this.world.traits.activeTransportSugar,20,1/1.5));this.cooldownSugar+=i}if(n>0||r>0){var o=this.getTarget();o&&this.inventory.give(o.inventory,n,r);var s=this.getFrom();s&&s.inventory.give(this.inventory,n,r)}this.cooldownWater-=1*e*this.tempo,this.cooldownSugar-=1*e*this.tempo}},{key:"getTarget",value:function(){var e=this.world.tileAt(this.pos.x+this.dir.x,this.pos.y+this.dir.y);if(e instanceof ut)return e}},{key:"getFrom",value:function(){var e=this.world.tileAt(this.pos.x-this.dir.x,this.pos.y-this.dir.y);if(e instanceof ut)return e}}]),t}(dt);yt.displayName="Transport";var gt=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).inventory=new he(8,Object(X.a)(n)),n}return Object(m.a)(t,e),Object(h.a)(t,null,[{key:"diffusionWater",get:function(){return U.veinDiffusion}},{key:"diffusionSugar",get:function(){return U.veinDiffusion}}]),t}(dt);gt.displayName="Vein";var bt,wt,Et,kt,Ot,jt,xt,At,Mt,Ct,St,Tt,Rt,Pt,Nt,Ft,Dt,Bt=Object(b.a)({climate:Object(b.f)(Object(b.a)({"*":!0})),"*":!0}),Wt=new W,It=new W,Lt=new W,zt={Temperate:[function(e,t){var n=e.x,r=e.y,a=t.height/2-4*(Lt.perlin2(0,n/5)+1)/2-16*Lt.perlin2(10,n/20+10),i=z(r-t.height/2,0,t.height/2,-.7,.3),o=It.simplex2(n/5,r/5)<i;if(r>a){if(o)return new ot(e,t);var s=Math.pow(z(r-t.height/2,0,t.height/2,.5,1),2),l=Wt.simplex2(.2*n,.2*r)+.2,c=Math.round(Math.max(1,Math.min(20,l>.4?20*s:0)));if(s*l>1/U.fountainAppearanceRate){var u=Math.min(s*l,1);return new lt(e,c,t,Math.round(U.fountainTurnsPerWater/u))}return new it(e,c,t)}}],Desert:[function(e,t){var n=e.x,r=e.y,a=t.height/2-2*(Lt.perlin2(0,n/20)+1)/2-3*Lt.perlin2(10,n/100+10),i=z(r,t.height/2,t.height,-.8,-.4),o=It.simplex2(n/4,r/4)<i;if(r>a){if(o)return new ot(e,t);var s=Math.floor(Math.max(0,z(r,.75*t.height,t.height,1,9)));return new it(e,s,t)}}],Rocky:[function(e,t){var n=e.x,r=e.y,a=.55*t.height-4*(Lt.perlin2(0,n/5)+1)/2-16*Lt.perlin2(10,n/20+10)-z(n,0,t.width,10,-10),i=r-6*(Lt.perlin2(0,n/25)+1)/2-20*Lt.perlin2(10,n/150+10)<.5*t.height?-1:-.15;return It.simplex2(n/10,r/10)<i?new ot(e,t):r>a?new it(e,3,t):void 0}]},Gt=function(){return{climate:{turnsBetweenRainfall:800,rainDuration:50,waterPerDroplet:2},evaporationRate:2e-4,evaporationBottom:.6,floorCo2:.3333,waterGravityPerTurn:.005,fill:"Temperate"}},Yt=function(){return{climate:{rainDuration:220,turnsBetweenRainfall:3300,waterPerDroplet:8},evaporationRate:.002,evaporationBottom:.7,waterGravityPerTurn:.02,floorCo2:.95,fill:"Desert"}},Vt=function(){return{climate:{turnsBetweenRainfall:2500,rainDuration:120,waterPerDroplet:3},waterGravityPerTurn:.1,evaporationBottom:.6,evaporationRate:.001,floorCo2:1,fill:"Rocky"}},Ht={Temperate:Gt,Desert:Yt,Rocky:Vt},Ut=Object(b.a)({height:Object(b.g)(),temperature:Object(b.g)(),rainfall:Object(b.g)(),soilType:Object(b.g)(),wind:Object(b.g)(),visible:Object(b.g)(),environment:Object(b.f)(Bt),flora:Object(b.f)(Object(b.a)({species:Object(b.h)(k),mutationPointsPerEpoch:Object(b.g)(),actionPoints:Object(b.g)()}))}),Zt=Math.sqrt(3)/2,Jt=(bt=Object(b.i)(Object(b.c)()),wt=Object(b.i)(Object(b.f)(Ut)),Et=function(){function e(t,n){Object(u.a)(this,e),Object(S.a)(this,"uuid",kt,this),Object(S.a)(this,"info",Ot,this),Object(S.a)(this,"i",jt,this),Object(S.a)(this,"j",xt,this),this.i=t,this.j=n}return Object(h.a)(e,[{key:"k",get:function(){return-(this.i+this.j)}},{key:"magnitude",get:function(){return Math.abs(this.i)+Math.abs(this.j)+Math.abs(this.k)}},{key:"cartesian",get:function(){var e=this.i,t=this.j;return{x:1.5*e,y:2*Zt*t+Zt*e}}}]),e}(),kt=Object(T.a)(Et.prototype,"uuid",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return E()()}}),Ot=Object(T.a)(Et.prototype,"info",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{height:0,rainfall:"medium",soilType:"average",temperature:"temperate",wind:"low",visible:!1}}}),jt=Object(T.a)(Et.prototype,"i",[b.i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xt=Object(T.a)(Et.prototype,"j",[b.i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Et),Kt=n(46),qt=n.n(Kt),Xt=(At=Object(b.i)(Object(b.e)(Object(b.f)(Jt))),St=Symbol.iterator,Mt=function(){function e(){Object(u.a)(this,e),Object(S.a)(this,"tiles",Ct,this)}return Object(h.a)(e,[{key:"hash",value:function(e,t){return"".concat(e,",").concat(t)}},{key:"get",value:function(e,t){return this.tiles[this.hash(e,t)]}},{key:"set",value:function(e,t,n){this.tiles[this.hash(e,t)]=n}},{key:St,value:we.a.mark(function e(){var t;return we.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=we.a.keys(this.tiles);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.tiles[t];case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)})}]),e}(),Ct=Object(T.a)(Mt.prototype,"tiles",[At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),Mt),Qt=(Tt=Object(b.i)(Object(b.f)(Xt)),Rt=Object(b.i)(Object(b.h)(Jt)),Dt=Symbol.iterator,Pt=function(){function e(t,n){Object(u.a)(this,e),Object(S.a)(this,"storage",Nt,this),Object(S.a)(this,"startTile",Ft,this),this.storage=t,this.startTile=n,this.startTile&&(this.startTile.info.visible=!0)}return Object(h.a)(e,[{key:"hexNeighbors",value:function(e){var t=e.i,n=e.j,r=[];return r[0]=this.storage.get(t+1,n),r[1]=this.storage.get(t,n+1),r[2]=this.storage.get(t-1,n+1),r[3]=this.storage.get(t-1,n),r[4]=this.storage.get(t,n-1),r[5]=this.storage.get(t+1,n-1),r}},{key:"getStartTile",value:function(){return this.startTile}},{key:"tileAt",value:function(e,t){return this.storage.get(e,t)}},{key:Dt,value:we.a.mark(function e(){var t,n,r,a,i,o;return we.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,a=this.storage[Symbol.iterator]();case 5:if(t=(i=a.next()).done){e.next=12;break}return o=i.value,e.next=9,o;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,r=e.t0;case 18:e.prev=18,e.prev=19,t||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw r;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})},{key:"resetActionPoints",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.storage[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;i.info.flora&&(i.info.flora.actionPoints=1)}}catch(o){t=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"unusedHexes",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var a,i=this.storage[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;o.info.flora&&o.info.flora.actionPoints>0&&e.push(o)}}catch(s){n=!0,r=s}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}},{key:"getMaxGenePool",value:function(e){var t=0,n=!0,r=!1,a=void 0;try{for(var i,o=this.storage[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value.info.flora;s&&s.species===e&&(t+=s.mutationPointsPerEpoch)}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}}],[{key:"randomHeight",value:function(e,t){var n=e.cartesian,r=n.x,a=n.y,i=0;return i+=6*(t.noise3D(r/24,a/24,0)-.2),i+=6*t.noise3D(r/24,a/24,1.453),i+=1.5*t.noise3D(r/6,a/6,1.453),i+=1,(i-=.025*Math.abs(a*a))<0&&i>=-1&&(i=0),i=Math.round(Math.max(Math.min(i,6),-1))}},{key:"populateLevelInfo",value:function(t,n){var r=t.info;r.height=e.randomHeight(t,n),r.environment=r.height<2?Gt():r.height<4?Vt():Yt()}},{key:"generateFilledHex",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=new Xt,r=new qt.a,a=-t;a<=t;a++)for(var i=-t;i<=t;i++){var o=-(a+i);if(!(Math.abs(o)>t)){var s=new Jt(a,i);e.populateLevelInfo(s,r),n.set(a,i,s)}}var l=e.getDefaultStartTile(n);return new e(n,l)}},{key:"generateRectangle",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,r=new Xt,a=new qt.a,i=Math.max(t/2,n/2),o=-i;o<=i;o++)for(var s=-i;s<=i;s++){var l=-(o+s);if(!(Math.abs(l)>i)){var c=new Jt(o,s),u=c.cartesian,h=u.x,d=u.y;h<-t/2||h>t/2||d<-n/2||d>n/2||(e.populateLevelInfo(c,a),r.set(o,s,c))}}var f=e.getDefaultStartTile(r);return new e(r,f)}},{key:"getDefaultStartTile",value:function(e){if(null!=e)return Array.from(e).filter(function(e){return 0===e.info.height}).sort(function(e,t){return e.magnitude-t.magnitude})[0]}}]),e}(),Nt=Object(T.a)(Pt.prototype,"storage",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ft=Object(T.a)(Pt.prototype,"startTile",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt),_t=Object(b.a)({sourceHex:Object(b.h)(Jt),targetHex:Object(b.h)(Jt),settlingSpecies:Object(b.h)(k)}),$t=Object(b.a)({overWorld:Object(b.f)(Qt),activePopulationAttempt:Object(b.f)(_t),rootSpecies:Object(b.f)(k),epoch:!0}),en=n(35),tn=n(38),nn=n.n(tn),rn="gameData";function an(e){var t=Object(b.j)($t,e),n=JSON.stringify(t);return nn.a.setItem(rn,n)}function on(){return(on=Object(en.a)(we.a.mark(function e(){var t,n,r;return we.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nn.a.getItem(rn);case 2:return t=e.sent,n=JSON.parse(t),r=Object(b.b)($t,n),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var sn={AAGameResultDone:!0,AAGetGameResult:!0,AANewSpecies:!0,AANextEpoch:!0,AAPopulationAttemptSuccess:!0,AAStartPopulationAttempt:!0};var ln=n(11),cn=n.n(ln);n(96);function un(e){return a.a.createElement("button",Object.assign({},e,{className:cn()("button",e.className,e.color||"purple")}),e.children)}var hn=new(function(){function e(){var t=this;Object(u.a)(this,e),this.tickerId=1,this.tickers={},this._time=0,this.tickerLoop=function(e){t._time=e;var n=[];for(var r in t.tickers){!0===(0,t.tickers[r])(e)&&n.push(Number(r))}for(var a=0,i=n;a<i.length;a++){var o=i[a];t.removeAnimation(o)}requestAnimationFrame(t.tickerLoop)}}return Object(h.a)(e,[{key:"addAnimation",value:function(e){var t=this.tickerId++;return this.tickers[t]=e,t}},{key:"removeAnimation",value:function(e){return delete this.tickers[e]}},{key:"start",value:function(){requestAnimationFrame(this.tickerLoop)}},{key:"now",get:function(){return this._time}}]),e}());hn.start();var dn=hn,fn=new Intl.NumberFormat(void 0,{maximumFractionDigits:2,useGrouping:!0});var mn=function(e){var t=e.value,n=e.speed,r=void 0===n?.1:n,i=e.formatter,o=void 0===i?fn:i,s=a.a.useState(t),l=Object(c.a)(s,2),u=l[0],h=l[1];return a.a.useEffect(function(){var e=dn.addAnimation(function(){h(function(n){return Math.abs(n-t)<.005?(dn.removeAnimation(e),t):n*(1-r)+t*r})});return function(){dn.removeAnimation(e)}},[t,r]),a.a.createElement(a.a.Fragment,null,o.format(u))},vn=n(19),pn=n(63),yn=n.n(pn);n(97);var gn=function(e){var t=e.size,n=Object(vn.a)(e,["size"]);return a.a.createElement("img",Object.assign({className:cn()("character",t),alt:"",src:yn.a},n))},bn=n(33),wn=(n(98),new Intl.NumberFormat(void 0,{maximumFractionDigits:0,useGrouping:!0}));var En=function(e){var t=e.amount,n=e.total,r=Object(vn.a)(e,["amount","total"]);return a.a.createElement("span",Object.assign({},r,{className:cn()("mp",r.className)}),a.a.createElement(mn,{speed:.3,formatter:wn,value:t}),null!=n?a.a.createElement(a.a.Fragment,null,"/",n):null,a.a.createElement(bn.a,{className:"mp-icon"}))};n(99);var kn=function(e){var t=e.className,n=e.children,i=e.shrunkElements,o=Object(r.useState)(!1),s=Object(c.a)(o,2),l=s[0],u=s[1];return a.a.createElement("div",{className:cn()(t,"expand")},a.a.createElement("div",{className:"expand-button",onClick:function(){u(!l)}},i,a.a.createElement("div",{className:"expand-caret"},l?"\u25bc":"\u25b6")),l?a.a.createElement("div",null,n):null)};n(100);var On=function(e){var t=e.traits,n=$.filter(function(e){return 0!==t[e]});n.sort(function(e,n){return t[n]-t[e]});var r=n.length>0?a.a.createElement("div",{className:"interesting-traits"},n.map(function(e){return a.a.createElement("div",{className:cn()("trait",{green:t[e]>0,red:t[e]<0}),key:e},ee(e),": ",t[e])})):a.a.createElement("div",{className:"no-interesting-traits"},"All traits are zero."),i=$.filter(function(e){return 0===t[e]}),o=a.a.createElement("div",{className:"zero-traits"},i.map(function(e){return a.a.createElement("div",{className:"trait",key:e},ee(e),": ",t[e])}));return a.a.createElement("div",{className:"trait-display"},r,a.a.createElement(kn,{shrunkElements:a.a.createElement("div",{className:"expand-toggle"},"Show All")},o))};n(101);function jn(e){var t=e.gene,n=e.onClick;return a.a.createElement("div",{className:"gene"},a.a.createElement("div",{className:"gene-number"},a.a.createElement("span",{className:"tuple-plus",title:ae(t[0])+" +1"},a.a.createElement("span",{className:"dna",onClick:function(){return n(0)}},t[0][0]),a.a.createElement("span",{className:"dna",onClick:function(){return n(1)}},t[0][1])),a.a.createElement("span",{className:"tuple-minus",title:ae(t[1])+" -1"},a.a.createElement("span",{className:"dna",onClick:function(){return n(2)}},t[1][0]),a.a.createElement("span",{className:"dna",onClick:function(){return n(3)}},t[1][1]))),a.a.createElement("div",{className:"gene-visual"},a.a.createElement("img",{alt:"",src:"https://media2.giphy.com/media/YlmI36YAWe7KScC7hK/giphy.gif",width:"44px"})))}var xn=function(e){var t=e.genes,n=e.onClick,r=t.length>0?a.a.createElement("div",{className:"genes-container"},t.map(function(e,t){return a.a.createElement(jn,{key:t,gene:e,onClick:function(t){return n(e,t)}})})):a.a.createElement("div",{className:"genes-empty"},"No genes.");return a.a.createElement("div",{className:"gene-display"},r)};n(102);var An=function(e){var t=e.genes,n=e.onClick,r=a.a.useMemo(function(){return ne(t)},[t]);return a.a.createElement("div",{className:"genes-to-traits"},a.a.createElement("div",{className:"genes-details"},a.a.createElement("h3",null,"Genes"),a.a.createElement(xn,{genes:t,onClick:n})),a.a.createElement("div",{className:"arrow"},"\u21d2"),a.a.createElement("div",{className:"traits-details"},a.a.createElement("h3",null,"Traits"),a.a.createElement(On,{traits:r})))};function Mn(e,t){var n=e.join("");return Cn(n.substr(0,t)+function(e){var t;do{t=Tn()}while(t===e);return t}(n.charAt(t))+n.substr(t+1))}function Cn(e){return[e.substr(0,2),e.substr(2)]}function Sn(){return Tn()+Tn()}function Tn(){var e=Math.random();return e<.25?"A":e<.5?"C":e<.75?"G":"T"}n(103);var Rn=function(e){var t=e.species,n=e.onCommit,r=t.freeMutationPoints,i=function(e){t.freeMutationPoints="number"===typeof e?e:e(r)},o=a.a.useState({id:E()(),descendants:[],freeMutationPoints:0,totalMutationPoints:0,genes:Object(g.a)(t.genes),name:"New species",parent:t}),s=Object(c.a)(o,2),l=s[0],u=s[1],h=a.a.useState(),d=Object(c.a)(h,2),f=d[0],m=d[1],v=f&&"swap"===f.type,p=f&&"reroll"===f.type,b=l.genes.length+1;function w(e,t,n,r){i(function(e){return e-2}),u(function(a){var i=a.genes.indexOf(e),o=a.genes.indexOf(n),s=Object(g.a)(a.genes),l=function(e,t,n,r){var a=e.join(""),i=n.join(""),o=a.charAt(t),s=i.charAt(r),l=a.substr(0,t)+s+a.substr(t+1),c=i.substr(0,r)+o+i.substr(r+1);return[Cn(l),Cn(c)]}(e,t,n,r),u=Object(c.a)(l,2),h=u[0],d=u[1];return s[i]=h,s[o]=d,Object(y.a)({},a,{genes:s})}),m(void 0)}var k=a.a.useMemo(function(){var e=t.genes,n=l.genes;return e.length!==n.length||e.some(function(t,r){return e[r]!==n[r]})},[l.genes,t.genes]);return a.a.createElement("div",{className:cn()("mutation-screen",{"click-mode-active":null!=f})},a.a.createElement("div",{className:"mutation-screen-content"},a.a.createElement("h1",null,a.a.createElement(gn,{size:"medium"}),a.a.createElement("span",{className:"name"},t.name)),a.a.createElement("div",{className:"buttons"},a.a.createElement(En,{className:"pool",amount:r,total:t.totalMutationPoints}),a.a.createElement(un,{onClick:function(){i(function(e){return e-b}),u(function(e){return Object(y.a)({},e,{genes:[].concat(Object(g.a)(e.genes),[[Sn(),Sn()]])})})},disabled:r<b},"New Gene (",a.a.createElement(En,{amount:b}),")"),a.a.createElement(un,{className:cn()({"is-cancel":v}),onClick:function(){m(v?void 0:{type:"swap"})},disabled:!v&&r<2||0===l.genes.length},v?"Cancel":a.a.createElement(a.a.Fragment,null,"Swap DNA (",a.a.createElement(En,{amount:2}),")")),a.a.createElement(un,{className:cn()({"is-cancel":p}),onClick:function(){m(p?void 0:{type:"reroll"})},disabled:!p&&r<1||0===l.genes.length},p?"Cancel":a.a.createElement(a.a.Fragment,null,"Re-roll DNA (",a.a.createElement(En,{amount:1}),")"))),a.a.createElement(An,{genes:l.genes,onClick:function(e,t){f&&("reroll"===f.type?function(e,t){i(function(e){return e-1}),u(function(n){var r=n.genes.indexOf(e),a=Mn(e,t),i=[].concat(Object(g.a)(n.genes.slice(0,r)),[a],Object(g.a)(n.genes.slice(r+1)));return Object(y.a)({},n,{genes:i})}),m(void 0)}(e,t):"swap"===f.type&&(null==f.p1?f.p1={gene:e,position:t}:w(f.p1.gene,f.p1.position,e,t)))}}),k?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"arrow"},"\u21d3"),a.a.createElement("h1",null,a.a.createElement(gn,{size:"medium"}),a.a.createElement("input",{type:"text",className:"name",value:l.name,onChange:function(e){u(function(t){return Object(y.a)({},t,{name:e.target.value})})}})),a.a.createElement(un,{className:"commit",color:"green",onClick:function(){n(l,r)}},"Commit")):null))},Pn=(n(104),n(64));n(105);var Nn=function(e){var t=p(),n=Object(Pn.a)(),r=Object(c.a)(n,2),i=r[0],o=r[1],s=e.children,l=e.className,u=e.zScale,h=void 0===u?5:u,d=Object(vn.a)(e,["children","className","zScale"]),f=window.innerWidth*h,m=a.a.useMemo(function(){if(null!=o){var e=o.left+o.width/2,n=o.top+o.height/2,r=t.x-e,a=t.y-n,i=Math.atan(2*r/f),s=Math.atan(-2*a/f);return{transform:"perspective(525px) rotateX(".concat(s,"rad) rotateY(").concat(i,"rad)")}}return{}},[t.x,t.y,o,f]);return a.a.createElement("div",Object.assign({ref:i,className:cn()("look-at-mouse",l)},d),a.a.createElement("div",{className:"look-at-mouse-transform",style:m},s))},Fn=n(65),Dn=n.n(Fn);n(123),n(124);var Bn=function(e){var t=e.species,n=e.onClick,r=e.onMutate;return a.a.createElement("div",{className:"species-details"},a.a.createElement(An,{genes:t.genes,onClick:n}),t.freeMutationPoints>0?a.a.createElement("div",{className:"suggestion"},t.freeMutationPoints," Mutation Points available. Use them!"):null,a.a.createElement(un,{onClick:function(){return r(t)}},"Mutate"))};var Wn=function e(t){var n=t.species,r=t.onMutate,i=function(e){u(!1),r(e)},o=a.a.useState(!1),s=Object(c.a)(o,2),l=s[0],u=s[1],h=n.descendants.length>0?a.a.createElement("div",{className:"descendants-container"},n.descendants.map(function(t,n){return a.a.createElement(e,{key:n,species:t,onMutate:i})})):null,d=a.a.createElement("div",{className:"species-detail-popover"},a.a.createElement(Bn,{species:n,onMutate:i,onClick:function(){}}));return a.a.createElement("div",{className:"species-node"},h,a.a.createElement(Dn.a,{isOpen:l,preferPlace:"right",onOuterAction:function(){return u(!1)},body:d},a.a.createElement(Nn,{zScale:5},a.a.createElement("div",{className:"species-info",onClick:function(){return u(!l)}},a.a.createElement("div",{className:"species-info-name"},n.name),a.a.createElement("div",{className:"species-info-animation"},a.a.createElement(gn,{size:"small"})),a.a.createElement(En,{amount:n.freeMutationPoints,total:n.totalMutationPoints})))))};var In=function(e){var t=e.onMutate,n=A(),r=Object(c.a)(n,1)[0].rootSpecies;return a.a.createElement("div",{className:"phylogenetic-tree"},a.a.createElement("div",{className:"title"},"Phylogenetic Tree"),a.a.createElement("div",{className:"tree-nodes"},a.a.createElement(Wn,{species:r,onMutate:t})))},Ln=n(66),zn=n.n(Ln);var Gn=Math.sqrt(3)/2;function Yn(e,t,n){var r=t.scale,a=t.dX,i=t.dY,o=e.width/2+a,s=e.height/2+i,l=n.nativeEvent,c=(l.offsetX-o)/r/1.5,u=((l.offsetY-s)/r-Gn*c)/(2*Gn);return function(e,t,n){var r=Math.round(e),a=Math.round(t),i=Math.round(n),o=Math.abs(r-e),s=Math.abs(a-t),l=Math.abs(i-n);o>s&&o>l?r=-a-i:s>l?a=-r-i:i=-r-a;return{i:r,j:a,k:i}}(c,u,-(c+u))}function Vn(e,t){var n=t.dX,r=t.dY,a=t.scale,i=e.cartesian,o=i.x,s=i.y;return[window.innerWidth/2+n+o*a,window.innerHeight/2+r+s*a]}function Hn(e,t){var n=e.cartesian,r=n.x,a=n.y,i=window.innerWidth/2-r*t,o=window.innerHeight/2-a*t;return[i-window.innerWidth/2,o-window.innerHeight/2]}!function(){var e=[new oe.Vector2(-1,0),new oe.Vector2(.5,Gn),new oe.Vector2(.5,-Gn)]}();var Un=function(e){var t=2*Gn;return function(e){var t=e.width,n=void 0===t?1:t,r=e.height,a=void 0===r?1:r,i=e.radius,o=void 0===i?.1:i,s=e.max,l=void 0===s?1e3:s,c=e.rng,u=void 0===c?Math.random:c,h=o*o,d=3*h,f=o*Math.SQRT1_2,m=Math.ceil(n/f),v=Math.ceil(a/f),p=new Array(m*v),y=[],g=0,b=0;function w(e,t){var n=e/f|0,r=t/f|0,a=Math.max(n-2,0),i=Math.max(r-2,0),o=Math.min(n+3,m),s=Math.min(r+3,v);for(r=i;r<s;++r){var l=r*m;for(n=a;n<o;++n){var c;if(c=p[l+n]){var u=c[0]-e,d=c[1]-t;if(u*u+d*d<h)return!1}}}return!0}function E(e,t){var n=[e,t];return y.push(n),p[m*(t/f|0)+(e/f|0)]=n,b++,g++,n}u=u||Math.random;for(var k=function(){if(!b)return E(u()*n,u()*a);for(;g;){for(var e=u()*g|0,t=y[e],r=0;r<30;++r){var i=2*Math.PI*u(),o=Math.sqrt(u()*d+h),s=t[0]+o*Math.cos(i),l=t[1]+o*Math.sin(i);if(s>=0&&s<n&&l>=0&&l<a&&w(s,l))return E(s,l)}y[e]=y[--g],y.length=g}},O=[],j=0;j<l;j++){var x=k();if(null==x)break;O.push(new oe.Vector2(x[0],x[1]))}return O}({width:2,height:t,radius:e,max:1e4}).map(function(e){return e.x-=1,e.y-=t/2,e}).filter(function(e){return Zn(e.x,e.y)})},Zn=function(){var e=1*Gn;return function(t,n){var r=Math.abs(t),a=Math.abs(n);return!(r>1||a>e)&&1*e-e*r-.5*a>=0}}(),Jn=n(67),Kn=n.n(Jn);n(133);var qn=function(e){var t=e.tile,n=e.onClickPlay,r=A(),i=Object(c.a)(r,1)[0].rootSpecies,o=a.a.useMemo(function(){return j(i)},[i]),s=a.a.useState(o[0].id),l=Object(c.a)(s,2),u=l[0],h=l[1],d=t.info,f=d.height,m=d.flora,v=o.map(function(e){return{value:e.id,label:e.name}}),p=-1===f?null:a.a.createElement("div",{className:"play-selector"},a.a.createElement(Kn.a,{options:v,value:u,onChange:function(e){h(e.value)}}),a.a.createElement(un,{color:"green",className:"play-button",onClick:function(){n(t,o.find(function(e){return e.id===u}))},disabled:t.info.flora&&t.info.flora.actionPoints<1},"Populate")),g=null!=m?a.a.createElement("div",null,a.a.createElement("h1",null,"Inhabited by ",a.a.createElement("i",null,m.species.name)),a.a.createElement("p",null,a.a.createElement(En,{amount:m.mutationPointsPerEpoch})," per epoch"),a.a.createElement("p",null,"Action Points: ",m.actionPoints)):-1===t.info.height?a.a.createElement("h1",null,"Deep Water"):a.a.createElement("h1",null,"Uninhabited");delete Object(y.a)({},t.info).flora;var b=-1===t.info.height?null:a.a.createElement(kn,{shrunkElements:a.a.createElement("div",{className:"details"},"Details")},a.a.createElement("pre",{style:{fontSize:"12px"}},JSON.stringify(t.info,null,4)));return a.a.createElement("div",{className:"hex-tile-info-container"},g,b,p)},Xn=n(68),Qn=n.n(Xn);function _n(e){return new Promise(function(t){setTimeout(t,e)})}var $n=n(150),er=new Image;er.src=Qn.a;var tr=Object($n.a)().domain([-1,0,1,5,6]).range(["rgb(0, 60, 255)","lightblue","yellow","orange"]),nr=function(){function e(t){Object(u.a)(this,e),this.tile=t,this.vignettePositions=void 0}return Object(h.a)(e,[{key:"draw",value:function(e,t){var n=t.scale,r=Vn(this.tile,t),a=Object(c.a)(r,2),i=a[0],o=a[1];this.tile.info.visible?(e.fillStyle=tr(this.tile.info.height),e.fillStyle=tr(this.tile.info.height),rr(e,i,o,n),e.font="".concat(12*n/48,"px serif"),e.textAlign="center",e.textBaseline="middle",e.fillStyle="#666",e.fillText(this.tile.info.height+"",i,o,n),null!=this.tile.info.flora&&this.updateVignettes(e,this.tile.info.flora.species,i,o,n)):(e.strokeStyle="rgb(112, 112, 112)",rr(e,i,o,n,!1))}},{key:"updateVignettes",value:function(e,t,n,r,a){if(null==this.vignettePositions){var i=Un(.2).sort(function(e,t){return e.y-t.y});this.vignettePositions=[];var o=this.vignettePositions;Object(en.a)(we.a.mark(function e(){var t,n,r,a,s,l;return we.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,a=i[Symbol.iterator]();case 5:if(t=(s=a.next()).done){e.next=13;break}return l=s.value,o.push(l),e.next=10,_n(300);case 10:t=!0,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),n=!0,r=e.t0;case 19:e.prev=19,e.prev=20,t||null==a.return||a.return();case 22:if(e.prev=22,!n){e.next=25;break}throw r;case 25:return e.finish(22);case 26:return e.finish(19);case 27:case"end":return e.stop()}},e,null,[[3,15,19,27],[20,,22,26]])}))()}var s=a/48/2,l=!0,c=!1,u=void 0;try{for(var h,d=this.vignettePositions[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var f=h.value;e.drawImage(er,n+f.x*a-er.width/2*s,r+f.y*a-er.height*s,er.width*s,er.height*s)}}catch(m){c=!0,u=m}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}}}]),e}();function rr(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.beginPath(),e.moveTo(t+r,n);for(var i=1;i<6;i++){var o=i/6*Math.PI*2;e.lineTo(t+Math.cos(o)*r,n+Math.sin(o)*r)}e.closePath(),a&&e.fill(),e.stroke()}n(134),n(135);var ar=function(e){var t=e.tile,n=e.camera,r=e.children,i=Vn(t,n),o=Object(c.a)(i,2),s=o[0],l=o[1],u={left:s+.5*n.scale,top:l};return a.a.createElement("div",{className:"overworld-popover",style:u},a.a.createElement("div",{className:"overworld-popover-positioner"},r))},ir=function(e){function t(e,n){var r;Object(u.a)(this,t),(r=Object(d.a)(this,Object(f.a)(t).call(this,e,e))).context=void 0,r.hexTileSprites=new Map,r.canvas=null,r.rafId=void 0,r.handleCanvasRef=function(e){r.canvas=e,null!=e&&(dn.addAnimation(function(){return r.setState({frame:r.state.frame+1}),null==r.canvas}),r.handleResize())},r.handleCanvasClick=function(e){if(null!=r.canvas)if(null!=r.state.highlightedHex)r.setState({highlightedHex:void 0});else{var t=Yn(r.canvas,r.state.cameraState,e),n=r.context[0].overWorld.tileAt(t.i,t.j);null!=n&&n.info.visible&&r.setState({highlightedHex:n})}},r.onPlayLevel=function(e,t){r.props.onPlayLevel(e,t)},r.handleKeyDown=function(e){if(!e.repeat){var t=Object(y.a)({},r.state.pressedKeys,Object(ge.a)({},e.code,!0));r.setState({pressedKeys:t})}},r.handleKeyUp=function(e){var t=Object(y.a)({},r.state.pressedKeys);delete t[e.code],r.setState({pressedKeys:t})},r.handleWheel=function(e){var t=-(e.deltaX+e.deltaY)/125/10,n=Math.pow(2,t),a=r.state.cameraState.scale*n;r.setState({cameraState:Object(y.a)({},r.state.cameraState,{scale:a})})},r.handleResize=function(){null!=r.canvas&&(r.canvas.width=window.innerWidth,r.canvas.height=window.innerHeight,r.drawMap())},r.updateCamera=function(){var e=new oe.Vector2;for(var t in r.state.pressedKeys)"KeyW"===t||"ArrowUp"===t?e.y+=20:"KeyS"===t||"ArrowDown"===t?e.y-=20:"KeyA"===t||"ArrowLeft"===t?e.x+=20:"KeyD"!==t&&"ArrowRight"!==t||(e.x-=20);if(e.setLength(20),0!==e.x||0!==e.y){var n=r.state.cameraState;r.setState({cameraState:Object(y.a)({},n,{dX:n.dX+e.x,dY:n.dY+e.y})})}};var a=Object(c.a)(n,1)[0].overWorld,i=Hn(a.getStartTile(),96),o=Object(c.a)(i,2),s=o[0],l=o[1];r.state={cameraState:{scale:96,dX:s,dY:l},pressedKeys:{},frame:0};var h=!0,m=!1,v=void 0;try{for(var p,g=a[Symbol.iterator]();!(h=(p=g.next()).done);h=!0){var b=p.value,w=new nr(b);r.hexTileSprites.set(b,w)}}catch(E){m=!0,v=E}finally{try{h||null==g.return||g.return()}finally{if(m)throw v}}return r}return Object(m.a)(t,e),Object(h.a)(t,[{key:"drawMap",value:function(){if(null!=this.canvas){var e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height);var t=!0,n=!1,r=void 0;try{for(var a,i=this.hexTileSprites.values()[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.draw(e,this.state.cameraState)}}catch(o){n=!0,r=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),document.addEventListener("wheel",this.handleWheel),window.addEventListener("resize",this.handleResize),this.rafId=dn.addAnimation(this.updateCamera)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),document.removeEventListener("wheel",this.handleWheel),window.removeEventListener("resize",this.handleResize),dn.removeAnimation(this.rafId)}},{key:"componentDidUpdate",value:function(e){e.focusedHex!==this.props.focusedHex&&null!=this.props.focusedHex&&this.focusHex(this.props.focusedHex),this.drawMap()}},{key:"focusHex",value:function(e){var t=this,n=0;dn.addAnimation(function(r){0===n&&(n=r);var a=r-n,i=Hn(e,t.state.cameraState.scale),o=Object(c.a)(i,2),s=o[0],l=o[1],u=.5*t.state.cameraState.dX+.5*s,h=.5*t.state.cameraState.dY+.5*l;return t.setState({cameraState:Object(y.a)({},t.state.cameraState,{dX:u,dY:h})}),a>1e3||Math.abs(s-u)<.01&&Math.abs(l-h)<.01})}},{key:"render",value:function(){return a.a.createElement("div",{className:"overworld-map-container"},a.a.createElement("canvas",{tabIndex:-1,ref:this.handleCanvasRef,onClick:this.handleCanvasClick}),this.maybeRenderHexPopover())}},{key:"maybeRenderHexPopover",value:function(){if(null!=this.state.highlightedHex)return a.a.createElement(ar,{camera:this.state.cameraState,tile:this.state.highlightedHex},a.a.createElement(qn,{tile:this.state.highlightedHex,onClickPlay:this.onPlayLevel}))}}]),t}(a.a.PureComponent);ir.contextType=x;n(136);var or=new Intl.NumberFormat(void 0,{useGrouping:!0,maximumFractionDigits:0});function sr(e){var t=e.onNextEpoch,n=e.onFocusHex,i=A(),o=Object(c.a)(i,1)[0],s=o.epoch,l=o.overWorld,u=Object(r.useState)(!1),h=Object(c.a)(u,2),d=h[0],f=h[1],m=l.unusedHexes(),v=0===m.length;return a.a.createElement("div",{className:cn()("epoch-display",{"ready-to-advance":v,transitioning:d})},a.a.createElement("span",{className:"number"},a.a.createElement(mn,{formatter:or,value:1e6*s,speed:.08})," Years"),m.length>0?a.a.createElement("div",{onClick:function(){return n(m[0])}},m.length," hexes unused"):null,a.a.createElement("button",{className:"button-next-epoch",onClick:function(){f(!0),setTimeout(function(){return f(!1)},5e3),t()},disabled:d},a.a.createElement(bn.c,{className:"icon"})))}var lr=function(e){var t=e.onPopulationAttempt,n=e.onNextEpoch,i=Object(r.useState)(!1),o=Object(c.a)(i,2),s=o[0],l=o[1],u=Object(r.useState)(void 0),h=Object(c.a)(u,2),d=h[0],f=h[1];Object(r.useEffect)(function(){function e(e){"Tab"===e.code&&(l(function(e){return!e}),e.preventDefault())}return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}},[]);var m=Object(r.useCallback)(function(e){f(e)},[]),v=Object(r.useCallback)(function(e,t){if(null==d)throw new Error("created new species with no actively mutating one!");d.descendants.push(e),d.freeMutationPoints=t,e.parent=d,f(void 0)},[d]);var p=Object(r.useState)(void 0),y=Object(c.a)(p,2),g=y[0],b=y[1],w=Object(r.useCallback)(function(e){b(e)},[]),E=A(),k=Object(c.a)(E,1)[0];return a.a.createElement("div",{className:"overworld-screen"},a.a.createElement(ir,{focusedHex:g,onPlayLevel:t}),a.a.createElement("div",{className:cn()("panel-left",{open:s})},s?a.a.createElement(In,{onMutate:m}):null,a.a.createElement("button",{className:"panel-left-handle",onClick:function(){return l(function(e){return!e})}},a.a.createElement(bn.b,{className:"icon"}))),function(){var e=null!=d?a.a.createElement(Rn,{species:d,onCommit:v}):null;return a.a.createElement(zn.a,{ariaHideApp:!1,isOpen:null!=d,onRequestClose:function(){return f(void 0)},className:"mutation-screen-portal"},e)}(),a.a.createElement(sr,{onNextEpoch:n,onFocusHex:w}),a.a.createElement("div",{style:{position:"absolute",right:"10px",top:"10px"}},a.a.createElement(un,{onClick:function(){return an(k)}},"Save")),a.a.createElement("div",{style:{position:"absolute",right:"10px",top:"60px"}},a.a.createElement(un,{onClick:function(){return window.confirm("Are you sure you want to reset your whole game?")?nn.a.removeItem(rn).then(function(){window.location.reload()}):Promise.reject()}},"Reset Game")))},cr=n(36),ur={click:!0,contextmenu:!0,dblclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,touchstart:!0,touchmove:!0,touchend:!0,keyup:!0,keydown:!0,keypress:!0,wheel:!0},hr=function(){function e(t,n){Object(u.a)(this,e),this.renderer=t,this.audioContext=n,this.elements=void 0,this.events=void 0,this.timeElapsed=0,this.frameCount=0}return Object(h.a)(e,[{key:"aspectRatio",get:function(){return this.renderer.domElement.height/this.renderer.domElement.width}},{key:"resolution",get:function(){return new oe.Vector2(this.renderer.domElement.width,this.renderer.domElement.height)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),e}();hr.id=void 0;var dr=n(47),fr=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this,e))).frameId=void 0,n.lastTimestamp=0,n.stop=!1,n.loop=function(e){var t=e-n.lastTimestamp;n.lastTimestamp=e,n.props.sketch.frameCount++,n.props.sketch.timeElapsed=e;try{n.props.sketch.animate(t)}catch(r){console.error(r)}n.stop?dn.removeAnimation(n.frameId):n.setState({frameCount:n.props.sketch.frameCount})},n.handleWindowResize=function(){var e=n.props.sketch.renderer;n.updateRendererCanvasToMatchParent(e),null!=n.props.sketch.resize&&n.props.sketch.resize(e.domElement.width,e.domElement.height)},n.state={frameCount:e.sketch.frameCount},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize();var t=this.props.sketch.renderer.domElement;t.tabIndex=1,Object.keys(ur).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.addEventListener(n,r):t.addEventListener(n,r))}}),this.frameId=dn.addAnimation(this.loop)}},{key:"render",value:function(){var e=[];return null!=this.props.sketch.render&&e.push(this.props.sketch.render()),null!=this.props.sketch.elements&&e.push.apply(e,Object(g.a)(this.props.sketch.elements)),r.createElement("div",{className:"sketch-elements"},e.map(function(e,t){return r.cloneElement(e,{key:t})}))}},{key:"componentWillUnmount",value:function(){var e=this;this.stop=!0,this.props.sketch.destroy&&this.props.sketch.destroy(),null!=this.frameId&&dn.removeAnimation(this.frameId),this.props.sketch.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize);var t=this.props.sketch.canvas;Object.keys(ur).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.removeEventListener(n,r):t.removeEventListener(n,r))}})}},{key:"updateRendererCanvasToMatchParent",value:function(e){var t=e.domElement.parentElement;null!=t&&e.setSize(t.clientWidth,t.clientHeight)}}]),t}(r.PureComponent),mr=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).state={status:{type:"loading"},volumeEnabled:JSON.parse(window.localStorage.getItem("sketch-volumeEnabled")||"true")},n.audioContext=void 0,n.userVolume=void 0,n.handleContainerRef=function(e){if(null!=e)try{var t=window.AudioContext||window.webkitAudioContext,r=n.audioContext=new t;oe.AudioContext.setContext(r),n.userVolume=r.createGain(),n.userVolume.gain.setValueAtTime(.8,0),n.userVolume.connect(r.destination),(r.gain=r.createGain()).connect(n.userVolume),document.addEventListener("visibilitychange",n.handleVisibilityChange);var a=new oe.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0,antialias:!0});e.appendChild(a.domElement);var i=n.props.otherArgs||[],o=Object(Ce.a)(n.props.sketchClass,[a,n.audioContext].concat(Object(g.a)(i)));n.setState({status:{type:"success",sketch:o}})}catch(s){n.setState({status:{type:"error",error:s}}),console.error(s)}else"success"===n.state.status.type&&n.state.status.sketch.canvas.remove(),document.removeEventListener("visibilitychange",n.handleVisibilityChange),null!=n.audioContext&&n.audioContext.close(),n.setState({status:{type:"loading"}})},n.handleVolumeButtonClick=function(){var e=!n.state.volumeEnabled;n.setState({volumeEnabled:e}),window.localStorage.setItem("sketch-volumeEnabled",JSON.stringify(e))},n.handleVisibilityChange=function(){null!=n.audioContext&&(document.hidden?n.audioContext.suspend():n.state.volumeEnabled&&n.audioContext.resume())},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){null!=this.userVolume&&null!=this.audioContext&&(this.state.volumeEnabled&&"suspended"===this.audioContext.state?this.audioContext.resume():this.state.volumeEnabled||"running"!==this.audioContext.state||this.audioContext.suspend());var e=this.props,t=(e.sketchClass,e.otherArgs,e.eventsOnBody,e.errorElement,Object(vn.a)(e,["sketchClass","otherArgs","eventsOnBody","errorElement"])),n=cn()("sketch-component",this.state.status.type);return r.createElement("div",Object.assign({},t,{id:this.props.sketchClass.id,className:n,ref:this.handleContainerRef}),this.renderSketchOrStatus(),this.renderVolumeButton())}},{key:"renderSketchOrStatus",value:function(){var e=this.state.status;return"success"===e.type?r.createElement(fr,{key:this.props.sketchClass.id,sketch:e.sketch,eventsOnBody:this.props.eventsOnBody}):"error"===e.type?this.props.errorElement||this.renderDefaultErrorElement(e.error.message):"loading"===e.type?null:void 0}},{key:"renderDefaultErrorElement",value:function(e){return r.createElement("p",{className:"sketch-error"},"Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.",r.createElement("pre",null,e))}},{key:"renderVolumeButton",value:function(){var e=this.state.volumeEnabled;return r.createElement("button",{className:"user-volume",onClick:this.handleVolumeButtonClick},e?r.createElement(dr.b,null):r.createElement(dr.a,null))}}]),t}(r.PureComponent),vr=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handleDivRef=function(e){null!=e||n.exitFullscreen()},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:"full-page-sketch",ref:this.handleDivRef},r.createElement(mr,{sketchClass:this.props.sketchClass,otherArgs:this.props.otherArgs}))}},{key:"exitFullscreen",value:function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}}]),t}(r.PureComponent);function pr(e){var t;return function(){return void 0===t&&(t=e()),t}}var yr=n(69),gr=n.n(yr),br=n(37),wr=n.n(br),Er=16,kr=!1,Or=pr(function(){return(new oe.TextureLoader).load(gr.a,function(){Or().dispatchEvent({type:"update"}),kr=!0})}),jr=(new oe.TextureLoader).load(wr.a),xr={};function Ar(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";e=Math.floor(e),t=Math.floor(t);var r="".concat(e,",").concat(t);if(null==xr[r]){var a=function(){var r=Or().image,a=i.getContext("2d");a.fillStyle=n,a.fillRect(0,0,Er,16),a.drawImage(r,Er*e,Er*t,Er,Er,0,0,Er,Er),o.needsUpdate=!0},i=document.createElement("canvas");i.width=Er,i.height=Er;var o=new oe.Texture(i);o.magFilter=oe.NearestFilter,o.flipY=!0,o.wrapS=oe.RepeatWrapping,o.wrapT=oe.RepeatWrapping,kr?a():Or().addEventListener("update",function(){a()}),xr[r]=o}return xr[r]}var Mr=function e(t,n,r){Object(u.a)(this,e),this.target=t,this.scene=n,this.mito=r},Cr=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this))).geometry=void 0,n.material=void 0,n.index=0,n.geometry=t.newGeometry(),n.material=new Sr(e),n.frustumCulled=!1,n}return Object(m.a)(t,e),Object(h.a)(t,null,[{key:"newGeometry",value:function(){var e=new oe.BufferGeometry,n=new Float32Array(3*t.BUFFER_SIZE),r=new Float32Array(t.BUFFER_SIZE);return e.addAttribute("position",new oe.BufferAttribute(n,3).setDynamic(!0)),e.addAttribute("size",new oe.BufferAttribute(r,1).setDynamic(!0)),e}}]),Object(h.a)(t,[{key:"startFrame",value:function(){this.index=0}},{key:"commit",value:function(e,t,n,r){this.geometry.attributes.position.setXYZ(this.index,e,t,n),this.geometry.attributes.size.setX(this.index,r),this.index++}},{key:"endFrame",value:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.setDrawRange(0,this.index)}}]),t}(oe.Points);Cr.BUFFER_SIZE=1e5;var Sr=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this,{uniforms:{opacity:{value:e.opacity},sizeGlobal:{value:e.size},color:{value:e.color},map:{value:e.map}},vertexShader:Tr,fragmentShader:Rr,depthTest:!1,transparent:!0}))).params=e,n.map=void 0,n.map=e.map,n}return Object(m.a)(t,e),t}(oe.ShaderMaterial),Tr="\nattribute float size;\nuniform float sizeGlobal;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",Rr="\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\n#ifdef USE_MAP\n  uniform mat3 uvTransform;\n  uniform sampler2D map;\n#endif\n\nvoid main() {\n    gl_FragColor = vec4( color, opacity );\n\n    #ifdef USE_MAP\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\n        gl_FragColor *= mapTexelToLinear( mapTexel );\n    #endif\n}\n",Pr=function(e){function t(e,n,r){var a;Object(u.a)(this,t),(a=Object(d.a)(this,Object(f.a)(t).call(this,e,n,r))).animationOffset=0,a.waters=[],a.sugars=[],a.handleGetResources=function(e){for(var t=Math.ceil(a.target.water);a.waters.length<t;){var n=e.carrier.pos.clone().sub(a.target.carrier.pos);n.x+=.1*(Math.random()-.5),n.y+=.1*(Math.random()-.5),a.waters.push(n)}for(t=Math.ceil(a.target.sugar);a.sugars.length<t;){var r=e.carrier.pos.clone().sub(a.target.carrier.pos);r.x+=.1*(Math.random()-.5),r.y+=.1*(Math.random()-.5),a.sugars.push(r)}},a.handleGiveResources=function(){var e=Math.ceil(a.target.water);a.waters.length>e&&a.waters.splice(e,a.waters.length-e),e=Math.ceil(a.target.sugar),a.sugars.length>e&&a.sugars.splice(e,a.sugars.length-e)},e.on("get",a.handleGetResources),e.on("give",a.handleGiveResources);for(var i=0;i<a.target.water;i++)a.waters.push(Nr());for(var o=0;o<a.target.sugar;o++)a.sugars.push(Nr());return a}return Object(m.a)(t,e),Object(h.a)(t,null,[{key:"startFrame",value:function(){t.WaterParticles().startFrame(),t.SugarParticles().startFrame()}},{key:"endFrame",value:function(){t.WaterParticles().endFrame(),t.SugarParticles().endFrame()}}]),Object(h.a)(t,[{key:"updateNumParticles",value:function(e){}},{key:"commitParticles",value:function(e,t,n){if(n.length>0){for(var r=0;r<n.length-1;r++){var a=n[r];e.commit(a.x+this.target.carrier.pos.x,a.y+this.target.carrier.pos.y,10,1),t-=1}var i=n[n.length-1],o=t;e.commit(i.x+this.target.carrier.pos.x,i.y+this.target.carrier.pos.y,10,z(Math.sqrt(o),0,1,.2,1))}}},{key:"simulateResourcePositions",value:function(){for(var e=this.waters.length,t=e+this.sugars.length,n=0;n<t;n++){var r=n<e?this.waters[n]:this.sugars[n-e],a=0,i=0,o=dn.now/3e3+this.animationOffset;a+=.02*Math.cos(o);var s=.1+.1*r.length();a+=-r.x*s,i+=-r.y*s;var l=this.mito.world.player;if(l.pos.equals(this.target.carrier.pos)){var c=l.posFloat.x-l.pos.x,u=l.posFloat.y-l.pos.y,h=r.x-c,d=r.y-u,f=h*h+d*d,m=Math.max(Math.min(z(f,0,1,3,-5),3),0);a+=h*m*.2,i+=d*m*.2}for(var v=0;v<t;v++){var p=v<e?this.waters[v]:this.sugars[v-e];if(r===p)break;var y=r.x-p.x,g=r.y-p.y,b=y*y+g*g;if(b>0){var w=.003/b;a+=y*w,i+=g*w}}r.x+=a,r.y+=i}}},{key:"update",value:function(){this.updateNumParticles(this.target.water),this.updateNumParticles(this.target.sugar),this.simulateResourcePositions(),this.commitParticles(t.WaterParticles(),this.target.water,this.waters),this.commitParticles(t.SugarParticles(),this.target.sugar,this.sugars)}},{key:"destroy",value:function(){this.target.off("get",this.handleGetResources),this.target.off("give",this.handleGiveResources)}}]),t}(Mr);function Nr(){return new oe.Vector2(.01*(Math.random()-.5),.01*(Math.random()-.5))}Pr.WaterParticles=pr(function(){return new Cr({color:new oe.Color("rgb(9, 12, 255)"),size:45,opacity:.75})}),Pr.SugarParticles=pr(function(){return new Cr({color:new oe.Color("yellow"),size:85,opacity:.9,map:Ar(42,12,"transparent")})});var Fr=function(e){function t(e,n,r){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(f.a)(t).call(this,e,n,r))).mesh=void 0,a.mesh=new oe.Mesh(new oe.PlaneBufferGeometry(.75,.75),new oe.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:Ar(29,12,"transparent"),color:new oe.Color("white"),side:oe.DoubleSide})),L(a.mesh.position,a.target.pos,1),a.mesh.position.z=2,a.scene.add(a.mesh),a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"update",value:function(){var e=this.target.droopPosFloat().clone();e.x+=.04*Math.cos(dn.now/1e3),e.y+=.08*Math.sin(dn.now/400),L(this.mesh.position,e,.5),this.mesh.position.z=2}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(Mr),Dr=n(74);var Br=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this,e.target,e.scene,e.mito))).tileRenderer=e,n.renderers=[],n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"update",value:function(){var e;for(e=0;e<this.target.effects.length;e++){var t=this.target.effects[e],n=this.renderers[e];null==n?this.renderers[e]=Wr(t,this.tileRenderer):t!==n.target&&(n.destroy(),this.renderers[e]=Wr(t,this.tileRenderer))}for(;e<this.renderers.length;e++){this.renderers[e].destroy()}var r=!0,a=!1,i=void 0;try{for(var o,s=this.renderers[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value.update()}}catch(l){a=!0,i=l}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}},{key:"destroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.renderers[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.destroy()}}catch(i){t=!0,n=i}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}}]),t}(Mr);function Wr(e,t){if(e instanceof ct)return new Ir(e,t);throw new Error("effect renderer not defined for"+e)}var Ir=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(d.a)(this,Object(f.a)(t).call(this,e,n.scene,n.mito))).tileRenderer=n,r.mesh=void 0,r.mesh=t.newMesh(),n.mesh.add(r.mesh),r.mesh.scale.set(.01,.01,1),r}return Object(m.a)(t,e),Object(h.a)(t,[{key:"update",value:function(){var e=z(this.target.percentFrozen,0,1,.2,1);this.mesh.scale.x=I(this.mesh.scale.x,e,.2),this.mesh.scale.y=I(this.mesh.scale.y,e,.2)}},{key:"destroy",value:function(){this.tileRenderer.mesh.remove(this.mesh)}}]),t}(Mr);Ir.newMesh=function(){var e=new oe.PlaneBufferGeometry(.75,.75);e.translate(0,0,1);var t=new oe.MeshBasicMaterial({map:Ar(Math.floor(23/16),Math.floor(1.375)),side:oe.DoubleSide,color:zr,transparent:!0,opacity:.5});return new oe.Mesh(e,t)};var Lr,zr=new oe.Color("#1E90FF").lerp(new oe.Color(0),.5),Gr=function(){function e(){Object(u.a)(this,e),this.animation=void 0,this.timeStarted=void 0}return Object(h.a)(e,[{key:"set",value:function(e,t){this.animation=e,this.timeStarted=t}},{key:"update",value:function(e){if(null!=this.animation&&null!=this.timeStarted){var t=e-this.timeStarted;this.animation(t)&&(this.animation=void 0,this.timeStarted=void 0)}}}]),e}(),Yr=function(e){function t(e){var n,r;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(f.a)(t).call(this,t.geometry,(r=e.target,Hr().get(r.constructor).clone())))).renderer=e,n}return Object(m.a)(t,e),t}(oe.Mesh);Yr.geometry=new oe.PlaneBufferGeometry(1,1);var Vr=function(e){function t(e,n,r){var i;Object(u.a)(this,t),(i=Object(d.a)(this,Object(f.a)(t).call(this,e,n,r))).mesh=void 0,i.inventoryRenderer=void 0,i.originalColor=void 0,i.audio=void 0,i.lastAudioValueTracker=0,i.pairsLines=new oe.Object3D,i.worldDomElement=void 0,i.growingRenderer=void 0,i.cellEffectsRenderer=void 0,i.animation=new Gr,i.temperatureColor=t.TEMPERATURE_COLORS[me.Mild],i.currentLerp=0,i.target instanceof ht?(i.growingRenderer=new t(i.target.completedCell,i.scene,i.mito),i.mesh=i.growingRenderer.mesh,i.mesh.scale.set(.01,.01,1)):i.mesh=new Yr(Object(X.a)(i)),i.originalColor=i.mesh.material.color.clone(),de(i.target)&&(i.inventoryRenderer=new Pr(i.target.inventory,i.scene,i.mito),i.inventoryRenderer.animationOffset=(i.target.pos.x+i.target.pos.y)/2),i.scene.add(i.mesh);var o=i.target instanceof ut?1:0;if(i.mesh.position.set(i.target.pos.x,i.target.pos.y,o),i.target instanceof ut?i.target.constructor.turnsToBuild||i.mesh.scale.set(.01,.01,1):i.mesh.matrixAutoUpdate=!1,i.mesh.updateMatrix(),(i.target instanceof ft||i.target instanceof mt)&&(i.audio=new oe.Audio(i.mito.audioListener),i.mesh.add(i.audio)),i.target instanceof vt){var s=i.target;i.worldDomElement=r.addWorldDOMElement(function(){return i.target.pos},function(){return a.a.createElement("div",{className:"fruit-indicator"},a.a.createElement("div",null,s.committedResources.water.toFixed(1),"/",s.neededResources/2," water"),a.a.createElement("div",null,s.committedResources.sugar.toFixed(1),"/",s.neededResources/2," sugar"))})}return i.target instanceof ut&&(i.cellEffectsRenderer=new Br(Object(X.a)(i))),i}return Object(m.a)(t,e),Object(h.a)(t,[{key:"steps",value:function(e,t){return Math.floor(e/t)*t}},{key:"update",value:function(){var e=this.target.lightAmount();this.updateVisibility(e),this.updateSize(),this.updateColor(e),this.target instanceof ut&&this.mesh.position.set(this.target.pos.x,this.target.pos.y+this.target.droopY,1),this.respondToEvents(),null!=this.cellEffectsRenderer&&this.cellEffectsRenderer.update(),this.animation.update(dn.now/1e3)}},{key:"updateVisibility",value:function(e){e>0?(null==this.mesh.parent&&this.scene.add(this.mesh),null!=this.inventoryRenderer&&this.inventoryRenderer.update()):null!=this.mesh.parent&&this.scene.remove(this.mesh)}},{key:"updateSize",value:function(){if(this.target instanceof ht){var e=1-this.target.timeRemaining/this.target.timeToBuild;L(this.mesh.scale,{x:e,y:e},.5)}else if(this.target instanceof vt){var n=z(this.target.getPercentMatured(),0,1,.2,1),r=new oe.Vector2(n,n);L(this.mesh.scale,r,.1)}else L(this.mesh.scale,t.ONE,.1)}},{key:"updateColor",value:function(e){var t=this.mesh.material;if(this.target instanceof at){var n=Math.max(0,z(this.target.co2(),1/6,1.001,0,Ur.length-1)),r=Math.floor(n),a=Ur[r];if(this.originalColor=a.clone(),r!==Ur.length-1){var i=n-r,o=Ur[r+1];this.originalColor.lerp(o,i)}}t.color.copy(this.originalColor),tt(this.target)&&t.color.lerp(new oe.Color(0),1-this.target.energy/U.cellEnergyMax),t.color=this.lerpColorTemperature(t.color),t.color=new oe.Color(0).lerp(t.color,z(e,0,1,.2,1))}},{key:"respondToEvents",value:function(){if(this.target instanceof ft&&null!=this.audio){var e=this.target.totalSugarProduced;if(e>this.lastAudioValueTracker){this.audio.setBuffer(Ae);var t=this.target.pos.distanceToSquared(this.mito.world.player.pos),n=Math.min(1,1/(1+t/25))*this.target.sugarConverted*this.target.sugarConverted;this.audio.setVolume(n),this.audio.play(),this.animation.set(this.growPulseAnimation(),dn.now/1e3)}this.lastAudioValueTracker=e}if(this.target instanceof mt&&null!=this.audio){var r=this.target.totalSucked;if(r!==this.lastAudioValueTracker){this.audio.setBuffer(Me);var a=this.target.pos.distanceToSquared(this.mito.world.player.pos),i=1*Math.min(1,1/(1+a/25));this.audio.setVolume(i),null!=this.audio.source&&this.audio.stop(),this.audio.play(),this.animation.set(this.growPulseAnimation(),dn.now/1e3)}this.lastAudioValueTracker=r}this.mesh.remove(this.pairsLines)}},{key:"lerpColorTemperature",value:function(e){var n=this.target.temperature,r=t.TEMPERATURE_COLORS[n];r!==this.temperatureColor&&(this.currentLerp=0);var a=n===me.Mild?0:.5;return this.temperatureColor=r,this.currentLerp=I(this.currentLerp,a,.1),e.lerp(this.temperatureColor,this.currentLerp),e}},{key:"updateHover",value:function(){var e=this;if(this.mesh.add(this.pairsLines),this.target.tilePairs instanceof Array){var t,n=this.target instanceof ft?16763150:new oe.Color("rgb(9, 12, 255)").getHex(),r=this.target.tilePairs;if(r.length!==this.pairsLines.children.length)(t=this.pairsLines).remove.apply(t,Object(g.a)(this.pairsLines.children)),r.forEach(function(t){var r=2*t.length()-.25,a=new oe.Vector3(t.x,t.y,0).normalize(),i=e.makeLine(a,a.clone().multiplyScalar(-r/2),r,n);e.pairsLines.add(i)})}if(this.hasActiveNeighbors(this.target)){var a,i=this.target instanceof mt?new oe.Color("rgb(9, 12, 255)").getHex():16777215,o=this.target.activeNeighbors;if(o.length!==this.pairsLines.children.length)(a=this.pairsLines).remove.apply(a,Object(g.a)(this.pairsLines.children)),o.forEach(function(t){var n=t.length()-.25,r=new oe.Vector3(t.x,t.y,0).normalize(),a=e.target instanceof mt?e.makeLine(r,new oe.Vector3,n,i):new oe.ArrowHelper(r,new oe.Vector3(0,0,5),n,i);e.pairsLines.add(a)})}}},{key:"growPulseAnimation",value:function(){var e,t=this,n=(e=Dr.a,function(t){return e(1-t)});return function(e){var r=G(e/.5*(t.target.tempo||1),0,1),a=z(n(r),0,1,1,1.3);return t.mesh.scale.setScalar(a),r>=1}}},{key:"hasActiveNeighbors",value:function(e){return Array.isArray(e.activeNeighbors)}},{key:"makeLine",value:function(e,n,r,a){var i=new oe.Line(t.lineGeometry,new oe.LineBasicMaterial({color:a}));if(i.position.copy(n),e.y>.99999)i.quaternion.set(0,0,0,1);else if(e.y<-.99999)i.quaternion.set(1,0,0,0);else{var o=new oe.Vector3(e.z,0,-e.x).normalize(),s=Math.acos(e.y);i.quaternion.setFromAxisAngle(o,s)}return i.scale.set(1,Math.max(0,r),1),i.position.z=.1,i.updateMatrix(),i.matrixAutoUpdate=!1,i}},{key:"destroy",value:function(){this.scene.remove(this.mesh),null!=this.worldDomElement&&this.mito.removeWorldDOMElement(this.worldDomElement),null!=this.inventoryRenderer&&this.inventoryRenderer.destroy(),null!=this.cellEffectsRenderer&&this.cellEffectsRenderer.destroy()}}]),t}(Mr);Vr.TEMPERATURE_COLORS=(Lr={},Object(ge.a)(Lr,me.Scorching,new oe.Color("orange")),Object(ge.a)(Lr,me.Hot,new oe.Color("orange").lerp(new oe.Color("white"),.5)),Object(ge.a)(Lr,me.Mild,new oe.Color("white")),Object(ge.a)(Lr,me.Cold,new oe.Color("lightblue").lerp(new oe.Color("white"),.5)),Object(ge.a)(Lr,me.Freezing,new oe.Color("lightblue")),Lr),Vr.ONE=new oe.Vector2(1,1),Vr.lineGeometry=function(){var e=new oe.BufferGeometry;return e.addAttribute("position",new oe.Float32BufferAttribute([0,0,0,0,1,0],3)),e}();var Hr=pr(function(){var e=new Map;return e.set(at,new oe.MeshBasicMaterial({side:oe.DoubleSide,depthWrite:!1})),e.set(it,new oe.MeshBasicMaterial({map:Ar(8,11),side:oe.DoubleSide,color:new oe.Color("rgb(112, 89, 44)"),depthWrite:!1})),e.set(lt,new oe.MeshBasicMaterial({map:Ar(3.5,2.375),side:oe.DoubleSide})),e.set(ot,new oe.MeshBasicMaterial({map:Ar(26,20),side:oe.DoubleSide,color:new oe.Color("rgb(63, 77, 84)")})),e.set(st,new oe.MeshBasicMaterial({map:Ar(8.5625,23.375),side:oe.DoubleSide,color:new oe.Color("rgb(128, 128, 128)")})),e.set(dt,new oe.MeshBasicMaterial({map:Ar(6,31),side:oe.DoubleSide,color:new oe.Color(3190309)})),e.set(yt,e.get(dt)),e.set(ft,new oe.MeshBasicMaterial({map:Ar(55/16,17.5),side:oe.DoubleSide})),e.set(mt,new oe.MeshBasicMaterial({map:Ar(59/16,327/16),side:oe.DoubleSide})),e.set(vt,new oe.MeshBasicMaterial({map:jr,side:oe.DoubleSide,transparent:!0})),e.set(gt,new oe.MeshBasicMaterial({map:Ar(Math.floor(11.5),Math.floor(9.5)),side:oe.DoubleSide})),e});var Ur=[new oe.Color("hsl(67, 31%, 25%)"),new oe.Color("hsl(180, 31%, 76%)"),new oe.Color("hsl(213, 63%, 58%)")],Zr=function(e){function t(e,n,r){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(f.a)(t).call(this,e,n,r))).arrow=void 0,a.arrow=a.makeArrow(a.target.dir),a.mesh.add(a.arrow),a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"makeArrow",value:function(e){var t=e.length()-.25,n=new oe.Vector3(e.x,e.y,0).normalize(),r=n.clone().multiplyScalar(-t/2);return new oe.ArrowHelper(n,new oe.Vector3(r.x,r.y,1),t,16777215,.1,.1)}}]),t}(Vr);function Jr(e,t,n){if(e instanceof Ue)return new Fr(e,t,n);if(e instanceof yt)return new Zr(e,t,n);if(e instanceof nt)return new Vr(e,t,n);throw new Error("Couldn't find renderer for ".concat(e))}var Kr=function(e){function t(e,n,r){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(f.a)(t).call(this,e,n,r))).renderers=new Map,a.deleteDeadEntityRenderers=Object(cr.a)(function(e){return e},function(e){var t=e.deleted,n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,c=a.renderers.get(l);if(null==c)throw new Error("Couldn't find renderer for ".concat(l,"!"));c.destroy(),a.renderers.delete(l)}}catch(u){r=!0,i=u}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}),n.add(Pr.WaterParticles()),n.add(Pr.SugarParticles()),a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"getOrCreateRenderer",value:function(e){var t=this.renderers.get(e);if(null==t){var n=Jr(e,this.scene,this.mito);return this.renderers.set(e,n),n}return t}},{key:"update",value:function(){var e=this;this.deleteDeadEntityRenderers(this.target.getLastStepStats()),Pr.startFrame(),this.target.entities().forEach(function(t){e.getOrCreateRenderer(t).update()}),Pr.endFrame()}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}}]),t}(Mr),qr=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xe/27;Object(u.a)(this,e),this.mito=t,this.pxPerTile=n,this.captureInterval=r,this.lastCaptureTime=0}return Object(h.a)(e,[{key:"isTimeForNewCapture",value:function(){return this.mito.world.time-this.lastCaptureTime>this.captureInterval}},{key:"capture",value:function(){var t=this,n=e.renderTarget,r=e.rtBuffer,a=e.rtCanvas;this.lastCaptureTime=this.mito.world.time;var i=Array.from(this.mito.world.cells()).filter(function(e){return e.pos.y<50&&!(e instanceof ht)}),o=this.getBounds(i),s=Object(c.a)(o,2),l=s[0],u=s[1],h=new oe.Scene,d=i.map(function(e){var n=Jr(e,h,t.mito);return n.update(),n}),f=this.cameraEncompassingBounds([l,u]),m=this.mito.renderer;m.setRenderTarget(n),m.clear(!0,!0,!0),m.render(h,f),m.setRenderTarget(null),m.readRenderTargetPixels(n,0,0,n.width,n.height,r);for(var v=a.getContext("2d"),p=v.createImageData(a.width,a.height),y=p.data,g=0;g<r.length;g++)y[g]=r[g];v.putImageData(p,0,0);var b=u.x-l.x,w=u.y-l.y,E=Math.max(b,w),k=z(b,0,E,0,1024),O=z(w,0,E,0,1024),j=new oe.Vector2(512-k/2,512-O/2),x=document.createElement("canvas");x.width=Math.ceil(b*this.pxPerTile),x.height=Math.ceil(w*this.pxPerTile),x.getContext("2d").drawImage(a,j.x,j.y,k,O,0,0,x.width,x.height);var A=new Image;return A.src=x.toDataURL(),document.body.appendChild(A),d.forEach(function(e){e.destroy()}),x}},{key:"getBounds",value:function(e){var t=new oe.Vector2,n=new oe.Vector2;null!=e[0]&&(t.copy(e[0].pos),n.copy(e[0].pos));var r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;t.min(l.pos),n.max(l.pos)}}catch(c){a=!0,i=c}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return t.subScalar(.5),n.addScalar(.5),[t,n]}},{key:"cameraEncompassingBounds",value:function(e){var t=Object(c.a)(e,2),n=t[0],r=t[1],a=n.clone().lerp(r,.5),i=r.x-n.x,o=r.y-n.y,s=Math.max(i,o);return new oe.OrthographicCamera(a.x-s/2,a.x+s/2,a.y+s/2,a.y-s/2,-100,100)}}]),e}();qr.renderTarget=new oe.WebGLRenderTarget(1024,1024),qr.rtBuffer=new Uint8Array(qr.renderTarget.width*qr.renderTarget.height*4),qr.rtCanvas=function(){var e=document.createElement("canvas");return e.width=qr.renderTarget.width,e.height=qr.renderTarget.height,e}();var Xr=qr,Qr={KeyQ:{type:"drop",sugar:0,water:1},KeyE:{type:"drop",sugar:1,water:0},Space:{type:"pickup",sugar:1,water:1}},_r={KeyW:{type:"move",dir:se.n},KeyA:{type:"move",dir:se.w},KeyS:{type:"move",dir:se.s},KeyD:{type:"move",dir:se.e}},$r={Digit1:0,Digit2:1,Digit3:2,Digit4:3,Digit5:4},ea=(Object.keys(_r).map(function(e){return _r[e]}),function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return r.createElement("div",{className:"mito-instructions"},r.createElement("div",{className:"mito-instructions-container"},r.createElement("div",{className:"esc",onClick:function(){return e.props.play()}},"Back (Esc)"),r.createElement("h1",null,"Mito"),r.createElement("div",{className:"play-button",onClick:function(){return e.props.play()}},"Play"),r.createElement("p",null,r.createElement("ol",null,r.createElement("li",null,"Build Tissue to expand your reach (press t and walk into empty space)."),r.createElement("li",null,"Build Roots (press r) underground to suck up adjacent water."),r.createElement("li",null,"Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar."),r.createElement("li",null,r.createElement("b",null,"Win the game by building and loading the Fruit with 1000 sugar.")),r.createElement("li",null,"Click around to see the different properties of each tile."),r.createElement("li",null,"Build leaves early."),r.createElement("li",null,"Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air."),r.createElement("li",null,"Explore underground for water reservoires and Fountains."),r.createElement("li",null,"Build transports (capital T) to carry water back up the plant."),r.createElement("li",null,"You can scroll out infinitely far."))),r.createElement("h3",null,"You"),r.createElement("p",null,"You can carry max ",U.maxResources," resources, and you automatically suck in any resources you're standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil below and air above."),r.createElement("h3",null,"Soil and Underground"),r.createElement("p",null,"Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a permanent source of water. Soil holds up to ",U.soilMaxWater," water at a time. Fountains emit one water per ",U.fountainTurnsPerWater," turns."),r.createElement("h3",null,"Air and Aboveground"),r.createElement("p",null,"Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun, which gently sways left to right."),r.createElement("h3",null,"Water"),r.createElement("p",null,"Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2 required) at about 1 unit per ",(1/U.soilDiffusionWater).toFixed(0)," turns. Obtain water in the ground through Roots. Leaves require water to photosynthesize. You require water to build."),r.createElement("h3",null,"Sugar"),r.createElement("p",null,"Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by putting water next to leaves. Cells require sugar to survive. You require sugar to build."),r.createElement("h3",null,"Building"),r.createElement("p",null,'Build Tissue, Leaves, Roots, and The Fruit by toggling "build mode" on and walking into Air or Soil. Build Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they\'re not properly supported underneath them.'),r.createElement("h3",null,"Cells"),r.createElement("p",null,"All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their neighbors. Each cell consumes 1 sugar every ",U.cellEnergyMax," turns."),r.createElement("h3",null,"Tissue"),r.createElement("p",null,"Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to"," ",U.tissueInventoryCapacity," resources."),r.createElement("h3",null,"Roots"),r.createElement("p",null,"Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is called a Pairing."),r.createElement("h3",null,"Leaves"),r.createElement("p",null,"When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per"," ",(1/U.leafReactionRate).toFixed(0)," turns per pair. Leaf efficiency is heavily influenced by co2 and sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize. Leaves higher up produce sugar faster."),r.createElement("h3",null,"Transport"),r.createElement("p",null,"Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you. Transport hungers at double speed."),r.createElement("h3",null,"The Fruit"),r.createElement("p",null,"You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to 1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity."),this.renderCredit()))}},{key:"renderCredit",value:function(){return r.createElement(r.Fragment,null,r.createElement("h2",null,"Attribution"),r.createElement("p",null,"Tiles:"," ",r.createElement("a",{href:"http://kenney.nl/assets?s=roguelike",target:"_blank",rel:"noopener noreferrer"},"Kenney.nl Roguelike Assets")),r.createElement("p",null,"Pop sound when leaves convert:"," ",r.createElement("a",{href:"http://soundbible.com/2067-Blop.html",target:"_blank",rel:"noopener noreferrer"},"Blop by Mark DiAngelo")," ","(",r.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/us/"},"CC BY 3.0 US"),")"),r.createElement("p",null,"Perlin noise:"," ",r.createElement("a",{href:"https://github.com/josephg/noisejs",target:"_blank",rel:"noopener noreferrer"},"josephg/noisejs")),r.createElement("p",null,"Part of 7drl 2018:"," ",r.createElement("a",{href:"http://7drl.org/",target:"_blank",rel:"noopener noreferrer"},"http://7drl.org/")),r.createElement("p",null,"Fruit icon:"," ",r.createElement("a",{href:"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm"},"Designed by Freepik")))}}]),t}(r.PureComponent)),ta=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).handlePlay=function(){n.props.mito.instructionsOpen=!1},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return this.props.mito.instructionsOpen?r.createElement(ea,{play:this.handlePlay}):null}}]),t}(r.PureComponent),na=(n(137),function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.tile;return e?r.createElement("div",{className:"tile-hover"},this.tileInfo(e),this.inventoryInfo(e),this.cellInfo(e),this.growingCellInfo(e),this.rootInfo(e),this.leafInfo(e),this.airInfo(e),this.fountainInfo(e)):null}},{key:"rootInfo",value:function(e){return e instanceof mt?r.createElement("div",{className:"info-root"},r.createElement("div",null,e.totalSucked," water collected."),r.createElement("div",null,e.cooldown.toFixed(0)," turns until next water suck.")):null}},{key:"leafInfo",value:function(e){return e instanceof ft?r.createElement("div",{className:"info-leaf"},r.createElement("div",null,e.totalSugarProduced," sugar produced."),r.createElement("div",null,(1/(e.averageSpeed*U.leafReactionRate)).toFixed(0)," turns per reaction."),r.createElement("div",null,(1/e.averageEfficiency).toFixed(2)," water per sugar.")):null}},{key:"airInfo",value:function(e){if(e instanceof at)return r.createElement("div",{className:"info-air"},r.createElement("div",null,"\u2600\ufe0f ",(100*e.sunlight()).toFixed(0),"%"),r.createElement("div",null,"\u2601\ufe0f ",(100*e.co2()).toFixed(0),"%"))}},{key:"fountainInfo",value:function(e){if(e instanceof lt)return r.createElement("div",{className:"info-fountain"},r.createElement("div",null,e.turnsPerWater," turns per water"))}},{key:"tileInfo",value:function(e){var t=tt(e)?r.createElement("span",{className:"info-energy"},"\ud83d\udc9a",(e.energy/U.cellEnergyMax*100).toFixed(0),"%"):null;return r.createElement("div",{className:"info-tile"},r.createElement("div",{className:"info-tile-name"},e.constructor.displayName),this.temperatureInfo(e),t)}},{key:"temperatureInfo",value:function(e){function t(e){var t=e.color,n=void 0===t?"black":t,a=e.left,i=void 0===a?0:a,o=e.width,s=void 0===o?3:o;return r.createElement("div",{style:{position:"absolute",top:-1,left:i,width:1,bottom:0,borderRight:"".concat(s,"px solid ").concat(n)}})}function n(e){var t=e.children,n=e.fontWeight,a=void 0===n?"normal":n,i=e.left;return r.createElement("div",{style:{position:"absolute",left:i,width:"".concat(32,"%"),textAlign:"center",fontSize:12,fontWeight:a,fontFamily:"Arial"}},t)}return r.createElement("div",{className:"info-tile-temperature"},r.createElement("div",{style:{width:200,height:"1.15em",border:"1px solid grey",position:"relative"}},r.createElement(t,{left:"".concat(32,"%"),color:"lightblue"}),r.createElement(n,{left:0,fontWeight:e.temperature===me.Cold?"bold":"normal"},me.Cold),r.createElement(t,{left:"".concat(64,"%"),color:"orange"}),r.createElement(n,{left:"".concat(32,"%"),fontWeight:e.temperature===me.Mild?"bold":"normal"},me.Mild),r.createElement(n,{left:"".concat(64,"%"),fontWeight:e.temperature===me.Hot?"bold":"normal"},me.Hot),r.createElement(t,{left:"".concat(e.temperatureFloat/100*100,"%"),color:"black",width:3}),r.createElement("div",{style:{position:"absolute",left:"".concat(e.temperatureFloat/100*100,"%"),transform:"translateX(-50%)",top:"-1.5em",textAlign:"center",fontSize:12,fontWeight:"bold",fontFamily:"Arial"}},e.temperatureFloat.toFixed(0)," \xb0F")))}},{key:"inventoryInfo",value:function(e){if(de(e)){var t=e.inventory.water>0?r.createElement("div",{className:"info-inventory-item"},"\ud83d\udca7 ",e.inventory.water.toFixed(2)):null,n=e.inventory.sugar>0?r.createElement("div",{className:"info-inventory-item"},"Sugar ",e.inventory.sugar.toFixed(2)):null;return r.createElement("div",{className:"info-inventory"},t,n)}}},{key:"cellInfo",value:function(e){if(e instanceof ut)return r.createElement(r.Fragment,null,200*e.droopY>1?r.createElement("div",{className:"info-cell"},(200*e.droopY).toFixed(0),"% droop"):null,this.cellEffects(e))}},{key:"cellEffects",value:function(e){var t=e.effects;if(t.length>0){var n=t.map(function(e){var t=e.constructor.displayName;return e instanceof ct?"".concat((100*e.percentFrozen).toFixed(0),"% ").concat(t):t}).join(", ");return r.createElement("div",{className:"info-cell"},n)}return null}},{key:"growingCellInfo",value:function(e){if(e instanceof ht)return r.createElement("div",{className:"info-growing-cell"},(100-e.timeRemaining/e.timeToBuild*100).toFixed(0),"% mature")}}]),t}(r.Component));n(138);function ra(e){var t=e.type,n=e.hotkey,a=e.isSelected,i=e.onClick,o=e.spritesheetLoaded,s=r.useMemo(function(){var e=Hr().get(t),n=e.map.image,r=e.color.getStyle(),a=null!=n?n instanceof HTMLCanvasElement&&o?n.toDataURL():n instanceof Image?n.src:"":"";return{backgroundImage:"url(".concat(a,"), linear-gradient(").concat(r,", ").concat(r,")")}},[o,t]);return r.createElement("div",{className:cn()("cell-bar-item",{selected:a})},r.createElement("div",{className:"cell-bar-item-icon",onClick:i,style:s},t.displayName),r.createElement(aa,{hotkey:n,onClick:i}))}function aa(e){var t=e.hotkey,n=e.onClick,a=Object(vn.a)(e,["hotkey","onClick"]);return r.createElement("div",Object.assign({className:"mito-hud-button mito-hud-build-item",onClick:function(e){n&&n(e),function(e){e.preventDefault(),document.getElementsByTagName("canvas")[0].focus()}(e)}},a),r.createElement("span",{className:"mito-hud-button-hotkey"},t))}var ia=function(e){var t=e.bar,n=e.index,a=e.onIndexClicked;return r.createElement("div",{className:"cell-bar"},t.map(function(e,t){return r.createElement(ra,{key:t,hotkey:String(t+1),type:e,isSelected:n===t,onClick:function(){return a(t)},spritesheetLoaded:kr})}))};n(139),n(140);function oa(e){var t=e.time,n=e.season,a=t/qe;return r.createElement("div",{className:"seasons-tracker"},r.createElement("div",{className:"container"},r.createElement("div",{className:"end-brace"}),r.createElement("div",{className:"bar"},r.createElement(sa,{percent:.25}),r.createElement(sa,{percent:.5}),r.createElement(sa,{percent:.75}),r.createElement(la,{percent:a})),r.createElement("div",{className:"end-brace"})),r.createElement("div",{className:"season-display"},Ke(n)))}function sa(e){var t=e.percent,n={left:"".concat((100*t).toFixed(2),"%")};return r.createElement("div",{className:"bar-marker",style:n})}function la(e){var t=e.percent,n={left:"".concat((100*t).toFixed(2),"%")};return r.createElement("div",{className:"season-bead",style:n})}var ca=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).state={traitsPanelOpen:!0},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"isTutorialFinished",value:function(){return null==this.mito.tutorialRef||this.mito.tutorialRef.isFinished()}},{key:"render",value:function(){var e=this,t=this.inventory.isMaxed(),n=r.createElement("div",{className:"mito-inventory-maxed".concat(t?" is-maxed":"")},"maxed");return r.createElement(r.Fragment,null,r.createElement(oa,{time:this.world.time,season:this.world.season}),this.maybeRenderTraits(),r.createElement("div",{className:cn()("mito-inventory",{hidden:!1})},n,r.createElement("div",{className:"mito-inventory-container"},this.renderInventoryBar(),this.renderInventory()),r.createElement(ia,{bar:this.mito.cellBar,index:this.mito.cellBarIndex,onIndexClicked:function(t){return e.mito.setCellBarIndex(t)}})))}},{key:"maybeRenderTraits",value:function(){if(this.state.traitsPanelOpen&&(e=this.world.traits,$.some(function(t){return 0!==e[t]})))return r.createElement("div",{className:"hud-panel-right"},r.createElement(On,{traits:this.world.traits}));var e}},{key:"renderInventory",value:function(){return r.createElement("div",{className:"mito-inventory-indicator"},r.createElement("span",{className:"mito-inventory-water"},r.createElement(mn,{speed:.5,value:this.inventory.water})," water"),"\xa0",r.createElement("span",{className:"mito-inventory-sugar"},r.createElement(mn,{speed:.5,value:this.inventory.sugar})," sugar"))}},{key:"renderInventoryBar",value:function(){var e=this.inventory.water/U.maxResources,t=this.inventory.sugar/U.maxResources,n=1-(this.inventory.water+this.inventory.sugar)/U.maxResources,a={width:"".concat(100*e,"%")},i={width:"".concat(100*t,"%")},o={width:"".concat(100*n,"%")};return r.createElement("div",{className:"mito-inventory-bar"},r.createElement("div",{style:a,className:"mito-inventory-bar-water"}),r.createElement("div",{style:i,className:"mito-inventory-bar-sugar"}),r.createElement("div",{style:o,className:"mito-inventory-bar-empty"}))}},{key:"mito",get:function(){return this.props.mito}},{key:"world",get:function(){return this.mito.world}},{key:"player",get:function(){return this.world.player}},{key:"inventory",get:function(){return this.player.inventory}}]),t}(r.Component),ua=n(70),ha=(r.Component,function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.props.parent.add(this.props.object)}},{key:"componentWillUnmount",value:function(){this.props.parent.remove(this.props.object)}}]),t}(r.PureComponent)),da=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).rafid=void 0,n.animate=function(e){n.props.a(e/1e3)},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.rafid=dn.addAnimation(this.animate)}},{key:"componentWillUnmount",value:function(){this.rafid&&dn.removeAnimation(this.rafid)}}]),t}(a.a.Component),fa=pr(function(){var e=new oe.PlaneBufferGeometry(1,1),t=new oe.EdgesGeometry(e,1),n=new oe.LineBasicMaterial({color:16777215,transparent:!0,opacity:.75}),r=new oe.LineSegments(t,n);return r.position.z=10,r}),ma=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).object=fa().clone(),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(da,{a:function(t){return e.object.scale.setScalar(.04*Math.sin(3.7*t)+.94)}}),r.createElement(ha,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),va=pr(function(){var e=new oe.CircleBufferGeometry(.1,20),t=new oe.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.75,side:oe.DoubleSide}),n=new oe.Mesh(e,t);return n.position.z=10,n}),pa=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(a)))).object=va().clone(),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(ha,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),ya=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.mito.highlightedTile,t=this.props.mito.getHighlightPosition();return r.createElement(r.Fragment,null,r.createElement(na,{tile:e}),r.createElement(pa,{x:t.x,y:t.y,scene:this.scene}),this.maybeRenderTileHighlight(e))}},{key:"maybeRenderTileHighlight",value:function(e){if(e)return r.createElement(ma,{x:e.pos.x,y:e.pos.y,scene:this.scene})}},{key:"scene",get:function(){return this.props.mito.scene}}]),t}(r.Component),ga=function(){function e(t,n,r){Object(u.a)(this,e),this.mito=t,this.positionFn=n,this.renderFn=r}return Object(h.a)(e,[{key:"render",value:function(){var e=this.positionFn(),t=this.mito.worldToScreen(e),n={left:t.x,top:t.y};return a.a.createElement("div",{style:n},this.renderFn())}}]),e}(),ba=function(e){function t(e,n,r,a){var i;return Object(u.a)(this,t),(i=Object(d.a)(this,Object(f.a)(t).call(this,e,n))).onWinLoss=a,i.world=void 0,i.scene=new oe.Scene,i.camera=new oe.OrthographicCamera(0,0,0,0,-100,100),i.cellBar=[dt,ft,mt,yt,vt],i.cellBarIndex=0,i.tutorialRef=null,i.mouse=new oe.Vector2,i.mouseDown=!1,i.mouseButton=-1,i.instructionsOpen=!1,i.firstActionTakenYet=!1,i.audioListener=new oe.AudioListener,i.keyMap=new Set,i.highlightedTile=void 0,i.events={contextmenu:function(e){return e.preventDefault(),!1},mousemove:function(e){i.mouse.x=e.clientX,i.mouse.y=e.clientY},click:function(){},mousedown:function(e){i.mouseButton=e.button,i.mouseDown=!0},mouseup:function(){i.mouseDown=!1},keydown:function(e){i.firstActionTakenYet=!0;var t=e.code;i.keyMap.add(t),e.repeat||i.handleKeyDown(t)},keyup:function(e){i.keyMap.delete(e.code)},wheel:function(e){if(e.shiftKey){var t=-(e.deltaX+e.deltaY)/125/20,n=i.camera.zoom*Math.pow(2,t);i.camera.zoom=n,i.camera.updateProjectionMatrix()}else e.deltaX+e.deltaY<0?i.setCellBarIndex(i.cellBarIndex-1):i.setCellBarIndex(i.cellBarIndex+1)}},i.worldRenderer=void 0,i.vignetteCapturer=new Xr(Object(X.a)(i)),i.vignettes=[],i.handleKeyDown=function(e){"Slash"!==e?i.instructionsOpen?"Escape"===e&&(i.instructionsOpen=!1):null!=$r[e]&&(i.cellBarIndex=$r[e]):i.instructionsOpen=!i.instructionsOpen},i.worldDomElements=new Set,i.world=new $e(r.targetHex.info.environment,r.settlingSpecies),i.camera.position.z=10,i.camera.lookAt(new oe.Vector3(0,0,0)),i.camera.position.x=i.world.player.pos.x,i.camera.position.y=i.world.player.pos.y,i.camera.zoom=1.5,i.camera.add(i.audioListener),i.worldRenderer=new Kr(i.world,i.scene,Object(X.a)(i)),function(e){var t=0;function n(){3===++t&&(Ee.audio.currentTime=0,ke.audio.currentTime=0,Oe.audio.currentTime=0,Ee.gain.connect(e.gain),ke.gain.connect(e.gain),Oe.gain.connect(e.gain))}(Ee=He(e,Te.a)).audio.oncanplaythrough=n,Ee.gain.gain.value=.5,(ke=He(e,Pe.a)).audio.oncanplaythrough=n,ke.gain.gain.value=0,(Oe=He(e,Fe.a)).audio.oncanplaythrough=n,Oe.gain.gain.value=0,(je=He(e,Be.a)).gain.gain.value=0,je.gain.connect(e.gain),(xe=He(e,Ie.a)).gain.gain.value=0,xe.gain.connect(e.gain);var r=new oe.AudioLoader;r.load(ze.a,function(e){Ae=e},function(e){},function(e){}),r.load(Ye.a,function(e){Me=e},function(e){},function(e){})}(i.audioContext),i.updateAmbientAudio(),i.attachWindowEvents(),window.mito=Object(X.a)(i),window.THREE=oe,i}return Object(m.a)(t,e),Object(h.a)(t,[{key:"selectedCell",get:function(){return this.cellBar[this.cellBarIndex]}}]),Object(h.a)(t,[{key:"attachWindowEvents",value:function(){var e=this;window.addEventListener("blur",function(){e.keyMap.clear()})}},{key:"setCellBarIndex",value:function(e){this.cellBarIndex=(e%this.cellBar.length+this.cellBar.length)%this.cellBar.length}},{key:"render",value:function(){var e=[],t=!0,n=!1,a=void 0;try{for(var i,o=this.worldDomElements[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;e.push(s.render())}}catch(l){n=!0,a=l}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}return r.createElement(r.Fragment,null,r.createElement(ca,{mito:this}),r.createElement(ta,{mito:this}),r.createElement(ya,{mito:this}),r.createElement("div",{className:"world-dom-components"},e),null)}},{key:"updateAmbientAudio",value:function(){var e=this.world.player.pos.y,t=z(e,this.world.height/2,this.world.height,0,.5),n=z(e,this.world.height/2,0,0,.5);Oe.gain.gain.value=Math.max(0,t),ke.gain.gain.value=Math.max(0,n)}},{key:"logRenderInfo",value:function(){console.log("Geometries in memory: ".concat(this.renderer.info.memory.geometries,"\nTextures in memory: ").concat(this.renderer.info.memory.textures,"\nNumber of Programs: ").concat(this.renderer.info.programs.length,"\n# Render Calls: ").concat(this.renderer.info.render.calls,"\n# Render Lines: ").concat(this.renderer.info.render.lines,"\n# Render Points: ").concat(this.renderer.info.render.points,"\n# Render Tris: ").concat(this.renderer.info.render.triangles,"\n"))}},{key:"perfDebug",value:function(){var e=0,t=0;this.scene.traverse(function(n){n.matrixAutoUpdate?e++:t++}),console.log("matrixAutoUpdate: yes",e,", no",t);var n=new Map;this.scene.traverse(function(e){var t=n.get(e.name||e.constructor.name)||[];n.set(e.name||e.constructor.name,t),t.push(e)}),console.log(n)}},{key:"worldStep",value:function(e){if(this.firstActionTakenYet&&!this.instructionsOpen){if(this.world.step(e),this.vignetteCapturer.isTimeForNewCapture()){var t=this.vignetteCapturer.capture();this.vignettes.push(t)}this.tutorialRef&&this.tutorialRef.setState({time:this.world.time});var n=this.world.maybeGetGameResult();null!=n&&this.onWinLoss(n),this.updateAmbientAudio()}}},{key:"getCameraNormCoordinates",value:function(e,t){return new oe.Vector2(e/this.canvas.width*2-1,-t/this.canvas.height*2+1)}},{key:"getHighlightVector",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=new oe.Vector2(e-this.canvas.width/2,t-this.canvas.height/2);return n.setLength(.75),n}},{key:"getHighlightPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightVector(e,t),r=this.world.player.posFloat,a=r.x,i=r.y;return n.x+=a,n.y+=i,n}},{key:"getHighlightedTile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightPosition(e,t);n.round();var r=this.world.tileAt(n.x,n.y);if(null!=r&&r.lightAmount()>0)return r}},{key:"worldToScreen",value:function(e){var t=new oe.Vector3(e.x,e.y,0);return t.project(this.camera),t.x=Math.round((.5+t.x/2)*this.canvas.width),t.y=Math.round((.5-t.y/2)*this.canvas.height),t}},{key:"addWorldDOMElement",value:function(e,t){var n=new ga(this,e,t);return this.worldDomElements.add(n),n}},{key:"removeWorldDOMElement",value:function(e){this.worldDomElements.delete(e)}},{key:"animate",value:function(e){if(!this.instructionsOpen){this.canvas.focus();var t=Math.min(1*e/30,10);if(U.isRealtime){var n=this.keysToMovement(this.keyMap);n&&this.world.player.setAction(n);var r=!0,a=!1,i=void 0;try{for(var o,s=this.keyMap[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;Qr[l]&&this.world.player.setAction(Qr[l])}}catch(h){a=!0,i=h}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}this.mouseDown&&(0===this.mouseButton?this.handleLeftClick():2===this.mouseButton&&this.handleRightClick()),this.worldStep(t)}else null!=this.world.player.getAction()&&this.worldStep(t);this.worldRenderer.update(),this.highlightedTile=this.getHighlightedTile(),null!=this.highlightedTile&&this.worldRenderer.getOrCreateRenderer(this.highlightedTile).updateHover();var c=this.getCameraNormCoordinates(this.mouse.x,this.mouse.y),u=new oe.Vector2(this.world.player.posFloat.x+c.x/2,this.world.player.posFloat.y-c.y/2);L(this.camera.position,u,.3),this.renderer.render(this.scene,this.camera),Boolean(Object(V.parse)(window.location.search).debug)&&this.frameCount%100===0&&this.logRenderInfo()}}},{key:"keysToMovement",value:function(e){var t=new oe.Vector2,n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;_r[s]&&t.add(_r[s].dir)}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return 0===t.x&&0===t.y?null:{type:"move",dir:t}}},{key:"resize",value:function(e,t){var n=t/e;this.camera.left=-12/n,this.camera.right=12/n,this.camera.top=-12,this.camera.bottom=12,this.camera.updateProjectionMatrix()}},{key:"handleRightClick",value:function(){var e=this.getHighlightedTile();if(null!=e){if(e instanceof vt)return;this.world.player.setAction({type:"deconstruct",position:e.pos})}}},{key:"handleLeftClick",value:function(){this.firstActionTakenYet=!0;var e=this.getHighlightedTile();if(null!=e)if(this.world.player.isBuildCandidate(e,this.selectedCell)){var t=[];if(this.selectedCell===yt){var n=this.getHighlightVector().setLength(1).round();t.push(n)}var r={type:"build",cellType:this.selectedCell,position:e.pos.clone(),args:t};this.world.player.setAction(r)}else if(ye(e)){var a={type:"interact",interactable:e};return void this.world.player.setAction(a)}}}]),t}(hr);ba.id="mito",ba.expansionTiles=[dt,mt,gt];var wa=ba;n(141);function Ea(){return r.createElement("div",{className:"glow"},r.createElement("span",null))}function ka(e){var t=e.fruit;return r.createElement("div",{className:"fruit-info"},r.createElement("div",{className:"fruit-visual"},t.isMature()?r.createElement(Ea,null):null,r.createElement("img",{alt:"",src:wr.a})),t.isMature()?r.createElement(r.Fragment,null,r.createElement("span",{className:"matured-info success"},"Matured"),"\xa0at ",t.timeMatured,", Mutation Points earned: 1"):r.createElement("span",{className:"matured-info in-progress"},(100*t.getPercentMatured()).toFixed(0),"% maturity"),", started ",t.timeMade,".")}function Oa(e){var t=e.results,n=t.fruits.filter(function(e){return e.isMature()});return r.createElement(r.Fragment,null,r.createElement("div",{className:"character-party-container"},r.createElement(gn,{size:"large"})),r.createElement("h1",null,"You ",n.length>=3?"thrived":"survived","!"),r.createElement("h2",null,t.mutationPointsPerEpoch," Mutation Points earned."),r.createElement("h5",null,"Fruit Made"),r.createElement("div",{className:"fruit-list"},t.fruits.map(function(e){return r.createElement(ka,{fruit:e})})))}function ja(e){var t=e.results;return r.createElement(r.Fragment,null,r.createElement("h1",null,"You died!"),r.createElement("div",null,"You survived until ",Ke(t.world.season),"!"))}function xa(e){var t=e.onDone,n=e.results;return r.createElement("div",{className:"game-results-screen ".concat(n.status)},r.createElement("div",{className:"game-results-content"},"won"===n.status?r.createElement(Oa,{onDone:t,results:n}):r.createElement(ja,{onDone:t,results:n}),r.createElement("button",{className:"done-button",onClick:t},"Continue \u2192")))}function Aa(e){var t=e.children,n=e.appState,r=a.a.useMemo(function(){return function(e){return console.log("new reducer made"),function(t,n){var r=e(t,n);return sn.hasOwnProperty(n.type)&&(console.log("saved from",n),an(r)),r}}(M)},[]),i=a.a.useReducer(r,n);return a.a.createElement(x.Provider,{value:i},t)}var Ma=function(e){var t=e.children,n=e.loadingComponent,i=void 0===n?null:n,o=a.a.useState(null),s=Object(c.a)(o,2),l=s[0],u=s[1];return Object(r.useEffect)(function(){(function(){return on.apply(this,arguments)})().then(function(e){console.log("loaded",e),e&&u(e)}).catch(function(){console.log("caught"),u(function(){var e=Qt.generateRectangle(100,50),t=O("plantum originus");return{overWorld:e,rootSpecies:t,epoch:0}}())})},[]),null==l?i:a.a.createElement(Aa,{appState:l},t)};var Ca=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(d.a)(this,Object(f.a)(t).call(this,e,n))).context=void 0,r.handleMousePosition=function(e){r.setState({mousePosition:{x:e.clientX,y:e.clientY}})},r.handlePopulationAttempt=function(e,t,n){var a={settlingSpecies:t,sourceHex:n,targetHex:e};(0,Object(c.a)(r.context,2)[1])({type:"AAStartPopulationAttempt",populationAttempt:a})},r.handleNextEpoch=function(){(0,Object(c.a)(r.context,2)[1])({type:"AANextEpoch"})},r.handleWinLoss=function(e){(0,Object(c.a)(r.context,2)[1])({type:"AAGetGameResult",result:e})},r.handleResultsDone=function(){(0,Object(c.a)(r.context,2)[1])({type:"AAGameResultDone"})},r.otherArgsSelector=Object(cr.a)(function(e){return e.activePopulationAttempt},function(e){return[e,r.handleWinLoss]}),r.state={mousePosition:{x:window.innerWidth/2,y:window.innerHeight/2}},r}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("mousemove",this.handleMousePosition)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.handleMousePosition)}},{key:"render",value:function(){return a.a.createElement(v.Provider,{value:this.state.mousePosition},a.a.createElement("div",{className:"App"},this.maybeRenderOverWorld(),this.maybeRenderInGame(),this.maybeRenderGameResult()))}},{key:"maybeRenderOverWorld",value:function(){if(null==Object(c.a)(this.context,1)[0].activePopulationAttempt)return a.a.createElement(lr,{onPopulationAttempt:this.handlePopulationAttempt,onNextEpoch:this.handleNextEpoch})}},{key:"maybeRenderInGame",value:function(){var e=Object(c.a)(this.context,1)[0];if(null!=e.activePopulationAttempt&&null==e.activeGameResult)return a.a.createElement(vr,{sketchClass:wa,otherArgs:this.otherArgsSelector(e)})}},{key:"maybeRenderGameResult",value:function(){var e=Object(c.a)(this.context,1)[0];if(null!=e.activeGameResult)return a.a.createElement(xa,{results:e.activeGameResult,onDone:this.handleResultsDone})}}]),t}(a.a.PureComponent);Ca.contextType=x;var Sa=function(){return a.a.createElement(Ma,{loadingComponent:a.a.createElement("div",null,"Loading...")},a.a.createElement(Ca,null))};n(142),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ta=function(){function e(t){Object(u.a)(this,e),this.visitors=t,this.trials=[]}return Object(h.a)(e,[{key:"recordDataFor",value:function(e){var t=function(e,t){for(var n=Array.from(e.environmentTiles()),r={},a=0,i=Object.entries(t);a<i.length;a++){var o=i[a],s=Object(c.a)(o,2),l=s[0],u=(0,s[1])(n,e);r[l]=u}return r}(e,this.visitors);this.trials.push(t)}},{key:"visitorNames",value:function(){return Object.keys(this.visitors)}}]),e}(),Ra=function(){function e(t){Object(u.a)(this,e),this.experiments=t}return Object(h.a)(e,[{key:"recordDataFor",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.experiments[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.recordDataFor(e)}}catch(o){n=!0,r=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}}]),e}();function Pa(e,t){console.log("running");for(var n=new Ra([new Ta({countAir:function(e){return e.filter(function(e){return e.constructor===at}).length}}),new Ta({countSoil:function(e){return e.filter(function(e){return e.constructor===it}).length}}),new Ta({countRock:function(e){return e.filter(function(e){return e.constructor===ot}).length}}),new Ta({countFountain:function(e){return e.filter(function(e){return e.constructor===lt}).length}}),new Ta({playerY:function(e,t){return t.player.pos.y}}),new Ta({startAdjacentWaters:function(e,t){var n=function(e,t){var n,r=new Set,a=!0,i=!1,o=void 0;try{for(var s,l=e.entities()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var u=s.value;if(u instanceof nt&&(n=u,e.player.isWalkable(n))){var h=!0,d=!1,f=void 0;try{for(var m,v=e.tileNeighbors(u.pos)[Symbol.iterator]();!(h=(m=v.next()).done);h=!0){var p=m.value,y=Object(c.a)(p,2)[1];y instanceof dt||y.isObstacle||(null==t?r.add(y):t(y)&&r.add(y))}}catch(g){d=!0,f=g}finally{try{h||null==v.return||v.return()}finally{if(d)throw f}}}}}catch(g){i=!0,o=g}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r}(t,function(e){return e instanceof it}),r=0,a=!0,i=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var u=s.value;de(u)&&(r+=u.inventory.water)}}catch(h){i=!0,o=h}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r}}),new Ta({countWaters:function(e){return e.reduce(function(e,t){return e+(de(t)?t.inventory.water:0)},0)}})]),r=0;r<20;r++){console.time("trial "+r);var a=new $e(e(),O());n.recordDataFor(a),console.timeEnd("trial "+r)}!function(e,t){var n=[],r=e.map(function(e){return e.visitorNames().join("")});for(var a in r){for(var i=r[a],o=[],s=[],l=0;l<e[0].trials.length;l++){o.push(l);var c=e[a],u=c.trials[l],h=u[i];s.push(h)}var d={x:o,y:s,name:i,type:"bar"};n.push(d)}var f=document.createElement("div");document.getElementById(t).appendChild(f),window.Plotly.newPlot(f,n,{barmode:"stack"})}(n.experiments.slice(0,4),t);var i=!0,o=!1,s=void 0;try{for(var l,u=n.experiments[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){Na(l.value,t)}}catch(h){o=!0,s=h}finally{try{i||null==u.return||u.return()}finally{if(o)throw s}}}function Na(e,t){var n=[],r={},a=!0,i=!1,o=void 0;try{for(var s,l=function(){var t=s.value;u={x:e.trials.map(function(e){return e[t]}),type:"histogram",name:t},n.push(u),r.title={text:t}},c=e.visitorNames()[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var u;l()}}catch(d){i=!0,o=d}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}var h=document.createElement("div");document.getElementById(t).appendChild(h),h.style.height="240px",h.style.width="320px",h.style.display="inline-block",window.Plotly.newPlot(h,n,r)}var Fa=function(){return a.a.useEffect(function(){var e=document.createElement("script");e.src="https://cdn.plot.ly/plotly-latest.min.js",e.addEventListener("load",function(){Pa(Gt,"temperate"),Pa(Vt,"rocky"),Pa(Yt,"desert")}),document.body.appendChild(e)},[]),a.a.createElement("div",null,a.a.createElement("h1",null,"Experiments"),a.a.createElement("div",{id:"temperate"},a.a.createElement("h2",null,"Temperate")),a.a.createElement("div",{id:"rocky"},a.a.createElement("h2",null,"Rocky")),a.a.createElement("div",{id:"desert"},a.a.createElement("h2",null,"Desert")))};o.a.render(a.a.createElement(s.a,null,a.a.createElement(l.d,null,a.a.createElement(l.b,{path:"/test-win"},a.a.createElement(function(){var e=new $e(Gt(),O());e.time=150;var t=new vt(new oe.Vector2(0,0),e);t.committedResources.add(50,50),t.timeMatured=250,e.time=479;var n=new vt(new oe.Vector2(0,0),e);n.committedResources.add(25,15),e.time=1296;var r=new vt(new oe.Vector2(0,0),e);r.committedResources.add(50,50);var i={status:"won",fruits:[t,n,r],mutationPointsPerEpoch:2,world:e};return a.a.createElement(xa,{results:i,onDone:function(){}})},null)),a.a.createElement(l.b,{path:"/test-stats"},a.a.createElement(Fa,null)),a.a.createElement(l.b,{exact:!0,path:"/"},a.a.createElement(Sa,null)),a.a.createElement(l.b,{path:"*"},a.a.createElement(l.a,{to:"/"})))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},37:function(e,t,n){e.exports=n.p+"static/media/fruit.e136487f.png"},56:function(e,t,n){e.exports=n.p+"static/media/mito-base.28ee2cbb.mp3"},57:function(e,t,n){e.exports=n.p+"static/media/mito-strings.9f30639c.mp3"},58:function(e,t,n){e.exports=n.p+"static/media/mito-drums.1c82b4f4.mp3"},59:function(e,t,n){e.exports=n.p+"static/media/footsteps.636605b0.wav"},60:function(e,t,n){e.exports=n.p+"static/media/build.a2067d20.wav"},61:function(e,t,n){e.exports=n.p+"static/media/Blop-Mark_DiAngelo-79054334.627c0e8b.mp3"},62:function(e,t,n){e.exports=n.p+"static/media/suckwater.b0fe81fa.wav"},63:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAQCAYAAADJViUEAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAACC2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KD0UqkwAAAM1JREFUKBVjYBgowIjL4v50+/8wucKZB7GqwxCEadJSkYfpZbh25yGYjW4IimaQRpimSbL8cM15jz+C2SBDkA1ggqtAYiBrBAmj82FK4TbDbF2qowSWe/vxLUwNgzC/MJgdfeUe2Asw27HajKwRpAudDzMVq2aYJCGaepr5JSH+hfkRZjOMD5OHicMDDCSAHmgwRSAaPbBAYhjOBpmehQhokBowH91WkDiKzSABWAqztHUEccHg+OH9YBoWRVBhTM0wCZghID66JpgaimgAWfxCZhIsrg0AAAAASUVORK5CYII="},68:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAYAAABloJjNAAAFJklEQVRIS62We2xTVRzHv+e2ty0bfa223VMjMEjWTXyuBmOIsCiYIGCMRpYoiSYIGjSOmGE0gCSogcnDR0biwIQoCmqmLg4msP2xBLYYQmCj4GOKjLmue/Tlut3b3mPOvbT3di2tiTt/9fZ3ft/+fp/z7e9cgv+wpt4nFD7A9Bkl+bbn3SDshqriA/hDyJmTX7B7JSVn25XCZkOQ6YjdKyla2sEfzl0d25u1Qi0zzyflFJJKrv+VQZKLaYaguBs0le4DFteUQppWFS9wfujIzS1ZEKQEaa+5k9RGHhG7V1CcPZFiVrOoBPuqpuTn1/qNuPDQ3dCdU+PskJK5GS2roiqzo2230R19elnw7YUC6p8cJ2L34xQtP8pMtWJZGXZ13kFPBubKAkvMUTQOJABJpfBBtQFdgQI5XmcLYfmjg2nYMhhuPeaha0qikKZFtEcd+PqPsTSGa+c58ExFFJFoHB3RIuxceym7IO2x9BFvuJoJPuscg5MXcWCoGK3XxnG4JiZXtP6CCUxwc+kwAiKPowEH3n26nyRzszC0fH8maFl1KmiFw12IZYnr6IuK2HVZYbi1UkCN3Yjjo0WwOubgvrgfdfbQD6Q2/ETSGWnl0nPmhq5J+56OUbMcX2oN45fYNJqv8fLzhnIB1UWFOBUoTDFcZgltIQ9GmjIEaY/lC+INr2MtP1UcAp+I45uwC8cHRrFrnmKbRp9Bbnl9RRDBSYq2sENmmMxNa5n2WPzEG3YzwRfcAbh5EbsGS9F6fQKt90zKgqt7FYZvlg/BL/Jo8TuTDOXcTIY9ls9PBy3rToessDsLsFS6AV9UwHs+heEbCwR47Ca0jtlhsZvwgOTHcluYdVafnWGPZVtX1La9Y0xhyHx2ZVLAx38qgi9XCPAUFSLp0+XWEBPcTrzhHdkYniLecJ1sG/cECiHiSKgEx34fxUcLFdtsumSUW95YMYbxGPBt2Il31sgM5dyZDIeJN1zMBF90j8AlMyzDsZ9HcGKFiFW9JllUYXgDIyKPT/2uJEM5NwtDc/OZkHUD86G1yISH8TcuRwQ0XVVaZqvlfg5t43bMtRpRiwDqbMGDxBt5KTvDXuuezoi14aebDB+zhXA1No39A4oPN98u4AYpQTyujDPGeJkt0kRqQ1syGfZaL5La0F2s5eddo7Dp4zg4UY6vfgvgiEexTf15xTY6HYd6xwi+DLmxY/VFQm/mZrTMvmCCz7lGYdfHsX+oGMfPj0Bv06VaZoKvlg7LMbbYfzkVzHYFnO4op4yh2WbEEoxgU7+UNm2a79XjZNCKArMBkxEhtyDtMTdX91o2SII6/xoqRTT9qjB8/U4Be/8ygiY0t0TD0C3Hl3z0VftKqTSl3iGckcN3ixWGzDqE50BFNX6lcTh3y/MbnZTXMItHJOjNXApTYlKCrkB9ziuYrULtrZe3Qs+HZTQtwcCBCmpLMwWInoDGVYaEI6CaO4dU7S+jUiyRaokzcZjJMFeFGT8wv9FFeZvKJIPZPxJ0hWpcilFwc9RzYI7gDOrz7FfoOVCWZhNi5EA1rx7EQEA1viQ8ARVVhtARQOPL2a9wwVsuqp+r9RmFrkBlkohR6LTMpik4oxpn1bKqU9Nm1k+5ijHU2saogzStsZGBg5TLlzqS9t+efYaV29w0jdEUBWe6tc+oCBBl+MiLxgGi3hCY/Qq105Z9rm6uoJqXYuUtXGO7mfv7Nl7PPb6q9mbOw5zTZmueebhoZzHVMpnJiCYAol4xuJJP8P9W+C+xZd+qpRkU/AAAAABJRU5ErkJggg=="},69:function(e,t,n){e.exports=n.p+"static/media/roguelikeSheet_transparent.3c15bcea.png"},76:function(e,t,n){e.exports=n(148)},96:function(e,t,n){},97:function(e,t,n){},98:function(e,t,n){},99:function(e,t,n){}},[[76,1,2]]]);
//# sourceMappingURL=main.0c92086f.chunk.js.map