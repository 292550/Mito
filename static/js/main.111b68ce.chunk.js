(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{44:function(e,t,n){e.exports=n(74)},50:function(e,t,n){},72:function(e,t,n){},74:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(37),o=n.n(a),s=(n(50),n(2)),l=n(3),u=n(6),c=n(4),h=n(5),d=n(25),f=n(22),v=n(15),p=n(18),m=n.n(p),y=n(1),g={click:!0,contextmenu:!0,dblclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,touchstart:!0,touchmove:!0,touchend:!0,keyup:!0,keydown:!0,keypress:!0,wheel:!0},w=function(){function e(t,n){Object(s.a)(this,e),this.renderer=t,this.audioContext=n,this.elements=void 0,this.events=void 0,this.timeElapsed=0,this.frameCount=0}return Object(l.a)(e,[{key:"aspectRatio",get:function(){return this.renderer.domElement.height/this.renderer.domElement.width}},{key:"resolution",get:function(){return new y.B(this.renderer.domElement.width,this.renderer.domElement.height)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),e}();w.id=void 0;var b,k,x,j,O,E,C,M=n(34),A=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).frameId=void 0,n.lastTimestamp=0,n.stop=!1,n.loop=function(e){var t=e-n.lastTimestamp;n.lastTimestamp=e,n.props.sketch.frameCount++,n.props.sketch.timeElapsed=e;try{n.props.sketch.animate(t)}catch(i){console.error(i)}n.stop||(n.setState({frameCount:n.props.sketch.frameCount}),n.frameId=requestAnimationFrame(n.loop))},n.handleWindowResize=function(){var e=n.props.sketch.renderer;n.updateRendererCanvasToMatchParent(e),null!=n.props.sketch.resize&&n.props.sketch.resize(e.domElement.width,e.domElement.height)},n.state={frameCount:e.sketch.frameCount},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize();var t=this.props.sketch.renderer.domElement;t.tabIndex=1,Object.keys(g).forEach(function(n){if(null!=e.props.sketch.events){var i=e.props.sketch.events[n];null!=i&&(e.props.eventsOnBody?document.body.addEventListener(n,i):t.addEventListener(n,i))}}),this.frameId=requestAnimationFrame(this.loop)}},{key:"render",value:function(){var e=[];return null!=this.props.sketch.render&&e.push(this.props.sketch.render()),null!=this.props.sketch.elements&&e.push.apply(e,Object(v.a)(this.props.sketch.elements)),i.createElement("div",{className:"sketch-elements"},e.map(function(e,t){return i.cloneElement(e,{key:t})}))}},{key:"componentWillUnmount",value:function(){var e=this;this.stop=!0,this.props.sketch.destroy&&this.props.sketch.destroy(),null!=this.frameId&&cancelAnimationFrame(this.frameId),this.props.sketch.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize);var t=this.props.sketch.canvas;Object.keys(g).forEach(function(n){if(null!=e.props.sketch.events){var i=e.props.sketch.events[n];null!=i&&(e.props.eventsOnBody?document.body.removeEventListener(n,i):t.removeEventListener(n,i))}})}},{key:"updateRendererCanvasToMatchParent",value:function(e){var t=e.domElement.parentElement;null!=t&&e.setSize(t.clientWidth,t.clientHeight)}}]),t}(i.Component),S=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).state={status:{type:"loading"},volumeEnabled:JSON.parse(window.localStorage.getItem("sketch-volumeEnabled")||"true")},n.audioContext=void 0,n.userVolume=void 0,n.handleContainerRef=function(e){if(null!=e)try{var t=window.AudioContext||window.webkitAudioContext,i=n.audioContext=new t;y.c.setContext(i),n.userVolume=i.createGain(),n.userVolume.gain.setValueAtTime(.8,0),n.userVolume.connect(i.destination),(i.gain=i.createGain()).connect(n.userVolume),document.addEventListener("visibilitychange",n.handleVisibilityChange);var r=new y.D({alpha:!0,preserveDrawingBuffer:!0,antialias:!0});e.appendChild(r.domElement);var a=n.props.otherArgs||[],o=Object(f.a)(n.props.sketchClass,[r,n.audioContext].concat(Object(v.a)(a)));n.setState({status:{type:"success",sketch:o}})}catch(s){n.setState({status:{type:"error",error:s}}),console.error(s)}else"success"===n.state.status.type&&n.state.status.sketch.canvas.remove(),document.removeEventListener("visibilitychange",n.handleVisibilityChange),null!=n.audioContext&&n.audioContext.close(),n.setState({status:{type:"loading"}})},n.handleVolumeButtonClick=function(){var e=!n.state.volumeEnabled;n.setState({volumeEnabled:e}),window.localStorage.setItem("sketch-volumeEnabled",JSON.stringify(e))},n.handleVisibilityChange=function(){null!=n.audioContext&&(document.hidden?n.audioContext.suspend():n.state.volumeEnabled&&n.audioContext.resume())},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){null!=this.userVolume&&null!=this.audioContext&&(this.state.volumeEnabled&&"suspended"===this.audioContext.state?this.audioContext.resume():this.state.volumeEnabled||"running"!==this.audioContext.state||this.audioContext.suspend());var e=this.props,t=(e.sketchClass,e.otherArgs,e.eventsOnBody,e.errorElement,Object(d.a)(e,["sketchClass","otherArgs","eventsOnBody","errorElement"])),n=m()("sketch-component",this.state.status.type);return i.createElement("div",Object.assign({},t,{id:this.props.sketchClass.id,className:n,ref:this.handleContainerRef}),this.renderSketchOrStatus(),this.renderVolumeButton())}},{key:"renderSketchOrStatus",value:function(){var e=this.state.status;return"success"===e.type?i.createElement(A,{key:this.props.sketchClass.id,sketch:e.sketch,eventsOnBody:this.props.eventsOnBody}):"error"===e.type?this.props.errorElement||this.renderDefaultErrorElement(e.error.message):"loading"===e.type?null:void 0}},{key:"renderDefaultErrorElement",value:function(e){return i.createElement("p",{className:"sketch-error"},"Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.",i.createElement("pre",null,e))}},{key:"renderVolumeButton",value:function(){var e=this.state.volumeEnabled;return i.createElement("button",{className:"user-volume",onClick:this.handleVolumeButtonClick},e?i.createElement(M.b,null):i.createElement(M.a,null))}}]),t}(i.Component),T=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).handleDivRef=function(e){null!=e||n.exitFullscreen()},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.createElement("div",{className:"full-page-sketch",ref:this.handleDivRef},i.createElement(S,{sketchClass:this.props.sketchClass,otherArgs:this.props.otherArgs}))}},{key:"exitFullscreen",value:function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}}]),t}(i.Component),R=n(8);function P(e,t,n){e.x=e.x*(1-n)+t.x*n,e.y=e.y*(1-n)+t.y*n}function B(e,t,n,i,r){return function(e,t,n){return e+(t-e)*n}(i,r,(e-t)/(n-t))}function F(e,t){var n=document.createElement("source");return n.src="/assets/audio/".concat(e,".").concat(t),n.type="audio/".concat(t),n}function D(e,t){var n=document.createElement("audio");n.autoplay=!0,n.loop=!0,n.appendChild(F(t,"ogg")),n.appendChild(F(t,"mp3")),n.appendChild(F(t,"wav"));var i=e.createMediaElementSource(n),r=e.createGain();return i.connect(r),{audio:n,gain:r}}var N=n(23);function W(e){return Math.round(1e12*e)/1e12}var L=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(s.a)(this,e),this.capacity=t,this.carrier=n,this.water=i,this.sugar=r,this.events=void 0,this.validate()}return Object(l.a)(e,[{key:"give",value:function(e,t,n){if(e===this)throw new Error("shouldn't give to self");var i=Math.min(t,this.water),r=Math.min(n,this.sugar),a=W(i+r),o=e.space();return a>o&&(i=Math.floor(i/a*o),r=Math.floor(r/a*o)),this.change(-i,-r),e.change(i,r),this.events&&this.events.emit("give",e,i,r),e.events&&e.events.emit("get",this,i,r),{water:i,sugar:r}}},{key:"on",value:function(e,t){this.events=this.events||new N.EventEmitter,this.events.on(e,t)}},{key:"add",value:function(e,t){var n=W(e+t),i=this.space();n>i&&(e=e/n*i,t=t/n*i),this.change(e,t)}},{key:"change",value:function(e,t){var n=W(this.water+e),i=W(this.sugar+t);this.validate(n,i),this.water=n,this.sugar=i,this.water<0&&(this.water=0),this.sugar<0&&(this.sugar=0),this.water+this.sugar>this.capacity&&(this.water>this.sugar?this.water=this.capacity-this.sugar:this.sugar=this.capacity-this.water)}},{key:"space",value:function(){return W(this.capacity-this.water-this.sugar)}},{key:"isMaxed",value:function(){return this.space()<1}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.water,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sugar,n=this.capacity;e<0&&console.warn("water < 0: ".concat(e)),t<0&&console.warn("sugar < 0: ".concat(t)),e+t>n&&console.warn("bad inventory: ".concat(e," water + ").concat(t," > ").concat(n," max"))}}]),e}();function I(e){return null!=e&&e.inventory instanceof L}var z=n(13),Y={isRealtime:!0,environment:"Temperate",cellEnergyMax:1e4,tissueInventoryCapacity:6,rootTurnsPerTransfer:20,leafReactionRate:.01,leafSugarPerReaction:1,cellGestationTurns:0,cellDiffusionWater:.002,cellDiffusionSugar:.002,soilDarknessBase:.2,soilDiffusionType:"discrete",soilDiffusionWater:.001,veinDiffusion:.5,soilMaxWater:20,droop:.03,fountainTurnsPerWater:11,fountainAppearanceRate:1.5,transportTurnsPerMove:5,sunlightReintroduction:.15,sunlightDiffusion:0,maxResources:100},q=Object(z.a)({},Y);if(window.location.hash.length>0){var V=JSON.parse(decodeURI(window.location.hash.substr(1)));Object.assign(q,V)}function U(){for(var e={},t=0,n=Object.keys(Y);t<n.length;t++){var i=n[t],r=q[i];r!==Y[i]&&(e[i]=r)}Object.keys(e).length>0?window.location.hash=encodeURI(JSON.stringify(e)):window.location.hash=""}U();var G=n(12),H=n(7),_=function(){function e(t,n,i){Object(s.a)(this,e),this.x=t,this.y=n,this.z=i}return Object(l.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,n){return this.x*e+this.y*t+this.z*n}}]),e}(),K=[new _(1,1,0),new _(-1,1,0),new _(1,-1,0),new _(-1,-1,0),new _(1,0,1),new _(-1,0,1),new _(1,0,-1),new _(-1,0,-1),new _(0,1,1),new _(0,-1,1),new _(0,1,-1),new _(0,-1,-1)],X=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],J=.5*(Math.sqrt(3)-1),Z=(3-Math.sqrt(3))/6,$=1/6,Q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2147483647*Math.random();Object(s.a)(this,e),this.perm=new Array(512),this.gradP=new Array(512),this.octaveNum=6,this.octaveFalloff=.5,this.octaveMatrix2=[2*Math.cos(1),2*-Math.sin(1),2*Math.sin(1),2*Math.cos(1)],this.seed(t)}return Object(l.a)(e,[{key:"seed",value:function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?X[t]^255&e:X[t]^e>>8&255,this.perm[t]=this.perm[t+256]=n,this.gradP[t]=this.gradP[t+256]=K[n%12]}}}]),Object(l.a)(e,[{key:"simplex2",value:function(e,t){var n,i,r=(e+t)*J,a=Math.floor(e+r),o=Math.floor(t+r),s=(a+o)*Z,l=e-a+s,u=t-o+s;l>u?(n=1,i=0):(n=0,i=1);var c=l-n+Z,h=u-i+Z,d=l-1+2*Z,f=u-1+2*Z;a&=255,o&=255;var v=this.gradP[a+this.perm[o]],p=this.gradP[a+n+this.perm[o+i]],m=this.gradP[a+1+this.perm[o+1]],y=.5-l*l-u*u,g=.5-c*c-h*h,w=.5-d*d-f*f;return 70*((y<0?0:(y*=y)*y*v.dot2(l,u))+(g<0?0:(g*=g)*g*p.dot2(c,h))+(w<0?0:(w*=w)*w*m.dot2(d,f)))}},{key:"octaveSimplex2",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.octaveNum,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveFalloff,r=0,a=e,o=t,s=1,l=0;l<n;l++){r+=this.simplex2(a,o)*s;var u=a*this.octaveMatrix2[0]+o*this.octaveMatrix2[1],c=a*this.octaveMatrix2[2]+o*this.octaveMatrix2[3];a=u,o=c,s*=i}return r}},{key:"simplex3",value:function(e,t,n){var i,r,a,o,s,l,u=(e+t+n)*(1/3),c=Math.floor(e+u),h=Math.floor(t+u),d=Math.floor(n+u),f=(c+h+d)*$,v=e-c+f,p=t-h+f,m=n-d+f;v>=p?p>=m?(i=1,r=0,a=0,o=1,s=1,l=0):v>=m?(i=1,r=0,a=0,o=1,s=0,l=1):(i=0,r=0,a=1,o=1,s=0,l=1):p<m?(i=0,r=0,a=1,o=0,s=1,l=1):v<m?(i=0,r=1,a=0,o=0,s=1,l=1):(i=0,r=1,a=0,o=1,s=1,l=0);var y=v-i+$,g=p-r+$,w=m-a+$,b=v-o+2*$,k=p-s+2*$,x=m-l+2*$,j=v-1+.5,O=p-1+.5,E=m-1+.5;c&=255,h&=255,d&=255;var C=this.gradP,M=this.perm,A=C[c+M[h+M[d]]],S=C[c+i+M[h+r+M[d+a]]],T=C[c+o+M[h+s+M[d+l]]],R=C[c+1+M[h+1+M[d+1]]],P=.6-v*v-p*p-m*m,B=.6-y*y-g*g-w*w,F=.6-b*b-k*k-x*x,D=.6-j*j-O*O-E*E;return 32*((P<0?0:(P*=P)*P*A.dot3(v,p,m))+(B<0?0:(B*=B)*B*S.dot3(y,g,w))+(F<0?0:(F*=F)*F*T.dot3(b,k,x))+(D<0?0:(D*=D)*D*R.dot3(j,O,E)))}},{key:"octaveSimplex3",value:function(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveNum,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.octaveFalloff,a=0,o=e,s=t,l=n,u=1,c=0;c<i;c++)a+=this.simplex3(o,s,l)*u,o*=2,s*=2,l*=2,u*=r;return a}},{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,n){return(1-n)*e+n*t}},{key:"perlin2",value:function(e,t){var n=Math.floor(e),i=Math.floor(t);e-=n,t-=i,n&=255,i&=255;var r=this.gradP,a=this.perm,o=r[n+a[i]].dot2(e,t),s=r[n+a[i+1]].dot2(e,t-1),l=r[n+1+a[i]].dot2(e-1,t),u=r[n+1+a[i+1]].dot2(e-1,t-1),c=this.fade(e);return this.lerp(this.lerp(o,l,c),this.lerp(s,u,c),this.fade(t))}},{key:"perlin3",value:function(e,t,n){var i=this.gradP,r=this.perm,a=Math.floor(e),o=Math.floor(t),s=Math.floor(n);e-=a,t-=o,n-=s;var l=i[(a&=255)+r[(o&=255)+r[s&=255]]].dot3(e,t,n),u=i[a+r[o+r[s+1]]].dot3(e,t,n-1),c=i[a+r[o+1+r[s]]].dot3(e,t-1,n),h=i[a+r[o+1+r[s+1]]].dot3(e,t-1,n-1),d=i[a+1+r[o+r[s]]].dot3(e-1,t,n),f=i[a+1+r[o+r[s+1]]].dot3(e-1,t,n-1),v=i[a+1+r[o+1+r[s]]].dot3(e-1,t-1,n),p=i[a+1+r[o+1+r[s+1]]].dot3(e-1,t-1,n-1),m=this.fade(e),y=this.fade(t),g=this.fade(n);return this.lerp(this.lerp(this.lerp(l,d,m),this.lerp(u,f,m),g),this.lerp(this.lerp(c,v,m),this.lerp(h,p,m),g),y)}}]),e}(),ee={nw:new y.B(-1,-1),w:new y.B(-1,0),sw:new y.B(-1,1),n:new y.B(0,-1),s:new y.B(0,1),ne:new y.B(1,-1),e:new y.B(1,0),se:new y.B(1,1)},te=Object.keys(ee).map(function(e){return ee[e]});function ne(e){return"number"===typeof e.energy}var ie=function(){function e(t,n){if(Object(s.a)(this,e),this.world=n,this.isObstacle=!1,this.darkness=1/0,this.pos=void 0,this.pos=t.clone(),null==n)throw new Error("null world!")}return Object(l.a)(e,[{key:"diffusionWater",get:function(){return this.constructor.diffusionWater}},{key:"diffusionSugar",get:function(){return this.constructor.diffusionSugar}},{key:"fallAmount",get:function(){return this.constructor.fallAmount}}]),Object(l.a)(e,[{key:"lightAmount",value:function(){return Math.sqrt(Math.min(Math.max(B(1-this.darkness,0,1,0,1),0),1))}},{key:"step",value:function(){if(this.world.time%3===0){var e=this.world.tileNeighbors(this.pos);this.stepDarkness(e),this.stepDiffusion(e),this.stepGravity()}}},{key:"stepDarkness",value:function(e){if(this instanceof he)this.darkness=0;else{var t=this.darkness,n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=Object(H.a)(s,2)[1],u=Math.max(.2,B(this.pos.y,this.world.height/2,this.world.height,q.soilDarknessBase,1)),c=l instanceof le?1/0:l.darkness+u;t=l instanceof he?0:Math.min(t,c)}}catch(d){i=!0,r=d}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}this.darkness=t;var h=null!=this.world.cellAt(this.pos.x,this.pos.y);h&&console.error("stepping environmental tile even when a cell is on-top:",h)}}},{key:"stepDiffusion",value:function(e){if(I(this)){var t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,s=Object(H.a)(o,2),l=s[0],u=s[1];this.canDiffuse(l,u)&&(null!=this.diffusionWater&&u.inventory.water>this.inventory.water&&this.diffuseWater(u),null!=this.diffusionSugar&&u.inventory.sugar>this.inventory.sugar&&this.diffuseSugar(u))}}catch(c){n=!0,i=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}}},{key:"canDiffuse",value:function(e,t){return re(this,t)}},{key:"diffuseWater",value:function(e){if(I(this))if("continuous"===q.soilDiffusionType){var t=(e.inventory.water-this.inventory.water)*this.diffusionWater;e.inventory.give(this.inventory,t,0)}else{var n=e.inventory.water-this.inventory.water,i=Math.min(n,1);Math.random()<n*this.diffusionWater*i&&e.inventory.give(this.inventory,1,0)}}},{key:"diffuseSugar",value:function(e){if(I(this)){var t=(e.inventory.sugar-this.inventory.sugar)*this.diffusionSugar;e.inventory.give(this.inventory,0,t)}}},{key:"stepGravity",value:function(){var e=this.fallAmount,t=this.world.tileAt(this.pos.x,this.pos.y+1);e>0&&this.world.time%Math.floor(1/e)<1&&I(t)&&re(t,this)&&this.inventory.give(t.inventory,1,0)}}]),e}();function re(e,t){return I(e)&&I(t)&&(e instanceof t.constructor||t instanceof e.constructor||e instanceof he&&t instanceof he||function(e,t,n,i){return e instanceof t&&n instanceof i}(e,se,t,oe))}ie.displayName="Tile",ie.fallAmount=0;var ae=new Q,oe=function(e){function t(e,n){var i;return Object(s.a)(this,t),(i=Object(u.a)(this,Object(c.a)(t).call(this,e,n))).pos=e,i.sunlightCached=1,i._co2=void 0,i.inventory=new L(20,Object(R.a)(i)),i.darkness=0,i._co2=i.computeCo2(),i}return Object(h.a)(t,e),Object(l.a)(t,[{key:"computeCo2",value:function(){var e=B(this.pos.y,this.world.height/2,0,this.world.environment.floorCo2,1.15),t=B(this.pos.y,this.world.height/2,0,4,9),n=null==this.world?0:this.world.time,i=.25*ae.perlin3(94.231+(this.pos.x-this.world.width/2)/t,2312+this.pos.y/8,n/1e3+93.1);return Math.max(Math.min(e+i,1),Math.min(.4,.75*this.world.environment.floorCo2))}},{key:"lightAmount",value:function(){return this.sunlight()}},{key:"step",value:function(){this.world.time%3===0&&(this.stepGravity(),this.stepDiffusion(this.world.tileNeighbors(this.pos)),this.stepEvaporation(),this._co2=this.computeCo2())}},{key:"stepEvaporation",value:function(){Math.random()<.01*this.inventory.water&&this.inventory.add(-1,0)}},{key:"canDiffuse",value:function(e,n){return e!==ee.s&&e!==ee.sw&&e!==ee.se&&Object(G.a)(Object(c.a)(t.prototype),"canDiffuse",this).call(this,e,n)}},{key:"co2",value:function(){return this._co2}},{key:"sunlight",value:function(){return this.sunlightCached}}]),t}(ie);oe.displayName="Air",oe.fallAmount=1,oe.diffusionWater=.1;var se=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e,r))).inventory=new L(q.soilMaxWater,Object(R.a)(n)),n.inventory.add(i,0),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"fallAmount",get:function(){return this.world.environment.waterGravityPerTurn}}]),Object(l.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(G.a)(Object(c.a)(t.prototype),"step",this).call(this),this.stepEvaporation())}},{key:"stepEvaporation",value:function(){var e=this.world.environment,t=e.evaporationRate,n=e.evaporationBottom,i=B(this.pos.y,this.world.height/2,this.world.height*n,1,0),r=this.inventory.water;Math.random()<t*i*r&&this.inventory.add(-1,0)}}]),t}(ie);se.displayName="Soil",se.diffusionWater=q.soilDiffusionWater;var le=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).isObstacle=!0,n}return Object(h.a)(t,e),t}(ie);le.displayName="Rock";var ue=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),t}(ie);ue.displayName="Dead Cell";var ce=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e,i,r))).turnsPerWater=a,n.isObstacle=!0,n.cooldown=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(G.a)(Object(c.a)(t.prototype),"step",this).call(this),this.cooldown>0&&this.cooldown--,this.inventory.space()>1&&this.cooldown<=0&&(this.inventory.add(1,0),this.cooldown=this.turnsPerWater))}}]),t}(se);ce.displayName="Fountain";var he=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).energy=q.cellEnergyMax,n.darkness=0,n.droopY=0,n.args=[],n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){Object(G.a)(Object(c.a)(t.prototype),"step",this).call(this),this.energy-=1;var e=this.world.tileNeighbors(this.pos),n=Array.from(e.values()),i=[].concat(Object(v.a)(n),[this]),r=!0,a=!1,o=void 0;try{for(var s,l=i[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value;if(I(u)&&!(u instanceof me)){if(!(this.energy<q.cellEnergyMax))break;var h=q.cellEnergyMax-this.energy,d=Math.min(h/q.cellEnergyMax,u.inventory.sugar);u.inventory.add(0,-d);var f=d*q.cellEnergyMax;this.energy+=f}}}catch(j){a=!0,o=j}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}if(this.energy<q.cellEnergyMax){var p=i.filter(function(e){return ne(e)}),m=!0,y=!1,g=void 0;try{for(var w,b=p[Symbol.iterator]();!(m=(w=b.next()).done);m=!0){var k=w.value;if(!(this.energy<q.cellEnergyMax))break;var x=0;if(k.energy>this.energy){if(x=Math.floor(.25*(k.energy-this.energy)),k.energy-x<0)throw new Error("cell energy diffusion: taking more energy than available");if(this.energy+x>q.cellEnergyMax)throw new Error("cell energy diffusion: taking more energy than i can carry");this.energy+=x,k.energy-=x}}}catch(j){y=!0,g=j}finally{try{m||null==b.return||b.return()}finally{if(y)throw g}}}this.stepDroop(e),this.droopY>.5&&(this.world.player.pos.equals(this.pos)&&(this.world.player.pos.y+=1),this.world.maybeRemoveCellAt(this.pos),this.pos.y<this.world.height-1&&(this.pos.y+=1),this.droopY-=1,this.world.setTileAt(this.pos,this)),this.energy<=0&&this.world.setTileAt(this.pos,new ue(this.pos,this.world))}}},{key:"stepDroop",value:function(e){var n=e.get(ee.s),i=e.get(ee.sw),r=e.get(ee.se),a=e.get(ee.w),o=e.get(ee.e),s=e.get(ee.n),l=e.get(ee.nw),u=e.get(ee.ne);this.droopY+=q.droop,this.energy<q.cellEnergyMax/2&&(this.droopY+=q.droop);for(var c=!1,h=0,d=[n,i,r];h<d.length;h++){var f=d[h];if(f instanceof le||f instanceof se)return void(this.droopY=Math.min(this.droopY,0));if(f instanceof t)return this.droopY=Math.min(this.droopY,f.droopY),void(c=!0)}var v=[l,s,u,a,o,this].filter(function(e){return e instanceof t});c||1!==v.length?this.droopY=v.reduce(function(e,t){return e+t.droopY},0)/v.length:this.droopY+=1}}]),t}(ie);he.displayName="Cell",he.diffusionWater=q.cellDiffusionWater,he.diffusionSugar=q.cellDiffusionSugar,he.turnsToBuild=q.cellGestationTurns;var de=function(e){function t(e,n,i){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n))).completedCell=i,r.isObstacle=!0,r.timeRemaining=void 0,r.timeToBuild=void 0,r.timeRemaining=r.timeToBuild=i.constructor.turnsToBuild||0,r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(G.a)(Object(c.a)(t.prototype),"step",this).call(this),this.timeRemaining--,this.timeRemaining<=0&&this.world.setTileAt(this.completedCell.pos,this.completedCell))}}]),t}(he),fe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).inventory=new L(q.tissueInventoryCapacity,Object(R.a)(n)),n}return Object(h.a)(t,e),t}(he);fe.displayName="Tissue";var ve=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).isObstacle=!0,n.averageEfficiency=0,n.averageSpeed=0,n.didConvert=!1,n.sugarConverted=0,n.tilePairs=[],n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){Object(G.a)(Object(c.a)(t.prototype),"step",this).call(this),this.didConvert=!1;var e=this.world.tileNeighbors(this.pos);this.averageEfficiency=0,this.averageSpeed=0,this.sugarConverted=0;var n=0;this.tilePairs=[];var i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value,u=Object(H.a)(l,2),h=u[0],d=u[1],f=this.world.tileAt(this.pos.x-h.x,this.pos.y-h.y);if(d instanceof oe&&f instanceof fe){n+=1,this.tilePairs.push(h);var v=d,p=f,m=v.sunlight(),y=v.co2();this.averageEfficiency+=y,this.averageSpeed+=m;var g=q.leafSugarPerReaction/y,w=Math.min(p.inventory.water,g),b=m*q.leafReactionRate*w/g;if(Math.random()<b){this.didConvert=!0;var k=w*y;p.inventory.add(-w,k),this.sugarConverted+=k}}}}catch(x){r=!0,a=x}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}n>0&&(this.averageEfficiency/=n)}}}]),t}(he);ve.displayName="Leaf";var pe=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).waterTransferAmount=0,n.isObstacle=!0,n.activeNeighbors=[],n.inventory=new L(q.tissueInventoryCapacity,Object(R.a)(n)),n.cooldown=0,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(G.a)(Object(c.a)(t.prototype),"step",this).call(this),this.cooldown<=0&&(this.stepWaterTransfer(),this.cooldown+=q.rootTurnsPerTransfer),this.cooldown-=1)}},{key:"stepWaterTransfer",value:function(){this.waterTransferAmount=0,this.activeNeighbors=[];var e=this.world.tileNeighbors(this.pos),t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,s=Object(H.a)(o,2),l=s[0],u=s[1];if(u instanceof se){this.activeNeighbors.push(l);var c=u.inventory.give(this.inventory,1,0).water;this.waterTransferAmount+=c+1e-4*Math.random()}}}catch(h){n=!0,i=h}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}}]),t}(he);pe.displayName="Root";var me=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).isObstacle=!0,n.inventory=new L(t.sugarToWin+100,Object(R.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){Object(G.a)(Object(c.a)(t.prototype),"step",this).call(this);var e=this.world.tileNeighbors(this.pos),n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l=Object(H.a)(s,2)[1];I(l)&&l.inventory.give(this.inventory,0,l.inventory.sugar)}}catch(u){i=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}}}]),t}(he);function ye(e){return e%1!==0}me.displayName="Fruit",me.sugarToWin=200;var ge=function(e){function t(e,n,i){var r;if(Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n))).dir=i,r.cooldown=0,ye(i.x)||ye(i.y))throw new Error("build transport with fractional dir "+i.x+", "+i.y);return r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){if(this.energy-=1,Object(G.a)(Object(c.a)(t.prototype),"step",this).call(this),this.cooldown<=0){this.cooldown+=q.transportTurnsPerMove;var e=this.getTarget();e&&this.inventory.give(e.inventory,1,1);var n=this.getFrom();n&&n.inventory.give(this.inventory,1,1)}this.cooldown-=1}}},{key:"getTarget",value:function(){var e=this.world.tileAt(this.pos.x+this.dir.x,this.pos.y+this.dir.y);if(e instanceof he&&I(e))return e}},{key:"getFrom",value:function(){var e=this.world.tileAt(this.pos.x-this.dir.x,this.pos.y-this.dir.y);if(e instanceof he&&I(e))return e}}]),t}(fe);ge.displayName="Transport";var we=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).inventory=new L(8,Object(R.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"diffusionWater",get:function(){return q.veinDiffusion}},{key:"diffusionSugar",get:function(){return q.veinDiffusion}}]),t}(fe);we.displayName="Vein";var be=function(){function e(t,n){Object(s.a)(this,e),this.posFloat=t,this.world=n,this.inventory=new L(q.maxResources,this,Math.round(q.maxResources/3),Math.round(q.maxResources/3)),this.action=void 0,this.events=new N.EventEmitter,this.mapActions=void 0,this.speed=.15}return Object(l.a)(e,[{key:"pos",get:function(){return this.posFloat.clone().round()}}]),Object(l.a)(e,[{key:"setAction",value:function(e){null!=this.action?this.action={type:"multiple",actions:[this.action,e]}:this.action=e}},{key:"getAction",value:function(){return this.action}},{key:"droopY",value:function(){var e=this.world.tileAt(this.pos.x,this.pos.y);return e instanceof he?e.droopY:0}},{key:"droopPosFloat",value:function(){var e=this.droopY();if(0!==e){var t=this.posFloat.clone();return t.y+=e,t}return this.posFloat}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"step",value:function(){if(void 0===this.action&&(this.action={type:"none"}),this.mapActions){var e=this.mapActions(this,this.action);this.action=null!=e?e:{type:"none"}}this.attemptAction(this.action)&&this.events.emit("action",this.action),this.action=void 0}},{key:"attemptAction",value:function(e){switch(e.type){case"none":return!0;case"still":return this.attemptStill();case"move":return this.attemptMove(e);case"build":return this.attemptBuild(e);case"deconstruct":return this.attemptDeconstruct(e);case"drop":return this.attemptDrop(e);case"pickup":return this.attemptPickup(e);case"multiple":return this.attemptMultiple(e)}}},{key:"verifyMove",value:function(e){var t=this.posFloat.clone().add(e.dir.clone().setLength(this.speed)).round();return this.isWalkable(t)}},{key:"isWalkable",value:function(e){if(e instanceof ie&&(e=e.pos),!this.world.isValidPosition(e.x,e.y))return!1;var t=this.world.tileAt(e.x,e.y);return t instanceof he&&null!=t&&!t.isObstacle}},{key:"isBuildCandidate",value:function(e){return null!=e&&!e.isObstacle}},{key:"attemptMove",value:function(e){return!!this.verifyMove(e)&&(j.audio.currentTime=.05*Math.random(),j.gain.gain.cancelScheduledValues(0),j.gain.gain.value=1,j.gain.gain.linearRampToValueAtTime(0,j.gain.context.currentTime+.05),this.posFloat.add(e.dir.clone().setLength(this.speed)),!0)}},{key:"attemptStill",value:function(){return!0}},{key:"tryConstructingNewCell",value:function(e,t,n){e=e.clone();var i=this.world.tileAt(e.x,e.y);if(null!=i&&(null==this.world.fruit||t!==me)&&!(i instanceof me)){if(!(i instanceof t&&!(t===ge&&i instanceof ge))&&!i.isObstacle&&this.inventory.water>=1&&this.inventory.sugar>=1){this.inventory.add(-1,-1);var r=Object(f.a)(t,[e,this.world].concat(Object(v.a)(n)));return r.args=n,O.audio.currentTime=0,O.gain.gain.cancelScheduledValues(0),O.gain.gain.value=.2,O.gain.gain.exponentialRampToValueAtTime(1e-4,O.gain.context.currentTime+.5),r}}}},{key:"argsEq",value:function(e,t){var n=this;return typeof e===typeof t&&(null==e&&null==t||(e instanceof y.B&&t instanceof y.B?e.equals(t):e instanceof Array&&t instanceof Array?e.every(function(i,r){return n.argsEq(e[r],t[r])}):void 0))}},{key:"isMeaningfulBuild",value:function(e,t){return t.constructor!==e.cellType||!this.argsEq(e.args,t.args)}},{key:"attemptBuild",value:function(e){var t=this.world.cellAt(e.position.x,e.position.y);if(null!=t&&!this.isMeaningfulBuild(e,t))return!0;t&&this.attemptDeconstruct({type:"deconstruct",position:e.position,force:!0});var n,i=this.tryConstructingNewCell(e.position,e.cellType,e.args);return null!=i&&((n=e.cellType.turnsToBuild?new de(e.position,this.world,i):i).droopY=this.droopY(),this.world.setTileAt(e.position,n),!0)}},{key:"attemptDeconstruct",value:function(e){if(!e.position.equals(this.pos)||e.force){var t=this.world.maybeRemoveCellAt(e.position);if(null!=t){var n=t.energy/q.cellEnergyMax;return this.inventory.add(n,n),I(t)&&t.inventory.give(this.inventory,t.inventory.water,t.inventory.sugar),!0}}return!1}},{key:"attemptDrop",value:function(e){var t=this.currentTile();if(I(t)){var n=e.water,i=e.sugar;return t.inventory.give(this.inventory,i,n),this.inventory.give(t.inventory,n,i),!0}return!1}},{key:"attemptPickup",value:function(e){var t=this.currentTile();I(t)&&t.inventory.give(this.inventory,e.water,e.sugar);return!0}},{key:"attemptMultiple",value:function(e){var t=!0,n=!0,i=!1,r=void 0;try{for(var a,o=e.actions[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t=this.attemptAction(s)&&t}}catch(l){i=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return t}}]),e}();var ke=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(s.a)(this,e),this.deleted=t,this.added=n},xe=function(){function e(t){var n=this;Object(s.a)(this,e),this.environment=t,this.time=0,this.width=50,this.height=100,this.player=new be(new y.B(this.width/2,this.height/2),this),this.fruit=void 0,this.gridEnvironment=void 0,this.gridCells=void 0,this.neighborCache=void 0,this.cachedEntities=void 0,this.stepStats=new ke,this.gridEnvironment=new Array(this.width).fill(void 0).map(function(e,i){return new Array(n.height).fill(void 0).map(function(e,r){var a,o=new y.B(i,r),s=!0,l=!1,u=void 0;try{for(var c,h=t.fill[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var d=(0,c.value)(o,n);if(null!=d){a=d;break}}}catch(f){l=!0,u=f}finally{try{s||null==h.return||h.return()}finally{if(l)throw u}}return null==a&&(a=new oe(o,n)),a})});var i=this.player.pos.x,r=this.gridEnvironment[i].find(function(e){return!(e instanceof oe)});r&&(this.player.pos.y=r.pos.y);this.gridCells=new Array(this.width).fill(void 0).map(function(e,t){return new Array(n.height).fill(void 0).map(function(e,i){var r=new y.B(t,i);return n.player.pos.distanceTo(r)<2.5?(n.gridEnvironment instanceof le&&(n.gridEnvironment[t][i]=new se(new y.B(t,i),0,n)),new fe(r,n)):null})}),this.neighborCache=new Array(this.width).fill(void 0).map(function(e,t){return new Array(n.height).fill(void 0).map(function(e,i){return n.computeTileNeighbors(t,i)})}),this.fillCachedEntities()}return Object(l.a)(e,[{key:"tileAt",value:function(e,t){var n;if(e instanceof y.B?(n=e.x,t=e.y):(n=e,t=t),!this.isValidPosition(n,t))return null;var i=this.gridCells[n][t];return null!=i?i:this.gridEnvironment[n][t]}},{key:"cellAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridCells[e][t]:null}},{key:"environmentTileAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridEnvironment[e][t]:null}},{key:"setTileAt",value:function(e,t){var n=e.x,i=e.y;if(!this.isValidPosition(n,i))throw new Error("invalid position ".concat(n,", ").concat(i," "));t instanceof me&&(null==this.fruit?this.fruit=t:console.warn("made multiple Fruit!"));var r=this.tileAt(n,i);I(r)&&(I(t)&&r.inventory.give(t.inventory,r.inventory.water,r.inventory.sugar),0===r.inventory.water&&0===r.inventory.sugar||(console.warn("lost",r.inventory,"resources to building"),r.inventory.add(-r.inventory.water,-r.inventory.sugar)));var a=this.gridCells[n][i];if(null!=a&&this.stepStats.deleted.push(a),t instanceof he)this.gridCells[n][i]=t;else{this.gridCells[n][i]=null;var o=this.gridEnvironment[n][i];null!=o&&this.stepStats.deleted.push(o),this.gridEnvironment[n][i]=t}this.stepStats.added.push(t),this.handleTileUpdated(e)}},{key:"maybeRemoveCellAt",value:function(e){var t=this.cellAt(e.x,e.y);return t&&(this.gridCells[e.x][e.y]=null,t===this.fruit&&(this.fruit=void 0),this.stepStats.deleted.push(t)),this.handleTileUpdated(e),t}},{key:"isValidPosition",value:function(e,t){return!(e>=this.width||e<0||t>=this.height||t<0)}},{key:"tileNeighbors",value:function(e){return this.neighborCache[e.x][e.y]}},{key:"computeTileNeighbors",value:function(e,t){var n=this,i=new Map;return Oe[this.time%Oe.length].forEach(function(r){var a=e+r.x,o=t+r.y,s=n.tileAt(a,o);null!=s&&i.set(r,s)}),i}},{key:"entities",value:function(){if(null==this.cachedEntities)throw new Error("accessed entities before filling");return this.cachedEntities}},{key:"handleTileUpdated",value:function(e){this.neighborCache[e.x][e.y]=this.computeTileNeighbors(e.x,e.y);var t=!0,n=!1,i=void 0;try{for(var r,a=te[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,s=e.x+o.x,l=e.y+o.y;this.isValidPosition(s,l)&&(this.neighborCache[s][l]=this.computeTileNeighbors(s,l))}}catch(u){n=!0,i=u}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}this.fillCachedEntities()}},{key:"fillCachedEntities",value:function(){var e=[],t=0,n=0;for(t=0;t<this.width;t++)for(n=(t+this.time)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));for(t=0;t<this.width;t++)for(n=(t+this.time+1)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));this.time%4<2&&e.reverse(),e.push(this.player),this.cachedEntities=e}},{key:"step",value:function(){var e=this.entities();return this.stepStats=new ke,e.forEach(function(e){"function"===typeof e.step&&e.step()}),this.computeSunlight(),this.stepWeather(),this.time++,this.fillCachedEntities(),this.stepStats}},{key:"getLastStepStats",value:function(){return this.stepStats}},{key:"stepWeather",value:function(){if((this.time+this.environment.climate.turnsBetweenRainfall-200)%this.environment.climate.turnsBetweenRainfall<this.environment.climate.rainDuration){var e=y.p.randInt(0,this.width-1),t=this.tileAt(e,0);t instanceof oe&&t.inventory.add(this.environment.climate.waterPerDroplet,0)}}},{key:"computeSunlight",value:function(){for(var e=this.time*Math.PI*2/1e3,t=Math.sin(e+Math.PI/2),n=Math.atan(12*Math.sin(e))/(Math.PI/2)*.5+.5,i=0;i<=.6*this.height;i++)for(var r=0;r<this.width;r++){var a=this.environmentTileAt(r,i);if(a instanceof oe){var o=0;if(0===i)o=1;else{var s=this.tileAt(r,i-1),l=this.tileAt(r+1,i-1),u=this.tileAt(r-1,i-1),c=s instanceof oe?s.sunlightCached/n:null==s?1:0,h=l instanceof oe?l.sunlightCached/n:null==l?1:0,d=u instanceof oe?u.sunlightCached/n:null==u?1:0;o=(o=t>0?h*t+c*(1-t):d*-t+c*(1- -t))*(1-q.sunlightDiffusion)+(c+h+d)/3*q.sunlightDiffusion}o=q.sunlightReintroduction+o*(1-q.sunlightReintroduction),o*=n,a.sunlightCached=o}}}},{key:"checkWinLoss",value:function(){return null!=this.fruit&&this.fruit.inventory.sugar>me.sugarToWin?"win":this.tileAt(this.player.pos.x,this.player.pos.y)instanceof ue?"lose":null}},{key:"checkResources",value:function(){this.entities().forEach(function(e){I(e)&&(e.inventory.sugar,e.inventory.water),ne(e)&&e.energy})}}]),e}();function je(e){for(var t,n,i=e.length;0!==i;)n=Math.floor(Math.random()*i),t=e[i-=1],e[i]=e[n],e[n]=t;return e}var Oe=[je(te.slice()),je(te.slice()),je(te.slice()),je(te.slice()),je(te.slice())],Ee={q:{type:"drop",sugar:0,water:1},e:{type:"drop",sugar:1,water:0}," ":{type:"pickup",sugar:1,water:1}},Ce={w:{type:"move",dir:ee.n},a:{type:"move",dir:ee.w},s:{type:"move",dir:ee.s},d:{type:"move",dir:ee.e}},Me=(Object.keys(Ce).map(function(e){return Ce[e]}),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return i.createElement("div",{className:"mito-instructions"},i.createElement("div",{className:"mito-instructions-container"},i.createElement("div",{className:"esc",onClick:function(){return e.props.play()}},"Back (Esc)"),i.createElement("h1",null,"Mito"),i.createElement("div",{className:"play-button",onClick:function(){return e.props.play()}},"Play"),i.createElement("p",null,i.createElement("ol",null,i.createElement("li",null,"Build Tissue to expand your reach (press t and walk into empty space)."),i.createElement("li",null,"Build Roots (press r) underground to suck up adjacent water."),i.createElement("li",null,"Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar."),i.createElement("li",null,i.createElement("b",null,"Win the game by building and loading the Fruit with 1000 sugar.")),i.createElement("li",null,"Click around to see the different properties of each tile."),i.createElement("li",null,"Build leaves early."),i.createElement("li",null,"Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air."),i.createElement("li",null,"Explore underground for water reservoires and Fountains."),i.createElement("li",null,"Build transports (capital T) to carry water back up the plant."),i.createElement("li",null,"You can scroll out infinitely far."))),i.createElement("h3",null,"You"),i.createElement("p",null,"You can carry max ",q.maxResources," resources, and you automatically suck in any resources you're standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil below and air above."),i.createElement("h3",null,"Soil and Underground"),i.createElement("p",null,"Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a permanent source of water. Soil holds up to ",q.soilMaxWater," water at a time. Fountains emit one water per ",q.fountainTurnsPerWater," turns."),i.createElement("h3",null,"Air and Aboveground"),i.createElement("p",null,"Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun, which gently sways left to right."),i.createElement("h3",null,"Water"),i.createElement("p",null,"Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2 required) at about 1 unit per ",(1/q.soilDiffusionWater).toFixed(0)," turns. Obtain water in the ground through Roots. Leaves require water to photosynthesize. You require water to build."),i.createElement("h3",null,"Sugar"),i.createElement("p",null,"Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by putting water next to leaves. Cells require sugar to survive. You require sugar to build."),i.createElement("h3",null,"Building"),i.createElement("p",null,'Build Tissue, Leaves, Roots, and The Fruit by toggling "build mode" on and walking into Air or Soil. Build Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they\'re not properly supported underneath them.'),i.createElement("h3",null,"Cells"),i.createElement("p",null,"All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their neighbors. Each cell consumes 1 sugar every ",q.cellEnergyMax," turns."),i.createElement("h3",null,"Tissue"),i.createElement("p",null,"Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to ",q.tissueInventoryCapacity," resources."),i.createElement("h3",null,"Roots"),i.createElement("p",null,"Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is called a Pairing."),i.createElement("h3",null,"Leaves"),i.createElement("p",null,"When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per ",(1/q.leafReactionRate).toFixed(0)," turns per pair. Leaf efficiency is heavily influenced by co2 and sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize. Leaves higher up produce sugar faster."),i.createElement("h3",null,"Transport"),i.createElement("p",null,"Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you. Transport hungers at double speed."),i.createElement("h3",null,"The Fruit"),i.createElement("p",null,"You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to 1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity."),this.renderCredit()))}},{key:"renderCredit",value:function(){return i.createElement(i.Fragment,null,i.createElement("h2",null,"Attribution"),i.createElement("p",null,"Tiles: ",i.createElement("a",{href:"http://kenney.nl/assets?s=roguelike",target:"_blank",rel:"noopener noreferrer"},"Kenney.nl Roguelike Assets")),i.createElement("p",null,"Pop sound when leaves convert: ",i.createElement("a",{href:"http://soundbible.com/2067-Blop.html",target:"_blank",rel:"noopener noreferrer"},"Blop by Mark DiAngelo")," (",i.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/us/"},"CC BY 3.0 US"),")"),i.createElement("p",null,"Perlin noise: ",i.createElement("a",{href:"https://github.com/josephg/noisejs",target:"_blank",rel:"noopener noreferrer"},"josephg/noisejs")),i.createElement("p",null,"Part of 7drl 2018: ",i.createElement("a",{href:"http://7drl.org/",target:"_blank",rel:"noopener noreferrer"},"http://7drl.org/")),i.createElement("p",null,"Fruit icon: ",i.createElement("a",{href:"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm"},"Designed by Freepik")))}}]),t}(i.PureComponent)),Ae=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).handlePlay=function(){n.props.mito.gameState="main"},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e={width:"100%",height:"100%",position:"absolute",background:"rgba(255, 255, 255, 0.95)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px"};return"main"===this.props.state?null:"win"===this.props.state?i.createElement("div",{className:"screen-win",style:e},"You won!"):"lose"===this.props.state?i.createElement("div",{className:"screen-lose",style:e},"You lost!"):"instructions"===this.props.state?i.createElement(Me,{play:this.handlePlay}):void 0}}]),t}(i.PureComponent),Se=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.tile;return e?i.createElement("div",{className:"tile-hover"},this.tileInfo(e),this.inventoryInfo(e),this.cellInfo(e),this.growingCellInfo(e),this.rootInfo(e),this.leafInfo(e),this.airInfo(e),this.fountainInfo(e)):null}},{key:"rootInfo",value:function(e){return e instanceof pe?i.createElement("div",{className:"info-root"},i.createElement("div",null,e.cooldown," turns until next water suck"),i.createElement("div",null,e.waterTransferAmount.toFixed(0)," water transfer per round")):null}},{key:"leafInfo",value:function(e){return e instanceof ve?i.createElement("div",{className:"info-leaf"},i.createElement("div",null,(1/(e.averageSpeed*q.leafReactionRate)).toFixed(0)," turns per reaction"),i.createElement("div",null,(1/e.averageEfficiency).toFixed(2)," water per sugar")):null}},{key:"airInfo",value:function(e){if(e instanceof oe)return i.createElement("div",{className:"info-air"},i.createElement("div",null,"\u2600\ufe0f ",(100*e.sunlight()).toFixed(0),"%"),i.createElement("div",null,"\u2601\ufe0f ",(100*e.co2()).toFixed(0),"%"))}},{key:"fountainInfo",value:function(e){if(e instanceof ce)return i.createElement("div",{className:"info-fountain"},i.createElement("div",null,e.turnsPerWater," turns per water"))}},{key:"tileInfo",value:function(e){var t=ne(e)?i.createElement("span",{className:"info-energy"},"\ud83d\udc9a",(e.energy/q.cellEnergyMax*100).toFixed(0),"%"):null;return i.createElement("div",{className:"info-tile"},i.createElement("div",{className:"info-tile-name"},e.constructor.displayName),t)}},{key:"inventoryInfo",value:function(e){if(I(e)){var t=e.inventory.water>0?i.createElement("div",{className:"info-inventory-item"},"\ud83d\udca7 ",e.inventory.water.toFixed(2)):null,n=e.inventory.sugar>0?i.createElement("div",{className:"info-inventory-item"},"Sugar ",e.inventory.sugar.toFixed(2)):null;return i.createElement("div",{className:"info-inventory"},t,n)}}},{key:"cellInfo",value:function(e){if(e instanceof he&&200*e.droopY>1)return i.createElement("div",{className:"info-cell"},(200*e.droopY).toFixed(0),"% droop")}},{key:"growingCellInfo",value:function(e){if(e instanceof de)return i.createElement("div",{className:"info-growing-cell"},(100-e.timeRemaining/e.timeToBuild*100).toFixed(0),"% mature")}}]),t}(i.Component),Te=n(10),Re=n(11);function Pe(e){var t;return function(){return void 0===t&&(t=e()),t}}var Be=16,Fe=!1,De=Pe(function(){return(new y.A).load("assets/images/roguelikeSheet_transparent.png",function(){De().dispatchEvent({type:"update"}),Fe=!0})}),Ne=(new y.A).load("assets/images/fruit.png"),We={};function Le(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";e=Math.floor(e),t=Math.floor(t);var i="".concat(e,",").concat(t);if(null==We[i]){var r=function(){var i=De().image,r=a.getContext("2d");r.fillStyle=n,r.fillRect(0,0,Be,16),r.drawImage(i,Be*e,Be*t,Be,Be,0,0,Be,Be),o.needsUpdate=!0},a=document.createElement("canvas");a.width=Be,a.height=Be;var o=new y.z(a);o.magFilter=y.s,o.flipY=!0,o.wrapS=y.w,o.wrapT=y.w,Fe?r():De().addEventListener("update",function(){r()}),We[i]=o}return We[i]}var Ie=function e(t,n,i){Object(s.a)(this,e),this.target=t,this.scene=n,this.mito=i},ze=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this))).geometry=void 0,n.material=void 0,n.index=0,n.geometry=t.newGeometry(),n.material=new Ye(e),n.frustumCulled=!1,n}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"newGeometry",value:function(){var e=new y.g,n=new Float32Array(3*t.BUFFER_SIZE),i=new Float32Array(t.BUFFER_SIZE);return e.addAttribute("position",new y.f(n,3).setDynamic(!0)),e.addAttribute("size",new y.f(i,1).setDynamic(!0)),e}}]),Object(l.a)(t,[{key:"startFrame",value:function(){this.index=0}},{key:"commit",value:function(e,t,n,i){this.geometry.attributes.position.setXYZ(this.index,e,t,n),this.geometry.attributes.size.setX(this.index,i),this.index++}},{key:"endFrame",value:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.setDrawRange(0,this.index)}}]),t}(y.v);ze.BUFFER_SIZE=1e5;var Ye=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,{uniforms:{opacity:{value:e.opacity},sizeGlobal:{value:e.size},color:{value:e.color},map:{value:e.map}},vertexShader:qe,fragmentShader:Ve,depthTest:!1,transparent:!0}))).params=e,n.map=void 0,n.map=e.map,n}return Object(h.a)(t,e),t}(y.y),qe="\nattribute float size;\nuniform float sizeGlobal;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",Ve="\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\n#ifdef USE_MAP\n  uniform mat3 uvTransform;\n  uniform sampler2D map;\n#endif\n\nvoid main() {\n    gl_FragColor = vec4( color, opacity );\n\n    #ifdef USE_MAP\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\n        gl_FragColor *= mapTexelToLinear( mapTexel );\n    #endif\n}\n",Ue=function(e){function t(e,n,i){var r;Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n,i))).animationOffset=0,r.waters=[],r.sugars=[],r.handleGetResources=function(e){for(var t=Math.ceil(r.target.water);r.waters.length<t;){var n=e.carrier.pos.clone().sub(r.target.carrier.pos);n.x+=.1*(Math.random()-.5),n.y+=.1*(Math.random()-.5),r.waters.push(n)}for(t=Math.ceil(r.target.sugar);r.sugars.length<t;){var i=e.carrier.pos.clone().sub(r.target.carrier.pos);i.x+=.1*(Math.random()-.5),i.y+=.1*(Math.random()-.5),r.sugars.push(i)}},r.handleGiveResources=function(){var e=Math.ceil(r.target.water);r.waters.length>e&&r.waters.splice(e,r.waters.length-e),e=Math.ceil(r.target.sugar),r.sugars.length>e&&r.sugars.splice(e,r.sugars.length-e)},e.on("get",r.handleGetResources),e.on("give",r.handleGiveResources);for(var a=0;a<r.target.water;a++)r.waters.push(Ge());for(var o=0;o<r.target.sugar;o++)r.sugars.push(Ge());return r}return Object(h.a)(t,e),Object(l.a)(t,null,[{key:"startFrame",value:function(){t.WaterParticles().startFrame(),t.SugarParticles().startFrame()}},{key:"endFrame",value:function(){t.WaterParticles().endFrame(),t.SugarParticles().endFrame()}}]),Object(l.a)(t,[{key:"updateNumParticles",value:function(e){}},{key:"commitParticles",value:function(e,t,n){if(n.length>0){for(var i=0;i<n.length-1;i++){var r=n[i];e.commit(r.x+this.target.carrier.pos.x,r.y+this.target.carrier.pos.y,10,1),t-=1}var a=n[n.length-1],o=t;e.commit(a.x+this.target.carrier.pos.x,a.y+this.target.carrier.pos.y,10,o)}}},{key:"simulateResourcePositions",value:function(){var e=this.waters.concat(this.sugars),t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,s=0,l=0,u=performance.now()/3e3+this.animationOffset;s+=.02*Math.cos(u);var c=.1+.1*o.length();if(s+=-o.x*c,l+=-o.y*c,this.mito.world.player.pos.equals(this.target.carrier.pos)){var h=Math.max(Math.min(B(o.lengthSq(),0,1,3,-5),3),0),d=o.clone().multiplyScalar(.2*h);s+=d.x,l+=d.y}var f=!0,v=!1,p=void 0;try{for(var m,y=e[Symbol.iterator]();!(f=(m=y.next()).done);f=!0){var g=m.value;if(o===g)break;var w=o.x-g.x,b=o.y-g.y,k=w*w+b*b;if(k>0){var x=.003/k;s+=w*x,l+=b*x}}}catch(j){v=!0,p=j}finally{try{f||null==y.return||y.return()}finally{if(v)throw p}}o.x+=s,o.y+=l}}catch(j){n=!0,i=j}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"update",value:function(){this.updateNumParticles(this.target.water),this.updateNumParticles(this.target.sugar),this.simulateResourcePositions(),this.commitParticles(t.WaterParticles(),this.target.water,this.waters),this.commitParticles(t.SugarParticles(),this.target.sugar,this.sugars)}},{key:"destroy",value:function(){}}]),t}(Ie);function Ge(){return new y.B(.01*(Math.random()-.5),.01*(Math.random()-.5))}Ue.WaterParticles=Pe(function(){return new ze({color:new y.i("rgb(9, 12, 255)"),size:45,opacity:.75})}),Ue.SugarParticles=Pe(function(){return new ze({color:new y.i("yellow"),size:85,opacity:.9,map:Le(42,12,"transparent")})});var He=function(e){function t(e){var n,i;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,t.geometry,(i=e.target,Ke().get(i.constructor).clone())))).renderer=e,n}return Object(h.a)(t,e),t}(y.q);He.geometry=new y.u(1,1);var _e=function(e){function t(e,n,i){var r;Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n,i))).mesh=void 0,r.inventoryRenderer=void 0,r.originalColor=void 0,r.audio=void 0,r.lastAudioValueTracker=0,r.pairsLines=[],r.growingRenderer=void 0,r.target instanceof de?(r.growingRenderer=new t(r.target.completedCell,r.scene,r.mito),r.mesh=r.growingRenderer.mesh):r.mesh=new He(Object(R.a)(r)),r.originalColor=r.mesh.material.color.clone(),I(r.target)&&(r.inventoryRenderer=new Ue(r.target.inventory,r.scene,r.mito),r.inventoryRenderer.animationOffset=(r.target.pos.x+r.target.pos.y)/2),r.scene.add(r.mesh);var a=r.target instanceof he?1:0;return r.mesh.position.set(r.target.pos.x,r.target.pos.y,a),r.target instanceof he?r.target.constructor.turnsToBuild||r.mesh.scale.set(.01,.01,1):r.mesh.matrixAutoUpdate=!1,r.mesh.updateMatrix(),(r.target instanceof ve||r.target instanceof pe)&&(r.audio=new y.b(r.mito.audioListener),r.mesh.add(r.audio)),r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"steps",value:function(e,t){return Math.floor(e/t)*t}},{key:"update",value:function(){var e=this;if(this.target instanceof de){var t=B(1.001-this.target.timeRemaining/this.target.timeToBuild,0,1,.2,1);P(this.mesh.scale,{x:t,y:t},.1)}else P(this.mesh.scale,new y.B(1,1),.1);var n=this.target.lightAmount(),i=this.mesh.material;if(this.target instanceof oe){var r=Math.max(0,B(this.target.co2(),1/6,1.001,0,Xe.length-1)),a=Math.floor(r),o=Xe[a];if(this.originalColor=o.clone(),a!==Xe.length-1){var s=r-a,l=Xe[a+1];this.originalColor.lerp(l,s)}}if(i.color=new y.i(0).lerp(this.originalColor,B(n,0,1,.2,1)),this.target instanceof he&&this.mesh.position.set(this.target.pos.x,this.target.pos.y+this.target.droopY,1),ne(this.target)&&i.color.lerp(new y.i(0),1-this.target.energy/q.cellEnergyMax),null!=this.inventoryRenderer&&n>0&&this.inventoryRenderer.update(),this.target instanceof ve&&null!=this.audio){var u=this.target.didConvert?1:0;if(u!==this.lastAudioValueTracker&&u>0){this.audio.setBuffer(E);var c=this.target.pos.distanceToSquared(this.mito.world.player.pos),h=Math.min(1,1/(1+c/25))*this.target.sugarConverted*this.target.sugarConverted;this.audio.setVolume(h),this.audio.play()}this.lastAudioValueTracker=u}if(this.target instanceof pe&&null!=this.audio){var d=this.target.waterTransferAmount;if(d!==this.lastAudioValueTracker){this.audio.setBuffer(C);var f=this.target.waterTransferAmount/(2+this.target.waterTransferAmount),v=this.target.pos.distanceToSquared(this.mito.world.player.pos),p=Math.min(1,1/(1+v/25))*f;this.audio.setVolume(p),null!=this.audio.source&&this.audio.stop(),this.audio.play()}this.lastAudioValueTracker=d}if(this.target.tilePairs instanceof Array){var m=this.target instanceof ve?16763150:new y.i("rgb(9, 12, 255)").getHex(),g=this.target.tilePairs;g.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=g.map(function(t){var n=2*t.length()-.25,i=new y.C(t.x,t.y,0).normalize(),r=e.makeLine(i,i.clone().multiplyScalar(-n/2),n,m);return e.mesh.add(r),r}))}if(this.hasActiveNeighbors(this.target)){var w=this.target instanceof pe?new y.i("rgb(9, 12, 255)").getHex():16777215,b=this.target.activeNeighbors;b.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=b.map(function(t){var n=t.length()-.25,i=new y.C(t.x,t.y,0).normalize(),r=e.target instanceof pe?e.makeLine(i,new y.C,n,w):new y.a(i,new y.C(0,0,5),n,w);return e.mesh.add(r),r}))}}},{key:"hasActiveNeighbors",value:function(e){return Array.isArray(e.activeNeighbors)}},{key:"makeLine",value:function(e,n,i,r){var a=new y.m(t.lineGeometry,new y.n({color:r}));if(a.position.copy(n),e.y>.99999)a.quaternion.set(0,0,0,1);else if(e.y<-.99999)a.quaternion.set(1,0,0,0);else{var o=new y.C(e.z,0,-e.x).normalize(),s=Math.acos(e.y);a.quaternion.setFromAxisAngle(o,s)}return a.scale.set(1,Math.max(0,i),1),a.position.z=.1,a.updateMatrix(),a.matrixAutoUpdate=!1,a}},{key:"destroy",value:function(){this.scene.remove(this.mesh),null!=this.inventoryRenderer&&this.inventoryRenderer.destroy()}}]),t}(Ie);_e.lineGeometry=function(){var e=new y.g;return e.addAttribute("position",new y.l([0,0,0,0,1,0],3)),e}();var Ke=Pe(function(){var e=new Map;return e.set(oe,new y.r({side:y.j,depthWrite:!1})),e.set(se,new y.r({map:Le(8,11),side:y.j,color:new y.i("rgb(112, 89, 44)"),depthWrite:!1})),e.set(ce,new y.r({map:Le(3.5,2.375),side:y.j})),e.set(le,new y.r({map:Le(26,20),side:y.j,color:new y.i("rgb(63, 77, 84)")})),e.set(ue,new y.r({map:Le(8.5625,23.375),side:y.j,color:new y.i("rgb(128, 128, 128)")})),e.set(fe,new y.r({map:Le(6,31),side:y.j,color:new y.i(3190309)})),e.set(ge,e.get(fe)),e.set(ve,new y.r({map:Le(55/16,17.5),side:y.j})),e.set(pe,new y.r({map:Le(59/16,327/16),side:y.j})),e.set(me,new y.r({map:Ne,side:y.j,transparent:!0})),e.set(we,new y.r({map:Le(Math.floor(11.5),Math.floor(9.5)),side:y.j})),e});var Xe=[new y.i("hsl(67, 31%, 25%)"),new y.i("hsl(180, 31%, 76%)"),new y.i("hsl(213, 63%, 58%)")];function Je(){var e=Object(Te.a)(["\n  transform: ",";\n  transition: transform 0.025s;\n  width: 60px;\n  height: 60px;\n  border: 1px solid darkgrey;\n  border-radius: 2px;\n  margin: 0 5px;\n  color: white;\n  text-shadow:\n   -1px -1px 0 #000,\n    1px -1px 0 #000,\n    -1px 1px 0 #000,\n     1px 1px 0 #000;\n  font-size: 12px;\n  font-family: sans-serif;\n  cursor: pointer;\n  background-image:\n    ",",\n    ",";\n  background-size: cover;\n  background-repeat: no-repeat;\n  background-position: center center;\n  background-blend-mode: multiply;\n  image-rendering: pixelated;\n"]);return Je=function(){return e},e}function Ze(){var e=Object(Te.a)(["\n  display: flex;\n  flex-direction: row;\n"]);return Ze=function(){return e},e}var $e=Re.a.div(Ze()),Qe=Re.a.div(Je(),function(e){return e.isSelected?"scale(1.2)":"scale(1)"},function(e){var t=Ke().get(e.type).color.getStyle();return"linear-gradient(".concat(t,", ").concat(t,")")},function(e){var t=Ke().get(e.type).map.image;return null==t?"url()":t instanceof HTMLCanvasElement?"url(".concat(t.toDataURL(),")"):t instanceof Image?"url(".concat(t.src,")"):void 0});function et(e){var t=e.type,n=e.isSelected,r=e.onClick;return i.createElement(Qe,{type:t,isSelected:n,onClick:r},t.displayName)}function tt(e){var t=e.hotkey,n=e.onClick,r=Object(d.a)(e,["hotkey","onClick"]);return i.createElement("div",Object.assign({className:"mito-hud-button mito-hud-build-item",onClick:function(e){n&&n(e),function(e){e.preventDefault(),document.getElementsByTagName("canvas")[0].focus()}(e)}},r),i.createElement("span",{className:"mito-hud-button-hotkey"},t))}var nt=function(e){var t=e.bar,n=e.index,r=e.onIndexClicked;return i.createElement($e,{className:"cell-bar"},t.map(function(e,t){return i.createElement("div",{key:t},i.createElement(et,{type:e,isSelected:n===t,onClick:function(){return r(t)}}),i.createElement(tt,{hotkey:String(t+1),onClick:function(){return r(t)}}))}))},it=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"isTutorialFinished",value:function(){return null==this.mito.tutorialRef||this.mito.tutorialRef.isFinished()}},{key:"render",value:function(){var e=this,t=this.inventory.isMaxed(),n=i.createElement("div",{className:"mito-inventory-maxed".concat(t?" is-maxed":"")},"maxed");return i.createElement(i.Fragment,null,i.createElement("div",{className:m()("mito-hud",{hidden:!this.isTutorialFinished()})},this.renderFruitUI()),i.createElement("div",{className:m()("mito-inventory",{hidden:!1})},n,i.createElement("div",{className:"mito-inventory-container"},this.renderInventoryBar(),this.renderInventory()),i.createElement(nt,{bar:this.mito.cellBar,index:this.mito.cellBarIndex,onIndexClicked:function(t){return e.mito.setCellBarIndex(t)}})))}},{key:"renderInventory",value:function(){return i.createElement("div",{className:"mito-inventory-indicator"},i.createElement("span",{className:"mito-inventory-water"},this.inventory.water.toFixed(2)," water"),"\xa0",i.createElement("span",{className:"mito-inventory-sugar"},this.inventory.sugar.toFixed(2)," sugar"))}},{key:"renderInventoryBar",value:function(){var e=this.inventory.water/q.maxResources,t=this.inventory.sugar/q.maxResources,n=1-(this.inventory.water+this.inventory.sugar)/q.maxResources,r={width:"".concat(100*e,"%")},a={width:"".concat(100*t,"%")},o={width:"".concat(100*n,"%")};return i.createElement("div",{className:"mito-inventory-bar"},i.createElement("div",{style:r,className:"mito-inventory-bar-water"}),i.createElement("div",{style:a,className:"mito-inventory-bar-sugar"}),i.createElement("div",{style:o,className:"mito-inventory-bar-empty"}))}},{key:"renderFruitUI",value:function(){var e=this.world;if(null!=e.fruit)return i.createElement("div",{className:"mito-hud-section"},"You bear Fruit! ",e.fruit.inventory.sugar.toFixed(2)," of ",me.sugarToWin," sugar!")}},{key:"mito",get:function(){return this.props.mito}},{key:"world",get:function(){return this.mito.world}},{key:"player",get:function(){return this.world.player}},{key:"inventory",get:function(){return this.player.inventory}}]),t}(i.Component),rt=n(40),at=Pe(function(){var e=new Q,t=new Q,n=new Q;return{climate:{turnsBetweenRainfall:800,rainDuration:50,waterPerDroplet:2},evaporationRate:2e-4,evaporationBottom:.6,floorCo2:.5,waterGravityPerTurn:.001,fill:[function(i,r){var a=i.x,o=i.y,s=r.height/2-4*(n.perlin2(0,a/5)+1)/2-16*n.perlin2(10,a/20+10),l=B(o-r.height/2,0,r.height/2,-.7,.3),u=t.simplex2(a/5,o/5)<l;if(o>s){if(u)return new le(i,r);var c=Math.pow(B(o-r.height/2,0,r.height/2,.5,1),2),h=e.simplex2(.2*a,.2*o)+.2,d=Math.round(Math.max(1,Math.min(20,h>.4?20*c:0)));if(c*h>1/q.fountainAppearanceRate){var f=Math.min(c*h,1);return new ce(i,d,r,Math.round(q.fountainTurnsPerWater/f))}return new se(i,d,r)}}]}}),ot=Pe(function(){var e=new Q,t=new Q;return{climate:{rainDuration:220,turnsBetweenRainfall:3e3,waterPerDroplet:8},evaporationRate:.002,evaporationBottom:.7,waterGravityPerTurn:.02,floorCo2:.95,fill:[function(n,i){var r=n.x,a=n.y,o=i.height/2-2*(e.perlin2(0,r/20)+1)/2-3*e.perlin2(10,r/100+10),s=B(a,i.height/2,i.height,-.8,-.4),l=t.simplex2(r/4,a/4)<s;if(a>o){if(l)return new le(n,i);var u=Math.floor(Math.max(0,B(a,.75*i.height,i.height,1,9)));return new se(n,u,i)}}]}}),st=Pe(function(){var e=new Q,t=new Q;return{climate:{turnsBetweenRainfall:1200,rainDuration:120,waterPerDroplet:3},waterGravityPerTurn:.1,evaporationBottom:.6,evaporationRate:.001,floorCo2:1,fill:[function(n,i){var r=n.x,a=n.y,o=.55*i.height-4*(t.perlin2(0,r/5)+1)/2-16*t.perlin2(10,r/20+10)-B(r,0,i.width,10,-10),s=a-6*(t.perlin2(0,r/25)+1)/2-20*t.perlin2(10,r/150+10)<.5*i.height?-1:-.15;return e.simplex2(r/10,a/10)<s?new le(n,i):a>o?new se(n,3,i):void 0}]}}),lt={Temperate:at,Desert:ot,Rocky:st},ut=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).gui=void 0;var i=new rt.a({closed:!0,width:450});i.add(q,"environment",Object.keys(lt)).onChange(function(){return setTimeout(function(){return window.location.reload()},100)}),i.add(q,"droop",0,.5,.01),i.add(q,"fountainTurnsPerWater",1,100,1),i.add(q,"isRealtime"),i.add(q,"leafReactionRate",0,.2,1e-4),i.add(q,"leafSugarPerReaction",0,1,.01),i.add(q,"rootTurnsPerTransfer",1,100,1),i.add(q,"soilDarknessBase",0,1,.01),i.add(q,"soilDiffusionType",["discrete","continuous"]),i.add(q,"sunlightReintroduction",0,1,.01),i.add(q,"sunlightDiffusion",0,1,.01),i.add(q,"transportTurnsPerMove",1,50,1),i.add(q,"veinDiffusion",0,.85,1e-4);var r=i.addFolder("Needs Page Refresh");r.add(q,"cellGestationTurns",0,100,1),r.add(q,"cellDiffusionSugar",0,.85,1e-4),r.add(q,"cellDiffusionWater",0,.85,1e-4),r.add(q,"cellEnergyMax",400,1e4,100),r.add(q,"fountainAppearanceRate",1,5,.1),r.add(q,"maxResources",10,1e3,1),r.add(q,"soilDiffusionWater",0,.25,1e-5),r.add(q,"soilMaxWater",1,100,1),r.add(q,"tissueInventoryCapacity",1,100,1);var a=!0,o=!1,l=void 0;try{for(var h,d=i.__controllers.concat(r.__controllers)[Symbol.iterator]();!(a=(h=d.next()).done);a=!0){h.value.onFinishChange(U)}}catch(f){o=!0,l=f}finally{try{a||null==d.return||d.return()}finally{if(o)throw l}}return n.gui=i,n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return null}}]),t}(i.Component),ct=n(26);function ht(e,t,n){return new ct.AStarFinder({diagonalMovement:ct.DiagonalMovement.Always}).findPath(t.x,t.y,n.x,n.y,e)}function dt(e,t,n){for(var i=new ct.Grid(e,t),r=0;r<e;r++)for(var a=0;a<t;a++)i.setWalkableAt(r,a,!1);for(var o=0;o<e;o++)for(var s=0;s<t;s++)n(o,s,i);return i}var ft=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.props.parent.add(this.props.object)}},{key:"componentWillUnmount",value:function(){this.props.parent.remove(this.props.object)}}]),t}(i.PureComponent),vt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).rafid=void 0,n.animate=function(e){n.props.a(e/1e3),n.rafid=requestAnimationFrame(n.animate)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.rafid=requestAnimationFrame(this.animate)}},{key:"componentWillUnmount",value:function(){this.rafid&&cancelAnimationFrame(this.rafid)}}]),t}(r.a.Component),pt=Pe(function(){var e=new y.u(1,1),t=new y.k(e,1),n=new y.n({color:16777215,transparent:!0,opacity:.75}),i=new y.o(t,n);return i.position.z=10,i}),mt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).object=pt().clone(),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return this.object.position.x=this.props.x,this.object.position.y=this.props.y,i.createElement(i.Fragment,null,i.createElement(vt,{a:function(t){return e.object.scale.setScalar(.04*Math.sin(3.7*t)+.94)}}),i.createElement(ft,{object:this.object,parent:this.props.scene}))}}]),t}(i.PureComponent),yt=Pe(function(){var e=new y.h(.1,20),t=new y.r({color:16777215,transparent:!0,opacity:.75,side:y.j}),n=new y.q(e,t);return n.position.z=10,n}),gt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).object=yt().clone(),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.object.position.x=this.props.x,this.object.position.y=this.props.y,i.createElement(i.Fragment,null,i.createElement(ft,{object:this.object,parent:this.props.scene}))}}]),t}(i.PureComponent),wt=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.mito.highlightedTile,t=this.props.mito.getHighlightPosition();return i.createElement(i.Fragment,null,i.createElement(Se,{tile:e}),i.createElement(gt,{x:t.x,y:t.y,scene:this.scene}),this.maybeRenderTileHighlight(e))}},{key:"maybeRenderTileHighlight",value:function(e){if(e)return i.createElement(mt,{x:e.pos.x,y:e.pos.y,scene:this.scene})}},{key:"scene",get:function(){return this.props.mito.scene}}]),t}(i.Component),bt=(i.PureComponent,n(41)),kt=function(e){function t(e,n,i){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n,i))).mesh=void 0,r.mesh=new y.q(new y.u(.75,.75),new y.r({transparent:!0,depthWrite:!1,depthTest:!1,map:Le(29,12,"transparent"),color:new y.i("white"),side:y.j})),P(r.mesh.position,r.target.pos,1),r.mesh.position.z=2,r.scene.add(r.mesh),r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"update",value:function(){var e=this.target.droopPosFloat().clone();e.x+=.04*Math.cos(performance.now()/1e3),e.y+=.08*Math.sin(performance.now()/400),P(this.mesh.position,e,.5),this.mesh.position.z=2}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(Ie),xt=function(e){function t(e,n,i){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n,i))).arrow=void 0,r.arrow=r.makeArrow(r.target.dir),r.mesh.add(r.arrow),r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"makeArrow",value:function(e){var t=e.length()-.25,n=new y.C(e.x,e.y,0).normalize(),i=n.clone().multiplyScalar(-t/2);return new y.a(n,new y.C(i.x,i.y,1),t,16777215,.1,.1)}}]),t}(_e);var jt=function(e){function t(e,n,i){var r;return Object(s.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this,e,n,i))).renderers=new Map,r.deleteDeadEntityRenderers=Object(bt.a)(function(e){return e},function(e){var t=e.deleted,n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,u=r.renderers.get(l);if(null==u)throw new Error("Couldn't find renderer for ".concat(l,"!"));u.destroy(),r.renderers.delete(l)}}catch(c){i=!0,a=c}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}),n.add(Ue.WaterParticles()),n.add(Ue.SugarParticles()),r}return Object(h.a)(t,e),Object(l.a)(t,[{key:"getOrCreateRenderer",value:function(e){var t=this.renderers.get(e);if(null==t){var n=function(e,t,n){if(e instanceof be)return new kt(e,t,n);if(e instanceof ge)return new xt(e,t,n);if(e instanceof ie)return new _e(e,t,n);throw new Error("Couldn't find renderer for ".concat(e))}(e,this.scene,this.mito);return this.renderers.set(e,n),n}return t}},{key:"update",value:function(){var e=this;this.deleteDeadEntityRenderers(this.target.getLastStepStats()),Ue.startFrame(),this.target.entities().forEach(function(t){e.getOrCreateRenderer(t).update()}),Ue.endFrame()}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}}]),t}(Ie),Ot=function(e){function t(e,n,i,r){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(c.a)(t).call(this,e,n))).onWinLoss=r,a.world=void 0,a.scene=new y.x,a.camera=new y.t(0,0,0,0,-100,100),a.cellBar=[fe,ve,pe,ge,me],a.cellBarIndex=0,a.tutorialRef=null,a.mouse=new y.B,a.mouseDown=!1,a.mouseButton=-1,a.highlightedTile=void 0,a.gameState="main",a.firstActionTakenYet=!1,a.audioListener=new y.d,a.keyMap=new Set,a.uiState={type:"main"},a.events={contextmenu:function(e){return e.preventDefault(),!1},mousemove:function(e){a.mouse.x=e.clientX,a.mouse.y=e.clientY},click:function(){},mousedown:function(e){a.mouseButton=e.button,a.mouseDown=!0},mouseup:function(){a.mouseDown=!1},keydown:function(e){a.firstActionTakenYet=!0;var t=e.key;a.keyMap.add(t),e.repeat||a.handleKeyDown(t)},keyup:function(e){a.keyMap.delete(e.key)},wheel:function(e){e.deltaX+e.deltaY<0?a.setCellBarIndex(a.cellBarIndex-1):a.setCellBarIndex(a.cellBarIndex+1)}},a.handleKeyDown=function(e){if("?"!==e)if("instructions"!==a.gameState){if(-1!==["1","2","3","4","5"].indexOf(e)){var t=e.charCodeAt(0)-"1".charCodeAt(0);a.cellBarIndex=t}}else"Escape"===e&&(a.gameState="main");else a.gameState="instructions"===a.gameState?"main":"instructions"},a.expandingTileHighlight=new y.q(new y.u(1,1),new y.r({color:"white",side:y.j,transparent:!0,opacity:.5})),a.worldRenderer=void 0,null==i.info.world&&(i.info.world=new xe(i.info.environment)),a.world=i.info.world,a.camera.position.z=10,a.camera.lookAt(new y.C(0,0,0)),a.camera.position.x=a.world.player.pos.x,a.camera.position.y=a.world.player.pos.y,a.camera.zoom=1.5,a.camera.add(a.audioListener),a.worldRenderer=new jt(a.world,a.scene,Object(R.a)(a)),a.world.step(),function(e){var t=0;function n(){3===++t&&(b.audio.currentTime=0,k.audio.currentTime=0,x.audio.currentTime=0,b.gain.connect(e.gain),k.gain.connect(e.gain),x.gain.connect(e.gain))}(b=D(e,"mito-base")).audio.oncanplaythrough=n,b.gain.gain.value=.5,(k=D(e,"mito-strings")).audio.oncanplaythrough=n,k.gain.gain.value=0,(x=D(e,"mito-drums")).audio.oncanplaythrough=n,x.gain.gain.value=0,(j=D(e,"footsteps")).gain.gain.value=0,j.gain.connect(e.gain),(O=D(e,"build")).gain.gain.value=0,O.gain.connect(e.gain);var i=new y.e;i.load("assets/audio/Blop-Mark_DiAngelo-79054334.mp3",function(e){E=e},function(e){e.loaded,e.total},function(e){}),i.load("assets/audio/suckwater.wav",function(e){C=e},function(e){e.loaded,e.total},function(e){})}(a.audioContext),a.updateAmbientAudio(),window.mito=Object(R.a)(a),a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"setCellBarIndex",value:function(e){this.cellBarIndex=(e%this.cellBar.length+this.cellBar.length)%this.cellBar.length}},{key:"render",value:function(){return i.createElement(i.Fragment,null,i.createElement(it,{mito:this}),i.createElement(Ae,{mito:this,state:this.gameState}),i.createElement(ut,null),i.createElement(wt,{mito:this}))}},{key:"resetUIState",value:function(){"expanding"===this.uiState.type&&(this.camera.zoom=this.uiState.originalZoom,this.camera.updateProjectionMatrix(),this.uiState={type:"main"})}},{key:"selectedCell",get:function(){return this.cellBar[this.cellBarIndex]}}]),Object(l.a)(t,[{key:"updateAmbientAudio",value:function(){var e=this.world.player.pos.y,t=B(e,this.world.height/2,this.world.height,0,.5),n=B(e,this.world.height/2,0,0,.5);x.gain.gain.value=Math.max(0,t),k.gain.gain.value=Math.max(0,n)}},{key:"logRenderInfo",value:function(){"Geometries in memory: ".concat(this.renderer.info.memory.geometries,"\nTextures in memory: ").concat(this.renderer.info.memory.textures,"\n# Render Calls: ").concat(this.renderer.info.render.calls,"\n# Render Lines: ").concat(this.renderer.info.render.lines,"\n# Render Points: ").concat(this.renderer.info.render.points,"\n# Render Tris: ").concat(this.renderer.info.render.triangles,"\n")}},{key:"perfDebug",value:function(){var e=0,t=0;this.scene.traverse(function(n){n.matrixAutoUpdate?e++:t++}),console.log("yes",e,"no",t);var n=new Map;this.scene.traverse(function(e){var t=n.get(e.name||e.constructor.name)||[];n.set(e.name||e.constructor.name,t),t.push(e)}),console.log(n)}},{key:"worldStep",value:function(){this.firstActionTakenYet&&(this.world.step(),this.tutorialRef&&this.tutorialRef.setState({time:this.world.time}),"main"===this.gameState&&(this.gameState=this.world.checkWinLoss()||this.gameState,"win"!==this.gameState&&"lose"!==this.gameState||this.onWinLoss(this.gameState)),this.updateAmbientAudio())}},{key:"getCameraNormCoordinates",value:function(e,t){return new y.B(e/this.canvas.width*2-1,-t/this.canvas.height*2+1)}},{key:"getHighlightVector",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=new y.B(e-this.canvas.width/2,t-this.canvas.height/2);return n.setLength(.75),n}},{key:"getHighlightPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightVector(e,t),i=this.world.player.posFloat,r=i.x,a=i.y;return n.x+=r,n.y+=a,n}},{key:"getHighlightedTile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightPosition(e,t);n.round();var i=this.world.tileAt(n.x,n.y);if(null!=i&&i.lightAmount()>0)return i}},{key:"animate",value:function(){var e=this.world;if(this.canvas.focus(),"main"===this.gameState){if(q.isRealtime){var t=this.keysToMovement(this.keyMap);t&&this.world.player.setAction(t);var n=!0,i=!1,r=void 0;try{for(var a,o=this.keyMap[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;Ee[s]&&this.world.player.setAction(Ee[s])}}catch(h){i=!0,r=h}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}this.mouseDown&&(0===this.mouseButton?this.handleLeftClick():2===this.mouseButton&&this.handleRightClick()),this.worldStep()}else null!=e.player.getAction()&&this.worldStep();this.worldRenderer.update()}"expanding"===this.uiState.type&&(this.world.player.isBuildCandidate(this.world.tileAt(this.uiState.target))||this.resetUIState());var l=this.getCameraNormCoordinates(this.mouse.x,this.mouse.y);if("main"===this.uiState.type){this.scene.remove(this.expandingTileHighlight);var u=new y.B(this.world.player.posFloat.x+l.x/2,this.world.player.posFloat.y-l.y/2);P(this.camera.position,u,.3)}else{this.scene.add(this.expandingTileHighlight),this.expandingTileHighlight.position.set(this.uiState.target.x,this.uiState.target.y,1);var c=new y.B(this.uiState.target.x,this.uiState.target.y);P(this.camera.position,c,.3)}this.renderer.render(this.scene,this.camera),this.highlightedTile=this.getHighlightedTile()}},{key:"keysToMovement",value:function(e){var t=new y.B,n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;Ce[s]&&t.add(Ce[s].dir)}}catch(l){i=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return 0===t.x&&0===t.y?null:{type:"move",dir:t}}},{key:"resize",value:function(e,t){var n=t/e;this.camera.left=-12/n,this.camera.right=12/n,this.camera.top=-12,this.camera.bottom=12,this.camera.updateProjectionMatrix()}},{key:"handleRightClick",value:function(){var e=this.getHighlightedTile();null!=e&&this.world.player.setAction({type:"deconstruct",position:e.pos})}},{key:"handleLeftClick",value:function(){this.firstActionTakenYet=!0;var e=this.getHighlightedTile();if(null!=e&&this.world.player.isBuildCandidate(e)){var t=[];if(this.selectedCell===ge){var n=this.getHighlightVector().setLength(1).round();t.push(n)}var i={type:"build",cellType:this.selectedCell,position:e.pos.clone(),args:t};this.world.player.setAction(i)}}}]),t}(w);Ot.expansionTiles=[fe,pe,we];var Et=Ot,Ct=n(24),Mt=n(76);function At(e,t){var n=t.dX,i=t.dY,r=t.scale,a=e.cartesian,o=a.x,s=a.y;return[window.innerWidth/2+n+o*r,window.innerHeight/2+i+s*r]}n(72);function St(){var e=Object(Te.a)(["\n  position: absolute;\n  left: 20px;\n  align-self: center;\n  justify-self: top;\n  background: rgba(255, 255, 255, 0.9);\n  border-radius: 5px;\n  color: black;\n  animation: ",' 0.2s both;\n\n  &::before {\n    position: absolute;\n    top: 50%;\n    transform: translate(-100%, -50%);\n    left: 0;\n    content: "";\n    border: 20px solid transparent;\n    border-right-color: rgba(255, 255, 255, 0.9);\n  }\n']);return St=function(){return e},e}function Tt(){var e=Object(Te.a)(["\n  from {\n    opacity: 0;\n    transform: translateX(-80px) scale(0.75);\n  }\n\n  to {\n    opacity: 1;\n    transform: translateX(0) scale(1);\n  }\n"]);return Tt=function(){return e},e}var Rt=Object(Re.b)(Tt()),Pt=Re.a.div(St(),Rt);var Bt=function(e){var t=e.tile,n=e.camera,i=e.children,a=At(t,n),o=Object(H.a)(a,2),s=o[0],l=o[1],u={zIndex:1,position:"absolute",left:s+.5*n.scale,top:l,display:"flex"};return r.a.createElement("div",{style:u},r.a.createElement(Pt,null,i))};function Ft(){var e=Object(Te.a)(["\n  margin-left: auto;\n"]);return Ft=function(){return e},e}function Dt(){var e=Object(Te.a)(["\n  cursor: pointer;\n  position: relative;\n  border-bottom: 1px solid black;\n  margin: 20px 0;\n  display: flex;\n"]);return Dt=function(){return e},e}var Nt=Re.a.div(Dt()),Wt=Re.a.div(Ft());var Lt=function(e){var t=e.children,n=e.shrunkElements,a=Object(i.useState)(!1),o=Object(H.a)(a,2),s=o[0],l=o[1];return r.a.createElement("div",null,r.a.createElement(Nt,{onClick:function(){l(!s)}},n,s?r.a.createElement(Wt,null,"\u25bc"):r.a.createElement(Wt,null,"\u25b6")),s?r.a.createElement("div",null,t):null)};function It(){var e=Object(Te.a)(["\n  text-transform: uppercase;\n  font-size: 12px;\n  font-family: sans-serif;\n"]);return It=function(){return e},e}function zt(){var e=Object(Te.a)(["\n  cursor: pointer;\n  padding: 10px;\n  width: 100%;\n  background-color: darkgreen;\n  color: white;\n  font-size: 18px;\n"]);return zt=function(){return e},e}function Yt(){var e=Object(Te.a)(["\n  margin: 10px;\n  width: 320px;\n"]);return Yt=function(){return e},e}var qt=Re.a.div(Yt()),Vt=Re.a.button(zt()),Ut=Re.a.div(It());var Gt=function(e){var t=e.tile,n=e.onClickPlay,i=-1===t.info.height||t.info.conquered?null:r.a.createElement(Vt,{onClick:function(){n(t)}},"Populate"),a=t.info.conquered?r.a.createElement("h1",null,"Populated"):-1===t.info.height?r.a.createElement("h1",null,"Deep Water"):r.a.createElement("h1",null,"Unexplored"),o=Object(z.a)({},t.info);delete o.world;var s=-1===t.info.height?null:r.a.createElement(Lt,{shrunkElements:r.a.createElement(Ut,null,"Details")},r.a.createElement("pre",{style:{fontSize:"12px"}},JSON.stringify(o,null,4)));return r.a.createElement(qt,null,a,s,i)},Ht=Math.sqrt(3)/2,_t=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(r)))).state={cameraState:{scale:48,dX:0,dY:0},pressedKeys:{}},n.canvas=null,n.rafId=void 0,n.handleCanvasRef=function(e){n.canvas=e,null!=e&&n.handleResize()},n.handleCanvasClick=function(e){if(null!=n.canvas)if(null!=n.state.highlightedTile)n.setState({highlightedTile:void 0});else{var t=function(e,t,n,i){var r=n.scale,a=n.dX,o=n.dY,s=t.width/2+a,l=t.height/2+o,u=i.nativeEvent,c=u.offsetX,h=u.offsetY,d=(c-s)/r/1.5,f=((h-l)/r-Ht*d)/(2*Ht),v=function(e,t,n){var i=Math.round(e),r=Math.round(t),a=Math.round(n),o=Math.abs(i-e),s=Math.abs(r-t),l=Math.abs(a-n);return o>s&&o>l?i=-r-a:s>l?r=-i-a:a=-i-r,{i:i,j:r,k:a}}(d,f,-(d+f));return e.tileAt(v.i,v.j)}(n.props.overWorld,n.canvas,n.state.cameraState,e);null!=t&&t.info.visible&&n.setState({highlightedTile:t})}},n.onPlayLevel=function(e){n.props.onPlayLevel(e)},n.handleKeyDown=function(e){if(!e.repeat){var t=Object(z.a)({},n.state.pressedKeys,Object(Ct.a)({},e.code,!0));n.setState({pressedKeys:t})}},n.handleKeyUp=function(e){var t=Object(z.a)({},n.state.pressedKeys);delete t[e.code],n.setState({pressedKeys:t})},n.handleResize=function(){null!=n.canvas&&(n.canvas.width=window.innerWidth,n.canvas.height=window.innerHeight,n.drawMap())},n.updateCamera=function(){var e=new y.B;for(var t in n.state.pressedKeys)"KeyW"===t||"ArrowUp"===t?e.y+=20:"KeyS"===t||"ArrowDown"===t?e.y-=20:"KeyA"===t||"ArrowLeft"===t?e.x+=20:"KeyD"!==t&&"ArrowRight"!==t||(e.x-=20);if(e.setLength(20),0!==e.x||0!==e.y){var i=n.state.cameraState;n.setState({cameraState:Object(z.a)({},i,{dX:i.dX+e.x,dY:i.dY+e.y})})}n.rafId=requestAnimationFrame(n.updateCamera)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"drawMap",value:function(){if(null!=this.canvas){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height);var e=!0,t=!1,n=void 0;try{for(var i,r=this.props.overWorld[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var a=i.value;Jt(this.canvas,this.state.cameraState,a)}}catch(o){t=!0,n=o}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),window.addEventListener("resize",this.handleResize),this.rafId=requestAnimationFrame(this.updateCamera)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("resize",this.handleResize),cancelAnimationFrame(this.rafId)}},{key:"componentDidUpdate",value:function(){this.drawMap()}},{key:"render",value:function(){return r.a.createElement("div",{className:"overworld-map-container"},r.a.createElement("canvas",{ref:this.handleCanvasRef,onClick:this.handleCanvasClick}),this.maybeRenderHighlightedTile())}},{key:"maybeRenderHighlightedTile",value:function(){if(null!=this.state.highlightedTile)return r.a.createElement(Bt,{camera:this.state.cameraState,tile:this.state.highlightedTile},r.a.createElement(Gt,{tile:this.state.highlightedTile,onClickPlay:this.onPlayLevel}))}}]),t}(r.a.Component);function Kt(e,t,n,i){e.strokeStyle="rgb(112, 112, 112)",e.beginPath(),e.moveTo(t+i,n);for(var r=1;r<6;r++){var a=r/6*Math.PI*2;e.lineTo(t+Math.cos(a)*i,n+Math.sin(a)*i)}e.closePath(),e.fill(),e.stroke()}var Xt=Object(Mt.a)().domain([-1,0,1,5,6]).range(["rgb(0, 60, 255)","lightblue","yellow","orange"]);function Jt(e,t,n){var i=t.scale,r=At(n,t),a=Object(H.a)(r,2),o=a[0],s=a[1],l=e.getContext("2d");n.info.visible?(l.fillStyle=Xt(n.info.height),Kt(l,o,s,i),l.font="12px serif",l.textAlign="center",l.textBaseline="middle",l.fillStyle="#666",l.fillText(n.info.height+"",o,s,i)):(l.fillStyle="grey",Kt(l,o,s,i))}var Zt=n(16),$t=n.n(Zt),Qt=n(33),en=n.n(Qt),tn=Math.sqrt(3)/2,nn=function(){function e(t,n){Object(s.a)(this,e),this.i=t,this.j=n,this.neighbors=new Array(6),this.info={height:0,rainfall:"medium",soilType:"average",temperature:"temperate",wind:"low",conquered:!1,visible:!1}}return Object(l.a)(e,[{key:"k",get:function(){return-(this.i+this.j)}},{key:"magnitude",get:function(){return Math.abs(this.i)+Math.abs(this.j)+Math.abs(this.k)}},{key:"cartesian",get:function(){var e=this.i,t=this.j;return{x:1.5*e,y:2*tn*t+tn*e}}}]),e}(),rn=Symbol.iterator,an=function(){function e(){Object(s.a)(this,e),this.tiles={}}return Object(l.a)(e,[{key:"hash",value:function(e,t){return"".concat(e,",").concat(t)}},{key:"get",value:function(e,t){return this.tiles[this.hash(e,t)]}},{key:"set",value:function(e,t,n){this.tiles[this.hash(e,t)]=n}},{key:"hookUpNeighbors",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=this[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var a=i.value,o=a.i,s=a.j;a.neighbors[0]=this.get(o+1,s),a.neighbors[1]=this.get(o,s+1),a.neighbors[2]=this.get(o-1,s+1),a.neighbors[3]=this.get(o-1,s),a.neighbors[4]=this.get(o,s-1),a.neighbors[5]=this.get(o+1,s-1)}}catch(l){t=!0,n=l}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}},{key:rn,value:$t.a.mark(function e(){var t;return $t.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=$t.a.keys(this.tiles);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.tiles[t];case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)})}]),e}(),on=Symbol.iterator,sn=function(){function e(t){Object(s.a)(this,e),this.storage=t,this.startTile=void 0,t.hookUpNeighbors();var n=Array.from(t);this.startTile=n.filter(function(e){return 0===e.info.height}).sort(function(e,t){return e.magnitude-t.magnitude})[0],this.startTile.info.visible=!0}return Object(l.a)(e,null,[{key:"randomHeight",value:function(e,t){var n=e.cartesian,i=n.x,r=n.y,a=0;return a+=6*(t.noise3D(i/24,r/24,0)-.2),a+=6*t.noise3D(i/24,r/24,1.453),a+=1.5*t.noise3D(i/6,r/6,1.453),a+=1,(a-=.025*Math.abs(r*r))<0&&a>=-1&&(a=0),a=Math.round(Math.max(Math.min(a,6),-1))}},{key:"populateLevelInfo",value:function(t,n){var i=t.info;i.height=e.randomHeight(t,n),i.environment=i.height<2?at():i.height<4?st():ot()}},{key:"generateFilledHex",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=new an,i=new en.a,r=-t;r<=t;r++)for(var a=-t;a<=t;a++){var o=-(r+a);if(!(Math.abs(o)>t)){var s=new nn(r,a);e.populateLevelInfo(s,i),n.set(r,a,s)}}return new e(n)}},{key:"generateRectangle",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,i=new an,r=new en.a,a=Math.max(t/2,n/2),o=-a;o<=a;o++)for(var s=-a;s<=a;s++){var l=-(o+s);if(!(Math.abs(l)>a)){var u=new nn(o,s),c=u.cartesian,h=c.x,d=c.y;h<-t/2||h>t/2||d<-n/2||d>n/2||(e.populateLevelInfo(u,r),i.set(o,s,u))}}return new e(i)}}]),Object(l.a)(e,[{key:"getStartTile",value:function(){return this.startTile}},{key:"tileAt",value:function(e,t){return this.storage.get(e,t)}},{key:on,value:$t.a.mark(function e(){var t,n,i,r,a,o;return $t.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,i=void 0,e.prev=3,r=this.storage[Symbol.iterator]();case 5:if(t=(a=r.next()).done){e.next=12;break}return o=a.value,e.next=9,o;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,i=e.t0;case 18:e.prev=18,e.prev=19,t||null==r.return||r.return();case 21:if(e.prev=21,!n){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})}]),e}(),ln=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this,e))).handlePlayLevel=function(e){console.log(e.info),e.info.visible&&!e.info.conquered&&n.setState({activeLevel:e})},n.handleWinLoss=function(e){if("win"===e&&n.state.activeLevel){var t=n.state.activeLevel;t.info.conquered=!0;var i=!0,r=!1,a=void 0;try{for(var o,s=t.neighbors[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.info.visible=!0}}catch(l){r=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}n.setState({activeLevel:void 0})}};var i=sn.generateRectangle(100,50),r=i.getStartTile();return n.state={overWorld:i,activeLevel:r},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},this.maybeRenderOverWorldMap(),this.maybeRenderLevel())}},{key:"maybeRenderOverWorldMap",value:function(){if(null==this.state.activeLevel)return r.a.createElement(_t,{overWorld:this.state.overWorld,onPlayLevel:this.handlePlayLevel})}},{key:"maybeRenderLevel",value:function(){if(null!=this.state.activeLevel)return r.a.createElement(T,{sketchClass:Et,otherArgs:[this.state.activeLevel,this.handleWinLoss]})}}]),t}(r.a.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(ln,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[44,1,2]]]);
//# sourceMappingURL=main.111b68ce.chunk.js.map