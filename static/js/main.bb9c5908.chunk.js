(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{104:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){},107:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){},110:function(e,t,n){},111:function(e,t,n){},117:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(26),o=n.n(i),s=n(49),l=n(21),c=n(4),u=n(3),h=n(7),d=n(5),m=n(6),f=n(20),v=n(28),p=n(13),y=n(9),g=n.n(y),w=n(2),b={click:!0,contextmenu:!0,dblclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,touchstart:!0,touchmove:!0,touchend:!0,keyup:!0,keydown:!0,keypress:!0,wheel:!0},k=function(){function e(t,n){Object(c.a)(this,e),this.renderer=t,this.audioContext=n,this.elements=void 0,this.events=void 0,this.timeElapsed=0,this.frameCount=0}return Object(u.a)(e,[{key:"aspectRatio",get:function(){return this.renderer.domElement.height/this.renderer.domElement.width}},{key:"resolution",get:function(){return new w.Vector2(this.renderer.domElement.width,this.renderer.domElement.height)}},{key:"canvas",get:function(){return this.renderer.domElement}}]),e}();k.id=void 0;var E,O,x,j,M,C,S,A=n(35),T=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).frameId=void 0,n.lastTimestamp=0,n.stop=!1,n.loop=function(e){var t=e-n.lastTimestamp;n.lastTimestamp=e,n.props.sketch.frameCount++,n.props.sketch.timeElapsed=e;try{n.props.sketch.animate(t)}catch(r){console.error(r)}n.stop||(n.setState({frameCount:n.props.sketch.frameCount}),n.frameId=requestAnimationFrame(n.loop))},n.handleWindowResize=function(){var e=n.props.sketch.renderer;n.updateRendererCanvasToMatchParent(e),null!=n.props.sketch.resize&&n.props.sketch.resize(e.domElement.width,e.domElement.height)},n.state={frameCount:e.sketch.frameCount},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize();var t=this.props.sketch.renderer.domElement;t.tabIndex=1,Object.keys(b).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.addEventListener(n,r):t.addEventListener(n,r))}}),this.frameId=requestAnimationFrame(this.loop)}},{key:"render",value:function(){var e=[];return null!=this.props.sketch.render&&e.push(this.props.sketch.render()),null!=this.props.sketch.elements&&e.push.apply(e,Object(p.a)(this.props.sketch.elements)),r.createElement("div",{className:"sketch-elements"},e.map(function(e,t){return r.cloneElement(e,{key:t})}))}},{key:"componentWillUnmount",value:function(){var e=this;this.stop=!0,this.props.sketch.destroy&&this.props.sketch.destroy(),null!=this.frameId&&cancelAnimationFrame(this.frameId),this.props.sketch.renderer.dispose(),window.removeEventListener("resize",this.handleWindowResize);var t=this.props.sketch.canvas;Object.keys(b).forEach(function(n){if(null!=e.props.sketch.events){var r=e.props.sketch.events[n];null!=r&&(e.props.eventsOnBody?document.body.removeEventListener(n,r):t.removeEventListener(n,r))}})}},{key:"updateRendererCanvasToMatchParent",value:function(e){var t=e.domElement.parentElement;null!=t&&e.setSize(t.clientWidth,t.clientHeight)}}]),t}(r.Component),R=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).state={status:{type:"loading"},volumeEnabled:JSON.parse(window.localStorage.getItem("sketch-volumeEnabled")||"true")},n.audioContext=void 0,n.userVolume=void 0,n.handleContainerRef=function(e){if(null!=e)try{var t=window.AudioContext||window.webkitAudioContext,r=n.audioContext=new t;w.AudioContext.setContext(r),n.userVolume=r.createGain(),n.userVolume.gain.setValueAtTime(.8,0),n.userVolume.connect(r.destination),(r.gain=r.createGain()).connect(n.userVolume),document.addEventListener("visibilitychange",n.handleVisibilityChange);var a=new w.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0,antialias:!0});e.appendChild(a.domElement);var i=n.props.otherArgs||[],o=Object(v.a)(n.props.sketchClass,[a,n.audioContext].concat(Object(p.a)(i)));n.setState({status:{type:"success",sketch:o}})}catch(s){n.setState({status:{type:"error",error:s}}),console.error(s)}else"success"===n.state.status.type&&n.state.status.sketch.canvas.remove(),document.removeEventListener("visibilitychange",n.handleVisibilityChange),null!=n.audioContext&&n.audioContext.close(),n.setState({status:{type:"loading"}})},n.handleVolumeButtonClick=function(){var e=!n.state.volumeEnabled;n.setState({volumeEnabled:e}),window.localStorage.setItem("sketch-volumeEnabled",JSON.stringify(e))},n.handleVisibilityChange=function(){null!=n.audioContext&&(document.hidden?n.audioContext.suspend():n.state.volumeEnabled&&n.audioContext.resume())},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){null!=this.userVolume&&null!=this.audioContext&&(this.state.volumeEnabled&&"suspended"===this.audioContext.state?this.audioContext.resume():this.state.volumeEnabled||"running"!==this.audioContext.state||this.audioContext.suspend());var e=this.props,t=(e.sketchClass,e.otherArgs,e.eventsOnBody,e.errorElement,Object(f.a)(e,["sketchClass","otherArgs","eventsOnBody","errorElement"])),n=g()("sketch-component",this.state.status.type);return r.createElement("div",Object.assign({},t,{id:this.props.sketchClass.id,className:n,ref:this.handleContainerRef}),this.renderSketchOrStatus(),this.renderVolumeButton())}},{key:"renderSketchOrStatus",value:function(){var e=this.state.status;return"success"===e.type?r.createElement(T,{key:this.props.sketchClass.id,sketch:e.sketch,eventsOnBody:this.props.eventsOnBody}):"error"===e.type?this.props.errorElement||this.renderDefaultErrorElement(e.error.message):"loading"===e.type?null:void 0}},{key:"renderDefaultErrorElement",value:function(e){return r.createElement("p",{className:"sketch-error"},"Oops - something went wrong! Make sure you're using Chrome, or are on your desktop.",r.createElement("pre",null,e))}},{key:"renderVolumeButton",value:function(){var e=this.state.volumeEnabled;return r.createElement("button",{className:"user-volume",onClick:this.handleVolumeButtonClick},e?r.createElement(A.b,null):r.createElement(A.a,null))}}]),t}(r.Component),N=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).handleDivRef=function(e){null!=e||n.exitFullscreen()},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:"full-page-sketch",ref:this.handleDivRef},r.createElement(R,{sketchClass:this.props.sketchClass,otherArgs:this.props.otherArgs}))}},{key:"exitFullscreen",value:function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()}}]),t}(r.Component),P=n(12),D=n(44);function F(e,t,n){e.x=e.x*(1-n)+t.x*n,e.y=e.y*(1-n)+t.y*n}function B(e,t,n,r,a){return function(e,t,n){return e+(t-e)*n}(r,a,(e-t)/(n-t))}function L(e,t){var n=document.createElement("source");return n.src="/assets/audio/".concat(e,".").concat(t),n.type="audio/".concat(t),n}function W(e,t){var n=document.createElement("audio");n.autoplay=!0,n.loop=!0,n.appendChild(L(t,"ogg")),n.appendChild(L(t,"mp3")),n.appendChild(L(t,"wav"));var r=e.createMediaElementSource(n),a=e.createGain();return r.connect(a),{audio:n,gain:a}}var I=n(24);function V(e){return Math.round(1e12*e)/1e12}var G=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(c.a)(this,e),this.capacity=t,this.carrier=n,this.water=r,this.sugar=a,this.events=void 0,this.validate()}return Object(u.a)(e,[{key:"give",value:function(e,t,n){if(e===this)throw new Error("shouldn't give to self");var r=Math.min(t,this.water),a=Math.min(n,this.sugar),i=V(r+a),o=e.space();return i>o&&(r=Math.floor(r/i*o),a=Math.floor(a/i*o)),this.change(-r,-a),e.change(r,a),this.events&&this.events.emit("give",e,r,a),e.events&&e.events.emit("get",this,r,a),{water:r,sugar:a}}},{key:"on",value:function(e,t){this.events=this.events||new I.EventEmitter,this.events.on(e,t)}},{key:"off",value:function(e,t){this.events=this.events||new I.EventEmitter,this.events.off(e,t)}},{key:"add",value:function(e,t){var n=V(e+t),r=this.space();n>r&&(e=e/n*r,t=t/n*r),this.change(e,t)}},{key:"change",value:function(e,t){var n=V(this.water+e),r=V(this.sugar+t);this.validate(n,r),this.water=n,this.sugar=r,this.water<0&&(this.water=0),this.sugar<0&&(this.sugar=0),this.water+this.sugar>this.capacity&&(this.water>this.sugar?this.water=this.capacity-this.sugar:this.sugar=this.capacity-this.water)}},{key:"space",value:function(){return V(this.capacity-this.water-this.sugar)}},{key:"isMaxed",value:function(){return this.space()<1}},{key:"validate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.water,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sugar,n=this.capacity;e<0&&console.warn("water < 0: ".concat(e)),t<0&&console.warn("sugar < 0: ".concat(t)),e+t>n&&console.warn("bad inventory: ".concat(e," water + ").concat(t," > ").concat(n," max"))}}]),e}();function z(e){return null!=e&&e.inventory instanceof G}var Y=n(11),U={isRealtime:!0,environment:"Temperate",cellEnergyMax:1e4,tissueInventoryCapacity:6,rootTurnsPerTransfer:20,leafReactionRate:.01,leafSugarPerReaction:1,cellGestationTurns:20,cellDiffusionWater:.002,cellDiffusionSugar:.002,soilDarknessBase:.2,soilDiffusionType:"discrete",soilDiffusionWater:.001,veinDiffusion:.5,soilMaxWater:20,droop:.03,fountainTurnsPerWater:11,fountainAppearanceRate:1.5,transportTurnsPerMove:5,sunlightReintroduction:.15,sunlightDiffusion:0,maxResources:100},q=Object(Y.a)({},U);if(window.location.hash.length>0){var H=JSON.parse(decodeURI(window.location.hash.substr(1)));Object.assign(q,H)}function _(){for(var e={},t=0,n=Object.keys(U);t<n.length;t++){var r=n[t],a=q[r];a!==U[r]&&(e[r]=a)}Object.keys(e).length>0?window.location.hash=encodeURI(JSON.stringify(e)):window.location.hash=""}_();var K=n(18),X=n(8),J=function(){function e(t,n,r){Object(c.a)(this,e),this.x=t,this.y=n,this.z=r}return Object(u.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,n){return this.x*e+this.y*t+this.z*n}}]),e}(),Z=[new J(1,1,0),new J(-1,1,0),new J(1,-1,0),new J(-1,-1,0),new J(1,0,1),new J(-1,0,1),new J(1,0,-1),new J(-1,0,-1),new J(0,1,1),new J(0,-1,1),new J(0,1,-1),new J(0,-1,-1)],$=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Q=.5*(Math.sqrt(3)-1),ee=(3-Math.sqrt(3))/6,te=1/6,ne=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2147483647*Math.random();Object(c.a)(this,e),this.perm=new Array(512),this.gradP=new Array(512),this.octaveNum=6,this.octaveFalloff=.5,this.octaveMatrix2=[2*Math.cos(1),2*-Math.sin(1),2*Math.sin(1),2*Math.cos(1)],this.seed(t)}return Object(u.a)(e,[{key:"seed",value:function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?$[t]^255&e:$[t]^e>>8&255,this.perm[t]=this.perm[t+256]=n,this.gradP[t]=this.gradP[t+256]=Z[n%12]}}}]),Object(u.a)(e,[{key:"simplex2",value:function(e,t){var n,r,a=(e+t)*Q,i=Math.floor(e+a),o=Math.floor(t+a),s=(i+o)*ee,l=e-i+s,c=t-o+s;l>c?(n=1,r=0):(n=0,r=1);var u=l-n+ee,h=c-r+ee,d=l-1+2*ee,m=c-1+2*ee;i&=255,o&=255;var f=this.gradP[i+this.perm[o]],v=this.gradP[i+n+this.perm[o+r]],p=this.gradP[i+1+this.perm[o+1]],y=.5-l*l-c*c,g=.5-u*u-h*h,w=.5-d*d-m*m;return 70*((y<0?0:(y*=y)*y*f.dot2(l,c))+(g<0?0:(g*=g)*g*v.dot2(u,h))+(w<0?0:(w*=w)*w*p.dot2(d,m)))}},{key:"octaveSimplex2",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.octaveNum,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveFalloff,a=0,i=e,o=t,s=1,l=0;l<n;l++){a+=this.simplex2(i,o)*s;var c=i*this.octaveMatrix2[0]+o*this.octaveMatrix2[1],u=i*this.octaveMatrix2[2]+o*this.octaveMatrix2[3];i=c,o=u,s*=r}return a}},{key:"simplex3",value:function(e,t,n){var r,a,i,o,s,l,c=(e+t+n)*(1/3),u=Math.floor(e+c),h=Math.floor(t+c),d=Math.floor(n+c),m=(u+h+d)*te,f=e-u+m,v=t-h+m,p=n-d+m;f>=v?v>=p?(r=1,a=0,i=0,o=1,s=1,l=0):f>=p?(r=1,a=0,i=0,o=1,s=0,l=1):(r=0,a=0,i=1,o=1,s=0,l=1):v<p?(r=0,a=0,i=1,o=0,s=1,l=1):f<p?(r=0,a=1,i=0,o=0,s=1,l=1):(r=0,a=1,i=0,o=1,s=1,l=0);var y=f-r+te,g=v-a+te,w=p-i+te,b=f-o+2*te,k=v-s+2*te,E=p-l+2*te,O=f-1+.5,x=v-1+.5,j=p-1+.5;u&=255,h&=255,d&=255;var M=this.gradP,C=this.perm,S=M[u+C[h+C[d]]],A=M[u+r+C[h+a+C[d+i]]],T=M[u+o+C[h+s+C[d+l]]],R=M[u+1+C[h+1+C[d+1]]],N=.6-f*f-v*v-p*p,P=.6-y*y-g*g-w*w,D=.6-b*b-k*k-E*E,F=.6-O*O-x*x-j*j;return 32*((N<0?0:(N*=N)*N*S.dot3(f,v,p))+(P<0?0:(P*=P)*P*A.dot3(y,g,w))+(D<0?0:(D*=D)*D*T.dot3(b,k,E))+(F<0?0:(F*=F)*F*R.dot3(O,x,j)))}},{key:"octaveSimplex3",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.octaveNum,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.octaveFalloff,i=0,o=e,s=t,l=n,c=1,u=0;u<r;u++)i+=this.simplex3(o,s,l)*c,o*=2,s*=2,l*=2,c*=a;return i}},{key:"fade",value:function(e){return e*e*e*(e*(6*e-15)+10)}},{key:"lerp",value:function(e,t,n){return(1-n)*e+n*t}},{key:"perlin2",value:function(e,t){var n=Math.floor(e),r=Math.floor(t);e-=n,t-=r,n&=255,r&=255;var a=this.gradP,i=this.perm,o=a[n+i[r]].dot2(e,t),s=a[n+i[r+1]].dot2(e,t-1),l=a[n+1+i[r]].dot2(e-1,t),c=a[n+1+i[r+1]].dot2(e-1,t-1),u=this.fade(e);return this.lerp(this.lerp(o,l,u),this.lerp(s,c,u),this.fade(t))}},{key:"perlin3",value:function(e,t,n){var r=this.gradP,a=this.perm,i=Math.floor(e),o=Math.floor(t),s=Math.floor(n);e-=i,t-=o,n-=s;var l=r[(i&=255)+a[(o&=255)+a[s&=255]]].dot3(e,t,n),c=r[i+a[o+a[s+1]]].dot3(e,t,n-1),u=r[i+a[o+1+a[s]]].dot3(e,t-1,n),h=r[i+a[o+1+a[s+1]]].dot3(e,t-1,n-1),d=r[i+1+a[o+a[s]]].dot3(e-1,t,n),m=r[i+1+a[o+a[s+1]]].dot3(e-1,t,n-1),f=r[i+1+a[o+1+a[s]]].dot3(e-1,t-1,n),v=r[i+1+a[o+1+a[s+1]]].dot3(e-1,t-1,n-1),p=this.fade(e),y=this.fade(t),g=this.fade(n);return this.lerp(this.lerp(this.lerp(l,d,p),this.lerp(c,m,p),g),this.lerp(this.lerp(u,f,p),this.lerp(h,v,p),g),y)}}]),e}(),re={nw:new w.Vector2(-1,-1),w:new w.Vector2(-1,0),sw:new w.Vector2(-1,1),n:new w.Vector2(0,-1),s:new w.Vector2(0,1),ne:new w.Vector2(1,-1),e:new w.Vector2(1,0),se:new w.Vector2(1,1)},ae=Object.keys(re).map(function(e){return re[e]});var ie=function(e){return e.substr(0,1).toLocaleUpperCase()+e.substr(1)};var oe=Object.keys({carryCapacity:0,energyEfficiency:0,photosynthesis:0,rootAbsorption:0,structuralStability:0,activeTransportSugar:0,activeTransportWater:0,walkSpeed:0,diffuseWater:0,diffuseSugar:0,buildTime:0});function se(e){for(var t=e.split(/([A-Z])+/g),n=ie(t[0]),r=1;r<t.length;r+=2)n+=" "+t[r]+t[r+1];return n}function le(e,t){for(var n in t)e[n]=(r=(e[n]||0)+t[n])<-3?-3:r>3?3:r;var r}function ce(e){var t={carryCapacity:0,energyEfficiency:0,photosynthesis:0,rootAbsorption:0,structuralStability:0,activeTransportSugar:0,activeTransportWater:0,walkSpeed:0,diffuseWater:0,diffuseSugar:0,buildTime:0},n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){le(t,ue(i.value))}}catch(s){r=!0,a=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}function ue(e){var t={},n=he(e[0]);null!=n&&(t[n]=1);var r=he(e[1]);return null!=r&&(t[r]=-1),t}function he(e){switch(e){case"AA":return"walkSpeed";case"AC":return"energyEfficiency";case"AG":return"photosynthesis";case"AT":return"rootAbsorption";case"CA":return"carryCapacity";case"CC":return"activeTransportSugar";case"CG":return"activeTransportWater";case"CT":return"structuralStability";case"GA":return"diffuseSugar";case"GC":return"diffuseWater";case"GG":return"buildTime";case"GT":case"TA":case"TC":case"TG":case"TT":default:return}}function de(e,t,n){return t*Math.pow(n,e)}function me(e){return"number"===typeof e.energy}var fe=function(){function e(t,n){if(Object(c.a)(this,e),this.world=n,this.isObstacle=!1,this.darkness=1/0,this.temperature=50,this.nextTemperature=void 0,this.timeMade=void 0,this.pos=void 0,this.pos=t.clone(),null==n)throw new Error("null world!");this.timeMade=n.time}return Object(u.a)(e,[{key:"diffusionWater",get:function(){return this.constructor.diffusionWater}},{key:"diffusionSugar",get:function(){return this.constructor.diffusionSugar}},{key:"fallAmount",get:function(){return this.constructor.fallAmount}}]),Object(u.a)(e,[{key:"lightAmount",value:function(){return Math.sqrt(Math.min(Math.max(B(1-this.darkness,0,1,0,1),0),1))}},{key:"step",value:function(){if(this.world.time%3===0){var e=this.world.tileNeighbors(this.pos);this.stepDarkness(e),this.stepDiffusion(e),this.stepGravity()}}},{key:"stepDarkness",value:function(e){if(this instanceof Ee)this.darkness=0;else{var t=this.darkness,n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,l=Object(X.a)(s,2)[1],c=Math.max(.2,B(this.pos.y,this.world.height/2,this.world.height,q.soilDarknessBase,1)),u=l instanceof we?1/0:l.darkness+c;t=l instanceof Ee?0:Math.min(t,u)}}catch(d){r=!0,a=d}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}this.darkness=t;var h=null!=this.world.cellAt(this.pos.x,this.pos.y);h&&console.error("stepping environmental tile even when a cell is on-top:",h)}}},{key:"stepDiffusion",value:function(e){if(z(this)){var t=!0,n=!1,r=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,s=Object(X.a)(o,2),l=s[0],c=s[1];this.canDiffuse(l,c)&&(null!=this.diffusionWater&&c.inventory.water>this.inventory.water&&this.diffuseWater(c),null!=this.diffusionSugar&&c.inventory.sugar>this.inventory.sugar&&this.diffuseSugar(c))}}catch(u){n=!0,r=u}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}}},{key:"stepTemperature",value:function(e){var t=0,n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;t+=Object(X.a)(s,2)[1].temperature}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}t/=e.size,this.nextTemperature=.5*this.temperature+.5*t,"spring"===this.world.season.name&&(this.nextTemperature-=.1)}},{key:"canDiffuse",value:function(e,t){return ve(this,t)}},{key:"diffuseWater",value:function(e){if(z(this))if("continuous"===q.soilDiffusionType){var t=(e.inventory.water-this.inventory.water)*this.diffusionWater;e.inventory.give(this.inventory,t,0)}else{var n=e.inventory.water-this.inventory.water,r=Math.min(n,1);Math.random()<n*this.diffusionWater*r&&e.inventory.give(this.inventory,1,0)}}},{key:"diffuseSugar",value:function(e){if(z(this)){var t=(e.inventory.sugar-this.inventory.sugar)*this.diffusionSugar;e.inventory.give(this.inventory,0,t)}}},{key:"stepGravity",value:function(){var e=this.fallAmount,t=this.world.tileAt(this.pos.x,this.pos.y+1);e>0&&this.world.time%Math.floor(1/e)<1&&z(t)&&ve(t,this)&&this.inventory.give(t.inventory,1,0)}}]),e}();function ve(e,t){return z(e)&&z(t)&&(e instanceof t.constructor||t instanceof e.constructor||e instanceof Ee&&t instanceof Ee||function(e,t,n,r){return e instanceof t&&n instanceof r}(e,ge,t,ye))}fe.displayName="Tile",fe.fallAmount=0;var pe=new ne,ye=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).pos=e,r.sunlightCached=1,r._co2=void 0,r.inventory=new G(20,Object(P.a)(r)),r.darkness=0,r._co2=r.computeCo2(),r}return Object(m.a)(t,e),Object(u.a)(t,[{key:"computeCo2",value:function(){var e=B(this.pos.y,this.world.height/2,0,this.world.environment.floorCo2,1.15),t=B(this.pos.y,this.world.height/2,0,4,9),n=null==this.world?0:this.world.time,r=.25*pe.perlin3(94.231+(this.pos.x-this.world.width/2)/t,2312+this.pos.y/8,n/1e3+93.1);return Math.max(Math.min(e+r,1),Math.min(.4,.75*this.world.environment.floorCo2))}},{key:"lightAmount",value:function(){return this.sunlight()}},{key:"step",value:function(){if(this.world.time%3===0){this.stepGravity();var e=this.world.tileNeighbors(this.pos);this.stepDiffusion(e),this.stepEvaporation(),this._co2=this.computeCo2()}}},{key:"stepEvaporation",value:function(){Math.random()<.01*this.inventory.water&&this.inventory.add(-1,0)}},{key:"canDiffuse",value:function(e,n){return e!==re.s&&e!==re.sw&&e!==re.se&&Object(K.a)(Object(d.a)(t.prototype),"canDiffuse",this).call(this,e,n)}},{key:"co2",value:function(){return this._co2}},{key:"sunlight",value:function(){return this.sunlightCached}}]),t}(fe);ye.displayName="Air",ye.fallAmount=1,ye.diffusionWater=.1;var ge=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e,a))).inventory=new G(q.soilMaxWater,Object(P.a)(n)),n.inventory.add(r,0),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"fallAmount",get:function(){return this.world.environment.waterGravityPerTurn}}]),Object(u.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(K.a)(Object(d.a)(t.prototype),"step",this).call(this),this.stepEvaporation())}},{key:"stepEvaporation",value:function(){var e=this.world.environment,t=e.evaporationRate,n=e.evaporationBottom,r=B(this.pos.y,this.world.height/2,this.world.height*n,1,0),a=this.inventory.water;Math.random()<t*r*a&&this.inventory.add(-1,0)}}]),t}(fe);ge.displayName="Soil",ge.diffusionWater=q.soilDiffusionWater;var we=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).isObstacle=!0,n}return Object(m.a)(t,e),t}(fe);we.displayName="Rock";var be=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),t}(fe);be.displayName="Dead Cell";var ke=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e,r,a))).turnsPerWater=i,n.isObstacle=!0,n.cooldown=0,n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(K.a)(Object(d.a)(t.prototype),"step",this).call(this),this.cooldown>0&&this.cooldown--,this.inventory.space()>1&&this.cooldown<=0&&(this.inventory.add(1,0),this.cooldown=this.turnsPerWater))}}]),t}(ge);ke.displayName="Fountain";var Ee=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).energy=q.cellEnergyMax,n.darkness=0,n.droopY=0,n.args=[],n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){Object(K.a)(Object(d.a)(t.prototype),"step",this).call(this),this.energy-=1;var e=this.world.tileNeighbors(this.pos),n=Array.from(e.values()),r=[].concat(Object(p.a)(n),[this]),a=!0,i=!1,o=void 0;try{for(var s,l=r[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(!this.stepEat(c))break}}catch(b){i=!0,o=b}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}if(this.energy<q.cellEnergyMax){var u=r.filter(function(e){return me(e)}),h=!0,m=!1,f=void 0;try{for(var v,y=u[Symbol.iterator]();!(h=(v=y.next()).done);h=!0){var g=v.value;if(!(this.energy<q.cellEnergyMax))break;var w=0;if(g.energy>this.energy){if(w=Math.floor(.25*(g.energy-this.energy)),g.energy-w<0)throw new Error("cell energy diffusion: taking more energy than available");if(this.energy+w>q.cellEnergyMax)throw new Error("cell energy diffusion: taking more energy than i can carry");this.energy+=w,g.energy-=w}}}catch(b){m=!0,f=b}finally{try{h||null==y.return||y.return()}finally{if(m)throw f}}}this.stepDroop(e),this.droopY>.5&&(this.world.player.pos.equals(this.pos)&&(this.world.player.pos.y+=1),this.world.maybeRemoveCellAt(this.pos),this.pos.y<this.world.height-1&&(this.pos.y+=1),this.droopY-=1,this.world.setTileAt(this.pos,this)),this.energy<=0&&this.world.setTileAt(this.pos,new be(this.pos,this.world))}}},{key:"stepEat",value:function(e){if(z(e)&&!(e instanceof Ce)){if(this.energy<q.cellEnergyMax){var t=q.cellEnergyMax-this.energy,n=de(this.world.traits.energyEfficiency,1/q.cellEnergyMax,1/1.5),r=Math.min(t*n,e.inventory.sugar);if(t>100&&r>0){e.inventory.add(0,-r);var a=r/n;return this.energy+=a,!0}}return!1}}},{key:"stepDroop",value:function(e){var n=e.get(re.s),r=e.get(re.sw),a=e.get(re.se),i=e.get(re.w),o=e.get(re.e),s=e.get(re.n),l=e.get(re.nw),c=e.get(re.ne),u=de(this.world.traits.structuralStability,q.droop,1/1.5);this.droopY+=u,this.energy<q.cellEnergyMax/2&&(this.droopY+=u);for(var h=!1,d=0,m=[n,r,a];d<m.length;d++){var f=m[d];if(f instanceof we||f instanceof ge)return void(this.droopY=Math.min(this.droopY,0));if(f instanceof t)return this.droopY=Math.min(this.droopY,f.droopY),void(h=!0)}var v=[l,s,c,i,o,this].filter(function(e){return e instanceof t});h||1!==v.length?this.droopY=v.reduce(function(e,t){return e+t.droopY},0)/v.length:this.droopY+=1}}]),t}(fe);Ee.displayName="Cell",Ee.diffusionWater=q.cellDiffusionWater,Ee.diffusionSugar=q.cellDiffusionSugar,Ee.turnsToBuild=q.cellGestationTurns;var Oe=function(e){function t(e,n,r){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).completedCell=r,a.isObstacle=!0,a.timeRemaining=void 0,a.timeToBuild=void 0,a.timeRemaining=a.timeToBuild=r.constructor.turnsToBuild||0,a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(K.a)(Object(d.a)(t.prototype),"step",this).call(this),this.timeRemaining--,this.timeRemaining<=0&&this.world.setTileAt(this.completedCell.pos,this.completedCell))}}]),t}(Ee),xe=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).inventory=void 0,r.inventory=new G(Math.floor(de(n.traits.carryCapacity,q.tissueInventoryCapacity,1.5)),Object(P.a)(r)),r}return Object(m.a)(t,e),t}(Ee);xe.displayName="Tissue";var je=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).isObstacle=!1,n.averageEfficiency=0,n.averageSpeed=0,n.didConvert=!1,n.sugarConverted=0,n.tilePairs=[],n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){Object(K.a)(Object(d.a)(t.prototype),"step",this).call(this),this.didConvert=!1;var e=this.world.tileNeighbors(this.pos);this.averageEfficiency=0,this.averageSpeed=0,this.sugarConverted=0;var n=0;this.tilePairs=[];var r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value,c=Object(X.a)(l,2),u=c[0],h=c[1],m=this.world.tileAt(this.pos.x-u.x,this.pos.y-u.y);if(h instanceof ye&&m instanceof xe){n+=1,this.tilePairs.push(u);var f=h,v=m,p=f.sunlight(),y=f.co2();this.averageEfficiency+=y,this.averageSpeed+=p;var g=de(this.world.traits.photosynthesis,.01,1.5),w=q.leafSugarPerReaction/y,b=Math.min(v.inventory.water,w),k=p*g*b/w;if(Math.random()<k){this.didConvert=!0;var E=b*y;v.inventory.add(-b,E),this.sugarConverted+=E}}}}catch(O){a=!0,i=O}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}n>0&&(this.averageEfficiency/=n)}}}]),t}(Ee);je.displayName="Leaf";var Me=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).waterTransferAmount=0,n.isObstacle=!1,n.activeNeighbors=[],n.inventory=new G(q.tissueInventoryCapacity,Object(P.a)(n)),n.cooldown=0,n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){this.world.time%3===0&&(Object(K.a)(Object(d.a)(t.prototype),"step",this).call(this),this.cooldown<=0&&(this.stepWaterTransfer(),this.cooldown+=de(this.world.traits.rootAbsorption,q.rootTurnsPerTransfer,1/1.5)),this.cooldown-=1)}},{key:"stepWaterTransfer",value:function(){this.waterTransferAmount=0,this.activeNeighbors=[];var e=this.world.tileNeighbors(this.pos),t=!0,n=!1,r=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,s=Object(X.a)(o,2),l=s[0],c=s[1];if(c instanceof ge&&(this.activeNeighbors.push(l),0===this.waterTransferAmount)){var u=c.inventory.give(this.inventory,1,0).water;this.waterTransferAmount+=u+1e-4*Math.random()}}}catch(h){n=!0,r=h}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}}]),t}(Ee);Me.displayName="Root";var Ce=function(e){function t(e,n){var r;return Object(c.a)(this,t),(r=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).isObstacle=!0,r.inventory=new G(8,Object(P.a)(r)),r.committedResources=new G(t.neededResources,Object(P.a)(r)),r.timeMatured=void 0,r.handleGetResources=function(){null==r.timeMatured&&r.isMature()&&(r.timeMatured=r.world.time),r.committedResources.off("get",r.handleGetResources)},r.committedResources.on("get",r.handleGetResources),r}return Object(m.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){Object(K.a)(Object(d.a)(t.prototype),"step",this).call(this);var e=this.world.tileNeighbors(this.pos),n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,l=Object(X.a)(s,2)[1];if(z(l)&&l instanceof Ee){var c=t.neededResources/2-this.committedResources.water,u=t.neededResources/2-this.committedResources.sugar;l.inventory.give(this.inventory,c,u)}}}catch(h){r=!0,a=h}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}this.commitResources()}}},{key:"commitResources",value:function(){var e=Math.min(t.neededResources/2-this.committedResources.water,.2),n=Math.min(t.neededResources/2-this.committedResources.sugar,.2);this.inventory.give(this.committedResources,e,n)}},{key:"getPercentMatured",value:function(){var e=this.committedResources;return(e.sugar+e.water)/e.capacity}},{key:"isMature",value:function(){return this.committedResources.water+this.committedResources.sugar>=t.neededResources-1}}]),t}(Ee);function Se(e){return e%1!==0}Ce.displayName="Fruit",Ce.neededResources=100;var Ae=function(e){function t(e,n,r){var a;if(Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).dir=r,a.cooldownWater=0,a.cooldownSugar=0,Se(r.x)||Se(r.y))throw new Error("build transport with fractional dir "+r.x+", "+r.y);return a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"step",value:function(){if(this.world.time%3===0){this.energy-=1,Object(K.a)(Object(d.a)(t.prototype),"step",this).call(this);var e=0,n=0;if(this.cooldownWater<=0){e++;var r=Math.floor(de(this.world.traits.activeTransportWater,20,1/1.5));this.cooldownWater+=r}if(this.cooldownSugar<=0){n++;var a=Math.floor(de(this.world.traits.activeTransportSugar,20,1/1.5));this.cooldownSugar+=a}if(e>0||n>0){var i=this.getTarget();i&&this.inventory.give(i.inventory,e,n);var o=this.getFrom();o&&o.inventory.give(this.inventory,e,n)}this.cooldownWater-=1,this.cooldownSugar-=1}}},{key:"getTarget",value:function(){var e=this.world.tileAt(this.pos.x+this.dir.x,this.pos.y+this.dir.y);if(e instanceof Ee&&z(e))return e}},{key:"getFrom",value:function(){var e=this.world.tileAt(this.pos.x-this.dir.x,this.pos.y-this.dir.y);if(e instanceof Ee&&z(e))return e}}]),t}(xe);Ae.displayName="Transport";var Te=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).inventory=new G(8,Object(P.a)(n)),n}return Object(m.a)(t,e),Object(u.a)(t,null,[{key:"diffusionWater",get:function(){return q.veinDiffusion}},{key:"diffusionSugar",get:function(){return q.veinDiffusion}}]),t}(xe);Te.displayName="Vein";var Re=function(){function e(t,n){Object(c.a)(this,e),this.posFloat=t,this.world=n,this.inventory=new G(q.maxResources,this,Math.round(q.maxResources/3),Math.round(q.maxResources/3)),this.action=void 0,this.events=new I.EventEmitter,this.mapActions=void 0,this.speed=void 0,this.speed=de(n.traits.walkSpeed,.15,1.5)}return Object(u.a)(e,[{key:"pos",get:function(){return this.posFloat.clone().round()}}]),Object(u.a)(e,[{key:"setAction",value:function(e){null!=this.action?this.action={type:"multiple",actions:[this.action,e]}:this.action=e}},{key:"getAction",value:function(){return this.action}},{key:"droopY",value:function(){var e=this.world.tileAt(this.pos.x,this.pos.y);return e instanceof Ee?e.droopY:0}},{key:"droopPosFloat",value:function(){var e=this.droopY();if(0!==e){var t=this.posFloat.clone();return t.y+=e,t}return this.posFloat}},{key:"currentTile",value:function(){return this.world.tileAt(this.pos)}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"step",value:function(){if(void 0===this.action&&(this.action={type:"none"}),this.mapActions){var e=this.mapActions(this,this.action);this.action=null!=e?e:{type:"none"}}var t=this.attemptAction(this.action);this.maybeMoveWithTransports(),t&&this.events.emit("action",this.action),this.action=void 0}},{key:"maybeMoveWithTransports",value:function(){var e=this.currentTile();e instanceof Ae&&this.posFloat.add(e.dir.clone().setLength(.15*this.speed))}},{key:"attemptAction",value:function(e){switch(e.type){case"none":return!0;case"still":return this.attemptStill();case"move":return this.attemptMove(e);case"build":return this.attemptBuild(e);case"deconstruct":return this.attemptDeconstruct(e);case"drop":return this.attemptDrop(e);case"pickup":return this.attemptPickup(e);case"multiple":return this.attemptMultiple(e)}}},{key:"verifyMove",value:function(e){var t=this.posFloat.clone().add(e.dir.clone().setLength(this.speed)).round();return this.isWalkable(t)}},{key:"isWalkable",value:function(e){if(e instanceof fe&&(e=e.pos),!this.world.isValidPosition(e.x,e.y))return!1;var t=this.world.tileAt(e.x,e.y);return t instanceof Ee&&null!=t&&!t.isObstacle}},{key:"isBuildCandidate",value:function(e){return null!=e&&!e.isObstacle}},{key:"attemptMove",value:function(e){return!!this.verifyMove(e)&&(j.audio.currentTime=.05*Math.random(),j.gain.gain.cancelScheduledValues(0),j.gain.gain.value=1,j.gain.gain.linearRampToValueAtTime(0,j.gain.context.currentTime+.05),this.posFloat.add(e.dir.clone().setLength(this.speed)),!0)}},{key:"attemptStill",value:function(){return!0}},{key:"tryConstructingNewCell",value:function(e,t,n){e=e.clone();var r=this.world.tileAt(e.x,e.y);if(null!=r&&!(r instanceof Ce)){if(!(r instanceof t&&!(t===Ae&&r instanceof Ae))&&!r.isObstacle&&this.inventory.water>=1&&this.inventory.sugar>=1){this.inventory.add(-1,-1);var a=Object(v.a)(t,[e,this.world].concat(Object(p.a)(n)));return a.args=n,M.audio.currentTime=0,M.gain.gain.cancelScheduledValues(0),M.gain.gain.value=.2,M.gain.gain.exponentialRampToValueAtTime(1e-4,M.gain.context.currentTime+.5),a}}}},{key:"argsEq",value:function(e,t){var n=this;return typeof e===typeof t&&(null==e&&null==t||(e instanceof w.Vector2&&t instanceof w.Vector2?e.equals(t):e instanceof Array&&t instanceof Array?e.every(function(r,a){return n.argsEq(e[a],t[a])}):void 0))}},{key:"isMeaningfulBuild",value:function(e,t){return t.constructor!==e.cellType||!this.argsEq(e.args,t.args)}},{key:"attemptBuild",value:function(e){var t=this.world.cellAt(e.position.x,e.position.y);if(null!=t&&!this.isMeaningfulBuild(e,t))return!0;t&&this.attemptDeconstruct({type:"deconstruct",position:e.position,force:!0});var n,r=this.tryConstructingNewCell(e.position,e.cellType,e.args);return null!=r&&((n=e.cellType.turnsToBuild?new Oe(e.position,this.world,r):r).droopY=this.droopY(),this.world.setTileAt(e.position,n),!0)}},{key:"attemptDeconstruct",value:function(e){if(!e.position.equals(this.pos)||e.force){var t=this.world.maybeRemoveCellAt(e.position);if(null!=t){var n=t.energy/q.cellEnergyMax;return this.inventory.add(n,n),z(t)&&t.inventory.give(this.inventory,t.inventory.water,t.inventory.sugar),!0}}return!1}},{key:"attemptDrop",value:function(e){var t=this.currentTile();if(z(t)){var n=e.water,r=e.sugar;return t.inventory.give(this.inventory,r,n),this.inventory.give(t.inventory,n,r),!0}return!1}},{key:"attemptPickup",value:function(e){var t=this.currentTile();z(t)&&t.inventory.give(this.inventory,e.water,e.sugar);return!0}},{key:"attemptMultiple",value:function(e){var t=!0,n=!0,r=!1,a=void 0;try{for(var i,o=e.actions[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;t=this.attemptAction(s)&&t}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}}]),e}(),Ne=n(23),Pe=n(16),De=n.n(Pe);var Fe=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(c.a)(this,e),this.deleted=t,this.added=n},Be=["spring","summer","fall","winter"],Le=10800,We=Le/4,Ie=function(){function e(t,n){var r=this;Object(c.a)(this,e),this.environment=t,this.time=0,this.width=50,this.height=100,this.player=void 0,this.gridEnvironment=void 0,this.gridCells=void 0,this.neighborCache=void 0,this.wipResult=void 0,this.species=void 0,this.traits=void 0,this.cachedEntities=void 0,this.stepStats=new Fe,this.wipResult={fruits:[],world:this},this.species=n,this.traits=ce(this.species.genes),Ee.diffusionWater=de(this.traits.diffuseWater,q.cellDiffusionWater,2),Ee.diffusionSugar=de(this.traits.diffuseSugar,q.cellDiffusionSugar,2),Ee.turnsToBuild=Math.floor(de(this.traits.buildTime,q.cellGestationTurns,.5)),this.player=new Re(new w.Vector2(this.width/2,this.height/2),this),this.gridEnvironment=new Array(this.width).fill(void 0).map(function(e,n){return new Array(r.height).fill(void 0).map(function(e,a){var i,o=new w.Vector2(n,a),s=!0,l=!1,c=void 0;try{for(var u,h=t.fill[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=(0,u.value)(o,r);if(null!=d){i=d;break}}}catch(m){l=!0,c=m}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return null==i&&(i=new ye(o,r)),i})});var a=this.player.pos.x,i=this.gridEnvironment[a].find(function(e){return!(e instanceof ye)});i&&(this.player.posFloat.y=i.pos.y);this.gridCells=new Array(this.width).fill(void 0).map(function(e,t){return new Array(r.height).fill(void 0).map(function(e,n){var a=new w.Vector2(t,n);return r.player.pos.distanceTo(a)<2.5?(r.gridEnvironment instanceof we&&(r.gridEnvironment[t][n]=new ge(new w.Vector2(t,n),0,r)),new xe(a,r)):null})}),this.neighborCache=new Array(this.width).fill(void 0).map(function(e,t){return new Array(r.height).fill(void 0).map(function(e,n){return r.computeTileNeighbors(t,n)})}),this.fillCachedEntities()}return Object(u.a)(e,[{key:"season",get:function(){return{name:Be[Math.floor(this.time/We)],percent:this.time%We/We}}}]),Object(u.a)(e,[{key:"tileAt",value:function(e,t){var n;if(e instanceof w.Vector2?(n=e.x,t=e.y):(n=e,t=t),!this.isValidPosition(n,t))return null;var r=this.gridCells[n][t];return null!=r?r:this.gridEnvironment[n][t]}},{key:"cellAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridCells[e][t]:null}},{key:"environmentTileAt",value:function(e,t){return this.isValidPosition(e,t)?this.gridEnvironment[e][t]:null}},{key:"setTileAt",value:function(e,t){var n=e.x,r=e.y;if(!this.isValidPosition(n,r))throw new Error("invalid position ".concat(n,", ").concat(r," "));t instanceof Ce&&this.wipResult.fruits.push(t);var a=this.tileAt(n,r);z(a)&&(z(t)&&a.inventory.give(t.inventory,a.inventory.water,a.inventory.sugar),0===a.inventory.water&&0===a.inventory.sugar||(console.warn("lost",a.inventory,"resources to building"),a.inventory.add(-a.inventory.water,-a.inventory.sugar)));var i=this.gridCells[n][r];if(null!=i&&this.stepStats.deleted.push(i),t instanceof Ee)this.gridCells[n][r]=t;else{this.gridCells[n][r]=null;var o=this.gridEnvironment[n][r];null!=o&&this.stepStats.deleted.push(o),this.gridEnvironment[n][r]=t}this.stepStats.added.push(t),this.handleTileUpdated(e)}},{key:"maybeRemoveCellAt",value:function(e){var t=this.cellAt(e.x,e.y);return t&&(this.gridCells[e.x][e.y]=null,this.stepStats.deleted.push(t)),this.handleTileUpdated(e),t}},{key:"isValidPosition",value:function(e,t){return!(e>=this.width||e<0||t>=this.height||t<0)}},{key:"tileNeighbors",value:function(e){return this.neighborCache[e.x][e.y]}},{key:"computeTileNeighbors",value:function(e,t){var n=this,r=new Map;return Ge[this.time%Ge.length].forEach(function(a){var i=e+a.x,o=t+a.y,s=n.tileAt(i,o);null!=s&&r.set(a,s)}),r}},{key:"entities",value:function(){if(null==this.cachedEntities)throw new Error("accessed entities before filling");return this.cachedEntities}},{key:"handleTileUpdated",value:function(e){this.neighborCache[e.x][e.y]=this.computeTileNeighbors(e.x,e.y);var t=!0,n=!1,r=void 0;try{for(var a,i=ae[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,s=e.x+o.x,l=e.y+o.y;this.isValidPosition(s,l)&&(this.neighborCache[s][l]=this.computeTileNeighbors(s,l))}}catch(c){n=!0,r=c}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}this.fillCachedEntities()}},{key:"fillCachedEntities",value:function(){var e=[],t=0,n=0;for(t=0;t<this.width;t++)for(n=(t+this.time)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));for(t=0;t<this.width;t++)for(n=(t+this.time+1)%2;n<this.height;n+=2)e.push(this.tileAt(t,n));this.time%4<2&&e.reverse(),e.push(this.player),this.cachedEntities=e}},{key:"step",value:function(){var e=this.entities();return this.stepStats=new Fe,e.forEach(function(e){"function"===typeof e.step&&e.step()}),this.computeSunlight(),this.stepWeather(),this.time++,this.fillCachedEntities(),this.stepStats}},{key:"getLastStepStats",value:function(){return this.stepStats}},{key:"stepWeather",value:function(){if((this.time+this.environment.climate.turnsBetweenRainfall-200)%this.environment.climate.turnsBetweenRainfall<this.environment.climate.rainDuration){var e=w.Math.randInt(0,this.width-1),t=this.tileAt(e,0);t instanceof ye&&t.inventory.add(this.environment.climate.waterPerDroplet,0)}}},{key:"computeSunlight",value:function(){for(var e=this.time*Math.PI*2/1e3,t=Math.sin(e+Math.PI/2),n=Math.atan(12*Math.sin(e))/(Math.PI/2)*.5+.5,r=0;r<=.6*this.height;r++)for(var a=0;a<this.width;a++){var i=this.environmentTileAt(a,r);if(i instanceof ye){var o=0;if(0===r)o=1;else{var s=this.tileAt(a,r-1),l=this.tileAt(a+1,r-1),c=this.tileAt(a-1,r-1),u=s instanceof ye?s.sunlightCached/n:null==s?1:0,h=l instanceof ye?l.sunlightCached/n:null==l?1:0,d=c instanceof ye?c.sunlightCached/n:null==c?1:0;o=(o=t>0?h*t+u*(1-t):d*-t+u*(1- -t))*(1-q.sunlightDiffusion)+(u+h+d)/3*q.sunlightDiffusion}o=q.sunlightReintroduction+o*(1-q.sunlightReintroduction),o*=n,i.sunlightCached=o}}}},{key:"computeTemperature",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.entities()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;i instanceof fe&&null!=i.nextTemperature&&(i.temperature=i.nextTemperature)}}catch(o){t=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"maybeGetGameResult",value:function(){return this.tileAt(this.player.pos.x,this.player.pos.y)instanceof be?Object(Y.a)({},this.wipResult,{status:"lost"}):this.time<Le?null:0===this.wipResult.fruits.filter(function(e){return e.isMature()}).length?Object(Y.a)({},this.wipResult,{status:"lost"}):Object(Y.a)({},this.wipResult,{status:"won"})}},{key:"checkResources",value:function(){this.entities().forEach(function(e){z(e)&&(e.inventory.sugar,e.inventory.water),me(e)&&e.energy})}},{key:"environmentTiles",value:function(){var e=this;return Object(Ne.a)({},Symbol.iterator,De.a.mark(function t(){var n,r,a,i,o,s,l,c,u,h,d,m;return De.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,r=!1,a=void 0,t.prev=3,i=e.gridEnvironment[Symbol.iterator]();case 5:if(n=(o=i.next()).done){t.next=36;break}s=o.value,l=!0,c=!1,u=void 0,t.prev=10,h=s[Symbol.iterator]();case 12:if(l=(d=h.next()).done){t.next=19;break}return m=d.value,t.next=16,m;case 16:l=!0,t.next=12;break;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(10),c=!0,u=t.t0;case 25:t.prev=25,t.prev=26,l||null==h.return||h.return();case 28:if(t.prev=28,!c){t.next=31;break}throw u;case 31:return t.finish(28);case 32:return t.finish(25);case 33:n=!0,t.next=5;break;case 36:t.next=42;break;case 38:t.prev=38,t.t1=t.catch(3),r=!0,a=t.t1;case 42:t.prev=42,t.prev=43,n||null==i.return||i.return();case 45:if(t.prev=45,!r){t.next=48;break}throw a;case 48:return t.finish(45);case 49:return t.finish(42);case 50:case"end":return t.stop()}},t,null,[[3,38,42,50],[10,21,25,33],[26,,28,32],[43,,45,49]])}))}}]),e}();function Ve(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[n],e[n]=t;return e}var Ge=[Ve(ae.slice()),Ve(ae.slice()),Ve(ae.slice()),Ve(ae.slice()),Ve(ae.slice())],ze={q:{type:"drop",sugar:0,water:1},e:{type:"drop",sugar:1,water:0}," ":{type:"pickup",sugar:1,water:1}},Ye={w:{type:"move",dir:re.n},a:{type:"move",dir:re.w},s:{type:"move",dir:re.s},d:{type:"move",dir:re.e}},Ue=(Object.keys(Ye).map(function(e){return Ye[e]}),function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.createElement("div",{className:"mito-instructions"},r.createElement("div",{className:"mito-instructions-container"},r.createElement("div",{className:"esc",onClick:function(){return e.props.play()}},"Back (Esc)"),r.createElement("h1",null,"Mito"),r.createElement("div",{className:"play-button",onClick:function(){return e.props.play()}},"Play"),r.createElement("p",null,r.createElement("ol",null,r.createElement("li",null,"Build Tissue to expand your reach (press t and walk into empty space)."),r.createElement("li",null,"Build Roots (press r) underground to suck up adjacent water."),r.createElement("li",null,"Build Leaves (press l) above ground and drop water (press 1) to convert water into sugar."),r.createElement("li",null,r.createElement("b",null,"Win the game by building and loading the Fruit with 1000 sugar.")),r.createElement("li",null,"Click around to see the different properties of each tile."),r.createElement("li",null,"Build leaves early."),r.createElement("li",null,"Leaves higher up have better water/sugar ratios, determined by the co2 percentage in the air."),r.createElement("li",null,"Explore underground for water reservoires and Fountains."),r.createElement("li",null,"Build transports (capital T) to carry water back up the plant."),r.createElement("li",null,"You can scroll out infinitely far."))),r.createElement("h3",null,"You"),r.createElement("p",null,"You can carry max ",q.maxResources," resources, and you automatically suck in any resources you're standing over. You can only walk on Tissue (and Transport). You start at the center of the map, with soil below and air above."),r.createElement("h3",null,"Soil and Underground"),r.createElement("p",null,"Underground, Soil holds water, rocks block your way, and occasionally Fountains (at the very bottom) are a permanent source of water. Soil holds up to ",q.soilMaxWater," water at a time. Fountains emit one water per ",q.fountainTurnsPerWater," turns."),r.createElement("h3",null,"Air and Aboveground"),r.createElement("p",null,"Aboveground, Air provides both sunlight and co2. Sunlight determines the ratio of waters-per-sugar at which reactions happen and are affected by shadows. Co2 determines the speed of reaction and gets better as you build higher up. Orange is low co2, blue is high co2. Gravity will pull down on your structures, so make sure they're structurally sound. Your structures cast shadows on the leaves below in relation to the sun, which gently sways left to right."),r.createElement("h3",null,"Water"),r.createElement("p",null,"Water is one of the main two resources. Water slowly diffuses from high to low densities (difference 2 required) at about 1 unit per ",(1/q.soilDiffusionWater).toFixed(0)," turns. Obtain water in the ground through Roots. Leaves require water to photosynthesize. You require water to build."),r.createElement("h3",null,"Sugar"),r.createElement("p",null,"Sugar is the other main resource. Sugar does not diffuse. Leaves convert water into sugar. Obtain sugar by putting water next to leaves. Cells require sugar to survive. You require sugar to build."),r.createElement("h3",null,"Building"),r.createElement("p",null,'Build Tissue, Leaves, Roots, and The Fruit by toggling "build mode" on and walking into Air or Soil. Build Transport over existing tissue by walking around. Building costs 1 sugar and 1 water. You can build Tissue over Leaves and Roots - be careful! When you build above ground, Cells will Droop if they\'re not properly supported underneath them.'),r.createElement("h3",null,"Cells"),r.createElement("p",null,"All cells require energy upkeep and will automatically eat sugar on their tile, or get energy from their neighbors. Each cell consumes 1 sugar every ",q.cellEnergyMax," turns."),r.createElement("h3",null,"Tissue"),r.createElement("p",null,"Tissue connects your plant together, you may only walk on Tissue. Each Tissue carries up to"," ",q.tissueInventoryCapacity," resources."),r.createElement("h3",null,"Roots"),r.createElement("p",null,"Roots are the only way to get water. Each turn Roots transport one water per neighboring soil into the Tissue in the opposite direction (so the Tissue North of the root get water in the South tile). This is called a Pairing."),r.createElement("h3",null,"Leaves"),r.createElement("p",null,"When exposed to Air, Leaves convert water to sugar. Leaves also use Pairings between opposite direction Air/Tissue with water. In perfect co2, leave produce on average 1 sugar per"," ",(1/q.leafReactionRate).toFixed(0)," turns per pair. Leaf efficiency is heavily influenced by co2 and sunlight of its neighboring Air. If your leaf is in too much shadow, it will not be able to photosynthesize. Leaves higher up produce sugar faster."),r.createElement("h3",null,"Transport"),r.createElement("p",null,"Transports move 1 water from its own Tile in the direction it was laid per turn, as well as moving you. Transport hungers at double speed."),r.createElement("h3",null,"The Fruit"),r.createElement("p",null,"You can only build one Fruit, and it is the goal of the game to fill it up with resources. Fruit has up to 1000 sugar storage and aggressively pulls in every available sugar in its surrounding vicinity."),this.renderCredit()))}},{key:"renderCredit",value:function(){return r.createElement(r.Fragment,null,r.createElement("h2",null,"Attribution"),r.createElement("p",null,"Tiles:"," ",r.createElement("a",{href:"http://kenney.nl/assets?s=roguelike",target:"_blank",rel:"noopener noreferrer"},"Kenney.nl Roguelike Assets")),r.createElement("p",null,"Pop sound when leaves convert:"," ",r.createElement("a",{href:"http://soundbible.com/2067-Blop.html",target:"_blank",rel:"noopener noreferrer"},"Blop by Mark DiAngelo")," ","(",r.createElement("a",{href:"https://creativecommons.org/licenses/by/3.0/us/"},"CC BY 3.0 US"),")"),r.createElement("p",null,"Perlin noise:"," ",r.createElement("a",{href:"https://github.com/josephg/noisejs",target:"_blank",rel:"noopener noreferrer"},"josephg/noisejs")),r.createElement("p",null,"Part of 7drl 2018:"," ",r.createElement("a",{href:"http://7drl.org/",target:"_blank",rel:"noopener noreferrer"},"http://7drl.org/")),r.createElement("p",null,"Fruit icon:"," ",r.createElement("a",{href:"https://www.freepik.com/free-vector/fruits-set-pixel-icons_1001072.htm"},"Designed by Freepik")))}}]),t}(r.PureComponent)),qe=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).handlePlay=function(){n.props.mito.instructionsOpen=!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.props.mito.instructionsOpen?r.createElement(Ue,{play:this.handlePlay}):null}}]),t}(r.PureComponent),He=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.tile;return e?r.createElement("div",{className:"tile-hover"},this.tileInfo(e),this.inventoryInfo(e),this.cellInfo(e),this.growingCellInfo(e),this.rootInfo(e),this.leafInfo(e),this.airInfo(e),this.fountainInfo(e)):null}},{key:"rootInfo",value:function(e){return e instanceof Me?r.createElement("div",{className:"info-root"},r.createElement("div",null,e.cooldown," turns until next water suck"),r.createElement("div",null,e.waterTransferAmount.toFixed(0)," water transfer per round")):null}},{key:"leafInfo",value:function(e){return e instanceof je?r.createElement("div",{className:"info-leaf"},r.createElement("div",null,(1/(e.averageSpeed*q.leafReactionRate)).toFixed(0)," turns per reaction"),r.createElement("div",null,(1/e.averageEfficiency).toFixed(2)," water per sugar")):null}},{key:"airInfo",value:function(e){if(e instanceof ye)return r.createElement("div",{className:"info-air"},r.createElement("div",null,"\u2600\ufe0f ",(100*e.sunlight()).toFixed(0),"%"),r.createElement("div",null,"\u2601\ufe0f ",(100*e.co2()).toFixed(0),"%"))}},{key:"fountainInfo",value:function(e){if(e instanceof ke)return r.createElement("div",{className:"info-fountain"},r.createElement("div",null,e.turnsPerWater," turns per water"))}},{key:"tileInfo",value:function(e){var t=me(e)?r.createElement("span",{className:"info-energy"},"\ud83d\udc9a",(e.energy/q.cellEnergyMax*100).toFixed(0),"%"):null;return r.createElement("div",{className:"info-tile"},r.createElement("div",{className:"info-tile-name"},e.constructor.displayName),r.createElement("div",{className:"info-tile-temperature"},e.temperature.toFixed(2)),t)}},{key:"inventoryInfo",value:function(e){if(z(e)){var t=e.inventory.water>0?r.createElement("div",{className:"info-inventory-item"},"\ud83d\udca7 ",e.inventory.water.toFixed(2)):null,n=e.inventory.sugar>0?r.createElement("div",{className:"info-inventory-item"},"Sugar ",e.inventory.sugar.toFixed(2)):null;return r.createElement("div",{className:"info-inventory"},t,n)}}},{key:"cellInfo",value:function(e){if(e instanceof Ee&&200*e.droopY>1)return r.createElement("div",{className:"info-cell"},(200*e.droopY).toFixed(0),"% droop")}},{key:"growingCellInfo",value:function(e){if(e instanceof Oe)return r.createElement("div",{className:"info-growing-cell"},(100-e.timeRemaining/e.timeToBuild*100).toFixed(0),"% mature")}}]),t}(r.Component);function _e(e){var t;return function(){return void 0===t&&(t=e()),t}}var Ke=16,Xe=!1,Je=_e(function(){return(new w.TextureLoader).load("assets/images/roguelikeSheet_transparent.png",function(){Je().dispatchEvent({type:"update"}),Xe=!0})}),Ze=(new w.TextureLoader).load("assets/images/fruit.png"),$e={};function Qe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";e=Math.floor(e),t=Math.floor(t);var r="".concat(e,",").concat(t);if(null==$e[r]){var a=function(){var r=Je().image,a=i.getContext("2d");a.fillStyle=n,a.fillRect(0,0,Ke,16),a.drawImage(r,Ke*e,Ke*t,Ke,Ke,0,0,Ke,Ke),o.needsUpdate=!0},i=document.createElement("canvas");i.width=Ke,i.height=Ke;var o=new w.Texture(i);o.magFilter=w.NearestFilter,o.flipY=!0,o.wrapS=w.RepeatWrapping,o.wrapT=w.RepeatWrapping,Xe?a():Je().addEventListener("update",function(){a()}),$e[r]=o}return $e[r]}var et=function e(t,n,r){Object(c.a)(this,e),this.target=t,this.scene=n,this.mito=r},tt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this))).geometry=void 0,n.material=void 0,n.index=0,n.geometry=t.newGeometry(),n.material=new nt(e),n.frustumCulled=!1,n}return Object(m.a)(t,e),Object(u.a)(t,null,[{key:"newGeometry",value:function(){var e=new w.BufferGeometry,n=new Float32Array(3*t.BUFFER_SIZE),r=new Float32Array(t.BUFFER_SIZE);return e.addAttribute("position",new w.BufferAttribute(n,3).setDynamic(!0)),e.addAttribute("size",new w.BufferAttribute(r,1).setDynamic(!0)),e}}]),Object(u.a)(t,[{key:"startFrame",value:function(){this.index=0}},{key:"commit",value:function(e,t,n,r){this.geometry.attributes.position.setXYZ(this.index,e,t,n),this.geometry.attributes.size.setX(this.index,r),this.index++}},{key:"endFrame",value:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0,this.geometry.setDrawRange(0,this.index)}}]),t}(w.Points);tt.BUFFER_SIZE=1e5;var nt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,{uniforms:{opacity:{value:e.opacity},sizeGlobal:{value:e.size},color:{value:e.color},map:{value:e.map}},vertexShader:rt,fragmentShader:at,depthTest:!1,transparent:!0}))).params=e,n.map=void 0,n.map=e.map,n}return Object(m.a)(t,e),t}(w.ShaderMaterial),rt="\nattribute float size;\nuniform float sizeGlobal;\n\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_PointSize = size * sizeGlobal * -projectionMatrix[1].y;\n    gl_Position = projectionMatrix * mvPosition;\n}\n",at="\nuniform vec3 color;\nuniform sampler2D texture;\nuniform float opacity;\n\n#ifdef USE_MAP\n  uniform mat3 uvTransform;\n  uniform sampler2D map;\n#endif\n\nvoid main() {\n    gl_FragColor = vec4( color, opacity );\n\n    #ifdef USE_MAP\n        vec4 mapTexel = texture2D( map, gl_PointCoord );\n        gl_FragColor *= mapTexelToLinear( mapTexel );\n    #endif\n}\n",it=function(e){function t(e,n,r){var a;Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).animationOffset=0,a.waters=[],a.sugars=[],a.handleGetResources=function(e){for(var t=Math.ceil(a.target.water);a.waters.length<t;){var n=e.carrier.pos.clone().sub(a.target.carrier.pos);n.x+=.1*(Math.random()-.5),n.y+=.1*(Math.random()-.5),a.waters.push(n)}for(t=Math.ceil(a.target.sugar);a.sugars.length<t;){var r=e.carrier.pos.clone().sub(a.target.carrier.pos);r.x+=.1*(Math.random()-.5),r.y+=.1*(Math.random()-.5),a.sugars.push(r)}},a.handleGiveResources=function(){var e=Math.ceil(a.target.water);a.waters.length>e&&a.waters.splice(e,a.waters.length-e),e=Math.ceil(a.target.sugar),a.sugars.length>e&&a.sugars.splice(e,a.sugars.length-e)},e.on("get",a.handleGetResources),e.on("give",a.handleGiveResources);for(var i=0;i<a.target.water;i++)a.waters.push(ot());for(var o=0;o<a.target.sugar;o++)a.sugars.push(ot());return a}return Object(m.a)(t,e),Object(u.a)(t,null,[{key:"startFrame",value:function(){t.WaterParticles().startFrame(),t.SugarParticles().startFrame()}},{key:"endFrame",value:function(){t.WaterParticles().endFrame(),t.SugarParticles().endFrame()}}]),Object(u.a)(t,[{key:"updateNumParticles",value:function(e){}},{key:"commitParticles",value:function(e,t,n){if(n.length>0){for(var r=0;r<n.length-1;r++){var a=n[r];e.commit(a.x+this.target.carrier.pos.x,a.y+this.target.carrier.pos.y,10,1),t-=1}var i=n[n.length-1],o=t;e.commit(i.x+this.target.carrier.pos.x,i.y+this.target.carrier.pos.y,10,B(Math.sqrt(o),0,1,.2,1))}}},{key:"simulateResourcePositions",value:function(){var e=this.waters.concat(this.sugars),t=!0,n=!1,r=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,s=0,l=0,c=performance.now()/3e3+this.animationOffset;s+=.02*Math.cos(c);var u=.1+.1*o.length();s+=-o.x*u,l+=-o.y*u;var h=this.mito.world.player;if(h.pos.equals(this.target.carrier.pos)){var d=h.posFloat.x-h.pos.x,m=h.posFloat.y-h.pos.y,f=o.x-d,v=o.y-m,p=f*f+v*v,y=Math.max(Math.min(B(p,0,1,3,-5),3),0);s+=f*y*.2,l+=v*y*.2}var g=!0,w=!1,b=void 0;try{for(var k,E=e[Symbol.iterator]();!(g=(k=E.next()).done);g=!0){var O=k.value;if(o===O)break;var x=o.x-O.x,j=o.y-O.y,M=x*x+j*j;if(M>0){var C=.003/M;s+=x*C,l+=j*C}}}catch(S){w=!0,b=S}finally{try{g||null==E.return||E.return()}finally{if(w)throw b}}o.x+=s,o.y+=l}}catch(S){n=!0,r=S}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"update",value:function(){this.updateNumParticles(this.target.water),this.updateNumParticles(this.target.sugar),this.simulateResourcePositions(),this.commitParticles(t.WaterParticles(),this.target.water,this.waters),this.commitParticles(t.SugarParticles(),this.target.sugar,this.sugars)}},{key:"destroy",value:function(){}}]),t}(et);function ot(){return new w.Vector2(.01*(Math.random()-.5),.01*(Math.random()-.5))}it.WaterParticles=_e(function(){return new tt({color:new w.Color("rgb(9, 12, 255)"),size:45,opacity:.75})}),it.SugarParticles=_e(function(){return new tt({color:new w.Color("yellow"),size:85,opacity:.9,map:Qe(42,12,"transparent")})});var st=function(e){function t(e){var n,r;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,t.geometry,(r=e.target,ct().get(r.constructor).clone())))).renderer=e,n}return Object(m.a)(t,e),t}(w.Mesh);st.geometry=new w.PlaneBufferGeometry(1,1);var lt=function(e){function t(e,n,r){var i;Object(c.a)(this,t),(i=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).mesh=void 0,i.inventoryRenderer=void 0,i.originalColor=void 0,i.audio=void 0,i.lastAudioValueTracker=0,i.pairsLines=[],i.worldDomElement=void 0,i.growingRenderer=void 0,i.target instanceof Oe?(i.growingRenderer=new t(i.target.completedCell,i.scene,i.mito),i.mesh=i.growingRenderer.mesh,i.mesh.scale.set(.01,.01,1)):i.mesh=new st(Object(P.a)(i)),i.originalColor=i.mesh.material.color.clone(),z(i.target)&&(i.inventoryRenderer=new it(i.target.inventory,i.scene,i.mito),i.inventoryRenderer.animationOffset=(i.target.pos.x+i.target.pos.y)/2),i.scene.add(i.mesh);var o=i.target instanceof Ee?1:0;if(i.mesh.position.set(i.target.pos.x,i.target.pos.y,o),i.target instanceof Ee?i.target.constructor.turnsToBuild||i.mesh.scale.set(.01,.01,1):i.mesh.matrixAutoUpdate=!1,i.mesh.updateMatrix(),(i.target instanceof je||i.target instanceof Me)&&(i.audio=new w.Audio(i.mito.audioListener),i.mesh.add(i.audio)),i.target instanceof Ce){var s=i.target;i.worldDomElement=r.addWorldDOMElement(function(){return i.target.pos},function(){return a.a.createElement("div",{className:"fruit-indicator"},a.a.createElement("div",null,s.committedResources.water.toFixed(1),"/",Ce.neededResources/2," water"),a.a.createElement("div",null,s.committedResources.sugar.toFixed(1),"/",Ce.neededResources/2," sugar"))})}return i}return Object(m.a)(t,e),Object(u.a)(t,[{key:"steps",value:function(e,t){return Math.floor(e/t)*t}},{key:"update",value:function(){var e=this;if(this.target instanceof Oe){var n=1-this.target.timeRemaining/this.target.timeToBuild;F(this.mesh.scale,{x:n,y:n},.5)}else if(this.target instanceof Ce){var r=B(this.target.getPercentMatured(),0,1,.2,1),a=new w.Vector2(r,r);F(this.mesh.scale,a,.1)}else F(this.mesh.scale,t.ONE,.1);var i=this.target.lightAmount(),o=this.mesh.material;if(this.target instanceof ye){var s=Math.max(0,B(this.target.co2(),1/6,1.001,0,ut.length-1)),l=Math.floor(s),c=ut[l];if(this.originalColor=c.clone(),l!==ut.length-1){var u=s-l,h=ut[l+1];this.originalColor.lerp(h,u)}}if(o.color=new w.Color(0).lerp(this.originalColor,B(i,0,1,.2,1)),this.target instanceof Ee&&this.mesh.position.set(this.target.pos.x,this.target.pos.y+this.target.droopY,1),me(this.target)&&o.color.lerp(new w.Color(0),1-this.target.energy/q.cellEnergyMax),this.target.temperature>66?o.color.lerp(t.HOT_COLOR,B(this.target.temperature,66,100,0,1)):this.target.temperature<33&&o.color.lerp(t.COLD_COLOR,B(this.target.temperature,33,0,0,1)),null!=this.inventoryRenderer&&i>0&&this.inventoryRenderer.update(),this.target instanceof je&&null!=this.audio){var d=this.target.didConvert?1:0;if(d!==this.lastAudioValueTracker&&d>0){this.audio.setBuffer(C);var m=this.target.pos.distanceToSquared(this.mito.world.player.pos),f=Math.min(1,1/(1+m/25))*this.target.sugarConverted*this.target.sugarConverted;this.audio.setVolume(f),this.audio.play()}this.lastAudioValueTracker=d}if(this.target instanceof Me&&null!=this.audio){var v=this.target.waterTransferAmount;if(v!==this.lastAudioValueTracker){this.audio.setBuffer(S);var p=this.target.waterTransferAmount/(2+this.target.waterTransferAmount),y=this.target.pos.distanceToSquared(this.mito.world.player.pos),g=Math.min(1,1/(1+y/25))*p;this.audio.setVolume(g),null!=this.audio.source&&this.audio.stop(),this.audio.play()}this.lastAudioValueTracker=v}if(this.target.tilePairs instanceof Array){var b=this.target instanceof je?16763150:new w.Color("rgb(9, 12, 255)").getHex(),k=this.target.tilePairs;k.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=k.map(function(t){var n=2*t.length()-.25,r=new w.Vector3(t.x,t.y,0).normalize(),a=e.makeLine(r,r.clone().multiplyScalar(-n/2),n,b);return e.mesh.add(a),a}))}if(this.hasActiveNeighbors(this.target)){var E=this.target instanceof Me?new w.Color("rgb(9, 12, 255)").getHex():16777215,O=this.target.activeNeighbors;O.length!==this.pairsLines.length&&(this.pairsLines.forEach(function(t){return e.mesh.remove(t)}),this.pairsLines=O.map(function(t){var n=t.length()-.25,r=new w.Vector3(t.x,t.y,0).normalize(),a=e.target instanceof Me?e.makeLine(r,new w.Vector3,n,E):new w.ArrowHelper(r,new w.Vector3(0,0,5),n,E);return e.mesh.add(a),a}))}}},{key:"hasActiveNeighbors",value:function(e){return Array.isArray(e.activeNeighbors)}},{key:"makeLine",value:function(e,n,r,a){var i=new w.Line(t.lineGeometry,new w.LineBasicMaterial({color:a}));if(i.position.copy(n),e.y>.99999)i.quaternion.set(0,0,0,1);else if(e.y<-.99999)i.quaternion.set(1,0,0,0);else{var o=new w.Vector3(e.z,0,-e.x).normalize(),s=Math.acos(e.y);i.quaternion.setFromAxisAngle(o,s)}return i.scale.set(1,Math.max(0,r),1),i.position.z=.1,i.updateMatrix(),i.matrixAutoUpdate=!1,i}},{key:"destroy",value:function(){this.scene.remove(this.mesh),null!=this.worldDomElement&&this.mito.removeWorldDOMElement(this.worldDomElement),null!=this.inventoryRenderer&&this.inventoryRenderer.destroy()}}]),t}(et);lt.ONE=new w.Vector2(1,1),lt.HOT_COLOR=new w.Color("orange"),lt.COLD_COLOR=new w.Color("lightblue"),lt.lineGeometry=function(){var e=new w.BufferGeometry;return e.addAttribute("position",new w.Float32BufferAttribute([0,0,0,0,1,0],3)),e}();var ct=_e(function(){var e=new Map;return e.set(ye,new w.MeshBasicMaterial({side:w.DoubleSide,depthWrite:!1})),e.set(ge,new w.MeshBasicMaterial({map:Qe(8,11),side:w.DoubleSide,color:new w.Color("rgb(112, 89, 44)"),depthWrite:!1})),e.set(ke,new w.MeshBasicMaterial({map:Qe(3.5,2.375),side:w.DoubleSide})),e.set(we,new w.MeshBasicMaterial({map:Qe(26,20),side:w.DoubleSide,color:new w.Color("rgb(63, 77, 84)")})),e.set(be,new w.MeshBasicMaterial({map:Qe(8.5625,23.375),side:w.DoubleSide,color:new w.Color("rgb(128, 128, 128)")})),e.set(xe,new w.MeshBasicMaterial({map:Qe(6,31),side:w.DoubleSide,color:new w.Color(3190309)})),e.set(Ae,e.get(xe)),e.set(je,new w.MeshBasicMaterial({map:Qe(55/16,17.5),side:w.DoubleSide})),e.set(Me,new w.MeshBasicMaterial({map:Qe(59/16,327/16),side:w.DoubleSide})),e.set(Ce,new w.MeshBasicMaterial({map:Ze,side:w.DoubleSide,transparent:!0})),e.set(Te,new w.MeshBasicMaterial({map:Qe(Math.floor(11.5),Math.floor(9.5)),side:w.DoubleSide})),e});var ut=[new w.Color("hsl(67, 31%, 25%)"),new w.Color("hsl(180, 31%, 76%)"),new w.Color("hsl(213, 63%, 58%)")];n(69);function ht(e){var t=e.type,n=e.isSelected,a=e.onClick,i=e.spritesheetLoaded,o=r.useMemo(function(){var e=ct().get(t),n=e.map.image,r=e.color.getStyle(),a=null!=n?n instanceof HTMLCanvasElement&&i?n.toDataURL():n instanceof Image?n.src:"":"";return{backgroundImage:"url(".concat(a,"), linear-gradient(").concat(r,", ").concat(r,")")}},[i,t]);return r.createElement("div",{className:g()("cell-bar-item",{selected:n}),onClick:a,style:o},t.displayName)}function dt(e){var t=e.hotkey,n=e.onClick,a=Object(f.a)(e,["hotkey","onClick"]);return r.createElement("div",Object.assign({className:"mito-hud-button mito-hud-build-item",onClick:function(e){n&&n(e),function(e){e.preventDefault(),document.getElementsByTagName("canvas")[0].focus()}(e)}},a),r.createElement("span",{className:"mito-hud-button-hotkey"},t))}var mt=function(e){var t=e.bar,n=e.index,a=e.onIndexClicked;return r.createElement("div",{className:"cell-bar"},t.map(function(e,t){return r.createElement("div",{key:t},r.createElement(ht,{type:e,isSelected:n===t,onClick:function(){return a(t)},spritesheetLoaded:Xe}),r.createElement(dt,{hotkey:String(t+1),onClick:function(){return a(t)}}))}))};n(70),n(71);var ft=function(e){var t=e.className,n=e.children,i=e.shrunkElements,o=Object(r.useState)(!1),s=Object(X.a)(o,2),l=s[0],c=s[1];return a.a.createElement("div",{className:g()(t,"expand")},a.a.createElement("div",{className:"expand-button",onClick:function(){c(!l)}},i,a.a.createElement("div",{className:"expand-caret"},l?"\u25bc":"\u25b6")),l?a.a.createElement("div",null,n):null)};n(72);var vt=function(e){var t=e.traits,n=oe.filter(function(e){return 0!==t[e]});n.sort(function(e,n){return t[n]-t[e]});var r=n.length>0?a.a.createElement("div",{className:"interesting-traits"},n.map(function(e){return a.a.createElement("div",{className:g()("trait",{green:t[e]>0,red:t[e]<0}),key:e},se(e),": ",t[e])})):a.a.createElement("div",{className:"no-interesting-traits"},"All traits are zero."),i=oe.filter(function(e){return 0===t[e]}),o=a.a.createElement("div",{className:"zero-traits"},i.map(function(e){return a.a.createElement("div",{className:"trait",key:e},se(e),": ",t[e])}));return a.a.createElement("div",{className:"trait-display"},r,a.a.createElement(ft,{shrunkElements:a.a.createElement("div",{className:"expand-toggle"},"Show All")},o))};function pt(e){var t=e.percent,n={left:"".concat((100*t).toFixed(2),"%")};return r.createElement("div",{className:"bar-marker",style:n})}function yt(e){var t=e.percent,n={left:"".concat((100*t).toFixed(2),"%")};return r.createElement("div",{className:"season-bead",style:n})}function gt(e){var t=e.time,n=e.season,a=t/Le,i=Math.floor(3*n.percent)+1;return r.createElement("div",{className:"seasons-tracker"},r.createElement("div",{className:"container"},r.createElement("div",{className:"end-brace"}),r.createElement("div",{className:"bar"},r.createElement(pt,{percent:.25}),r.createElement(pt,{percent:.5}),r.createElement(pt,{percent:.75}),r.createElement(yt,{percent:a})),r.createElement("div",{className:"end-brace"})),r.createElement("div",null,ie(n.name),", Month ",i))}var wt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).state={traitsPanelOpen:!0},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"isTutorialFinished",value:function(){return null==this.mito.tutorialRef||this.mito.tutorialRef.isFinished()}},{key:"render",value:function(){var e=this,t=this.inventory.isMaxed(),n=r.createElement("div",{className:"mito-inventory-maxed".concat(t?" is-maxed":"")},"maxed");return r.createElement(r.Fragment,null,r.createElement(gt,{time:this.world.time,season:this.world.season}),this.maybeRenderTraits(),r.createElement("div",{className:g()("mito-inventory",{hidden:!1})},n,r.createElement("div",{className:"mito-inventory-container"},this.renderInventoryBar(),this.renderInventory()),r.createElement(mt,{bar:this.mito.cellBar,index:this.mito.cellBarIndex,onIndexClicked:function(t){return e.mito.setCellBarIndex(t)}})))}},{key:"maybeRenderTraits",value:function(){if(this.state.traitsPanelOpen)return r.createElement("div",{style:{position:"absolute",right:10,top:50,textAlign:"left",background:"white",padding:10}},r.createElement(vt,{traits:this.world.traits}))}},{key:"renderInventory",value:function(){return r.createElement("div",{className:"mito-inventory-indicator"},r.createElement("span",{className:"mito-inventory-water"},this.inventory.water.toFixed(2)," water"),"\xa0",r.createElement("span",{className:"mito-inventory-sugar"},this.inventory.sugar.toFixed(2)," sugar"))}},{key:"renderInventoryBar",value:function(){var e=this.inventory.water/q.maxResources,t=this.inventory.sugar/q.maxResources,n=1-(this.inventory.water+this.inventory.sugar)/q.maxResources,a={width:"".concat(100*e,"%")},i={width:"".concat(100*t,"%")},o={width:"".concat(100*n,"%")};return r.createElement("div",{className:"mito-inventory-bar"},r.createElement("div",{style:a,className:"mito-inventory-bar-water"}),r.createElement("div",{style:i,className:"mito-inventory-bar-sugar"}),r.createElement("div",{style:o,className:"mito-inventory-bar-empty"}))}},{key:"mito",get:function(){return this.props.mito}},{key:"world",get:function(){return this.mito.world}},{key:"player",get:function(){return this.world.player}},{key:"inventory",get:function(){return this.player.inventory}}]),t}(r.Component),bt=n(45),kt=function(){var e=new ne,t=new ne,n=new ne;return{climate:{turnsBetweenRainfall:800,rainDuration:50,waterPerDroplet:2},evaporationRate:2e-4,evaporationBottom:.6,floorCo2:.5,waterGravityPerTurn:.001,fill:[function(r,a){var i=r.x,o=r.y,s=a.height/2-4*(n.perlin2(0,i/5)+1)/2-16*n.perlin2(10,i/20+10),l=B(o-a.height/2,0,a.height/2,-.7,.3),c=t.simplex2(i/5,o/5)<l;if(o>s){if(c)return new we(r,a);var u=Math.pow(B(o-a.height/2,0,a.height/2,.5,1),2),h=e.simplex2(.2*i,.2*o)+.2,d=Math.round(Math.max(1,Math.min(20,h>.4?20*u:0)));if(u*h>1/q.fountainAppearanceRate){var m=Math.min(u*h,1);return new ke(r,d,a,Math.round(q.fountainTurnsPerWater/m))}return new ge(r,d,a)}}]}},Et=function(){var e=new ne,t=new ne;return{climate:{rainDuration:220,turnsBetweenRainfall:3e3,waterPerDroplet:8},evaporationRate:.002,evaporationBottom:.7,waterGravityPerTurn:.02,floorCo2:.95,fill:[function(n,r){var a=n.x,i=n.y,o=r.height/2-2*(e.perlin2(0,a/20)+1)/2-3*e.perlin2(10,a/100+10),s=B(i,r.height/2,r.height,-.8,-.4),l=t.simplex2(a/4,i/4)<s;if(i>o){if(l)return new we(n,r);var c=Math.floor(Math.max(0,B(i,.75*r.height,r.height,1,9)));return new ge(n,c,r)}}]}},Ot=function(){var e=new ne,t=new ne;return{climate:{turnsBetweenRainfall:1200,rainDuration:120,waterPerDroplet:3},waterGravityPerTurn:.1,evaporationBottom:.6,evaporationRate:.001,floorCo2:1,fill:[function(n,r){var a=n.x,i=n.y,o=.55*r.height-4*(t.perlin2(0,a/5)+1)/2-16*t.perlin2(10,a/20+10)-B(a,0,r.width,10,-10),s=i-6*(t.perlin2(0,a/25)+1)/2-20*t.perlin2(10,a/150+10)<.5*r.height?-1:-.15;return e.simplex2(a/10,i/10)<s?new we(n,r):i>o?new ge(n,3,r):void 0}]}},xt={Temperate:kt,Desert:Et,Rocky:Ot},jt=(r.Component,function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.props.parent.add(this.props.object)}},{key:"componentWillUnmount",value:function(){this.props.parent.remove(this.props.object)}}]),t}(r.PureComponent)),Mt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).rafid=void 0,n.animate=function(e){n.props.a(e/1e3),n.rafid=requestAnimationFrame(n.animate)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return null}},{key:"componentDidMount",value:function(){this.rafid=requestAnimationFrame(this.animate)}},{key:"componentWillUnmount",value:function(){this.rafid&&cancelAnimationFrame(this.rafid)}}]),t}(a.a.Component),Ct=_e(function(){var e=new w.PlaneBufferGeometry(1,1),t=new w.EdgesGeometry(e,1),n=new w.LineBasicMaterial({color:16777215,transparent:!0,opacity:.75}),r=new w.LineSegments(t,n);return r.position.z=10,r}),St=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).object=Ct().clone(),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(Mt,{a:function(t){return e.object.scale.setScalar(.04*Math.sin(3.7*t)+.94)}}),r.createElement(jt,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),At=_e(function(){var e=new w.CircleBufferGeometry(.1,20),t=new w.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.75,side:w.DoubleSide}),n=new w.Mesh(e,t);return n.position.z=10,n}),Tt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(h.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(a)))).object=At().clone(),n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.object.position.x=this.props.x,this.object.position.y=this.props.y,r.createElement(r.Fragment,null,r.createElement(jt,{object:this.object,parent:this.props.scene}))}}]),t}(r.PureComponent),Rt=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.mito.highlightedTile,t=this.props.mito.getHighlightPosition();return r.createElement(r.Fragment,null,r.createElement(He,{tile:e}),r.createElement(Tt,{x:t.x,y:t.y,scene:this.scene}),this.maybeRenderTileHighlight(e))}},{key:"maybeRenderTileHighlight",value:function(e){if(e)return r.createElement(St,{x:e.pos.x,y:e.pos.y,scene:this.scene})}},{key:"scene",get:function(){return this.props.mito.scene}}]),t}(r.Component),Nt=n(46),Pt=function(e){function t(e,n,r){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).mesh=void 0,a.mesh=new w.Mesh(new w.PlaneBufferGeometry(.75,.75),new w.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:Qe(29,12,"transparent"),color:new w.Color("white"),side:w.DoubleSide})),F(a.mesh.position,a.target.pos,1),a.mesh.position.z=2,a.scene.add(a.mesh),a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"update",value:function(){var e=this.target.droopPosFloat().clone();e.x+=.04*Math.cos(performance.now()/1e3),e.y+=.08*Math.sin(performance.now()/400),F(this.mesh.position,e,.5),this.mesh.position.z=2}},{key:"destroy",value:function(){this.scene.remove(this.mesh)}}]),t}(et),Dt=function(e){function t(e,n,r){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).arrow=void 0,a.arrow=a.makeArrow(a.target.dir),a.mesh.add(a.arrow),a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"makeArrow",value:function(e){var t=e.length()-.25,n=new w.Vector3(e.x,e.y,0).normalize(),r=n.clone().multiplyScalar(-t/2);return new w.ArrowHelper(n,new w.Vector3(r.x,r.y,1),t,16777215,.1,.1)}}]),t}(lt);var Ft=function(e){function t(e,n,r){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(d.a)(t).call(this,e,n,r))).renderers=new Map,a.deleteDeadEntityRenderers=Object(Nt.a)(function(e){return e},function(e){var t=e.deleted,n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,c=a.renderers.get(l);if(null==c)throw new Error("Couldn't find renderer for ".concat(l,"!"));c.destroy(),a.renderers.delete(l)}}catch(u){r=!0,i=u}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}),n.add(it.WaterParticles()),n.add(it.SugarParticles()),a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"getOrCreateRenderer",value:function(e){var t=this.renderers.get(e);if(null==t){var n=function(e,t,n){if(e instanceof Re)return new Pt(e,t,n);if(e instanceof Ae)return new Dt(e,t,n);if(e instanceof fe)return new lt(e,t,n);throw new Error("Couldn't find renderer for ".concat(e))}(e,this.scene,this.mito);return this.renderers.set(e,n),n}return t}},{key:"update",value:function(){var e=this;this.deleteDeadEntityRenderers(this.target.getLastStepStats()),it.startFrame(),this.target.entities().forEach(function(t){e.getOrCreateRenderer(t).update()}),it.endFrame()}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}}]),t}(et),Bt=function(){function e(t,n,r){Object(c.a)(this,e),this.mito=t,this.positionFn=n,this.renderFn=r}return Object(u.a)(e,[{key:"render",value:function(){var e=this.positionFn(),t=this.mito.worldToScreen(e),n={left:t.x,top:t.y};return r.createElement("div",{style:n},this.renderFn())}}]),e}(),Lt=function(e){function t(e,n,r,a,i){var o;return Object(c.a)(this,t),(o=Object(h.a)(this,Object(d.a)(t).call(this,e,n))).onWinLoss=i,o.world=void 0,o.scene=new w.Scene,o.camera=new w.OrthographicCamera(0,0,0,0,-100,100),o.cellBar=[xe,je,Me,Ae,Ce],o.cellBarIndex=0,o.tutorialRef=null,o.mouse=new w.Vector2,o.mouseDown=!1,o.mouseButton=-1,o.instructionsOpen=!1,o.firstActionTakenYet=!1,o.audioListener=new w.AudioListener,o.keyMap=new Set,o.highlightedTile=void 0,o.events={contextmenu:function(e){return e.preventDefault(),!1},mousemove:function(e){o.mouse.x=e.clientX,o.mouse.y=e.clientY},click:function(){},mousedown:function(e){o.mouseButton=e.button,o.mouseDown=!0},mouseup:function(){o.mouseDown=!1},keydown:function(e){o.firstActionTakenYet=!0;var t=e.key;o.keyMap.add(t),e.repeat||o.handleKeyDown(t)},keyup:function(e){o.keyMap.delete(e.key)},wheel:function(e){if(e.shiftKey){var t=-(e.deltaX+e.deltaY)/125/20,n=o.camera.zoom*Math.pow(2,t);o.camera.zoom=n,o.camera.updateProjectionMatrix()}else e.deltaX+e.deltaY<0?o.setCellBarIndex(o.cellBarIndex-1):o.setCellBarIndex(o.cellBarIndex+1)}},o.worldRenderer=void 0,o.handleKeyDown=function(e){if("?"!==e){if(o.instructionsOpen)"Escape"===e&&(o.instructionsOpen=!1);else if(-1!==["1","2","3","4","5"].indexOf(e)){var t=e.charCodeAt(0)-"1".charCodeAt(0);o.cellBarIndex=t}}else o.instructionsOpen=!o.instructionsOpen},o.worldDomElements=new Set,null==r.info.world&&(r.info.world=new Ie(r.info.environment,a)),o.world=r.info.world,o.camera.position.z=10,o.camera.lookAt(new w.Vector3(0,0,0)),o.camera.position.x=o.world.player.pos.x,o.camera.position.y=o.world.player.pos.y,o.camera.zoom=1.5,o.camera.add(o.audioListener),o.worldRenderer=new Ft(o.world,o.scene,Object(P.a)(o)),o.world.step(),function(e){var t=0;function n(){3===++t&&(E.audio.currentTime=0,O.audio.currentTime=0,x.audio.currentTime=0,E.gain.connect(e.gain),O.gain.connect(e.gain),x.gain.connect(e.gain))}(E=W(e,"mito-base")).audio.oncanplaythrough=n,E.gain.gain.value=.5,(O=W(e,"mito-strings")).audio.oncanplaythrough=n,O.gain.gain.value=0,(x=W(e,"mito-drums")).audio.oncanplaythrough=n,x.gain.gain.value=0,(j=W(e,"footsteps")).gain.gain.value=0,j.gain.connect(e.gain),(M=W(e,"build")).gain.gain.value=0,M.gain.connect(e.gain);var r=new w.AudioLoader;r.load("assets/audio/Blop-Mark_DiAngelo-79054334.mp3",function(e){C=e},function(e){},function(e){}),r.load("assets/audio/suckwater.wav",function(e){S=e},function(e){},function(e){})}(o.audioContext),o.updateAmbientAudio(),window.mito=Object(P.a)(o),window.THREE=w,o}return Object(m.a)(t,e),Object(u.a)(t,[{key:"selectedCell",get:function(){return this.cellBar[this.cellBarIndex]}}]),Object(u.a)(t,[{key:"setCellBarIndex",value:function(e){this.cellBarIndex=(e%this.cellBar.length+this.cellBar.length)%this.cellBar.length}},{key:"render",value:function(){var e=[],t=!0,n=!1,a=void 0;try{for(var i,o=this.worldDomElements[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;e.push(s.render())}}catch(l){n=!0,a=l}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}return r.createElement(r.Fragment,null,r.createElement(wt,{mito:this}),r.createElement(qe,{mito:this}),r.createElement(Rt,{mito:this}),r.createElement("div",{className:"world-dom-components"},e))}},{key:"updateAmbientAudio",value:function(){var e=this.world.player.pos.y,t=B(e,this.world.height/2,this.world.height,0,.5),n=B(e,this.world.height/2,0,0,.5);x.gain.gain.value=Math.max(0,t),O.gain.gain.value=Math.max(0,n)}},{key:"logRenderInfo",value:function(){console.log("Geometries in memory: ".concat(this.renderer.info.memory.geometries,"\nTextures in memory: ").concat(this.renderer.info.memory.textures,"\nNumber of Programs: ").concat(this.renderer.info.programs.length,"\n# Render Calls: ").concat(this.renderer.info.render.calls,"\n# Render Lines: ").concat(this.renderer.info.render.lines,"\n# Render Points: ").concat(this.renderer.info.render.points,"\n# Render Tris: ").concat(this.renderer.info.render.triangles,"\n"))}},{key:"perfDebug",value:function(){var e=0,t=0;this.scene.traverse(function(n){n.matrixAutoUpdate?e++:t++}),console.log("matrixAutoUpdate: yes",e,", no",t);var n=new Map;this.scene.traverse(function(e){var t=n.get(e.name||e.constructor.name)||[];n.set(e.name||e.constructor.name,t),t.push(e)}),console.log(n)}},{key:"worldStep",value:function(){if(this.firstActionTakenYet&&!this.instructionsOpen){this.world.step(),this.tutorialRef&&this.tutorialRef.setState({time:this.world.time});var e=this.world.maybeGetGameResult();null!=e&&this.onWinLoss(e),this.updateAmbientAudio()}}},{key:"getCameraNormCoordinates",value:function(e,t){return new w.Vector2(e/this.canvas.width*2-1,-t/this.canvas.height*2+1)}},{key:"getHighlightVector",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=new w.Vector2(e-this.canvas.width/2,t-this.canvas.height/2);return n.setLength(.75),n}},{key:"getHighlightPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightVector(e,t),r=this.world.player.posFloat,a=r.x,i=r.y;return n.x+=a,n.y+=i,n}},{key:"getHighlightedTile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mouse.x,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mouse.y,n=this.getHighlightPosition(e,t);n.round();var r=this.world.tileAt(n.x,n.y);if(null!=r&&r.lightAmount()>0)return r}},{key:"worldToScreen",value:function(e){var t=new w.Vector3(e.x,e.y,0);return t.project(this.camera),t.x=Math.round((.5+t.x/2)*this.canvas.width),t.y=Math.round((.5-t.y/2)*this.canvas.height),t}},{key:"addWorldDOMElement",value:function(e,t){var n=new Bt(this,e,t);return this.worldDomElements.add(n),n}},{key:"removeWorldDOMElement",value:function(e){this.worldDomElements.delete(e)}},{key:"animate",value:function(){if(!this.instructionsOpen){if(this.canvas.focus(),q.isRealtime){var e=this.keysToMovement(this.keyMap);e&&this.world.player.setAction(e);var t=!0,n=!1,r=void 0;try{for(var a,i=this.keyMap[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;ze[o]&&this.world.player.setAction(ze[o])}}catch(c){n=!0,r=c}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}this.mouseDown&&(0===this.mouseButton?this.handleLeftClick():2===this.mouseButton&&this.handleRightClick()),this.worldStep()}else null!=this.world.player.getAction()&&this.worldStep();this.worldRenderer.update(),this.highlightedTile=this.getHighlightedTile();var s=this.getCameraNormCoordinates(this.mouse.x,this.mouse.y),l=new w.Vector2(this.world.player.posFloat.x+s.x/2,this.world.player.posFloat.y-s.y/2);F(this.camera.position,l,.3),this.renderer.render(this.scene,this.camera),Boolean(Object(D.parse)(window.location.search).debug)&&this.frameCount%100===0&&this.logRenderInfo()}}},{key:"keysToMovement",value:function(e){var t=new w.Vector2,n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;Ye[s]&&t.add(Ye[s].dir)}}catch(l){r=!0,a=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return 0===t.x&&0===t.y?null:{type:"move",dir:t}}},{key:"resize",value:function(e,t){var n=t/e;this.camera.left=-12/n,this.camera.right=12/n,this.camera.top=-12,this.camera.bottom=12,this.camera.updateProjectionMatrix()}},{key:"handleRightClick",value:function(){var e=this.getHighlightedTile();if(null!=e){if(e instanceof Ce)return;this.world.player.setAction({type:"deconstruct",position:e.pos})}}},{key:"handleLeftClick",value:function(){this.firstActionTakenYet=!0;var e=this.getHighlightedTile();if(null!=e&&this.world.player.isBuildCandidate(e)){var t=[];if(this.selectedCell===Ae){var n=this.getHighlightVector().setLength(1).round();t.push(n)}var r={type:"build",cellType:this.selectedCell,position:e.pos.clone(),args:t};this.world.player.setAction(r)}}}]),t}(k);Lt.expansionTiles=[xe,Me,Te];var Wt=Lt,It=n(119),Vt=n(47),Gt=n.n(Vt);function zt(e,t){var n=t.dX,r=t.dY,a=t.scale,i=e.cartesian,o=i.x,s=i.y;return[window.innerWidth/2+n+o*a,window.innerHeight/2+r+s*a]}n(83),n(84);var Yt=function(e){var t=e.tile,n=e.camera,r=e.children,i=zt(t,n),o=Object(X.a)(i,2),s=o[0],l=o[1],c={left:s+.5*n.scale,top:l};return a.a.createElement("div",{className:"overworld-popover",style:c},a.a.createElement("div",{className:"overworld-popover-positioner"},r))};n(85),n(86);function Ut(e){return a.a.createElement("button",Object.assign({},e,{className:g()("button",e.className,e.color||"purple")}),e.children)}var qt=n(29);n(87);var Ht=function(e){var t=e.amount,n=e.total,r=Object(f.a)(e,["amount","total"]);return a.a.createElement("div",Object.assign({},r,{className:g()("mp",r.className)}),t,null!=n?a.a.createElement(a.a.Fragment,null,"/",n):null,a.a.createElement(qt.a,{className:"mp-icon"}))};var _t=function(e){var t=e.tile,n=e.onClickPlay,r=t.info,i=r.height,o=r.flora,s=-1===i||null!=o?null:a.a.createElement(Ut,{color:"green",className:"play-button",onClick:function(){n(t)}},"Populate"),l=null!=o?a.a.createElement("h1",null,"Inhabited by ",o.species,a.a.createElement("small",null,a.a.createElement(Ht,{amount:o.mutationPointsPerEpoch})," per epoch")):-1===t.info.height?a.a.createElement("h1",null,"Deep Water"):a.a.createElement("h1",null,"Uninhabited"),c=Object(Y.a)({},t.info);delete c.world;var u=-1===t.info.height?null:a.a.createElement(ft,{shrunkElements:a.a.createElement("div",{className:"details"},"Details")},a.a.createElement("pre",{style:{fontSize:"12px"}},JSON.stringify(c,null,4)));return a.a.createElement("div",{className:"hex-tile-info-container"},l,u,s)},Kt=(n(88),n(48)),Xt=n.n(Kt);n(104);function Jt(e){var t=e.gene,n=e.onClick;return a.a.createElement("div",{className:"gene"},a.a.createElement("div",{className:"gene-number"},a.a.createElement("span",{className:"tuple-plus",title:he(t[0])+" +1"},a.a.createElement("span",{className:"dna",onClick:function(){return n(0)}},t[0][0]),a.a.createElement("span",{className:"dna",onClick:function(){return n(1)}},t[0][1])),a.a.createElement("span",{className:"tuple-minus",title:he(t[1])+" -1"},a.a.createElement("span",{className:"dna",onClick:function(){return n(2)}},t[1][0]),a.a.createElement("span",{className:"dna",onClick:function(){return n(3)}},t[1][1]))),a.a.createElement("div",{className:"gene-visual"},a.a.createElement("img",{alt:"",src:"https://media2.giphy.com/media/YlmI36YAWe7KScC7hK/giphy.gif",width:"44px"})))}var Zt=function(e){var t=e.genes,n=e.onClick,r=t.length>0?a.a.createElement("div",{className:"genes-container"},t.map(function(e,t){return a.a.createElement(Jt,{key:t,gene:e,onClick:function(t){return n(e,t)}})})):a.a.createElement("div",{className:"genes-empty"},"No genes.");return a.a.createElement("div",{className:"gene-display"},r)};n(105);var $t=function(e){var t=e.genes,n=e.onClick,r=a.a.useMemo(function(){return ce(t)},[t]);return a.a.createElement("div",{className:"genes-to-traits"},a.a.createElement("div",{className:"genes-details"},a.a.createElement("h3",null,"Genes"),a.a.createElement(Zt,{genes:t,onClick:n})),a.a.createElement("div",{className:"arrow"},"\u21d2"),a.a.createElement("div",{className:"traits-details"},a.a.createElement("h3",null,"Traits"),a.a.createElement(vt,{traits:r})))};n(106);var Qt=function(e){var t=e.species,n=e.onClick,r=e.onMutate;return a.a.createElement("div",{className:"species-details"},a.a.createElement($t,{genes:t.genes,onClick:n}),t.freeMutationPoints>0?a.a.createElement("div",{className:"suggestion"},t.freeMutationPoints," Mutation Points available. Use them!"):null,a.a.createElement(Ut,{onClick:function(){return r(t)}},"Mutate"))};n(107);var en=function(e){var t=e.size,n=Object(f.a)(e,["size"]);return a.a.createElement("img",Object.assign({className:g()("character",t),alt:"",src:"/assets/images/character.png"},n))};n(108);var tn=function e(t){var n=t.species,r=t.onMutate,i=function(e){c(!1),r(e)},o=a.a.useState(!1),s=Object(X.a)(o,2),l=s[0],c=s[1],u=n.descendants.length>0?a.a.createElement("div",{className:"descendants-container"},n.descendants.map(function(t,n){return a.a.createElement(e,{key:n,species:t,onMutate:i})})):null,h=a.a.createElement("div",{className:"species-detail-popover"},a.a.createElement(Qt,{species:n,onMutate:i,onClick:function(){}}));return a.a.createElement("div",{className:"species-node"},u,a.a.createElement(Xt.a,{isOpen:l,preferPlace:"right",onOuterAction:function(){return c(!1)},body:h},a.a.createElement("div",{className:"species-info",onClick:function(){return c(!l)}},a.a.createElement("div",{className:"species-info-name"},n.name),a.a.createElement("div",{className:"species-info-animation"},a.a.createElement(en,{size:"small"})),a.a.createElement(Ht,{amount:n.freeMutationPoints}))))};var nn=function(e){var t=e.rootSpecies,n=e.onMutate;return a.a.createElement("div",{className:"phylogenetic-tree"},a.a.createElement("div",{className:"title"},"Phylogenetic Tree"),a.a.createElement("div",{className:"tree-nodes"},a.a.createElement(tn,{species:t,onMutate:n})))};n(109);function rn(e,t){var n=e.join("");return an(n.substr(0,t)+function(e){var t;do{t=sn()}while(t===e);return t}(n.charAt(t))+n.substr(t+1))}function an(e){return[e.substr(0,2),e.substr(2)]}function on(){return sn()+sn()}function sn(){var e=Math.random();return e<.25?"A":e<.5?"C":e<.75?"G":"T"}var ln=function(e){var t=e.species,n=e.onCommit,r=a.a.useState(t.freeMutationPoints),i=Object(X.a)(r,2),o=i[0],s=i[1],l=a.a.useState({descendants:[],freeMutationPoints:0,genes:Object(p.a)(t.genes),name:"New species",parent:t}),c=Object(X.a)(l,2),u=c[0],h=c[1],d=a.a.useState(),m=Object(X.a)(d,2),f=m[0],v=m[1],y=f&&"swap"===f.type,w=f&&"reroll"===f.type,b=u.genes.length+1;function k(e,t,n,r){s(function(e){return e-2}),h(function(a){var i=a.genes.indexOf(e),o=a.genes.indexOf(n),s=Object(p.a)(a.genes),l=function(e,t,n,r){var a=e.join(""),i=n.join(""),o=a.charAt(t),s=i.charAt(r),l=a.substr(0,t)+s+a.substr(t+1),c=i.substr(0,r)+o+i.substr(r+1);return[an(l),an(c)]}(e,t,n,r),c=Object(X.a)(l,2),u=c[0],h=c[1];return s[i]=u,s[o]=h,Object(Y.a)({},a,{genes:s})}),v(void 0)}var E=a.a.useMemo(function(){var e=t.genes,n=u.genes;return e.length!==n.length||e.some(function(t,r){return e[r]!==n[r]})},[u.genes,t.genes]);return a.a.createElement("div",{className:g()("mutation-screen",{"click-mode-active":null!=f})},a.a.createElement("div",{className:"mutation-screen-content"},a.a.createElement("h1",null,a.a.createElement(en,{size:"medium"}),a.a.createElement("span",{className:"name"},t.name)),a.a.createElement("div",{className:"buttons"},a.a.createElement(Ht,{className:"pool",amount:o,total:t.freeMutationPoints}),a.a.createElement(Ut,{onClick:function(){s(function(e){return e-b}),h(function(e){return Object(Y.a)({},e,{genes:[].concat(Object(p.a)(e.genes),[[on(),on()]])})})},disabled:o<b},"New Gene (",a.a.createElement(Ht,{amount:b}),")"),a.a.createElement(Ut,{className:g()({"is-cancel":y}),onClick:function(){v(y?void 0:{type:"swap"})},disabled:!y&&o<2||0===u.genes.length},y?"Cancel":a.a.createElement(a.a.Fragment,null,"Swap DNA (",a.a.createElement(Ht,{amount:2}),")")),a.a.createElement(Ut,{className:g()({"is-cancel":w}),onClick:function(){v(w?void 0:{type:"reroll"})},disabled:!w&&o<1||0===u.genes.length},w?"Cancel":a.a.createElement(a.a.Fragment,null,"Re-roll DNA (",a.a.createElement(Ht,{amount:1}),")"))),a.a.createElement($t,{genes:u.genes,onClick:function(e,t){f&&("reroll"===f.type?function(e,t){s(function(e){return e-1}),h(function(n){var r=n.genes.indexOf(e),a=rn(e,t),i=[].concat(Object(p.a)(n.genes.slice(0,r)),[a],Object(p.a)(n.genes.slice(r+1)));return Object(Y.a)({},n,{genes:i})}),v(void 0)}(e,t):"swap"===f.type&&(null==f.p1?f.p1={gene:e,position:t}:k(f.p1.gene,f.p1.position,e,t)))}}),E?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"arrow"},"\u21d3"),a.a.createElement("h1",null,a.a.createElement(en,{size:"medium"}),a.a.createElement("input",{type:"text",className:"name",value:u.name,onChange:function(e){h(function(t){return Object(Y.a)({},t,{name:e.target.value})})}})),a.a.createElement(Ut,{className:"commit",color:"green",onClick:function(){n(u,o)}},"Commit")):null))},cn=Math.sqrt(3)/2,un=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).canvas=null,n.rafId=void 0,n.handleCanvasRef=function(e){n.canvas=e,null!=e&&n.handleResize()},n.handleCanvasClick=function(e){if(null!=n.canvas)if(null!=n.state.highlightedTile)n.setState({highlightedTile:void 0});else{var t=function(e,t,n,r){var a=n.scale,i=n.dX,o=n.dY,s=t.width/2+i,l=t.height/2+o,c=r.nativeEvent,u=c.offsetX,h=c.offsetY,d=(u-s)/a/1.5,m=((h-l)/a-cn*d)/(2*cn),f=function(e,t,n){var r=Math.round(e),a=Math.round(t),i=Math.round(n),o=Math.abs(r-e),s=Math.abs(a-t),l=Math.abs(i-n);return o>s&&o>l?r=-a-i:s>l?a=-r-i:i=-r-a,{i:r,j:a,k:i}}(d,m,-(d+m));return e.tileAt(f.i,f.j)}(n.props.overWorld,n.canvas,n.state.cameraState,e);null!=t&&t.info.visible&&n.setState({highlightedTile:t})}},n.handleStartMutate=function(e){n.setState({activelyMutatingSpecies:e})},n.handleCommit=function(e,t){if(null==n.state.activelyMutatingSpecies)throw new Error("created new species with no actively mutating one!");n.state.activelyMutatingSpecies.descendants.push(e),n.state.activelyMutatingSpecies.freeMutationPoints=t,e.parent=n.state.activelyMutatingSpecies,n.setState({activelyMutatingSpecies:void 0})},n.onPlayLevel=function(e){n.props.onPlayLevel(e)},n.toggleLeftPanelOpen=function(){n.setState({leftPanelOpen:!n.state.leftPanelOpen})},n.handleKeyDown=function(e){if(!e.repeat){"Tab"===e.code&&(n.toggleLeftPanelOpen(),e.preventDefault());var t=Object(Y.a)({},n.state.pressedKeys,Object(Ne.a)({},e.code,!0));n.setState({pressedKeys:t})}},n.handleKeyUp=function(e){var t=Object(Y.a)({},n.state.pressedKeys);delete t[e.code],n.setState({pressedKeys:t})},n.handleResize=function(){null!=n.canvas&&(n.canvas.width=window.innerWidth,n.canvas.height=window.innerHeight,n.drawMap())},n.updateCamera=function(){var e=new w.Vector2;for(var t in n.state.pressedKeys)"KeyW"===t||"ArrowUp"===t?e.y+=20:"KeyS"===t||"ArrowDown"===t?e.y-=20:"KeyA"===t||"ArrowLeft"===t?e.x+=20:"KeyD"!==t&&"ArrowRight"!==t||(e.x-=20);if(e.setLength(20),0!==e.x||0!==e.y){var r=n.state.cameraState;n.setState({cameraState:Object(Y.a)({},r,{dX:r.dX+e.x,dY:r.dY+e.y})})}n.rafId=requestAnimationFrame(n.updateCamera)},n.state={cameraState:{scale:48,dX:0,dY:0},pressedKeys:{},leftPanelOpen:!0},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"drawMap",value:function(){if(null!=this.canvas){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height);var e=!0,t=!1,n=void 0;try{for(var r,a=this.props.overWorld[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;mn(this.canvas,this.state.cameraState,i)}}catch(o){t=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),window.addEventListener("resize",this.handleResize),this.rafId=requestAnimationFrame(this.updateCamera)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("resize",this.handleResize),cancelAnimationFrame(this.rafId)}},{key:"componentDidUpdate",value:function(){this.drawMap()}},{key:"render",value:function(){return a.a.createElement("div",{className:"overworld-map-container"},a.a.createElement("canvas",{tabIndex:-1,ref:this.handleCanvasRef,onClick:this.handleCanvasClick}),this.maybeRenderHighlightedTile(),this.maybeRenderPhylogeneticTreePanel(),this.maybeRenderMutationModal())}},{key:"maybeRenderMutationModal",value:function(){var e=this,t=null!=this.state.activelyMutatingSpecies?a.a.createElement(ln,{species:this.state.activelyMutatingSpecies,onCommit:this.handleCommit}):null;return a.a.createElement(Gt.a,{ariaHideApp:!1,isOpen:null!=this.state.activelyMutatingSpecies,onRequestClose:function(){return e.setState({activelyMutatingSpecies:void 0})},className:"mutation-screen-portal"},t)}},{key:"maybeRenderPhylogeneticTreePanel",value:function(){return a.a.createElement("div",{className:g()("panel-left",{open:this.state.leftPanelOpen})},this.state.leftPanelOpen?a.a.createElement(nn,{onMutate:this.handleStartMutate,rootSpecies:this.props.rootSpecies}):null,a.a.createElement("button",{className:"panel-left-handle",onClick:this.toggleLeftPanelOpen},a.a.createElement(qt.b,{className:"icon"})))}},{key:"maybeRenderHighlightedTile",value:function(){if(null!=this.state.highlightedTile)return a.a.createElement(Yt,{camera:this.state.cameraState,tile:this.state.highlightedTile},a.a.createElement(_t,{tile:this.state.highlightedTile,onClickPlay:this.onPlayLevel}))}}]),t}(a.a.Component);function hn(e,t,n,r){e.strokeStyle="rgb(112, 112, 112)",e.beginPath(),e.moveTo(t+r,n);for(var a=1;a<6;a++){var i=a/6*Math.PI*2;e.lineTo(t+Math.cos(i)*r,n+Math.sin(i)*r)}e.closePath(),e.fill(),e.stroke()}var dn=Object(It.a)().domain([-1,0,1,5,6]).range(["rgb(0, 60, 255)","lightblue","yellow","orange"]);function mn(e,t,n){var r=t.scale,a=zt(n,t),i=Object(X.a)(a,2),o=i[0],s=i[1],l=e.getContext("2d");n.info.visible?(l.fillStyle=dn(n.info.height),hn(l,o,s,r),l.font="12px serif",l.textAlign="center",l.textBaseline="middle",l.fillStyle="#666",l.fillText(n.info.height+"",o,s,r)):(l.fillStyle="grey",hn(l,o,s,r))}var fn=n(36),vn=n.n(fn),pn=Math.sqrt(3)/2,yn=function(){function e(t,n){Object(c.a)(this,e),this.i=t,this.j=n,this.neighbors=new Array(6),this.info={height:0,rainfall:"medium",soilType:"average",temperature:"temperate",wind:"low",visible:!1}}return Object(u.a)(e,[{key:"crusaderType",get:function(){return this.info.height<-2?"water":this.info.height<2.5?"plains":this.info.height<4?"forest":"mountain"}},{key:"k",get:function(){return-(this.i+this.j)}},{key:"magnitude",get:function(){return Math.abs(this.i)+Math.abs(this.j)+Math.abs(this.k)}},{key:"cartesian",get:function(){var e=this.i,t=this.j;return{x:1.5*e,y:2*pn*t+pn*e}}}]),e}(),gn=Symbol.iterator,wn=function(){function e(){Object(c.a)(this,e),this.tiles={}}return Object(u.a)(e,[{key:"hash",value:function(e,t){return"".concat(e,",").concat(t)}},{key:"get",value:function(e,t){return this.tiles[this.hash(e,t)]}},{key:"set",value:function(e,t,n){this.tiles[this.hash(e,t)]=n}},{key:"hookUpNeighbors",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value,o=i.i,s=i.j;i.neighbors[0]=this.get(o+1,s),i.neighbors[1]=this.get(o,s+1),i.neighbors[2]=this.get(o-1,s+1),i.neighbors[3]=this.get(o-1,s),i.neighbors[4]=this.get(o,s-1),i.neighbors[5]=this.get(o+1,s-1)}}catch(l){t=!0,n=l}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:gn,value:De.a.mark(function e(){var t;return De.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=De.a.keys(this.tiles);case 1:if((e.t1=e.t0()).done){e.next=7;break}return t=e.t1.value,e.next=5,this.tiles[t];case 5:e.next=1;break;case 7:case"end":return e.stop()}},e,this)})}]),e}(),bn=Symbol.iterator,kn=function(){function e(t){Object(c.a)(this,e),this.storage=t,this.startTile=void 0,t.hookUpNeighbors();var n=Array.from(t);this.startTile=n.filter(function(e){return 0===e.info.height}).sort(function(e,t){return e.magnitude-t.magnitude})[0],this.startTile.info.visible=!0}return Object(u.a)(e,null,[{key:"randomHeight",value:function(e,t){var n=e.cartesian,r=n.x,a=n.y,i=0;return i+=6*(t.noise3D(r/24,a/24,0)-.2),i+=6*t.noise3D(r/24,a/24,1.453),i+=1.5*t.noise3D(r/6,a/6,1.453),i+=1,(i-=.025*Math.abs(a*a))<0&&i>=-1&&(i=0),i=Math.round(Math.max(Math.min(i,6),-1))}},{key:"randomCrusaderHeight",value:function(e,t){var n=e.cartesian,r=n.x,a=n.y,i=0;return i=6*t.noise3D(r/8,a/8,0),i+=1,i=Math.round(i)}},{key:"populateLevelInfo",value:function(t,n){var r=t.info;r.height=e.randomHeight(t,n),r.environment=r.height<2?kt():r.height<4?Ot():Et()}},{key:"generateFilledHex",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,n=new wn,r=new vn.a,a=-t;a<=t;a++)for(var i=-t;i<=t;i++){var o=-(a+i);if(!(Math.abs(o)>t)){var s=new yn(a,i);e.populateLevelInfo(s,r),n.set(a,i,s)}}return new e(n)}},{key:"generateRectangle",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,r=new wn,a=new vn.a,i=Math.max(t/2,n/2),o=-i;o<=i;o++)for(var s=-i;s<=i;s++){var l=-(o+s);if(!(Math.abs(l)>i)){var c=new yn(o,s),u=c.cartesian,h=u.x,d=u.y;h<-t/2||h>t/2||d<-n/2||d>n/2||(e.populateLevelInfo(c,a),r.set(o,s,c))}}return new e(r)}}]),Object(u.a)(e,[{key:"getStartTile",value:function(){return this.startTile}},{key:"tileAt",value:function(e,t){return this.storage.get(e,t)}},{key:bn,value:De.a.mark(function e(){var t,n,r,a,i,o;return De.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,r=void 0,e.prev=3,a=this.storage[Symbol.iterator]();case 5:if(t=(i=a.next()).done){e.next=12;break}return o=i.value,e.next=9,o;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,r=e.t0;case 18:e.prev=18,e.prev=19,t||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw r;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})}]),e}();n(110);function En(){return r.createElement("div",{className:"glow"},r.createElement("span",null))}function On(e){var t=e.fruit;return r.createElement("div",{className:"fruit-info"},r.createElement("div",{className:"fruit-visual"},t.isMature()?r.createElement(En,null):null,r.createElement("img",{alt:"",src:"assets/images/fruit.png"})),t.isMature()?r.createElement(r.Fragment,null,r.createElement("span",{className:"matured-info success"},"Matured"),"\xa0at ",t.timeMatured,", Mutation Points earned: 1"):r.createElement("span",{className:"matured-info in-progress"},(100*t.getPercentMatured()).toFixed(0),"% maturity"),", started ",t.timeMade,".")}function xn(e){var t=e.results,n=t.fruits.filter(function(e){return e.isMature()});return r.createElement(r.Fragment,null,r.createElement("div",{className:"character-party-container"},r.createElement(en,{size:"large"})),r.createElement("h1",null,"You ",n.length>=3?"thrived":"survived","!"),r.createElement("h2",null,n.length," Mutation Points earned."),r.createElement("h5",null,"Fruit Made"),r.createElement("div",{className:"fruit-list"},t.fruits.map(function(e){return r.createElement(On,{fruit:e})})))}function jn(e){var t=e.results;return r.createElement(r.Fragment,null,r.createElement("h1",null,"You died!"),r.createElement("div",null,"You survived until ",t.world.season.name,"!"))}function Mn(e){var t=e.onDone,n=e.results;return r.createElement("div",{className:"game-results-screen ".concat(n.status)},r.createElement("div",{className:"game-results-content"},"won"===n.status?r.createElement(xn,{onDone:t,results:n}):r.createElement(jn,{onDone:t,results:n}),r.createElement("button",{className:"done-button",onClick:t},"Continue \u2192")))}function Cn(){return{name:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"newBaseSpecies",genes:[],freeMutationPoints:0,descendants:[]}}var Sn=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).handlePlayLevel=function(e){e.info.visible&&n.setState({activeLevel:e})},n.handleWinLoss=function(e){if(n.setState({activeGameResult:e}),"won"===e.status&&null!=n.state.activeLevel){var t=n.state.activeLevel;t.info.flora={species:e.world.species,mutationPointsPerEpoch:e.fruits.filter(function(e){return e.isMature()}).length};var r=!0,a=!1,i=void 0;try{for(var o,s=t.neighbors[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){o.value.info.visible=!0}}catch(l){a=!0,i=l}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}}},n.handleResultsDone=function(){n.setState({activeLevel:void 0,activeGameResult:void 0})};var r=kn.generateRectangle(100,50),a=Cn("plantum originus");return a.freeMutationPoints=25,n.state={overWorld:r,activeLevel:void 0,rootSpecies:a},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},this.maybeRenderOverWorldMap(),this.maybeRenderLevel(),this.maybeRenderGameResult())}},{key:"maybeRenderOverWorldMap",value:function(){if(null==this.state.activeLevel)return a.a.createElement(un,{overWorld:this.state.overWorld,rootSpecies:this.state.rootSpecies,onPlayLevel:this.handlePlayLevel})}},{key:"maybeRenderLevel",value:function(){if(null!=this.state.activeLevel&&null==this.state.activeGameResult)return a.a.createElement(N,{sketchClass:Wt,otherArgs:[this.state.activeLevel,this.state.rootSpecies,this.handleWinLoss]})}},{key:"maybeRenderGameResult",value:function(){if(null!=this.state.activeGameResult)return a.a.createElement(Mn,{results:this.state.activeGameResult,onDone:this.handleResultsDone})}}]),t}(a.a.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(111);var An=function(){function e(t){Object(c.a)(this,e),this.visitors=t,this.trials=[]}return Object(u.a)(e,[{key:"recordDataFor",value:function(e){var t=function(e,t){for(var n=Array.from(e.environmentTiles()),r={},a=0,i=Object.entries(t);a<i.length;a++){var o=i[a],s=Object(X.a)(o,2),l=s[0],c=(0,s[1])(n,e);r[l]=c}return r}(e,this.visitors);this.trials.push(t)}},{key:"visitorNames",value:function(){return Object.keys(this.visitors)}}]),e}(),Tn=function(){function e(t){Object(c.a)(this,e),this.experiments=t}return Object(u.a)(e,[{key:"recordDataFor",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.experiments[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.recordDataFor(e)}}catch(o){n=!0,r=o}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}}]),e}();function Rn(e,t){console.log("running");for(var n=new Tn([new An({countAir:function(e){return e.filter(function(e){return e.constructor===ye}).length}}),new An({countSoil:function(e){return e.filter(function(e){return e.constructor===ge}).length}}),new An({countRock:function(e){return e.filter(function(e){return e.constructor===we}).length}}),new An({countFountain:function(e){return e.filter(function(e){return e.constructor===ke}).length}}),new An({playerY:function(e,t){return t.player.pos.y}}),new An({startAdjacentWaters:function(e,t){var n=function(e,t){var n,r=new Set,a=!0,i=!1,o=void 0;try{for(var s,l=e.entities()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(c instanceof fe&&(n=c,e.player.isWalkable(n))){var u=!0,h=!1,d=void 0;try{for(var m,f=e.tileNeighbors(c.pos)[Symbol.iterator]();!(u=(m=f.next()).done);u=!0){var v=m.value,p=Object(X.a)(v,2)[1];p instanceof xe||p.isObstacle||(null==t?r.add(p):t(p)&&r.add(p))}}catch(y){h=!0,d=y}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}}}}catch(y){i=!0,o=y}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r}(t,function(e){return e instanceof ge}),r=0,a=!0,i=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;z(c)&&(r+=c.inventory.water)}}catch(u){i=!0,o=u}finally{try{a||null==l.return||l.return()}finally{if(i)throw o}}return r}}),new An({countWaters:function(e){return e.reduce(function(e,t){return e+(z(t)?t.inventory.water:0)},0)}})]),r=0;r<20;r++){console.time("trial "+r);var a=new Ie(e(),Cn());n.recordDataFor(a),console.timeEnd("trial "+r)}!function(e,t){var n=[],r=e.map(function(e){return e.visitorNames().join("")});for(var a in r){for(var i=r[a],o=[],s=[],l=0;l<e[0].trials.length;l++){o.push(l);var c=e[a],u=c.trials[l],h=u[i];s.push(h)}var d={x:o,y:s,name:i,type:"bar"};n.push(d)}var m=document.createElement("div");document.getElementById(t).appendChild(m),window.Plotly.newPlot(m,n,{barmode:"stack"})}(n.experiments.slice(0,4),t);var i=!0,o=!1,s=void 0;try{for(var l,c=n.experiments[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){Nn(l.value,t)}}catch(u){o=!0,s=u}finally{try{i||null==c.return||c.return()}finally{if(o)throw s}}}function Nn(e,t){var n=[],r={},a=!0,i=!1,o=void 0;try{for(var s,l=function(){var t=s.value;u={x:e.trials.map(function(e){return e[t]}),type:"histogram",name:t},n.push(u),r.title={text:t}},c=e.visitorNames()[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var u;l()}}catch(d){i=!0,o=d}finally{try{a||null==c.return||c.return()}finally{if(i)throw o}}var h=document.createElement("div");document.getElementById(t).appendChild(h),h.style.height="240px",h.style.width="320px",h.style.display="inline-block",window.Plotly.newPlot(h,n,r)}var Pn=function(){return a.a.useEffect(function(){var e=document.createElement("script");e.src="https://cdn.plot.ly/plotly-latest.min.js",e.addEventListener("load",function(){Rn(kt,"temperate"),Rn(Ot,"rocky"),Rn(Et,"desert")}),document.body.appendChild(e)},[]),a.a.createElement("div",null,a.a.createElement("h1",null,"Experiments"),a.a.createElement("div",{id:"temperate"},a.a.createElement("h2",null,"Temperate")),a.a.createElement("div",{id:"rocky"},a.a.createElement("h2",null,"Rocky")),a.a.createElement("div",{id:"desert"},a.a.createElement("h2",null,"Desert")))};o.a.render(a.a.createElement(s.a,null,a.a.createElement(l.d,null,a.a.createElement(l.b,{path:"/test-win"},a.a.createElement(function(){var e=new Ie(kt(),Cn());e.time=150;var t=new Ce(new w.Vector2(0,0),e);t.committedResources.add(50,50),t.timeMatured=250,e.time=479;var n=new Ce(new w.Vector2(0,0),e);n.committedResources.add(25,15),e.time=1296;var r=new Ce(new w.Vector2(0,0),e);r.committedResources.add(50,50);var i={status:"won",fruits:[t,n,r],world:e};return a.a.createElement(Mn,{results:i,onDone:function(){}})},null)),a.a.createElement(l.b,{path:"/test-stats"},a.a.createElement(Pn,null)),a.a.createElement(l.b,{exact:!0,path:"/"},a.a.createElement(Sn,null)),a.a.createElement(l.b,{path:"*"},a.a.createElement(l.a,{to:"/"})))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},52:function(e,t,n){e.exports=n(117)},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){},72:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){},88:function(e,t,n){}},[[52,1,2]]]);
//# sourceMappingURL=main.bb9c5908.chunk.js.map